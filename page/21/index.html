<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico">
  <link rel="mask-icon" href="/images/favicon.ico" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"docs.lvrui.io","root":"/","scheme":"Muse","version":"7.7.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":true},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":5,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="æåœ°ç‘é›ªçš„ä¸ªäººæŠ€æœ¯åšå®¢. &quot;å–ä¹‹å¼€æº ç”¨ä¹‹å¼€æº&quot;, åˆ†äº«è‡ªå·±çš„ç»éªŒä¹‹è°ˆ&quot;.">
<meta property="og:type" content="website">
<meta property="og:title" content="Polar Snow Documentation">
<meta property="og:url" content="https://docs.lvrui.io/page/21/index.html">
<meta property="og:site_name" content="Polar Snow Documentation">
<meta property="og:description" content="æåœ°ç‘é›ªçš„ä¸ªäººæŠ€æœ¯åšå®¢. &quot;å–ä¹‹å¼€æº ç”¨ä¹‹å¼€æº&quot;, åˆ†äº«è‡ªå·±çš„ç»éªŒä¹‹è°ˆ&quot;.">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="æåœ°ç‘é›ª">
<meta property="article:tag" content="Kubernetes">
<meta property="article:tag" content="k8s">
<meta property="article:tag" content="etcd">
<meta property="article:tag" content="golang">
<meta property="article:tag" content="python">
<meta property="article:tag" content="Linux">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://docs.lvrui.io/page/21/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>Polar Snow Documentation</title>
  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?963aa068438aaf077b5ce5d3b8d51c95";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Polar Snow Documentation</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">èŠ±æœ‰é‡å¼€æ—¥ äººæ— å†å°‘å¹´</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>é¦–é¡µ</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>å…³äº</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>æ ‡ç­¾<span class="badge">373</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>åˆ†ç±»<span class="badge">14</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>å½’æ¡£<span class="badge">573</span></a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="off"
           placeholder="æœç´¢..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/Larry0315" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://docs.lvrui.io/2017/04/22/dockerfile%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%203/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.JPG">
      <meta itemprop="name" content="æåœ°ç‘é›ª">
      <meta itemprop="description" content="æåœ°ç‘é›ªçš„ä¸ªäººæŠ€æœ¯åšå®¢. "å–ä¹‹å¼€æº ç”¨ä¹‹å¼€æº", åˆ†äº«è‡ªå·±çš„ç»éªŒä¹‹è°ˆ".">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Polar Snow Documentation">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/04/22/dockerfile%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%203/" class="post-title-link" itemprop="url">dockerfileæœ€ä½³å®è·µ</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2017-04-22 00:46:04" itemprop="dateCreated datePublished" datetime="2017-04-22T00:46:04+08:00">2017-04-22</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Docker/" itemprop="url" rel="index"><span itemprop="name">Docker</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqusï¼š</span>
    
    <a title="disqus" href="/2017/04/22/dockerfile%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%203/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/04/22/dockerfileæœ€ä½³å®è·µ 3/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>é€šè¿‡ dockerfile å¯ä»¥åˆ¶ä½œé•œåƒ, é€šè¿‡ä¼˜åŒ– dockerfile ä¸­çš„æŒ‡ä»¤, å¯ä»¥å‡å°‘é•œåƒçš„ä½“ç§¯. æŒ‰ç…§ä¸€äº›è§„èŒƒåˆ¶ä½œ dockerfile, å¯ä»¥å¢åŠ  dockerfile çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§</p>
</blockquote>
<h1 id="åŸºæœ¬åŸåˆ™"><a href="#åŸºæœ¬åŸåˆ™" class="headerlink" title="åŸºæœ¬åŸåˆ™"></a>åŸºæœ¬åŸåˆ™</h1><ul>
<li>å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸæ˜¯çŸ­æš‚çš„(æ— çŠ¶æ€å®¹å™¨)<br>é€šè¿‡ dockerfile åˆ¶ä½œå‡ºçš„é•œåƒ, ä»é•œåƒå¯åŠ¨å®¹å™¨, è¿™äº›å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸåº”å°½é‡çŸ­æš‚. è¿™é‡Œçš„çŸ­æš‚æ„å‘³ç€å®¹å™¨éšæ—¶å¯ä»¥è¢«åœæ­¢å’Œåˆ é™¤. é€šè¿‡ç®€å•çš„é…ç½®å¯ä»¥ç«‹å³å¯åŠ¨ä¸€ä¸ªæ–°çš„å®¹å™¨</li>
<li>å°½é‡ä½¿ç”¨å¹²å‡€çš„ç›®å½•å»åˆ¶ä½œé•œåƒ, é¿å…ä¸å¿…è¦çš„æ€§èƒ½æŸè€—, å¿…è¦æ—¶å¯ä»¥ä½¿ç”¨<code>.dockerignore</code>æ–‡ä»¶æ’é™¤ä¸éœ€è¦æ‰«æçš„ç›®å½•</li>
<li>åªå®‰è£…éœ€è¦çš„åŒ…<br>ä¸ºäº†å‡å°‘é•œåƒçš„ä½“ç§¯å’Œç¼–è¯‘æ—¶é—´, åº”è¯¥é¿å…å®‰è£…é¢å¤–çš„, ä¸éœ€è¦çš„åŒ…</li>
<li>æ¯ä¸ªå®¹å™¨åªè¿è¡Œä¸€ä¸ªè¿›ç¨‹</li>
<li>å‡å°‘é•œåƒå±‚<br>dockerfile ä¸­çš„æŒ‡ä»¤ä¼šç”Ÿæˆæ–°çš„é•œåƒå±‚, ä¸€ä¸ªé•œåƒæœ€å¤šæœ‰127å±‚</li>
<li>æŠŠå¤šä¸ªå‚æ•°æ’åœ¨ä¸åŒçš„è¡Œä¸­æé«˜å¯è¯»æ€§<code>\</code></li>
</ul>
<p><strong>æ³¨æ„: ç¼–è¯‘ç¼“å­˜çš„é—®é¢˜<br>é’ˆå¯¹ ADD å’Œ COPY å‘½ä»¤, docker ä¼šæ£€æŸ¥é•œåƒå±‚ä¸­æ‰€æœ‰æºæ–‡ä»¶çš„å…ƒæ•°æ®å’Œæ–‡ä»¶å†…å®¹. å…¶ä¸­æ£€æŸ¥å…ƒæ•°æ®çš„æ—¶å€™, ä¸ä¼šæ£€æŸ¥æœ€åä¿®æ”¹æ—¶é—´å’Œè®¿é—®æ—¶é—´.<br>docker åœ¨é•œåƒç¼“å­˜ä¸­å¯»æ‰¾é•œåƒå±‚æ—¶, ä¸ä¼šæ£€æŸ¥æ–‡ä»¶. ä¾‹å¦‚, åœ¨æ‰§è¡Œ RUN yum update æ—¶, docker ä»…ä»…ä¼šæ¯”è¾ƒ RUN å‘½ä»¤çš„æœ¬èº«.</strong></p>
<h1 id="FROM-æŒ‡ä»¤æœ€ä½³å®è·µ"><a href="#FROM-æŒ‡ä»¤æœ€ä½³å®è·µ" class="headerlink" title="FROM æŒ‡ä»¤æœ€ä½³å®è·µ"></a>FROM æŒ‡ä»¤æœ€ä½³å®è·µ</h1><p>å°½é‡ä½¿ç”¨å®˜æ–¹é•œåƒä½œä¸ºåŸºç¡€é•œåƒ. å¦‚æœè€ƒè™‘é•œåƒçš„å¤§å°, å¯ä»¥ä½¿ç”¨ Debian çš„å®˜æ–¹é•œåƒ, è¯¥é•œåƒä½“ç§¯å°è€Œä¸” Docker å¯¹ä»–è¿›è¡Œäº†ä¼˜åŒ–, store.docker.com ä¸­æœ‰å¾ˆå¤šå®˜æ–¹é•œåƒéƒ½æ˜¯åŸºäº Debian çš„é•œåƒæ‰“é€ </p>
<h1 id="RUN-æŒ‡ä»¤æœ€ä½³å®è·µ"><a href="#RUN-æŒ‡ä»¤æœ€ä½³å®è·µ" class="headerlink" title="RUN æŒ‡ä»¤æœ€ä½³å®è·µ"></a>RUN æŒ‡ä»¤æœ€ä½³å®è·µ</h1><ul>
<li>ä»å¯è¯»æ€§çš„è§’åº¦è€ƒè™‘, ä½¿ç”¨ RUN å‘½ä»¤æ—¶, åº”ä½¿ç”¨ <code>\</code> å°†æŒ‡ä»¤åˆ†æˆå¤šè¡Œ</li>
<li>é¿å…æ›´æ–°åŸºç¡€é•œåƒä¸­çš„åŸºç¡€è½¯ä»¶åŒ…, é¿å…æ‰§è¡Œç±»ä¼¼äº <code>yum update</code> æˆ– <code>apt upgrade</code>çš„å‘½ä»¤. åœ¨æ²¡æœ‰ä½¿ç”¨ <code>--privileged</code>çš„è¿è¡Œå®¹å™¨ä¸­, åŸºç¡€é•œåƒä¸­çš„å¾ˆå¤šåŸºç¡€åŒ…æ˜¯ä¸èƒ½å‡çº§çš„. </li>
<li>ç”±äºé•œåƒçš„ç¼“å­˜æœºåˆ¶, åœ¨å®‰è£…è½¯ä»¶åŒ…æ—¶, æ›´æ–°è½¯ä»¶ä»“åº“ç´¢å¼•å’Œå®‰è£…è½¯ä»¶åŒ…å¿…é¡»åœ¨åŒä¸€ä¸ª RUN é‡Œæ‰§è¡Œ, å¦åˆ™å¯èƒ½ä¼šå¯¼è‡´å®‰è£…å¤±è´¥</li>
</ul>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># âœ”ï¸æ­£ç¡®å†™æ³•</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> apt update &amp;&amp; apt install -y \</span></span><br><span class="line"><span class="bash">	dstat \</span></span><br><span class="line"><span class="bash">    htop \</span></span><br><span class="line"><span class="bash">    lsof</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># âŒé”™è¯¯å†™æ³•</span><br><span class="line">RUN apt update</span><br><span class="line">RUN apt install -y \</span><br><span class="line">	dstat \</span><br><span class="line">    htop \</span><br><span class="line">    lsof</span><br></pre></td></tr></table></figure>

<p>ç”±äºé•œåƒçš„ç¼“å­˜æœºåˆ¶, åªéªŒè¯çš„ RUN åé¢çš„å‘½ä»¤, ä¼šå¯¼è‡´æ‰§è¡Œè¿‡ä¸€æ¬¡ <code>apt update</code> ä¹‹å, å†æ¬¡é‡åˆ°æ›´æ–°æ—¶å°†ä¼šä½¿ç”¨ç¼“å­˜é•œåƒ, ä»è€Œå¯¼è‡´ä»¥åå®‰è£…ä¸åˆ°æœ€æ–°çš„è½¯ä»¶åŒ…</p>
<p>ä½¿ç”¨<code>RUN apt update &amp;&amp; apt install -y \</code>çš„æ–¹å¼å¯ä»¥ä¿è¯æ¯æ¬¡ç¼–è¯‘é•œåƒæ—¶, éƒ½æ˜¯å®‰è£…çš„æœ€æ–°çš„åŒ…. è¿™ç§æŠ€æœ¯å«åšâ€ç¼“å­˜å¤±æ•ˆâ€</p>
<ul>
<li>å°½é‡åœ¨ä¸€æ¡ RUN æŒ‡ä»¤ä¸­åŒ…å«æ‰€æœ‰éœ€è¦çš„å®‰è£…åŒ…. å¦‚æœå®‰è£…åŒ…å¾ˆå¤š, å»ºè®®ä»¥é¦–å­—æ¯è¿›è¡Œæ’åº,æ¯è¡Œåªåˆ—å‡ºä¸€ä¸ªå®‰è£…åŒ…, æ–¹ä¾¿åæœŸç»´æŠ¤.</li>
<li>åœ¨å®‰è£…å‘½ä»¤çš„æœ€å, åº”è¯¥æ¸…ç†å®‰è£…ç¼“å­˜, å‡å°‘é•œåƒä½“ç§¯. æ‰§è¡Œ <code>... &amp;&amp; yum clean all</code> æˆ– <code>... &amp;&amp; rm -fr /var/lib/apt/lists/*</code></li>
</ul>
<h1 id="CMD-amp-ENTRYPOINT-æŒ‡ä»¤æœ€ä½³å®è·µ"><a href="#CMD-amp-ENTRYPOINT-æŒ‡ä»¤æœ€ä½³å®è·µ" class="headerlink" title="CMD &amp; ENTRYPOINT æŒ‡ä»¤æœ€ä½³å®è·µ"></a>CMD &amp; ENTRYPOINT æŒ‡ä»¤æœ€ä½³å®è·µ</h1><h2 id="CMD"><a href="#CMD" class="headerlink" title="CMD"></a>CMD</h2><p>CMD æŒ‡ä»¤è®¾ç½®é•œåƒä¸­çš„é»˜è®¤å¯åŠ¨å‘½ä»¤å’Œå‚æ•°. å®¹å™¨å¯åŠ¨ä¹‹å, å¦‚æœæ²¡æœ‰åŠ å…¥ä»»ä½•å¯åŠ¨å‘½ä»¤(ä¹Ÿå°±æ˜¯åœ¨é•œåƒå‚æ•°ä¹‹åæ²¡æœ‰æ·»åŠ ä»»ä½•å†…å®¹) åˆ™é»˜è®¤æ‰§è¡Œé•œåƒä¸­ CMD è®¾ç½®çš„é»˜è®¤çš„å¯åŠ¨å‘½ä»¤</p>
<ul>
<li><p>è®¾ç½®å¯åŠ¨å‘½ä»¤æ—¶, åº”è¯¥å°½é‡ä½¿ç”¨ JSON æ ¼å¼ <code>CMD [&quot;command&quot;, &quot;arg1&quot;, &quot;arg2&quot;]</code><br>ä¾‹å¦‚ Apache çš„å¯åŠ¨æ–¹å¼: <code>CMD [&quot;apache2&quot;, &quot;-DFOREGROUND&quot;]</code></p>
</li>
<li><p>å¦‚æœå¼€å‘è€…å’Œä½¿ç”¨è€…éƒ½ä¸æ˜¯å¾ˆç†Ÿæ‚‰ CMD å’Œ ENTRYPOINT çš„å·¥ä½œåŸç†çš„æƒ…å†µä¸‹, å°½é‡é¿å…è¿™ä¸¤ä¸ªæŒ‡ä»¤é…åˆä½¿ç”¨<br>ä¾‹å¦‚ Django çš„å¯åŠ¨æ–¹å¼: <code>CMD [&quot;python&quot;, &quot;manage.py&quot;, &quot;runserver&quot;, &quot;0.0.0.0:8000&quot;]</code></p>
</li>
<li><p>ç›¸å, å¦‚æœå¼€å‘è€…å’Œä½¿ç”¨è€…éƒ½å¾ˆç†Ÿæ‚‰ CMD å’Œ ENTRYPOINT çš„å·¥ä½œåŸç†, æ¨è CMD ä½œä¸º ENTRYPOINT çš„å‚æ•°æ¥é…å¥—ä½¿ç”¨</p>
</li>
</ul>
<h2 id="ENTRYPOINT"><a href="#ENTRYPOINT" class="headerlink" title="ENTRYPOINT"></a>ENTRYPOINT</h2><p>å½“éœ€è¦æŠŠå®¹å™¨å½“åšä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ä½¿ç”¨æ—¶, æ¨èé€šè¿‡ ENTRYPOINT æŒ‡ä»¤è®¾ç½®é•œåƒçš„å…¥å£ç¨‹åº</p>
<ul>
<li>å½“å¯åŠ¨ä¸»ç¨‹åºä¹‹å‰è¿˜éœ€è¦æ‰§è¡Œå¤§é‡çš„å‰ç½®æ“ä½œæ—¶, å¯ä»¥å°† ENTRYPOINT çš„å…¥å£æŒ‡ä»¤è®¾ç½®ä¸ºä¸€ä¸ªè„šæœ¬ <code>entrypoint.sh</code></li>
</ul>
<p>ä¾‹å¦‚ postgres çš„å®˜æ–¹ç”¨æ³•:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> [<span class="string">"docker-entrypoint.sh"</span>]</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">"postgres"</span>]</span></span><br></pre></td></tr></table></figure>
<p>docker-entrypoint.sh â¬‡ï¸</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">set</span> -e</span><br><span class="line"></span><br><span class="line"><span class="comment"># usage: file_env VAR [DEFAULT]</span></span><br><span class="line"><span class="comment">#    ie: file_env 'XYZ_DB_PASSWORD' 'example'</span></span><br><span class="line"><span class="comment"># (will allow for "$XYZ_DB_PASSWORD_FILE" to fill in the value of</span></span><br><span class="line"><span class="comment">#  "$XYZ_DB_PASSWORD" from a file, especially for Docker's secrets feature)</span></span><br><span class="line"><span class="function"><span class="title">file_env</span></span>() &#123;</span><br><span class="line">	<span class="built_in">local</span> var=<span class="string">"<span class="variable">$1</span>"</span></span><br><span class="line">	<span class="built_in">local</span> fileVar=<span class="string">"<span class="variable">$&#123;var&#125;</span>_FILE"</span></span><br><span class="line">	<span class="built_in">local</span> def=<span class="string">"<span class="variable">$&#123;2:-&#125;</span>"</span></span><br><span class="line">	<span class="keyword">if</span> [ <span class="string">"<span class="variable">$&#123;!var:-&#125;</span>"</span> ] &amp;&amp; [ <span class="string">"<span class="variable">$&#123;!fileVar:-&#125;</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">		<span class="built_in">echo</span> &gt;&amp;2 <span class="string">"error: both <span class="variable">$var</span> and <span class="variable">$fileVar</span> are set (but are exclusive)"</span></span><br><span class="line">		<span class="built_in">exit</span> 1</span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line">	<span class="built_in">local</span> val=<span class="string">"<span class="variable">$def</span>"</span></span><br><span class="line">	<span class="keyword">if</span> [ <span class="string">"<span class="variable">$&#123;!var:-&#125;</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">		val=<span class="string">"<span class="variable">$&#123;!var&#125;</span>"</span></span><br><span class="line">	<span class="keyword">elif</span> [ <span class="string">"<span class="variable">$&#123;!fileVar:-&#125;</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">		val=<span class="string">"<span class="variable">$(&lt; "$&#123;!fileVar&#125;")</span>"</span></span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line">	<span class="built_in">export</span> <span class="string">"<span class="variable">$var</span>"</span>=<span class="string">"<span class="variable">$val</span>"</span></span><br><span class="line">	<span class="built_in">unset</span> <span class="string">"<span class="variable">$fileVar</span>"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">"<span class="variable">$&#123;1:0:1&#125;</span>"</span> = <span class="string">'-'</span> ]; <span class="keyword">then</span></span><br><span class="line">	<span class="built_in">set</span> -- postgres <span class="string">"<span class="variable">$@</span>"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># allow the container to be started with `--user`</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">"<span class="variable">$1</span>"</span> = <span class="string">'postgres'</span> ] &amp;&amp; [ <span class="string">"<span class="variable">$(id -u)</span>"</span> = <span class="string">'0'</span> ]; <span class="keyword">then</span></span><br><span class="line">	mkdir -p <span class="string">"<span class="variable">$PGDATA</span>"</span></span><br><span class="line">	chown -R postgres <span class="string">"<span class="variable">$PGDATA</span>"</span></span><br><span class="line">	chmod 700 <span class="string">"<span class="variable">$PGDATA</span>"</span></span><br><span class="line"></span><br><span class="line">	mkdir -p /var/run/postgresql</span><br><span class="line">	chown -R postgres /var/run/postgresql</span><br><span class="line">	chmod g+s /var/run/postgresql</span><br><span class="line"></span><br><span class="line">	<span class="comment"># Create the transaction log directory before initdb is run (below) so the directory is owned by the correct user</span></span><br><span class="line">	<span class="keyword">if</span> [ <span class="string">"<span class="variable">$POSTGRES_INITDB_XLOGDIR</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">		mkdir -p <span class="string">"<span class="variable">$POSTGRES_INITDB_XLOGDIR</span>"</span></span><br><span class="line">		chown -R postgres <span class="string">"<span class="variable">$POSTGRES_INITDB_XLOGDIR</span>"</span></span><br><span class="line">		chmod 700 <span class="string">"<span class="variable">$POSTGRES_INITDB_XLOGDIR</span>"</span></span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">	<span class="built_in">exec</span> gosu postgres <span class="string">"<span class="variable">$BASH_SOURCE</span>"</span> <span class="string">"<span class="variable">$@</span>"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">"<span class="variable">$1</span>"</span> = <span class="string">'postgres'</span> ]; <span class="keyword">then</span></span><br><span class="line">	mkdir -p <span class="string">"<span class="variable">$PGDATA</span>"</span></span><br><span class="line">	chown -R <span class="string">"<span class="variable">$(id -u)</span>"</span> <span class="string">"<span class="variable">$PGDATA</span>"</span> 2&gt;/dev/null || :</span><br><span class="line">	chmod 700 <span class="string">"<span class="variable">$PGDATA</span>"</span> 2&gt;/dev/null || :</span><br><span class="line"></span><br><span class="line">	<span class="comment"># look specifically for PG_VERSION, as it is expected in the DB dir</span></span><br><span class="line">	<span class="keyword">if</span> [ ! -s <span class="string">"<span class="variable">$PGDATA</span>/PG_VERSION"</span> ]; <span class="keyword">then</span></span><br><span class="line">		file_env <span class="string">'POSTGRES_INITDB_ARGS'</span></span><br><span class="line">		<span class="keyword">if</span> [ <span class="string">"<span class="variable">$POSTGRES_INITDB_XLOGDIR</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">			<span class="built_in">export</span> POSTGRES_INITDB_ARGS=<span class="string">"<span class="variable">$POSTGRES_INITDB_ARGS</span> --xlogdir <span class="variable">$POSTGRES_INITDB_XLOGDIR</span>"</span></span><br><span class="line">		<span class="keyword">fi</span></span><br><span class="line">		<span class="built_in">eval</span> <span class="string">"initdb --username=postgres <span class="variable">$POSTGRES_INITDB_ARGS</span>"</span></span><br><span class="line"></span><br><span class="line">		<span class="comment"># check password first so we can output the warning before postgres</span></span><br><span class="line">		<span class="comment"># messes it up</span></span><br><span class="line">		file_env <span class="string">'POSTGRES_PASSWORD'</span></span><br><span class="line">		<span class="keyword">if</span> [ <span class="string">"<span class="variable">$POSTGRES_PASSWORD</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">			pass=<span class="string">"PASSWORD '<span class="variable">$POSTGRES_PASSWORD</span>'"</span></span><br><span class="line">			authMethod=md5</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			<span class="comment"># The - option suppresses leading tabs but *not* spaces. :)</span></span><br><span class="line">			cat &gt;&amp;2 &lt;&lt;-<span class="string">'EOWARN'</span></span><br><span class="line">				****************************************************</span><br><span class="line">				WARNING: No password has been <span class="built_in">set</span> <span class="keyword">for</span> the database.</span><br><span class="line">				         This will allow anyone with access to the</span><br><span class="line">				         Postgres port to access your database. In</span><br><span class="line">				         Docker<span class="string">'s default configuration, this is</span></span><br><span class="line"><span class="string">				         effectively any other container on the same</span></span><br><span class="line"><span class="string">				         system.</span></span><br><span class="line"><span class="string">				         Use "-e POSTGRES_PASSWORD=password" to set</span></span><br><span class="line"><span class="string">				         it in "docker run".</span></span><br><span class="line"><span class="string">				****************************************************</span></span><br><span class="line"><span class="string">			EOWARN</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">			pass=</span></span><br><span class="line"><span class="string">			authMethod=trust</span></span><br><span class="line"><span class="string">		fi</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">		&#123;</span></span><br><span class="line"><span class="string">			echo</span></span><br><span class="line"><span class="string">			echo "host all all all $authMethod"</span></span><br><span class="line"><span class="string">		&#125; &gt;&gt; "$PGDATA/pg_hba.conf"</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">		# internal start of server in order to allow set-up using psql-client		</span></span><br><span class="line"><span class="string">		# does not listen on external TCP/IP and waits until start finishes</span></span><br><span class="line"><span class="string">		PGUSER="$&#123;PGUSER:-postgres&#125;" \</span></span><br><span class="line"><span class="string">		pg_ctl -D "$PGDATA" \</span></span><br><span class="line"><span class="string">			-o "-c listen_addresses='</span>localhost<span class="string">'" \</span></span><br><span class="line"><span class="string">			-w start</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">		file_env '</span>POSTGRES_USER<span class="string">' '</span>postgres<span class="string">'</span></span><br><span class="line"><span class="string">		file_env '</span>POSTGRES_DB<span class="string">' "$POSTGRES_USER"</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">		psql=( psql -v ON_ERROR_STOP=1 )</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">		if [ "$POSTGRES_DB" != '</span>postgres<span class="string">' ]; then</span></span><br><span class="line"><span class="string">			"$&#123;psql[@]&#125;" --username postgres &lt;&lt;-EOSQL</span></span><br><span class="line"><span class="string">				CREATE DATABASE "$POSTGRES_DB" ;</span></span><br><span class="line"><span class="string">			EOSQL</span></span><br><span class="line"><span class="string">			echo</span></span><br><span class="line"><span class="string">		fi</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">		if [ "$POSTGRES_USER" = '</span>postgres<span class="string">' ]; then</span></span><br><span class="line"><span class="string">			op='</span>ALTER<span class="string">'</span></span><br><span class="line"><span class="string">		else</span></span><br><span class="line"><span class="string">			op='</span>CREATE<span class="string">'</span></span><br><span class="line"><span class="string">		fi</span></span><br><span class="line"><span class="string">		"$&#123;psql[@]&#125;" --username postgres &lt;&lt;-EOSQL</span></span><br><span class="line"><span class="string">			$op USER "$POSTGRES_USER" WITH SUPERUSER $pass ;</span></span><br><span class="line"><span class="string">		EOSQL</span></span><br><span class="line"><span class="string">		echo</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">		psql+=( --username "$POSTGRES_USER" --dbname "$POSTGRES_DB" )</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">		echo</span></span><br><span class="line"><span class="string">		for f in /docker-entrypoint-initdb.d/*; do</span></span><br><span class="line"><span class="string">			case "$f" in</span></span><br><span class="line"><span class="string">				*.sh)     echo "$0: running $f"; . "$f" ;;</span></span><br><span class="line"><span class="string">				*.sql)    echo "$0: running $f"; "$&#123;psql[@]&#125;" -f "$f"; echo ;;</span></span><br><span class="line"><span class="string">				*.sql.gz) echo "$0: running $f"; gunzip -c "$f" | "$&#123;psql[@]&#125;"; echo ;;</span></span><br><span class="line"><span class="string">				*)        echo "$0: ignoring $f" ;;</span></span><br><span class="line"><span class="string">			esac</span></span><br><span class="line"><span class="string">			echo</span></span><br><span class="line"><span class="string">		done</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">		PGUSER="$&#123;PGUSER:-postgres&#125;" \</span></span><br><span class="line"><span class="string">		pg_ctl -D "$PGDATA" -m fast -w stop</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">		echo</span></span><br><span class="line"><span class="string">		echo '</span>PostgreSQL init process complete; ready <span class="keyword">for</span> start up.<span class="string">'</span></span><br><span class="line"><span class="string">		echo</span></span><br><span class="line"><span class="string">	fi</span></span><br><span class="line"><span class="string">fi</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">exec "$@"</span></span><br></pre></td></tr></table></figure>

<h2 id="CMD-å’Œ-ENTRYPOINTçš„åŒºåˆ«"><a href="#CMD-å’Œ-ENTRYPOINTçš„åŒºåˆ«" class="headerlink" title="CMD å’Œ ENTRYPOINTçš„åŒºåˆ«"></a>CMD å’Œ ENTRYPOINTçš„åŒºåˆ«</h2><ul>
<li>å½“ dockerfile ä¸­æŒ‡å®šäº† ENTRYPOINT çš„æ—¶å€™, docker run å¦‚æœåœ¨é•œåƒä¹‹åæ·»åŠ çš„æŒ‡ä»¤, é‚£ä¹ˆè¿™äº›æŒ‡ä»¤å°†è¢«å½“åš ENTRYPOINT çš„å‚æ•°æ‰§è¡Œ</li>
<li>å¦‚æœ dockerfile ä¸­åŒæ—¶æœ‰ CMD å’Œ ENTRYPOINT æŒ‡ä»¤, å½“ CMD æŒ‡ä»¤å¯æ‰§è¡Œæ—¶, å®ƒå°†åœ¨ ENTRYPOINT ä¹‹å‰è¿è¡Œ; å¦‚æœ CMD ä¸æ˜¯å¯æ‰§è¡Œçš„å‘½ä»¤, åˆ™å°†ä½œä¸º ENTRYPOINT çš„å‘½ä»¤å‚æ•°è¿½åŠ </li>
</ul>
<h1 id="EXPOSE-æœ€ä½³å®è·µ"><a href="#EXPOSE-æœ€ä½³å®è·µ" class="headerlink" title="EXPOSE æœ€ä½³å®è·µ"></a>EXPOSE æœ€ä½³å®è·µ</h1><ul>
<li><p>EXPOSE ç”¨æ¥å£°æ˜æœªæ¥å®¹å™¨å†…éœ€è¦ç›‘å¬çš„ç«¯å£, åœ¨ bridge æ¨¡å¼ä¸‹, è¿™äº›å®¹å™¨å†…éƒ¨çš„ç«¯å£ä¼šæ˜ å°„åˆ°å®¿ä¸»æœºçš„ç«¯å£ä¸Š, å»ºè®®åœ¨å®¹å™¨å†…éƒ¨ä¸è¦æ›´æ”¹åº”ç”¨åŸç”Ÿçš„ç«¯å£å·</p>
</li>
<li><p>EXPOSE ä¸­åªèƒ½æŒ‡å®šæœªæ¥å®¹å™¨å†…éƒ¨éœ€è¦æš´éœ²çš„ç«¯å£, ä¸èƒ½æŒ‡å®šæœªæ¥å®¹å™¨å¤–éƒ¨ä¸å†…éƒ¨ç«¯å£ä¹‹é—´çš„æ˜ å°„å…³ç³», æ¯”å¦‚è®¾ç½® <code>EXPOSE 8800:80</code> æ˜¯æ²¡æœ‰ä»»ä½•æ„ä¹‰çš„</p>
</li>
</ul>
<h1 id="ENV-æœ€ä½³å®è·µ"><a href="#ENV-æœ€ä½³å®è·µ" class="headerlink" title="ENV æœ€ä½³å®è·µ"></a>ENV æœ€ä½³å®è·µ</h1><ul>
<li>é€šè¿‡ç¯å¢ƒå˜é‡æ¥é…ç½®æœåŠ¡çš„ç›¸å…³è®¾ç½®, é€šè¿‡è¿™ç§æ–¹å¼å¯ä»¥æ–¹ä¾¿çš„åœ¨ä¸åŒç¯å¢ƒä¸­ä¿®æ”¹é…ç½®, å¿«é€Ÿå¯åŠ¨æœåŠ¡, åŠ å¿«å¼€å‘, æµ‹è¯•, éƒ¨ç½²çš„æµç¨‹</li>
<li>è®¾ç½®ç³»ç»Ÿç¯å¢ƒå˜é‡, æ¯”å¦‚äºŒè¿›åˆ¶åŒ…å®‰è£…çš„ nginx, åœ¨ ENV è®¾ç½® PATH</li>
<li>ä¹Ÿå¯ä»¥å€Ÿé‰´ LABEL çš„ä½¿ç”¨å“²å­¦, æ ‡è®°ä¸€äº›ç‰ˆæœ¬å·æˆ–ç‰ˆæœ¬ç¼–ç ä¿¡æ¯</li>
</ul>
<h1 id="ADD-ä¸-COPY-æœ€ä½³å®è·µ"><a href="#ADD-ä¸-COPY-æœ€ä½³å®è·µ" class="headerlink" title="ADD ä¸ COPY æœ€ä½³å®è·µ"></a>ADD ä¸ COPY æœ€ä½³å®è·µ</h1><p>ADD ä¸ COPY éƒ½æ˜¯å°†å¤–éƒ¨æ–‡ä»¶æ‹·è´åˆ°é•œåƒå†…éƒ¨çš„æŒ‡ä»¤, ç›¸æ¯”ä¹‹ä¸‹å¯èƒ½ ADD çš„åŠŸèƒ½æ›´åŠ å¼ºå¤§ä¸€ä¸‹, ä½†æ˜¯æˆ‘çš„å»ºè®®å¦‚ä¸‹:</p>
<ul>
<li>å°½é‡ä¸è¦æ‹·è´è¿œç¨‹æ–‡ä»¶, è¿™æ ·ä¹Ÿå°±ç”¨ä¸ç€ ADD çš„åŠŸèƒ½, ç”¨ COPY å°±å¯ä»¥äº†</li>
<li>å¦‚æœå‹ç¼©åŒ…æ‹·è´è¿›é•œåƒå, ä¸å¸Œæœ›è¿™ä¸ªå‹ç¼©åŒ…è¢«è‡ªåŠ¨è§£å‹ç¼©, ç”¨ COPY å°±å¯¹äº†. åä¹‹å¦‚æœå¸Œæœ›æ‹·è´è¿›é•œåƒä¹‹åå°±è‡ªåŠ¨è§£å‹åš, é‚£å°±ç”¨ ADD æ‹·è´è¿›å»</li>
</ul>
<p>å¦‚æœæ¶‰åŠåˆ°è¿œç¨‹æ–‡ä»¶, å»ºè®®ä½¿ç”¨ <code>RUN curl</code> æˆ– <code>RUN wget</code> å‘½ä»¤æ›¿ä»£ ADD</p>
<h1 id="VOLUME-æœ€ä½³å®è·µ"><a href="#VOLUME-æœ€ä½³å®è·µ" class="headerlink" title="VOLUME æœ€ä½³å®è·µ"></a>VOLUME æœ€ä½³å®è·µ</h1><p>VOLUME çš„ä½œç”¨æ˜¯æŒä¹…åŒ–å®¹å™¨å†…çš„æ–‡ä»¶, å£°æ˜æŸä¸ªç›®å½•éœ€è¦åœ¨å®¿ä¸»æœºæŒ‚è½½å, å½“ docker run èµ·é•œåƒæ—¶, docker ä¼šåœ¨å®¿ä¸»æœºé»˜è®¤ç›®å½•ä¸‹éšæœºç”Ÿæˆä¸€ä¸ªæ–‡ä»¶å¤¹æŒ‚è½½åˆ°å®¹å™¨å†…éƒ¨çš„æŒ‡å®šæ–‡ä»¶å¤¹.</p>
<p>å½“è¯¥å®¹å™¨è¢«åˆ é™¤æ—¶, å®¿ä¸»æœºä¸Šçš„è¿™ä¸ªæ–‡ä»¶å¤¹å¹¶ä¸ä¼šè¢«åˆ é™¤. å½“åˆ é™¤å®¹å™¨æ—¶åŠ å…¥äº†<code>-v</code> å‚æ•°, é‚£ä¹ˆå¯¹åº”çš„æ•°æ®å·å°±ä¼šè¢«åˆ é™¤</p>
<h1 id="USER-æœ€ä½³å®è·µ"><a href="#USER-æœ€ä½³å®è·µ" class="headerlink" title="USER æœ€ä½³å®è·µ"></a>USER æœ€ä½³å®è·µ</h1><p>å¦‚æœå®¹å™¨ä¸­çš„åº”ç”¨ç¨‹åºè¿è¡Œæ—¶ä¸éœ€è¦ç‰¹æ®Šçš„æƒé™, å¯ä»¥é€šè¿‡ USER æŒ‡ä»¤æŠŠåº”ç”¨ç¨‹åºçš„æ‰€æœ‰è€…è®¾ç½®ä¸ºé root ç”¨æˆ·. å¦‚æœè¯¥ç”¨æˆ·ä¸å­˜åœ¨, é¦–å…ˆéœ€è¦ä½¿ç”¨ RUN å‘½ä»¤åœ¨é•œåƒä¸­åˆ›å»ºç”¨æˆ·.</p>
<ul>
<li>å¦‚æœåœ¨æ¯æ¬¡ç¼–è¯‘é•œåƒæ—¶, å¯¹ç”¨æˆ·çš„ UID/GID æœ‰è¦æ±‚éœ€è¦ä¿æŒä¸€è‡´, åº”è¯¥åœ¨æ–°å»ºç”¨æˆ·å’Œç»„çš„æ—¶å€™æŒ‡å®š UIDå’Œ GID</li>
<li>åœ¨é•œåƒä¸­é¿å…ä½¿ç”¨sudo å‘½ä»¤. åº”ä¸ºè¯¥å‘½ä»¤ä½¿ç”¨çš„ TTY ä¸ç¡®å®š, å¯¹æ¥æ”¶ä¿¡å·é‡ä¹Ÿä¼šé€ æˆå½±å“. å¦‚æœç¡®å®éœ€è¦ä½¿ç”¨ sudo åŠŸèƒ½, åˆ™å¯æ˜¯ä½¿ç”¨ gosu å‘½ä»¤æ›¿ä»£</li>
<li>å¯ä»¥ç”¨ root ç”¨æˆ·åˆå§‹åŒ–ä¸€ä¸ª daemon, ç„¶åç”¨é root ç”¨æˆ·å¯åŠ¨è¿™ä¸ª daemon</li>
<li>ä¸ºäº†å‡å°‘é•œåƒä½“ç§¯, åº”è¯¥é¿å…ä¸å¿…è¦çš„ç”¨æˆ·åˆ‡æ¢</li>
</ul>
<h1 id="WORKDIR-æœ€ä½³å®è·µ"><a href="#WORKDIR-æœ€ä½³å®è·µ" class="headerlink" title="WORKDIR æœ€ä½³å®è·µ"></a>WORKDIR æœ€ä½³å®è·µ</h1><ul>
<li>å°½é‡ä½¿ç”¨ç»å¯¹è·¯å¾„</li>
<li>åˆ‡æ¢ç›®å½•çš„æ—¶å€™å°½é‡ä½¿ç”¨ WORKDIR, è€Œä¸æ˜¯ä½¿ç”¨ <code>RUN cd /dir</code></li>
</ul>
<h1 id="gosu-å·¥å…·"><a href="#gosu-å·¥å…·" class="headerlink" title="gosu å·¥å…·"></a>gosu å·¥å…·</h1><p>gosu æ˜¯ä¸€ä¸ª golang è¯­è¨€å¼€å‘çš„å·¥å…·, ç”¨æ¥å–ä»£ shell ä¸­çš„ sudo å‘½ä»¤. su å’Œ sudo å‘½ä»¤æœ‰ä¸€äº›ç¼ºé™·, ä¸»è¦æ˜¯ä¼šå¼•èµ·ä¸ç¡®å®šçš„ TTY, å¯¹ä¿¡å·é‡çš„è½¬å‘ä¹Ÿå­˜åœ¨é—®é¢˜. å¦‚æœä»…ä»…ä¸ºäº†ä½¿ç”¨ç‰¹å®šçš„ç”¨æˆ·è¿è¡Œç¨‹åº, ä½¿ç”¨ su æˆ– sudo æ˜¾å¾—å¤ªé‡äº†, ä¸ºæ­¤ gosu åº”è¿è€Œç”Ÿ.</p>
<p>gosu ç›´æ¥å€Ÿç”¨äº† libcontainer åœ¨å®¹å™¨ä¸­å¯åŠ¨åº”ç”¨ç¨‹åºçš„åŸç†, ä½¿ç”¨ <code>/etc/passwd</code> å¤„ç†åº”ç”¨ç¨‹åº. gosu é¦–å…ˆæ‰¾å‡ºæŒ‡å®šçš„ç”¨æˆ·æˆ–ç”¨æˆ·ç»„, ç„¶ååˆ‡æ¢åˆ°è¯¥ç”¨æˆ·æˆ–ç”¨æˆ·ç»„. æ¥ä¸‹æ¥, ä½¿ç”¨ exec å¯åŠ¨åº”ç”¨ç¨‹åº. åˆ°æ­¤ä¸ºæ­¢, gosu å®Œæˆäº†å®ƒçš„å·¥ä½œ, ä¸ä¼šå‚ä¸åˆ°åº”ç”¨ç¨‹åºåé¢çš„å£°æ˜å‘¨æœŸä¸­. ä½¿ç”¨è¿™ç§æ–¹å¼é¿å…äº† gosu å¤„ç† TTY å’Œè½¬å‘ä¿¡å·é‡çš„é—®é¢˜, æŠŠè¿™ä¸¤ä¸ªå·¥ä½œç›´æ¥äº¤ç»™äº†åº”ç”¨ç¨‹åºå»å®Œæˆ</p>

      
    </div>

    
    
    
      

      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://docs.lvrui.io/2017/04/21/dockerfile%E8%AF%A6%E8%A7%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.JPG">
      <meta itemprop="name" content="æåœ°ç‘é›ª">
      <meta itemprop="description" content="æåœ°ç‘é›ªçš„ä¸ªäººæŠ€æœ¯åšå®¢. "å–ä¹‹å¼€æº ç”¨ä¹‹å¼€æº", åˆ†äº«è‡ªå·±çš„ç»éªŒä¹‹è°ˆ".">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Polar Snow Documentation">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/04/21/dockerfile%E8%AF%A6%E8%A7%A3/" class="post-title-link" itemprop="url">dockerfileè¯¦è§£</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2017-04-21 22:22:53" itemprop="dateCreated datePublished" datetime="2017-04-21T22:22:53+08:00">2017-04-21</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Docker/" itemprop="url" rel="index"><span itemprop="name">Docker</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqusï¼š</span>
    
    <a title="disqus" href="/2017/04/21/dockerfile%E8%AF%A6%E8%A7%A3/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/04/21/dockerfileè¯¦è§£/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>Dockerfileæ˜¯ç”±ä¸€ç³»åˆ—å‘½ä»¤å’Œå‚æ•°æ„æˆçš„è„šæœ¬ï¼Œä¸€ä¸ªDockerfileé‡Œé¢åŒ…å«äº†æ„å»ºæ•´ä¸ªimageçš„å®Œæ•´å‘½ä»¤ã€‚Dockeré€šè¿‡docker buildæ‰§è¡ŒDockerfileä¸­çš„ä¸€ç³»åˆ—å‘½ä»¤è‡ªåŠ¨æ„å»ºimage</p>
</blockquote>
<h1 id="ç”¨æ³•"><a href="#ç”¨æ³•" class="headerlink" title="ç”¨æ³•"></a>ç”¨æ³•</h1><p><code>dockerfile</code> ä½¿ç”¨ <code>docker build</code> å‘½ä»¤æ¥ç”Ÿæˆ <code>image</code> é•œåƒ, <code>docker build</code>çš„è¯­æ³•å¦‚ä¸‹:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Usage:	docker build [OPTIONS] PATH | URL | -</span><br></pre></td></tr></table></figure>

<ul>
<li>PATH æ˜¯æœ¬åœ°æ–‡ä»¶è·¯å¾„</li>
<li>URL æ˜¯ git repository çš„è·¯å¾„</li>
</ul>
<p>æ„å»ºé•œåƒæ—¶, docker å°†ä¼šé€’å½’åœ°è¯»å–è·¯å¾„ä¸‹çš„æ‰€æœ‰æ–‡ä»¶. å› æ­¤, PATHåŒ…æ‹¬ä»»ä½•å­ç›®å½•ï¼ŒURLåŒ…æ‹¬repositoryåŠsubmodules</p>
<p><strong>å®˜æ–¹æ¨è: åœ¨æ„å»ºé•œåƒçš„æ—¶å€™, æœ€å¥½ä½¿ç”¨å¹²å‡€çš„ç›®å½•è¿›è¡Œæ„å»º, å‡å°‘ä¸å¿…è¦çš„ç´¢å¼•æ€§èƒ½æŸè€—, æé«˜æ„å»ºæ•ˆç‡</strong></p>
<p>å¦‚æœåœ¨ç‰¹æ®Šç¯å¢ƒçš„é™åˆ¶ä¸‹, ä¸€å®šè¦åœ¨æœ‰ä¼—å¤šå¹²æ‰°æ–‡ä»¶çš„ç›®å½•ä¸‹æ„å»ºé•œåƒ, å¯ä»¥ä½¿ç”¨ <code>.dockerignore</code> æ–‡ä»¶æ¥å±è”½ç´¢å¼•è¿™äº›æ–‡ä»¶</p>
<p>ä½ å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼è¿›è¡Œæ„å»º</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æœ€ç®€å•çš„æ‰§è¡Œæ–¹å¼</span></span><br><span class="line">$ docker build .</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœæ–‡ä»¶åä¸æ˜¯dockerfile, é‚£ä¹ˆéœ€è¦æ˜¾ç¤ºçš„ç²¾ç¡®æŒ‡å®šæ–‡ä»¶</span></span><br><span class="line">$ docker build -f /path/to/a/Dockerfile .</span><br><span class="line"></span><br><span class="line"><span class="comment"># é¡ºä¾¿æ‰“ä¸ªæ ‡ç­¾ğŸ·</span></span><br><span class="line">$ docker build -t shykes/myapp .</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰“å¤šä¸ªæ ‡ç­¾</span></span><br><span class="line">$ docker build -t shykes/myapp:1.0.2 -t shykes/myapp:latest .</span><br></pre></td></tr></table></figure>

<p>åªè¦æœ‰å¯èƒ½ï¼ŒDockerå°†é‡æ–°ä½¿ç”¨ä¸­é—´imagesï¼ˆç¼“å­˜ï¼‰ï¼Œä»¥æ˜¾ç€åŠ é€Ÿdocker buildè¿‡ç¨‹</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ docker build -t svendowideit/ambassador .</span><br><span class="line">Sending build context to Docker daemon 15.36 kB</span><br><span class="line">Step 1 : FROM alpine:3.2</span><br><span class="line"> ---&gt; 31f630c65071</span><br><span class="line">Step 2 : MAINTAINER SvenDowideit@home.org.au</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; 2a1c91448f5f</span><br><span class="line">Step 3 : RUN apk update &amp;&amp;      apk add socat &amp;&amp;        rm -r /var/cache/</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; 21ed6e7fbb73</span><br><span class="line">Step 4 : CMD env | grep _TCP= | (sed <span class="string">'s/.*_PORT_\([0-9]*\)_TCP=tcp:\/\/\(.*\):\(.*\)/socat -t 100000000 TCP4-LISTEN:\1,fork,reuseaddr TCP4:\2:\3 \&amp;/'</span> &amp;&amp; <span class="built_in">echo</span> <span class="built_in">wait</span>) | sh</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; 7ea8aef582cc</span><br><span class="line">Successfully built 7ea8aef582cc</span><br></pre></td></tr></table></figure>

<p>æ„å»ºæˆåŠŸåï¼Œå°±å¯ä»¥å‡†å¤‡Pushing a repository to its registry</p>
<h1 id="Format-è¯­æ³•æ ¼å¼"><a href="#Format-è¯­æ³•æ ¼å¼" class="headerlink" title="Format è¯­æ³•æ ¼å¼"></a>Format è¯­æ³•æ ¼å¼</h1><p>Dockerfileçš„æ ¼å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># Comment</span><br><span class="line">INSTRUCTION arguments</span><br></pre></td></tr></table></figure>

<ul>
<li>Line1 ç¬¬ä¸€è¡Œæ˜¯è§£æå™¨æŒ‡ä»¤</li>
<li>INSTRUCTION æ˜¯ä¸åŒºåˆ†å¤§å°å†™çš„ï¼Œä¸è¿‡å»ºè®®å¤§å†™. è¿™é‡Œå†™ dockerfile ä¸­æ”¯æŒçš„æŒ‡ä»¤é›†</li>
<li>arguments è¿™é‡Œå†™å¯¹åº”çš„å‘½ä»¤</li>
<li>dockerfile ä¸­çš„ç¬¬ä¸€ä¸ªæŒ‡ä»¤å¿…é¡»æ˜¯<code>FORM</code> æŒ‡å®šæ„å»ºé•œåƒçš„Base Image, è¿™ä¸ª Base Image åŸºç¡€é•œåƒå¯ä»¥æ˜¯ä¸€ä¸ªç³»ç»Ÿçš„é•œåƒæ¯”å¦‚<code>CentOS</code> <code>Ubuntu</code>ç­‰, ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªåº”ç”¨é•œåƒ, ç”¨æ¥åšäºŒæ¬¡å®šåˆ¶, æ¯”å¦‚ <code>nginx</code> <code>httpd</code> <code>mysql</code> ç­‰</li>
<li>dockerfileä¸­ä»¥<code>#</code>å¼€å¤´çš„è¡Œéƒ½å°†è§†ä¸ºæ³¨é‡Šï¼Œé™¤éæ˜¯ Parser directives è§£æå™¨æŒ‡ä»¤, è€Œä¸” dockerfile ä¸­ä¸æ”¯æŒè¿ç»­æ³¨é‡Š</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># Comment</span><br><span class="line">RUN echo &#39;we are running some # of cool things&#39;</span><br></pre></td></tr></table></figure>

<h1 id="ParserDirectives-è§£æå™¨æŒ‡ä»¤"><a href="#ParserDirectives-è§£æå™¨æŒ‡ä»¤" class="headerlink" title="ParserDirectives è§£æå™¨æŒ‡ä»¤"></a>ParserDirectives è§£æå™¨æŒ‡ä»¤</h1><p>è§£æå™¨æŒ‡ä»¤æ˜¯å¯é€‰çš„,  å¹¶ä¸”å½±å“å¤„ç† dockerfile ä¸­åç»­çš„æ‰§è¡Œæ–¹å¼. è§£æå™¨çš„æŒ‡ä»¤ä¸ä¼šå‘æ„å»ºä¸­æ·»åŠ å›¾å±‚, å¹¶ä¸”ä¸ä¼šæ˜¾ç¤ºåœ¨æ„å»ºçš„æ­¥éª¤å½“ä¸­. è§£æå™¨çš„æŒ‡ä»¤æ˜¯ä»¥ <code># directive = value</code> çš„å½¢å¼å†™æˆä¸€ç§ç‰¹æ®Šç±»å‹çš„æ³¨é‡Š, ä¸”å•ä¸ªæŒ‡ä»¤åªèƒ½ä½¿ç”¨ä¸€æ¬¡.(åˆ°ç›®å‰ä¸ºæ­¢ 2017/04/19 dockerfile åªæ”¯æŒä¸€ç§è§£æå™¨æŒ‡ä»¤)<br>å½“ docker é‡åˆ°æ™®é€šæ³¨é‡Šè¡Œæˆ–ç©ºè¡Œæˆ–æ˜¯å·²ç»è¢«æ‰§è¡Œè¿‡çš„è§£æå™¨æŒ‡ä»¤, docker éƒ½ä¸ä¼šå†å¯»æ‰¾ä»»ä½•è§£æå™¨çš„æŒ‡ä»¤. å› æ­¤, æ‰€æœ‰çš„è§£æå™¨æŒ‡ä»¤éƒ½å¿…é¡»ä½äº dockerfile çš„æœ€é¡¶ç«¯</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># escape&#x3D;&#96;</span><br><span class="line"></span><br><span class="line">FROM windowsservercore</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>ç›®å‰è§£æå™¨æŒ‡ä»¤åªæ”¯æŒ:</p>
<ul>
<li>escape</li>
</ul>
<h1 id="escape"><a href="#escape" class="headerlink" title="escape"></a>escape</h1><p>escape ä½œä¸º dockerfile è§£æå™¨ç›®å‰ä¸ºæ­¢å”¯ä¸€æ”¯æŒçš„æŒ‡ä»¤, ç›®å‰æœ‰ä»¥ä¸‹ä¸¤ç§ç”¨æ³•:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># escape&#x3D;\ (backslash)</span><br><span class="line">æˆ–è€…</span><br><span class="line"># escape&#x3D;&#96; (backtick)</span><br></pre></td></tr></table></figure>

<p>escape çš„ä½œç”¨æ˜¯å£°æ˜ dockerfile ä¸­çš„è½¬ä¹‰ç¬¦, åœ¨ä¸æŒ‡å®šçš„é»˜è®¤æƒ…å†µä¸‹,  è½¬ä¹‰ç¬¦æ˜¯åæ–œæ  <code>\</code> ä½†æ˜¯å¦‚æœæ˜¯åœ¨ Windows ä¸­, åæ–œæ æ˜¯æ­£å¸¸çš„è·¯å¾„åˆ†éš”ç¬¦, ä¸å±äºè½¬ä¹‰çš„èŒƒç•´, è¿™ç§æƒ…å†µä¸‹å°±éœ€è¦ä½¿ç”¨ä¸¤ä¸ªåæ–œæ  <code>\\</code> æ¥è¡¨ç¤ºä¸€ä¸ªè·¯å¾„ä¸­çš„åæ–œæ  <code>\</code></p>
<p>è½¬ä¹‰å­—ç¬¦æ—¢ç”¨äºè½¬ä¹‰è¡Œä¸­çš„å­—ç¬¦ï¼Œä¹Ÿç”¨äºè½¬ä¹‰æ¢è¡Œç¬¦. è¿™å…è®¸DockerfileæŒ‡ä»¤è·¨è¶Šå¤šè¡Œ. <strong>æ³¨æ„ï¼Œä¸ç®¡escapeè§£æå™¨æŒ‡ä»¤æ˜¯å¦åŒ…æ‹¬åœ¨Dockerfileä¸­ï¼Œåœ¨RUNå‘½ä»¤ä¸­ä¸æ‰§è¡Œè½¬ä¹‰ï¼Œé™¤éåœ¨è¡Œçš„æœ«å°¾, ç”¨æ¥è½¬ä¹‰æ¢è¡Œç¬¦</strong></p>
<p>è¯·è€ƒè™‘ä»¥ä¸‹ç¤ºä¾‹ï¼Œè¿™å°†åœ¨Windowsä¸Šä»¥éæ˜¾è€Œæ˜“è§çš„æ–¹å¼å¤±è´¥ã€‚ç¬¬äºŒè¡Œæœ«å°¾çš„ç¬¬äºŒä¸ª\å°†è¢«è§£é‡Šä¸ºæ¢è¡Œç¬¦ï¼Œè€Œä¸æ˜¯ä»ç¬¬ä¸€ä¸ª\è½¬ä¹‰çš„ç›®æ ‡ã€‚ç±»ä¼¼åœ°ï¼Œå‡è®¾ç¬¬ä¸‰è¡Œç»“å°¾å¤„çš„\å®é™…ä¸Šä½œä¸ºä¸€æ¡æŒ‡ä»¤å¤„ç†ï¼Œå®ƒå°†è¢«è§†ä¸ºè¡Œç»§ç»­ã€‚è¿™ä¸ªdockerfileçš„ç»“æœæ˜¯ç¬¬äºŒè¡Œå’Œç¬¬ä¸‰è¡Œè¢«è®¤ä¸ºæ˜¯å•ä¸ªæŒ‡ä»¤ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">FROM windowsservercore</span><br><span class="line">COPY testfile.txt c:\\</span><br><span class="line">RUN dir c:\</span><br><span class="line"></span><br><span class="line"># ç»“æœ:</span><br><span class="line">PS C:\John&gt; docker build -t cmd .</span><br><span class="line">Sending build context to Docker daemon 3.072 kB</span><br><span class="line">Step 1 : FROM windowsservercore</span><br><span class="line"> ---&gt; dbfee88ee9fd</span><br><span class="line">Step 2 : COPY testfile.txt c:RUN dir c:</span><br><span class="line">GetFileAttributesEx c:RUN: The system cannot find the file specified.</span><br><span class="line">PS C:\John&gt;</span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°çš„ä¸€ä¸ªè§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨<code>/</code>ä½œä¸º<code>COPY</code>æŒ‡ä»¤å’Œ<code>dir</code>çš„ç›®æ ‡. è¿™ç§è¯­æ³•, æœ€å¥½çš„æƒ…å†µæ˜¯æ··ä¹±, å› ä¸ºå®ƒåœ¨<code>Windows</code>ä¸Šæ˜¯ä¸å¹³å¸¸çš„è·¯å¾„, æœ€åçš„æƒ…å†µä¸‹, é”™è¯¯å€¾å‘, å› ä¸ºå¹¶ä¸æ˜¯<code>Windows</code>ä¸Šçš„æ‰€æœ‰å‘½ä»¤æ”¯æŒ<code>/</code>ä½œä¸ºè·¯å¾„åˆ†éš”ç¬¦.</p>
<p>é€šè¿‡æ·»åŠ è½¬ä¹‰è§£æå™¨æŒ‡ä»¤ï¼Œä¸‹é¢çš„Dockerfileåœ¨Windowsä¸Šä½¿ç”¨æ–‡ä»¶è·¯å¾„çš„è‡ªç„¶å¹³å°è¯­ä¹‰æˆåŠŸï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"># escape&#x3D;&#96;</span><br><span class="line"></span><br><span class="line">FROM windowsservercore</span><br><span class="line">COPY testfile.txt c:\</span><br><span class="line">RUN dir c:\</span><br><span class="line"></span><br><span class="line"># ç»“æœ</span><br><span class="line">PS C:\John&gt; docker build -t succeeds --no-cache&#x3D;true .</span><br><span class="line">Sending build context to Docker daemon 3.072 kB</span><br><span class="line">Step 1 : FROM windowsservercore</span><br><span class="line"> ---&gt; dbfee88ee9fd</span><br><span class="line">Step 2 : COPY testfile.txt c:\</span><br><span class="line"> ---&gt; 99ceb62e90df</span><br><span class="line">Removing intermediate container 62afbe726221</span><br><span class="line">Step 3 : RUN dir c:\</span><br><span class="line"> ---&gt; Running in a5ff53ad6323</span><br><span class="line"> Volume in drive C has no label.</span><br><span class="line"> Volume Serial Number is 1440-27FA</span><br><span class="line"></span><br><span class="line"> Directory of c:\</span><br><span class="line"></span><br><span class="line">03&#x2F;25&#x2F;2016  05:28 AM    &lt;DIR&gt;          inetpub</span><br><span class="line">03&#x2F;25&#x2F;2016  04:22 AM    &lt;DIR&gt;          PerfLogs</span><br><span class="line">04&#x2F;22&#x2F;2016  10:59 PM    &lt;DIR&gt;          Program Files</span><br><span class="line">03&#x2F;25&#x2F;2016  04:22 AM    &lt;DIR&gt;          Program Files (x86)</span><br><span class="line">04&#x2F;18&#x2F;2016  09:26 AM                 4 testfile.txt</span><br><span class="line">04&#x2F;22&#x2F;2016  10:59 PM    &lt;DIR&gt;          Users</span><br><span class="line">04&#x2F;22&#x2F;2016  10:59 PM    &lt;DIR&gt;          Windows</span><br><span class="line">               1 File(s)              4 bytes</span><br><span class="line">               6 Dir(s)  21,252,689,920 bytes free</span><br><span class="line"> ---&gt; 2569aa19abef</span><br><span class="line">Removing intermediate container a5ff53ad6323</span><br><span class="line">Successfully built 2569aa19abef</span><br><span class="line">PS C:\John&gt;</span><br></pre></td></tr></table></figure>

<h1 id="ENV-ç¯å¢ƒå˜é‡æ›¿æ¢"><a href="#ENV-ç¯å¢ƒå˜é‡æ›¿æ¢" class="headerlink" title="ENV ç¯å¢ƒå˜é‡æ›¿æ¢"></a>ENV ç¯å¢ƒå˜é‡æ›¿æ¢</h1><p>ç¯å¢ƒå˜é‡ä½¿ç”¨<code>ENV</code>å‘½ä»¤å£°æ˜, ä½¿ç”¨<code>$variable_name</code>æˆ–<code>${variable_name}</code>æ¥è°ƒç”¨, å¸¦å¤§æ‹¬å·çš„è¯­æ³•æ˜¯è¢«ç”¨æ¥è§£å†³ä¸å¸¦ç©ºæ ¼çš„å˜é‡åå­—é—®é¢˜, ä¾‹å¦‚:<code>${foo}_bar</code></p>
<p><code>${variable_name}</code>è¯­æ³•è¿˜æ”¯æŒä»¥ä¸‹æŒ‡å®šçš„ä¸€äº›æ ‡å‡†bashä¿®é¥°ç¬¦ï¼š</p>
<ul>
<li><code>${variable:-word}</code>è¡¨ç¤ºå¦‚æœè®¾ç½®äº†<code>variable</code>, åˆ™ç»“æœå°†æ˜¯è¯¥å€¼; å¦‚æœ<code>variable</code>æœªè®¾ç½®, é‚£ä¹ˆwordå°†æ˜¯ç»“æœ</li>
<li><code>${variable:+word}</code>è¡¨ç¤ºå¦‚æœè®¾ç½®äº†<code>variable</code>, é‚£ä¹ˆ<code>word</code>å°†æ˜¯ç»“æœ, å¦åˆ™ç»“æœæ˜¯ç©ºå­—ç¬¦ä¸²</li>
</ul>
<p>åœ¨æ‰€æœ‰æƒ…å†µä¸‹, <code>word</code>å¯ä»¥æ˜¯ä»»ä½•å­—ç¬¦ä¸², åŒ…æ‹¬é¢å¤–çš„ç¯å¢ƒå˜é‡</p>
<p>å¯ä»¥é€šè¿‡åœ¨å˜é‡ä¹‹å‰æ·»åŠ <code>\</code>æ¥è½¬ä¹‰: <code>\$foo</code>æˆ–<code>\${foo}</code>, åˆ†åˆ«è½¬æ¢ä¸º<code>$foo</code>å’Œ<code>${foo}</code></p>
<p>ç¤ºä¾‹ï¼ˆè§£æçš„è¡¨ç¤ºæ˜¾ç¤ºåœ¨#åé¢ï¼‰ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">FROM busybox</span><br><span class="line">ENV foo &#x2F;bar</span><br><span class="line">WORKDIR $&#123;foo&#125;   # WORKDIR &#x2F;bar</span><br><span class="line">ADD . $foo       # ADD . &#x2F;bar</span><br><span class="line">COPY \$foo &#x2F;quux # COPY $foo &#x2F;quux</span><br></pre></td></tr></table></figure>

<p>Dockerfileä¸­çš„ä»¥ä¸‹æŒ‡ä»¤åˆ—è¡¨æ”¯æŒç¯å¢ƒå˜é‡ï¼š</p>
<ul>
<li>ADD</li>
<li>COPY</li>
<li>ENV</li>
<li>EXPOSE</li>
<li>LABEL</li>
<li>USER</li>
<li>WORKDIR</li>
<li>VOLUME</li>
<li>STOPSIGNAL</li>
</ul>
<p>ä»¥åŠï¼š</p>
<ul>
<li>ONBUILDï¼ˆå½“ä¸ä¸Šé¢æ”¯æŒçš„æŒ‡ä»¤ä¹‹ä¸€ç»„åˆæ—¶ï¼‰</li>
</ul>
<p><strong>æ³¨æ„: åœ¨1.4ä¹‹å‰, ONBUILDæŒ‡ä»¤ä¸æ”¯æŒç¯å¢ƒå˜é‡, å³ä½¿ä¸ä¸Šé¢åˆ—å‡ºçš„ä»»ä½•æŒ‡ä»¤ç›¸ç»“åˆ</strong></p>
<p>åœ¨<code>ENV</code>çš„ä½¿ç”¨ä¸­, è¦ç‰¹åˆ«æ³¨æ„ä»¥ä¸‹æƒ…å†µ:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ENV abc&#x3D;hello</span><br><span class="line">ENV abc&#x3D;bye def&#x3D;$abc</span><br><span class="line">ENV ghi&#x3D;$abc</span><br></pre></td></tr></table></figure>

<p>æœ€ç»ˆçš„ç»“æœä¸º:</p>
<ul>
<li>def çš„å€¼ä¸º hello</li>
<li>ghi çš„å€¼ä¸º bye</li>
</ul>
<p>ä¸ºä»€ä¹ˆ<code>def</code>çš„å€¼ä¸æ˜¯<code>bye</code>å‘¢? å› ä¸ºç¬¬ä¸€è¡Œè®¾ç½®<code>abc</code>å˜é‡çš„å€¼ä¸º<code>hello</code>å, åˆ°ç¬¬äºŒè¡Œæ‰§è¡Œçš„æ—¶å€™, é¦–å…ˆè¿›è¡Œå˜é‡çš„æ¸²æŸ“(æ›¿æ¢), ç„¶åå†æ‰§è¡Œç¯å¢ƒå˜é‡çš„è®¾ç½®</p>
<h1 id="dockerignore"><a href="#dockerignore" class="headerlink" title=".dockerignore"></a>.dockerignore</h1><p>dockeræ‰§è¡Œæ„å»ºå, ä¼šé¦–å…ˆå»æ ¹ç›®å½•ä¸­æŸ¥æ‰¾<code>.dockerignore</code>æ–‡ä»¶, ç”±äºåœ¨æ„å»ºçš„æ—¶å€™, docker ä¼šé€’å½’ç´¢å¼•å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶, ä¸ºäº†é¿å…ç´¢å¼•ä¸å¿…è¦çš„ç›®å½•, å¯ä»¥ä½¿ç”¨<code>.dockerignore</code>æ–‡ä»¶å£°æ˜ä¸éœ€è¦ç´¢å¼•çš„ç›®å½•</p>
<ul>
<li><code>#</code> æ³¨é‡Š</li>
<li><code>*</code> ä»»æ„å¤šä¸ªå­—ç¬¦</li>
<li><code>?</code> ä»»æ„ä¸€ä¸ªå­—ç¬¦</li>
<li><code>!</code> å¼‚å¸¸æ¨¡å¼, ç”¨äºæ’é™¤ä¾‹å¤–</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># comment</span><br><span class="line">    *&#x2F;temp*</span><br><span class="line">    *&#x2F;*&#x2F;temp*</span><br><span class="line">    temp?</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">*.md</span><br><span class="line">!README.md</span><br></pre></td></tr></table></figure>

<h1 id="FORM"><a href="#FORM" class="headerlink" title="FORM"></a>FORM</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">FROM &lt;image&gt;</span><br><span class="line"># æˆ–åˆ™</span><br><span class="line">FROM &lt;image&gt;:&lt;tag&gt;</span><br><span class="line"># æˆ–åˆ™</span><br><span class="line">FROM &lt;image&gt;@&lt;digest&gt;</span><br></pre></td></tr></table></figure>

<p><code>FROM</code>æŒ‡ä»¤ä¸ºåç»­æŒ‡ä»¤è®¾ç½®Base Image. å› æ­¤, æœ‰æ•ˆçš„Dockerfileå¿…é¡»å…·æœ‰<code>FROM</code>ä½œä¸ºå…¶ç¬¬ä¸€æ¡æŒ‡ä»¤. imageå¯ä»¥æ˜¯ä»»ä½•æœ‰æ•ˆçš„image, å¯ä»¥ä»é•œåƒä»“åº“ä¸­æ‹‰å–é•œåƒ.</p>
<ul>
<li>FROMå¿…é¡»æ˜¯Dockerfileä¸­çš„ç¬¬ä¸€ä¸ªéæ³¨é‡ŠæŒ‡ä»¤</li>
<li>FROMå¯ä»¥åœ¨å•ä¸ªDockerfileä¸­å¤šæ¬¡å‡ºç°ï¼Œä»¥åˆ›å»ºå¤šä¸ªé•œåƒã€‚æ¯ä¸ªæ–°çš„FROMå‘½ä»¤ä¹‹å‰ä¼šè¾“å‡ºæœ€ä¸€ä¸ªimage ID</li>
<li>tagæˆ–digestæ˜¯å¯é€‰çš„. å¦‚æœçœç•¥å…¶ä¸­ä»»ä½•ä¸€ä¸ª, æ„å»ºå™¨å°†é»˜è®¤ä½¿ç”¨latest. å¦‚æœæ„å»ºå™¨ä¸tagå€¼ä¸åŒ¹é…, åˆ™æ„å»ºå™¨å°†è¿”å›é”™è¯¯</li>
</ul>
<h1 id="RUN"><a href="#RUN" class="headerlink" title="RUN"></a>RUN</h1><p>RUN æŒ‡ä»¤æœ‰ä¸¤ç§è¿è¡Œæ–¹å¼:</p>
<ul>
<li>RUN <command> (shell form, the command is run in a shell, which by default is /bin/sh -c on Linux or cmd /S /C on Windows)</li>
<li>RUN [â€œexecutableâ€, â€œparam1â€, â€œparam2â€] (exec form)</li>
</ul>
<p><code>RUN</code>æŒ‡ä»¤å°†åœ¨å½“å‰imageä¹‹ä¸Šçš„æ–°å±‚ä¸­æ‰§è¡Œä»»ä½•å‘½ä»¤, å¹¶æäº¤ç»“æœ. ç”Ÿæˆçš„å·²æäº¤imageå°†ç”¨äºDockerfileä¸­çš„ä¸‹ä¸€æ­¥</p>
<p>execå½¢å¼ä½¿å¾—å¯ä»¥é¿å…shellå­—ç¬¦ä¸²å˜åŒ–, ä»¥åŠä½¿ç”¨ä¸åŒ…å«æŒ‡å®šçš„shellå¯æ‰§è¡Œæ–‡ä»¶çš„åŸºæœ¬imageæ¥è¿è¡ŒRUNå‘½ä»¤</p>
<p>åœ¨shellå½¢å¼ä¸­ï¼Œå¯ä»¥ä½¿ç”¨\ï¼ˆåæ–œæ ï¼‰å°†å•ä¸ªRUNæŒ‡ä»¤ç»§ç»­åˆ°ä¸‹ä¸€è¡Œ, è¿™ä¹Ÿæ˜¯å¤§éƒ¨åˆ† dockerfile ä½¿ç”¨çš„å½¢å¼</p>
<p>åœ¨<code>RUN</code>å‘½ä»¤çš„ä½¿ç”¨ä¸­, éœ€è¦æ³¨æ„ä¸€ä¸‹å‡ ç‚¹:</p>
<ul>
<li>è¦ä½¿ç”¨ä¸åŒçš„shellï¼Œè€Œä¸æ˜¯â€™/bin/shâ€™ï¼Œè¯·ä½¿ç”¨åœ¨æ‰€éœ€shellä¸­ä¼ é€’çš„execå½¢å¼ã€‚ä¾‹å¦‚ï¼ŒRUN [â€œ/bin/bashâ€,â€œ-câ€,â€œecho helloâ€]</li>
<li>execå½¢å¼ä½œä¸ºJSONæ•°ç»„è§£æï¼Œè¿™æ„å‘³ç€ä½ å¿…é¡»åœ¨å•è¯ä¹‹å¤–å¿…é¡»è¦ä½¿ç”¨åŒå¼•å·<code>&quot;</code> è€Œä¸æ˜¯å•å¼•å·<code>&#39;</code></li>
<li>ä¸ shell æ‰§è¡Œçš„æ–¹å¼ä¸åŒ, exec æ‰§è¡Œæ–¹å¼ä¸è°ƒç”¨å‘½ä»¤ shell. è¿™æ„å‘³ç€æ­£å¸¸çš„ shell å¤„ç†ä¸ä¼šå‘ç”Ÿ. ä¾‹å¦‚, <code>RUN [&quot;echo&quot;,&quot;$HOME&quot;]</code>ä¸ä¼šåœ¨<code>$HOME</code>ä¸Šè¿›è¡Œå¯å˜æ›¿æ¢. å¦‚æœä½ æƒ³è¦shellå¤„ç†ï¼Œé‚£ä¹ˆä½¿ç”¨shellå½¢å¼æˆ–ç›´æ¥æ‰§è¡Œä¸€ä¸ªshellï¼Œä¾‹å¦‚, <code>RUN [&quot;sh&quot;,&quot;-c&quot;,&quot;echo $HOME&quot;]</code> </li>
<li>åœ¨JSONå½¢å¼ä¸­, æœ‰å¿…è¦è½¬ä¹‰åæ–œæ . è¿™åœ¨Windowsä¸Šç‰¹åˆ«ç›¸å…³, å…¶ä¸­åæ–œæ æ˜¯è·¯å¾„åˆ†éš”ç¬¦. å› ä¸ºä¸æ˜¯æœ‰æ•ˆçš„JSON, å¹¶ä¸”ä»¥æ„å¤–çš„æ–¹å¼å¤±è´¥, ä»¥ä¸‹è¡Œå°†è¢«è§†ä¸ºshellå½¢å¼: <code>RUN [&quot;c:\windows\system32\tasklist.exe&quot;]</code> æ­¤ç¤ºä¾‹çš„æ­£ç¡®è¯­æ³•ä¸º: <code>RUN [&quot;c:\\windows\\system32\\tasklist.exe&quot;]</code></li>
</ul>
<p>ç”¨äº<code>RUN</code>æŒ‡ä»¤çš„é«˜é€Ÿç¼“å­˜åœ¨ä¸‹ä¸€æ¬¡æ„å»ºæœŸé—´ä¸ä¼šè‡ªåŠ¨å¤±æ•ˆ. ç”¨äºè¯¸å¦‚<code>RUN apt-get dist-upgrade</code>ä¹‹ç±»çš„æŒ‡ä»¤çš„é«˜é€Ÿç¼“å­˜å°†åœ¨ä¸‹ä¸€æ¬¡æ„å»ºæœŸé—´è¢«é‡ç”¨. å¯ä»¥é€šè¿‡ä½¿ç”¨<code>--no-cache</code>æ ‡å¿—æ¥ä½¿ç”¨äº<code>RUN</code>æŒ‡ä»¤çš„é«˜é€Ÿç¼“å­˜æ— æ•ˆ, ä¾‹å¦‚ <code>docker build --no-cache</code></p>
<p><strong>Known issuesï¼ˆRUN</strong></p>
<p>Issue 783æ˜¯å…³äºåœ¨ä½¿ç”¨AUFSæ–‡ä»¶ç³»ç»Ÿæ—¶å¯èƒ½å‘ç”Ÿçš„æ–‡ä»¶æƒé™é—®é¢˜ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯èƒ½ä¼šåœ¨å°è¯•rmæ–‡ä»¶æ—¶æ³¨æ„åˆ°å®ƒã€‚å¯¹äºå…·æœ‰æœ€è¿‘aufsç‰ˆæœ¬çš„ç³»ç»Ÿï¼ˆå³ï¼Œå¯ä»¥è®¾ç½®dirperm1å®‰è£…é€‰é¡¹ï¼‰ï¼Œdockerå°†å°è¯•é€šè¿‡ä½¿ç”¨dirperm1é€‰é¡¹å®‰è£…imageæ¥è‡ªåŠ¨è§£å†³é—®é¢˜ã€‚</p>
<h1 id="MAINTAINER-ä½œè€…ä¿¡æ¯-å·²åºŸå¼ƒ"><a href="#MAINTAINER-ä½œè€…ä¿¡æ¯-å·²åºŸå¼ƒ" class="headerlink" title="MAINTAINER ä½œè€…ä¿¡æ¯(å·²åºŸå¼ƒ)"></a>MAINTAINER ä½œè€…ä¿¡æ¯(å·²åºŸå¼ƒ)</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MAINTAINER &lt;name&gt;</span><br></pre></td></tr></table></figure>

<p>MAINTAINERæŒ‡ä»¤å…è®¸æ‚¨è®¾ç½®ç”Ÿæˆçš„imagesçš„ä½œè€…å­—æ®µ</p>
<p>åœ¨æ–°çš„ docker ç‰ˆæœ¬ä¸­, è¯¥æŒ‡ä»¤å°†è¢«<code>LABEL</code>æ›¿ä»£</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LABEL maintainer &quot;SvenDowideit@home.org.au&quot;</span><br></pre></td></tr></table></figure>

<h1 id="CMD"><a href="#CMD" class="headerlink" title="CMD"></a>CMD</h1><p>CMDæŒ‡ä»¤ä¸‰ç§å½¢å¼ï¼š</p>
<ul>
<li>CMD [â€œexecutableâ€,â€param1â€,â€param2â€] (execæ ¼å¼, é¦–é€‰å½¢å¼)</li>
<li>CMD [â€œparam1â€,â€param2â€] (ä½œä¸º ENTRYPOINT æŒ‡ä»¤çš„é»˜è®¤å‚æ•°)</li>
<li>CMD command param1 param2 (shell æ ¼å¼)</li>
</ul>
<p>åœ¨Dockerfileä¸­åªèƒ½æœ‰ä¸€ä¸ª<code>CMD</code>æŒ‡ä»¤. å¦‚æœåˆ—å‡ºäº†å¤šä¸ª<code>CMD</code>, åˆ™åªæœ‰æœ€åä¸€ä¸ª<code>CMD</code>ç”Ÿæ•ˆ</p>
<p><code>CMD</code>çš„ä¸»è¦ç›®çš„æ˜¯ä¸ºæ‰§è¡Œå®¹å™¨æä¾›é»˜è®¤å€¼. è¿™äº›é»˜è®¤å€¼å¯ä»¥åŒ…æ‹¬å¯æ‰§è¡Œæ–‡ä»¶, æˆ–è€…å®ƒä»¬å¯ä»¥çœç•¥å¯æ‰§è¡Œæ–‡ä»¶, åœ¨è¿™ç§æƒ…å†µä¸‹, ä½ è¿˜å¿…é¡»æŒ‡å®š<code>ENTRYPOINT</code>æŒ‡ä»¤</p>
<p>å½“ä»¥shellæˆ–execæ ¼å¼ä½¿ç”¨æ—¶ï¼Œ<code>CMD</code>æŒ‡ä»¤è®¾ç½®è¿è¡Œimageæ—¶è¦æ‰§è¡Œçš„å‘½ä»¤</p>
<p>å¦‚æœä½¿ç”¨CMDçš„shellå½¢å¼ï¼Œé‚£ä¹ˆ<command>å°†åœ¨/bin/sh -cä¸­æ‰§è¡Œï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">FROM ubuntu</span><br><span class="line">CMD echo &quot;This is a test.&quot; | wc -</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½ æƒ³è¿è¡Œä½ çš„<command>æ²¡æœ‰shellï¼Œé‚£ä¹ˆä½ å¿…é¡»å°†è¯¥å‘½ä»¤è¡¨ç¤ºä¸ºä¸€ä¸ªJSONæ•°ç»„ï¼Œå¹¶ç»™å‡ºå¯æ‰§è¡Œæ–‡ä»¶çš„å®Œæ•´è·¯å¾„ã€‚æ­¤æ•°ç»„å½¢å¼æ˜¯CMDçš„é¦–é€‰æ ¼å¼ã€‚ä»»ä½•å…¶ä»–å‚æ•°å¿…é¡»å•ç‹¬è¡¨ç¤ºä¸ºæ•°ç»„ä¸­çš„å­—ç¬¦ä¸²(æ³¨æ„ä½¿ç”¨åŒå¼•å·)ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">FROM ubuntu</span><br><span class="line">CMD [&quot;&#x2F;usr&#x2F;bin&#x2F;wc&quot;,&quot;--help&quot;]</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½ å¸Œæœ›ä½ çš„å®¹å™¨æ¯æ¬¡è¿è¡Œç›¸åŒçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œé‚£ä¹ˆä½ åº”è¯¥è€ƒè™‘ä½¿ç”¨ENTRYPOINTç»“åˆCMD</p>
<p>å¦‚æœç”¨æˆ·æŒ‡å®šdocker runå‚æ•°ï¼Œé‚£ä¹ˆå®ƒä»¬å°†è¦†ç›–CMDä¸­æŒ‡å®šçš„é»˜è®¤å€¼</p>
<p><strong>æ³¨æ„:</strong></p>
<ul>
<li>ä¸è¦å°†RUNå’ŒCMDæ··æ·†. RUNå®é™…ä¸Šè¿è¡Œä¸€ä¸ªå‘½ä»¤å¹¶æäº¤ç»“æœ;CMDåœ¨æ„å»ºæ—¶ä¸æ‰§è¡Œä»»ä½•æ“ä½œ, ä½†æŒ‡å®šäº†imageçš„é¢„æœŸå‘½ä»¤</li>
<li>å¦‚æœä½¿ç”¨CMDä¸ºENTRYPOINTæŒ‡ä»¤æä¾›é»˜è®¤å‚æ•°, CMDå’ŒENTRYPOINTæŒ‡ä»¤éƒ½åº”ä»¥JSONæ•°ç»„æ ¼å¼æŒ‡å®š</li>
<li>execå½¢å¼ä½œä¸ºJSONæ•°ç»„è§£æ, è¿™æ„å‘³ç€æ‚¨å¿…é¡»åœ¨å•è¯ä¹‹å¤–ä½¿ç”¨åŒå¼•å·<code>&quot;</code>è€Œä¸æ˜¯å•å¼•å·<code>&#39;</code></li>
<li>ä¸shellè¡¨å•ä¸åŒ, execè¡¨å•ä¸è°ƒç”¨å‘½ä»¤shell. è¿™æ„å‘³ç€æ­£å¸¸çš„shellå¤„ç†ä¸ä¼šå‘ç”Ÿ. ä¾‹å¦‚, <code>CMD [&quot;echo&quot;ï¼Œ&quot;$HOME&quot;]</code> ä¸ä¼šåœ¨<code>$HOME</code>ä¸Šè¿›è¡Œå¯å˜æ›¿æ¢. å¦‚æœä½ æƒ³è¦shellå¤„ç†, é‚£ä¹ˆä½¿ç”¨shellå½¢å¼æˆ–ç›´æ¥æ‰§è¡Œä¸€ä¸ªshell, ä¾‹å¦‚: <code>CMD [&quot;sh&quot;,&quot;-c&quot;,&quot;echo $HOME&quot;]</code></li>
</ul>
<h1 id="LABEL"><a href="#LABEL" class="headerlink" title="LABEL"></a>LABEL</h1><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">LABEL</span><span class="bash"> &lt;key&gt;=&lt;value&gt; &lt;key&gt;=&lt;value&gt; &lt;key&gt;=&lt;value&gt; ...</span></span><br><span class="line">æˆ–</span><br><span class="line"><span class="keyword">LABEL</span><span class="bash"> &lt;key&gt;=&lt;value&gt;</span></span><br><span class="line"><span class="keyword">LABEL</span><span class="bash"> &lt;key&gt;=&lt;value&gt;</span></span><br><span class="line"><span class="keyword">LABEL</span><span class="bash"> &lt;key&gt;=&lt;value&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>LABEL</code> æŒ‡ä»¤å‘imageæ·»åŠ å…ƒæ•°æ®. LABELæ˜¯é”®å€¼å¯¹. è¦åœ¨LABELå€¼ä¸­åŒ…å«ç©ºæ ¼, éœ€è¦ä½¿ç”¨å¼•å·å’Œåæ–œæ , å°±åƒåœ¨å‘½ä»¤è¡Œè§£æä¸­ä¸€æ ·</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">LABEL</span><span class="bash"> <span class="string">"com.example.vendor"</span>=<span class="string">"ACME Incorporated"</span></span></span><br><span class="line"><span class="keyword">LABEL</span><span class="bash"> com.example.label-with-value=<span class="string">"foo"</span></span></span><br><span class="line"><span class="keyword">LABEL</span><span class="bash"> version=<span class="string">"1.0"</span></span></span><br><span class="line"><span class="keyword">LABEL</span><span class="bash"> description=<span class="string">"This text illustrates \</span></span></span><br><span class="line"><span class="bash">that label-values can span multiple lines.<span class="string">"</span></span></span><br></pre></td></tr></table></figure>

<p>ä¸€ä¸ª<code>image</code>å¯ä»¥æœ‰å¤šä¸ª<code>label</code>. è¦æŒ‡å®šå¤šä¸ª<code>label</code>, Dockerå»ºè®®åœ¨å¯èƒ½çš„æƒ…å†µä¸‹å°†æ ‡ç­¾åˆå¹¶åˆ°å•ä¸ª<code>LABEL</code>æŒ‡ä»¤ä¸­. æ¯ä¸ª<code>LABEL</code>æŒ‡ä»¤äº§ç”Ÿä¸€ä¸ªæ–°å±‚, å¦‚æœä½¿ç”¨è®¸å¤šæ ‡ç­¾, å¯èƒ½ä¼šå¯¼è‡´é•œåƒçš„æ•ˆç‡ä½ä¸‹. è¯¥ç¤ºä¾‹äº§ç”Ÿå•ä¸ªé•œåƒå±‚</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">LABEL</span><span class="bash"> multi.label1=<span class="string">"value1"</span> multi.label2=<span class="string">"value2"</span> other=<span class="string">"value3"</span></span></span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„ä¹Ÿå¯å†™ä¸ºï¼š</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">LABEL</span><span class="bash"> multi.label1=<span class="string">"value1"</span> \</span></span><br><span class="line"><span class="bash">      multi.label2=<span class="string">"value2"</span> \</span></span><br><span class="line"><span class="bash">      other=<span class="string">"value3"</span></span></span><br></pre></td></tr></table></figure>

<p><strong>å¦‚æœDockeré‡åˆ°å·²ç»å­˜åœ¨çš„label/keyï¼Œåˆ™æ–°å€¼å°†è¦†ç›–å…·æœ‰ç›¸åŒé”®çš„ä»»ä½•å…ˆå‰æ ‡ç­¾</strong></p>
<h1 id="EXPOSE"><a href="#EXPOSE" class="headerlink" title="EXPOSE"></a>EXPOSE</h1><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">EXPOSE</span> &lt;port&gt; [&lt;port&gt;...]</span><br></pre></td></tr></table></figure>

<p><code>EXPOSE</code>æŒ‡ä»¤é€šçŸ¥Dockerå®¹å™¨åœ¨è¿è¡Œæ—¶ç›‘å¬æŒ‡å®šçš„ç½‘ç»œç«¯å£. <code>EXPOSE</code>ä¸ä½¿ä¸»æœºçš„å®¹å™¨çš„ç«¯å£å¯è®¿é—®, ä¸ºæ­¤, å¿…é¡»ä½¿ç”¨<code>-p</code>æ ‡å¿—å‘å¸ƒä¸€ç³»åˆ—ç«¯å£, æˆ–è€…ä½¿ç”¨<code>-P</code>æ ‡å¿—å‘å¸ƒæ‰€æœ‰æš´éœ²çš„ç«¯å£ã€‚å¯ä»¥å…¬å¼€ä¸€ä¸ªç«¯å£å·ï¼Œå¹¶ç”¨å¦ä¸€ä¸ªç«¯å£å·åœ¨å¤–éƒ¨å‘å¸ƒ</p>
<p>è¿™é‡ŒæŒ‡å®šçš„æ‰€æœ‰ç«¯å£éƒ½æ˜¯å®¹å™¨å†…éƒ¨å£°æ˜å®¹å™¨è¿è¡Œåè¦ç›‘å¬çš„ç«¯å£, ä¸èƒ½åœ¨è¿™é‡Œå®šä¹‰å®¿ä¸»æœºä¸å®¹å™¨ä¹‹é—´ç«¯å£çš„å¯¹åº”å…³ç³»! æ¯”å¦‚ä¸€ä¸ª nginx çš„é•œåƒ, å†…éƒ¨ç›‘å¬80ç«¯å£, åœ¨å®¹å™¨è¿è¡Œä¹‹å, ä½ æƒ³æ˜ å°„åˆ°8080ç«¯å£, æ­¤æ—¶åœ¨ dockerfile ä¸­å†™ 8080:80 æ˜¯æ²¡æœ‰ä»»ä½•æ„ä¹‰çš„, é•œåƒ(dockerfile)é‡Œçš„å£°æ˜çš„ç«¯å£ä¸å®¹å™¨è¿è¡ŒæŒ‡å®šçš„ç«¯å£æ˜¯åˆ†å¼€çš„, ä¸èƒ½åœ¨ dockerfile ä¸­æŒ‡å®šæœªæ¥å®¹å™¨è¿è¡Œæ—¶æ˜ å°„çš„ç«¯å£</p>
<h1 id="ENV"><a href="#ENV" class="headerlink" title="ENV"></a>ENV</h1><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ENV</span> &lt;key&gt; &lt;value&gt;</span><br><span class="line"><span class="keyword">ENV</span> &lt;key&gt;=&lt;value&gt; ... (é¦–é€‰å½¢å¼)</span><br></pre></td></tr></table></figure>

<ul>
<li>ç¬¬ä¸€ç§å½¢å¼åªèƒ½è®¾ç½®ä¸€ä¸ªç¯å¢ƒå˜é‡</li>
<li>ç¬¬äºŒç§å½¢å¼å¯ä»¥åœ¨ä¸€ä¸ªé«˜é€Ÿç¼“å­˜å±‚ä¸­è®¾ç½®å¤šä¸ªå˜é‡, å³ä½¿æ˜¯ä¸€ä¸ªå˜é‡è¦è®¾ç½®ä¹Ÿæ¨èä½¿ç”¨è¿™ç§æ¨¡å¼æ¥è®¾ç½®</li>
</ul>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ENV</span> myName=<span class="string">"John Doe"</span> myDog=Rex\ The\ Dog \</span><br><span class="line">    myCat=fluffy</span><br><span class="line"><span class="comment"># å’Œ</span></span><br><span class="line"><span class="keyword">ENV</span> myName John Doe</span><br><span class="line"><span class="keyword">ENV</span> myDog Rex The Dog</span><br><span class="line"><span class="keyword">ENV</span> myCat fluffy</span><br></pre></td></tr></table></figure>

<p>å°†åœ¨æœ€ç»ˆå®¹å™¨ä¸­äº§ç”Ÿç›¸åŒçš„ç»“æœï¼Œä½†ç¬¬ä¸€ç§å½¢å¼æ˜¯ä¼˜é€‰çš„ï¼Œå› ä¸ºå®ƒäº§ç”Ÿå•ä¸ªé«˜é€Ÿç¼“å­˜å±‚</p>
<h1 id="ADD"><a href="#ADD" class="headerlink" title="ADD"></a>ADD</h1><p>ä¸¤ç§å½¢å¼ï¼š</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ADD</span><span class="bash"> &lt;src&gt;... &lt;dest&gt;</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> [<span class="string">"&lt;src&gt;"</span>,... <span class="string">"&lt;dest&gt;"</span>] (å¯¹äºåŒ…å«ç©ºæ ¼çš„è·¯å¾„ï¼Œæ­¤å½¢å¼æ˜¯å¿…éœ€çš„)</span></span><br></pre></td></tr></table></figure>

<p><code>ADD</code> æŒ‡ä»¤ä»<src>å¤åˆ¶æ–°æ–‡ä»¶, ç›®å½•æˆ–è¿œç¨‹æ–‡ä»¶<code>URL</code>, å¹¶å°†å®ƒä»¬æ·»åŠ åˆ°å®¹å™¨çš„æ–‡ä»¶ç³»ç»Ÿ, è·¯å¾„<dest></p>
<p>å¯ä»¥æŒ‡å®šå¤šä¸ª<src>èµ„æº, ä½†å¦‚æœå®ƒä»¬æ˜¯æ–‡ä»¶æˆ–ç›®å½•, é‚£ä¹ˆå®ƒä»¬å¿…é¡»æ˜¯ç›¸å¯¹äºæ­£åœ¨æ„å»ºçš„æºç›®å½•</p>
<p>æ¯ä¸ª<src>å¯èƒ½åŒ…å«é€šé…ç¬¦, åŒ¹é…å°†ä½¿ç”¨Goçš„filepath.Matchè§„åˆ™å®Œæˆ. ä¾‹å¦‚ï¼š</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ADD</span><span class="bash"> hom* /mydir/        <span class="comment"># adds all files starting with "hom"</span></span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> hom?.txt /mydir/    <span class="comment"># ? is replaced with any single character, e.g., "home.txt"</span></span></span><br></pre></td></tr></table></figure>

<p><dest>æ˜¯ç»å¯¹è·¯å¾„æˆ–ç›¸å¯¹äº<code>WORKDIR</code>çš„è·¯å¾„, æºå°†åœ¨ç›®æ ‡å®¹å™¨ä¸­å¤åˆ¶åˆ°å…¶ä¸­</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ADD</span><span class="bash"> <span class="built_in">test</span> relativeDir/          <span class="comment"># adds "test" to `WORKDIR`/relativeDir/</span></span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> <span class="built_in">test</span> /absoluteDir/         <span class="comment"># adds "test" to /absoluteDir/</span></span></span><br></pre></td></tr></table></figure>

<p>æ‰€æœ‰æ–°æ–‡ä»¶å’Œç›®å½•éƒ½ä½¿ç”¨UIDå’ŒGIDä¸º0åˆ›å»º</p>
<p><strong>ADDéµå®ˆä»¥ä¸‹è§„åˆ™ï¼š</strong></p>
<ul>
<li><p><src>è·¯å¾„å¿…é¡»åœ¨æ„å»ºçš„ä¸Šä¸‹æ–‡ä¸­, ä¸èƒ½<code>ADD ../something /something</code> å› ä¸ºdockeræ„å»ºçš„ç¬¬ä¸€æ­¥æ˜¯å‘é€ä¸Šä¸‹æ–‡ç›®å½•ï¼ˆå’Œå­ç›®å½•ï¼‰åˆ°dockerå®ˆæŠ¤è¿›ç¨‹. </p>
</li>
<li><p>å¦‚æœ<src>æ˜¯URLå¹¶ä¸”<dest>ä¸ä»¥å°¾éƒ¨æ–œæ ç»“å°¾ï¼Œåˆ™ä»URLä¸‹è½½æ–‡ä»¶å¹¶å°†å…¶å¤åˆ¶åˆ°<dest></p>
</li>
<li><p>å¦‚æœ<src>æ˜¯URLå¹¶ä¸”<dest>ä»¥å°¾éƒ¨æ–œæ ç»“å°¾ï¼Œåˆ™ä»URLä¸­æ¨æ–­æ–‡ä»¶åï¼Œå¹¶å°†æ–‡ä»¶ä¸‹è½½åˆ°<dest>/<filename> ä¾‹å¦‚, <code>ADD http://example.com/foobar /</code>ä¼šåˆ›å»ºæ–‡ä»¶<code>/foobar</code> ç½‘å€å¿…é¡»æœ‰ä¸€ä¸ªéæ™®é€šçš„è·¯å¾„, ä»¥ä¾¿åœ¨è¿™ç§æƒ…å†µä¸‹å¯ä»¥å‘ç°ä¸€ä¸ªé€‚å½“çš„æ–‡ä»¶å<code>http://example.comä¸ä¼šå·¥ä½œ</code></p>
</li>
<li><p>å¦‚æœ<src>æ˜¯ç›®å½•, åˆ™å¤åˆ¶ç›®å½•çš„æ•´ä¸ªå†…å®¹, åŒ…æ‹¬æ–‡ä»¶ç³»ç»Ÿå…ƒæ•°æ®<br><strong>æ³¨æ„ï¼šç›®å½•æœ¬èº«ä¸è¢«å¤åˆ¶ï¼Œåªæ˜¯å…¶å†…å®¹</strong></p>
</li>
<li><p>å¦‚æœ<src>æ˜¯è¯†åˆ«çš„å‹ç¼©æ ¼å¼ï¼ˆidentityï¼Œgzipï¼Œbzip2æˆ–xzï¼‰çš„æœ¬åœ°tarå­˜æ¡£ï¼Œåˆ™å°†å…¶è§£åŒ…ä¸ºç›®å½•. æ¥è‡ªè¿œç¨‹URLçš„èµ„æºä¸ä¼šè§£å‹ç¼©. å½“ç›®å½•è¢«å¤åˆ¶æˆ–è§£å‹ç¼©æ—¶, å®ƒå…·æœ‰ä¸tar -xç›¸åŒçš„è¡Œä¸º<br><strong>æ³¨æ„ï¼šæ–‡ä»¶æ˜¯å¦è¢«è¯†åˆ«ä¸ºè¯†åˆ«çš„å‹ç¼©æ ¼å¼, ä»…åŸºäºæ–‡ä»¶çš„å†…å®¹, è€Œä¸æ˜¯æ–‡ä»¶çš„åç§°. ä¾‹å¦‚, å¦‚æœä¸€ä¸ªç©ºæ–‡ä»¶ä»¥<code>.tar.gz</code>ç»“å°¾, åˆ™ä¸ä¼šè¢«è¯†åˆ«ä¸ºå‹ç¼©æ–‡ä»¶, å¹¶ä¸”ä¸ä¼šç”Ÿæˆä»»ä½•è§£å‹ç¼©é”™è¯¯æ¶ˆæ¯, è€Œæ˜¯å°†è¯¥æ–‡ä»¶ç®€å•åœ°å¤åˆ¶åˆ°ç›®çš„åœ°</strong></p>
</li>
<li><p>å¦‚æœ<src>æ˜¯ä»»ä½•å…¶ä»–ç±»å‹çš„æ–‡ä»¶, å®ƒä¼šä¸å…¶å…ƒæ•°æ®ä¸€èµ·å•ç‹¬å¤åˆ¶. åœ¨è¿™ç§æƒ…å†µä¸‹, å¦‚æœ<dest>ä»¥å°¾éƒ¨æ–œæ <code>/</code>ç»“å°¾ï¼Œå®ƒå°†è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªç›®å½•, å¹¶ä¸”<src>çš„å†…å®¹å°†è¢«å†™åœ¨<dest>/base(<src>)</p>
</li>
<li><p>å¦‚æœç›´æ¥æˆ–ç”±äºä½¿ç”¨é€šé…ç¬¦æŒ‡å®šäº†å¤šä¸ª<src>èµ„æº, åˆ™<dest>å¿…é¡»æ˜¯ç›®å½•, å¹¶ä¸”å¿…é¡»ä»¥æ–œæ <code>/</code>ç»“å°¾</p>
</li>
<li><p>å¦‚æœ<dest>ä¸ä»¥å°¾éƒ¨æ–œæ ç»“å°¾ï¼Œå®ƒå°†è¢«è§†ä¸ºå¸¸è§„æ–‡ä»¶ï¼Œ<src>çš„å†…å®¹å°†å†™åœ¨<dest></p>
</li>
<li><p>å¦‚æœ<dest>ä¸å­˜åœ¨, åˆ™ä¼šä¸å…¶è·¯å¾„ä¸­çš„æ‰€æœ‰ç¼ºå°‘çš„ç›®å½•ä¸€èµ·åˆ›å»º</p>
</li>
</ul>
<h1 id="COPY"><a href="#COPY" class="headerlink" title="COPY"></a>COPY</h1><p>ä¸¤ç§å½¢å¼ï¼š</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">COPY</span><span class="bash"> &lt;src&gt;... &lt;dest&gt;</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> [<span class="string">"&lt;src&gt;"</span>,... <span class="string">"&lt;dest&gt;"</span>] (this form is required <span class="keyword">for</span> paths containing whitespace)</span></span><br></pre></td></tr></table></figure>

<p>åŸºæœ¬å’ŒADDç±»ä¼¼ï¼Œä¸è¿‡COPYçš„<src>ä¸èƒ½ä¸ºURL</p>
<p>ä¸ ADD ä¸åŒçš„ä¸€ç‚¹æ˜¯, é‡åˆ°å‹ç¼©æ–‡ä»¶, COPY ä¸ä¼šå»æ£€æµ‹æ–‡ä»¶çš„å‹ç¼©å±æ€§, ä¸ä¼šåšä»»ä½•çš„è§£å‹ç¼©æ“ä½œ, ä¼šç›´æ¥æŠŠæºæ–‡ä»¶åŸå°ä¸åŠ¨çš„æ‹·è´åˆ°ç›®æ ‡åœ°å€</p>
<h1 id="ENTRYPOINT"><a href="#ENTRYPOINT" class="headerlink" title="ENTRYPOINT"></a>ENTRYPOINT</h1><p>ä¸¤ç§å½¢å¼ï¼š</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> [â€œexecutableâ€, â€œparam1â€, â€œparam2â€] ï¼ˆ<span class="built_in">exec</span> å½¢å¼, é¦–é€‰ï¼‰</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> <span class="built_in">command</span> param1 param2 (shell å½¢å¼)</span></span><br></pre></td></tr></table></figure>

<p><code>ENTRYPOINT</code>å…è®¸æ‚¨é…ç½®å®¹å™¨, è¿è¡Œæ‰§è¡Œçš„å¯æ‰§è¡Œæ–‡ä»¶</p>
<p>ä¾‹å¦‚, ä»¥ä¸‹å°†ä½¿ç”¨å…¶é»˜è®¤å†…å®¹å¯åŠ¨nginx, ç›‘å¬ç«¯å£80ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -i -t --rm -p 80:80 nginx</span><br></pre></td></tr></table></figure>

<p><code>docker run &lt;image&gt;</code>çš„å‘½ä»¤è¡Œå‚æ•°å°†é™„è·Ÿåœ¨ exec å½¢å¼çš„<code>ENTRYPOINT</code>ä¸­çš„æ‰€æœ‰å…ƒç´ ä¹‹å, å¹¶å°†è¦†ç›–ä½¿ç”¨<code>CMD</code>æŒ‡å®šçš„æ‰€æœ‰å…ƒç´ . è¿™å…è®¸å°†å‚æ•°ä¼ é€’åˆ°å…¥å£ç‚¹, å³<code>docker run &lt;image&gt; -d</code>å°†æŠŠ<code>-d</code>å‚æ•°ä¼ é€’ç»™å…¥å£ç‚¹. æ‚¨å¯ä»¥ä½¿ç”¨<code>docker run --entrypoint</code>æ ‡å¿—è¦†ç›–<code>ENTRYPOINT</code>æŒ‡ä»¤</p>
<p>shell å½¢å¼é˜²æ­¢ä½¿ç”¨ä»»ä½•<code>CMD</code>æˆ–è¿è¡Œå‘½ä»¤è¡Œå‚æ•°, ä½†æ˜¯ç¼ºç‚¹æ˜¯<code>ENTRYPOINT</code>å°†ä½œ<code>/bin/sh -c</code>çš„å­å‘½ä»¤å¯åŠ¨, å®ƒä¸ä¼ é€’ä¿¡å·. è¿™æ„å‘³ç€å¯æ‰§è¡Œæ–‡ä»¶å°†ä¸æ˜¯å®¹å™¨çš„<code>PID 1</code>, å¹¶ä¸”ä¸ä¼šæ¥æ”¶<code>Unix</code>ä¿¡å·, å› æ­¤ä½ çš„å¯æ‰§è¡Œæ–‡ä»¶å°†ä¸ä¼šä»<code>docker stop &lt;container&gt;</code>æ¥æ”¶åˆ°<code>SIGTERM</code></p>
<p>åªæœ‰Dockerfileä¸­æœ€åä¸€ä¸ª<code>ENTRYPOINT</code>æŒ‡ä»¤ä¼šæœ‰æ•ˆæœ</p>
<h2 id="Exec-form-ENTRYPOINT-example"><a href="#Exec-form-ENTRYPOINT-example" class="headerlink" title="Exec form ENTRYPOINT example"></a>Exec form ENTRYPOINT example</h2><p>å¯ä»¥ä½¿ç”¨ENTRYPOINTçš„<code>exec</code>å½¢å¼è®¾ç½®ç›¸å½“ç¨³å®šçš„é»˜è®¤å‘½ä»¤å’Œå‚æ•°, ç„¶åä½¿ç”¨ä»»ä¸€å½¢å¼çš„<code>CMD</code>è®¾ç½®æ›´å¯èƒ½æ›´æ”¹çš„å…¶ä»–é»˜è®¤å€¼</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> ubuntu</span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> [<span class="string">"top"</span>, <span class="string">"-b"</span>]</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">"-c"</span>]</span></span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸‹Dockerfileæ˜¾ç¤ºä½¿ç”¨ENTRYPOINTåœ¨å‰å°è¿è¡ŒApache, ä½œä¸ºPID 1</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> debian:stable</span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> apt-get update &amp;&amp; apt-get install -y --force-yes apache2</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">80</span> <span class="number">443</span></span><br><span class="line"><span class="keyword">VOLUME</span><span class="bash"> [<span class="string">"/var/www"</span>, <span class="string">"/var/log/apache2"</span>, <span class="string">"/etc/apache2"</span>]</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> [<span class="string">"/usr/sbin/apache2ctl"</span>, <span class="string">"-D"</span>, <span class="string">"FOREGROUND"</span>]</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœéœ€è¦ä¸ºå•ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ç¼–å†™å¯åŠ¨è„šæœ¬ï¼Œå¯ä»¥ä½¿ç”¨execå’Œgosuå‘½ä»¤ç¡®ä¿æœ€ç»ˆå¯æ‰§è¡Œæ–‡ä»¶æ¥æ”¶åˆ°Unixä¿¡å·ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">set</span> -e</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">"<span class="variable">$1</span>"</span> = <span class="string">'postgres'</span> ]; <span class="keyword">then</span></span><br><span class="line">    chown -R postgres <span class="string">"<span class="variable">$PGDATA</span>"</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> [ -z <span class="string">"<span class="variable">$(ls -A "$PGDATA")</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">        gosu postgres initdb</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">exec</span> gosu postgres <span class="string">"<span class="variable">$@</span>"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exec</span> <span class="string">"<span class="variable">$@</span>"</span></span><br></pre></td></tr></table></figure>

<ul>
<li>set -e : åœ¨è„šæœ¬çš„æ‰§è¡Œä¸­ä»»ä½•ä¸€è¡Œå‡ºç°æ‰§è¡Œå¤±è´¥éƒ½ç«‹å³é€€å‡ºè„šæœ¬</li>
<li>set -eo pipefail : åœ¨ç®¡é“çš„ä½¿ç”¨ä¸­, ä»»æ„ä¸€ä¸ªç¯èŠ‚å‡ºç°é—®é¢˜éƒ½ç«‹å³é€€å‡º</li>
<li>set â€“ postgres â€œ$@â€ : å°†åé¢çš„æ¯ä¸€ä¸ªå€¼ä¾æ¬¡æ”¾å…¥ $1 $2 $3 â€¦</li>
<li>$@ : ä¼ ç»™è„šæœ¬çš„æ‰€æœ‰å‚æ•°çš„åˆ—è¡¨</li>
</ul>
<p>ä¸Šé¢è„šæœ¬çš„æ„æ€æ˜¯, é¦–å…ˆåˆ¤æ–­ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸æ˜¯é¢„æœŸä¸­çš„å¯æ‰§è¡Œå‘½ä»¤, å¦‚æœç¬¬ä¸€ä¸ªå‚æ•°æ˜¯é¢„æœŸä¸­çš„å¯æ‰§è¡Œå‘½ä»¤, é‚£ä¹ˆåé¢å‚æ•°é»˜è®¤å‡ä¸ºç¬¬ä¸€ä¸ª(å‚æ•°)å‘½ä»¤çš„å‚æ•°; å¦‚æœç¬¬ä¸€ä¸ªå‚æ•°ä¸æ˜¯é¢„æœŸä¸­çš„å¯è¡Œæ€§å‘½ä»¤, é‚£ä¹ˆå°±è®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªå…¨æ–°çš„å‘½ä»¤è¦æ‰§è¡Œ, æ‰€ä»¥ä½¿ç”¨<code>exec $@</code>å®Œæ•´åœ°æ‰§è¡Œå‘½ä»¤</p>
<p>å¦‚æœéœ€è¦åœ¨å…³é—­æ—¶è¿›è¡Œä¸€äº›é¢å¤–çš„æ¸…ç†ï¼ˆæˆ–ä¸å…¶ä»–å®¹å™¨é€šä¿¡ï¼‰æˆ–è€…åè°ƒå¤šä¸ªå¯æ‰§è¡Œæ–‡ä»¶, éœ€è¦ç¡®ä¿<code>ENTRYPOINT</code>è„šæœ¬æ¥æ”¶åˆ°Unixä¿¡å·, ä¼ é€’å®ƒä»¬, ç„¶ååšä¸€äº›æ›´å¤šçš„å–„åå·¥ä½œï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"><span class="comment"># Note: I've written this using sh so it works in the busybox container too</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># USE the trap if you need to also do manual cleanup after the service is stopped,</span></span><br><span class="line"><span class="comment">#     or need to start multiple services in the one container</span></span><br><span class="line"><span class="built_in">trap</span> <span class="string">"echo TRAPed signal"</span> HUP INT QUIT TERM</span><br><span class="line"></span><br><span class="line"><span class="comment"># start service in background here</span></span><br><span class="line">/usr/sbin/apachectl start</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"[hit enter key to exit] or run 'docker stop &lt;container&gt;'"</span></span><br><span class="line"><span class="built_in">read</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># stop service and clean up here</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"stopping apache"</span></span><br><span class="line">/usr/sbin/apachectl stop</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"exited <span class="variable">$0</span>"</span></span><br></pre></td></tr></table></figure>

<h2 id="Shell-form-ENTRYPOINT-example"><a href="#Shell-form-ENTRYPOINT-example" class="headerlink" title="Shell form ENTRYPOINT example"></a>Shell form ENTRYPOINT example</h2><p>ä½ å¯ä»¥ä¸º<code>ENTRYPOINT</code>æŒ‡å®šä¸€ä¸ªçº¯å­—ç¬¦ä¸²ï¼Œå®ƒå°†åœ¨<code>/bin/sh -c</code>ä¸­æ‰§è¡Œã€‚è¿™ç§å½¢å¼å°†ä½¿ç”¨shellå¤„ç†æ¥æ›¿æ¢shellç¯å¢ƒå˜é‡ï¼Œå¹¶ä¸”å°†å¿½ç•¥ä»»ä½•<code>CMD</code>æˆ–<code>docker run</code>å‘½ä»¤è¡Œå‚æ•°ã€‚è¦ç¡®ä¿<code>docker stop</code>å°†æ­£ç¡®åœ°æ§åˆ¶<code>ENTRYPOINT</code>å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¿…é¡»ç”¨<code>exec</code>å¯åŠ¨å®ƒï¼š</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> ubuntu</span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> <span class="built_in">exec</span> top -b</span></span><br></pre></td></tr></table></figure>

<p>è¿è¡Œæ­¤imageæ—¶ï¼Œæ‚¨å°†çœ‹åˆ°å•ä¸ª<code>PID 1</code>è¿›ç¨‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -it --rm --name <span class="built_in">test</span> top</span><br><span class="line">Mem: 1704520K used, 352148K free, 0K shrd, 0K buff, 140368121167873K cached</span><br><span class="line">CPU:   5% usr   0% sys   0% nic  94% idle   0% io   0% irq   0% sirq</span><br><span class="line">Load average: 0.08 0.03 0.05 2/98 6</span><br><span class="line">  PID  PPID USER     STAT   VSZ %VSZ %CPU COMMAND</span><br><span class="line">    1     0 root     R     3164   0%   0% top -b</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨<code>docker stop</code>å¯ä»¥å¹²å‡€çš„é€€å‡ºï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ /usr/bin/time docker stop <span class="built_in">test</span></span><br><span class="line"><span class="built_in">test</span></span><br><span class="line">real    0m 0.20s</span><br><span class="line">user    0m 0.02s</span><br><span class="line">sys 0m 0.04s</span><br></pre></td></tr></table></figure>

<p>å¦‚æœå¿˜è®°å°†<code>exec</code>æ·»åŠ åˆ°æ‚¨çš„<code>ENTRYPOINT</code>çš„å¼€å¤´ï¼š</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> ubuntu</span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> top -b</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> --ignored-param1</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åï¼Œä½ å¯ä»¥è¿è¡Œå®ƒï¼ˆç»™å®ƒä¸€ä¸ªåç§°ä¸ºä¸‹ä¸€æ­¥ï¼‰ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -it --name <span class="built_in">test</span> top --ignored-param2</span><br><span class="line">Mem: 1704184K used, 352484K free, 0K shrd, 0K buff, 140621524238337K cached</span><br><span class="line">CPU:   9% usr   2% sys   0% nic  88% idle   0% io   0% irq   0% sirq</span><br><span class="line">Load average: 0.01 0.02 0.05 2/101 7</span><br><span class="line">  PID  PPID USER     STAT   VSZ %VSZ %CPU COMMAND</span><br><span class="line">    1     0 root     S     3168   0%   0% /bin/sh -c top -b cmd cmd2</span><br><span class="line">    7     1 root     R     3164   0%   0% top -b</span><br></pre></td></tr></table></figure>

<p>æ‚¨å¯ä»¥ä»topçš„è¾“å‡ºä¸­çœ‹åˆ°æŒ‡å®šçš„ENTRYPOINTä¸æ˜¯PID 1ã€‚</p>
<p>å¦‚æœä½ è¿è¡Œdockeråœæ­¢æµ‹è¯•ï¼Œå®¹å™¨å°†ä¸ä¼šå®Œå…¨é€€å‡º, è¶…æ—¶ååœæ­¢å‘½ä»¤å°†å¼ºåˆ¶å‘é€SIGKILLï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ docker <span class="built_in">exec</span> -it <span class="built_in">test</span> ps aux</span><br><span class="line">PID   USER     COMMAND</span><br><span class="line">    1 root     /bin/sh -c top -b cmd cmd2</span><br><span class="line">    7 root     top -b</span><br><span class="line">    8 root     ps aux</span><br><span class="line">$ /usr/bin/time docker stop <span class="built_in">test</span></span><br><span class="line"><span class="built_in">test</span></span><br><span class="line">real    0m 10.19s</span><br><span class="line">user    0m 0.04s</span><br><span class="line">sys 0m 0.03s</span><br></pre></td></tr></table></figure>

<h2 id="Understand-how-CMD-and-ENTRYPOINT-interact"><a href="#Understand-how-CMD-and-ENTRYPOINT-interact" class="headerlink" title="Understand how CMD and ENTRYPOINT interact"></a>Understand how CMD and ENTRYPOINT interact</h2><p><code>CMD</code>å’Œ<code>ENTRYPOINT</code>æŒ‡ä»¤å®šä¹‰åœ¨è¿è¡Œå®¹å™¨æ—¶æ‰§è¡Œä»€ä¹ˆå‘½ä»¤, æœ‰å¦‚ä¸‹ä½¿ç”¨è§„åˆ™</p>
<ul>
<li><code>Dockerfile</code>åº”è¯¥è‡³å°‘æŒ‡å®šä¸€ä¸ª<code>CMD</code>æˆ–<code>ENTRYPOINT</code>å‘½ä»¤</li>
<li>å½“ä½¿ç”¨å®¹å™¨ä½œä¸ºå¯æ‰§è¡Œæ–‡ä»¶æ—¶ï¼Œåº”è¯¥å®šä¹‰<code>ENTRYPOINT</code></li>
<li><code>CMD</code>åº”è¯¥ç”¨ä½œå®šä¹‰<code>ENTRYPOINT</code>å‘½ä»¤çš„é»˜è®¤å‚æ•°æˆ–åœ¨å®¹å™¨ä¸­æ‰§è¡Œad-hocå‘½ä»¤çš„ä¸€ç§æ–¹æ³•</li>
<li>å½“è¿è¡Œå¸¦æœ‰æ›¿ä»£å‚æ•°çš„å®¹å™¨æ—¶ï¼Œ<code>CMD</code>å°†è¢«è¦†ç›–</li>
</ul>
<p>ä¸‹è¡¨æ˜¾ç¤ºäº†å¯¹ä¸åŒ<code>ENTRYPOINT</code>/<code>CMD</code>ç»„åˆæ‰§è¡Œçš„å‘½ä»¤ï¼š</p>
<table>
<thead>
<tr>
<th></th>
<th>no ENTRYPOINT</th>
<th>ENTRYPOINT exec_enty p1_entry</th>
<th>ENTRYPOINT [â€œexec_entryâ€,â€œp1_entryâ€]</th>
</tr>
</thead>
<tbody><tr>
<td>No CMD</td>
<td>error, not allowed</td>
<td>/bin/sh -c exec_entry p1_entry</td>
<td>exec_entry p1_entry</td>
</tr>
<tr>
<td>CMD [â€œexec_cmdâ€,â€œp1_cmdâ€]</td>
<td>exec_cmd p1_cmd</td>
<td>/bin/sh -c exec_entry p1_entry exec_cmd p1_cmd</td>
<td>exec_entry p1_entry exec_cmd p1_cmd</td>
</tr>
<tr>
<td>CMD [â€œp1_cmdâ€, â€œp2_cmdâ€]</td>
<td>p1_cmd p2_cmd</td>
<td>/bin/sh -c exec_entry p1_entry p1_cmd p2_cmd</td>
<td>exec_entry p1_entry p1_cmd p2_cmd</td>
</tr>
<tr>
<td>CMD exec_cmd p1_cmd</td>
<td>/bin/sh -c exec_cmd p1_cmd</td>
<td>/bin/sh -c exec_entry p1_entry /bin/sh -c exec_cmd p1_cmd</td>
<td>exec_entry p1_entry /bin/sh -c exec_cmd p1_cmd</td>
</tr>
</tbody></table>
<h1 id="VOLUME"><a href="#VOLUME" class="headerlink" title="VOLUME"></a>VOLUME</h1><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">VOLUME</span><span class="bash"> [<span class="string">"/data"</span>]</span></span><br></pre></td></tr></table></figure>

<p><code>VOLUME</code>æŒ‡ä»¤åˆ›å»ºå…·æœ‰æŒ‡å®šåç§°çš„æŒ‚è½½ç‚¹ï¼Œå¹¶å°†å…¶æ ‡è®°ä¸ºä»æœ¬æœºä¸»æœºæˆ–å…¶ä»–å®¹å™¨ä¿ç•™å¤–éƒ¨æŒ‚è½½çš„å·ã€‚è¯¥å€¼å¯ä»¥æ˜¯JSONæ•°ç»„<code>VOLUME [&quot;/var/log/&quot;]</code>æˆ–å…·æœ‰å¤šä¸ªå‚æ•°çš„çº¯å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚<code>VOLUME /var/log</code>æˆ–<code>VOLUME /var/log /var/db</code></p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> ubuntu</span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> mkdir /myvol</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">echo</span> <span class="string">"hello world"</span> &gt; /myvol/greeting</span></span><br><span class="line"><span class="keyword">VOLUME</span><span class="bash"> /myvol</span></span><br></pre></td></tr></table></figure>

<h1 id="USER"><a href="#USER" class="headerlink" title="USER"></a>USER</h1><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USER</span> daemon</span><br></pre></td></tr></table></figure>

<p><code>USER</code>æŒ‡ä»¤è®¾ç½®è¿è¡Œimageæ—¶ä½¿ç”¨çš„ç”¨æˆ·åæˆ–UID, ä»¥åŠ<code>Dockerfile</code>ä¸­çš„ä»»ä½•RUNï¼Œ<code>CMD</code>å’Œ<code>ENTRYPOINT</code>æŒ‡ä»¤</p>
<h1 id="WORKDIR"><a href="#WORKDIR" class="headerlink" title="WORKDIR"></a>WORKDIR</h1><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> /path/to/workdir</span></span><br></pre></td></tr></table></figure>

<p><code>WORKDIR</code>æŒ‡ä»¤ä¸º<code>Dockerfile</code>ä¸­çš„ä»»ä½•<code>RUN</code>ï¼Œ<code>CMD</code>ï¼Œ<code>ENTRYPOINT</code>ï¼Œ<code>COPY</code>å’Œ<code>ADD</code>æŒ‡ä»¤è®¾ç½®å·¥ä½œç›®å½•ã€‚å¦‚æœ<code>WORKDIR</code>ä¸å­˜åœ¨ï¼Œå®ƒå°†è¢«åˆ›å»ºï¼Œå³ä½¿å®ƒæ²¡æœ‰åœ¨ä»»ä½•åç»­çš„<code>Dockerfile</code>æŒ‡ä»¤ä¸­ä½¿ç”¨</p>
<p>å®ƒå¯ä»¥åœ¨ä¸€ä¸ª<code>Dockerfile</code>ä¸­å¤šæ¬¡ä½¿ç”¨. å¦‚æœæä¾›äº†ç›¸å¯¹è·¯å¾„, å®ƒå°†ç›¸å¯¹äºå…ˆå‰WORKDIRæŒ‡ä»¤çš„è·¯å¾„.  ä¾‹å¦‚:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> /a</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> b</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> c</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">pwd</span></span></span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ä¸ª<code>Dockerfile</code>ä¸­çš„æœ€ç»ˆ<code>pwd</code>å‘½ä»¤çš„è¾“å‡ºæ˜¯<code>/a/b/c</code></p>
<p><code>WORKDIR</code>æŒ‡ä»¤å¯ä»¥è§£æå…ˆå‰ä½¿ç”¨<code>ENV</code>è®¾ç½®çš„ç¯å¢ƒå˜é‡ã€‚æ‚¨åªèƒ½ä½¿ç”¨åœ¨<code>Dockerfile</code>ä¸­æ˜¾å¼è®¾ç½®çš„ç¯å¢ƒå˜é‡.  ä¾‹å¦‚ï¼š</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ENV</span> DIRPATH /path</span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> <span class="variable">$DIRPATH</span>/<span class="variable">$DIRNAME</span></span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">pwd</span></span></span><br></pre></td></tr></table></figure>

<p><code>pwd</code>å‘½ä»¤åœ¨è¯¥<code>Dockerfile</code>ä¸­è¾“å‡ºçš„æœ€åç»“æœæ˜¯<code>/path/$DIRNAME</code></p>
<h1 id="ARG"><a href="#ARG" class="headerlink" title="ARG"></a>ARG</h1><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ARG</span> &lt;name&gt;[=&lt;default value&gt;]</span><br></pre></td></tr></table></figure>

<p><code>ARG</code>æŒ‡ä»¤å®šä¹‰ä¸€ä¸ªå˜é‡, ç”¨æˆ·å¯ä»¥ä½¿ç”¨<code>docker build</code>å‘½ä»¤ä½¿ç”¨<code>--build-arg &lt;varname&gt; = &lt;value&gt;</code>æ ‡å¿—ï¼Œåœ¨æ„å»ºæ—¶å°†å…¶ä¼ é€’ç»™æ„å»ºå™¨. å¦‚æœç”¨æˆ·æŒ‡å®šäº†ä¸€ä¸ªæœªåœ¨<code>Dockerfile</code>ä¸­å®šä¹‰çš„æ„å»ºå‚æ•°, æ„å»ºå°†è¾“å‡ºé”™è¯¯</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">One or more build-args were not consumed, failing build.</span><br></pre></td></tr></table></figure>

<p>Dockerfileä½œè€…å¯ä»¥é€šè¿‡æŒ‡å®š<code>ARG</code>ä¸€ä¸ªæˆ–å¤šä¸ªå˜é‡, é€šè¿‡å¤šæ¬¡æŒ‡å®š<code>ARG</code>æ¥å®šä¹‰å•ä¸ªå˜é‡. ä¾‹å¦‚, ä¸€ä¸ªæœ‰æ•ˆçš„<code>Dockerfile</code>ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">FROM busybox</span><br><span class="line">ARG user1</span><br><span class="line">ARG buildno</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>Dockerfileä½œè€…å¯ä»¥å¯é€‰åœ°æŒ‡å®š<code>ARG</code>æŒ‡ä»¤çš„é»˜è®¤å€¼ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">FROM busybox</span><br><span class="line">ARG user1&#x3D;someuser</span><br><span class="line">ARG buildno&#x3D;1</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>å¦‚æœ<code>ARG</code>å€¼å…·æœ‰ç¼ºçœå€¼ï¼Œå¹¶ä¸”å¦‚æœåœ¨æ„å»ºæ—¶æ²¡æœ‰ä¼ é€’å€¼ï¼Œåˆ™æ„å»ºå™¨ä½¿ç”¨ç¼ºçœå€¼ã€‚</p>
<p><code>ARG</code>å˜é‡å®šä¹‰ä»åœ¨<code>Dockerfile</code>ä¸­å®šä¹‰çš„è¡Œå¼€å§‹ç”Ÿæ•ˆï¼Œè€Œä¸æ˜¯ä»å‘½ä»¤è¡Œæˆ–å…¶ä»–åœ°æ–¹çš„å‚æ•°ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œè€ƒè™‘è¿™ä¸ªDockerfileï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1 FROM busybox</span><br><span class="line">2 USER $&#123;user:-some_user&#125;</span><br><span class="line">3 ARG user</span><br><span class="line">4 USER $user</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>ç”¨æˆ·æ„å»ºæ­¤æ–‡ä»¶å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker build --build-arg user&#x3D;what_user Dockerfile</span><br></pre></td></tr></table></figure>

<p>ç¬¬2è¡Œçš„<code>USER</code>å°†è¯„ä¼°ä¸º<code>some_user</code>ï¼Œå› ä¸ºç”¨æˆ·å˜é‡åœ¨åç»­è¡Œ3ä¸Šå®šä¹‰ã€‚ç¬¬4è¡Œçš„<code>USER</code>åœ¨å®šä¹‰ç”¨æˆ·æ—¶ä¼°è®¡ä¸º<code>what_user</code>ï¼Œåœ¨å‘½ä»¤è¡Œä¸­ä¼ é€’<code>what_user</code>å€¼ã€‚åœ¨é€šè¿‡<code>ARG</code>æŒ‡ä»¤å®šä¹‰ä¹‹å‰ï¼Œå˜é‡çš„ä»»ä½•ä½¿ç”¨éƒ½å°†å¯¼è‡´ç©ºå­—ç¬¦ä¸²ã€‚</p>
<blockquote>
<p><code>è­¦å‘Š</code>ï¼šä¸å»ºè®®ä½¿ç”¨build-timeå˜é‡æ¥ä¼ é€’è¯¸å¦‚githubå¯†é’¥, ç”¨æˆ·å‡­è¯ç­‰å¯†ç . æ„å»ºæ—¶å˜é‡å€¼ä½¿ç”¨<code>docker history</code>å‘½ä»¤å¯¹é•œåƒçš„ä»»ä½•ç”¨æˆ·å¯è§</p>
</blockquote>
<p>å¯ä»¥ä½¿ç”¨<code>ARG</code>æˆ–<code>ENV</code>æŒ‡ä»¤æ¥æŒ‡å®š<code>RUN</code>æŒ‡ä»¤å¯ç”¨çš„å˜é‡ã€‚ä½¿ç”¨<code>ENV</code>æŒ‡ä»¤å®šä¹‰çš„ç¯å¢ƒå˜é‡æ€»æ˜¯è¦†ç›–åŒåçš„<code>ARG</code>æŒ‡ä»¤ã€‚æ€è€ƒè¿™ä¸ª<code>Dockerfile</code>å¸¦æœ‰<code>ENV</code>å’Œ<code>ARG</code>æŒ‡ä»¤ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1 FROM ubuntu</span><br><span class="line">2 ARG CONT_IMG_VER</span><br><span class="line">3 ENV CONT_IMG_VER v1.0.0</span><br><span class="line">4 RUN echo $CONT_IMG_VER</span><br></pre></td></tr></table></figure>

<p>ç„¶åï¼Œå‡è®¾æ­¤imageæ˜¯ä½¿ç”¨æ­¤å‘½ä»¤æ„å»ºçš„ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker build --build-arg CONT_IMG_VER&#x3D;v2.0.1 Dockerfile</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<code>RUN</code>æŒ‡ä»¤ä½¿ç”¨<code>v1.0.0</code>è€Œä¸æ˜¯ç”¨æˆ·ä¼ é€’çš„<code>ARG</code>è®¾ç½®ï¼š<code>v2.0.1</code>æ­¤è¡Œä¸ºç±»ä¼¼äºshellè„šæœ¬ï¼Œå…¶ä¸­æœ¬åœ°ä½œç”¨åŸŸå˜é‡è¦†ç›–ä½œä¸ºå‚æ•°ä¼ é€’æˆ–ä»ç¯å¢ƒç»§æ‰¿çš„å˜é‡ï¼Œä»å…¶å®šä¹‰ç‚¹ã€‚</p>
<p>ä½¿ç”¨ä¸Šè¿°ç¤ºä¾‹ï¼Œä½†ä½¿ç”¨ä¸åŒçš„<code>ENV</code>è§„èŒƒï¼Œæ‚¨å¯ä»¥åœ¨<code>ARG</code>å’Œ<code>ENV</code>æŒ‡ä»¤ä¹‹é—´åˆ›å»ºæ›´æœ‰ç”¨çš„äº¤äº’ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1 FROM ubuntu</span><br><span class="line">2 ARG CONT_IMG_VER</span><br><span class="line">3 ENV CONT_IMG_VER $&#123;CONT_IMG_VER:-v1.0.0&#125;</span><br><span class="line">4 RUN echo $CONT_IMG_VER</span><br></pre></td></tr></table></figure>

<p>ä¸<code>ARG</code>æŒ‡ä»¤ä¸åŒ, <code>ENV</code>å€¼å§‹ç»ˆä¿ç•™åœ¨imageä¸­. è€ƒè™‘ä¸€ä¸ªæ²¡æœ‰<code>-build-arg</code>æ ‡å¿—çš„dockeræ„å»ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker build Dockerfile</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨è¿™ä¸ªDockerfileç¤ºä¾‹ï¼Œ<code>CONT_IMG_VER</code>ä»ç„¶ä¿ç•™åœ¨æ˜ åƒä¸­ï¼Œä½†å®ƒçš„å€¼å°†æ˜¯<code>v1.0.0</code>ï¼Œå› ä¸ºå®ƒæ˜¯<code>ENV</code>æŒ‡ä»¤åœ¨ç¬¬3è¡Œä¸­çš„é»˜è®¤è®¾ç½®ã€‚</p>
<p>æ­¤ç¤ºä¾‹ä¸­çš„å˜é‡æ‰©å±•æŠ€æœ¯å…è®¸æ‚¨ä»å‘½ä»¤è¡Œä¼ é€’å‚æ•°ï¼Œå¹¶é€šè¿‡åˆ©ç”¨<code>ENV</code>æŒ‡ä»¤å°†å®ƒä»¬æŒä¹…ä¿å­˜åœ¨æœ€ç»ˆimageä¸­</p>
<p>Dockeræœ‰ä¸€ç»„é¢„å®šä¹‰çš„<code>ARG</code>å˜é‡ï¼Œæ‚¨å¯ä»¥åœ¨Dockerfileä¸­ä½¿ç”¨ç›¸åº”çš„ARGæŒ‡ä»¤ã€‚</p>
<ul>
<li>HTTP_PROXY</li>
<li>http_proxy</li>
<li>HTTPS_PROXY</li>
<li>https_proxy</li>
<li>FTP_PROXY</li>
<li>ftp_proxy</li>
<li>NO_PROXY</li>
<li>no_proxy</li>
</ul>
<p>è¦ä½¿ç”¨è¿™äº›ï¼Œåªéœ€åœ¨å‘½ä»¤è¡Œä½¿ç”¨æ ‡å¿—ä¼ é€’å®ƒä»¬ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--build-arg &lt;varname&gt;&#x3D;&lt;value&gt;</span><br></pre></td></tr></table></figure>

<h2 id="Impact-on-build-caching"><a href="#Impact-on-build-caching" class="headerlink" title="Impact on build caching"></a>Impact on build caching</h2><p><code>ARG</code>å˜é‡ä¸ä¼šæŒä¹…åŒ–åˆ°æ„å»ºçš„imageä¸­ï¼Œå› ä¸º<code>ENV</code>å˜é‡æ˜¯ã€‚ä½†æ˜¯ï¼Œ<code>ARG</code>å˜é‡ä¼šä»¥ç±»ä¼¼çš„æ–¹å¼å½±å“æ„å»ºç¼“å­˜ã€‚å¦‚æœä¸€ä¸ª<code>Dockerfile</code>å®šä¹‰ä¸€ä¸ª<code>ARG</code>å˜é‡ï¼Œå®ƒçš„å€¼ä¸åŒäºä»¥å‰çš„ç‰ˆæœ¬ï¼Œé‚£ä¹ˆåœ¨å®ƒçš„ç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶ä¼šå‡ºç°ä¸€ä¸ªâ€œcache missâ€ï¼Œè€Œä¸æ˜¯å®ƒçš„å®šä¹‰ã€‚ç‰¹åˆ«åœ°ï¼Œåœ¨<code>ARG</code>æŒ‡ä»¤ä¹‹åçš„æ‰€æœ‰<code>RUN</code>æŒ‡ä»¤éƒ½éšå¼åœ°ä½¿ç”¨ARGå˜é‡ï¼ˆä½œä¸ºç¯å¢ƒå˜é‡ï¼‰ï¼Œå› æ­¤å¯èƒ½å¯¼è‡´é«˜é€Ÿç¼“å­˜æœªå‘½ä¸­ã€‚</p>
<p>ä¾‹å¦‚ï¼Œè€ƒè™‘è¿™ä¸¤ä¸ªDockerfileï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1 FROM ubuntu</span><br><span class="line">2 ARG CONT_IMG_VER</span><br><span class="line">3 RUN echo $CONT_IMG_VER</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1 FROM ubuntu</span><br><span class="line">2 ARG CONT_IMG_VER</span><br><span class="line">3 RUN echo hello</span><br></pre></td></tr></table></figure>

<p>å¦‚æœåœ¨å‘½ä»¤è¡Œä¸ŠæŒ‡å®š<code>--build-arg CONT_IMG_VER = &lt;value&gt;</code>ï¼Œåˆ™åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œç¬¬2è¡Œçš„è§„èŒƒä¸ä¼šå¯¼è‡´é«˜é€Ÿç¼“å­˜æœªå‘½ä¸­;è¡Œ3ç¡®å®å¯¼è‡´é«˜é€Ÿç¼“å­˜æœªå‘½ä¸­ã€‚<code>ARG CONT_IMG_VER</code>å¯¼è‡´<code>RUN</code>è¡Œè¢«æ ‡è¯†ä¸ºä¸è¿è¡Œ<code>CONT_IMG_VER = &lt;value&gt; echo hello</code>ç›¸åŒï¼Œå› æ­¤å¦‚æœ<code>&lt;value&gt;</code>æ›´æ”¹ï¼Œæˆ‘ä»¬å°†å¾—åˆ°é«˜é€Ÿç¼“å­˜æœªå‘½ä¸­ã€‚</p>
<p>è€ƒè™‘åœ¨åŒä¸€å‘½ä»¤è¡Œä¸‹çš„å¦ä¸€ä¸ªç¤ºä¾‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1 FROM ubuntu</span><br><span class="line">2 ARG CONT_IMG_VER</span><br><span class="line">3 ENV CONT_IMG_VER $CONT_IMG_VER</span><br><span class="line">4 RUN echo $CONT_IMG_VER</span><br></pre></td></tr></table></figure>

<p>åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œé«˜é€Ÿç¼“å­˜æœªå‘½ä¸­å‘ç”Ÿåœ¨ç¬¬3è¡Œã€‚ç”±äºå˜é‡åœ¨<code>ENV</code>ä¸­çš„å€¼å¼•ç”¨<code>ARG</code>å˜é‡å¹¶ä¸”è¯¥å˜é‡é€šè¿‡å‘½ä»¤è¡Œæ›´æ”¹ï¼Œå› æ­¤å‘ç”Ÿäº†æœªå‘½ä¸­ã€‚åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œ<code>ENV</code>å‘½ä»¤ä½¿imageåŒ…æ‹¬è¯¥å€¼ã€‚</p>
<p>å¦‚æœ<code>ENV</code>æŒ‡ä»¤è¦†ç›–åŒåçš„<code>ARG</code>æŒ‡ä»¤ï¼Œå°±åƒè¿™ä¸ªDockerfileï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1 FROM ubuntu</span><br><span class="line">2 ARG CONT_IMG_VER</span><br><span class="line">3 ENV CONT_IMG_VER hello</span><br><span class="line">4 RUN echo $CONT_IMG_VER</span><br></pre></td></tr></table></figure>

<p>ç¬¬3è¡Œä¸ä¼šå¯¼è‡´é«˜é€Ÿç¼“å­˜æœªå‘½ä¸­ï¼Œå› ä¸º<code>CONT_IMG_VER</code>çš„å€¼æ˜¯ä¸€ä¸ªå¸¸é‡ï¼ˆhelloï¼‰å› æ­¤ï¼Œ<code>RUN</code>ï¼ˆç¬¬4è¡Œï¼‰ä¸Šä½¿ç”¨çš„ç¯å¢ƒå˜é‡å’Œå€¼åœ¨æ„å»ºä¹‹é—´ä¸ä¼šæ›´æ”¹</p>
<h1 id="ONBUILD"><a href="#ONBUILD" class="headerlink" title="ONBUILD"></a>ONBUILD</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ONBUILD [INSTRUCTION]</span><br></pre></td></tr></table></figure>

<p><code>ONBUILD</code>æŒ‡ä»¤åœ¨imageè¢«ç”¨ä½œå¦ä¸€ä¸ªæ„å»ºçš„åŸºç¡€æ—¶ï¼Œå‘imageæ·»åŠ è¦åœ¨ä»¥åæ‰§è¡Œçš„<em>trigger</em>æŒ‡ä»¤ã€‚triggerå°†åœ¨ä¸‹æ¸¸æ„å»ºçš„ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œï¼Œå°±å¥½åƒå®ƒå·²ç»åœ¨ä¸‹æ¸¸Dockerfileä¸­çš„1FROM1æŒ‡ä»¤ä¹‹åç«‹å³æ’å…¥ã€‚</p>
<p>ä»»ä½•æ„å»ºæŒ‡ä»¤éƒ½å¯ä»¥æ³¨å†Œä¸ºtriggerã€‚</p>
<p>å¦‚æœæ‚¨æ­£åœ¨æ„å»ºå°†ç”¨ä½œæ„å»ºå…¶ä»–imageçš„åŸºç¡€çš„å›¾åƒï¼Œä¾‹å¦‚åº”ç”¨ç¨‹åºæ„å»ºç¯å¢ƒæˆ–å¯ä»¥ä½¿ç”¨ç”¨æˆ·ç‰¹å®šé…ç½®è‡ªå®šä¹‰çš„åå°é©»ç•™ç¨‹åºï¼Œè¿™å°†éå¸¸æœ‰ç”¨ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨çš„imageæ˜¯å¯é‡ç”¨çš„Pythonåº”ç”¨ç¨‹åºæ„å»ºå™¨ï¼Œåˆ™éœ€è¦å°†åº”ç”¨ç¨‹åºæºä»£ç æ·»åŠ åˆ°ç‰¹å®šç›®å½•ä¸­ï¼Œå¹¶ä¸”å¯èƒ½éœ€è¦åœ¨æ­¤ä¹‹åè°ƒç”¨æ„å»ºè„šæœ¬ã€‚ä½ ä¸èƒ½åªæ˜¯è°ƒç”¨<code>ADD</code>å’Œ<code>RUN</code>ç°åœ¨ï¼Œå› ä¸ºä½ è¿˜æ²¡æœ‰è®¿é—®åº”ç”¨ç¨‹åºæºä»£ç ï¼Œå®ƒå°†æ˜¯ä¸åŒçš„æ¯ä¸ªåº”ç”¨ç¨‹åºæ„å»ºã€‚æ‚¨å¯ä»¥ç®€å•åœ°ä¸ºåº”ç”¨ç¨‹åºå¼€å‘äººå‘˜æä¾›ä¸€ä¸ªæ ·æ¿Dockerfileä»¥å°†å…¶å¤åˆ¶ç²˜è´´åˆ°å…¶åº”ç”¨ç¨‹åºä¸­ï¼Œä½†è¿™æ˜¯ä½æ•ˆï¼Œå®¹æ˜“å‡ºé”™ï¼Œå¹¶ä¸”å¾ˆéš¾æ›´æ–°ï¼Œå› ä¸ºå®ƒä¸åº”ç”¨ç¨‹åºç‰¹å®šçš„ä»£ç æ··åˆã€‚</p>
<p>è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨<code>ONBUILD</code>æ¥æ³¨å†Œæå‰æŒ‡ä»¤ï¼Œä»¥ä¾¿ç¨ååœ¨ä¸‹ä¸€ä¸ªæ„å»ºé˜¶æ®µè¿è¡Œã€‚</p>
<p>ä»¥ä¸‹æ˜¯å®ƒçš„å·¥ä½œåŸç†ï¼š</p>
<ol>
<li>å½“é‡åˆ°<code>ONBUILD</code>æŒ‡ä»¤æ—¶ï¼Œæ„å»ºå™¨ä¼šå‘æ­£åœ¨æ„å»ºçš„imageçš„å…ƒæ•°æ®æ·»åŠ triggerã€‚è¯¥æŒ‡ä»¤ä¸ä¼šå¦å¤–å½±å“å½“å‰æ„å»ºã€‚</li>
<li>åœ¨æ„å»ºç»“æŸæ—¶ï¼Œæ‰€æœ‰triggerçš„åˆ—è¡¨å­˜å‚¨åœ¨imageæ¸…å•ä¸­çš„OnBuildé”®ä¸‹ã€‚å¯ä»¥ä½¿ç”¨<code>docker inspect</code>å‘½ä»¤æ£€æŸ¥å®ƒä»¬ã€‚</li>
<li>ç¨åï¼Œå¯ä»¥ä½¿ç”¨<code>FROM</code>æŒ‡ä»¤å°†imageç”¨ä½œæ–°æ„å»ºçš„åŸºç¡€ã€‚ä½œä¸ºå¤„ç†<code>FROM</code>æŒ‡ä»¤çš„ä¸€éƒ¨åˆ†ï¼Œä¸‹æ¸¸æ„å»ºå™¨ä¼šæŸ¥æ‰¾<code>ONBUILD</code>triggersï¼Œå¹¶æŒ‰ç…§å®ƒä»¬æ³¨å†Œçš„é¡ºåºæ‰§è¡Œå®ƒä»¬ã€‚å¦‚æœä»»ä½•è§¦å‘å™¨å¤±è´¥ï¼Œåˆ™<code>FROM</code>æŒ‡ä»¤ä¸­æ­¢ï¼Œè¿™åˆå¯¼è‡´æ„å»ºå¤±è´¥ã€‚å¦‚æœæ‰€æœ‰è§¦å‘å™¨éƒ½æˆåŠŸï¼Œåˆ™<code>FROM</code>æŒ‡ä»¤å®Œæˆå¹¶ä¸”æ„å»ºå¦‚å¸¸ç»§ç»­ã€‚è§¦å‘å™¨åœ¨æ‰§è¡Œåä»æœ€ç»ˆimageä¸­æ¸…é™¤ã€‚æ¢å¥è¯è¯´ï¼Œå®ƒä»¬ä¸ä¼šè¢«â€œgrand-childrenâ€æ„å»ºç»§æ‰¿ã€‚ ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥æ·»åŠ å¦‚ä¸‹ï¼š <code>[...] ONBUILD ADD . /app/src ONBUILD RUN /usr/local/bin/python-build --dir /app/src [...]</code>&gt; <code>è­¦å‘Š</code>ï¼šä¸å…è®¸ä½¿ç”¨<code>ONBUILD ONBUILD</code>é“¾æ¥<code>ONBUILD</code>æŒ‡ä»¤ã€‚ &gt; <code>è­¦å‘Š</code>ï¼š<code>ONBUILD</code>æŒ‡ä»¤å¯èƒ½ä¸ä¼šè§¦å‘<code>FROM</code>æˆ–<code>MAINTAINER</code>æŒ‡ä»¤ã€‚</li>
</ol>
<h1 id="STOPSIGNAL"><a href="#STOPSIGNAL" class="headerlink" title="STOPSIGNAL"></a>STOPSIGNAL</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">STOPSIGNAL signal</span><br></pre></td></tr></table></figure>

<p><code>STOPSIGNAL</code>æŒ‡ä»¤è®¾ç½®å°†å‘é€åˆ°å®¹å™¨ä»¥é€€å‡ºçš„ç³»ç»Ÿè°ƒç”¨ä¿¡å·ã€‚è¯¥ä¿¡å·å¯ä»¥æ˜¯ä¸å†…æ ¸ç³»ç»Ÿè°ƒç”¨è¡¨ä¸­çš„ä½ç½®åŒ¹é…çš„æœ‰æ•ˆæ— ç¬¦å·æ•°ï¼Œä¾‹å¦‚9ï¼Œæˆ–è€…æ˜¯SIGNAMEæ ¼å¼çš„ä¿¡å·åç§°ï¼Œä¾‹å¦‚SIGKILL</p>
<h1 id="HEALTHCHECK"><a href="#HEALTHCHECK" class="headerlink" title="HEALTHCHECK"></a>HEALTHCHECK</h1><p>ä¸¤ç§å½¢å¼ï¼š</p>
<ul>
<li>HEALTHCHECK [OPTIONS] CMD command (é€šè¿‡åœ¨å®¹å™¨ä¸­è¿è¡Œå‘½ä»¤æ¥æ£€æŸ¥å®¹å™¨è¿è¡ŒçŠ¶å†µ)</li>
<li>HEALTHCHECK NONE (ç¦ç”¨ä»åŸºæœ¬æ˜ åƒç»§æ‰¿çš„ä»»ä½•è¿è¡ŒçŠ¶å†µæ£€æŸ¥)</li>
</ul>
<p><code>HEALTHCHECK</code>æŒ‡ä»¤å‘Šè¯‰Dockerå¦‚ä½•æµ‹è¯•å®¹å™¨ä»¥æ£€æŸ¥å®ƒæ˜¯å¦ä»åœ¨å·¥ä½œã€‚è¿™å¯ä»¥æ£€æµ‹åˆ°è¯¸å¦‚WebæœåŠ¡å™¨è¢«å¡åœ¨æ— é™å¾ªç¯ä¸­å¹¶ä¸”æ— æ³•å¤„ç†æ–°è¿æ¥çš„æƒ…å†µï¼Œå³ä½¿æœåŠ¡å™¨è¿›ç¨‹ä»åœ¨è¿è¡Œã€‚</p>
<p>å½“å®¹å™¨æŒ‡å®šäº†healthcheckæ—¶ï¼Œé™¤äº†å…¶æ­£å¸¸çŠ¶æ€å¤–ï¼Œå®ƒè¿˜å…·æœ‰å¥åº·çŠ¶æ€ã€‚æ­¤çŠ¶æ€æœ€åˆå¼€å§‹ã€‚ æ¯å½“å¥åº·æ£€æŸ¥é€šè¿‡ï¼Œå®ƒå˜å¾—å¥åº·ï¼ˆæ— è®ºä¹‹å‰çš„çŠ¶æ€ï¼‰ã€‚åœ¨ä¸€å®šæ•°é‡çš„è¿ç»­æ•…éšœåï¼Œå®ƒå˜å¾—ä¸å¥åº·ã€‚</p>
<p>åœ¨CMDä¹‹å‰å¯ä»¥å‡ºç°çš„é€‰é¡¹æœ‰ï¼š</p>
<ul>
<li><code>--interval=DURATION</code> (default: 30s)</li>
<li><code>--timeout=DURATION</code> (default: 30s)</li>
<li><code>--retries=N</code> (default: 3)</li>
</ul>
<p>è¿è¡ŒçŠ¶å†µæ£€æŸ¥å°†é¦–å…ˆåœ¨å®¹å™¨å¯åŠ¨åè¿è¡Œ<strong>interval</strong>ç§’ï¼Œç„¶ååœ¨æ¯æ¬¡ä¸Šæ¬¡æ£€æŸ¥å®Œæˆåå†æ¬¡è¿è¡Œ<strong>interval</strong>ç§’ã€‚</p>
<p>å¦‚æœæ£€æŸ¥çš„å•æ¬¡è¿è¡Œæ‰€èŠ±è´¹çš„æ—¶é—´è¶…è¿‡<strong>timeout</strong>ç§’æ•°ï¼Œåˆ™è¯¥æ£€æŸ¥è¢«è®¤ä¸ºå·²å¤±è´¥ã€‚</p>
<p>å®ƒéœ€è¦<strong>retries</strong>è¿ç»­çš„å¥åº·æ£€æŸ¥çš„æ•…éšœï¼Œå®¹å™¨è¢«è®¤ä¸ºæ˜¯ä¸å¥åº·çš„ã€‚</p>
<p>åœ¨Dockerfileä¸­åªèƒ½æœ‰ä¸€ä¸ª<code>HEALTHCHECK</code>æŒ‡ä»¤ã€‚å¦‚æœæ‚¨åˆ—å‡ºå¤šä¸ªï¼Œåˆ™åªæœ‰æœ€åä¸€ä¸ª<code>HEALTHCHECK</code>å°†ç”Ÿæ•ˆã€‚</p>
<p><code>CMD</code>å…³é”®å­—ä¹‹åçš„å‘½ä»¤å¯ä»¥æ˜¯shellå‘½ä»¤ï¼ˆä¾‹å¦‚<code>HEALTHCHECK CMD /bin/check-running</code>ï¼‰æˆ–execæ•°ç»„ï¼ˆå¦‚åŒå…¶ä»–Dockerfileå‘½ä»¤ä¸€æ ·;è¯¦æƒ…å‚è§<code>ENTRYPOINT</code>ï¼‰ã€‚</p>
<p>å‘½ä»¤çš„é€€å‡ºçŠ¶æ€è¡¨ç¤ºå®¹å™¨çš„è¿è¡ŒçŠ¶å†µã€‚ å¯èƒ½çš„å€¼ä¸ºï¼š</p>
<ul>
<li>0: success - the container is healthy and ready for use</li>
<li>1: unhealthy - the container is not working correctly</li>
<li>2: reserved - do not use this exit code</li>
</ul>
<p>ä¾‹å¦‚ï¼Œè¦æ¯äº”åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡WebæœåŠ¡å™¨èƒ½å¤Ÿåœ¨ä¸‰ç§’é’Ÿå†…ä¸ºç½‘ç«™çš„ä¸»é¡µæä¾›æœåŠ¡ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">HEALTHCHECK --interval&#x3D;5m --timeout&#x3D;3s \</span><br><span class="line">  CMD curl -f http:&#x2F;&#x2F;localhost&#x2F; || exit 1</span><br></pre></td></tr></table></figure>

<p>ä¸ºäº†å¸®åŠ©è°ƒè¯•å¤±è´¥çš„æ¢æµ‹å™¨ï¼Œå‘½ä»¤åœ¨stdoutæˆ–stderrä¸Šå†™å…¥çš„ä»»ä½•è¾“å‡ºæ–‡æœ¬ï¼ˆUTF-8ç¼–ç ï¼‰å°†å­˜å‚¨åœ¨è¿è¡ŒçŠ¶å†µçŠ¶æ€ï¼Œå¹¶å¯ä»¥ä½¿ç”¨<code>docker inspect</code>æŸ¥è¯¢ã€‚è¿™æ ·çš„è¾“å‡ºåº”è¯¥ä¿æŒçŸ­è·¯ï¼ˆåªå­˜å‚¨å½“å‰çš„4096ä¸ªå­—èŠ‚ï¼‰ã€‚</p>
<p>å½“å®¹å™¨çš„è¿è¡ŒçŠ¶å†µå‘ç”Ÿæ›´æ”¹æ—¶ï¼Œå°†ç”Ÿæˆå…·æœ‰æ–°çŠ¶æ€çš„<code>health_status</code>äº‹ä»¶ã€‚</p>
<p><code>HEALTHCHECK</code>åŠŸèƒ½åœ¨Docker 1.12ä¸­æ·»åŠ ã€‚</p>
<h1 id="SHELL"><a href="#SHELL" class="headerlink" title="SHELL"></a>SHELL</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHELL [&quot;executable&quot;, &quot;parameters&quot;]</span><br></pre></td></tr></table></figure>

<p><code>SHELL</code>æŒ‡ä»¤å…è®¸ç”¨äºå‘½ä»¤çš„shellå½¢å¼çš„é»˜è®¤shellè¢«è¦†ç›–ã€‚ Linuxä¸Šçš„é»˜è®¤shellæ˜¯<code>[&quot;/bin/sh&quot;,&quot;-c&quot;]</code>ï¼Œåœ¨Windowsä¸Šæ˜¯<code>[&quot;cmd&quot;,&quot;/S&quot;,&quot;/C&quot;]</code>ã€‚<code>SHELL</code>æŒ‡ä»¤å¿…é¡»ä»¥JSONæ ¼å¼å†™åœ¨Dockerfileä¸­ã€‚</p>
<p><code>SHELL</code>æŒ‡ä»¤åœ¨Windowsä¸Šç‰¹åˆ«æœ‰ç”¨ï¼Œå…¶ä¸­æœ‰ä¸¤ä¸ªå¸¸ç”¨çš„å’Œå®Œå…¨ä¸åŒçš„æœ¬æœºshellï¼š<code>cmd</code>å’Œ<code>powershell</code>ï¼Œä»¥åŠåŒ…æ‹¬<code>sh</code>çš„å¤‡ç”¨Shellã€‚</p>
<p><code>SHELL</code>æŒ‡ä»¤å¯ä»¥å¤šæ¬¡å‡ºç°ã€‚æ¯ä¸ª<code>SHELL</code>æŒ‡ä»¤è¦†ç›–æ‰€æœ‰å…ˆå‰çš„<code>SHELL</code>æŒ‡ä»¤ï¼Œå¹¶å½±å“æ‰€æœ‰åç»­æŒ‡ä»¤ã€‚ ä¾‹å¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">FROM windowsservercore</span><br><span class="line"></span><br><span class="line"># Executed as cmd &#x2F;S &#x2F;C echo default</span><br><span class="line">RUN echo default</span><br><span class="line"></span><br><span class="line"># Executed as cmd &#x2F;S &#x2F;C powershell -command Write-Host default</span><br><span class="line">RUN powershell -command Write-Host default</span><br><span class="line"></span><br><span class="line"># Executed as powershell -command Write-Host hello</span><br><span class="line">SHELL [&quot;powershell&quot;, &quot;-command&quot;]</span><br><span class="line">RUN Write-Host hello</span><br><span class="line"></span><br><span class="line"># Executed as cmd &#x2F;S &#x2F;C echo hello</span><br><span class="line">SHELL [&quot;cmd&quot;, &quot;&#x2F;S&quot;&quot;, &quot;&#x2F;C&quot;]</span><br><span class="line">RUN echo hello</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸‹æŒ‡ä»¤å¯èƒ½å—<code>SHELL</code>æŒ‡ä»¤çš„å½±å“ï¼Œå½“å®ƒä»¬çš„shellå½¢å¼ç”¨äºDockerfileï¼š<code>RUN</code>ï¼Œ<code>CMD</code>å’Œ<code>ENTRYPOINT</code>ã€‚</p>
<p>ä»¥ä¸‹ç¤ºä¾‹æ˜¯Windowsä¸Šçš„å¸¸è§æ¨¡å¼ï¼Œå¯ä»¥ä½¿ç”¨SHELLæŒ‡ä»¤è¿›è¡Œç®€åŒ–ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">RUN powershell -command Execute-MyCmdlet -param1 &quot;c:\foo.txt&quot;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>dockerè°ƒç”¨çš„å‘½ä»¤å°†æ˜¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmd &#x2F;S &#x2F;C powershell -command Execute-MyCmdlet -param1 &quot;c:\foo.txt&quot;</span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯ä½æ•ˆçš„ï¼Œæœ‰ä¸¤ä¸ªåŸå› ã€‚é¦–å…ˆï¼Œæœ‰ä¸€ä¸ªä¸å¿…è¦çš„cmd.exeå‘½ä»¤å¤„ç†å™¨ï¼ˆä¹Ÿç§°ä¸ºshellï¼‰è¢«è°ƒç”¨ã€‚å…¶æ¬¡ï¼Œshellä¸­çš„æ¯ä¸ª<code>RUN</code>æŒ‡ä»¤éƒ½éœ€è¦ä¸€ä¸ªé¢å¤–çš„<code>powershell -command</code>ã€‚</p>
<p>ä¸ºäº†æ›´æœ‰æ•ˆç‡ï¼Œå¯ä»¥é‡‡ç”¨ä¸¤ç§æœºåˆ¶ä¹‹ä¸€ã€‚ ä¸€ç§æ˜¯ä½¿ç”¨JSONå½¢å¼çš„RUNå‘½ä»¤ï¼Œå¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">RUN [&quot;powershell&quot;, &quot;-command&quot;, &quot;Execute-MyCmdlet&quot;, &quot;-param1 \&quot;c:\\foo.txt\&quot;&quot;]</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>è™½ç„¶JSONå½¢å¼æ˜¯æ˜ç¡®çš„ï¼Œå¹¶ä¸”ä¸ä½¿ç”¨ä¸å¿…è¦çš„cmd.exeï¼Œä½†å®ƒéœ€è¦é€šè¿‡åŒå¼•å·å’Œè½¬ä¹‰æ›´è¯¦ç»†ã€‚ å¤‡ç”¨æœºåˆ¶æ˜¯ä½¿ç”¨<code>SHELL</code>æŒ‡ä»¤å’Œshellå½¢å¼ï¼Œä¸ºWindowsç”¨æˆ·æä¾›æ›´è‡ªç„¶çš„è¯­æ³•ï¼Œç‰¹åˆ«æ˜¯ä¸<code>escape</code> è§£ææŒ‡ä»¤ç»“åˆä½¿ç”¨æ—¶ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># escape&#x3D;&#96;</span><br><span class="line"></span><br><span class="line">FROM windowsservercore</span><br><span class="line">SHELL [&quot;powershell&quot;,&quot;-command&quot;]</span><br><span class="line">RUN New-Item -ItemType Directory C:\Example</span><br><span class="line">ADD Execute-MyCmdlet.ps1 c:\example\</span><br><span class="line">RUN c:\example\Execute-MyCmdlet -sample &#39;hello world&#39;</span><br></pre></td></tr></table></figure>

<p>ç»“æœæ˜¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">PS E:\docker\build\shell&gt; docker build -t shell .</span><br><span class="line">Sending build context to Docker daemon 3.584 kB</span><br><span class="line">Step 1 : FROM windowsservercore</span><br><span class="line"> ---&gt; 5bc36a335344</span><br><span class="line">Step 2 : SHELL powershell -command</span><br><span class="line"> ---&gt; Running in 87d7a64c9751</span><br><span class="line"> ---&gt; 4327358436c1</span><br><span class="line">Removing intermediate container 87d7a64c9751</span><br><span class="line">Step 3 : RUN New-Item -ItemType Directory C:\Example</span><br><span class="line"> ---&gt; Running in 3e6ba16b8df9</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Directory: C:\</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                LastWriteTime         Length Name</span><br><span class="line">----                -------------         ------ ----</span><br><span class="line">d-----         6&#x2F;2&#x2F;2016   2:59 PM                Example</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> ---&gt; 1f1dfdcec085</span><br><span class="line">Removing intermediate container 3e6ba16b8df9</span><br><span class="line">Step 4 : ADD Execute-MyCmdlet.ps1 c:\example\</span><br><span class="line"> ---&gt; 6770b4c17f29</span><br><span class="line">Removing intermediate container b139e34291dc</span><br><span class="line">Step 5 : RUN c:\example\Execute-MyCmdlet -sample &#39;hello world&#39;</span><br><span class="line"> ---&gt; Running in abdcf50dfd1f</span><br><span class="line">Hello from Execute-MyCmdlet.ps1 - passed hello world</span><br><span class="line"> ---&gt; ba0e25255fda</span><br><span class="line">Removing intermediate container abdcf50dfd1f</span><br><span class="line">Successfully built ba0e25255fda</span><br><span class="line">PS E:\docker\build\shell&gt;</span><br></pre></td></tr></table></figure>

<p><code>SHELL</code>æŒ‡ä»¤è¿˜å¯ä»¥ç”¨äºä¿®æ”¹å¤–å£³æ“ä½œçš„æ–¹å¼ã€‚ä¾‹å¦‚ï¼Œåœ¨Windowsä¸Šä½¿ç”¨<code>SHELL cmd /S /C /V:ON|OFF</code>ï¼Œå¯ä»¥ä¿®æ”¹å»¶è¿Ÿçš„ç¯å¢ƒå˜é‡æ‰©å±•è¯­ä¹‰ã€‚</p>
<p><code>SHELL</code>æŒ‡ä»¤ä¹Ÿå¯ä»¥åœ¨Linuxä¸Šä½¿ç”¨ï¼Œå¦‚æœéœ€è¦ä¸€ä¸ªæ›¿ä»£shellï¼Œå¦‚<code>zsh</code>ï¼Œ<code>csh</code>ï¼Œ<code>tcsh</code>å’Œå…¶ä»–ã€‚</p>
<p><code>SHELL</code>åŠŸèƒ½åœ¨Docker 1.12ä¸­æ·»åŠ </p>

      
    </div>

    
    
    
      

      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://docs.lvrui.io/2017/04/21/dockerfile%E8%AF%A6%E8%A7%A3%203/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.JPG">
      <meta itemprop="name" content="æåœ°ç‘é›ª">
      <meta itemprop="description" content="æåœ°ç‘é›ªçš„ä¸ªäººæŠ€æœ¯åšå®¢. "å–ä¹‹å¼€æº ç”¨ä¹‹å¼€æº", åˆ†äº«è‡ªå·±çš„ç»éªŒä¹‹è°ˆ".">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Polar Snow Documentation">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/04/21/dockerfile%E8%AF%A6%E8%A7%A3%203/" class="post-title-link" itemprop="url">dockerfileè¯¦è§£</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2017-04-21 22:22:53" itemprop="dateCreated datePublished" datetime="2017-04-21T22:22:53+08:00">2017-04-21</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Docker/" itemprop="url" rel="index"><span itemprop="name">Docker</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqusï¼š</span>
    
    <a title="disqus" href="/2017/04/21/dockerfile%E8%AF%A6%E8%A7%A3%203/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/04/21/dockerfileè¯¦è§£ 3/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>Dockerfileæ˜¯ç”±ä¸€ç³»åˆ—å‘½ä»¤å’Œå‚æ•°æ„æˆçš„è„šæœ¬ï¼Œä¸€ä¸ªDockerfileé‡Œé¢åŒ…å«äº†æ„å»ºæ•´ä¸ªimageçš„å®Œæ•´å‘½ä»¤ã€‚Dockeré€šè¿‡docker buildæ‰§è¡ŒDockerfileä¸­çš„ä¸€ç³»åˆ—å‘½ä»¤è‡ªåŠ¨æ„å»ºimage</p>
</blockquote>
<h1 id="ç”¨æ³•"><a href="#ç”¨æ³•" class="headerlink" title="ç”¨æ³•"></a>ç”¨æ³•</h1><p><code>dockerfile</code> ä½¿ç”¨ <code>docker build</code> å‘½ä»¤æ¥ç”Ÿæˆ <code>image</code> é•œåƒ, <code>docker build</code>çš„è¯­æ³•å¦‚ä¸‹:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Usage:	docker build [OPTIONS] PATH | URL | -</span><br></pre></td></tr></table></figure>

<ul>
<li>PATH æ˜¯æœ¬åœ°æ–‡ä»¶è·¯å¾„</li>
<li>URL æ˜¯ git repository çš„è·¯å¾„</li>
</ul>
<p>æ„å»ºé•œåƒæ—¶, docker å°†ä¼šé€’å½’åœ°è¯»å–è·¯å¾„ä¸‹çš„æ‰€æœ‰æ–‡ä»¶. å› æ­¤, PATHåŒ…æ‹¬ä»»ä½•å­ç›®å½•ï¼ŒURLåŒ…æ‹¬repositoryåŠsubmodules</p>
<p><strong>å®˜æ–¹æ¨è: åœ¨æ„å»ºé•œåƒçš„æ—¶å€™, æœ€å¥½ä½¿ç”¨å¹²å‡€çš„ç›®å½•è¿›è¡Œæ„å»º, å‡å°‘ä¸å¿…è¦çš„ç´¢å¼•æ€§èƒ½æŸè€—, æé«˜æ„å»ºæ•ˆç‡</strong></p>
<p>å¦‚æœåœ¨ç‰¹æ®Šç¯å¢ƒçš„é™åˆ¶ä¸‹, ä¸€å®šè¦åœ¨æœ‰ä¼—å¤šå¹²æ‰°æ–‡ä»¶çš„ç›®å½•ä¸‹æ„å»ºé•œåƒ, å¯ä»¥ä½¿ç”¨ <code>.dockerignore</code> æ–‡ä»¶æ¥å±è”½ç´¢å¼•è¿™äº›æ–‡ä»¶</p>
<p>ä½ å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼è¿›è¡Œæ„å»º</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æœ€ç®€å•çš„æ‰§è¡Œæ–¹å¼</span></span><br><span class="line">$ docker build .</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœæ–‡ä»¶åä¸æ˜¯dockerfile, é‚£ä¹ˆéœ€è¦æ˜¾ç¤ºçš„ç²¾ç¡®æŒ‡å®šæ–‡ä»¶</span></span><br><span class="line">$ docker build -f /path/to/a/Dockerfile .</span><br><span class="line"></span><br><span class="line"><span class="comment"># é¡ºä¾¿æ‰“ä¸ªæ ‡ç­¾ğŸ·</span></span><br><span class="line">$ docker build -t shykes/myapp .</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰“å¤šä¸ªæ ‡ç­¾</span></span><br><span class="line">$ docker build -t shykes/myapp:1.0.2 -t shykes/myapp:latest .</span><br></pre></td></tr></table></figure>

<p>åªè¦æœ‰å¯èƒ½ï¼ŒDockerå°†é‡æ–°ä½¿ç”¨ä¸­é—´imagesï¼ˆç¼“å­˜ï¼‰ï¼Œä»¥æ˜¾ç€åŠ é€Ÿdocker buildè¿‡ç¨‹</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ docker build -t svendowideit/ambassador .</span><br><span class="line">Sending build context to Docker daemon 15.36 kB</span><br><span class="line">Step 1 : FROM alpine:3.2</span><br><span class="line"> ---&gt; 31f630c65071</span><br><span class="line">Step 2 : MAINTAINER SvenDowideit@home.org.au</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; 2a1c91448f5f</span><br><span class="line">Step 3 : RUN apk update &amp;&amp;      apk add socat &amp;&amp;        rm -r /var/cache/</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; 21ed6e7fbb73</span><br><span class="line">Step 4 : CMD env | grep _TCP= | (sed <span class="string">'s/.*_PORT_\([0-9]*\)_TCP=tcp:\/\/\(.*\):\(.*\)/socat -t 100000000 TCP4-LISTEN:\1,fork,reuseaddr TCP4:\2:\3 \&amp;/'</span> &amp;&amp; <span class="built_in">echo</span> <span class="built_in">wait</span>) | sh</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; 7ea8aef582cc</span><br><span class="line">Successfully built 7ea8aef582cc</span><br></pre></td></tr></table></figure>

<p>æ„å»ºæˆåŠŸåï¼Œå°±å¯ä»¥å‡†å¤‡Pushing a repository to its registry</p>
<h1 id="Format-è¯­æ³•æ ¼å¼"><a href="#Format-è¯­æ³•æ ¼å¼" class="headerlink" title="Format è¯­æ³•æ ¼å¼"></a>Format è¯­æ³•æ ¼å¼</h1><p>Dockerfileçš„æ ¼å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># Comment</span><br><span class="line">INSTRUCTION arguments</span><br></pre></td></tr></table></figure>

<ul>
<li>Line1 ç¬¬ä¸€è¡Œæ˜¯è§£æå™¨æŒ‡ä»¤</li>
<li>INSTRUCTION æ˜¯ä¸åŒºåˆ†å¤§å°å†™çš„ï¼Œä¸è¿‡å»ºè®®å¤§å†™. è¿™é‡Œå†™ dockerfile ä¸­æ”¯æŒçš„æŒ‡ä»¤é›†</li>
<li>arguments è¿™é‡Œå†™å¯¹åº”çš„å‘½ä»¤</li>
<li>dockerfile ä¸­çš„ç¬¬ä¸€ä¸ªæŒ‡ä»¤å¿…é¡»æ˜¯<code>FORM</code> æŒ‡å®šæ„å»ºé•œåƒçš„Base Image, è¿™ä¸ª Base Image åŸºç¡€é•œåƒå¯ä»¥æ˜¯ä¸€ä¸ªç³»ç»Ÿçš„é•œåƒæ¯”å¦‚<code>CentOS</code> <code>Ubuntu</code>ç­‰, ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªåº”ç”¨é•œåƒ, ç”¨æ¥åšäºŒæ¬¡å®šåˆ¶, æ¯”å¦‚ <code>nginx</code> <code>httpd</code> <code>mysql</code> ç­‰</li>
<li>dockerfileä¸­ä»¥<code>#</code>å¼€å¤´çš„è¡Œéƒ½å°†è§†ä¸ºæ³¨é‡Šï¼Œé™¤éæ˜¯ Parser directives è§£æå™¨æŒ‡ä»¤, è€Œä¸” dockerfile ä¸­ä¸æ”¯æŒè¿ç»­æ³¨é‡Š</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># Comment</span><br><span class="line">RUN echo &#39;we are running some # of cool things&#39;</span><br></pre></td></tr></table></figure>

<h1 id="ParserDirectives-è§£æå™¨æŒ‡ä»¤"><a href="#ParserDirectives-è§£æå™¨æŒ‡ä»¤" class="headerlink" title="ParserDirectives è§£æå™¨æŒ‡ä»¤"></a>ParserDirectives è§£æå™¨æŒ‡ä»¤</h1><p>è§£æå™¨æŒ‡ä»¤æ˜¯å¯é€‰çš„,  å¹¶ä¸”å½±å“å¤„ç† dockerfile ä¸­åç»­çš„æ‰§è¡Œæ–¹å¼. è§£æå™¨çš„æŒ‡ä»¤ä¸ä¼šå‘æ„å»ºä¸­æ·»åŠ å›¾å±‚, å¹¶ä¸”ä¸ä¼šæ˜¾ç¤ºåœ¨æ„å»ºçš„æ­¥éª¤å½“ä¸­. è§£æå™¨çš„æŒ‡ä»¤æ˜¯ä»¥ <code># directive = value</code> çš„å½¢å¼å†™æˆä¸€ç§ç‰¹æ®Šç±»å‹çš„æ³¨é‡Š, ä¸”å•ä¸ªæŒ‡ä»¤åªèƒ½ä½¿ç”¨ä¸€æ¬¡.(åˆ°ç›®å‰ä¸ºæ­¢ 2017/04/19 dockerfile åªæ”¯æŒä¸€ç§è§£æå™¨æŒ‡ä»¤)<br>å½“ docker é‡åˆ°æ™®é€šæ³¨é‡Šè¡Œæˆ–ç©ºè¡Œæˆ–æ˜¯å·²ç»è¢«æ‰§è¡Œè¿‡çš„è§£æå™¨æŒ‡ä»¤, docker éƒ½ä¸ä¼šå†å¯»æ‰¾ä»»ä½•è§£æå™¨çš„æŒ‡ä»¤. å› æ­¤, æ‰€æœ‰çš„è§£æå™¨æŒ‡ä»¤éƒ½å¿…é¡»ä½äº dockerfile çš„æœ€é¡¶ç«¯</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># escape&#x3D;&#96;</span><br><span class="line"></span><br><span class="line">FROM windowsservercore</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>ç›®å‰è§£æå™¨æŒ‡ä»¤åªæ”¯æŒ:</p>
<ul>
<li>escape</li>
</ul>
<h1 id="escape"><a href="#escape" class="headerlink" title="escape"></a>escape</h1><p>escape ä½œä¸º dockerfile è§£æå™¨ç›®å‰ä¸ºæ­¢å”¯ä¸€æ”¯æŒçš„æŒ‡ä»¤, ç›®å‰æœ‰ä»¥ä¸‹ä¸¤ç§ç”¨æ³•:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># escape&#x3D;\ (backslash)</span><br><span class="line">æˆ–è€…</span><br><span class="line"># escape&#x3D;&#96; (backtick)</span><br></pre></td></tr></table></figure>

<p>escape çš„ä½œç”¨æ˜¯å£°æ˜ dockerfile ä¸­çš„è½¬ä¹‰ç¬¦, åœ¨ä¸æŒ‡å®šçš„é»˜è®¤æƒ…å†µä¸‹,  è½¬ä¹‰ç¬¦æ˜¯åæ–œæ  <code>\</code> ä½†æ˜¯å¦‚æœæ˜¯åœ¨ Windows ä¸­, åæ–œæ æ˜¯æ­£å¸¸çš„è·¯å¾„åˆ†éš”ç¬¦, ä¸å±äºè½¬ä¹‰çš„èŒƒç•´, è¿™ç§æƒ…å†µä¸‹å°±éœ€è¦ä½¿ç”¨ä¸¤ä¸ªåæ–œæ  <code>\\</code> æ¥è¡¨ç¤ºä¸€ä¸ªè·¯å¾„ä¸­çš„åæ–œæ  <code>\</code></p>
<p>è½¬ä¹‰å­—ç¬¦æ—¢ç”¨äºè½¬ä¹‰è¡Œä¸­çš„å­—ç¬¦ï¼Œä¹Ÿç”¨äºè½¬ä¹‰æ¢è¡Œç¬¦. è¿™å…è®¸DockerfileæŒ‡ä»¤è·¨è¶Šå¤šè¡Œ. <strong>æ³¨æ„ï¼Œä¸ç®¡escapeè§£æå™¨æŒ‡ä»¤æ˜¯å¦åŒ…æ‹¬åœ¨Dockerfileä¸­ï¼Œåœ¨RUNå‘½ä»¤ä¸­ä¸æ‰§è¡Œè½¬ä¹‰ï¼Œé™¤éåœ¨è¡Œçš„æœ«å°¾, ç”¨æ¥è½¬ä¹‰æ¢è¡Œç¬¦</strong></p>
<p>è¯·è€ƒè™‘ä»¥ä¸‹ç¤ºä¾‹ï¼Œè¿™å°†åœ¨Windowsä¸Šä»¥éæ˜¾è€Œæ˜“è§çš„æ–¹å¼å¤±è´¥ã€‚ç¬¬äºŒè¡Œæœ«å°¾çš„ç¬¬äºŒä¸ª\å°†è¢«è§£é‡Šä¸ºæ¢è¡Œç¬¦ï¼Œè€Œä¸æ˜¯ä»ç¬¬ä¸€ä¸ª\è½¬ä¹‰çš„ç›®æ ‡ã€‚ç±»ä¼¼åœ°ï¼Œå‡è®¾ç¬¬ä¸‰è¡Œç»“å°¾å¤„çš„\å®é™…ä¸Šä½œä¸ºä¸€æ¡æŒ‡ä»¤å¤„ç†ï¼Œå®ƒå°†è¢«è§†ä¸ºè¡Œç»§ç»­ã€‚è¿™ä¸ªdockerfileçš„ç»“æœæ˜¯ç¬¬äºŒè¡Œå’Œç¬¬ä¸‰è¡Œè¢«è®¤ä¸ºæ˜¯å•ä¸ªæŒ‡ä»¤ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">FROM windowsservercore</span><br><span class="line">COPY testfile.txt c:\\</span><br><span class="line">RUN dir c:\</span><br><span class="line"></span><br><span class="line"># ç»“æœ:</span><br><span class="line">PS C:\John&gt; docker build -t cmd .</span><br><span class="line">Sending build context to Docker daemon 3.072 kB</span><br><span class="line">Step 1 : FROM windowsservercore</span><br><span class="line"> ---&gt; dbfee88ee9fd</span><br><span class="line">Step 2 : COPY testfile.txt c:RUN dir c:</span><br><span class="line">GetFileAttributesEx c:RUN: The system cannot find the file specified.</span><br><span class="line">PS C:\John&gt;</span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°çš„ä¸€ä¸ªè§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨<code>/</code>ä½œä¸º<code>COPY</code>æŒ‡ä»¤å’Œ<code>dir</code>çš„ç›®æ ‡. è¿™ç§è¯­æ³•, æœ€å¥½çš„æƒ…å†µæ˜¯æ··ä¹±, å› ä¸ºå®ƒåœ¨<code>Windows</code>ä¸Šæ˜¯ä¸å¹³å¸¸çš„è·¯å¾„, æœ€åçš„æƒ…å†µä¸‹, é”™è¯¯å€¾å‘, å› ä¸ºå¹¶ä¸æ˜¯<code>Windows</code>ä¸Šçš„æ‰€æœ‰å‘½ä»¤æ”¯æŒ<code>/</code>ä½œä¸ºè·¯å¾„åˆ†éš”ç¬¦.</p>
<p>é€šè¿‡æ·»åŠ è½¬ä¹‰è§£æå™¨æŒ‡ä»¤ï¼Œä¸‹é¢çš„Dockerfileåœ¨Windowsä¸Šä½¿ç”¨æ–‡ä»¶è·¯å¾„çš„è‡ªç„¶å¹³å°è¯­ä¹‰æˆåŠŸï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"># escape&#x3D;&#96;</span><br><span class="line"></span><br><span class="line">FROM windowsservercore</span><br><span class="line">COPY testfile.txt c:\</span><br><span class="line">RUN dir c:\</span><br><span class="line"></span><br><span class="line"># ç»“æœ</span><br><span class="line">PS C:\John&gt; docker build -t succeeds --no-cache&#x3D;true .</span><br><span class="line">Sending build context to Docker daemon 3.072 kB</span><br><span class="line">Step 1 : FROM windowsservercore</span><br><span class="line"> ---&gt; dbfee88ee9fd</span><br><span class="line">Step 2 : COPY testfile.txt c:\</span><br><span class="line"> ---&gt; 99ceb62e90df</span><br><span class="line">Removing intermediate container 62afbe726221</span><br><span class="line">Step 3 : RUN dir c:\</span><br><span class="line"> ---&gt; Running in a5ff53ad6323</span><br><span class="line"> Volume in drive C has no label.</span><br><span class="line"> Volume Serial Number is 1440-27FA</span><br><span class="line"></span><br><span class="line"> Directory of c:\</span><br><span class="line"></span><br><span class="line">03&#x2F;25&#x2F;2016  05:28 AM    &lt;DIR&gt;          inetpub</span><br><span class="line">03&#x2F;25&#x2F;2016  04:22 AM    &lt;DIR&gt;          PerfLogs</span><br><span class="line">04&#x2F;22&#x2F;2016  10:59 PM    &lt;DIR&gt;          Program Files</span><br><span class="line">03&#x2F;25&#x2F;2016  04:22 AM    &lt;DIR&gt;          Program Files (x86)</span><br><span class="line">04&#x2F;18&#x2F;2016  09:26 AM                 4 testfile.txt</span><br><span class="line">04&#x2F;22&#x2F;2016  10:59 PM    &lt;DIR&gt;          Users</span><br><span class="line">04&#x2F;22&#x2F;2016  10:59 PM    &lt;DIR&gt;          Windows</span><br><span class="line">               1 File(s)              4 bytes</span><br><span class="line">               6 Dir(s)  21,252,689,920 bytes free</span><br><span class="line"> ---&gt; 2569aa19abef</span><br><span class="line">Removing intermediate container a5ff53ad6323</span><br><span class="line">Successfully built 2569aa19abef</span><br><span class="line">PS C:\John&gt;</span><br></pre></td></tr></table></figure>

<h1 id="ENV-ç¯å¢ƒå˜é‡æ›¿æ¢"><a href="#ENV-ç¯å¢ƒå˜é‡æ›¿æ¢" class="headerlink" title="ENV ç¯å¢ƒå˜é‡æ›¿æ¢"></a>ENV ç¯å¢ƒå˜é‡æ›¿æ¢</h1><p>ç¯å¢ƒå˜é‡ä½¿ç”¨<code>ENV</code>å‘½ä»¤å£°æ˜, ä½¿ç”¨<code>$variable_name</code>æˆ–<code>${variable_name}</code>æ¥è°ƒç”¨, å¸¦å¤§æ‹¬å·çš„è¯­æ³•æ˜¯è¢«ç”¨æ¥è§£å†³ä¸å¸¦ç©ºæ ¼çš„å˜é‡åå­—é—®é¢˜, ä¾‹å¦‚:<code>${foo}_bar</code></p>
<p><code>${variable_name}</code>è¯­æ³•è¿˜æ”¯æŒä»¥ä¸‹æŒ‡å®šçš„ä¸€äº›æ ‡å‡†bashä¿®é¥°ç¬¦ï¼š</p>
<ul>
<li><code>${variable:-word}</code>è¡¨ç¤ºå¦‚æœè®¾ç½®äº†<code>variable</code>, åˆ™ç»“æœå°†æ˜¯è¯¥å€¼; å¦‚æœ<code>variable</code>æœªè®¾ç½®, é‚£ä¹ˆwordå°†æ˜¯ç»“æœ</li>
<li><code>${variable:+word}</code>è¡¨ç¤ºå¦‚æœè®¾ç½®äº†<code>variable</code>, é‚£ä¹ˆ<code>word</code>å°†æ˜¯ç»“æœ, å¦åˆ™ç»“æœæ˜¯ç©ºå­—ç¬¦ä¸²</li>
</ul>
<p>åœ¨æ‰€æœ‰æƒ…å†µä¸‹, <code>word</code>å¯ä»¥æ˜¯ä»»ä½•å­—ç¬¦ä¸², åŒ…æ‹¬é¢å¤–çš„ç¯å¢ƒå˜é‡</p>
<p>å¯ä»¥é€šè¿‡åœ¨å˜é‡ä¹‹å‰æ·»åŠ <code>\</code>æ¥è½¬ä¹‰: <code>\$foo</code>æˆ–<code>\${foo}</code>, åˆ†åˆ«è½¬æ¢ä¸º<code>$foo</code>å’Œ<code>${foo}</code></p>
<p>ç¤ºä¾‹ï¼ˆè§£æçš„è¡¨ç¤ºæ˜¾ç¤ºåœ¨#åé¢ï¼‰ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">FROM busybox</span><br><span class="line">ENV foo &#x2F;bar</span><br><span class="line">WORKDIR $&#123;foo&#125;   # WORKDIR &#x2F;bar</span><br><span class="line">ADD . $foo       # ADD . &#x2F;bar</span><br><span class="line">COPY \$foo &#x2F;quux # COPY $foo &#x2F;quux</span><br></pre></td></tr></table></figure>

<p>Dockerfileä¸­çš„ä»¥ä¸‹æŒ‡ä»¤åˆ—è¡¨æ”¯æŒç¯å¢ƒå˜é‡ï¼š</p>
<ul>
<li>ADD</li>
<li>COPY</li>
<li>ENV</li>
<li>EXPOSE</li>
<li>LABEL</li>
<li>USER</li>
<li>WORKDIR</li>
<li>VOLUME</li>
<li>STOPSIGNAL</li>
</ul>
<p>ä»¥åŠï¼š</p>
<ul>
<li>ONBUILDï¼ˆå½“ä¸ä¸Šé¢æ”¯æŒçš„æŒ‡ä»¤ä¹‹ä¸€ç»„åˆæ—¶ï¼‰</li>
</ul>
<p><strong>æ³¨æ„: åœ¨1.4ä¹‹å‰, ONBUILDæŒ‡ä»¤ä¸æ”¯æŒç¯å¢ƒå˜é‡, å³ä½¿ä¸ä¸Šé¢åˆ—å‡ºçš„ä»»ä½•æŒ‡ä»¤ç›¸ç»“åˆ</strong></p>
<p>åœ¨<code>ENV</code>çš„ä½¿ç”¨ä¸­, è¦ç‰¹åˆ«æ³¨æ„ä»¥ä¸‹æƒ…å†µ:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ENV abc&#x3D;hello</span><br><span class="line">ENV abc&#x3D;bye def&#x3D;$abc</span><br><span class="line">ENV ghi&#x3D;$abc</span><br></pre></td></tr></table></figure>

<p>æœ€ç»ˆçš„ç»“æœä¸º:</p>
<ul>
<li>def çš„å€¼ä¸º hello</li>
<li>ghi çš„å€¼ä¸º bye</li>
</ul>
<p>ä¸ºä»€ä¹ˆ<code>def</code>çš„å€¼ä¸æ˜¯<code>bye</code>å‘¢? å› ä¸ºç¬¬ä¸€è¡Œè®¾ç½®<code>abc</code>å˜é‡çš„å€¼ä¸º<code>hello</code>å, åˆ°ç¬¬äºŒè¡Œæ‰§è¡Œçš„æ—¶å€™, é¦–å…ˆè¿›è¡Œå˜é‡çš„æ¸²æŸ“(æ›¿æ¢), ç„¶åå†æ‰§è¡Œç¯å¢ƒå˜é‡çš„è®¾ç½®</p>
<h1 id="dockerignore"><a href="#dockerignore" class="headerlink" title=".dockerignore"></a>.dockerignore</h1><p>dockeræ‰§è¡Œæ„å»ºå, ä¼šé¦–å…ˆå»æ ¹ç›®å½•ä¸­æŸ¥æ‰¾<code>.dockerignore</code>æ–‡ä»¶, ç”±äºåœ¨æ„å»ºçš„æ—¶å€™, docker ä¼šé€’å½’ç´¢å¼•å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶, ä¸ºäº†é¿å…ç´¢å¼•ä¸å¿…è¦çš„ç›®å½•, å¯ä»¥ä½¿ç”¨<code>.dockerignore</code>æ–‡ä»¶å£°æ˜ä¸éœ€è¦ç´¢å¼•çš„ç›®å½•</p>
<ul>
<li><code>#</code> æ³¨é‡Š</li>
<li><code>*</code> ä»»æ„å¤šä¸ªå­—ç¬¦</li>
<li><code>?</code> ä»»æ„ä¸€ä¸ªå­—ç¬¦</li>
<li><code>!</code> å¼‚å¸¸æ¨¡å¼, ç”¨äºæ’é™¤ä¾‹å¤–</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># comment</span><br><span class="line">    *&#x2F;temp*</span><br><span class="line">    *&#x2F;*&#x2F;temp*</span><br><span class="line">    temp?</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">*.md</span><br><span class="line">!README.md</span><br></pre></td></tr></table></figure>

<h1 id="FORM"><a href="#FORM" class="headerlink" title="FORM"></a>FORM</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">FROM &lt;image&gt;</span><br><span class="line"># æˆ–åˆ™</span><br><span class="line">FROM &lt;image&gt;:&lt;tag&gt;</span><br><span class="line"># æˆ–åˆ™</span><br><span class="line">FROM &lt;image&gt;@&lt;digest&gt;</span><br></pre></td></tr></table></figure>

<p><code>FROM</code>æŒ‡ä»¤ä¸ºåç»­æŒ‡ä»¤è®¾ç½®Base Image. å› æ­¤, æœ‰æ•ˆçš„Dockerfileå¿…é¡»å…·æœ‰<code>FROM</code>ä½œä¸ºå…¶ç¬¬ä¸€æ¡æŒ‡ä»¤. imageå¯ä»¥æ˜¯ä»»ä½•æœ‰æ•ˆçš„image, å¯ä»¥ä»é•œåƒä»“åº“ä¸­æ‹‰å–é•œåƒ.</p>
<ul>
<li>FROMå¿…é¡»æ˜¯Dockerfileä¸­çš„ç¬¬ä¸€ä¸ªéæ³¨é‡ŠæŒ‡ä»¤</li>
<li>FROMå¯ä»¥åœ¨å•ä¸ªDockerfileä¸­å¤šæ¬¡å‡ºç°ï¼Œä»¥åˆ›å»ºå¤šä¸ªé•œåƒã€‚æ¯ä¸ªæ–°çš„FROMå‘½ä»¤ä¹‹å‰ä¼šè¾“å‡ºæœ€ä¸€ä¸ªimage ID</li>
<li>tagæˆ–digestæ˜¯å¯é€‰çš„. å¦‚æœçœç•¥å…¶ä¸­ä»»ä½•ä¸€ä¸ª, æ„å»ºå™¨å°†é»˜è®¤ä½¿ç”¨latest. å¦‚æœæ„å»ºå™¨ä¸tagå€¼ä¸åŒ¹é…, åˆ™æ„å»ºå™¨å°†è¿”å›é”™è¯¯</li>
</ul>
<h1 id="RUN"><a href="#RUN" class="headerlink" title="RUN"></a>RUN</h1><p>RUN æŒ‡ä»¤æœ‰ä¸¤ç§è¿è¡Œæ–¹å¼:</p>
<ul>
<li>RUN <command> (shell form, the command is run in a shell, which by default is /bin/sh -c on Linux or cmd /S /C on Windows)</li>
<li>RUN [â€œexecutableâ€, â€œparam1â€, â€œparam2â€] (exec form)</li>
</ul>
<p><code>RUN</code>æŒ‡ä»¤å°†åœ¨å½“å‰imageä¹‹ä¸Šçš„æ–°å±‚ä¸­æ‰§è¡Œä»»ä½•å‘½ä»¤, å¹¶æäº¤ç»“æœ. ç”Ÿæˆçš„å·²æäº¤imageå°†ç”¨äºDockerfileä¸­çš„ä¸‹ä¸€æ­¥</p>
<p>execå½¢å¼ä½¿å¾—å¯ä»¥é¿å…shellå­—ç¬¦ä¸²å˜åŒ–, ä»¥åŠä½¿ç”¨ä¸åŒ…å«æŒ‡å®šçš„shellå¯æ‰§è¡Œæ–‡ä»¶çš„åŸºæœ¬imageæ¥è¿è¡ŒRUNå‘½ä»¤</p>
<p>åœ¨shellå½¢å¼ä¸­ï¼Œå¯ä»¥ä½¿ç”¨\ï¼ˆåæ–œæ ï¼‰å°†å•ä¸ªRUNæŒ‡ä»¤ç»§ç»­åˆ°ä¸‹ä¸€è¡Œ, è¿™ä¹Ÿæ˜¯å¤§éƒ¨åˆ† dockerfile ä½¿ç”¨çš„å½¢å¼</p>
<p>åœ¨<code>RUN</code>å‘½ä»¤çš„ä½¿ç”¨ä¸­, éœ€è¦æ³¨æ„ä¸€ä¸‹å‡ ç‚¹:</p>
<ul>
<li>è¦ä½¿ç”¨ä¸åŒçš„shellï¼Œè€Œä¸æ˜¯â€™/bin/shâ€™ï¼Œè¯·ä½¿ç”¨åœ¨æ‰€éœ€shellä¸­ä¼ é€’çš„execå½¢å¼ã€‚ä¾‹å¦‚ï¼ŒRUN [â€œ/bin/bashâ€,â€œ-câ€,â€œecho helloâ€]</li>
<li>execå½¢å¼ä½œä¸ºJSONæ•°ç»„è§£æï¼Œè¿™æ„å‘³ç€ä½ å¿…é¡»åœ¨å•è¯ä¹‹å¤–å¿…é¡»è¦ä½¿ç”¨åŒå¼•å·<code>&quot;</code> è€Œä¸æ˜¯å•å¼•å·<code>&#39;</code></li>
<li>ä¸ shell æ‰§è¡Œçš„æ–¹å¼ä¸åŒ, exec æ‰§è¡Œæ–¹å¼ä¸è°ƒç”¨å‘½ä»¤ shell. è¿™æ„å‘³ç€æ­£å¸¸çš„ shell å¤„ç†ä¸ä¼šå‘ç”Ÿ. ä¾‹å¦‚, <code>RUN [&quot;echo&quot;,&quot;$HOME&quot;]</code>ä¸ä¼šåœ¨<code>$HOME</code>ä¸Šè¿›è¡Œå¯å˜æ›¿æ¢. å¦‚æœä½ æƒ³è¦shellå¤„ç†ï¼Œé‚£ä¹ˆä½¿ç”¨shellå½¢å¼æˆ–ç›´æ¥æ‰§è¡Œä¸€ä¸ªshellï¼Œä¾‹å¦‚, <code>RUN [&quot;sh&quot;,&quot;-c&quot;,&quot;echo $HOME&quot;]</code> </li>
<li>åœ¨JSONå½¢å¼ä¸­, æœ‰å¿…è¦è½¬ä¹‰åæ–œæ . è¿™åœ¨Windowsä¸Šç‰¹åˆ«ç›¸å…³, å…¶ä¸­åæ–œæ æ˜¯è·¯å¾„åˆ†éš”ç¬¦. å› ä¸ºä¸æ˜¯æœ‰æ•ˆçš„JSON, å¹¶ä¸”ä»¥æ„å¤–çš„æ–¹å¼å¤±è´¥, ä»¥ä¸‹è¡Œå°†è¢«è§†ä¸ºshellå½¢å¼: <code>RUN [&quot;c:\windows\system32\tasklist.exe&quot;]</code> æ­¤ç¤ºä¾‹çš„æ­£ç¡®è¯­æ³•ä¸º: <code>RUN [&quot;c:\\windows\\system32\\tasklist.exe&quot;]</code></li>
</ul>
<p>ç”¨äº<code>RUN</code>æŒ‡ä»¤çš„é«˜é€Ÿç¼“å­˜åœ¨ä¸‹ä¸€æ¬¡æ„å»ºæœŸé—´ä¸ä¼šè‡ªåŠ¨å¤±æ•ˆ. ç”¨äºè¯¸å¦‚<code>RUN apt-get dist-upgrade</code>ä¹‹ç±»çš„æŒ‡ä»¤çš„é«˜é€Ÿç¼“å­˜å°†åœ¨ä¸‹ä¸€æ¬¡æ„å»ºæœŸé—´è¢«é‡ç”¨. å¯ä»¥é€šè¿‡ä½¿ç”¨<code>--no-cache</code>æ ‡å¿—æ¥ä½¿ç”¨äº<code>RUN</code>æŒ‡ä»¤çš„é«˜é€Ÿç¼“å­˜æ— æ•ˆ, ä¾‹å¦‚ <code>docker build --no-cache</code></p>
<p><strong>Known issuesï¼ˆRUN</strong></p>
<p>Issue 783æ˜¯å…³äºåœ¨ä½¿ç”¨AUFSæ–‡ä»¶ç³»ç»Ÿæ—¶å¯èƒ½å‘ç”Ÿçš„æ–‡ä»¶æƒé™é—®é¢˜ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯èƒ½ä¼šåœ¨å°è¯•rmæ–‡ä»¶æ—¶æ³¨æ„åˆ°å®ƒã€‚å¯¹äºå…·æœ‰æœ€è¿‘aufsç‰ˆæœ¬çš„ç³»ç»Ÿï¼ˆå³ï¼Œå¯ä»¥è®¾ç½®dirperm1å®‰è£…é€‰é¡¹ï¼‰ï¼Œdockerå°†å°è¯•é€šè¿‡ä½¿ç”¨dirperm1é€‰é¡¹å®‰è£…imageæ¥è‡ªåŠ¨è§£å†³é—®é¢˜ã€‚</p>
<h1 id="MAINTAINER-ä½œè€…ä¿¡æ¯-å·²åºŸå¼ƒ"><a href="#MAINTAINER-ä½œè€…ä¿¡æ¯-å·²åºŸå¼ƒ" class="headerlink" title="MAINTAINER ä½œè€…ä¿¡æ¯(å·²åºŸå¼ƒ)"></a>MAINTAINER ä½œè€…ä¿¡æ¯(å·²åºŸå¼ƒ)</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MAINTAINER &lt;name&gt;</span><br></pre></td></tr></table></figure>

<p>MAINTAINERæŒ‡ä»¤å…è®¸æ‚¨è®¾ç½®ç”Ÿæˆçš„imagesçš„ä½œè€…å­—æ®µ</p>
<p>åœ¨æ–°çš„ docker ç‰ˆæœ¬ä¸­, è¯¥æŒ‡ä»¤å°†è¢«<code>LABEL</code>æ›¿ä»£</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LABEL maintainer &quot;SvenDowideit@home.org.au&quot;</span><br></pre></td></tr></table></figure>

<h1 id="CMD"><a href="#CMD" class="headerlink" title="CMD"></a>CMD</h1><p>CMDæŒ‡ä»¤ä¸‰ç§å½¢å¼ï¼š</p>
<ul>
<li>CMD [â€œexecutableâ€,â€param1â€,â€param2â€] (execæ ¼å¼, é¦–é€‰å½¢å¼)</li>
<li>CMD [â€œparam1â€,â€param2â€] (ä½œä¸º ENTRYPOINT æŒ‡ä»¤çš„é»˜è®¤å‚æ•°)</li>
<li>CMD command param1 param2 (shell æ ¼å¼)</li>
</ul>
<p>åœ¨Dockerfileä¸­åªèƒ½æœ‰ä¸€ä¸ª<code>CMD</code>æŒ‡ä»¤. å¦‚æœåˆ—å‡ºäº†å¤šä¸ª<code>CMD</code>, åˆ™åªæœ‰æœ€åä¸€ä¸ª<code>CMD</code>ç”Ÿæ•ˆ</p>
<p><code>CMD</code>çš„ä¸»è¦ç›®çš„æ˜¯ä¸ºæ‰§è¡Œå®¹å™¨æä¾›é»˜è®¤å€¼. è¿™äº›é»˜è®¤å€¼å¯ä»¥åŒ…æ‹¬å¯æ‰§è¡Œæ–‡ä»¶, æˆ–è€…å®ƒä»¬å¯ä»¥çœç•¥å¯æ‰§è¡Œæ–‡ä»¶, åœ¨è¿™ç§æƒ…å†µä¸‹, ä½ è¿˜å¿…é¡»æŒ‡å®š<code>ENTRYPOINT</code>æŒ‡ä»¤</p>
<p>å½“ä»¥shellæˆ–execæ ¼å¼ä½¿ç”¨æ—¶ï¼Œ<code>CMD</code>æŒ‡ä»¤è®¾ç½®è¿è¡Œimageæ—¶è¦æ‰§è¡Œçš„å‘½ä»¤</p>
<p>å¦‚æœä½¿ç”¨CMDçš„shellå½¢å¼ï¼Œé‚£ä¹ˆ<command>å°†åœ¨/bin/sh -cä¸­æ‰§è¡Œï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">FROM ubuntu</span><br><span class="line">CMD echo &quot;This is a test.&quot; | wc -</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½ æƒ³è¿è¡Œä½ çš„<command>æ²¡æœ‰shellï¼Œé‚£ä¹ˆä½ å¿…é¡»å°†è¯¥å‘½ä»¤è¡¨ç¤ºä¸ºä¸€ä¸ªJSONæ•°ç»„ï¼Œå¹¶ç»™å‡ºå¯æ‰§è¡Œæ–‡ä»¶çš„å®Œæ•´è·¯å¾„ã€‚æ­¤æ•°ç»„å½¢å¼æ˜¯CMDçš„é¦–é€‰æ ¼å¼ã€‚ä»»ä½•å…¶ä»–å‚æ•°å¿…é¡»å•ç‹¬è¡¨ç¤ºä¸ºæ•°ç»„ä¸­çš„å­—ç¬¦ä¸²(æ³¨æ„ä½¿ç”¨åŒå¼•å·)ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">FROM ubuntu</span><br><span class="line">CMD [&quot;&#x2F;usr&#x2F;bin&#x2F;wc&quot;,&quot;--help&quot;]</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½ å¸Œæœ›ä½ çš„å®¹å™¨æ¯æ¬¡è¿è¡Œç›¸åŒçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œé‚£ä¹ˆä½ åº”è¯¥è€ƒè™‘ä½¿ç”¨ENTRYPOINTç»“åˆCMD</p>
<p>å¦‚æœç”¨æˆ·æŒ‡å®šdocker runå‚æ•°ï¼Œé‚£ä¹ˆå®ƒä»¬å°†è¦†ç›–CMDä¸­æŒ‡å®šçš„é»˜è®¤å€¼</p>
<p><strong>æ³¨æ„:</strong></p>
<ul>
<li>ä¸è¦å°†RUNå’ŒCMDæ··æ·†. RUNå®é™…ä¸Šè¿è¡Œä¸€ä¸ªå‘½ä»¤å¹¶æäº¤ç»“æœ;CMDåœ¨æ„å»ºæ—¶ä¸æ‰§è¡Œä»»ä½•æ“ä½œ, ä½†æŒ‡å®šäº†imageçš„é¢„æœŸå‘½ä»¤</li>
<li>å¦‚æœä½¿ç”¨CMDä¸ºENTRYPOINTæŒ‡ä»¤æä¾›é»˜è®¤å‚æ•°, CMDå’ŒENTRYPOINTæŒ‡ä»¤éƒ½åº”ä»¥JSONæ•°ç»„æ ¼å¼æŒ‡å®š</li>
<li>execå½¢å¼ä½œä¸ºJSONæ•°ç»„è§£æ, è¿™æ„å‘³ç€æ‚¨å¿…é¡»åœ¨å•è¯ä¹‹å¤–ä½¿ç”¨åŒå¼•å·<code>&quot;</code>è€Œä¸æ˜¯å•å¼•å·<code>&#39;</code></li>
<li>ä¸shellè¡¨å•ä¸åŒ, execè¡¨å•ä¸è°ƒç”¨å‘½ä»¤shell. è¿™æ„å‘³ç€æ­£å¸¸çš„shellå¤„ç†ä¸ä¼šå‘ç”Ÿ. ä¾‹å¦‚, <code>CMD [&quot;echo&quot;ï¼Œ&quot;$HOME&quot;]</code> ä¸ä¼šåœ¨<code>$HOME</code>ä¸Šè¿›è¡Œå¯å˜æ›¿æ¢. å¦‚æœä½ æƒ³è¦shellå¤„ç†, é‚£ä¹ˆä½¿ç”¨shellå½¢å¼æˆ–ç›´æ¥æ‰§è¡Œä¸€ä¸ªshell, ä¾‹å¦‚: <code>CMD [&quot;sh&quot;,&quot;-c&quot;,&quot;echo $HOME&quot;]</code></li>
</ul>
<h1 id="LABEL"><a href="#LABEL" class="headerlink" title="LABEL"></a>LABEL</h1><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">LABEL</span><span class="bash"> &lt;key&gt;=&lt;value&gt; &lt;key&gt;=&lt;value&gt; &lt;key&gt;=&lt;value&gt; ...</span></span><br><span class="line">æˆ–</span><br><span class="line"><span class="keyword">LABEL</span><span class="bash"> &lt;key&gt;=&lt;value&gt;</span></span><br><span class="line"><span class="keyword">LABEL</span><span class="bash"> &lt;key&gt;=&lt;value&gt;</span></span><br><span class="line"><span class="keyword">LABEL</span><span class="bash"> &lt;key&gt;=&lt;value&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>LABEL</code> æŒ‡ä»¤å‘imageæ·»åŠ å…ƒæ•°æ®. LABELæ˜¯é”®å€¼å¯¹. è¦åœ¨LABELå€¼ä¸­åŒ…å«ç©ºæ ¼, éœ€è¦ä½¿ç”¨å¼•å·å’Œåæ–œæ , å°±åƒåœ¨å‘½ä»¤è¡Œè§£æä¸­ä¸€æ ·</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">LABEL</span><span class="bash"> <span class="string">"com.example.vendor"</span>=<span class="string">"ACME Incorporated"</span></span></span><br><span class="line"><span class="keyword">LABEL</span><span class="bash"> com.example.label-with-value=<span class="string">"foo"</span></span></span><br><span class="line"><span class="keyword">LABEL</span><span class="bash"> version=<span class="string">"1.0"</span></span></span><br><span class="line"><span class="keyword">LABEL</span><span class="bash"> description=<span class="string">"This text illustrates \</span></span></span><br><span class="line"><span class="bash">that label-values can span multiple lines.<span class="string">"</span></span></span><br></pre></td></tr></table></figure>

<p>ä¸€ä¸ª<code>image</code>å¯ä»¥æœ‰å¤šä¸ª<code>label</code>. è¦æŒ‡å®šå¤šä¸ª<code>label</code>, Dockerå»ºè®®åœ¨å¯èƒ½çš„æƒ…å†µä¸‹å°†æ ‡ç­¾åˆå¹¶åˆ°å•ä¸ª<code>LABEL</code>æŒ‡ä»¤ä¸­. æ¯ä¸ª<code>LABEL</code>æŒ‡ä»¤äº§ç”Ÿä¸€ä¸ªæ–°å±‚, å¦‚æœä½¿ç”¨è®¸å¤šæ ‡ç­¾, å¯èƒ½ä¼šå¯¼è‡´é•œåƒçš„æ•ˆç‡ä½ä¸‹. è¯¥ç¤ºä¾‹äº§ç”Ÿå•ä¸ªé•œåƒå±‚</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">LABEL</span><span class="bash"> multi.label1=<span class="string">"value1"</span> multi.label2=<span class="string">"value2"</span> other=<span class="string">"value3"</span></span></span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„ä¹Ÿå¯å†™ä¸ºï¼š</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">LABEL</span><span class="bash"> multi.label1=<span class="string">"value1"</span> \</span></span><br><span class="line"><span class="bash">      multi.label2=<span class="string">"value2"</span> \</span></span><br><span class="line"><span class="bash">      other=<span class="string">"value3"</span></span></span><br></pre></td></tr></table></figure>

<p><strong>å¦‚æœDockeré‡åˆ°å·²ç»å­˜åœ¨çš„label/keyï¼Œåˆ™æ–°å€¼å°†è¦†ç›–å…·æœ‰ç›¸åŒé”®çš„ä»»ä½•å…ˆå‰æ ‡ç­¾</strong></p>
<h1 id="EXPOSE"><a href="#EXPOSE" class="headerlink" title="EXPOSE"></a>EXPOSE</h1><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">EXPOSE</span> &lt;port&gt; [&lt;port&gt;...]</span><br></pre></td></tr></table></figure>

<p><code>EXPOSE</code>æŒ‡ä»¤é€šçŸ¥Dockerå®¹å™¨åœ¨è¿è¡Œæ—¶ç›‘å¬æŒ‡å®šçš„ç½‘ç»œç«¯å£. <code>EXPOSE</code>ä¸ä½¿ä¸»æœºçš„å®¹å™¨çš„ç«¯å£å¯è®¿é—®, ä¸ºæ­¤, å¿…é¡»ä½¿ç”¨<code>-p</code>æ ‡å¿—å‘å¸ƒä¸€ç³»åˆ—ç«¯å£, æˆ–è€…ä½¿ç”¨<code>-P</code>æ ‡å¿—å‘å¸ƒæ‰€æœ‰æš´éœ²çš„ç«¯å£ã€‚å¯ä»¥å…¬å¼€ä¸€ä¸ªç«¯å£å·ï¼Œå¹¶ç”¨å¦ä¸€ä¸ªç«¯å£å·åœ¨å¤–éƒ¨å‘å¸ƒ</p>
<p>è¿™é‡ŒæŒ‡å®šçš„æ‰€æœ‰ç«¯å£éƒ½æ˜¯å®¹å™¨å†…éƒ¨å£°æ˜å®¹å™¨è¿è¡Œåè¦ç›‘å¬çš„ç«¯å£, ä¸èƒ½åœ¨è¿™é‡Œå®šä¹‰å®¿ä¸»æœºä¸å®¹å™¨ä¹‹é—´ç«¯å£çš„å¯¹åº”å…³ç³»! æ¯”å¦‚ä¸€ä¸ª nginx çš„é•œåƒ, å†…éƒ¨ç›‘å¬80ç«¯å£, åœ¨å®¹å™¨è¿è¡Œä¹‹å, ä½ æƒ³æ˜ å°„åˆ°8080ç«¯å£, æ­¤æ—¶åœ¨ dockerfile ä¸­å†™ 8080:80 æ˜¯æ²¡æœ‰ä»»ä½•æ„ä¹‰çš„, é•œåƒ(dockerfile)é‡Œçš„å£°æ˜çš„ç«¯å£ä¸å®¹å™¨è¿è¡ŒæŒ‡å®šçš„ç«¯å£æ˜¯åˆ†å¼€çš„, ä¸èƒ½åœ¨ dockerfile ä¸­æŒ‡å®šæœªæ¥å®¹å™¨è¿è¡Œæ—¶æ˜ å°„çš„ç«¯å£</p>
<h1 id="ENV"><a href="#ENV" class="headerlink" title="ENV"></a>ENV</h1><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ENV</span> &lt;key&gt; &lt;value&gt;</span><br><span class="line"><span class="keyword">ENV</span> &lt;key&gt;=&lt;value&gt; ... (é¦–é€‰å½¢å¼)</span><br></pre></td></tr></table></figure>

<ul>
<li>ç¬¬ä¸€ç§å½¢å¼åªèƒ½è®¾ç½®ä¸€ä¸ªç¯å¢ƒå˜é‡</li>
<li>ç¬¬äºŒç§å½¢å¼å¯ä»¥åœ¨ä¸€ä¸ªé«˜é€Ÿç¼“å­˜å±‚ä¸­è®¾ç½®å¤šä¸ªå˜é‡, å³ä½¿æ˜¯ä¸€ä¸ªå˜é‡è¦è®¾ç½®ä¹Ÿæ¨èä½¿ç”¨è¿™ç§æ¨¡å¼æ¥è®¾ç½®</li>
</ul>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ENV</span> myName=<span class="string">"John Doe"</span> myDog=Rex\ The\ Dog \</span><br><span class="line">    myCat=fluffy</span><br><span class="line"><span class="comment"># å’Œ</span></span><br><span class="line"><span class="keyword">ENV</span> myName John Doe</span><br><span class="line"><span class="keyword">ENV</span> myDog Rex The Dog</span><br><span class="line"><span class="keyword">ENV</span> myCat fluffy</span><br></pre></td></tr></table></figure>

<p>å°†åœ¨æœ€ç»ˆå®¹å™¨ä¸­äº§ç”Ÿç›¸åŒçš„ç»“æœï¼Œä½†ç¬¬ä¸€ç§å½¢å¼æ˜¯ä¼˜é€‰çš„ï¼Œå› ä¸ºå®ƒäº§ç”Ÿå•ä¸ªé«˜é€Ÿç¼“å­˜å±‚</p>
<h1 id="ADD"><a href="#ADD" class="headerlink" title="ADD"></a>ADD</h1><p>ä¸¤ç§å½¢å¼ï¼š</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ADD</span><span class="bash"> &lt;src&gt;... &lt;dest&gt;</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> [<span class="string">"&lt;src&gt;"</span>,... <span class="string">"&lt;dest&gt;"</span>] (å¯¹äºåŒ…å«ç©ºæ ¼çš„è·¯å¾„ï¼Œæ­¤å½¢å¼æ˜¯å¿…éœ€çš„)</span></span><br></pre></td></tr></table></figure>

<p><code>ADD</code> æŒ‡ä»¤ä»<src>å¤åˆ¶æ–°æ–‡ä»¶, ç›®å½•æˆ–è¿œç¨‹æ–‡ä»¶<code>URL</code>, å¹¶å°†å®ƒä»¬æ·»åŠ åˆ°å®¹å™¨çš„æ–‡ä»¶ç³»ç»Ÿ, è·¯å¾„<dest></p>
<p>å¯ä»¥æŒ‡å®šå¤šä¸ª<src>èµ„æº, ä½†å¦‚æœå®ƒä»¬æ˜¯æ–‡ä»¶æˆ–ç›®å½•, é‚£ä¹ˆå®ƒä»¬å¿…é¡»æ˜¯ç›¸å¯¹äºæ­£åœ¨æ„å»ºçš„æºç›®å½•</p>
<p>æ¯ä¸ª<src>å¯èƒ½åŒ…å«é€šé…ç¬¦, åŒ¹é…å°†ä½¿ç”¨Goçš„filepath.Matchè§„åˆ™å®Œæˆ. ä¾‹å¦‚ï¼š</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ADD</span><span class="bash"> hom* /mydir/        <span class="comment"># adds all files starting with "hom"</span></span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> hom?.txt /mydir/    <span class="comment"># ? is replaced with any single character, e.g., "home.txt"</span></span></span><br></pre></td></tr></table></figure>

<p><dest>æ˜¯ç»å¯¹è·¯å¾„æˆ–ç›¸å¯¹äº<code>WORKDIR</code>çš„è·¯å¾„, æºå°†åœ¨ç›®æ ‡å®¹å™¨ä¸­å¤åˆ¶åˆ°å…¶ä¸­</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ADD</span><span class="bash"> <span class="built_in">test</span> relativeDir/          <span class="comment"># adds "test" to `WORKDIR`/relativeDir/</span></span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> <span class="built_in">test</span> /absoluteDir/         <span class="comment"># adds "test" to /absoluteDir/</span></span></span><br></pre></td></tr></table></figure>

<p>æ‰€æœ‰æ–°æ–‡ä»¶å’Œç›®å½•éƒ½ä½¿ç”¨UIDå’ŒGIDä¸º0åˆ›å»º</p>
<p><strong>ADDéµå®ˆä»¥ä¸‹è§„åˆ™ï¼š</strong></p>
<ul>
<li><p><src>è·¯å¾„å¿…é¡»åœ¨æ„å»ºçš„ä¸Šä¸‹æ–‡ä¸­, ä¸èƒ½<code>ADD ../something /something</code> å› ä¸ºdockeræ„å»ºçš„ç¬¬ä¸€æ­¥æ˜¯å‘é€ä¸Šä¸‹æ–‡ç›®å½•ï¼ˆå’Œå­ç›®å½•ï¼‰åˆ°dockerå®ˆæŠ¤è¿›ç¨‹. </p>
</li>
<li><p>å¦‚æœ<src>æ˜¯URLå¹¶ä¸”<dest>ä¸ä»¥å°¾éƒ¨æ–œæ ç»“å°¾ï¼Œåˆ™ä»URLä¸‹è½½æ–‡ä»¶å¹¶å°†å…¶å¤åˆ¶åˆ°<dest></p>
</li>
<li><p>å¦‚æœ<src>æ˜¯URLå¹¶ä¸”<dest>ä»¥å°¾éƒ¨æ–œæ ç»“å°¾ï¼Œåˆ™ä»URLä¸­æ¨æ–­æ–‡ä»¶åï¼Œå¹¶å°†æ–‡ä»¶ä¸‹è½½åˆ°<dest>/<filename> ä¾‹å¦‚, <code>ADD http://example.com/foobar /</code>ä¼šåˆ›å»ºæ–‡ä»¶<code>/foobar</code> ç½‘å€å¿…é¡»æœ‰ä¸€ä¸ªéæ™®é€šçš„è·¯å¾„, ä»¥ä¾¿åœ¨è¿™ç§æƒ…å†µä¸‹å¯ä»¥å‘ç°ä¸€ä¸ªé€‚å½“çš„æ–‡ä»¶å<code>http://example.comä¸ä¼šå·¥ä½œ</code></p>
</li>
<li><p>å¦‚æœ<src>æ˜¯ç›®å½•, åˆ™å¤åˆ¶ç›®å½•çš„æ•´ä¸ªå†…å®¹, åŒ…æ‹¬æ–‡ä»¶ç³»ç»Ÿå…ƒæ•°æ®<br><strong>æ³¨æ„ï¼šç›®å½•æœ¬èº«ä¸è¢«å¤åˆ¶ï¼Œåªæ˜¯å…¶å†…å®¹</strong></p>
</li>
<li><p>å¦‚æœ<src>æ˜¯è¯†åˆ«çš„å‹ç¼©æ ¼å¼ï¼ˆidentityï¼Œgzipï¼Œbzip2æˆ–xzï¼‰çš„æœ¬åœ°tarå­˜æ¡£ï¼Œåˆ™å°†å…¶è§£åŒ…ä¸ºç›®å½•. æ¥è‡ªè¿œç¨‹URLçš„èµ„æºä¸ä¼šè§£å‹ç¼©. å½“ç›®å½•è¢«å¤åˆ¶æˆ–è§£å‹ç¼©æ—¶, å®ƒå…·æœ‰ä¸tar -xç›¸åŒçš„è¡Œä¸º<br><strong>æ³¨æ„ï¼šæ–‡ä»¶æ˜¯å¦è¢«è¯†åˆ«ä¸ºè¯†åˆ«çš„å‹ç¼©æ ¼å¼, ä»…åŸºäºæ–‡ä»¶çš„å†…å®¹, è€Œä¸æ˜¯æ–‡ä»¶çš„åç§°. ä¾‹å¦‚, å¦‚æœä¸€ä¸ªç©ºæ–‡ä»¶ä»¥<code>.tar.gz</code>ç»“å°¾, åˆ™ä¸ä¼šè¢«è¯†åˆ«ä¸ºå‹ç¼©æ–‡ä»¶, å¹¶ä¸”ä¸ä¼šç”Ÿæˆä»»ä½•è§£å‹ç¼©é”™è¯¯æ¶ˆæ¯, è€Œæ˜¯å°†è¯¥æ–‡ä»¶ç®€å•åœ°å¤åˆ¶åˆ°ç›®çš„åœ°</strong></p>
</li>
<li><p>å¦‚æœ<src>æ˜¯ä»»ä½•å…¶ä»–ç±»å‹çš„æ–‡ä»¶, å®ƒä¼šä¸å…¶å…ƒæ•°æ®ä¸€èµ·å•ç‹¬å¤åˆ¶. åœ¨è¿™ç§æƒ…å†µä¸‹, å¦‚æœ<dest>ä»¥å°¾éƒ¨æ–œæ <code>/</code>ç»“å°¾ï¼Œå®ƒå°†è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªç›®å½•, å¹¶ä¸”<src>çš„å†…å®¹å°†è¢«å†™åœ¨<dest>/base(<src>)</p>
</li>
<li><p>å¦‚æœç›´æ¥æˆ–ç”±äºä½¿ç”¨é€šé…ç¬¦æŒ‡å®šäº†å¤šä¸ª<src>èµ„æº, åˆ™<dest>å¿…é¡»æ˜¯ç›®å½•, å¹¶ä¸”å¿…é¡»ä»¥æ–œæ <code>/</code>ç»“å°¾</p>
</li>
<li><p>å¦‚æœ<dest>ä¸ä»¥å°¾éƒ¨æ–œæ ç»“å°¾ï¼Œå®ƒå°†è¢«è§†ä¸ºå¸¸è§„æ–‡ä»¶ï¼Œ<src>çš„å†…å®¹å°†å†™åœ¨<dest></p>
</li>
<li><p>å¦‚æœ<dest>ä¸å­˜åœ¨, åˆ™ä¼šä¸å…¶è·¯å¾„ä¸­çš„æ‰€æœ‰ç¼ºå°‘çš„ç›®å½•ä¸€èµ·åˆ›å»º</p>
</li>
</ul>
<h1 id="COPY"><a href="#COPY" class="headerlink" title="COPY"></a>COPY</h1><p>ä¸¤ç§å½¢å¼ï¼š</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">COPY</span><span class="bash"> &lt;src&gt;... &lt;dest&gt;</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> [<span class="string">"&lt;src&gt;"</span>,... <span class="string">"&lt;dest&gt;"</span>] (this form is required <span class="keyword">for</span> paths containing whitespace)</span></span><br></pre></td></tr></table></figure>

<p>åŸºæœ¬å’ŒADDç±»ä¼¼ï¼Œä¸è¿‡COPYçš„<src>ä¸èƒ½ä¸ºURL</p>
<p>ä¸ ADD ä¸åŒçš„ä¸€ç‚¹æ˜¯, é‡åˆ°å‹ç¼©æ–‡ä»¶, COPY ä¸ä¼šå»æ£€æµ‹æ–‡ä»¶çš„å‹ç¼©å±æ€§, ä¸ä¼šåšä»»ä½•çš„è§£å‹ç¼©æ“ä½œ, ä¼šç›´æ¥æŠŠæºæ–‡ä»¶åŸå°ä¸åŠ¨çš„æ‹·è´åˆ°ç›®æ ‡åœ°å€</p>
<h1 id="ENTRYPOINT"><a href="#ENTRYPOINT" class="headerlink" title="ENTRYPOINT"></a>ENTRYPOINT</h1><p>ä¸¤ç§å½¢å¼ï¼š</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> [â€œexecutableâ€, â€œparam1â€, â€œparam2â€] ï¼ˆ<span class="built_in">exec</span> å½¢å¼, é¦–é€‰ï¼‰</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> <span class="built_in">command</span> param1 param2 (shell å½¢å¼)</span></span><br></pre></td></tr></table></figure>

<p><code>ENTRYPOINT</code>å…è®¸æ‚¨é…ç½®å®¹å™¨, è¿è¡Œæ‰§è¡Œçš„å¯æ‰§è¡Œæ–‡ä»¶</p>
<p>ä¾‹å¦‚, ä»¥ä¸‹å°†ä½¿ç”¨å…¶é»˜è®¤å†…å®¹å¯åŠ¨nginx, ç›‘å¬ç«¯å£80ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -i -t --rm -p 80:80 nginx</span><br></pre></td></tr></table></figure>

<p><code>docker run &lt;image&gt;</code>çš„å‘½ä»¤è¡Œå‚æ•°å°†é™„è·Ÿåœ¨ exec å½¢å¼çš„<code>ENTRYPOINT</code>ä¸­çš„æ‰€æœ‰å…ƒç´ ä¹‹å, å¹¶å°†è¦†ç›–ä½¿ç”¨<code>CMD</code>æŒ‡å®šçš„æ‰€æœ‰å…ƒç´ . è¿™å…è®¸å°†å‚æ•°ä¼ é€’åˆ°å…¥å£ç‚¹, å³<code>docker run &lt;image&gt; -d</code>å°†æŠŠ<code>-d</code>å‚æ•°ä¼ é€’ç»™å…¥å£ç‚¹. æ‚¨å¯ä»¥ä½¿ç”¨<code>docker run --entrypoint</code>æ ‡å¿—è¦†ç›–<code>ENTRYPOINT</code>æŒ‡ä»¤</p>
<p>shell å½¢å¼é˜²æ­¢ä½¿ç”¨ä»»ä½•<code>CMD</code>æˆ–è¿è¡Œå‘½ä»¤è¡Œå‚æ•°, ä½†æ˜¯ç¼ºç‚¹æ˜¯<code>ENTRYPOINT</code>å°†ä½œ<code>/bin/sh -c</code>çš„å­å‘½ä»¤å¯åŠ¨, å®ƒä¸ä¼ é€’ä¿¡å·. è¿™æ„å‘³ç€å¯æ‰§è¡Œæ–‡ä»¶å°†ä¸æ˜¯å®¹å™¨çš„<code>PID 1</code>, å¹¶ä¸”ä¸ä¼šæ¥æ”¶<code>Unix</code>ä¿¡å·, å› æ­¤ä½ çš„å¯æ‰§è¡Œæ–‡ä»¶å°†ä¸ä¼šä»<code>docker stop &lt;container&gt;</code>æ¥æ”¶åˆ°<code>SIGTERM</code></p>
<p>åªæœ‰Dockerfileä¸­æœ€åä¸€ä¸ª<code>ENTRYPOINT</code>æŒ‡ä»¤ä¼šæœ‰æ•ˆæœ</p>
<h2 id="Exec-form-ENTRYPOINT-example"><a href="#Exec-form-ENTRYPOINT-example" class="headerlink" title="Exec form ENTRYPOINT example"></a>Exec form ENTRYPOINT example</h2><p>å¯ä»¥ä½¿ç”¨ENTRYPOINTçš„<code>exec</code>å½¢å¼è®¾ç½®ç›¸å½“ç¨³å®šçš„é»˜è®¤å‘½ä»¤å’Œå‚æ•°, ç„¶åä½¿ç”¨ä»»ä¸€å½¢å¼çš„<code>CMD</code>è®¾ç½®æ›´å¯èƒ½æ›´æ”¹çš„å…¶ä»–é»˜è®¤å€¼</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> ubuntu</span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> [<span class="string">"top"</span>, <span class="string">"-b"</span>]</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">"-c"</span>]</span></span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸‹Dockerfileæ˜¾ç¤ºä½¿ç”¨ENTRYPOINTåœ¨å‰å°è¿è¡ŒApache, ä½œä¸ºPID 1</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> debian:stable</span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> apt-get update &amp;&amp; apt-get install -y --force-yes apache2</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">80</span> <span class="number">443</span></span><br><span class="line"><span class="keyword">VOLUME</span><span class="bash"> [<span class="string">"/var/www"</span>, <span class="string">"/var/log/apache2"</span>, <span class="string">"/etc/apache2"</span>]</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> [<span class="string">"/usr/sbin/apache2ctl"</span>, <span class="string">"-D"</span>, <span class="string">"FOREGROUND"</span>]</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœéœ€è¦ä¸ºå•ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ç¼–å†™å¯åŠ¨è„šæœ¬ï¼Œå¯ä»¥ä½¿ç”¨execå’Œgosuå‘½ä»¤ç¡®ä¿æœ€ç»ˆå¯æ‰§è¡Œæ–‡ä»¶æ¥æ”¶åˆ°Unixä¿¡å·ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">set</span> -e</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">"<span class="variable">$1</span>"</span> = <span class="string">'postgres'</span> ]; <span class="keyword">then</span></span><br><span class="line">    chown -R postgres <span class="string">"<span class="variable">$PGDATA</span>"</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> [ -z <span class="string">"<span class="variable">$(ls -A "$PGDATA")</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">        gosu postgres initdb</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">exec</span> gosu postgres <span class="string">"<span class="variable">$@</span>"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exec</span> <span class="string">"<span class="variable">$@</span>"</span></span><br></pre></td></tr></table></figure>

<ul>
<li>set -e : åœ¨è„šæœ¬çš„æ‰§è¡Œä¸­ä»»ä½•ä¸€è¡Œå‡ºç°æ‰§è¡Œå¤±è´¥éƒ½ç«‹å³é€€å‡ºè„šæœ¬</li>
<li>set -eo pipefail : åœ¨ç®¡é“çš„ä½¿ç”¨ä¸­, ä»»æ„ä¸€ä¸ªç¯èŠ‚å‡ºç°é—®é¢˜éƒ½ç«‹å³é€€å‡º</li>
<li>set â€“ postgres â€œ$@â€ : å°†åé¢çš„æ¯ä¸€ä¸ªå€¼ä¾æ¬¡æ”¾å…¥ $1 $2 $3 â€¦</li>
<li>$@ : ä¼ ç»™è„šæœ¬çš„æ‰€æœ‰å‚æ•°çš„åˆ—è¡¨</li>
</ul>
<p>ä¸Šé¢è„šæœ¬çš„æ„æ€æ˜¯, é¦–å…ˆåˆ¤æ–­ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸æ˜¯é¢„æœŸä¸­çš„å¯æ‰§è¡Œå‘½ä»¤, å¦‚æœç¬¬ä¸€ä¸ªå‚æ•°æ˜¯é¢„æœŸä¸­çš„å¯æ‰§è¡Œå‘½ä»¤, é‚£ä¹ˆåé¢å‚æ•°é»˜è®¤å‡ä¸ºç¬¬ä¸€ä¸ª(å‚æ•°)å‘½ä»¤çš„å‚æ•°; å¦‚æœç¬¬ä¸€ä¸ªå‚æ•°ä¸æ˜¯é¢„æœŸä¸­çš„å¯è¡Œæ€§å‘½ä»¤, é‚£ä¹ˆå°±è®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªå…¨æ–°çš„å‘½ä»¤è¦æ‰§è¡Œ, æ‰€ä»¥ä½¿ç”¨<code>exec $@</code>å®Œæ•´åœ°æ‰§è¡Œå‘½ä»¤</p>
<p>å¦‚æœéœ€è¦åœ¨å…³é—­æ—¶è¿›è¡Œä¸€äº›é¢å¤–çš„æ¸…ç†ï¼ˆæˆ–ä¸å…¶ä»–å®¹å™¨é€šä¿¡ï¼‰æˆ–è€…åè°ƒå¤šä¸ªå¯æ‰§è¡Œæ–‡ä»¶, éœ€è¦ç¡®ä¿<code>ENTRYPOINT</code>è„šæœ¬æ¥æ”¶åˆ°Unixä¿¡å·, ä¼ é€’å®ƒä»¬, ç„¶ååšä¸€äº›æ›´å¤šçš„å–„åå·¥ä½œï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"><span class="comment"># Note: I've written this using sh so it works in the busybox container too</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># USE the trap if you need to also do manual cleanup after the service is stopped,</span></span><br><span class="line"><span class="comment">#     or need to start multiple services in the one container</span></span><br><span class="line"><span class="built_in">trap</span> <span class="string">"echo TRAPed signal"</span> HUP INT QUIT TERM</span><br><span class="line"></span><br><span class="line"><span class="comment"># start service in background here</span></span><br><span class="line">/usr/sbin/apachectl start</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"[hit enter key to exit] or run 'docker stop &lt;container&gt;'"</span></span><br><span class="line"><span class="built_in">read</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># stop service and clean up here</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"stopping apache"</span></span><br><span class="line">/usr/sbin/apachectl stop</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"exited <span class="variable">$0</span>"</span></span><br></pre></td></tr></table></figure>

<h2 id="Shell-form-ENTRYPOINT-example"><a href="#Shell-form-ENTRYPOINT-example" class="headerlink" title="Shell form ENTRYPOINT example"></a>Shell form ENTRYPOINT example</h2><p>ä½ å¯ä»¥ä¸º<code>ENTRYPOINT</code>æŒ‡å®šä¸€ä¸ªçº¯å­—ç¬¦ä¸²ï¼Œå®ƒå°†åœ¨<code>/bin/sh -c</code>ä¸­æ‰§è¡Œã€‚è¿™ç§å½¢å¼å°†ä½¿ç”¨shellå¤„ç†æ¥æ›¿æ¢shellç¯å¢ƒå˜é‡ï¼Œå¹¶ä¸”å°†å¿½ç•¥ä»»ä½•<code>CMD</code>æˆ–<code>docker run</code>å‘½ä»¤è¡Œå‚æ•°ã€‚è¦ç¡®ä¿<code>docker stop</code>å°†æ­£ç¡®åœ°æ§åˆ¶<code>ENTRYPOINT</code>å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¿…é¡»ç”¨<code>exec</code>å¯åŠ¨å®ƒï¼š</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> ubuntu</span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> <span class="built_in">exec</span> top -b</span></span><br></pre></td></tr></table></figure>

<p>è¿è¡Œæ­¤imageæ—¶ï¼Œæ‚¨å°†çœ‹åˆ°å•ä¸ª<code>PID 1</code>è¿›ç¨‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -it --rm --name <span class="built_in">test</span> top</span><br><span class="line">Mem: 1704520K used, 352148K free, 0K shrd, 0K buff, 140368121167873K cached</span><br><span class="line">CPU:   5% usr   0% sys   0% nic  94% idle   0% io   0% irq   0% sirq</span><br><span class="line">Load average: 0.08 0.03 0.05 2/98 6</span><br><span class="line">  PID  PPID USER     STAT   VSZ %VSZ %CPU COMMAND</span><br><span class="line">    1     0 root     R     3164   0%   0% top -b</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨<code>docker stop</code>å¯ä»¥å¹²å‡€çš„é€€å‡ºï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ /usr/bin/time docker stop <span class="built_in">test</span></span><br><span class="line"><span class="built_in">test</span></span><br><span class="line">real    0m 0.20s</span><br><span class="line">user    0m 0.02s</span><br><span class="line">sys 0m 0.04s</span><br></pre></td></tr></table></figure>

<p>å¦‚æœå¿˜è®°å°†<code>exec</code>æ·»åŠ åˆ°æ‚¨çš„<code>ENTRYPOINT</code>çš„å¼€å¤´ï¼š</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> ubuntu</span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> top -b</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> --ignored-param1</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åï¼Œä½ å¯ä»¥è¿è¡Œå®ƒï¼ˆç»™å®ƒä¸€ä¸ªåç§°ä¸ºä¸‹ä¸€æ­¥ï¼‰ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -it --name <span class="built_in">test</span> top --ignored-param2</span><br><span class="line">Mem: 1704184K used, 352484K free, 0K shrd, 0K buff, 140621524238337K cached</span><br><span class="line">CPU:   9% usr   2% sys   0% nic  88% idle   0% io   0% irq   0% sirq</span><br><span class="line">Load average: 0.01 0.02 0.05 2/101 7</span><br><span class="line">  PID  PPID USER     STAT   VSZ %VSZ %CPU COMMAND</span><br><span class="line">    1     0 root     S     3168   0%   0% /bin/sh -c top -b cmd cmd2</span><br><span class="line">    7     1 root     R     3164   0%   0% top -b</span><br></pre></td></tr></table></figure>

<p>æ‚¨å¯ä»¥ä»topçš„è¾“å‡ºä¸­çœ‹åˆ°æŒ‡å®šçš„ENTRYPOINTä¸æ˜¯PID 1ã€‚</p>
<p>å¦‚æœä½ è¿è¡Œdockeråœæ­¢æµ‹è¯•ï¼Œå®¹å™¨å°†ä¸ä¼šå®Œå…¨é€€å‡º, è¶…æ—¶ååœæ­¢å‘½ä»¤å°†å¼ºåˆ¶å‘é€SIGKILLï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ docker <span class="built_in">exec</span> -it <span class="built_in">test</span> ps aux</span><br><span class="line">PID   USER     COMMAND</span><br><span class="line">    1 root     /bin/sh -c top -b cmd cmd2</span><br><span class="line">    7 root     top -b</span><br><span class="line">    8 root     ps aux</span><br><span class="line">$ /usr/bin/time docker stop <span class="built_in">test</span></span><br><span class="line"><span class="built_in">test</span></span><br><span class="line">real    0m 10.19s</span><br><span class="line">user    0m 0.04s</span><br><span class="line">sys 0m 0.03s</span><br></pre></td></tr></table></figure>

<h2 id="Understand-how-CMD-and-ENTRYPOINT-interact"><a href="#Understand-how-CMD-and-ENTRYPOINT-interact" class="headerlink" title="Understand how CMD and ENTRYPOINT interact"></a>Understand how CMD and ENTRYPOINT interact</h2><p><code>CMD</code>å’Œ<code>ENTRYPOINT</code>æŒ‡ä»¤å®šä¹‰åœ¨è¿è¡Œå®¹å™¨æ—¶æ‰§è¡Œä»€ä¹ˆå‘½ä»¤, æœ‰å¦‚ä¸‹ä½¿ç”¨è§„åˆ™</p>
<ul>
<li><code>Dockerfile</code>åº”è¯¥è‡³å°‘æŒ‡å®šä¸€ä¸ª<code>CMD</code>æˆ–<code>ENTRYPOINT</code>å‘½ä»¤</li>
<li>å½“ä½¿ç”¨å®¹å™¨ä½œä¸ºå¯æ‰§è¡Œæ–‡ä»¶æ—¶ï¼Œåº”è¯¥å®šä¹‰<code>ENTRYPOINT</code></li>
<li><code>CMD</code>åº”è¯¥ç”¨ä½œå®šä¹‰<code>ENTRYPOINT</code>å‘½ä»¤çš„é»˜è®¤å‚æ•°æˆ–åœ¨å®¹å™¨ä¸­æ‰§è¡Œad-hocå‘½ä»¤çš„ä¸€ç§æ–¹æ³•</li>
<li>å½“è¿è¡Œå¸¦æœ‰æ›¿ä»£å‚æ•°çš„å®¹å™¨æ—¶ï¼Œ<code>CMD</code>å°†è¢«è¦†ç›–</li>
</ul>
<p>ä¸‹è¡¨æ˜¾ç¤ºäº†å¯¹ä¸åŒ<code>ENTRYPOINT</code>/<code>CMD</code>ç»„åˆæ‰§è¡Œçš„å‘½ä»¤ï¼š</p>
<table>
<thead>
<tr>
<th></th>
<th>no ENTRYPOINT</th>
<th>ENTRYPOINT exec_enty p1_entry</th>
<th>ENTRYPOINT [â€œexec_entryâ€,â€œp1_entryâ€]</th>
</tr>
</thead>
<tbody><tr>
<td>No CMD</td>
<td>error, not allowed</td>
<td>/bin/sh -c exec_entry p1_entry</td>
<td>exec_entry p1_entry</td>
</tr>
<tr>
<td>CMD [â€œexec_cmdâ€,â€œp1_cmdâ€]</td>
<td>exec_cmd p1_cmd</td>
<td>/bin/sh -c exec_entry p1_entry exec_cmd p1_cmd</td>
<td>exec_entry p1_entry exec_cmd p1_cmd</td>
</tr>
<tr>
<td>CMD [â€œp1_cmdâ€, â€œp2_cmdâ€]</td>
<td>p1_cmd p2_cmd</td>
<td>/bin/sh -c exec_entry p1_entry p1_cmd p2_cmd</td>
<td>exec_entry p1_entry p1_cmd p2_cmd</td>
</tr>
<tr>
<td>CMD exec_cmd p1_cmd</td>
<td>/bin/sh -c exec_cmd p1_cmd</td>
<td>/bin/sh -c exec_entry p1_entry /bin/sh -c exec_cmd p1_cmd</td>
<td>exec_entry p1_entry /bin/sh -c exec_cmd p1_cmd</td>
</tr>
</tbody></table>
<h1 id="VOLUME"><a href="#VOLUME" class="headerlink" title="VOLUME"></a>VOLUME</h1><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">VOLUME</span><span class="bash"> [<span class="string">"/data"</span>]</span></span><br></pre></td></tr></table></figure>

<p><code>VOLUME</code>æŒ‡ä»¤åˆ›å»ºå…·æœ‰æŒ‡å®šåç§°çš„æŒ‚è½½ç‚¹ï¼Œå¹¶å°†å…¶æ ‡è®°ä¸ºä»æœ¬æœºä¸»æœºæˆ–å…¶ä»–å®¹å™¨ä¿ç•™å¤–éƒ¨æŒ‚è½½çš„å·ã€‚è¯¥å€¼å¯ä»¥æ˜¯JSONæ•°ç»„<code>VOLUME [&quot;/var/log/&quot;]</code>æˆ–å…·æœ‰å¤šä¸ªå‚æ•°çš„çº¯å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚<code>VOLUME /var/log</code>æˆ–<code>VOLUME /var/log /var/db</code></p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> ubuntu</span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> mkdir /myvol</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">echo</span> <span class="string">"hello world"</span> &gt; /myvol/greeting</span></span><br><span class="line"><span class="keyword">VOLUME</span><span class="bash"> /myvol</span></span><br></pre></td></tr></table></figure>

<h1 id="USER"><a href="#USER" class="headerlink" title="USER"></a>USER</h1><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USER</span> daemon</span><br></pre></td></tr></table></figure>

<p><code>USER</code>æŒ‡ä»¤è®¾ç½®è¿è¡Œimageæ—¶ä½¿ç”¨çš„ç”¨æˆ·åæˆ–UID, ä»¥åŠ<code>Dockerfile</code>ä¸­çš„ä»»ä½•RUNï¼Œ<code>CMD</code>å’Œ<code>ENTRYPOINT</code>æŒ‡ä»¤</p>
<h1 id="WORKDIR"><a href="#WORKDIR" class="headerlink" title="WORKDIR"></a>WORKDIR</h1><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> /path/to/workdir</span></span><br></pre></td></tr></table></figure>

<p><code>WORKDIR</code>æŒ‡ä»¤ä¸º<code>Dockerfile</code>ä¸­çš„ä»»ä½•<code>RUN</code>ï¼Œ<code>CMD</code>ï¼Œ<code>ENTRYPOINT</code>ï¼Œ<code>COPY</code>å’Œ<code>ADD</code>æŒ‡ä»¤è®¾ç½®å·¥ä½œç›®å½•ã€‚å¦‚æœ<code>WORKDIR</code>ä¸å­˜åœ¨ï¼Œå®ƒå°†è¢«åˆ›å»ºï¼Œå³ä½¿å®ƒæ²¡æœ‰åœ¨ä»»ä½•åç»­çš„<code>Dockerfile</code>æŒ‡ä»¤ä¸­ä½¿ç”¨</p>
<p>å®ƒå¯ä»¥åœ¨ä¸€ä¸ª<code>Dockerfile</code>ä¸­å¤šæ¬¡ä½¿ç”¨. å¦‚æœæä¾›äº†ç›¸å¯¹è·¯å¾„, å®ƒå°†ç›¸å¯¹äºå…ˆå‰WORKDIRæŒ‡ä»¤çš„è·¯å¾„.  ä¾‹å¦‚:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> /a</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> b</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> c</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">pwd</span></span></span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ä¸ª<code>Dockerfile</code>ä¸­çš„æœ€ç»ˆ<code>pwd</code>å‘½ä»¤çš„è¾“å‡ºæ˜¯<code>/a/b/c</code></p>
<p><code>WORKDIR</code>æŒ‡ä»¤å¯ä»¥è§£æå…ˆå‰ä½¿ç”¨<code>ENV</code>è®¾ç½®çš„ç¯å¢ƒå˜é‡ã€‚æ‚¨åªèƒ½ä½¿ç”¨åœ¨<code>Dockerfile</code>ä¸­æ˜¾å¼è®¾ç½®çš„ç¯å¢ƒå˜é‡.  ä¾‹å¦‚ï¼š</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ENV</span> DIRPATH /path</span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> <span class="variable">$DIRPATH</span>/<span class="variable">$DIRNAME</span></span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">pwd</span></span></span><br></pre></td></tr></table></figure>

<p><code>pwd</code>å‘½ä»¤åœ¨è¯¥<code>Dockerfile</code>ä¸­è¾“å‡ºçš„æœ€åç»“æœæ˜¯<code>/path/$DIRNAME</code></p>
<h1 id="ARG"><a href="#ARG" class="headerlink" title="ARG"></a>ARG</h1><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ARG</span> &lt;name&gt;[=&lt;default value&gt;]</span><br></pre></td></tr></table></figure>

<p><code>ARG</code>æŒ‡ä»¤å®šä¹‰ä¸€ä¸ªå˜é‡, ç”¨æˆ·å¯ä»¥ä½¿ç”¨<code>docker build</code>å‘½ä»¤ä½¿ç”¨<code>--build-arg &lt;varname&gt; = &lt;value&gt;</code>æ ‡å¿—ï¼Œåœ¨æ„å»ºæ—¶å°†å…¶ä¼ é€’ç»™æ„å»ºå™¨. å¦‚æœç”¨æˆ·æŒ‡å®šäº†ä¸€ä¸ªæœªåœ¨<code>Dockerfile</code>ä¸­å®šä¹‰çš„æ„å»ºå‚æ•°, æ„å»ºå°†è¾“å‡ºé”™è¯¯</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">One or more build-args were not consumed, failing build.</span><br></pre></td></tr></table></figure>

<p>Dockerfileä½œè€…å¯ä»¥é€šè¿‡æŒ‡å®š<code>ARG</code>ä¸€ä¸ªæˆ–å¤šä¸ªå˜é‡, é€šè¿‡å¤šæ¬¡æŒ‡å®š<code>ARG</code>æ¥å®šä¹‰å•ä¸ªå˜é‡. ä¾‹å¦‚, ä¸€ä¸ªæœ‰æ•ˆçš„<code>Dockerfile</code>ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">FROM busybox</span><br><span class="line">ARG user1</span><br><span class="line">ARG buildno</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>Dockerfileä½œè€…å¯ä»¥å¯é€‰åœ°æŒ‡å®š<code>ARG</code>æŒ‡ä»¤çš„é»˜è®¤å€¼ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">FROM busybox</span><br><span class="line">ARG user1&#x3D;someuser</span><br><span class="line">ARG buildno&#x3D;1</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>å¦‚æœ<code>ARG</code>å€¼å…·æœ‰ç¼ºçœå€¼ï¼Œå¹¶ä¸”å¦‚æœåœ¨æ„å»ºæ—¶æ²¡æœ‰ä¼ é€’å€¼ï¼Œåˆ™æ„å»ºå™¨ä½¿ç”¨ç¼ºçœå€¼ã€‚</p>
<p><code>ARG</code>å˜é‡å®šä¹‰ä»åœ¨<code>Dockerfile</code>ä¸­å®šä¹‰çš„è¡Œå¼€å§‹ç”Ÿæ•ˆï¼Œè€Œä¸æ˜¯ä»å‘½ä»¤è¡Œæˆ–å…¶ä»–åœ°æ–¹çš„å‚æ•°ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œè€ƒè™‘è¿™ä¸ªDockerfileï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1 FROM busybox</span><br><span class="line">2 USER $&#123;user:-some_user&#125;</span><br><span class="line">3 ARG user</span><br><span class="line">4 USER $user</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>ç”¨æˆ·æ„å»ºæ­¤æ–‡ä»¶å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker build --build-arg user&#x3D;what_user Dockerfile</span><br></pre></td></tr></table></figure>

<p>ç¬¬2è¡Œçš„<code>USER</code>å°†è¯„ä¼°ä¸º<code>some_user</code>ï¼Œå› ä¸ºç”¨æˆ·å˜é‡åœ¨åç»­è¡Œ3ä¸Šå®šä¹‰ã€‚ç¬¬4è¡Œçš„<code>USER</code>åœ¨å®šä¹‰ç”¨æˆ·æ—¶ä¼°è®¡ä¸º<code>what_user</code>ï¼Œåœ¨å‘½ä»¤è¡Œä¸­ä¼ é€’<code>what_user</code>å€¼ã€‚åœ¨é€šè¿‡<code>ARG</code>æŒ‡ä»¤å®šä¹‰ä¹‹å‰ï¼Œå˜é‡çš„ä»»ä½•ä½¿ç”¨éƒ½å°†å¯¼è‡´ç©ºå­—ç¬¦ä¸²ã€‚</p>
<blockquote>
<p><code>è­¦å‘Š</code>ï¼šä¸å»ºè®®ä½¿ç”¨build-timeå˜é‡æ¥ä¼ é€’è¯¸å¦‚githubå¯†é’¥, ç”¨æˆ·å‡­è¯ç­‰å¯†ç . æ„å»ºæ—¶å˜é‡å€¼ä½¿ç”¨<code>docker history</code>å‘½ä»¤å¯¹é•œåƒçš„ä»»ä½•ç”¨æˆ·å¯è§</p>
</blockquote>
<p>å¯ä»¥ä½¿ç”¨<code>ARG</code>æˆ–<code>ENV</code>æŒ‡ä»¤æ¥æŒ‡å®š<code>RUN</code>æŒ‡ä»¤å¯ç”¨çš„å˜é‡ã€‚ä½¿ç”¨<code>ENV</code>æŒ‡ä»¤å®šä¹‰çš„ç¯å¢ƒå˜é‡æ€»æ˜¯è¦†ç›–åŒåçš„<code>ARG</code>æŒ‡ä»¤ã€‚æ€è€ƒè¿™ä¸ª<code>Dockerfile</code>å¸¦æœ‰<code>ENV</code>å’Œ<code>ARG</code>æŒ‡ä»¤ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1 FROM ubuntu</span><br><span class="line">2 ARG CONT_IMG_VER</span><br><span class="line">3 ENV CONT_IMG_VER v1.0.0</span><br><span class="line">4 RUN echo $CONT_IMG_VER</span><br></pre></td></tr></table></figure>

<p>ç„¶åï¼Œå‡è®¾æ­¤imageæ˜¯ä½¿ç”¨æ­¤å‘½ä»¤æ„å»ºçš„ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker build --build-arg CONT_IMG_VER&#x3D;v2.0.1 Dockerfile</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<code>RUN</code>æŒ‡ä»¤ä½¿ç”¨<code>v1.0.0</code>è€Œä¸æ˜¯ç”¨æˆ·ä¼ é€’çš„<code>ARG</code>è®¾ç½®ï¼š<code>v2.0.1</code>æ­¤è¡Œä¸ºç±»ä¼¼äºshellè„šæœ¬ï¼Œå…¶ä¸­æœ¬åœ°ä½œç”¨åŸŸå˜é‡è¦†ç›–ä½œä¸ºå‚æ•°ä¼ é€’æˆ–ä»ç¯å¢ƒç»§æ‰¿çš„å˜é‡ï¼Œä»å…¶å®šä¹‰ç‚¹ã€‚</p>
<p>ä½¿ç”¨ä¸Šè¿°ç¤ºä¾‹ï¼Œä½†ä½¿ç”¨ä¸åŒçš„<code>ENV</code>è§„èŒƒï¼Œæ‚¨å¯ä»¥åœ¨<code>ARG</code>å’Œ<code>ENV</code>æŒ‡ä»¤ä¹‹é—´åˆ›å»ºæ›´æœ‰ç”¨çš„äº¤äº’ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1 FROM ubuntu</span><br><span class="line">2 ARG CONT_IMG_VER</span><br><span class="line">3 ENV CONT_IMG_VER $&#123;CONT_IMG_VER:-v1.0.0&#125;</span><br><span class="line">4 RUN echo $CONT_IMG_VER</span><br></pre></td></tr></table></figure>

<p>ä¸<code>ARG</code>æŒ‡ä»¤ä¸åŒ, <code>ENV</code>å€¼å§‹ç»ˆä¿ç•™åœ¨imageä¸­. è€ƒè™‘ä¸€ä¸ªæ²¡æœ‰<code>-build-arg</code>æ ‡å¿—çš„dockeræ„å»ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker build Dockerfile</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨è¿™ä¸ªDockerfileç¤ºä¾‹ï¼Œ<code>CONT_IMG_VER</code>ä»ç„¶ä¿ç•™åœ¨æ˜ åƒä¸­ï¼Œä½†å®ƒçš„å€¼å°†æ˜¯<code>v1.0.0</code>ï¼Œå› ä¸ºå®ƒæ˜¯<code>ENV</code>æŒ‡ä»¤åœ¨ç¬¬3è¡Œä¸­çš„é»˜è®¤è®¾ç½®ã€‚</p>
<p>æ­¤ç¤ºä¾‹ä¸­çš„å˜é‡æ‰©å±•æŠ€æœ¯å…è®¸æ‚¨ä»å‘½ä»¤è¡Œä¼ é€’å‚æ•°ï¼Œå¹¶é€šè¿‡åˆ©ç”¨<code>ENV</code>æŒ‡ä»¤å°†å®ƒä»¬æŒä¹…ä¿å­˜åœ¨æœ€ç»ˆimageä¸­</p>
<p>Dockeræœ‰ä¸€ç»„é¢„å®šä¹‰çš„<code>ARG</code>å˜é‡ï¼Œæ‚¨å¯ä»¥åœ¨Dockerfileä¸­ä½¿ç”¨ç›¸åº”çš„ARGæŒ‡ä»¤ã€‚</p>
<ul>
<li>HTTP_PROXY</li>
<li>http_proxy</li>
<li>HTTPS_PROXY</li>
<li>https_proxy</li>
<li>FTP_PROXY</li>
<li>ftp_proxy</li>
<li>NO_PROXY</li>
<li>no_proxy</li>
</ul>
<p>è¦ä½¿ç”¨è¿™äº›ï¼Œåªéœ€åœ¨å‘½ä»¤è¡Œä½¿ç”¨æ ‡å¿—ä¼ é€’å®ƒä»¬ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--build-arg &lt;varname&gt;&#x3D;&lt;value&gt;</span><br></pre></td></tr></table></figure>

<h2 id="Impact-on-build-caching"><a href="#Impact-on-build-caching" class="headerlink" title="Impact on build caching"></a>Impact on build caching</h2><p><code>ARG</code>å˜é‡ä¸ä¼šæŒä¹…åŒ–åˆ°æ„å»ºçš„imageä¸­ï¼Œå› ä¸º<code>ENV</code>å˜é‡æ˜¯ã€‚ä½†æ˜¯ï¼Œ<code>ARG</code>å˜é‡ä¼šä»¥ç±»ä¼¼çš„æ–¹å¼å½±å“æ„å»ºç¼“å­˜ã€‚å¦‚æœä¸€ä¸ª<code>Dockerfile</code>å®šä¹‰ä¸€ä¸ª<code>ARG</code>å˜é‡ï¼Œå®ƒçš„å€¼ä¸åŒäºä»¥å‰çš„ç‰ˆæœ¬ï¼Œé‚£ä¹ˆåœ¨å®ƒçš„ç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶ä¼šå‡ºç°ä¸€ä¸ªâ€œcache missâ€ï¼Œè€Œä¸æ˜¯å®ƒçš„å®šä¹‰ã€‚ç‰¹åˆ«åœ°ï¼Œåœ¨<code>ARG</code>æŒ‡ä»¤ä¹‹åçš„æ‰€æœ‰<code>RUN</code>æŒ‡ä»¤éƒ½éšå¼åœ°ä½¿ç”¨ARGå˜é‡ï¼ˆä½œä¸ºç¯å¢ƒå˜é‡ï¼‰ï¼Œå› æ­¤å¯èƒ½å¯¼è‡´é«˜é€Ÿç¼“å­˜æœªå‘½ä¸­ã€‚</p>
<p>ä¾‹å¦‚ï¼Œè€ƒè™‘è¿™ä¸¤ä¸ªDockerfileï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1 FROM ubuntu</span><br><span class="line">2 ARG CONT_IMG_VER</span><br><span class="line">3 RUN echo $CONT_IMG_VER</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1 FROM ubuntu</span><br><span class="line">2 ARG CONT_IMG_VER</span><br><span class="line">3 RUN echo hello</span><br></pre></td></tr></table></figure>

<p>å¦‚æœåœ¨å‘½ä»¤è¡Œä¸ŠæŒ‡å®š<code>--build-arg CONT_IMG_VER = &lt;value&gt;</code>ï¼Œåˆ™åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œç¬¬2è¡Œçš„è§„èŒƒä¸ä¼šå¯¼è‡´é«˜é€Ÿç¼“å­˜æœªå‘½ä¸­;è¡Œ3ç¡®å®å¯¼è‡´é«˜é€Ÿç¼“å­˜æœªå‘½ä¸­ã€‚<code>ARG CONT_IMG_VER</code>å¯¼è‡´<code>RUN</code>è¡Œè¢«æ ‡è¯†ä¸ºä¸è¿è¡Œ<code>CONT_IMG_VER = &lt;value&gt; echo hello</code>ç›¸åŒï¼Œå› æ­¤å¦‚æœ<code>&lt;value&gt;</code>æ›´æ”¹ï¼Œæˆ‘ä»¬å°†å¾—åˆ°é«˜é€Ÿç¼“å­˜æœªå‘½ä¸­ã€‚</p>
<p>è€ƒè™‘åœ¨åŒä¸€å‘½ä»¤è¡Œä¸‹çš„å¦ä¸€ä¸ªç¤ºä¾‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1 FROM ubuntu</span><br><span class="line">2 ARG CONT_IMG_VER</span><br><span class="line">3 ENV CONT_IMG_VER $CONT_IMG_VER</span><br><span class="line">4 RUN echo $CONT_IMG_VER</span><br></pre></td></tr></table></figure>

<p>åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œé«˜é€Ÿç¼“å­˜æœªå‘½ä¸­å‘ç”Ÿåœ¨ç¬¬3è¡Œã€‚ç”±äºå˜é‡åœ¨<code>ENV</code>ä¸­çš„å€¼å¼•ç”¨<code>ARG</code>å˜é‡å¹¶ä¸”è¯¥å˜é‡é€šè¿‡å‘½ä»¤è¡Œæ›´æ”¹ï¼Œå› æ­¤å‘ç”Ÿäº†æœªå‘½ä¸­ã€‚åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œ<code>ENV</code>å‘½ä»¤ä½¿imageåŒ…æ‹¬è¯¥å€¼ã€‚</p>
<p>å¦‚æœ<code>ENV</code>æŒ‡ä»¤è¦†ç›–åŒåçš„<code>ARG</code>æŒ‡ä»¤ï¼Œå°±åƒè¿™ä¸ªDockerfileï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1 FROM ubuntu</span><br><span class="line">2 ARG CONT_IMG_VER</span><br><span class="line">3 ENV CONT_IMG_VER hello</span><br><span class="line">4 RUN echo $CONT_IMG_VER</span><br></pre></td></tr></table></figure>

<p>ç¬¬3è¡Œä¸ä¼šå¯¼è‡´é«˜é€Ÿç¼“å­˜æœªå‘½ä¸­ï¼Œå› ä¸º<code>CONT_IMG_VER</code>çš„å€¼æ˜¯ä¸€ä¸ªå¸¸é‡ï¼ˆhelloï¼‰å› æ­¤ï¼Œ<code>RUN</code>ï¼ˆç¬¬4è¡Œï¼‰ä¸Šä½¿ç”¨çš„ç¯å¢ƒå˜é‡å’Œå€¼åœ¨æ„å»ºä¹‹é—´ä¸ä¼šæ›´æ”¹</p>
<h1 id="ONBUILD"><a href="#ONBUILD" class="headerlink" title="ONBUILD"></a>ONBUILD</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ONBUILD [INSTRUCTION]</span><br></pre></td></tr></table></figure>

<p><code>ONBUILD</code>æŒ‡ä»¤åœ¨imageè¢«ç”¨ä½œå¦ä¸€ä¸ªæ„å»ºçš„åŸºç¡€æ—¶ï¼Œå‘imageæ·»åŠ è¦åœ¨ä»¥åæ‰§è¡Œçš„<em>trigger</em>æŒ‡ä»¤ã€‚triggerå°†åœ¨ä¸‹æ¸¸æ„å»ºçš„ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œï¼Œå°±å¥½åƒå®ƒå·²ç»åœ¨ä¸‹æ¸¸Dockerfileä¸­çš„1FROM1æŒ‡ä»¤ä¹‹åç«‹å³æ’å…¥ã€‚</p>
<p>ä»»ä½•æ„å»ºæŒ‡ä»¤éƒ½å¯ä»¥æ³¨å†Œä¸ºtriggerã€‚</p>
<p>å¦‚æœæ‚¨æ­£åœ¨æ„å»ºå°†ç”¨ä½œæ„å»ºå…¶ä»–imageçš„åŸºç¡€çš„å›¾åƒï¼Œä¾‹å¦‚åº”ç”¨ç¨‹åºæ„å»ºç¯å¢ƒæˆ–å¯ä»¥ä½¿ç”¨ç”¨æˆ·ç‰¹å®šé…ç½®è‡ªå®šä¹‰çš„åå°é©»ç•™ç¨‹åºï¼Œè¿™å°†éå¸¸æœ‰ç”¨ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨çš„imageæ˜¯å¯é‡ç”¨çš„Pythonåº”ç”¨ç¨‹åºæ„å»ºå™¨ï¼Œåˆ™éœ€è¦å°†åº”ç”¨ç¨‹åºæºä»£ç æ·»åŠ åˆ°ç‰¹å®šç›®å½•ä¸­ï¼Œå¹¶ä¸”å¯èƒ½éœ€è¦åœ¨æ­¤ä¹‹åè°ƒç”¨æ„å»ºè„šæœ¬ã€‚ä½ ä¸èƒ½åªæ˜¯è°ƒç”¨<code>ADD</code>å’Œ<code>RUN</code>ç°åœ¨ï¼Œå› ä¸ºä½ è¿˜æ²¡æœ‰è®¿é—®åº”ç”¨ç¨‹åºæºä»£ç ï¼Œå®ƒå°†æ˜¯ä¸åŒçš„æ¯ä¸ªåº”ç”¨ç¨‹åºæ„å»ºã€‚æ‚¨å¯ä»¥ç®€å•åœ°ä¸ºåº”ç”¨ç¨‹åºå¼€å‘äººå‘˜æä¾›ä¸€ä¸ªæ ·æ¿Dockerfileä»¥å°†å…¶å¤åˆ¶ç²˜è´´åˆ°å…¶åº”ç”¨ç¨‹åºä¸­ï¼Œä½†è¿™æ˜¯ä½æ•ˆï¼Œå®¹æ˜“å‡ºé”™ï¼Œå¹¶ä¸”å¾ˆéš¾æ›´æ–°ï¼Œå› ä¸ºå®ƒä¸åº”ç”¨ç¨‹åºç‰¹å®šçš„ä»£ç æ··åˆã€‚</p>
<p>è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨<code>ONBUILD</code>æ¥æ³¨å†Œæå‰æŒ‡ä»¤ï¼Œä»¥ä¾¿ç¨ååœ¨ä¸‹ä¸€ä¸ªæ„å»ºé˜¶æ®µè¿è¡Œã€‚</p>
<p>ä»¥ä¸‹æ˜¯å®ƒçš„å·¥ä½œåŸç†ï¼š</p>
<ol>
<li>å½“é‡åˆ°<code>ONBUILD</code>æŒ‡ä»¤æ—¶ï¼Œæ„å»ºå™¨ä¼šå‘æ­£åœ¨æ„å»ºçš„imageçš„å…ƒæ•°æ®æ·»åŠ triggerã€‚è¯¥æŒ‡ä»¤ä¸ä¼šå¦å¤–å½±å“å½“å‰æ„å»ºã€‚</li>
<li>åœ¨æ„å»ºç»“æŸæ—¶ï¼Œæ‰€æœ‰triggerçš„åˆ—è¡¨å­˜å‚¨åœ¨imageæ¸…å•ä¸­çš„OnBuildé”®ä¸‹ã€‚å¯ä»¥ä½¿ç”¨<code>docker inspect</code>å‘½ä»¤æ£€æŸ¥å®ƒä»¬ã€‚</li>
<li>ç¨åï¼Œå¯ä»¥ä½¿ç”¨<code>FROM</code>æŒ‡ä»¤å°†imageç”¨ä½œæ–°æ„å»ºçš„åŸºç¡€ã€‚ä½œä¸ºå¤„ç†<code>FROM</code>æŒ‡ä»¤çš„ä¸€éƒ¨åˆ†ï¼Œä¸‹æ¸¸æ„å»ºå™¨ä¼šæŸ¥æ‰¾<code>ONBUILD</code>triggersï¼Œå¹¶æŒ‰ç…§å®ƒä»¬æ³¨å†Œçš„é¡ºåºæ‰§è¡Œå®ƒä»¬ã€‚å¦‚æœä»»ä½•è§¦å‘å™¨å¤±è´¥ï¼Œåˆ™<code>FROM</code>æŒ‡ä»¤ä¸­æ­¢ï¼Œè¿™åˆå¯¼è‡´æ„å»ºå¤±è´¥ã€‚å¦‚æœæ‰€æœ‰è§¦å‘å™¨éƒ½æˆåŠŸï¼Œåˆ™<code>FROM</code>æŒ‡ä»¤å®Œæˆå¹¶ä¸”æ„å»ºå¦‚å¸¸ç»§ç»­ã€‚è§¦å‘å™¨åœ¨æ‰§è¡Œåä»æœ€ç»ˆimageä¸­æ¸…é™¤ã€‚æ¢å¥è¯è¯´ï¼Œå®ƒä»¬ä¸ä¼šè¢«â€œgrand-childrenâ€æ„å»ºç»§æ‰¿ã€‚ ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥æ·»åŠ å¦‚ä¸‹ï¼š <code>[...] ONBUILD ADD . /app/src ONBUILD RUN /usr/local/bin/python-build --dir /app/src [...]</code>&gt; <code>è­¦å‘Š</code>ï¼šä¸å…è®¸ä½¿ç”¨<code>ONBUILD ONBUILD</code>é“¾æ¥<code>ONBUILD</code>æŒ‡ä»¤ã€‚ &gt; <code>è­¦å‘Š</code>ï¼š<code>ONBUILD</code>æŒ‡ä»¤å¯èƒ½ä¸ä¼šè§¦å‘<code>FROM</code>æˆ–<code>MAINTAINER</code>æŒ‡ä»¤ã€‚</li>
</ol>
<h1 id="STOPSIGNAL"><a href="#STOPSIGNAL" class="headerlink" title="STOPSIGNAL"></a>STOPSIGNAL</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">STOPSIGNAL signal</span><br></pre></td></tr></table></figure>

<p><code>STOPSIGNAL</code>æŒ‡ä»¤è®¾ç½®å°†å‘é€åˆ°å®¹å™¨ä»¥é€€å‡ºçš„ç³»ç»Ÿè°ƒç”¨ä¿¡å·ã€‚è¯¥ä¿¡å·å¯ä»¥æ˜¯ä¸å†…æ ¸ç³»ç»Ÿè°ƒç”¨è¡¨ä¸­çš„ä½ç½®åŒ¹é…çš„æœ‰æ•ˆæ— ç¬¦å·æ•°ï¼Œä¾‹å¦‚9ï¼Œæˆ–è€…æ˜¯SIGNAMEæ ¼å¼çš„ä¿¡å·åç§°ï¼Œä¾‹å¦‚SIGKILL</p>
<h1 id="HEALTHCHECK"><a href="#HEALTHCHECK" class="headerlink" title="HEALTHCHECK"></a>HEALTHCHECK</h1><p>ä¸¤ç§å½¢å¼ï¼š</p>
<ul>
<li>HEALTHCHECK [OPTIONS] CMD command (é€šè¿‡åœ¨å®¹å™¨ä¸­è¿è¡Œå‘½ä»¤æ¥æ£€æŸ¥å®¹å™¨è¿è¡ŒçŠ¶å†µ)</li>
<li>HEALTHCHECK NONE (ç¦ç”¨ä»åŸºæœ¬æ˜ åƒç»§æ‰¿çš„ä»»ä½•è¿è¡ŒçŠ¶å†µæ£€æŸ¥)</li>
</ul>
<p><code>HEALTHCHECK</code>æŒ‡ä»¤å‘Šè¯‰Dockerå¦‚ä½•æµ‹è¯•å®¹å™¨ä»¥æ£€æŸ¥å®ƒæ˜¯å¦ä»åœ¨å·¥ä½œã€‚è¿™å¯ä»¥æ£€æµ‹åˆ°è¯¸å¦‚WebæœåŠ¡å™¨è¢«å¡åœ¨æ— é™å¾ªç¯ä¸­å¹¶ä¸”æ— æ³•å¤„ç†æ–°è¿æ¥çš„æƒ…å†µï¼Œå³ä½¿æœåŠ¡å™¨è¿›ç¨‹ä»åœ¨è¿è¡Œã€‚</p>
<p>å½“å®¹å™¨æŒ‡å®šäº†healthcheckæ—¶ï¼Œé™¤äº†å…¶æ­£å¸¸çŠ¶æ€å¤–ï¼Œå®ƒè¿˜å…·æœ‰å¥åº·çŠ¶æ€ã€‚æ­¤çŠ¶æ€æœ€åˆå¼€å§‹ã€‚ æ¯å½“å¥åº·æ£€æŸ¥é€šè¿‡ï¼Œå®ƒå˜å¾—å¥åº·ï¼ˆæ— è®ºä¹‹å‰çš„çŠ¶æ€ï¼‰ã€‚åœ¨ä¸€å®šæ•°é‡çš„è¿ç»­æ•…éšœåï¼Œå®ƒå˜å¾—ä¸å¥åº·ã€‚</p>
<p>åœ¨CMDä¹‹å‰å¯ä»¥å‡ºç°çš„é€‰é¡¹æœ‰ï¼š</p>
<ul>
<li><code>--interval=DURATION</code> (default: 30s)</li>
<li><code>--timeout=DURATION</code> (default: 30s)</li>
<li><code>--retries=N</code> (default: 3)</li>
</ul>
<p>è¿è¡ŒçŠ¶å†µæ£€æŸ¥å°†é¦–å…ˆåœ¨å®¹å™¨å¯åŠ¨åè¿è¡Œ<strong>interval</strong>ç§’ï¼Œç„¶ååœ¨æ¯æ¬¡ä¸Šæ¬¡æ£€æŸ¥å®Œæˆåå†æ¬¡è¿è¡Œ<strong>interval</strong>ç§’ã€‚</p>
<p>å¦‚æœæ£€æŸ¥çš„å•æ¬¡è¿è¡Œæ‰€èŠ±è´¹çš„æ—¶é—´è¶…è¿‡<strong>timeout</strong>ç§’æ•°ï¼Œåˆ™è¯¥æ£€æŸ¥è¢«è®¤ä¸ºå·²å¤±è´¥ã€‚</p>
<p>å®ƒéœ€è¦<strong>retries</strong>è¿ç»­çš„å¥åº·æ£€æŸ¥çš„æ•…éšœï¼Œå®¹å™¨è¢«è®¤ä¸ºæ˜¯ä¸å¥åº·çš„ã€‚</p>
<p>åœ¨Dockerfileä¸­åªèƒ½æœ‰ä¸€ä¸ª<code>HEALTHCHECK</code>æŒ‡ä»¤ã€‚å¦‚æœæ‚¨åˆ—å‡ºå¤šä¸ªï¼Œåˆ™åªæœ‰æœ€åä¸€ä¸ª<code>HEALTHCHECK</code>å°†ç”Ÿæ•ˆã€‚</p>
<p><code>CMD</code>å…³é”®å­—ä¹‹åçš„å‘½ä»¤å¯ä»¥æ˜¯shellå‘½ä»¤ï¼ˆä¾‹å¦‚<code>HEALTHCHECK CMD /bin/check-running</code>ï¼‰æˆ–execæ•°ç»„ï¼ˆå¦‚åŒå…¶ä»–Dockerfileå‘½ä»¤ä¸€æ ·;è¯¦æƒ…å‚è§<code>ENTRYPOINT</code>ï¼‰ã€‚</p>
<p>å‘½ä»¤çš„é€€å‡ºçŠ¶æ€è¡¨ç¤ºå®¹å™¨çš„è¿è¡ŒçŠ¶å†µã€‚ å¯èƒ½çš„å€¼ä¸ºï¼š</p>
<ul>
<li>0: success - the container is healthy and ready for use</li>
<li>1: unhealthy - the container is not working correctly</li>
<li>2: reserved - do not use this exit code</li>
</ul>
<p>ä¾‹å¦‚ï¼Œè¦æ¯äº”åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡WebæœåŠ¡å™¨èƒ½å¤Ÿåœ¨ä¸‰ç§’é’Ÿå†…ä¸ºç½‘ç«™çš„ä¸»é¡µæä¾›æœåŠ¡ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">HEALTHCHECK --interval&#x3D;5m --timeout&#x3D;3s \</span><br><span class="line">  CMD curl -f http:&#x2F;&#x2F;localhost&#x2F; || exit 1</span><br></pre></td></tr></table></figure>

<p>ä¸ºäº†å¸®åŠ©è°ƒè¯•å¤±è´¥çš„æ¢æµ‹å™¨ï¼Œå‘½ä»¤åœ¨stdoutæˆ–stderrä¸Šå†™å…¥çš„ä»»ä½•è¾“å‡ºæ–‡æœ¬ï¼ˆUTF-8ç¼–ç ï¼‰å°†å­˜å‚¨åœ¨è¿è¡ŒçŠ¶å†µçŠ¶æ€ï¼Œå¹¶å¯ä»¥ä½¿ç”¨<code>docker inspect</code>æŸ¥è¯¢ã€‚è¿™æ ·çš„è¾“å‡ºåº”è¯¥ä¿æŒçŸ­è·¯ï¼ˆåªå­˜å‚¨å½“å‰çš„4096ä¸ªå­—èŠ‚ï¼‰ã€‚</p>
<p>å½“å®¹å™¨çš„è¿è¡ŒçŠ¶å†µå‘ç”Ÿæ›´æ”¹æ—¶ï¼Œå°†ç”Ÿæˆå…·æœ‰æ–°çŠ¶æ€çš„<code>health_status</code>äº‹ä»¶ã€‚</p>
<p><code>HEALTHCHECK</code>åŠŸèƒ½åœ¨Docker 1.12ä¸­æ·»åŠ ã€‚</p>
<h1 id="SHELL"><a href="#SHELL" class="headerlink" title="SHELL"></a>SHELL</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHELL [&quot;executable&quot;, &quot;parameters&quot;]</span><br></pre></td></tr></table></figure>

<p><code>SHELL</code>æŒ‡ä»¤å…è®¸ç”¨äºå‘½ä»¤çš„shellå½¢å¼çš„é»˜è®¤shellè¢«è¦†ç›–ã€‚ Linuxä¸Šçš„é»˜è®¤shellæ˜¯<code>[&quot;/bin/sh&quot;,&quot;-c&quot;]</code>ï¼Œåœ¨Windowsä¸Šæ˜¯<code>[&quot;cmd&quot;,&quot;/S&quot;,&quot;/C&quot;]</code>ã€‚<code>SHELL</code>æŒ‡ä»¤å¿…é¡»ä»¥JSONæ ¼å¼å†™åœ¨Dockerfileä¸­ã€‚</p>
<p><code>SHELL</code>æŒ‡ä»¤åœ¨Windowsä¸Šç‰¹åˆ«æœ‰ç”¨ï¼Œå…¶ä¸­æœ‰ä¸¤ä¸ªå¸¸ç”¨çš„å’Œå®Œå…¨ä¸åŒçš„æœ¬æœºshellï¼š<code>cmd</code>å’Œ<code>powershell</code>ï¼Œä»¥åŠåŒ…æ‹¬<code>sh</code>çš„å¤‡ç”¨Shellã€‚</p>
<p><code>SHELL</code>æŒ‡ä»¤å¯ä»¥å¤šæ¬¡å‡ºç°ã€‚æ¯ä¸ª<code>SHELL</code>æŒ‡ä»¤è¦†ç›–æ‰€æœ‰å…ˆå‰çš„<code>SHELL</code>æŒ‡ä»¤ï¼Œå¹¶å½±å“æ‰€æœ‰åç»­æŒ‡ä»¤ã€‚ ä¾‹å¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">FROM windowsservercore</span><br><span class="line"></span><br><span class="line"># Executed as cmd &#x2F;S &#x2F;C echo default</span><br><span class="line">RUN echo default</span><br><span class="line"></span><br><span class="line"># Executed as cmd &#x2F;S &#x2F;C powershell -command Write-Host default</span><br><span class="line">RUN powershell -command Write-Host default</span><br><span class="line"></span><br><span class="line"># Executed as powershell -command Write-Host hello</span><br><span class="line">SHELL [&quot;powershell&quot;, &quot;-command&quot;]</span><br><span class="line">RUN Write-Host hello</span><br><span class="line"></span><br><span class="line"># Executed as cmd &#x2F;S &#x2F;C echo hello</span><br><span class="line">SHELL [&quot;cmd&quot;, &quot;&#x2F;S&quot;&quot;, &quot;&#x2F;C&quot;]</span><br><span class="line">RUN echo hello</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸‹æŒ‡ä»¤å¯èƒ½å—<code>SHELL</code>æŒ‡ä»¤çš„å½±å“ï¼Œå½“å®ƒä»¬çš„shellå½¢å¼ç”¨äºDockerfileï¼š<code>RUN</code>ï¼Œ<code>CMD</code>å’Œ<code>ENTRYPOINT</code>ã€‚</p>
<p>ä»¥ä¸‹ç¤ºä¾‹æ˜¯Windowsä¸Šçš„å¸¸è§æ¨¡å¼ï¼Œå¯ä»¥ä½¿ç”¨SHELLæŒ‡ä»¤è¿›è¡Œç®€åŒ–ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">RUN powershell -command Execute-MyCmdlet -param1 &quot;c:\foo.txt&quot;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>dockerè°ƒç”¨çš„å‘½ä»¤å°†æ˜¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmd &#x2F;S &#x2F;C powershell -command Execute-MyCmdlet -param1 &quot;c:\foo.txt&quot;</span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯ä½æ•ˆçš„ï¼Œæœ‰ä¸¤ä¸ªåŸå› ã€‚é¦–å…ˆï¼Œæœ‰ä¸€ä¸ªä¸å¿…è¦çš„cmd.exeå‘½ä»¤å¤„ç†å™¨ï¼ˆä¹Ÿç§°ä¸ºshellï¼‰è¢«è°ƒç”¨ã€‚å…¶æ¬¡ï¼Œshellä¸­çš„æ¯ä¸ª<code>RUN</code>æŒ‡ä»¤éƒ½éœ€è¦ä¸€ä¸ªé¢å¤–çš„<code>powershell -command</code>ã€‚</p>
<p>ä¸ºäº†æ›´æœ‰æ•ˆç‡ï¼Œå¯ä»¥é‡‡ç”¨ä¸¤ç§æœºåˆ¶ä¹‹ä¸€ã€‚ ä¸€ç§æ˜¯ä½¿ç”¨JSONå½¢å¼çš„RUNå‘½ä»¤ï¼Œå¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">RUN [&quot;powershell&quot;, &quot;-command&quot;, &quot;Execute-MyCmdlet&quot;, &quot;-param1 \&quot;c:\\foo.txt\&quot;&quot;]</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>è™½ç„¶JSONå½¢å¼æ˜¯æ˜ç¡®çš„ï¼Œå¹¶ä¸”ä¸ä½¿ç”¨ä¸å¿…è¦çš„cmd.exeï¼Œä½†å®ƒéœ€è¦é€šè¿‡åŒå¼•å·å’Œè½¬ä¹‰æ›´è¯¦ç»†ã€‚ å¤‡ç”¨æœºåˆ¶æ˜¯ä½¿ç”¨<code>SHELL</code>æŒ‡ä»¤å’Œshellå½¢å¼ï¼Œä¸ºWindowsç”¨æˆ·æä¾›æ›´è‡ªç„¶çš„è¯­æ³•ï¼Œç‰¹åˆ«æ˜¯ä¸<code>escape</code> è§£ææŒ‡ä»¤ç»“åˆä½¿ç”¨æ—¶ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># escape&#x3D;&#96;</span><br><span class="line"></span><br><span class="line">FROM windowsservercore</span><br><span class="line">SHELL [&quot;powershell&quot;,&quot;-command&quot;]</span><br><span class="line">RUN New-Item -ItemType Directory C:\Example</span><br><span class="line">ADD Execute-MyCmdlet.ps1 c:\example\</span><br><span class="line">RUN c:\example\Execute-MyCmdlet -sample &#39;hello world&#39;</span><br></pre></td></tr></table></figure>

<p>ç»“æœæ˜¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">PS E:\docker\build\shell&gt; docker build -t shell .</span><br><span class="line">Sending build context to Docker daemon 3.584 kB</span><br><span class="line">Step 1 : FROM windowsservercore</span><br><span class="line"> ---&gt; 5bc36a335344</span><br><span class="line">Step 2 : SHELL powershell -command</span><br><span class="line"> ---&gt; Running in 87d7a64c9751</span><br><span class="line"> ---&gt; 4327358436c1</span><br><span class="line">Removing intermediate container 87d7a64c9751</span><br><span class="line">Step 3 : RUN New-Item -ItemType Directory C:\Example</span><br><span class="line"> ---&gt; Running in 3e6ba16b8df9</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Directory: C:\</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                LastWriteTime         Length Name</span><br><span class="line">----                -------------         ------ ----</span><br><span class="line">d-----         6&#x2F;2&#x2F;2016   2:59 PM                Example</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> ---&gt; 1f1dfdcec085</span><br><span class="line">Removing intermediate container 3e6ba16b8df9</span><br><span class="line">Step 4 : ADD Execute-MyCmdlet.ps1 c:\example\</span><br><span class="line"> ---&gt; 6770b4c17f29</span><br><span class="line">Removing intermediate container b139e34291dc</span><br><span class="line">Step 5 : RUN c:\example\Execute-MyCmdlet -sample &#39;hello world&#39;</span><br><span class="line"> ---&gt; Running in abdcf50dfd1f</span><br><span class="line">Hello from Execute-MyCmdlet.ps1 - passed hello world</span><br><span class="line"> ---&gt; ba0e25255fda</span><br><span class="line">Removing intermediate container abdcf50dfd1f</span><br><span class="line">Successfully built ba0e25255fda</span><br><span class="line">PS E:\docker\build\shell&gt;</span><br></pre></td></tr></table></figure>

<p><code>SHELL</code>æŒ‡ä»¤è¿˜å¯ä»¥ç”¨äºä¿®æ”¹å¤–å£³æ“ä½œçš„æ–¹å¼ã€‚ä¾‹å¦‚ï¼Œåœ¨Windowsä¸Šä½¿ç”¨<code>SHELL cmd /S /C /V:ON|OFF</code>ï¼Œå¯ä»¥ä¿®æ”¹å»¶è¿Ÿçš„ç¯å¢ƒå˜é‡æ‰©å±•è¯­ä¹‰ã€‚</p>
<p><code>SHELL</code>æŒ‡ä»¤ä¹Ÿå¯ä»¥åœ¨Linuxä¸Šä½¿ç”¨ï¼Œå¦‚æœéœ€è¦ä¸€ä¸ªæ›¿ä»£shellï¼Œå¦‚<code>zsh</code>ï¼Œ<code>csh</code>ï¼Œ<code>tcsh</code>å’Œå…¶ä»–ã€‚</p>
<p><code>SHELL</code>åŠŸèƒ½åœ¨Docker 1.12ä¸­æ·»åŠ </p>

      
    </div>

    
    
    
      

      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://docs.lvrui.io/2017/04/16/docker-container%E5%AE%B9%E5%99%A8%E7%AE%A1%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.JPG">
      <meta itemprop="name" content="æåœ°ç‘é›ª">
      <meta itemprop="description" content="æåœ°ç‘é›ªçš„ä¸ªäººæŠ€æœ¯åšå®¢. "å–ä¹‹å¼€æº ç”¨ä¹‹å¼€æº", åˆ†äº«è‡ªå·±çš„ç»éªŒä¹‹è°ˆ".">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Polar Snow Documentation">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/04/16/docker-container%E5%AE%B9%E5%99%A8%E7%AE%A1%E7%90%86/" class="post-title-link" itemprop="url">docker container å®¹å™¨ç®¡ç†</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2017-04-16 16:49:22" itemprop="dateCreated datePublished" datetime="2017-04-16T16:49:22+08:00">2017-04-16</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Docker/" itemprop="url" rel="index"><span itemprop="name">Docker</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqusï¼š</span>
    
    <a title="disqus" href="/2017/04/16/docker-container%E5%AE%B9%E5%99%A8%E7%AE%A1%E7%90%86/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/04/16/docker-containerå®¹å™¨ç®¡ç†/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<ul>
<li>Docker ç®¡ç†å‘½ä»¤<ul>
<li><strong>å®¹å™¨ç®¡ç†</strong></li>
<li>é•œåƒç®¡ç†</li>
<li>ç½‘ç»œç®¡ç†</li>
<li>ç³»ç»Ÿç®¡ç†</li>
<li>æ•°æ®å·ç®¡ç†</li>
<li>å¿«ç…§ç®¡ç†</li>
<li>æ’ä»¶ç®¡ç†</li>
<li>å…¶ä»–</li>
<li>swarmkit ç®¡ç†<ul>
<li>æ¨¡å¼ç®¡ç†</li>
<li>èŠ‚ç‚¹ç®¡ç†</li>
<li>ç§˜é’¥ç®¡ç†</li>
<li>æœåŠ¡ç®¡ç†</li>
<li>æœåŠ¡æ ˆç®¡ç†</li>
</ul>
</li>
</ul>
</li>
</ul>
</blockquote>
<p>Docker çš„æ¯ä¸€çº§å‘½ä»¤éƒ½å¯ä»¥ä½¿ç”¨<code>--help</code> çš„å‚æ•°æ¥æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯</p>
<h1 id="Docker-ä¸€çº§å‘½ä»¤"><a href="#Docker-ä¸€çº§å‘½ä»¤" class="headerlink" title="Docker ä¸€çº§å‘½ä»¤"></a>Docker ä¸€çº§å‘½ä»¤</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker --help</span></span><br><span class="line"></span><br><span class="line">Usage:	docker COMMAND</span><br><span class="line"></span><br><span class="line">A self-sufficient runtime <span class="keyword">for</span> containers</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">      --config string      Location of client config files (default <span class="string">"/root/.docker"</span>)</span><br><span class="line">  -D, --debug              Enable debug mode</span><br><span class="line">      --<span class="built_in">help</span>               Print usage</span><br><span class="line">  -H, --host list          Daemon socket(s) to connect to (default [])</span><br><span class="line">  -l, --<span class="built_in">log</span>-level string   Set the logging level (<span class="string">"debug"</span>|<span class="string">"info"</span>|<span class="string">"warn"</span>|<span class="string">"error"</span>|<span class="string">"fatal"</span>) (default <span class="string">"info"</span>)</span><br><span class="line">      --tls                Use TLS; implied by --tlsverify</span><br><span class="line">      --tlscacert string   Trust certs signed only by this CA (default <span class="string">"/root/.docker/ca.pem"</span>)</span><br><span class="line">      --tlscert string     Path to TLS certificate file (default <span class="string">"/root/.docker/cert.pem"</span>)</span><br><span class="line">      --tlskey string      Path to TLS key file (default <span class="string">"/root/.docker/key.pem"</span>)</span><br><span class="line">      --tlsverify          Use TLS and verify the remote</span><br><span class="line">  -v, --version            Print version information and quit</span><br><span class="line"></span><br><span class="line">Management Commands:</span><br><span class="line">  container   Manage containers</span><br><span class="line">  image       Manage images</span><br><span class="line">  network     Manage networks</span><br><span class="line">  node        Manage Swarm nodes</span><br><span class="line">  plugin      Manage plugins</span><br><span class="line">  secret      Manage Docker secrets</span><br><span class="line">  service     Manage services</span><br><span class="line">  stack       Manage Docker stacks</span><br><span class="line">  swarm       Manage Swarm</span><br><span class="line">  system      Manage Docker</span><br><span class="line">  volume      Manage volumes</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line">  attach      Attach to a running container</span><br><span class="line">  build       Build an image from a Dockerfile</span><br><span class="line">  commit      Create a new image from a container<span class="string">'s changes</span></span><br><span class="line"><span class="string">  cp          Copy files/folders between a container and the local filesystem</span></span><br><span class="line"><span class="string">  create      Create a new container</span></span><br><span class="line"><span class="string">  diff        Inspect changes to files or directories on a container'</span>s filesystem</span><br><span class="line">  events      Get real time events from the server</span><br><span class="line">  <span class="built_in">exec</span>        Run a <span class="built_in">command</span> <span class="keyword">in</span> a running container</span><br><span class="line">  <span class="built_in">export</span>      Export a container<span class="string">'s filesystem as a tar archive</span></span><br><span class="line"><span class="string">  history     Show the history of an image</span></span><br><span class="line"><span class="string">  images      List images</span></span><br><span class="line"><span class="string">  import      Import the contents from a tarball to create a filesystem image</span></span><br><span class="line"><span class="string">  info        Display system-wide information</span></span><br><span class="line"><span class="string">  inspect     Return low-level information on Docker objects</span></span><br><span class="line"><span class="string">  kill        Kill one or more running containers</span></span><br><span class="line"><span class="string">  load        Load an image from a tar archive or STDIN</span></span><br><span class="line"><span class="string">  login       Log in to a Docker registry</span></span><br><span class="line"><span class="string">  logout      Log out from a Docker registry</span></span><br><span class="line"><span class="string">  logs        Fetch the logs of a container</span></span><br><span class="line"><span class="string">  pause       Pause all processes within one or more containers</span></span><br><span class="line"><span class="string">  port        List port mappings or a specific mapping for the container</span></span><br><span class="line"><span class="string">  ps          List containers</span></span><br><span class="line"><span class="string">  pull        Pull an image or a repository from a registry</span></span><br><span class="line"><span class="string">  push        Push an image or a repository to a registry</span></span><br><span class="line"><span class="string">  rename      Rename a container</span></span><br><span class="line"><span class="string">  restart     Restart one or more containers</span></span><br><span class="line"><span class="string">  rm          Remove one or more containers</span></span><br><span class="line"><span class="string">  rmi         Remove one or more images</span></span><br><span class="line"><span class="string">  run         Run a command in a new container</span></span><br><span class="line"><span class="string">  save        Save one or more images to a tar archive (streamed to STDOUT by default)</span></span><br><span class="line"><span class="string">  search      Search the Docker Hub for images</span></span><br><span class="line"><span class="string">  start       Start one or more stopped containers</span></span><br><span class="line"><span class="string">  stats       Display a live stream of container(s) resource usage statistics</span></span><br><span class="line"><span class="string">  stop        Stop one or more running containers</span></span><br><span class="line"><span class="string">  tag         Create a tag TARGET_IMAGE that refers to SOURCE_IMAGE</span></span><br><span class="line"><span class="string">  top         Display the running processes of a container</span></span><br><span class="line"><span class="string">  unpause     Unpause all processes within one or more containers</span></span><br><span class="line"><span class="string">  update      Update configuration of one or more containers</span></span><br><span class="line"><span class="string">  version     Show the Docker version information</span></span><br><span class="line"><span class="string">  wait        Block until one or more containers stop, then print their exit codes</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Run '</span>docker COMMAND --<span class="built_in">help</span><span class="string">' for more information on a command.</span></span><br></pre></td></tr></table></figure>

<p>åœ¨ Docker1.13ç‰ˆæœ¬ä¹‹å‰, æ˜¯æ²¡æœ‰äºŒçº§ç®¡ç†å‘½ä»¤çš„, éšç€ Docker çš„åŠŸèƒ½è¶Šæ¥è¶Šå¤š, å‘½ä»¤å‚æ•°ä¹Ÿè¶Šæ¥è¶Šå¤š, åˆ°1.13ç‰ˆæœ¬å, Docker ç»ˆäºå¯¹ä»–ä»¬åšå‡ºäº†å½’ç±», ä¹‹å‰çš„è¯­æ³•ä¹Ÿå…¼å®¹, ä½†æ˜¯ Docker æ¨èä½¿ç”¨æœ€æ–°çš„è¯­æ³•æ ¼å¼.</p>
<p>1.13ç‰ˆæœ¬å, Docker å¯¹å‘½ä»¤åšå‡ºäº†å¦‚ä¸‹å½’ç±»:</p>
<ul>
<li>container   Manage containers</li>
<li>image       Manage images</li>
<li>network     Manage networks</li>
<li>node        Manage Swarm nodes</li>
<li>plugin      Manage plugins</li>
<li>secret      Manage Docker secrets</li>
<li>service     Manage services</li>
<li>stack       Manage Docker stacks</li>
<li>swarm       Manage Swarm</li>
<li>system      Manage Docker</li>
<li>volume      Manage volumes</li>
</ul>
<h1 id="å®¹å™¨ç®¡ç†-container"><a href="#å®¹å™¨ç®¡ç†-container" class="headerlink" title="å®¹å™¨ç®¡ç† container"></a>å®¹å™¨ç®¡ç† container</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker container --help</span></span><br><span class="line"></span><br><span class="line">Usage:	docker container COMMAND</span><br><span class="line"></span><br><span class="line">Manage containers</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">      --<span class="built_in">help</span>   Print usage</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line">  attach      Attach to a running container</span><br><span class="line">  commit      Create a new image from a container<span class="string">'s changes</span></span><br><span class="line"><span class="string">  cp          Copy files/folders between a container and the local filesystem</span></span><br><span class="line"><span class="string">  create      Create a new container</span></span><br><span class="line"><span class="string">  diff        Inspect changes to files or directories on a container'</span>s filesystem</span><br><span class="line">  <span class="built_in">exec</span>        Run a <span class="built_in">command</span> <span class="keyword">in</span> a running container</span><br><span class="line">  <span class="built_in">export</span>      Export a container<span class="string">'s filesystem as a tar archive</span></span><br><span class="line"><span class="string">  inspect     Display detailed information on one or more containers</span></span><br><span class="line"><span class="string">  kill        Kill one or more running containers</span></span><br><span class="line"><span class="string">  logs        Fetch the logs of a container</span></span><br><span class="line"><span class="string">  ls          List containers</span></span><br><span class="line"><span class="string">  pause       Pause all processes within one or more containers</span></span><br><span class="line"><span class="string">  port        List port mappings or a specific mapping for the container</span></span><br><span class="line"><span class="string">  prune       Remove all stopped containers</span></span><br><span class="line"><span class="string">  rename      Rename a container</span></span><br><span class="line"><span class="string">  restart     Restart one or more containers</span></span><br><span class="line"><span class="string">  rm          Remove one or more containers</span></span><br><span class="line"><span class="string">  run         Run a command in a new container</span></span><br><span class="line"><span class="string">  start       Start one or more stopped containers</span></span><br><span class="line"><span class="string">  stats       Display a live stream of container(s) resource usage statistics</span></span><br><span class="line"><span class="string">  stop        Stop one or more running containers</span></span><br><span class="line"><span class="string">  top         Display the running processes of a container</span></span><br><span class="line"><span class="string">  unpause     Unpause all processes within one or more containers</span></span><br><span class="line"><span class="string">  update      Update configuration of one or more containers</span></span><br><span class="line"><span class="string">  wait        Block until one or more containers stop, then print their exit codes</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Run '</span>docker container COMMAND --<span class="built_in">help</span><span class="string">' for more information on a command.</span></span><br></pre></td></tr></table></figure>



<h2 id="attach"><a href="#attach" class="headerlink" title="attach"></a>attach</h2><p>è¿›å…¥å®¹å™¨çš„æ–¹å¼ä¹‹ä¸€, ç¿»è¯‘è¿‡æ¥å«â€é™„ç€â€åˆ°è¿è¡Œçš„å®¹å™¨ä¸­. ä»–ä¸<code>exec</code> æœ‰æœ¬è´¨çš„åŒºåˆ«, exec è¿›å…¥å®¹å™¨æ˜¯åœ¨ä¸»è¿›ç¨‹çš„åŸºç¡€ä¹‹ä¸Š, å†å¼€é€šä¸€ä¸ªè¿›ç¨‹å®ç°çš„è¿›å…¥å®¹å™¨. è€Œ attach åˆ™æ„å‘³ç€è¿›å…¥åˆ°å®¹å™¨çš„ä¸»è¿›ç¨‹ä¸­. äº§ç”Ÿçš„åæœä¹Ÿä¸ä¸€æ ·, ç”±äº attach è¿›å…¥åˆ°äº†ä¸»è¿›ç¨‹, ä¸€æ—¦ Ctrl+C é€€å‡ºç»ˆç«¯, å°†å¯¼è‡´ä¸»è¿›ç¨‹é€€å‡º, ä»è€Œå®¹å™¨ä¹Ÿéšä¹‹é€€å‡º. è€Œ exec çš„æ–¹å¼è¿›å…¥å®¹å™¨æ˜¯å•ç‹¬å¼€å¯äº†ä¸€ä¸ªè¿›ç¨‹, è¯¥è¿›ç¨‹çš„äº§ç”Ÿäºé”€æ¯å¹¶ä¸å½±å“ä¸»è¿›ç¨‹, æ‰€ä»¥ä¸ä¼šå› ä¸ºç»ˆç«¯çš„é€€å‡ºè€Œå¯¼è‡´å®¹å™¨é€€å‡º.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker run -d centos ping 123.57.233.243</span></span><br><span class="line">2ad157c779469961faabec0e836f7d2ab03a7e6193d932647e83626231fa0560</span><br><span class="line">root@ubuntu:~<span class="comment"># </span></span><br><span class="line">root@ubuntu:~<span class="comment"># docker container attach 2ad</span></span><br><span class="line">64 bytes from 123.57.233.243: icmp_seq=40 ttl=127 time=8.05 ms</span><br><span class="line">64 bytes from 123.57.233.243: icmp_seq=41 ttl=127 time=7.46 ms</span><br><span class="line">64 bytes from 123.57.233.243: icmp_seq=42 ttl=127 time=8.86 ms</span><br><span class="line">64 bytes from 123.57.233.243: icmp_seq=43 ttl=127 time=9.80 ms</span><br><span class="line">64 bytes from 123.57.233.243: icmp_seq=44 ttl=127 time=6.24 ms</span><br><span class="line">64 bytes from 123.57.233.243: icmp_seq=45 ttl=127 time=6.01 ms</span><br><span class="line">^C</span><br><span class="line">--- 123.57.233.243 ping statistics ---</span><br><span class="line">62 packets transmitted, 62 received, 0% packet loss, time 61130ms</span><br><span class="line">rtt min/avg/max/mdev = 5.407/18.181/204.154/32.140 ms</span><br><span class="line">root@ubuntu:~<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<h2 id="exec"><a href="#exec" class="headerlink" title="exec"></a>exec</h2><p>åœ¨ä¸€ä¸ªè¿è¡Œä¸­çš„å®¹å™¨å†…æ‰§è¡Œå‘½ä»¤. å°±å¦‚ä¸Šé¢æ‰€è¯´, ä½¿ç”¨ exec æ‰§è¡Œå‘½ä»¤æ„å‘³ç€åœ¨ä¸»è¿›ç¨‹çš„åŸºç¡€ä¹‹ä¸Š, å†å¯åŠ¨å…¶ä»–çš„è¿›ç¨‹, å…¶ä»–è¿›ç¨‹çš„å¯åŠ¨ä¸é”€æ¯ä¸ä¼šç›´æ¥å½±å“å®¹å™¨çš„é€€å‡º.</p>
<p>exec çš„ç”¨æ³•å¾ˆå¤š, ä½¿ç”¨é¢‘ç‡æœ€é«˜çš„æ˜¯è¿›å…¥å®¹å™¨çš„æ“ä½œ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker container exec -it b9704931408c /bin/bash</span></span><br><span class="line">root@b9704931408c:/<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>ä¹Ÿå¯ä»¥è¿è¡Œä»»ä½•bashå‘½ä»¤</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker container exec 11610baab1ce echo "haha"</span></span><br><span class="line">haha</span><br><span class="line">root@ubuntu:~<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                        NAMES</span><br><span class="line">b9704931408c        nginx               <span class="string">"nginx -g 'daemon ..."</span>   About an hour ago   Up About an hour    0.0.0.0:443-&gt;443/tcp, 0.0.0.0:8080-&gt;80/tcp   my-third-nginx</span><br><span class="line">d0a4936e940e        nginx               <span class="string">"nginx -g 'daemon ..."</span>   About an hour ago   Up About an hour    443/tcp, 0.0.0.0:8800-&gt;80/tcp                my-second-nginx</span><br><span class="line">11610baab1ce        nginx               <span class="string">"nginx -g 'daemon ..."</span>   About an hour ago   Up 12 minutes       80/tcp, 443/tcp                              my-first-nginx</span><br></pre></td></tr></table></figure>

<h2 id="commit"><a href="#commit" class="headerlink" title="commit"></a>commit</h2><p>åŸºäºä¸€ä¸ªç°æœ‰çš„å®¹å™¨åˆ›å»ºæ–°çš„é•œåƒ. commit å¤šç”¨åœ¨åšå®¹å™¨è¿ç§»çš„æ—¶å€™, å½“å®¹å™¨ä¸ºç”±çŠ¶æ€æ—¶, æˆ‘ä»¬éœ€è¦ä¿å­˜ç°æœ‰å®¹å™¨çš„æ‰€æœ‰è¿è¡ŒçŠ¶æ€ä»¥ä¿è¯è¿ç§»åçš„ä¸€è‡´æ€§, è¿™æ—¶ commit å°±æ´¾ä¸Šäº†ç”¨åœº.</p>
<p>è¿è¡Œä¸€ä¸ªåˆå§‹çš„é•œåƒ, æˆ‘ä»¬é€šè¿‡ exec è¿›å…¥åˆ°å®¹å™¨, å¹¶åšäº†ä¸€äº›ä¿®æ”¹, å½“éœ€è¦è¿ç§»æ­¤å®¹å™¨æ—¶, å¯ä»¥æŠŠå½“å‰ä¿®æ”¹è¿‡åçš„å®¹å™¨ä¿å­˜ä¸ºä¸€ä¸ªæ–°çš„é•œåƒ. ç„¶åå°†é•œåƒè¿ç§»è‡³æ–°ä¸»æœº, å† run èµ·æ¥.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¿®æ”¹å®¹å™¨å†…å®¹</span></span><br><span class="line">root@ubuntu:~<span class="comment"># docker exec -it my-first-nginx /bin/bash</span></span><br><span class="line">root@11610baab1ce:/<span class="comment"># cd /tmp/</span></span><br><span class="line">root@11610baab1ce:/tmp<span class="comment"># ls</span></span><br><span class="line">root@11610baab1ce:/tmp<span class="comment"># echo "commit test" &gt; /tmp/c.txt</span></span><br><span class="line">root@11610baab1ce:/tmp<span class="comment"># ls</span></span><br><span class="line">c.txt</span><br><span class="line">root@11610baab1ce:/tmp<span class="comment"># cat /tmp/c.txt </span></span><br><span class="line">commit <span class="built_in">test</span></span><br><span class="line">root@11610baab1ce:/tmp<span class="comment"># exit</span></span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line"><span class="comment"># commit é•œåƒ</span></span><br><span class="line">root@ubuntu:~<span class="comment"># docker commit my-first-nginx nginx2:0.1</span></span><br><span class="line">sha256:7cb5220c81d58a56471b6ce69e40bf4d15f89652b4b4bd78ec4579b6473bfc91</span><br><span class="line">root@ubuntu:~<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">nginx2              0.1                 7cb5220c81d5        4 seconds ago       204MB</span><br><span class="line">centos              latest              a8493f5f50ff        35 hours ago        192MB</span><br><span class="line">nginx               latest              5766334bdaa0        39 hours ago        183MB</span><br><span class="line">hello-world         latest              48b5124b2768        2 months ago        1.84kB</span><br><span class="line"><span class="comment"># åŸºäºæ–°é•œåƒè¿è¡Œæ–°å®¹å™¨</span></span><br><span class="line">root@ubuntu:~<span class="comment"># docker exec -it new-first-nginx /bin/bash</span></span><br><span class="line">root@b4e6f8620ba3:/<span class="comment"># cd /tmp/</span></span><br><span class="line">root@b4e6f8620ba3:/tmp<span class="comment"># ls</span></span><br><span class="line">c.txt</span><br><span class="line">root@b4e6f8620ba3:/tmp<span class="comment"># cat c.txt </span></span><br><span class="line">commit <span class="built_in">test</span></span><br><span class="line">root@b4e6f8620ba3:/tmp<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>æ³¨æ„: æŒ‚è½½çš„æ•°æ®æ˜¯ä¸ä¼šè¢« commit åˆ°é•œåƒä¸­çš„. è¿ç§»ä¹‹åéœ€è¦ç”¨ç›¸åŒçš„å‚æ•°å¯åŠ¨èµ·æ¥</p>
<p>è¿ç§»æœ‰ä¸¤ç§æ–¹å¼:</p>
<ul>
<li>ä¸€ç§æ˜¯å¯¼å…¥å¯¼å‡ºçš„æ–¹å¼(é€šè¿‡ tar.gz æ–‡ä»¶)</li>
<li>ä¸€ç§æ˜¯é€šè¿‡ Registry çš„æ–¹å¼ push å’Œ pull</li>
</ul>
<p>å¦‚æœæ˜¯é€šè¿‡ Registry çš„æ–¹å¼çš„è¯, éœ€è¦åœ¨ commit æ—¶, é•œåƒåå­—ä¸­åŠ å…¥ Registry åœ°å€</p>
<p><code>docker container commit [OPTIONS] CONTAINER [REPOSITORY[:TAG]]</code></p>
<p>æ³¨æ„: commit çš„è¿‡ç¨‹ä¸­, å®¹å™¨å¤„äº pause çš„çŠ¶æ€, ç±»ä¼¼äº MySQL çš„æ’å®ƒé”</p>
<h2 id="cp"><a href="#cp" class="headerlink" title="cp"></a>cp</h2><p>é€šè¿‡ cp å‘½ä»¤å¯ä»¥æŠŠå®¹å™¨ä¸­çš„æ–‡ä»¶æ‹·è´åˆ°å®¿ä¸»æœº(æŠŠæ–‡ä»¶æ‹¿å‡ºæ¥)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker container cp --help</span></span><br><span class="line"></span><br><span class="line">Usage:	docker container cp [OPTIONS] CONTAINER:SRC_PATH DEST_PATH|-</span><br><span class="line">	docker cp [OPTIONS] SRC_PATH|- CONTAINER:DEST_PATH</span><br><span class="line"></span><br><span class="line">Copy files/folders between a container and the <span class="built_in">local</span> filesystem</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -L, --follow-link   Always follow symbol link <span class="keyword">in</span> SRC_PATH</span><br><span class="line">      --<span class="built_in">help</span>          Print usage</span><br><span class="line">root@ubuntu:~<span class="comment"># docker container cp my-first-nginx:/tmp/c.txt ./</span></span><br><span class="line">root@ubuntu:~<span class="comment"># ls</span></span><br><span class="line">c.txt  web</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„: ä¸¤ç§æ‰§è¡Œæ–¹å¼çš„è¯­æ³•ä¸åŒ</p>
<h2 id="diff"><a href="#diff" class="headerlink" title="diff"></a>diff</h2><p>åˆ—å‡ºä¸åŸå§‹é•œåƒç›¸æ¯”,å®¹å™¨ä¸­å˜åŒ–çš„å†…å®¹.</p>
<ul>
<li>A: å¢åŠ </li>
<li>D: åˆ é™¤</li>
<li>C: ä¿®æ”¹</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker container diff  --help</span></span><br><span class="line"></span><br><span class="line">Usage:	docker container diff CONTAINER</span><br><span class="line"></span><br><span class="line">Inspect changes to files or directories on a container<span class="string">'s filesystem</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Options:</span></span><br><span class="line"><span class="string">      --help   Print usage</span></span><br><span class="line"><span class="string">root@ubuntu:~# docker container diff  my-second-nginx</span></span><br><span class="line"><span class="string">C /run</span></span><br><span class="line"><span class="string">A /run/nginx.pid</span></span><br><span class="line"><span class="string">C /var</span></span><br><span class="line"><span class="string">C /var/cache</span></span><br><span class="line"><span class="string">C /var/cache/nginx</span></span><br><span class="line"><span class="string">A /var/cache/nginx/client_temp</span></span><br><span class="line"><span class="string">A /var/cache/nginx/fastcgi_temp</span></span><br><span class="line"><span class="string">A /var/cache/nginx/proxy_temp</span></span><br><span class="line"><span class="string">A /var/cache/nginx/scgi_temp</span></span><br><span class="line"><span class="string">A /var/cache/nginx/uwsgi_temp</span></span><br></pre></td></tr></table></figure>

<h2 id="export-amp-import-save-amp-load"><a href="#export-amp-import-save-amp-load" class="headerlink" title="export&amp;import/save&amp;load"></a>export&amp;import/save&amp;load</h2><p>Docker çš„å¯¼å…¥å¯¼å‡º</p>
<p><a href="https://docs.lvrui.io/2017/02/19/dockerçš„å¯¼å…¥å¯¼å‡º/">https://docs.lvrui.io/2017/02/19/dockerçš„å¯¼å…¥å¯¼å‡º/</a></p>
<p>export&amp;import æ“ä½œçš„å¯¹è±¡æ˜¯å®¹å™¨, å¯¼å‡ºåˆ°ä¸€ä¸ªæ–°çš„é•œåƒ, è¯¥é•œåƒåªæœ‰ä¸€å±‚</p>
<p>save&amp;load æ“ä½œå¯¹è±¡æ˜¯é•œåƒ, åŸé•œåƒå±‚æ•°ä¿ç•™</p>
<p>å¦‚æœå¯¼å‡ºå®¹å™¨è¿˜éœ€è¦ä¿ç•™å±‚æ•°, é‚£å°±éœ€è¦ä½¿ç”¨ commit+save+load é»„é‡‘ç»„åˆå•¦</p>
<h2 id="inspect"><a href="#inspect" class="headerlink" title="inspect"></a>inspect</h2><p>æŸ¥çœ‹å®¹å™¨è¯¦ç»†ä¿¡æ¯</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker container inspect my-third-nginx</span></span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">"Id"</span>: <span class="string">"b9704931408c6d054bc9c510878e10467a71d412bef065afa7414403982001b6"</span>,</span><br><span class="line">        <span class="string">"Created"</span>: <span class="string">"2017-04-08T06:22:29.186834559Z"</span>,</span><br><span class="line">        <span class="string">"Path"</span>: <span class="string">"nginx"</span>,</span><br><span class="line">        <span class="string">"Args"</span>: [</span><br><span class="line">            <span class="string">"-g"</span>,</span><br><span class="line">            <span class="string">"daemon off;"</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="string">"State"</span>: &#123;</span><br><span class="line">            <span class="string">"Status"</span>: <span class="string">"running"</span>,</span><br><span class="line">            <span class="string">"Running"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="string">"Paused"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"Restarting"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"OOMKilled"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"Dead"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"Pid"</span>: 2648,</span><br><span class="line">            <span class="string">"ExitCode"</span>: 0,</span><br><span class="line">            <span class="string">"Error"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"StartedAt"</span>: <span class="string">"2017-04-08T06:22:29.555131293Z"</span>,</span><br><span class="line">            <span class="string">"FinishedAt"</span>: <span class="string">"0001-01-01T00:00:00Z"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"Image"</span>: <span class="string">"sha256:5766334bdaa0bc37f1f0c02cb94c351f9b076bcffa042d6ce811b0fd9bc31f3b"</span>,</span><br><span class="line">        <span class="string">"ResolvConfPath"</span>: <span class="string">"/var/lib/docker/containers/b9704931408c6d054bc9c510878e10467a71d412bef065afa7414403982001b6/resolv.conf"</span>,</span><br><span class="line">        <span class="string">"HostnamePath"</span>: <span class="string">"/var/lib/docker/containers/b9704931408c6d054bc9c510878e10467a71d412bef065afa7414403982001b6/hostname"</span>,</span><br><span class="line">        <span class="string">"HostsPath"</span>: <span class="string">"/var/lib/docker/containers/b9704931408c6d054bc9c510878e10467a71d412bef065afa7414403982001b6/hosts"</span>,</span><br><span class="line">        <span class="string">"LogPath"</span>: <span class="string">"/var/lib/docker/containers/b9704931408c6d054bc9c510878e10467a71d412bef065afa7414403982001b6/b9704931408c6d054bc9c510878e10467a71d412bef065afa7414403982001b6-json.log"</span>,</span><br><span class="line">        <span class="string">"Name"</span>: <span class="string">"/my-third-nginx"</span>,</span><br><span class="line">        <span class="string">"RestartCount"</span>: 0,</span><br><span class="line">        <span class="string">"Driver"</span>: <span class="string">"aufs"</span>,</span><br><span class="line">        <span class="string">"MountLabel"</span>: <span class="string">""</span>,</span><br><span class="line">        <span class="string">"ProcessLabel"</span>: <span class="string">""</span>,</span><br><span class="line">        <span class="string">"AppArmorProfile"</span>: <span class="string">"docker-default"</span>,</span><br><span class="line">        <span class="string">"ExecIDs"</span>: null,</span><br><span class="line">        <span class="string">"HostConfig"</span>: &#123;</span><br><span class="line">            <span class="string">"Binds"</span>: [</span><br><span class="line">                <span class="string">"/root/web:/usr/share/nginx/html:ro"</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="string">"ContainerIDFile"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"LogConfig"</span>: &#123;</span><br><span class="line">                <span class="string">"Type"</span>: <span class="string">"json-file"</span>,</span><br><span class="line">                <span class="string">"Config"</span>: &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">"NetworkMode"</span>: <span class="string">"default"</span>,</span><br><span class="line">            <span class="string">"PortBindings"</span>: &#123;</span><br><span class="line">                <span class="string">"443/tcp"</span>: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="string">"HostIp"</span>: <span class="string">""</span>,</span><br><span class="line">                        <span class="string">"HostPort"</span>: <span class="string">"443"</span></span><br><span class="line">                    &#125;</span><br><span class="line">                ],</span><br><span class="line">                <span class="string">"80/tcp"</span>: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="string">"HostIp"</span>: <span class="string">""</span>,</span><br><span class="line">                        <span class="string">"HostPort"</span>: <span class="string">"8080"</span></span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">"RestartPolicy"</span>: &#123;</span><br><span class="line">                <span class="string">"Name"</span>: <span class="string">"no"</span>,</span><br><span class="line">                <span class="string">"MaximumRetryCount"</span>: 0</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">"AutoRemove"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"VolumeDriver"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"VolumesFrom"</span>: null,</span><br><span class="line">            <span class="string">"CapAdd"</span>: null,</span><br><span class="line">            <span class="string">"CapDrop"</span>: null,</span><br><span class="line">            <span class="string">"Dns"</span>: [],</span><br><span class="line">            <span class="string">"DnsOptions"</span>: [],</span><br><span class="line">            <span class="string">"DnsSearch"</span>: [],</span><br><span class="line">            <span class="string">"ExtraHosts"</span>: null,</span><br><span class="line">            <span class="string">"GroupAdd"</span>: null,</span><br><span class="line">            <span class="string">"IpcMode"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"Cgroup"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"Links"</span>: null,</span><br><span class="line">            <span class="string">"OomScoreAdj"</span>: 0,</span><br><span class="line">            <span class="string">"PidMode"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"Privileged"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"PublishAllPorts"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"ReadonlyRootfs"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"SecurityOpt"</span>: null,</span><br><span class="line">            <span class="string">"UTSMode"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"UsernsMode"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"ShmSize"</span>: 67108864,</span><br><span class="line">            <span class="string">"Runtime"</span>: <span class="string">"runc"</span>,</span><br><span class="line">            <span class="string">"ConsoleSize"</span>: [</span><br><span class="line">                0,</span><br><span class="line">                0</span><br><span class="line">            ],</span><br><span class="line">            <span class="string">"Isolation"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"CpuShares"</span>: 0,</span><br><span class="line">            <span class="string">"Memory"</span>: 0,</span><br><span class="line">            <span class="string">"NanoCpus"</span>: 0,</span><br><span class="line">            <span class="string">"CgroupParent"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"BlkioWeight"</span>: 0,</span><br><span class="line">            <span class="string">"BlkioWeightDevice"</span>: null,</span><br><span class="line">            <span class="string">"BlkioDeviceReadBps"</span>: null,</span><br><span class="line">            <span class="string">"BlkioDeviceWriteBps"</span>: null,</span><br><span class="line">            <span class="string">"BlkioDeviceReadIOps"</span>: null,</span><br><span class="line">            <span class="string">"BlkioDeviceWriteIOps"</span>: null,</span><br><span class="line">            <span class="string">"CpuPeriod"</span>: 0,</span><br><span class="line">            <span class="string">"CpuQuota"</span>: 0,</span><br><span class="line">            <span class="string">"CpuRealtimePeriod"</span>: 0,</span><br><span class="line">            <span class="string">"CpuRealtimeRuntime"</span>: 0,</span><br><span class="line">            <span class="string">"CpusetCpus"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"CpusetMems"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"Devices"</span>: [],</span><br><span class="line">            <span class="string">"DeviceCgroupRules"</span>: null,</span><br><span class="line">            <span class="string">"DiskQuota"</span>: 0,</span><br><span class="line">            <span class="string">"KernelMemory"</span>: 0,</span><br><span class="line">            <span class="string">"MemoryReservation"</span>: 0,</span><br><span class="line">            <span class="string">"MemorySwap"</span>: 0,</span><br><span class="line">            <span class="string">"MemorySwappiness"</span>: -1,</span><br><span class="line">            <span class="string">"OomKillDisable"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"PidsLimit"</span>: 0,</span><br><span class="line">            <span class="string">"Ulimits"</span>: null,</span><br><span class="line">            <span class="string">"CpuCount"</span>: 0,</span><br><span class="line">            <span class="string">"CpuPercent"</span>: 0,</span><br><span class="line">            <span class="string">"IOMaximumIOps"</span>: 0,</span><br><span class="line">            <span class="string">"IOMaximumBandwidth"</span>: 0</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"GraphDriver"</span>: &#123;</span><br><span class="line">            <span class="string">"Data"</span>: null,</span><br><span class="line">            <span class="string">"Name"</span>: <span class="string">"aufs"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"Mounts"</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">"Type"</span>: <span class="string">"bind"</span>,</span><br><span class="line">                <span class="string">"Source"</span>: <span class="string">"/root/web"</span>,</span><br><span class="line">                <span class="string">"Destination"</span>: <span class="string">"/usr/share/nginx/html"</span>,</span><br><span class="line">                <span class="string">"Mode"</span>: <span class="string">"ro"</span>,</span><br><span class="line">                <span class="string">"RW"</span>: <span class="literal">false</span>,</span><br><span class="line">                <span class="string">"Propagation"</span>: <span class="string">""</span></span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="string">"Config"</span>: &#123;</span><br><span class="line">            <span class="string">"Hostname"</span>: <span class="string">"b9704931408c"</span>,</span><br><span class="line">            <span class="string">"Domainname"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"User"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"AttachStdin"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"AttachStdout"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"AttachStderr"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"ExposedPorts"</span>: &#123;</span><br><span class="line">                <span class="string">"443/tcp"</span>: &#123;&#125;,</span><br><span class="line">                <span class="string">"80/tcp"</span>: &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">"Tty"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"OpenStdin"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"StdinOnce"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"Env"</span>: [</span><br><span class="line">                <span class="string">"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"</span>,</span><br><span class="line">                <span class="string">"NGINX_VERSION=1.11.13-1~jessie"</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="string">"Cmd"</span>: [</span><br><span class="line">                <span class="string">"nginx"</span>,</span><br><span class="line">                <span class="string">"-g"</span>,</span><br><span class="line">                <span class="string">"daemon off;"</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="string">"ArgsEscaped"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="string">"Image"</span>: <span class="string">"nginx"</span>,</span><br><span class="line">            <span class="string">"Volumes"</span>: null,</span><br><span class="line">            <span class="string">"WorkingDir"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"Entrypoint"</span>: null,</span><br><span class="line">            <span class="string">"OnBuild"</span>: null,</span><br><span class="line">            <span class="string">"Labels"</span>: &#123;&#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"NetworkSettings"</span>: &#123;</span><br><span class="line">            <span class="string">"Bridge"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"SandboxID"</span>: <span class="string">"916a8bef0178b4e8e2ff1c246a9e04c85686b8ddf8493946de7103577ff8158b"</span>,</span><br><span class="line">            <span class="string">"HairpinMode"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"LinkLocalIPv6Address"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"LinkLocalIPv6PrefixLen"</span>: 0,</span><br><span class="line">            <span class="string">"Ports"</span>: &#123;</span><br><span class="line">                <span class="string">"443/tcp"</span>: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="string">"HostIp"</span>: <span class="string">"0.0.0.0"</span>,</span><br><span class="line">                        <span class="string">"HostPort"</span>: <span class="string">"443"</span></span><br><span class="line">                    &#125;</span><br><span class="line">                ],</span><br><span class="line">                <span class="string">"80/tcp"</span>: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="string">"HostIp"</span>: <span class="string">"0.0.0.0"</span>,</span><br><span class="line">                        <span class="string">"HostPort"</span>: <span class="string">"8080"</span></span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">"SandboxKey"</span>: <span class="string">"/var/run/docker/netns/916a8bef0178"</span>,</span><br><span class="line">            <span class="string">"SecondaryIPAddresses"</span>: null,</span><br><span class="line">            <span class="string">"SecondaryIPv6Addresses"</span>: null,</span><br><span class="line">            <span class="string">"EndpointID"</span>: <span class="string">"7a9c71aae5980ccd513c1e7a4e8cefaf56a87e1d796669bbfb70ffc728d1e0bb"</span>,</span><br><span class="line">            <span class="string">"Gateway"</span>: <span class="string">"172.17.0.1"</span>,</span><br><span class="line">            <span class="string">"GlobalIPv6Address"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"GlobalIPv6PrefixLen"</span>: 0,</span><br><span class="line">            <span class="string">"IPAddress"</span>: <span class="string">"172.17.0.4"</span>,</span><br><span class="line">            <span class="string">"IPPrefixLen"</span>: 16,</span><br><span class="line">            <span class="string">"IPv6Gateway"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"MacAddress"</span>: <span class="string">"02:42:ac:11:00:04"</span>,</span><br><span class="line">            <span class="string">"Networks"</span>: &#123;</span><br><span class="line">                <span class="string">"bridge"</span>: &#123;</span><br><span class="line">                    <span class="string">"IPAMConfig"</span>: null,</span><br><span class="line">                    <span class="string">"Links"</span>: null,</span><br><span class="line">                    <span class="string">"Aliases"</span>: null,</span><br><span class="line">                    <span class="string">"NetworkID"</span>: <span class="string">"26d72edf89c3ae77e1de636d4357b819a12c24ae64ab0da4d9b2d43610c44f24"</span>,</span><br><span class="line">                    <span class="string">"EndpointID"</span>: <span class="string">"7a9c71aae5980ccd513c1e7a4e8cefaf56a87e1d796669bbfb70ffc728d1e0bb"</span>,</span><br><span class="line">                    <span class="string">"Gateway"</span>: <span class="string">"172.17.0.1"</span>,</span><br><span class="line">                    <span class="string">"IPAddress"</span>: <span class="string">"172.17.0.4"</span>,</span><br><span class="line">                    <span class="string">"IPPrefixLen"</span>: 16,</span><br><span class="line">                    <span class="string">"IPv6Gateway"</span>: <span class="string">""</span>,</span><br><span class="line">                    <span class="string">"GlobalIPv6Address"</span>: <span class="string">""</span>,</span><br><span class="line">                    <span class="string">"GlobalIPv6PrefixLen"</span>: 0,</span><br><span class="line">                    <span class="string">"MacAddress"</span>: <span class="string">"02:42:ac:11:00:04"</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h2 id="ls-ps-list"><a href="#ls-ps-list" class="headerlink" title="ls/ps/list"></a>ls/ps/list</h2><p>æŸ¥çœ‹ container åˆ—è¡¨</p>
<ul>
<li>docker ps</li>
<li>docker container ls</li>
<li>docker container list</li>
</ul>
<p>ä»¥ä¸Šä¸‰æ¡å‘½ä»¤çš„ç”¨æ³•å’Œä½œç”¨éƒ½æ˜¯ä¸€æ ·çš„, ä¹‹é—´åšäº†åˆ«å</p>
<p>æœ€å®ç”¨çš„å‚æ•°<code>-s</code> å¯ä»¥æ˜¾ç¤ºå‡ºå®¹å™¨å ç”¨ç©ºé—´å¤§å°, æ‹¬å·ä¸­çš„æ˜¯é•œåƒå¤§å°, å‰é¢æ˜¯å¯å†™å±‚(å®¹å™¨)å¤§å°</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker container list -s</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                        NAMES               SIZE</span><br><span class="line">b4e6f8620ba3        nginx2:0.1          <span class="string">"nginx -g 'daemon ..."</span>   29 minutes ago      Up 29 minutes       80/tcp, 443/tcp                              new-first-nginx     413B (virtual 204MB)</span><br><span class="line">b9704931408c        nginx               <span class="string">"nginx -g 'daemon ..."</span>   2 hours ago         Up 2 hours          0.0.0.0:443-&gt;443/tcp, 0.0.0.0:8080-&gt;80/tcp   my-third-nginx      7B (virtual 183MB)</span><br><span class="line">d0a4936e940e        nginx               <span class="string">"nginx -g 'daemon ..."</span>   2 hours ago         Up 2 hours          443/tcp, 0.0.0.0:8800-&gt;80/tcp                my-second-nginx     2B (virtual 183MB)</span><br><span class="line">11610baab1ce        nginx               <span class="string">"nginx -g 'daemon ..."</span>   2 hours ago         Up About an hour    80/tcp, 443/tcp                              my-first-nginx      21.3MB (virtual 204MB)</span><br><span class="line">root@ubuntu:~<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<h2 id="logs"><a href="#logs" class="headerlink" title="logs"></a>logs</h2><p>æŸ¥çœ‹å®¹å™¨çš„å‰å°å›æ˜¾æ—¥å¿—. ç”±äºå®¹å™¨å¿…é¡»ä»¥é˜»å¡å‰å°çš„æ–¹å¼è¿è¡Œ, é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ logs å‘½ä»¤æ¥æŸ¥çœ‹å®¹å™¨å‰å°çš„å›æ˜¾(åœ¨é»˜è®¤æ˜¯ json-file æ—¥å¿—å¼•æ“ä¸‹)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker run -d centos ping 123.57.233.243</span></span><br><span class="line">791a4ad7ffa83f81a78e2bba1a5d5366a099be443beb19f66ee0d51e83cd020d</span><br><span class="line">root@ubuntu:~<span class="comment"># </span></span><br><span class="line">root@ubuntu:~<span class="comment"># </span></span><br><span class="line">root@ubuntu:~<span class="comment"># docker logs -f 791a4ad7ffa8</span></span><br><span class="line">PING 123.57.233.243 (123.57.233.243) 56(84) bytes of data.</span><br><span class="line">64 bytes from 123.57.233.243: icmp_seq=1 ttl=127 time=7.89 ms</span><br><span class="line">64 bytes from 123.57.233.243: icmp_seq=2 ttl=127 time=6.66 ms</span><br><span class="line">64 bytes from 123.57.233.243: icmp_seq=3 ttl=127 time=6.55 ms</span><br><span class="line">64 bytes from 123.57.233.243: icmp_seq=4 ttl=127 time=6.46 ms</span><br><span class="line">64 bytes from 123.57.233.243: icmp_seq=5 ttl=127 time=175 ms</span><br><span class="line">64 bytes from 123.57.233.243: icmp_seq=6 ttl=127 time=267 ms</span><br></pre></td></tr></table></figure>

<h2 id="kill-start-stop-restart-rm-pause-unpause-prune"><a href="#kill-start-stop-restart-rm-pause-unpause-prune" class="headerlink" title="kill/start/stop/restart/rm/pause/unpause/prune"></a>kill/start/stop/restart/rm/pause/unpause/prune</h2><ul>
<li>kill ç»™å®¹å™¨å‘é€ kill ä¿¡å·, éæ­£å¸¸é€€å‡ºå®¹å™¨</li>
<li>start å¯åŠ¨é€€å‡ºçŠ¶æ€çš„å®¹å™¨</li>
<li>stop é€€å‡ºè¿è¡ŒçŠ¶æ€çš„å®¹å™¨</li>
<li>restart é‡å¯å®¹å™¨</li>
<li>rm åˆ é™¤é€€å‡ºçŠ¶æ€çš„å®¹å™¨</li>
<li>pause æš‚åœè¿è¡Œä¸­çš„å®¹å™¨(å¤„äºé˜»å¡çŠ¶æ€)</li>
<li>unpause æ¢å¤æš‚åœçš„å®¹å™¨è‡³è¿è¡ŒçŠ¶æ€</li>
<li>prune åˆ é™¤æ‰€æœ‰ stopped çŠ¶æ€çš„å®¹å™¨(1.13çš„æ–°ç‰¹æ€§, æ•‘ä¸–ä¸»!)</li>
</ul>
<h2 id="port"><a href="#port" class="headerlink" title="port"></a>port</h2><p>æŸ¥çœ‹ç«¯å£çš„æ˜ å°„å…³ç³»</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker container port my-third-nginx</span></span><br><span class="line">443/tcp -&gt; 0.0.0.0:443</span><br><span class="line">80/tcp -&gt; 0.0.0.0:8080</span><br><span class="line">root@ubuntu:~<span class="comment"># docker container port my-second-nginx</span></span><br><span class="line">80/tcp -&gt; 0.0.0.0:8800</span><br><span class="line">root@ubuntu:~<span class="comment"># docker container port my-first-nginx</span></span><br><span class="line">root@ubuntu:~<span class="comment"># docker container port my-second-nginx 80/tcp</span></span><br><span class="line">0.0.0.0:8800</span><br></pre></td></tr></table></figure>

<h2 id="rename"><a href="#rename" class="headerlink" title="rename"></a>rename</h2><p>æ›´æ”¹å®¹å™¨åç§°</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                        NAMES</span><br><span class="line">b4e6f8620ba3        nginx2:0.1          <span class="string">"nginx -g 'daemon ..."</span>   About an hour ago   Up About an hour    80/tcp, 443/tcp                              new-first-nginx</span><br><span class="line">b9704931408c        nginx               <span class="string">"nginx -g 'daemon ..."</span>   2 hours ago         Up 2 hours          0.0.0.0:443-&gt;443/tcp, 0.0.0.0:8080-&gt;80/tcp   my-third-nginx</span><br><span class="line">d0a4936e940e        nginx               <span class="string">"nginx -g 'daemon ..."</span>   2 hours ago         Up 2 hours          443/tcp, 0.0.0.0:8800-&gt;80/tcp                my-second-nginx</span><br><span class="line">11610baab1ce        nginx               <span class="string">"nginx -g 'daemon ..."</span>   2 hours ago         Up About an hour    80/tcp, 443/tcp                              my-first-nginx</span><br><span class="line">root@ubuntu:~<span class="comment"># docker container rename --help</span></span><br><span class="line"></span><br><span class="line">Usage:	docker container rename CONTAINER NEW_NAME</span><br><span class="line"></span><br><span class="line">Rename a container</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">      --<span class="built_in">help</span>   Print usage</span><br><span class="line">root@ubuntu:~<span class="comment"># docker container rename new-first-nginx new-first-nginx2</span></span><br><span class="line">root@ubuntu:~<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                        NAMES</span><br><span class="line">b4e6f8620ba3        nginx2:0.1          <span class="string">"nginx -g 'daemon ..."</span>   About an hour ago   Up About an hour    80/tcp, 443/tcp                              new-first-nginx2</span><br><span class="line">b9704931408c        nginx               <span class="string">"nginx -g 'daemon ..."</span>   2 hours ago         Up 2 hours          0.0.0.0:443-&gt;443/tcp, 0.0.0.0:8080-&gt;80/tcp   my-third-nginx</span><br><span class="line">d0a4936e940e        nginx               <span class="string">"nginx -g 'daemon ..."</span>   2 hours ago         Up 2 hours          443/tcp, 0.0.0.0:8800-&gt;80/tcp                my-second-nginx</span><br><span class="line">11610baab1ce        nginx               <span class="string">"nginx -g 'daemon ..."</span>   2 hours ago         Up About an hour    80/tcp, 443/tcp                              my-first-nginx</span><br><span class="line">root@ubuntu:~<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<h2 id="stats"><a href="#stats" class="headerlink" title="stats"></a>stats</h2><p>å®æ—¶æŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨çŠ¶å†µ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker container stats </span></span><br><span class="line">CONTAINER           CPU %               MEM USAGE / LIMIT     MEM %               NET I/O             BLOCK I/O           PIDS</span><br><span class="line">b4e6f8620ba3        0.00%               1.457MiB / 975.1MiB   0.15%               690B / 0B           0B / 4.1kB          2</span><br><span class="line">b9704931408c        0.00%               1.449MiB / 975.1MiB   0.15%               732B / 0B           0B / 0B             2</span><br><span class="line">d0a4936e940e        0.00%               1.512MiB / 975.1MiB   0.16%               1.36kB / 671B       0B / 0B             2</span><br><span class="line">11610baab1ce        0.00%               1.465MiB / 975.1MiB   0.15%               732B / 0B           0B / 0B             2</span><br></pre></td></tr></table></figure>

<h2 id="top"><a href="#top" class="headerlink" title="top"></a>top</h2><p>æŸ¥çœ‹å®¹å™¨çš„è¿›ç¨‹ä¿¡æ¯</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker container top --help</span></span><br><span class="line"></span><br><span class="line">Usage:	docker container top CONTAINER [ps OPTIONS]</span><br><span class="line"></span><br><span class="line">Display the running processes of a container</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">      --<span class="built_in">help</span>   Print usage</span><br><span class="line">root@ubuntu:~<span class="comment"># docker container top my-third-nginx</span></span><br><span class="line">UID                 PID                 PPID                C                   STIME               TTY                 TIME                CMD</span><br><span class="line">root                2648                2631                0                   Apr07               ?                   00:00:00            nginx: master process nginx -g daemon off;</span><br><span class="line">syslog              2669                2648                0                   Apr07               ?                   00:00:00            nginx: worker process</span><br></pre></td></tr></table></figure>

<h2 id="update"><a href="#update" class="headerlink" title="update"></a>update</h2><p>è°ƒæ•´åˆ†é…ç»™å®¹å™¨çš„è®¡ç®—èµ„æº, å¯ä»¥æ›´æ”¹è¯¥å®¹å™¨å¯ä»¥ä½¿ç”¨çš„ CPU è®¡ç®—èµ„æºä¸å†…å­˜èµ„æºç­‰</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker container update --help</span></span><br><span class="line"></span><br><span class="line">Usage:	docker container update [OPTIONS] CONTAINER [CONTAINER...]</span><br><span class="line"></span><br><span class="line">Update configuration of one or more containers</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">      --blkio-weight uint16        Block IO (relative weight), between 10 and 1000, or 0 to <span class="built_in">disable</span> (default 0)</span><br><span class="line">      --cpu-period int             Limit CPU CFS (Completely Fair Scheduler) period</span><br><span class="line">      --cpu-quota int              Limit CPU CFS (Completely Fair Scheduler) quota</span><br><span class="line">      --cpu-rt-period int          Limit the CPU real-time period <span class="keyword">in</span> microseconds</span><br><span class="line">      --cpu-rt-runtime int         Limit the CPU real-time runtime <span class="keyword">in</span> microseconds</span><br><span class="line">  -c, --cpu-shares int             CPU shares (relative weight)</span><br><span class="line">      --cpuset-cpus string         CPUs <span class="keyword">in</span> <span class="built_in">which</span> to allow execution (0-3, 0,1)</span><br><span class="line">      --cpuset-mems string         MEMs <span class="keyword">in</span> <span class="built_in">which</span> to allow execution (0-3, 0,1)</span><br><span class="line">      --<span class="built_in">help</span>                       Print usage</span><br><span class="line">      --kernel-memory bytes        Kernel memory <span class="built_in">limit</span></span><br><span class="line">  -m, --memory bytes               Memory <span class="built_in">limit</span></span><br><span class="line">      --memory-reservation bytes   Memory soft <span class="built_in">limit</span></span><br><span class="line">      --memory-swap bytes          Swap <span class="built_in">limit</span> equal to memory plus swap: <span class="string">'-1'</span> to <span class="built_in">enable</span> unlimited swap</span><br><span class="line">      --restart string             Restart policy to apply when a container exits</span><br></pre></td></tr></table></figure>

<h2 id="wait"><a href="#wait" class="headerlink" title="wait"></a>wait</h2><p>é˜»å¡å®¹å™¨çš„è¿è¡Œç›´åˆ°åœæ­¢ä¸ºæ­¢, ç„¶åæ‰“å°è¯¥å®¹å™¨çš„é€€å‡ºçŠ¶æ€ç </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç»ˆç«¯1</span></span><br><span class="line">root@ubuntu:~<span class="comment"># docker container wait new-first-nginx2</span></span><br><span class="line"><span class="comment"># ç»ˆç«¯è¢«é˜»å¡</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»ˆç«¯2</span></span><br><span class="line">root@ubuntu:~<span class="comment"># docker container stop new-first-nginx2</span></span><br><span class="line">new-first-nginx2</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»ˆç«¯1</span></span><br><span class="line">root@ubuntu:~<span class="comment"># docker container wait new-first-nginx2</span></span><br><span class="line">0</span><br></pre></td></tr></table></figure>

<h2 id="run"><a href="#run" class="headerlink" title="run"></a>run</h2><p>è¿è¡Œä¸€ä¸ªå®¹å™¨, è¿™ä¸ªå‘½ä»¤çš„å‚æ•°éå¸¸å¤š, å¯ä»¥å®šåˆ¶çš„å±æ€§ä¹Ÿéå¸¸å¤š, å¸¸ç”¨å‚æ•°å¦‚ä¸‹</p>
<ul>
<li><code>-e</code>: è®¾ç½®ç¯å¢ƒå˜é‡</li>
<li><code>-h</code>: è®¾ç½® hostname</li>
<li><code>-i</code>: å¼€æ”¾æ ‡å‡†è¾“å…¥</li>
<li><code>-t</code>: åˆ†é…ä¼ªç»ˆç«¯</li>
<li><code>-l</code>: æ‰“æ ‡ç­¾</li>
<li><code>-p</code>: æŒ‡å®šæ˜ å°„å‡ºæ¥çš„ç«¯å£(å¯éšæœºåˆ†é…, å¯ä»¥æŒ‡å®š)</li>
<li><code>-P</code>: æ˜ å°„å®¹å™¨å†…æ‰€æœ‰å¼€æ”¾çš„ç«¯å£(ç«¯å£å·éšæœºåˆ†é…)</li>
<li><code>-v</code>: æ•°æ®å·çš„æŒ‚è½½</li>
<li><code>--volumes-driver</code>: æŒ‡å®šå­˜å‚¨å¼•æ“</li>
<li><code>-w</code>: å®¹å™¨è¿è¡Œçš„å·¥ä½œç›®å½•</li>
<li><code>--restart</code>: é»˜è®¤ä¸º no, å®¹å™¨å¼‚å¸¸é€€å‡ºåç¦æ­¢è‡ªåŠ¨é‡å¯<ul>
<li>è®¾ç½®ä¸º <code>--restart=on-failure:10</code> , æ„å‘³å¯¹è¯¥å®¹å™¨çš„é0é€€å‡ºçŠ¶æ€è¿›è¡Œé‡å¯, æœ€å¤šé‡å¯10æ¬¡</li>
<li>è®¾ç½®ä¸º <code>--restart=always</code> å§‹ç»ˆé‡å¯</li>
</ul>
</li>
<li><code>--network</code>: æŒ‡å®šç½‘ç»œç±»å‹</li>
<li><code>--name</code>: æŒ‡å®šå®¹å™¨åç§°</li>
<li><code>--log-driver</code>: æŒ‡å®šæ—¥å¿—å¼•æ“</li>
<li><code>--link</code>: ç½‘ç»œå±‚è¿é€šæŒ‡å®šå®¹å™¨</li>
<li><code>--dns</code>: æŒ‡å®šå®¹å™¨å†…ä½¿ç”¨çš„ DNS æœåŠ¡å™¨</li>
<li><code>--privileged</code>: ææƒ,åœ¨å®¹å™¨å†…è·å–æ‰©å±•çš„æ‰§è¡Œæƒé™</li>
<li><code>--add-host</code>: hosts é…ç½®. ä¾‹å¦‚: <code>--add-host polarsnow:123.57.233.243</code></li>
</ul>

      
    </div>

    
    
    
      

      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://docs.lvrui.io/2017/04/16/docker-container%E5%AE%B9%E5%99%A8%E7%AE%A1%E7%90%86%203/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.JPG">
      <meta itemprop="name" content="æåœ°ç‘é›ª">
      <meta itemprop="description" content="æåœ°ç‘é›ªçš„ä¸ªäººæŠ€æœ¯åšå®¢. "å–ä¹‹å¼€æº ç”¨ä¹‹å¼€æº", åˆ†äº«è‡ªå·±çš„ç»éªŒä¹‹è°ˆ".">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Polar Snow Documentation">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/04/16/docker-container%E5%AE%B9%E5%99%A8%E7%AE%A1%E7%90%86%203/" class="post-title-link" itemprop="url">docker container å®¹å™¨ç®¡ç†</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2017-04-16 16:49:22" itemprop="dateCreated datePublished" datetime="2017-04-16T16:49:22+08:00">2017-04-16</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Docker/" itemprop="url" rel="index"><span itemprop="name">Docker</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqusï¼š</span>
    
    <a title="disqus" href="/2017/04/16/docker-container%E5%AE%B9%E5%99%A8%E7%AE%A1%E7%90%86%203/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/04/16/docker-containerå®¹å™¨ç®¡ç† 3/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<ul>
<li>Docker ç®¡ç†å‘½ä»¤<ul>
<li><strong>å®¹å™¨ç®¡ç†</strong></li>
<li>é•œåƒç®¡ç†</li>
<li>ç½‘ç»œç®¡ç†</li>
<li>ç³»ç»Ÿç®¡ç†</li>
<li>æ•°æ®å·ç®¡ç†</li>
<li>å¿«ç…§ç®¡ç†</li>
<li>æ’ä»¶ç®¡ç†</li>
<li>å…¶ä»–</li>
<li>swarmkit ç®¡ç†<ul>
<li>æ¨¡å¼ç®¡ç†</li>
<li>èŠ‚ç‚¹ç®¡ç†</li>
<li>ç§˜é’¥ç®¡ç†</li>
<li>æœåŠ¡ç®¡ç†</li>
<li>æœåŠ¡æ ˆç®¡ç†</li>
</ul>
</li>
</ul>
</li>
</ul>
</blockquote>
<p>Docker çš„æ¯ä¸€çº§å‘½ä»¤éƒ½å¯ä»¥ä½¿ç”¨<code>--help</code> çš„å‚æ•°æ¥æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯</p>
<h1 id="Docker-ä¸€çº§å‘½ä»¤"><a href="#Docker-ä¸€çº§å‘½ä»¤" class="headerlink" title="Docker ä¸€çº§å‘½ä»¤"></a>Docker ä¸€çº§å‘½ä»¤</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker --help</span></span><br><span class="line"></span><br><span class="line">Usage:	docker COMMAND</span><br><span class="line"></span><br><span class="line">A self-sufficient runtime <span class="keyword">for</span> containers</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">      --config string      Location of client config files (default <span class="string">"/root/.docker"</span>)</span><br><span class="line">  -D, --debug              Enable debug mode</span><br><span class="line">      --<span class="built_in">help</span>               Print usage</span><br><span class="line">  -H, --host list          Daemon socket(s) to connect to (default [])</span><br><span class="line">  -l, --<span class="built_in">log</span>-level string   Set the logging level (<span class="string">"debug"</span>|<span class="string">"info"</span>|<span class="string">"warn"</span>|<span class="string">"error"</span>|<span class="string">"fatal"</span>) (default <span class="string">"info"</span>)</span><br><span class="line">      --tls                Use TLS; implied by --tlsverify</span><br><span class="line">      --tlscacert string   Trust certs signed only by this CA (default <span class="string">"/root/.docker/ca.pem"</span>)</span><br><span class="line">      --tlscert string     Path to TLS certificate file (default <span class="string">"/root/.docker/cert.pem"</span>)</span><br><span class="line">      --tlskey string      Path to TLS key file (default <span class="string">"/root/.docker/key.pem"</span>)</span><br><span class="line">      --tlsverify          Use TLS and verify the remote</span><br><span class="line">  -v, --version            Print version information and quit</span><br><span class="line"></span><br><span class="line">Management Commands:</span><br><span class="line">  container   Manage containers</span><br><span class="line">  image       Manage images</span><br><span class="line">  network     Manage networks</span><br><span class="line">  node        Manage Swarm nodes</span><br><span class="line">  plugin      Manage plugins</span><br><span class="line">  secret      Manage Docker secrets</span><br><span class="line">  service     Manage services</span><br><span class="line">  stack       Manage Docker stacks</span><br><span class="line">  swarm       Manage Swarm</span><br><span class="line">  system      Manage Docker</span><br><span class="line">  volume      Manage volumes</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line">  attach      Attach to a running container</span><br><span class="line">  build       Build an image from a Dockerfile</span><br><span class="line">  commit      Create a new image from a container<span class="string">'s changes</span></span><br><span class="line"><span class="string">  cp          Copy files/folders between a container and the local filesystem</span></span><br><span class="line"><span class="string">  create      Create a new container</span></span><br><span class="line"><span class="string">  diff        Inspect changes to files or directories on a container'</span>s filesystem</span><br><span class="line">  events      Get real time events from the server</span><br><span class="line">  <span class="built_in">exec</span>        Run a <span class="built_in">command</span> <span class="keyword">in</span> a running container</span><br><span class="line">  <span class="built_in">export</span>      Export a container<span class="string">'s filesystem as a tar archive</span></span><br><span class="line"><span class="string">  history     Show the history of an image</span></span><br><span class="line"><span class="string">  images      List images</span></span><br><span class="line"><span class="string">  import      Import the contents from a tarball to create a filesystem image</span></span><br><span class="line"><span class="string">  info        Display system-wide information</span></span><br><span class="line"><span class="string">  inspect     Return low-level information on Docker objects</span></span><br><span class="line"><span class="string">  kill        Kill one or more running containers</span></span><br><span class="line"><span class="string">  load        Load an image from a tar archive or STDIN</span></span><br><span class="line"><span class="string">  login       Log in to a Docker registry</span></span><br><span class="line"><span class="string">  logout      Log out from a Docker registry</span></span><br><span class="line"><span class="string">  logs        Fetch the logs of a container</span></span><br><span class="line"><span class="string">  pause       Pause all processes within one or more containers</span></span><br><span class="line"><span class="string">  port        List port mappings or a specific mapping for the container</span></span><br><span class="line"><span class="string">  ps          List containers</span></span><br><span class="line"><span class="string">  pull        Pull an image or a repository from a registry</span></span><br><span class="line"><span class="string">  push        Push an image or a repository to a registry</span></span><br><span class="line"><span class="string">  rename      Rename a container</span></span><br><span class="line"><span class="string">  restart     Restart one or more containers</span></span><br><span class="line"><span class="string">  rm          Remove one or more containers</span></span><br><span class="line"><span class="string">  rmi         Remove one or more images</span></span><br><span class="line"><span class="string">  run         Run a command in a new container</span></span><br><span class="line"><span class="string">  save        Save one or more images to a tar archive (streamed to STDOUT by default)</span></span><br><span class="line"><span class="string">  search      Search the Docker Hub for images</span></span><br><span class="line"><span class="string">  start       Start one or more stopped containers</span></span><br><span class="line"><span class="string">  stats       Display a live stream of container(s) resource usage statistics</span></span><br><span class="line"><span class="string">  stop        Stop one or more running containers</span></span><br><span class="line"><span class="string">  tag         Create a tag TARGET_IMAGE that refers to SOURCE_IMAGE</span></span><br><span class="line"><span class="string">  top         Display the running processes of a container</span></span><br><span class="line"><span class="string">  unpause     Unpause all processes within one or more containers</span></span><br><span class="line"><span class="string">  update      Update configuration of one or more containers</span></span><br><span class="line"><span class="string">  version     Show the Docker version information</span></span><br><span class="line"><span class="string">  wait        Block until one or more containers stop, then print their exit codes</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Run '</span>docker COMMAND --<span class="built_in">help</span><span class="string">' for more information on a command.</span></span><br></pre></td></tr></table></figure>

<p>åœ¨ Docker1.13ç‰ˆæœ¬ä¹‹å‰, æ˜¯æ²¡æœ‰äºŒçº§ç®¡ç†å‘½ä»¤çš„, éšç€ Docker çš„åŠŸèƒ½è¶Šæ¥è¶Šå¤š, å‘½ä»¤å‚æ•°ä¹Ÿè¶Šæ¥è¶Šå¤š, åˆ°1.13ç‰ˆæœ¬å, Docker ç»ˆäºå¯¹ä»–ä»¬åšå‡ºäº†å½’ç±», ä¹‹å‰çš„è¯­æ³•ä¹Ÿå…¼å®¹, ä½†æ˜¯ Docker æ¨èä½¿ç”¨æœ€æ–°çš„è¯­æ³•æ ¼å¼.</p>
<p>1.13ç‰ˆæœ¬å, Docker å¯¹å‘½ä»¤åšå‡ºäº†å¦‚ä¸‹å½’ç±»:</p>
<ul>
<li>container   Manage containers</li>
<li>image       Manage images</li>
<li>network     Manage networks</li>
<li>node        Manage Swarm nodes</li>
<li>plugin      Manage plugins</li>
<li>secret      Manage Docker secrets</li>
<li>service     Manage services</li>
<li>stack       Manage Docker stacks</li>
<li>swarm       Manage Swarm</li>
<li>system      Manage Docker</li>
<li>volume      Manage volumes</li>
</ul>
<h1 id="å®¹å™¨ç®¡ç†-container"><a href="#å®¹å™¨ç®¡ç†-container" class="headerlink" title="å®¹å™¨ç®¡ç† container"></a>å®¹å™¨ç®¡ç† container</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker container --help</span></span><br><span class="line"></span><br><span class="line">Usage:	docker container COMMAND</span><br><span class="line"></span><br><span class="line">Manage containers</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">      --<span class="built_in">help</span>   Print usage</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line">  attach      Attach to a running container</span><br><span class="line">  commit      Create a new image from a container<span class="string">'s changes</span></span><br><span class="line"><span class="string">  cp          Copy files/folders between a container and the local filesystem</span></span><br><span class="line"><span class="string">  create      Create a new container</span></span><br><span class="line"><span class="string">  diff        Inspect changes to files or directories on a container'</span>s filesystem</span><br><span class="line">  <span class="built_in">exec</span>        Run a <span class="built_in">command</span> <span class="keyword">in</span> a running container</span><br><span class="line">  <span class="built_in">export</span>      Export a container<span class="string">'s filesystem as a tar archive</span></span><br><span class="line"><span class="string">  inspect     Display detailed information on one or more containers</span></span><br><span class="line"><span class="string">  kill        Kill one or more running containers</span></span><br><span class="line"><span class="string">  logs        Fetch the logs of a container</span></span><br><span class="line"><span class="string">  ls          List containers</span></span><br><span class="line"><span class="string">  pause       Pause all processes within one or more containers</span></span><br><span class="line"><span class="string">  port        List port mappings or a specific mapping for the container</span></span><br><span class="line"><span class="string">  prune       Remove all stopped containers</span></span><br><span class="line"><span class="string">  rename      Rename a container</span></span><br><span class="line"><span class="string">  restart     Restart one or more containers</span></span><br><span class="line"><span class="string">  rm          Remove one or more containers</span></span><br><span class="line"><span class="string">  run         Run a command in a new container</span></span><br><span class="line"><span class="string">  start       Start one or more stopped containers</span></span><br><span class="line"><span class="string">  stats       Display a live stream of container(s) resource usage statistics</span></span><br><span class="line"><span class="string">  stop        Stop one or more running containers</span></span><br><span class="line"><span class="string">  top         Display the running processes of a container</span></span><br><span class="line"><span class="string">  unpause     Unpause all processes within one or more containers</span></span><br><span class="line"><span class="string">  update      Update configuration of one or more containers</span></span><br><span class="line"><span class="string">  wait        Block until one or more containers stop, then print their exit codes</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Run '</span>docker container COMMAND --<span class="built_in">help</span><span class="string">' for more information on a command.</span></span><br></pre></td></tr></table></figure>



<h2 id="attach"><a href="#attach" class="headerlink" title="attach"></a>attach</h2><p>è¿›å…¥å®¹å™¨çš„æ–¹å¼ä¹‹ä¸€, ç¿»è¯‘è¿‡æ¥å«â€é™„ç€â€åˆ°è¿è¡Œçš„å®¹å™¨ä¸­. ä»–ä¸<code>exec</code> æœ‰æœ¬è´¨çš„åŒºåˆ«, exec è¿›å…¥å®¹å™¨æ˜¯åœ¨ä¸»è¿›ç¨‹çš„åŸºç¡€ä¹‹ä¸Š, å†å¼€é€šä¸€ä¸ªè¿›ç¨‹å®ç°çš„è¿›å…¥å®¹å™¨. è€Œ attach åˆ™æ„å‘³ç€è¿›å…¥åˆ°å®¹å™¨çš„ä¸»è¿›ç¨‹ä¸­. äº§ç”Ÿçš„åæœä¹Ÿä¸ä¸€æ ·, ç”±äº attach è¿›å…¥åˆ°äº†ä¸»è¿›ç¨‹, ä¸€æ—¦ Ctrl+C é€€å‡ºç»ˆç«¯, å°†å¯¼è‡´ä¸»è¿›ç¨‹é€€å‡º, ä»è€Œå®¹å™¨ä¹Ÿéšä¹‹é€€å‡º. è€Œ exec çš„æ–¹å¼è¿›å…¥å®¹å™¨æ˜¯å•ç‹¬å¼€å¯äº†ä¸€ä¸ªè¿›ç¨‹, è¯¥è¿›ç¨‹çš„äº§ç”Ÿäºé”€æ¯å¹¶ä¸å½±å“ä¸»è¿›ç¨‹, æ‰€ä»¥ä¸ä¼šå› ä¸ºç»ˆç«¯çš„é€€å‡ºè€Œå¯¼è‡´å®¹å™¨é€€å‡º.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker run -d centos ping 123.57.233.243</span></span><br><span class="line">2ad157c779469961faabec0e836f7d2ab03a7e6193d932647e83626231fa0560</span><br><span class="line">root@ubuntu:~<span class="comment"># </span></span><br><span class="line">root@ubuntu:~<span class="comment"># docker container attach 2ad</span></span><br><span class="line">64 bytes from 123.57.233.243: icmp_seq=40 ttl=127 time=8.05 ms</span><br><span class="line">64 bytes from 123.57.233.243: icmp_seq=41 ttl=127 time=7.46 ms</span><br><span class="line">64 bytes from 123.57.233.243: icmp_seq=42 ttl=127 time=8.86 ms</span><br><span class="line">64 bytes from 123.57.233.243: icmp_seq=43 ttl=127 time=9.80 ms</span><br><span class="line">64 bytes from 123.57.233.243: icmp_seq=44 ttl=127 time=6.24 ms</span><br><span class="line">64 bytes from 123.57.233.243: icmp_seq=45 ttl=127 time=6.01 ms</span><br><span class="line">^C</span><br><span class="line">--- 123.57.233.243 ping statistics ---</span><br><span class="line">62 packets transmitted, 62 received, 0% packet loss, time 61130ms</span><br><span class="line">rtt min/avg/max/mdev = 5.407/18.181/204.154/32.140 ms</span><br><span class="line">root@ubuntu:~<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<h2 id="exec"><a href="#exec" class="headerlink" title="exec"></a>exec</h2><p>åœ¨ä¸€ä¸ªè¿è¡Œä¸­çš„å®¹å™¨å†…æ‰§è¡Œå‘½ä»¤. å°±å¦‚ä¸Šé¢æ‰€è¯´, ä½¿ç”¨ exec æ‰§è¡Œå‘½ä»¤æ„å‘³ç€åœ¨ä¸»è¿›ç¨‹çš„åŸºç¡€ä¹‹ä¸Š, å†å¯åŠ¨å…¶ä»–çš„è¿›ç¨‹, å…¶ä»–è¿›ç¨‹çš„å¯åŠ¨ä¸é”€æ¯ä¸ä¼šç›´æ¥å½±å“å®¹å™¨çš„é€€å‡º.</p>
<p>exec çš„ç”¨æ³•å¾ˆå¤š, ä½¿ç”¨é¢‘ç‡æœ€é«˜çš„æ˜¯è¿›å…¥å®¹å™¨çš„æ“ä½œ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker container exec -it b9704931408c /bin/bash</span></span><br><span class="line">root@b9704931408c:/<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>ä¹Ÿå¯ä»¥è¿è¡Œä»»ä½•bashå‘½ä»¤</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker container exec 11610baab1ce echo "haha"</span></span><br><span class="line">haha</span><br><span class="line">root@ubuntu:~<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                        NAMES</span><br><span class="line">b9704931408c        nginx               <span class="string">"nginx -g 'daemon ..."</span>   About an hour ago   Up About an hour    0.0.0.0:443-&gt;443/tcp, 0.0.0.0:8080-&gt;80/tcp   my-third-nginx</span><br><span class="line">d0a4936e940e        nginx               <span class="string">"nginx -g 'daemon ..."</span>   About an hour ago   Up About an hour    443/tcp, 0.0.0.0:8800-&gt;80/tcp                my-second-nginx</span><br><span class="line">11610baab1ce        nginx               <span class="string">"nginx -g 'daemon ..."</span>   About an hour ago   Up 12 minutes       80/tcp, 443/tcp                              my-first-nginx</span><br></pre></td></tr></table></figure>

<h2 id="commit"><a href="#commit" class="headerlink" title="commit"></a>commit</h2><p>åŸºäºä¸€ä¸ªç°æœ‰çš„å®¹å™¨åˆ›å»ºæ–°çš„é•œåƒ. commit å¤šç”¨åœ¨åšå®¹å™¨è¿ç§»çš„æ—¶å€™, å½“å®¹å™¨ä¸ºç”±çŠ¶æ€æ—¶, æˆ‘ä»¬éœ€è¦ä¿å­˜ç°æœ‰å®¹å™¨çš„æ‰€æœ‰è¿è¡ŒçŠ¶æ€ä»¥ä¿è¯è¿ç§»åçš„ä¸€è‡´æ€§, è¿™æ—¶ commit å°±æ´¾ä¸Šäº†ç”¨åœº.</p>
<p>è¿è¡Œä¸€ä¸ªåˆå§‹çš„é•œåƒ, æˆ‘ä»¬é€šè¿‡ exec è¿›å…¥åˆ°å®¹å™¨, å¹¶åšäº†ä¸€äº›ä¿®æ”¹, å½“éœ€è¦è¿ç§»æ­¤å®¹å™¨æ—¶, å¯ä»¥æŠŠå½“å‰ä¿®æ”¹è¿‡åçš„å®¹å™¨ä¿å­˜ä¸ºä¸€ä¸ªæ–°çš„é•œåƒ. ç„¶åå°†é•œåƒè¿ç§»è‡³æ–°ä¸»æœº, å† run èµ·æ¥.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¿®æ”¹å®¹å™¨å†…å®¹</span></span><br><span class="line">root@ubuntu:~<span class="comment"># docker exec -it my-first-nginx /bin/bash</span></span><br><span class="line">root@11610baab1ce:/<span class="comment"># cd /tmp/</span></span><br><span class="line">root@11610baab1ce:/tmp<span class="comment"># ls</span></span><br><span class="line">root@11610baab1ce:/tmp<span class="comment"># echo "commit test" &gt; /tmp/c.txt</span></span><br><span class="line">root@11610baab1ce:/tmp<span class="comment"># ls</span></span><br><span class="line">c.txt</span><br><span class="line">root@11610baab1ce:/tmp<span class="comment"># cat /tmp/c.txt </span></span><br><span class="line">commit <span class="built_in">test</span></span><br><span class="line">root@11610baab1ce:/tmp<span class="comment"># exit</span></span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line"><span class="comment"># commit é•œåƒ</span></span><br><span class="line">root@ubuntu:~<span class="comment"># docker commit my-first-nginx nginx2:0.1</span></span><br><span class="line">sha256:7cb5220c81d58a56471b6ce69e40bf4d15f89652b4b4bd78ec4579b6473bfc91</span><br><span class="line">root@ubuntu:~<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">nginx2              0.1                 7cb5220c81d5        4 seconds ago       204MB</span><br><span class="line">centos              latest              a8493f5f50ff        35 hours ago        192MB</span><br><span class="line">nginx               latest              5766334bdaa0        39 hours ago        183MB</span><br><span class="line">hello-world         latest              48b5124b2768        2 months ago        1.84kB</span><br><span class="line"><span class="comment"># åŸºäºæ–°é•œåƒè¿è¡Œæ–°å®¹å™¨</span></span><br><span class="line">root@ubuntu:~<span class="comment"># docker exec -it new-first-nginx /bin/bash</span></span><br><span class="line">root@b4e6f8620ba3:/<span class="comment"># cd /tmp/</span></span><br><span class="line">root@b4e6f8620ba3:/tmp<span class="comment"># ls</span></span><br><span class="line">c.txt</span><br><span class="line">root@b4e6f8620ba3:/tmp<span class="comment"># cat c.txt </span></span><br><span class="line">commit <span class="built_in">test</span></span><br><span class="line">root@b4e6f8620ba3:/tmp<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>æ³¨æ„: æŒ‚è½½çš„æ•°æ®æ˜¯ä¸ä¼šè¢« commit åˆ°é•œåƒä¸­çš„. è¿ç§»ä¹‹åéœ€è¦ç”¨ç›¸åŒçš„å‚æ•°å¯åŠ¨èµ·æ¥</p>
<p>è¿ç§»æœ‰ä¸¤ç§æ–¹å¼:</p>
<ul>
<li>ä¸€ç§æ˜¯å¯¼å…¥å¯¼å‡ºçš„æ–¹å¼(é€šè¿‡ tar.gz æ–‡ä»¶)</li>
<li>ä¸€ç§æ˜¯é€šè¿‡ Registry çš„æ–¹å¼ push å’Œ pull</li>
</ul>
<p>å¦‚æœæ˜¯é€šè¿‡ Registry çš„æ–¹å¼çš„è¯, éœ€è¦åœ¨ commit æ—¶, é•œåƒåå­—ä¸­åŠ å…¥ Registry åœ°å€</p>
<p><code>docker container commit [OPTIONS] CONTAINER [REPOSITORY[:TAG]]</code></p>
<p>æ³¨æ„: commit çš„è¿‡ç¨‹ä¸­, å®¹å™¨å¤„äº pause çš„çŠ¶æ€, ç±»ä¼¼äº MySQL çš„æ’å®ƒé”</p>
<h2 id="cp"><a href="#cp" class="headerlink" title="cp"></a>cp</h2><p>é€šè¿‡ cp å‘½ä»¤å¯ä»¥æŠŠå®¹å™¨ä¸­çš„æ–‡ä»¶æ‹·è´åˆ°å®¿ä¸»æœº(æŠŠæ–‡ä»¶æ‹¿å‡ºæ¥)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker container cp --help</span></span><br><span class="line"></span><br><span class="line">Usage:	docker container cp [OPTIONS] CONTAINER:SRC_PATH DEST_PATH|-</span><br><span class="line">	docker cp [OPTIONS] SRC_PATH|- CONTAINER:DEST_PATH</span><br><span class="line"></span><br><span class="line">Copy files/folders between a container and the <span class="built_in">local</span> filesystem</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -L, --follow-link   Always follow symbol link <span class="keyword">in</span> SRC_PATH</span><br><span class="line">      --<span class="built_in">help</span>          Print usage</span><br><span class="line">root@ubuntu:~<span class="comment"># docker container cp my-first-nginx:/tmp/c.txt ./</span></span><br><span class="line">root@ubuntu:~<span class="comment"># ls</span></span><br><span class="line">c.txt  web</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„: ä¸¤ç§æ‰§è¡Œæ–¹å¼çš„è¯­æ³•ä¸åŒ</p>
<h2 id="diff"><a href="#diff" class="headerlink" title="diff"></a>diff</h2><p>åˆ—å‡ºä¸åŸå§‹é•œåƒç›¸æ¯”,å®¹å™¨ä¸­å˜åŒ–çš„å†…å®¹.</p>
<ul>
<li>A: å¢åŠ </li>
<li>D: åˆ é™¤</li>
<li>C: ä¿®æ”¹</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker container diff  --help</span></span><br><span class="line"></span><br><span class="line">Usage:	docker container diff CONTAINER</span><br><span class="line"></span><br><span class="line">Inspect changes to files or directories on a container<span class="string">'s filesystem</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Options:</span></span><br><span class="line"><span class="string">      --help   Print usage</span></span><br><span class="line"><span class="string">root@ubuntu:~# docker container diff  my-second-nginx</span></span><br><span class="line"><span class="string">C /run</span></span><br><span class="line"><span class="string">A /run/nginx.pid</span></span><br><span class="line"><span class="string">C /var</span></span><br><span class="line"><span class="string">C /var/cache</span></span><br><span class="line"><span class="string">C /var/cache/nginx</span></span><br><span class="line"><span class="string">A /var/cache/nginx/client_temp</span></span><br><span class="line"><span class="string">A /var/cache/nginx/fastcgi_temp</span></span><br><span class="line"><span class="string">A /var/cache/nginx/proxy_temp</span></span><br><span class="line"><span class="string">A /var/cache/nginx/scgi_temp</span></span><br><span class="line"><span class="string">A /var/cache/nginx/uwsgi_temp</span></span><br></pre></td></tr></table></figure>

<h2 id="export-amp-import-save-amp-load"><a href="#export-amp-import-save-amp-load" class="headerlink" title="export&amp;import/save&amp;load"></a>export&amp;import/save&amp;load</h2><p>Docker çš„å¯¼å…¥å¯¼å‡º</p>
<p><a href="https://docs.lvrui.io/2017/02/19/dockerçš„å¯¼å…¥å¯¼å‡º/">https://docs.lvrui.io/2017/02/19/dockerçš„å¯¼å…¥å¯¼å‡º/</a></p>
<p>export&amp;import æ“ä½œçš„å¯¹è±¡æ˜¯å®¹å™¨, å¯¼å‡ºåˆ°ä¸€ä¸ªæ–°çš„é•œåƒ, è¯¥é•œåƒåªæœ‰ä¸€å±‚</p>
<p>save&amp;load æ“ä½œå¯¹è±¡æ˜¯é•œåƒ, åŸé•œåƒå±‚æ•°ä¿ç•™</p>
<p>å¦‚æœå¯¼å‡ºå®¹å™¨è¿˜éœ€è¦ä¿ç•™å±‚æ•°, é‚£å°±éœ€è¦ä½¿ç”¨ commit+save+load é»„é‡‘ç»„åˆå•¦</p>
<h2 id="inspect"><a href="#inspect" class="headerlink" title="inspect"></a>inspect</h2><p>æŸ¥çœ‹å®¹å™¨è¯¦ç»†ä¿¡æ¯</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker container inspect my-third-nginx</span></span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">"Id"</span>: <span class="string">"b9704931408c6d054bc9c510878e10467a71d412bef065afa7414403982001b6"</span>,</span><br><span class="line">        <span class="string">"Created"</span>: <span class="string">"2017-04-08T06:22:29.186834559Z"</span>,</span><br><span class="line">        <span class="string">"Path"</span>: <span class="string">"nginx"</span>,</span><br><span class="line">        <span class="string">"Args"</span>: [</span><br><span class="line">            <span class="string">"-g"</span>,</span><br><span class="line">            <span class="string">"daemon off;"</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="string">"State"</span>: &#123;</span><br><span class="line">            <span class="string">"Status"</span>: <span class="string">"running"</span>,</span><br><span class="line">            <span class="string">"Running"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="string">"Paused"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"Restarting"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"OOMKilled"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"Dead"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"Pid"</span>: 2648,</span><br><span class="line">            <span class="string">"ExitCode"</span>: 0,</span><br><span class="line">            <span class="string">"Error"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"StartedAt"</span>: <span class="string">"2017-04-08T06:22:29.555131293Z"</span>,</span><br><span class="line">            <span class="string">"FinishedAt"</span>: <span class="string">"0001-01-01T00:00:00Z"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"Image"</span>: <span class="string">"sha256:5766334bdaa0bc37f1f0c02cb94c351f9b076bcffa042d6ce811b0fd9bc31f3b"</span>,</span><br><span class="line">        <span class="string">"ResolvConfPath"</span>: <span class="string">"/var/lib/docker/containers/b9704931408c6d054bc9c510878e10467a71d412bef065afa7414403982001b6/resolv.conf"</span>,</span><br><span class="line">        <span class="string">"HostnamePath"</span>: <span class="string">"/var/lib/docker/containers/b9704931408c6d054bc9c510878e10467a71d412bef065afa7414403982001b6/hostname"</span>,</span><br><span class="line">        <span class="string">"HostsPath"</span>: <span class="string">"/var/lib/docker/containers/b9704931408c6d054bc9c510878e10467a71d412bef065afa7414403982001b6/hosts"</span>,</span><br><span class="line">        <span class="string">"LogPath"</span>: <span class="string">"/var/lib/docker/containers/b9704931408c6d054bc9c510878e10467a71d412bef065afa7414403982001b6/b9704931408c6d054bc9c510878e10467a71d412bef065afa7414403982001b6-json.log"</span>,</span><br><span class="line">        <span class="string">"Name"</span>: <span class="string">"/my-third-nginx"</span>,</span><br><span class="line">        <span class="string">"RestartCount"</span>: 0,</span><br><span class="line">        <span class="string">"Driver"</span>: <span class="string">"aufs"</span>,</span><br><span class="line">        <span class="string">"MountLabel"</span>: <span class="string">""</span>,</span><br><span class="line">        <span class="string">"ProcessLabel"</span>: <span class="string">""</span>,</span><br><span class="line">        <span class="string">"AppArmorProfile"</span>: <span class="string">"docker-default"</span>,</span><br><span class="line">        <span class="string">"ExecIDs"</span>: null,</span><br><span class="line">        <span class="string">"HostConfig"</span>: &#123;</span><br><span class="line">            <span class="string">"Binds"</span>: [</span><br><span class="line">                <span class="string">"/root/web:/usr/share/nginx/html:ro"</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="string">"ContainerIDFile"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"LogConfig"</span>: &#123;</span><br><span class="line">                <span class="string">"Type"</span>: <span class="string">"json-file"</span>,</span><br><span class="line">                <span class="string">"Config"</span>: &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">"NetworkMode"</span>: <span class="string">"default"</span>,</span><br><span class="line">            <span class="string">"PortBindings"</span>: &#123;</span><br><span class="line">                <span class="string">"443/tcp"</span>: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="string">"HostIp"</span>: <span class="string">""</span>,</span><br><span class="line">                        <span class="string">"HostPort"</span>: <span class="string">"443"</span></span><br><span class="line">                    &#125;</span><br><span class="line">                ],</span><br><span class="line">                <span class="string">"80/tcp"</span>: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="string">"HostIp"</span>: <span class="string">""</span>,</span><br><span class="line">                        <span class="string">"HostPort"</span>: <span class="string">"8080"</span></span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">"RestartPolicy"</span>: &#123;</span><br><span class="line">                <span class="string">"Name"</span>: <span class="string">"no"</span>,</span><br><span class="line">                <span class="string">"MaximumRetryCount"</span>: 0</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">"AutoRemove"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"VolumeDriver"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"VolumesFrom"</span>: null,</span><br><span class="line">            <span class="string">"CapAdd"</span>: null,</span><br><span class="line">            <span class="string">"CapDrop"</span>: null,</span><br><span class="line">            <span class="string">"Dns"</span>: [],</span><br><span class="line">            <span class="string">"DnsOptions"</span>: [],</span><br><span class="line">            <span class="string">"DnsSearch"</span>: [],</span><br><span class="line">            <span class="string">"ExtraHosts"</span>: null,</span><br><span class="line">            <span class="string">"GroupAdd"</span>: null,</span><br><span class="line">            <span class="string">"IpcMode"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"Cgroup"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"Links"</span>: null,</span><br><span class="line">            <span class="string">"OomScoreAdj"</span>: 0,</span><br><span class="line">            <span class="string">"PidMode"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"Privileged"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"PublishAllPorts"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"ReadonlyRootfs"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"SecurityOpt"</span>: null,</span><br><span class="line">            <span class="string">"UTSMode"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"UsernsMode"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"ShmSize"</span>: 67108864,</span><br><span class="line">            <span class="string">"Runtime"</span>: <span class="string">"runc"</span>,</span><br><span class="line">            <span class="string">"ConsoleSize"</span>: [</span><br><span class="line">                0,</span><br><span class="line">                0</span><br><span class="line">            ],</span><br><span class="line">            <span class="string">"Isolation"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"CpuShares"</span>: 0,</span><br><span class="line">            <span class="string">"Memory"</span>: 0,</span><br><span class="line">            <span class="string">"NanoCpus"</span>: 0,</span><br><span class="line">            <span class="string">"CgroupParent"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"BlkioWeight"</span>: 0,</span><br><span class="line">            <span class="string">"BlkioWeightDevice"</span>: null,</span><br><span class="line">            <span class="string">"BlkioDeviceReadBps"</span>: null,</span><br><span class="line">            <span class="string">"BlkioDeviceWriteBps"</span>: null,</span><br><span class="line">            <span class="string">"BlkioDeviceReadIOps"</span>: null,</span><br><span class="line">            <span class="string">"BlkioDeviceWriteIOps"</span>: null,</span><br><span class="line">            <span class="string">"CpuPeriod"</span>: 0,</span><br><span class="line">            <span class="string">"CpuQuota"</span>: 0,</span><br><span class="line">            <span class="string">"CpuRealtimePeriod"</span>: 0,</span><br><span class="line">            <span class="string">"CpuRealtimeRuntime"</span>: 0,</span><br><span class="line">            <span class="string">"CpusetCpus"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"CpusetMems"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"Devices"</span>: [],</span><br><span class="line">            <span class="string">"DeviceCgroupRules"</span>: null,</span><br><span class="line">            <span class="string">"DiskQuota"</span>: 0,</span><br><span class="line">            <span class="string">"KernelMemory"</span>: 0,</span><br><span class="line">            <span class="string">"MemoryReservation"</span>: 0,</span><br><span class="line">            <span class="string">"MemorySwap"</span>: 0,</span><br><span class="line">            <span class="string">"MemorySwappiness"</span>: -1,</span><br><span class="line">            <span class="string">"OomKillDisable"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"PidsLimit"</span>: 0,</span><br><span class="line">            <span class="string">"Ulimits"</span>: null,</span><br><span class="line">            <span class="string">"CpuCount"</span>: 0,</span><br><span class="line">            <span class="string">"CpuPercent"</span>: 0,</span><br><span class="line">            <span class="string">"IOMaximumIOps"</span>: 0,</span><br><span class="line">            <span class="string">"IOMaximumBandwidth"</span>: 0</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"GraphDriver"</span>: &#123;</span><br><span class="line">            <span class="string">"Data"</span>: null,</span><br><span class="line">            <span class="string">"Name"</span>: <span class="string">"aufs"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"Mounts"</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">"Type"</span>: <span class="string">"bind"</span>,</span><br><span class="line">                <span class="string">"Source"</span>: <span class="string">"/root/web"</span>,</span><br><span class="line">                <span class="string">"Destination"</span>: <span class="string">"/usr/share/nginx/html"</span>,</span><br><span class="line">                <span class="string">"Mode"</span>: <span class="string">"ro"</span>,</span><br><span class="line">                <span class="string">"RW"</span>: <span class="literal">false</span>,</span><br><span class="line">                <span class="string">"Propagation"</span>: <span class="string">""</span></span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="string">"Config"</span>: &#123;</span><br><span class="line">            <span class="string">"Hostname"</span>: <span class="string">"b9704931408c"</span>,</span><br><span class="line">            <span class="string">"Domainname"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"User"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"AttachStdin"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"AttachStdout"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"AttachStderr"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"ExposedPorts"</span>: &#123;</span><br><span class="line">                <span class="string">"443/tcp"</span>: &#123;&#125;,</span><br><span class="line">                <span class="string">"80/tcp"</span>: &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">"Tty"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"OpenStdin"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"StdinOnce"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"Env"</span>: [</span><br><span class="line">                <span class="string">"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"</span>,</span><br><span class="line">                <span class="string">"NGINX_VERSION=1.11.13-1~jessie"</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="string">"Cmd"</span>: [</span><br><span class="line">                <span class="string">"nginx"</span>,</span><br><span class="line">                <span class="string">"-g"</span>,</span><br><span class="line">                <span class="string">"daemon off;"</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="string">"ArgsEscaped"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="string">"Image"</span>: <span class="string">"nginx"</span>,</span><br><span class="line">            <span class="string">"Volumes"</span>: null,</span><br><span class="line">            <span class="string">"WorkingDir"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"Entrypoint"</span>: null,</span><br><span class="line">            <span class="string">"OnBuild"</span>: null,</span><br><span class="line">            <span class="string">"Labels"</span>: &#123;&#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"NetworkSettings"</span>: &#123;</span><br><span class="line">            <span class="string">"Bridge"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"SandboxID"</span>: <span class="string">"916a8bef0178b4e8e2ff1c246a9e04c85686b8ddf8493946de7103577ff8158b"</span>,</span><br><span class="line">            <span class="string">"HairpinMode"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"LinkLocalIPv6Address"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"LinkLocalIPv6PrefixLen"</span>: 0,</span><br><span class="line">            <span class="string">"Ports"</span>: &#123;</span><br><span class="line">                <span class="string">"443/tcp"</span>: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="string">"HostIp"</span>: <span class="string">"0.0.0.0"</span>,</span><br><span class="line">                        <span class="string">"HostPort"</span>: <span class="string">"443"</span></span><br><span class="line">                    &#125;</span><br><span class="line">                ],</span><br><span class="line">                <span class="string">"80/tcp"</span>: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="string">"HostIp"</span>: <span class="string">"0.0.0.0"</span>,</span><br><span class="line">                        <span class="string">"HostPort"</span>: <span class="string">"8080"</span></span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">"SandboxKey"</span>: <span class="string">"/var/run/docker/netns/916a8bef0178"</span>,</span><br><span class="line">            <span class="string">"SecondaryIPAddresses"</span>: null,</span><br><span class="line">            <span class="string">"SecondaryIPv6Addresses"</span>: null,</span><br><span class="line">            <span class="string">"EndpointID"</span>: <span class="string">"7a9c71aae5980ccd513c1e7a4e8cefaf56a87e1d796669bbfb70ffc728d1e0bb"</span>,</span><br><span class="line">            <span class="string">"Gateway"</span>: <span class="string">"172.17.0.1"</span>,</span><br><span class="line">            <span class="string">"GlobalIPv6Address"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"GlobalIPv6PrefixLen"</span>: 0,</span><br><span class="line">            <span class="string">"IPAddress"</span>: <span class="string">"172.17.0.4"</span>,</span><br><span class="line">            <span class="string">"IPPrefixLen"</span>: 16,</span><br><span class="line">            <span class="string">"IPv6Gateway"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"MacAddress"</span>: <span class="string">"02:42:ac:11:00:04"</span>,</span><br><span class="line">            <span class="string">"Networks"</span>: &#123;</span><br><span class="line">                <span class="string">"bridge"</span>: &#123;</span><br><span class="line">                    <span class="string">"IPAMConfig"</span>: null,</span><br><span class="line">                    <span class="string">"Links"</span>: null,</span><br><span class="line">                    <span class="string">"Aliases"</span>: null,</span><br><span class="line">                    <span class="string">"NetworkID"</span>: <span class="string">"26d72edf89c3ae77e1de636d4357b819a12c24ae64ab0da4d9b2d43610c44f24"</span>,</span><br><span class="line">                    <span class="string">"EndpointID"</span>: <span class="string">"7a9c71aae5980ccd513c1e7a4e8cefaf56a87e1d796669bbfb70ffc728d1e0bb"</span>,</span><br><span class="line">                    <span class="string">"Gateway"</span>: <span class="string">"172.17.0.1"</span>,</span><br><span class="line">                    <span class="string">"IPAddress"</span>: <span class="string">"172.17.0.4"</span>,</span><br><span class="line">                    <span class="string">"IPPrefixLen"</span>: 16,</span><br><span class="line">                    <span class="string">"IPv6Gateway"</span>: <span class="string">""</span>,</span><br><span class="line">                    <span class="string">"GlobalIPv6Address"</span>: <span class="string">""</span>,</span><br><span class="line">                    <span class="string">"GlobalIPv6PrefixLen"</span>: 0,</span><br><span class="line">                    <span class="string">"MacAddress"</span>: <span class="string">"02:42:ac:11:00:04"</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h2 id="ls-ps-list"><a href="#ls-ps-list" class="headerlink" title="ls/ps/list"></a>ls/ps/list</h2><p>æŸ¥çœ‹ container åˆ—è¡¨</p>
<ul>
<li>docker ps</li>
<li>docker container ls</li>
<li>docker container list</li>
</ul>
<p>ä»¥ä¸Šä¸‰æ¡å‘½ä»¤çš„ç”¨æ³•å’Œä½œç”¨éƒ½æ˜¯ä¸€æ ·çš„, ä¹‹é—´åšäº†åˆ«å</p>
<p>æœ€å®ç”¨çš„å‚æ•°<code>-s</code> å¯ä»¥æ˜¾ç¤ºå‡ºå®¹å™¨å ç”¨ç©ºé—´å¤§å°, æ‹¬å·ä¸­çš„æ˜¯é•œåƒå¤§å°, å‰é¢æ˜¯å¯å†™å±‚(å®¹å™¨)å¤§å°</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker container list -s</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                        NAMES               SIZE</span><br><span class="line">b4e6f8620ba3        nginx2:0.1          <span class="string">"nginx -g 'daemon ..."</span>   29 minutes ago      Up 29 minutes       80/tcp, 443/tcp                              new-first-nginx     413B (virtual 204MB)</span><br><span class="line">b9704931408c        nginx               <span class="string">"nginx -g 'daemon ..."</span>   2 hours ago         Up 2 hours          0.0.0.0:443-&gt;443/tcp, 0.0.0.0:8080-&gt;80/tcp   my-third-nginx      7B (virtual 183MB)</span><br><span class="line">d0a4936e940e        nginx               <span class="string">"nginx -g 'daemon ..."</span>   2 hours ago         Up 2 hours          443/tcp, 0.0.0.0:8800-&gt;80/tcp                my-second-nginx     2B (virtual 183MB)</span><br><span class="line">11610baab1ce        nginx               <span class="string">"nginx -g 'daemon ..."</span>   2 hours ago         Up About an hour    80/tcp, 443/tcp                              my-first-nginx      21.3MB (virtual 204MB)</span><br><span class="line">root@ubuntu:~<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<h2 id="logs"><a href="#logs" class="headerlink" title="logs"></a>logs</h2><p>æŸ¥çœ‹å®¹å™¨çš„å‰å°å›æ˜¾æ—¥å¿—. ç”±äºå®¹å™¨å¿…é¡»ä»¥é˜»å¡å‰å°çš„æ–¹å¼è¿è¡Œ, é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ logs å‘½ä»¤æ¥æŸ¥çœ‹å®¹å™¨å‰å°çš„å›æ˜¾(åœ¨é»˜è®¤æ˜¯ json-file æ—¥å¿—å¼•æ“ä¸‹)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker run -d centos ping 123.57.233.243</span></span><br><span class="line">791a4ad7ffa83f81a78e2bba1a5d5366a099be443beb19f66ee0d51e83cd020d</span><br><span class="line">root@ubuntu:~<span class="comment"># </span></span><br><span class="line">root@ubuntu:~<span class="comment"># </span></span><br><span class="line">root@ubuntu:~<span class="comment"># docker logs -f 791a4ad7ffa8</span></span><br><span class="line">PING 123.57.233.243 (123.57.233.243) 56(84) bytes of data.</span><br><span class="line">64 bytes from 123.57.233.243: icmp_seq=1 ttl=127 time=7.89 ms</span><br><span class="line">64 bytes from 123.57.233.243: icmp_seq=2 ttl=127 time=6.66 ms</span><br><span class="line">64 bytes from 123.57.233.243: icmp_seq=3 ttl=127 time=6.55 ms</span><br><span class="line">64 bytes from 123.57.233.243: icmp_seq=4 ttl=127 time=6.46 ms</span><br><span class="line">64 bytes from 123.57.233.243: icmp_seq=5 ttl=127 time=175 ms</span><br><span class="line">64 bytes from 123.57.233.243: icmp_seq=6 ttl=127 time=267 ms</span><br></pre></td></tr></table></figure>

<h2 id="kill-start-stop-restart-rm-pause-unpause-prune"><a href="#kill-start-stop-restart-rm-pause-unpause-prune" class="headerlink" title="kill/start/stop/restart/rm/pause/unpause/prune"></a>kill/start/stop/restart/rm/pause/unpause/prune</h2><ul>
<li>kill ç»™å®¹å™¨å‘é€ kill ä¿¡å·, éæ­£å¸¸é€€å‡ºå®¹å™¨</li>
<li>start å¯åŠ¨é€€å‡ºçŠ¶æ€çš„å®¹å™¨</li>
<li>stop é€€å‡ºè¿è¡ŒçŠ¶æ€çš„å®¹å™¨</li>
<li>restart é‡å¯å®¹å™¨</li>
<li>rm åˆ é™¤é€€å‡ºçŠ¶æ€çš„å®¹å™¨</li>
<li>pause æš‚åœè¿è¡Œä¸­çš„å®¹å™¨(å¤„äºé˜»å¡çŠ¶æ€)</li>
<li>unpause æ¢å¤æš‚åœçš„å®¹å™¨è‡³è¿è¡ŒçŠ¶æ€</li>
<li>prune åˆ é™¤æ‰€æœ‰ stopped çŠ¶æ€çš„å®¹å™¨(1.13çš„æ–°ç‰¹æ€§, æ•‘ä¸–ä¸»!)</li>
</ul>
<h2 id="port"><a href="#port" class="headerlink" title="port"></a>port</h2><p>æŸ¥çœ‹ç«¯å£çš„æ˜ å°„å…³ç³»</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker container port my-third-nginx</span></span><br><span class="line">443/tcp -&gt; 0.0.0.0:443</span><br><span class="line">80/tcp -&gt; 0.0.0.0:8080</span><br><span class="line">root@ubuntu:~<span class="comment"># docker container port my-second-nginx</span></span><br><span class="line">80/tcp -&gt; 0.0.0.0:8800</span><br><span class="line">root@ubuntu:~<span class="comment"># docker container port my-first-nginx</span></span><br><span class="line">root@ubuntu:~<span class="comment"># docker container port my-second-nginx 80/tcp</span></span><br><span class="line">0.0.0.0:8800</span><br></pre></td></tr></table></figure>

<h2 id="rename"><a href="#rename" class="headerlink" title="rename"></a>rename</h2><p>æ›´æ”¹å®¹å™¨åç§°</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                        NAMES</span><br><span class="line">b4e6f8620ba3        nginx2:0.1          <span class="string">"nginx -g 'daemon ..."</span>   About an hour ago   Up About an hour    80/tcp, 443/tcp                              new-first-nginx</span><br><span class="line">b9704931408c        nginx               <span class="string">"nginx -g 'daemon ..."</span>   2 hours ago         Up 2 hours          0.0.0.0:443-&gt;443/tcp, 0.0.0.0:8080-&gt;80/tcp   my-third-nginx</span><br><span class="line">d0a4936e940e        nginx               <span class="string">"nginx -g 'daemon ..."</span>   2 hours ago         Up 2 hours          443/tcp, 0.0.0.0:8800-&gt;80/tcp                my-second-nginx</span><br><span class="line">11610baab1ce        nginx               <span class="string">"nginx -g 'daemon ..."</span>   2 hours ago         Up About an hour    80/tcp, 443/tcp                              my-first-nginx</span><br><span class="line">root@ubuntu:~<span class="comment"># docker container rename --help</span></span><br><span class="line"></span><br><span class="line">Usage:	docker container rename CONTAINER NEW_NAME</span><br><span class="line"></span><br><span class="line">Rename a container</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">      --<span class="built_in">help</span>   Print usage</span><br><span class="line">root@ubuntu:~<span class="comment"># docker container rename new-first-nginx new-first-nginx2</span></span><br><span class="line">root@ubuntu:~<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                        NAMES</span><br><span class="line">b4e6f8620ba3        nginx2:0.1          <span class="string">"nginx -g 'daemon ..."</span>   About an hour ago   Up About an hour    80/tcp, 443/tcp                              new-first-nginx2</span><br><span class="line">b9704931408c        nginx               <span class="string">"nginx -g 'daemon ..."</span>   2 hours ago         Up 2 hours          0.0.0.0:443-&gt;443/tcp, 0.0.0.0:8080-&gt;80/tcp   my-third-nginx</span><br><span class="line">d0a4936e940e        nginx               <span class="string">"nginx -g 'daemon ..."</span>   2 hours ago         Up 2 hours          443/tcp, 0.0.0.0:8800-&gt;80/tcp                my-second-nginx</span><br><span class="line">11610baab1ce        nginx               <span class="string">"nginx -g 'daemon ..."</span>   2 hours ago         Up About an hour    80/tcp, 443/tcp                              my-first-nginx</span><br><span class="line">root@ubuntu:~<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<h2 id="stats"><a href="#stats" class="headerlink" title="stats"></a>stats</h2><p>å®æ—¶æŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨çŠ¶å†µ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker container stats </span></span><br><span class="line">CONTAINER           CPU %               MEM USAGE / LIMIT     MEM %               NET I/O             BLOCK I/O           PIDS</span><br><span class="line">b4e6f8620ba3        0.00%               1.457MiB / 975.1MiB   0.15%               690B / 0B           0B / 4.1kB          2</span><br><span class="line">b9704931408c        0.00%               1.449MiB / 975.1MiB   0.15%               732B / 0B           0B / 0B             2</span><br><span class="line">d0a4936e940e        0.00%               1.512MiB / 975.1MiB   0.16%               1.36kB / 671B       0B / 0B             2</span><br><span class="line">11610baab1ce        0.00%               1.465MiB / 975.1MiB   0.15%               732B / 0B           0B / 0B             2</span><br></pre></td></tr></table></figure>

<h2 id="top"><a href="#top" class="headerlink" title="top"></a>top</h2><p>æŸ¥çœ‹å®¹å™¨çš„è¿›ç¨‹ä¿¡æ¯</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker container top --help</span></span><br><span class="line"></span><br><span class="line">Usage:	docker container top CONTAINER [ps OPTIONS]</span><br><span class="line"></span><br><span class="line">Display the running processes of a container</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">      --<span class="built_in">help</span>   Print usage</span><br><span class="line">root@ubuntu:~<span class="comment"># docker container top my-third-nginx</span></span><br><span class="line">UID                 PID                 PPID                C                   STIME               TTY                 TIME                CMD</span><br><span class="line">root                2648                2631                0                   Apr07               ?                   00:00:00            nginx: master process nginx -g daemon off;</span><br><span class="line">syslog              2669                2648                0                   Apr07               ?                   00:00:00            nginx: worker process</span><br></pre></td></tr></table></figure>

<h2 id="update"><a href="#update" class="headerlink" title="update"></a>update</h2><p>è°ƒæ•´åˆ†é…ç»™å®¹å™¨çš„è®¡ç®—èµ„æº, å¯ä»¥æ›´æ”¹è¯¥å®¹å™¨å¯ä»¥ä½¿ç”¨çš„ CPU è®¡ç®—èµ„æºä¸å†…å­˜èµ„æºç­‰</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker container update --help</span></span><br><span class="line"></span><br><span class="line">Usage:	docker container update [OPTIONS] CONTAINER [CONTAINER...]</span><br><span class="line"></span><br><span class="line">Update configuration of one or more containers</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">      --blkio-weight uint16        Block IO (relative weight), between 10 and 1000, or 0 to <span class="built_in">disable</span> (default 0)</span><br><span class="line">      --cpu-period int             Limit CPU CFS (Completely Fair Scheduler) period</span><br><span class="line">      --cpu-quota int              Limit CPU CFS (Completely Fair Scheduler) quota</span><br><span class="line">      --cpu-rt-period int          Limit the CPU real-time period <span class="keyword">in</span> microseconds</span><br><span class="line">      --cpu-rt-runtime int         Limit the CPU real-time runtime <span class="keyword">in</span> microseconds</span><br><span class="line">  -c, --cpu-shares int             CPU shares (relative weight)</span><br><span class="line">      --cpuset-cpus string         CPUs <span class="keyword">in</span> <span class="built_in">which</span> to allow execution (0-3, 0,1)</span><br><span class="line">      --cpuset-mems string         MEMs <span class="keyword">in</span> <span class="built_in">which</span> to allow execution (0-3, 0,1)</span><br><span class="line">      --<span class="built_in">help</span>                       Print usage</span><br><span class="line">      --kernel-memory bytes        Kernel memory <span class="built_in">limit</span></span><br><span class="line">  -m, --memory bytes               Memory <span class="built_in">limit</span></span><br><span class="line">      --memory-reservation bytes   Memory soft <span class="built_in">limit</span></span><br><span class="line">      --memory-swap bytes          Swap <span class="built_in">limit</span> equal to memory plus swap: <span class="string">'-1'</span> to <span class="built_in">enable</span> unlimited swap</span><br><span class="line">      --restart string             Restart policy to apply when a container exits</span><br></pre></td></tr></table></figure>

<h2 id="wait"><a href="#wait" class="headerlink" title="wait"></a>wait</h2><p>é˜»å¡å®¹å™¨çš„è¿è¡Œç›´åˆ°åœæ­¢ä¸ºæ­¢, ç„¶åæ‰“å°è¯¥å®¹å™¨çš„é€€å‡ºçŠ¶æ€ç </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç»ˆç«¯1</span></span><br><span class="line">root@ubuntu:~<span class="comment"># docker container wait new-first-nginx2</span></span><br><span class="line"><span class="comment"># ç»ˆç«¯è¢«é˜»å¡</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»ˆç«¯2</span></span><br><span class="line">root@ubuntu:~<span class="comment"># docker container stop new-first-nginx2</span></span><br><span class="line">new-first-nginx2</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»ˆç«¯1</span></span><br><span class="line">root@ubuntu:~<span class="comment"># docker container wait new-first-nginx2</span></span><br><span class="line">0</span><br></pre></td></tr></table></figure>

<h2 id="run"><a href="#run" class="headerlink" title="run"></a>run</h2><p>è¿è¡Œä¸€ä¸ªå®¹å™¨, è¿™ä¸ªå‘½ä»¤çš„å‚æ•°éå¸¸å¤š, å¯ä»¥å®šåˆ¶çš„å±æ€§ä¹Ÿéå¸¸å¤š, å¸¸ç”¨å‚æ•°å¦‚ä¸‹</p>
<ul>
<li><code>-e</code>: è®¾ç½®ç¯å¢ƒå˜é‡</li>
<li><code>-h</code>: è®¾ç½® hostname</li>
<li><code>-i</code>: å¼€æ”¾æ ‡å‡†è¾“å…¥</li>
<li><code>-t</code>: åˆ†é…ä¼ªç»ˆç«¯</li>
<li><code>-l</code>: æ‰“æ ‡ç­¾</li>
<li><code>-p</code>: æŒ‡å®šæ˜ å°„å‡ºæ¥çš„ç«¯å£(å¯éšæœºåˆ†é…, å¯ä»¥æŒ‡å®š)</li>
<li><code>-P</code>: æ˜ å°„å®¹å™¨å†…æ‰€æœ‰å¼€æ”¾çš„ç«¯å£(ç«¯å£å·éšæœºåˆ†é…)</li>
<li><code>-v</code>: æ•°æ®å·çš„æŒ‚è½½</li>
<li><code>--volumes-driver</code>: æŒ‡å®šå­˜å‚¨å¼•æ“</li>
<li><code>-w</code>: å®¹å™¨è¿è¡Œçš„å·¥ä½œç›®å½•</li>
<li><code>--restart</code>: é»˜è®¤ä¸º no, å®¹å™¨å¼‚å¸¸é€€å‡ºåç¦æ­¢è‡ªåŠ¨é‡å¯<ul>
<li>è®¾ç½®ä¸º <code>--restart=on-failure:10</code> , æ„å‘³å¯¹è¯¥å®¹å™¨çš„é0é€€å‡ºçŠ¶æ€è¿›è¡Œé‡å¯, æœ€å¤šé‡å¯10æ¬¡</li>
<li>è®¾ç½®ä¸º <code>--restart=always</code> å§‹ç»ˆé‡å¯</li>
</ul>
</li>
<li><code>--network</code>: æŒ‡å®šç½‘ç»œç±»å‹</li>
<li><code>--name</code>: æŒ‡å®šå®¹å™¨åç§°</li>
<li><code>--log-driver</code>: æŒ‡å®šæ—¥å¿—å¼•æ“</li>
<li><code>--link</code>: ç½‘ç»œå±‚è¿é€šæŒ‡å®šå®¹å™¨</li>
<li><code>--dns</code>: æŒ‡å®šå®¹å™¨å†…ä½¿ç”¨çš„ DNS æœåŠ¡å™¨</li>
<li><code>--privileged</code>: ææƒ,åœ¨å®¹å™¨å†…è·å–æ‰©å±•çš„æ‰§è¡Œæƒé™</li>
<li><code>--add-host</code>: hosts é…ç½®. ä¾‹å¦‚: <code>--add-host polarsnow:123.57.233.243</code></li>
</ul>

      
    </div>

    
    
    
      

      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://docs.lvrui.io/2017/04/15/Docker%E5%88%9D%E4%BD%93%E9%AA%8C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.JPG">
      <meta itemprop="name" content="æåœ°ç‘é›ª">
      <meta itemprop="description" content="æåœ°ç‘é›ªçš„ä¸ªäººæŠ€æœ¯åšå®¢. "å–ä¹‹å¼€æº ç”¨ä¹‹å¼€æº", åˆ†äº«è‡ªå·±çš„ç»éªŒä¹‹è°ˆ".">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Polar Snow Documentation">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/04/15/Docker%E5%88%9D%E4%BD%93%E9%AA%8C/" class="post-title-link" itemprop="url">Dockeråˆä½“éªŒ</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2017-04-15 10:44:04" itemprop="dateCreated datePublished" datetime="2017-04-15T10:44:04+08:00">2017-04-15</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Docker/" itemprop="url" rel="index"><span itemprop="name">Docker</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqusï¼š</span>
    
    <a title="disqus" href="/2017/04/15/Docker%E5%88%9D%E4%BD%93%E9%AA%8C/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/04/15/Dockeråˆä½“éªŒ/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<ul>
<li>bash å‰å°è¿è¡Œ</li>
<li>å®¹å™¨æŒä¹…è¿è¡Œçš„æ¡ä»¶</li>
<li>nginx åå°è¿è¡Œ</li>
<li>åå°è¿è¡Œçš„æ¡ä»¶</li>
<li>Dockeræ•°æ®å­˜å‚¨çš„å“²å­¦</li>
<li>Dockerä½¿ç”¨çš„å“²å­¦</li>
</ul>
</blockquote>
<h1 id="å‰å°è¿è¡Œå®¹å™¨"><a href="#å‰å°è¿è¡Œå®¹å™¨" class="headerlink" title="å‰å°è¿è¡Œå®¹å™¨"></a>å‰å°è¿è¡Œå®¹å™¨</h1><h2 id="æ‹‰å–-centos-é•œåƒ"><a href="#æ‹‰å–-centos-é•œåƒ" class="headerlink" title="æ‹‰å– centos é•œåƒ"></a>æ‹‰å– centos é•œåƒ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker pull centos</span></span><br><span class="line">Using default tag: latest</span><br><span class="line">latest: Pulling from library/centos</span><br><span class="line">93857f76ae30: Pull complete </span><br><span class="line">Digest: sha256:4eda692c08e0a065ae91d74e82fff4af3da307b4341ad61fa61771cc4659af60</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> centos:latest</span><br></pre></td></tr></table></figure>

<h2 id="æŸ¥çœ‹é•œåƒåˆ—è¡¨"><a href="#æŸ¥çœ‹é•œåƒåˆ—è¡¨" class="headerlink" title="æŸ¥çœ‹é•œåƒåˆ—è¡¨"></a>æŸ¥çœ‹é•œåƒåˆ—è¡¨</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">centos              latest              a8493f5f50ff        33 hours ago        192MB</span><br><span class="line">nginx               latest              5766334bdaa0        37 hours ago        183MB</span><br><span class="line">hello-world         latest              48b5124b2768        2 months ago        1.84kB</span><br></pre></td></tr></table></figure>

<h2 id="ä»¥å‰å°è¿è¡Œæ–¹å¼è¿è¡Œå®¹å™¨"><a href="#ä»¥å‰å°è¿è¡Œæ–¹å¼è¿è¡Œå®¹å™¨" class="headerlink" title="ä»¥å‰å°è¿è¡Œæ–¹å¼è¿è¡Œå®¹å™¨"></a>ä»¥å‰å°è¿è¡Œæ–¹å¼è¿è¡Œå®¹å™¨</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker run --name "mycentos" -it centos /bin/bash</span></span><br><span class="line">[root@e4b1ccd2600b /]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<ul>
<li>run: è¿è¡Œä¸€ä¸ªå®¹å™¨</li>
<li>â€”name â€œmycentosâ€: ç»™å®¹å™¨å‘½å</li>
<li>-i: æ‰“å¼€å®¹å™¨çš„æ ‡å‡†è¾“å…¥</li>
<li>-t: åˆ†é…ä¸€ä¸ªä¼ªç»ˆç«¯ tty</li>
<li>centos: é•œåƒå</li>
<li>è¿è¡Œå®¹å™¨åæ‰§è¡Œçš„å‘½ä»¤</li>
</ul>
<p>è¯­æ³•:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker run --help</span></span><br><span class="line"></span><br><span class="line">Usage:  docker run [OPTIONS] IMAGE [COMMAND] [ARG...]</span><br><span class="line"></span><br><span class="line">Run a <span class="built_in">command</span> <span class="keyword">in</span> a new container</span><br></pre></td></tr></table></figure>

<h1 id="æ“ä½œå®¹å™¨"><a href="#æ“ä½œå®¹å™¨" class="headerlink" title="æ“ä½œå®¹å™¨"></a>æ“ä½œå®¹å™¨</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install dstat htop lsof curl wget lrzsz</span><br></pre></td></tr></table></figure>



<h2 id="é€€å‡ºç»ˆç«¯-é€€å‡ºå®¹å™¨"><a href="#é€€å‡ºç»ˆç«¯-é€€å‡ºå®¹å™¨" class="headerlink" title="é€€å‡ºç»ˆç«¯/é€€å‡ºå®¹å™¨"></a>é€€å‡ºç»ˆç«¯/é€€å‡ºå®¹å™¨</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@e4b1ccd2600b /]<span class="comment"># </span></span><br><span class="line">[root@e4b1ccd2600b /]<span class="comment"># exit</span></span><br><span class="line">root@ubuntu:~<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>éšç€ç»ˆç«¯çš„é€€å‡º, å®¹å™¨ä¹Ÿéšä¹‹é€€å‡º</p>
<hr>
<h1 id="å®¹å™¨æŒä¹…è¿è¡Œçš„æ¡ä»¶"><a href="#å®¹å™¨æŒä¹…è¿è¡Œçš„æ¡ä»¶" class="headerlink" title="å®¹å™¨æŒä¹…è¿è¡Œçš„æ¡ä»¶"></a>å®¹å™¨æŒä¹…è¿è¡Œçš„æ¡ä»¶</h1><p><strong>é˜»å¡!!!</strong></p>
<p>Docker å®¹å™¨æŒä¹…è¿è¡Œçš„åŸºæœ¬æ¡ä»¶æ˜¯-è¿›ç¨‹çš„é˜»å¡!</p>
<p>Docker çš„å“²å­¦ä¸­, ä¸»å¼ ä¸€ä¸ªå®¹å™¨åªå¯åŠ¨â€ä¸€ä¸ªè¿›ç¨‹â€, è¿™é‡Œçš„ä¸€ä¸ªè¿›ç¨‹å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªç¨‹åº æˆ–æ˜¯ä¸€ä¸ªä¸»è¿›ç¨‹, æ¯”å¦‚ä¸€ä¸ª Apache, ä¸€ä¸ª Apache å¯ä»¥å¯åŠ¨ä¸€ä¸ªä¸»è¿›ç¨‹å’Œè‹¥å¹²ä¸ªå­è¿›ç¨‹.</p>
<p>å¦‚æœæƒ³è®© Docker æŒä¹…åŒ–è¿è¡Œ, é‚£ä¹ˆåœ¨å®¹å™¨å¯åŠ¨æ—¶, å¿…é¡»æœ‰ä¸€ä¸ªè¿›ç¨‹é˜»å¡ä½ç»ˆç«¯. Docker åˆ¤æ–­å®¹å™¨å†…æœåŠ¡æ˜¯å¦æ­£å¸¸çš„æ–¹å¼å¾ˆç®€å•, å°±æ˜¯åˆ¤æ–­æœ€åé˜»å¡çš„è¿›ç¨‹æ˜¯å¦æŒ‚æ‰, å¦‚æœæœ€åé˜»å¡çš„è¿›ç¨‹æŒ‚æ‰, é‚£ä¹ˆå®¹å™¨é€€å‡º. </p>
<p>Docker è®¤ä¸º, å®¹å™¨å³æœåŠ¡, å®¹å™¨å³ç¨‹åº, ä¸€ä¸ªå®¹å™¨å°±æ˜¯ä¸€ä¸ªç¨‹åº, å¦‚æœä¸€ä¸ªå®¹å™¨å†…å¯åŠ¨äº†å¤šä¸ªæœåŠ¡, æ¯”å¦‚ A, B å’Œ CæœåŠ¡, C ä½œä¸ºæœ€åä¸€ä¸ªç¨‹åºé˜»å¡ä½å®¹å™¨ä½¿å…¶è¿è¡Œèµ·æ¥, æ­¤æ—¶, å¦‚æœå®¹å™¨å†…éƒ¨çš„ A æˆ– B æœåŠ¡æŒ‚æ‰, å®¹å™¨ä»ç„¶è®¤ä¸ºè‡ªå·±æ˜¯æ­£å¸¸çš„, å› ä¸º Docker åªå…³å¿ƒæœ€åé˜»å¡çš„è¿›ç¨‹æ˜¯å¦é€€å‡º. åä¹‹, A å’Œ B æœåŠ¡æ­£å¸¸, å¦‚æœ C æœåŠ¡æŒ‚æ‰, é‚£ä¹ˆåˆ™æ•´ä¸ªå®¹å™¨é€€å‡º!</p>
<hr>
<h1 id="åå°è¿è¡Œå®¹å™¨"><a href="#åå°è¿è¡Œå®¹å™¨" class="headerlink" title="åå°è¿è¡Œå®¹å™¨"></a>åå°è¿è¡Œå®¹å™¨</h1><h2 id="è·å–-nginx-é•œåƒ"><a href="#è·å–-nginx-é•œåƒ" class="headerlink" title="è·å– nginx é•œåƒ"></a>è·å– nginx é•œåƒ</h2><p><a href="https://hub.docker.com" target="_blank" rel="noopener">https://hub.docker.com</a></p>
<p>å³è¾¹æ˜¯æ‹‰å– nginx latest ç‰ˆæœ¬é•œåƒçš„å‘½ä»¤</p>
<p>å·¦è¾¹ repo info æ ‡ç­¾å†…æ˜¯ nginx ç®€çŸ­è¯´æ˜/å®Œæ•´è¯´æ˜</p>
<p>å®Œæ•´è¯´æ˜ä¸­åŒ…æ‹¬:</p>
<ul>
<li>ç‰ˆæœ¬çš„ä»‹ç»</li>
<li>è½¯ä»¶çš„ä»‹ç»</li>
<li>ä½¿ç”¨æ–¹å¼çš„ä»‹ç»</li>
</ul>
<p>å·¦è¾¹ tag æ˜¯æ‰€æœ‰ç‰ˆæœ¬çš„åˆ—è¡¨</p>
<p><a href="https://store.docker.com" target="_blank" rel="noopener">https://store.docker.com</a></p>
<h2 id="ä¸‹è½½æœ€æ–°ç¨³å®šå‘è¡Œç‰ˆçš„-nginx-é•œåƒ"><a href="#ä¸‹è½½æœ€æ–°ç¨³å®šå‘è¡Œç‰ˆçš„-nginx-é•œåƒ" class="headerlink" title="ä¸‹è½½æœ€æ–°ç¨³å®šå‘è¡Œç‰ˆçš„ nginx é•œåƒ"></a>ä¸‹è½½æœ€æ–°ç¨³å®šå‘è¡Œç‰ˆçš„ nginx é•œåƒ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker pull nginx</span></span><br><span class="line">Using default tag: latest</span><br><span class="line">latest: Pulling from library/nginx</span><br><span class="line">6d827a3ef358: Pull complete </span><br><span class="line">f8f2e0556751: Pull complete </span><br><span class="line">5c9972dca3fd: Pull complete </span><br><span class="line">451b9524cb06: Pull complete </span><br><span class="line">Digest: sha256:e6693c20186f837fc393390135d8a598a96a833917917789d63766cab6c59582</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> nginx:latest</span><br><span class="line">root@ubuntu:~<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<h2 id="è¿è¡Œ-nginx-é•œåƒ"><a href="#è¿è¡Œ-nginx-é•œåƒ" class="headerlink" title="è¿è¡Œ nginx é•œåƒ"></a>è¿è¡Œ nginx é•œåƒ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é¦–å…ˆåˆ›å»ºä¸€ä¸ª web ç›®å½•</span></span><br><span class="line">root@ubuntu:~<span class="comment"># mkdir web</span></span><br><span class="line">root@ubuntu:~<span class="comment"># echo "Hello Docker" &gt; web/index.html</span></span><br><span class="line"><span class="comment"># è¿è¡Œ nginx é•œåƒ</span></span><br><span class="line">root@ubuntu:~<span class="comment"># docker run --name "my-first-nginx" -v /root/web:/usr/share/nginx/html:ro -d nginx</span></span><br><span class="line">11610baab1ce0b684367a44313fc0401489b115399f0a4469bec15bd4b8f6769</span><br><span class="line">root@ubuntu:~<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES</span><br><span class="line">11610baab1ce        nginx               <span class="string">"nginx -g 'daemon ..."</span>   6 seconds ago       Up 6 seconds        80/tcp, 443/tcp     my-first-nginx</span><br><span class="line">root@ubuntu:~<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<ul>
<li>-v: æŒ‚è½½å·  <code>å®¿ä¸»æœºç›®å½•:å®¹å™¨å†…ç›®å½•:æŒ‚è½½æ–¹å¼</code>  å…¶ä¸­æŒ‚è½½æ–¹å¼æ”¯æŒä»¥åªè¯»<code>ro</code>æˆ–è¯»å†™<code>rw</code>æ–¹å¼æŒ‚è½½, é»˜è®¤ä¸º<code>rw</code></li>
<li>-d: ä»¥å®ˆæŠ¤è¿›ç¨‹<code>daemon</code>æ–¹å¼æ”¾å…¥åˆ°åå°è¿è¡Œ</li>
</ul>
<p>æ­¤æ–¹å¼æ²¡æœ‰å¯¹å¤–æ˜ å°„ç«¯å£, æ‰€ä»¥åªèƒ½åœ¨å®¹å™¨å†…éƒ¨è®¿é—®</p>
<h3 id="åœ¨å®¹å™¨å†…éƒ¨è®¿é—®é¡µé¢"><a href="#åœ¨å®¹å™¨å†…éƒ¨è®¿é—®é¡µé¢" class="headerlink" title="åœ¨å®¹å™¨å†…éƒ¨è®¿é—®é¡µé¢"></a>åœ¨å®¹å™¨å†…éƒ¨è®¿é—®é¡µé¢</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥å®¹å™¨</span></span><br><span class="line">root@ubuntu:~<span class="comment"># docker exec -it 11610 /bin/bash</span></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å‘½ä»¤æ˜¯å¦å®‰è£…</span></span><br><span class="line">root@11610baab1ce:/<span class="comment"># curl</span></span><br><span class="line">bash: curl: <span class="built_in">command</span> not found</span><br><span class="line"><span class="comment"># æŸ¥çœ‹å‘è¡Œç‰ˆ</span></span><br><span class="line">root@11610baab1ce:/<span class="comment"># cat /etc/issue</span></span><br><span class="line">Debian GNU/Linux 8 \n \l</span><br><span class="line"><span class="comment"># å®‰è£…å‘½ä»¤</span></span><br><span class="line">root@11610baab1ce:/<span class="comment"># apt install curl</span></span><br><span class="line"><span class="comment"># æµ‹è¯•é¡µé¢</span></span><br><span class="line">root@11610baab1ce:/<span class="comment"># curl http://127.0.0.1</span></span><br><span class="line">Hello Docker</span><br></pre></td></tr></table></figure>



<h2 id="è¿è¡Œæš´éœ²ç«¯å£çš„-nginx-é•œåƒ"><a href="#è¿è¡Œæš´éœ²ç«¯å£çš„-nginx-é•œåƒ" class="headerlink" title="è¿è¡Œæš´éœ²ç«¯å£çš„ nginx é•œåƒ"></a>è¿è¡Œæš´éœ²ç«¯å£çš„ nginx é•œåƒ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker run --name "my-second-nginx" -v /root/web:/usr/share/nginx/html:ro -d -p 8800:80 nginx</span></span><br><span class="line">d0a4936e940e5d3b9e2d96be3b08133ddb7f5d9f9a28a81e3b99dff03fb1d747</span><br><span class="line">root@ubuntu:~<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                           NAMES</span><br><span class="line">d0a4936e940e        nginx               <span class="string">"nginx -g 'daemon ..."</span>   3 seconds ago       Up 2 seconds        443/tcp, 0.0.0.0:8800-&gt;80/tcp   my-second-nginx</span><br><span class="line">11610baab1ce        nginx               <span class="string">"nginx -g 'daemon ..."</span>   12 minutes ago      Up 12 minutes       80/tcp, 443/tcp                 my-first-nginx</span><br><span class="line">root@ubuntu:~<span class="comment"># </span></span><br><span class="line">root@ubuntu:~<span class="comment"># curl http://127.0.0.1:8800</span></span><br><span class="line">Hello Docker</span><br></pre></td></tr></table></figure>

<ul>
<li>-p: å¯¹å¤–æ˜ å°„ç«¯å£ <code>å®¿ä¸»æœºç«¯å£:å®¹å™¨å†…ç«¯å£</code> </li>
</ul>
<h2 id="è¿è¡Œæš´éœ²å¤šä¸ªç«¯å£çš„-nginx-é•œåƒ"><a href="#è¿è¡Œæš´éœ²å¤šä¸ªç«¯å£çš„-nginx-é•œåƒ" class="headerlink" title="è¿è¡Œæš´éœ²å¤šä¸ªç«¯å£çš„ nginx é•œåƒ"></a>è¿è¡Œæš´éœ²å¤šä¸ªç«¯å£çš„ nginx é•œåƒ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker run --name "my-third-nginx" -v /root/web:/usr/share/nginx/html:ro -d -p 8080:80 -p 443:443 nginx</span></span><br><span class="line">b9704931408c6d054bc9c510878e10467a71d412bef065afa7414403982001b6</span><br><span class="line">root@ubuntu:~<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                        NAMES</span><br><span class="line">b9704931408c        nginx               <span class="string">"nginx -g 'daemon ..."</span>   6 seconds ago       Up 6 seconds        0.0.0.0:443-&gt;443/tcp, 0.0.0.0:8080-&gt;80/tcp   my-third-nginx</span><br><span class="line">d0a4936e940e        nginx               <span class="string">"nginx -g 'daemon ..."</span>   3 minutes ago       Up 3 minutes        443/tcp, 0.0.0.0:8800-&gt;80/tcp                my-second-nginx</span><br><span class="line">11610baab1ce        nginx               <span class="string">"nginx -g 'daemon ..."</span>   15 minutes ago      Up 15 minutes       80/tcp, 443/tcp                              my-first-nginx</span><br><span class="line">root@ubuntu:~<span class="comment">#</span></span><br></pre></td></tr></table></figure>



<h1 id="Docker-æ•°æ®å­˜å‚¨çš„å“²å­¦"><a href="#Docker-æ•°æ®å­˜å‚¨çš„å“²å­¦" class="headerlink" title="Docker æ•°æ®å­˜å‚¨çš„å“²å­¦"></a>Docker æ•°æ®å­˜å‚¨çš„å“²å­¦</h1><p>Docker ä¸»å¼ è¿è¡Œæ— çŠ¶æ€çš„å®¹å™¨, ä»€ä¹ˆæ ·çš„å®¹å™¨æ˜¯æ— çŠ¶æ€çš„å®¹å™¨å‘¢?</p>
<p>æ‰“ä¸ªæ¯”æ–¹: ä»¥ä¸Šé¢çš„ nginx å®ä¾‹ä¸ºä¾‹</p>
<ul>
<li>ä»¥å¦‚ä¸Šæ–¹å¼<code>-v</code>æŒ‚è½½çš„æ–¹å¼å³ä¸ºæœ‰çŠ¶æ€</li>
<li>ä»¥ dockerfile çš„å½¢å¼å°†æ•°æ®ç›®å½•é¢„å…ˆæ‹·è´åˆ°é•œåƒçš„æ–¹å¼å³ä¸ºæ— çŠ¶æ€</li>
</ul>
<p>ä¹Ÿå¯ä»¥ç®€å•çš„ç†è§£ä¸º: </p>
<ul>
<li>é•œåƒå†…åŒ…å«æ•°æ®ä¸”æ•°æ®å¯éšæ—¶éšç€é•œåƒé”€æ¯çš„å®¹å™¨ä¸ºæ— çŠ¶æ€å®¹å™¨</li>
<li>é•œåƒå†…åªåŒ…å«è¿è¡Œç¯å¢ƒ, æ•°æ®éœ€è¦é æŒ‚è½½ç›®å½•çš„, æˆ–æ˜¯å®¹å™¨å†…æ•°æ®ä¸å¯éšæ„é”€æ¯çš„å®¹å™¨ä¸ºæœ‰çŠ¶æ€å®¹å™¨</li>
</ul>
<p>è¿™ä¸¤ç§ç”¨æ³•å„æœ‰åˆ©å¼Š, ç›´è‡³ç°åœ¨ä¹Ÿäº‰è®ºä¸ä¼‘, æ²¡æœ‰æœ€å¥½çš„ä½¿ç”¨æ–¹å¼, åªæœ‰æœ€åˆé€‚çš„ä½¿ç”¨æ–¹å¼(æ³¨æ„: åœ¨é›†ç¾¤ä¸­, æœ€å¥½ä½¿ç”¨æ— çŠ¶æ€çš„æ–¹å¼. ä½†æ˜¯æœ€æ–°ç‰ˆæœ¬çš„ k8s å·²ç»æ”¯æŒæœ‰çŠ¶æ€å®¹å™¨é›†ç¾¤)</p>
<h1 id="Docker-ä½¿ç”¨çš„å“²å­¦"><a href="#Docker-ä½¿ç”¨çš„å“²å­¦" class="headerlink" title="Docker ä½¿ç”¨çš„å“²å­¦"></a>Docker ä½¿ç”¨çš„å“²å­¦</h1><p>ç”±äº Docker å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸå®Œå…¨å–å†³äºæœ€åé˜»å¡å®¹å™¨å…¥å£çš„è¿›ç¨‹çš„å­˜æ´»çŠ¶æ€, æ‰€ä»¥åœ¨ä½¿ç”¨å®¹å™¨çš„æ—¶å€™, ä¸€å®šè¦å¤šåŠ æ³¨æ„é˜»å¡å…¥å£çš„è¿›ç¨‹å’Œä¸»è¿›ç¨‹çš„å…³ç³». æ¯”å¦‚ node.js å®¹å™¨, åœ¨é‡Œé¢ä½¿ç”¨pm2 ç®¡ç†çš„ node é¡¹ç›®, æœ€åé˜»å¡å…¥å£çš„è¿›ç¨‹æ˜¯ pm2, é‚£ä¹ˆé‡Œé¢ node é¡¹ç›®çš„ç®¡ç†å°±è„±ç¦»äº†å®¹å™¨çš„æ§åˆ¶, è€Œç”± pm2 å»æ¥ç®¡, åœ¨node è¿›ç¨‹å‡ºé—®é¢˜æ—¶ä¹Ÿæ˜¯ç”±pm2å»æ§åˆ¶é‡å¯çš„. åœ¨å®é™…ä½¿ç”¨æƒ…å†µä¸­, ä¸€å®šè¦æ³¨æ„è¿™æ ·çš„ä½¿ç”¨æ–¹å¼ä¼šä¸ä¼šå¯¹åç»­çš„ç»´æŠ¤é€ æˆä¸ä¾¿. æˆ‘æ¨èä½¿ç”¨åŸç”Ÿçš„å‘½ä»¤å¯åŠ¨ä¸»è¿›ç¨‹, ä¸è¦åœ¨ä¸»è¿›ç¨‹å¤–é¢å†å¥—ä¸€å±‚ç¨‹åºç®¡ç†å±‚.</p>

      
    </div>

    
    
    
      

      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://docs.lvrui.io/2017/04/15/Docker%E5%88%9D%E4%BD%93%E9%AA%8C%203/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.JPG">
      <meta itemprop="name" content="æåœ°ç‘é›ª">
      <meta itemprop="description" content="æåœ°ç‘é›ªçš„ä¸ªäººæŠ€æœ¯åšå®¢. "å–ä¹‹å¼€æº ç”¨ä¹‹å¼€æº", åˆ†äº«è‡ªå·±çš„ç»éªŒä¹‹è°ˆ".">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Polar Snow Documentation">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/04/15/Docker%E5%88%9D%E4%BD%93%E9%AA%8C%203/" class="post-title-link" itemprop="url">Dockeråˆä½“éªŒ</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2017-04-15 10:44:04" itemprop="dateCreated datePublished" datetime="2017-04-15T10:44:04+08:00">2017-04-15</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Docker/" itemprop="url" rel="index"><span itemprop="name">Docker</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqusï¼š</span>
    
    <a title="disqus" href="/2017/04/15/Docker%E5%88%9D%E4%BD%93%E9%AA%8C%203/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/04/15/Dockeråˆä½“éªŒ 3/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<ul>
<li>bash å‰å°è¿è¡Œ</li>
<li>å®¹å™¨æŒä¹…è¿è¡Œçš„æ¡ä»¶</li>
<li>nginx åå°è¿è¡Œ</li>
<li>åå°è¿è¡Œçš„æ¡ä»¶</li>
<li>Dockeræ•°æ®å­˜å‚¨çš„å“²å­¦</li>
<li>Dockerä½¿ç”¨çš„å“²å­¦</li>
</ul>
</blockquote>
<h1 id="å‰å°è¿è¡Œå®¹å™¨"><a href="#å‰å°è¿è¡Œå®¹å™¨" class="headerlink" title="å‰å°è¿è¡Œå®¹å™¨"></a>å‰å°è¿è¡Œå®¹å™¨</h1><h2 id="æ‹‰å–-centos-é•œåƒ"><a href="#æ‹‰å–-centos-é•œåƒ" class="headerlink" title="æ‹‰å– centos é•œåƒ"></a>æ‹‰å– centos é•œåƒ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker pull centos</span></span><br><span class="line">Using default tag: latest</span><br><span class="line">latest: Pulling from library/centos</span><br><span class="line">93857f76ae30: Pull complete </span><br><span class="line">Digest: sha256:4eda692c08e0a065ae91d74e82fff4af3da307b4341ad61fa61771cc4659af60</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> centos:latest</span><br></pre></td></tr></table></figure>

<h2 id="æŸ¥çœ‹é•œåƒåˆ—è¡¨"><a href="#æŸ¥çœ‹é•œåƒåˆ—è¡¨" class="headerlink" title="æŸ¥çœ‹é•œåƒåˆ—è¡¨"></a>æŸ¥çœ‹é•œåƒåˆ—è¡¨</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">centos              latest              a8493f5f50ff        33 hours ago        192MB</span><br><span class="line">nginx               latest              5766334bdaa0        37 hours ago        183MB</span><br><span class="line">hello-world         latest              48b5124b2768        2 months ago        1.84kB</span><br></pre></td></tr></table></figure>

<h2 id="ä»¥å‰å°è¿è¡Œæ–¹å¼è¿è¡Œå®¹å™¨"><a href="#ä»¥å‰å°è¿è¡Œæ–¹å¼è¿è¡Œå®¹å™¨" class="headerlink" title="ä»¥å‰å°è¿è¡Œæ–¹å¼è¿è¡Œå®¹å™¨"></a>ä»¥å‰å°è¿è¡Œæ–¹å¼è¿è¡Œå®¹å™¨</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker run --name "mycentos" -it centos /bin/bash</span></span><br><span class="line">[root@e4b1ccd2600b /]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<ul>
<li>run: è¿è¡Œä¸€ä¸ªå®¹å™¨</li>
<li>â€”name â€œmycentosâ€: ç»™å®¹å™¨å‘½å</li>
<li>-i: æ‰“å¼€å®¹å™¨çš„æ ‡å‡†è¾“å…¥</li>
<li>-t: åˆ†é…ä¸€ä¸ªä¼ªç»ˆç«¯ tty</li>
<li>centos: é•œåƒå</li>
<li>è¿è¡Œå®¹å™¨åæ‰§è¡Œçš„å‘½ä»¤</li>
</ul>
<p>è¯­æ³•:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker run --help</span></span><br><span class="line"></span><br><span class="line">Usage:  docker run [OPTIONS] IMAGE [COMMAND] [ARG...]</span><br><span class="line"></span><br><span class="line">Run a <span class="built_in">command</span> <span class="keyword">in</span> a new container</span><br></pre></td></tr></table></figure>

<h1 id="æ“ä½œå®¹å™¨"><a href="#æ“ä½œå®¹å™¨" class="headerlink" title="æ“ä½œå®¹å™¨"></a>æ“ä½œå®¹å™¨</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install dstat htop lsof curl wget lrzsz</span><br></pre></td></tr></table></figure>



<h2 id="é€€å‡ºç»ˆç«¯-é€€å‡ºå®¹å™¨"><a href="#é€€å‡ºç»ˆç«¯-é€€å‡ºå®¹å™¨" class="headerlink" title="é€€å‡ºç»ˆç«¯/é€€å‡ºå®¹å™¨"></a>é€€å‡ºç»ˆç«¯/é€€å‡ºå®¹å™¨</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@e4b1ccd2600b /]<span class="comment"># </span></span><br><span class="line">[root@e4b1ccd2600b /]<span class="comment"># exit</span></span><br><span class="line">root@ubuntu:~<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>éšç€ç»ˆç«¯çš„é€€å‡º, å®¹å™¨ä¹Ÿéšä¹‹é€€å‡º</p>
<hr>
<h1 id="å®¹å™¨æŒä¹…è¿è¡Œçš„æ¡ä»¶"><a href="#å®¹å™¨æŒä¹…è¿è¡Œçš„æ¡ä»¶" class="headerlink" title="å®¹å™¨æŒä¹…è¿è¡Œçš„æ¡ä»¶"></a>å®¹å™¨æŒä¹…è¿è¡Œçš„æ¡ä»¶</h1><p><strong>é˜»å¡!!!</strong></p>
<p>Docker å®¹å™¨æŒä¹…è¿è¡Œçš„åŸºæœ¬æ¡ä»¶æ˜¯-è¿›ç¨‹çš„é˜»å¡!</p>
<p>Docker çš„å“²å­¦ä¸­, ä¸»å¼ ä¸€ä¸ªå®¹å™¨åªå¯åŠ¨â€ä¸€ä¸ªè¿›ç¨‹â€, è¿™é‡Œçš„ä¸€ä¸ªè¿›ç¨‹å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªç¨‹åº æˆ–æ˜¯ä¸€ä¸ªä¸»è¿›ç¨‹, æ¯”å¦‚ä¸€ä¸ª Apache, ä¸€ä¸ª Apache å¯ä»¥å¯åŠ¨ä¸€ä¸ªä¸»è¿›ç¨‹å’Œè‹¥å¹²ä¸ªå­è¿›ç¨‹.</p>
<p>å¦‚æœæƒ³è®© Docker æŒä¹…åŒ–è¿è¡Œ, é‚£ä¹ˆåœ¨å®¹å™¨å¯åŠ¨æ—¶, å¿…é¡»æœ‰ä¸€ä¸ªè¿›ç¨‹é˜»å¡ä½ç»ˆç«¯. Docker åˆ¤æ–­å®¹å™¨å†…æœåŠ¡æ˜¯å¦æ­£å¸¸çš„æ–¹å¼å¾ˆç®€å•, å°±æ˜¯åˆ¤æ–­æœ€åé˜»å¡çš„è¿›ç¨‹æ˜¯å¦æŒ‚æ‰, å¦‚æœæœ€åé˜»å¡çš„è¿›ç¨‹æŒ‚æ‰, é‚£ä¹ˆå®¹å™¨é€€å‡º. </p>
<p>Docker è®¤ä¸º, å®¹å™¨å³æœåŠ¡, å®¹å™¨å³ç¨‹åº, ä¸€ä¸ªå®¹å™¨å°±æ˜¯ä¸€ä¸ªç¨‹åº, å¦‚æœä¸€ä¸ªå®¹å™¨å†…å¯åŠ¨äº†å¤šä¸ªæœåŠ¡, æ¯”å¦‚ A, B å’Œ CæœåŠ¡, C ä½œä¸ºæœ€åä¸€ä¸ªç¨‹åºé˜»å¡ä½å®¹å™¨ä½¿å…¶è¿è¡Œèµ·æ¥, æ­¤æ—¶, å¦‚æœå®¹å™¨å†…éƒ¨çš„ A æˆ– B æœåŠ¡æŒ‚æ‰, å®¹å™¨ä»ç„¶è®¤ä¸ºè‡ªå·±æ˜¯æ­£å¸¸çš„, å› ä¸º Docker åªå…³å¿ƒæœ€åé˜»å¡çš„è¿›ç¨‹æ˜¯å¦é€€å‡º. åä¹‹, A å’Œ B æœåŠ¡æ­£å¸¸, å¦‚æœ C æœåŠ¡æŒ‚æ‰, é‚£ä¹ˆåˆ™æ•´ä¸ªå®¹å™¨é€€å‡º!</p>
<hr>
<h1 id="åå°è¿è¡Œå®¹å™¨"><a href="#åå°è¿è¡Œå®¹å™¨" class="headerlink" title="åå°è¿è¡Œå®¹å™¨"></a>åå°è¿è¡Œå®¹å™¨</h1><h2 id="è·å–-nginx-é•œåƒ"><a href="#è·å–-nginx-é•œåƒ" class="headerlink" title="è·å– nginx é•œåƒ"></a>è·å– nginx é•œåƒ</h2><p><a href="https://hub.docker.com" target="_blank" rel="noopener">https://hub.docker.com</a></p>
<p>å³è¾¹æ˜¯æ‹‰å– nginx latest ç‰ˆæœ¬é•œåƒçš„å‘½ä»¤</p>
<p>å·¦è¾¹ repo info æ ‡ç­¾å†…æ˜¯ nginx ç®€çŸ­è¯´æ˜/å®Œæ•´è¯´æ˜</p>
<p>å®Œæ•´è¯´æ˜ä¸­åŒ…æ‹¬:</p>
<ul>
<li>ç‰ˆæœ¬çš„ä»‹ç»</li>
<li>è½¯ä»¶çš„ä»‹ç»</li>
<li>ä½¿ç”¨æ–¹å¼çš„ä»‹ç»</li>
</ul>
<p>å·¦è¾¹ tag æ˜¯æ‰€æœ‰ç‰ˆæœ¬çš„åˆ—è¡¨</p>
<p><a href="https://store.docker.com" target="_blank" rel="noopener">https://store.docker.com</a></p>
<h2 id="ä¸‹è½½æœ€æ–°ç¨³å®šå‘è¡Œç‰ˆçš„-nginx-é•œåƒ"><a href="#ä¸‹è½½æœ€æ–°ç¨³å®šå‘è¡Œç‰ˆçš„-nginx-é•œåƒ" class="headerlink" title="ä¸‹è½½æœ€æ–°ç¨³å®šå‘è¡Œç‰ˆçš„ nginx é•œåƒ"></a>ä¸‹è½½æœ€æ–°ç¨³å®šå‘è¡Œç‰ˆçš„ nginx é•œåƒ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker pull nginx</span></span><br><span class="line">Using default tag: latest</span><br><span class="line">latest: Pulling from library/nginx</span><br><span class="line">6d827a3ef358: Pull complete </span><br><span class="line">f8f2e0556751: Pull complete </span><br><span class="line">5c9972dca3fd: Pull complete </span><br><span class="line">451b9524cb06: Pull complete </span><br><span class="line">Digest: sha256:e6693c20186f837fc393390135d8a598a96a833917917789d63766cab6c59582</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> nginx:latest</span><br><span class="line">root@ubuntu:~<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<h2 id="è¿è¡Œ-nginx-é•œåƒ"><a href="#è¿è¡Œ-nginx-é•œåƒ" class="headerlink" title="è¿è¡Œ nginx é•œåƒ"></a>è¿è¡Œ nginx é•œåƒ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é¦–å…ˆåˆ›å»ºä¸€ä¸ª web ç›®å½•</span></span><br><span class="line">root@ubuntu:~<span class="comment"># mkdir web</span></span><br><span class="line">root@ubuntu:~<span class="comment"># echo "Hello Docker" &gt; web/index.html</span></span><br><span class="line"><span class="comment"># è¿è¡Œ nginx é•œåƒ</span></span><br><span class="line">root@ubuntu:~<span class="comment"># docker run --name "my-first-nginx" -v /root/web:/usr/share/nginx/html:ro -d nginx</span></span><br><span class="line">11610baab1ce0b684367a44313fc0401489b115399f0a4469bec15bd4b8f6769</span><br><span class="line">root@ubuntu:~<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES</span><br><span class="line">11610baab1ce        nginx               <span class="string">"nginx -g 'daemon ..."</span>   6 seconds ago       Up 6 seconds        80/tcp, 443/tcp     my-first-nginx</span><br><span class="line">root@ubuntu:~<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<ul>
<li>-v: æŒ‚è½½å·  <code>å®¿ä¸»æœºç›®å½•:å®¹å™¨å†…ç›®å½•:æŒ‚è½½æ–¹å¼</code>  å…¶ä¸­æŒ‚è½½æ–¹å¼æ”¯æŒä»¥åªè¯»<code>ro</code>æˆ–è¯»å†™<code>rw</code>æ–¹å¼æŒ‚è½½, é»˜è®¤ä¸º<code>rw</code></li>
<li>-d: ä»¥å®ˆæŠ¤è¿›ç¨‹<code>daemon</code>æ–¹å¼æ”¾å…¥åˆ°åå°è¿è¡Œ</li>
</ul>
<p>æ­¤æ–¹å¼æ²¡æœ‰å¯¹å¤–æ˜ å°„ç«¯å£, æ‰€ä»¥åªèƒ½åœ¨å®¹å™¨å†…éƒ¨è®¿é—®</p>
<h3 id="åœ¨å®¹å™¨å†…éƒ¨è®¿é—®é¡µé¢"><a href="#åœ¨å®¹å™¨å†…éƒ¨è®¿é—®é¡µé¢" class="headerlink" title="åœ¨å®¹å™¨å†…éƒ¨è®¿é—®é¡µé¢"></a>åœ¨å®¹å™¨å†…éƒ¨è®¿é—®é¡µé¢</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥å®¹å™¨</span></span><br><span class="line">root@ubuntu:~<span class="comment"># docker exec -it 11610 /bin/bash</span></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å‘½ä»¤æ˜¯å¦å®‰è£…</span></span><br><span class="line">root@11610baab1ce:/<span class="comment"># curl</span></span><br><span class="line">bash: curl: <span class="built_in">command</span> not found</span><br><span class="line"><span class="comment"># æŸ¥çœ‹å‘è¡Œç‰ˆ</span></span><br><span class="line">root@11610baab1ce:/<span class="comment"># cat /etc/issue</span></span><br><span class="line">Debian GNU/Linux 8 \n \l</span><br><span class="line"><span class="comment"># å®‰è£…å‘½ä»¤</span></span><br><span class="line">root@11610baab1ce:/<span class="comment"># apt install curl</span></span><br><span class="line"><span class="comment"># æµ‹è¯•é¡µé¢</span></span><br><span class="line">root@11610baab1ce:/<span class="comment"># curl http://127.0.0.1</span></span><br><span class="line">Hello Docker</span><br></pre></td></tr></table></figure>



<h2 id="è¿è¡Œæš´éœ²ç«¯å£çš„-nginx-é•œåƒ"><a href="#è¿è¡Œæš´éœ²ç«¯å£çš„-nginx-é•œåƒ" class="headerlink" title="è¿è¡Œæš´éœ²ç«¯å£çš„ nginx é•œåƒ"></a>è¿è¡Œæš´éœ²ç«¯å£çš„ nginx é•œåƒ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker run --name "my-second-nginx" -v /root/web:/usr/share/nginx/html:ro -d -p 8800:80 nginx</span></span><br><span class="line">d0a4936e940e5d3b9e2d96be3b08133ddb7f5d9f9a28a81e3b99dff03fb1d747</span><br><span class="line">root@ubuntu:~<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                           NAMES</span><br><span class="line">d0a4936e940e        nginx               <span class="string">"nginx -g 'daemon ..."</span>   3 seconds ago       Up 2 seconds        443/tcp, 0.0.0.0:8800-&gt;80/tcp   my-second-nginx</span><br><span class="line">11610baab1ce        nginx               <span class="string">"nginx -g 'daemon ..."</span>   12 minutes ago      Up 12 minutes       80/tcp, 443/tcp                 my-first-nginx</span><br><span class="line">root@ubuntu:~<span class="comment"># </span></span><br><span class="line">root@ubuntu:~<span class="comment"># curl http://127.0.0.1:8800</span></span><br><span class="line">Hello Docker</span><br></pre></td></tr></table></figure>

<ul>
<li>-p: å¯¹å¤–æ˜ å°„ç«¯å£ <code>å®¿ä¸»æœºç«¯å£:å®¹å™¨å†…ç«¯å£</code> </li>
</ul>
<h2 id="è¿è¡Œæš´éœ²å¤šä¸ªç«¯å£çš„-nginx-é•œåƒ"><a href="#è¿è¡Œæš´éœ²å¤šä¸ªç«¯å£çš„-nginx-é•œåƒ" class="headerlink" title="è¿è¡Œæš´éœ²å¤šä¸ªç«¯å£çš„ nginx é•œåƒ"></a>è¿è¡Œæš´éœ²å¤šä¸ªç«¯å£çš„ nginx é•œåƒ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker run --name "my-third-nginx" -v /root/web:/usr/share/nginx/html:ro -d -p 8080:80 -p 443:443 nginx</span></span><br><span class="line">b9704931408c6d054bc9c510878e10467a71d412bef065afa7414403982001b6</span><br><span class="line">root@ubuntu:~<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                        NAMES</span><br><span class="line">b9704931408c        nginx               <span class="string">"nginx -g 'daemon ..."</span>   6 seconds ago       Up 6 seconds        0.0.0.0:443-&gt;443/tcp, 0.0.0.0:8080-&gt;80/tcp   my-third-nginx</span><br><span class="line">d0a4936e940e        nginx               <span class="string">"nginx -g 'daemon ..."</span>   3 minutes ago       Up 3 minutes        443/tcp, 0.0.0.0:8800-&gt;80/tcp                my-second-nginx</span><br><span class="line">11610baab1ce        nginx               <span class="string">"nginx -g 'daemon ..."</span>   15 minutes ago      Up 15 minutes       80/tcp, 443/tcp                              my-first-nginx</span><br><span class="line">root@ubuntu:~<span class="comment">#</span></span><br></pre></td></tr></table></figure>



<h1 id="Docker-æ•°æ®å­˜å‚¨çš„å“²å­¦"><a href="#Docker-æ•°æ®å­˜å‚¨çš„å“²å­¦" class="headerlink" title="Docker æ•°æ®å­˜å‚¨çš„å“²å­¦"></a>Docker æ•°æ®å­˜å‚¨çš„å“²å­¦</h1><p>Docker ä¸»å¼ è¿è¡Œæ— çŠ¶æ€çš„å®¹å™¨, ä»€ä¹ˆæ ·çš„å®¹å™¨æ˜¯æ— çŠ¶æ€çš„å®¹å™¨å‘¢?</p>
<p>æ‰“ä¸ªæ¯”æ–¹: ä»¥ä¸Šé¢çš„ nginx å®ä¾‹ä¸ºä¾‹</p>
<ul>
<li>ä»¥å¦‚ä¸Šæ–¹å¼<code>-v</code>æŒ‚è½½çš„æ–¹å¼å³ä¸ºæœ‰çŠ¶æ€</li>
<li>ä»¥ dockerfile çš„å½¢å¼å°†æ•°æ®ç›®å½•é¢„å…ˆæ‹·è´åˆ°é•œåƒçš„æ–¹å¼å³ä¸ºæ— çŠ¶æ€</li>
</ul>
<p>ä¹Ÿå¯ä»¥ç®€å•çš„ç†è§£ä¸º: </p>
<ul>
<li>é•œåƒå†…åŒ…å«æ•°æ®ä¸”æ•°æ®å¯éšæ—¶éšç€é•œåƒé”€æ¯çš„å®¹å™¨ä¸ºæ— çŠ¶æ€å®¹å™¨</li>
<li>é•œåƒå†…åªåŒ…å«è¿è¡Œç¯å¢ƒ, æ•°æ®éœ€è¦é æŒ‚è½½ç›®å½•çš„, æˆ–æ˜¯å®¹å™¨å†…æ•°æ®ä¸å¯éšæ„é”€æ¯çš„å®¹å™¨ä¸ºæœ‰çŠ¶æ€å®¹å™¨</li>
</ul>
<p>è¿™ä¸¤ç§ç”¨æ³•å„æœ‰åˆ©å¼Š, ç›´è‡³ç°åœ¨ä¹Ÿäº‰è®ºä¸ä¼‘, æ²¡æœ‰æœ€å¥½çš„ä½¿ç”¨æ–¹å¼, åªæœ‰æœ€åˆé€‚çš„ä½¿ç”¨æ–¹å¼(æ³¨æ„: åœ¨é›†ç¾¤ä¸­, æœ€å¥½ä½¿ç”¨æ— çŠ¶æ€çš„æ–¹å¼. ä½†æ˜¯æœ€æ–°ç‰ˆæœ¬çš„ k8s å·²ç»æ”¯æŒæœ‰çŠ¶æ€å®¹å™¨é›†ç¾¤)</p>
<h1 id="Docker-ä½¿ç”¨çš„å“²å­¦"><a href="#Docker-ä½¿ç”¨çš„å“²å­¦" class="headerlink" title="Docker ä½¿ç”¨çš„å“²å­¦"></a>Docker ä½¿ç”¨çš„å“²å­¦</h1><p>ç”±äº Docker å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸå®Œå…¨å–å†³äºæœ€åé˜»å¡å®¹å™¨å…¥å£çš„è¿›ç¨‹çš„å­˜æ´»çŠ¶æ€, æ‰€ä»¥åœ¨ä½¿ç”¨å®¹å™¨çš„æ—¶å€™, ä¸€å®šè¦å¤šåŠ æ³¨æ„é˜»å¡å…¥å£çš„è¿›ç¨‹å’Œä¸»è¿›ç¨‹çš„å…³ç³». æ¯”å¦‚ node.js å®¹å™¨, åœ¨é‡Œé¢ä½¿ç”¨pm2 ç®¡ç†çš„ node é¡¹ç›®, æœ€åé˜»å¡å…¥å£çš„è¿›ç¨‹æ˜¯ pm2, é‚£ä¹ˆé‡Œé¢ node é¡¹ç›®çš„ç®¡ç†å°±è„±ç¦»äº†å®¹å™¨çš„æ§åˆ¶, è€Œç”± pm2 å»æ¥ç®¡, åœ¨node è¿›ç¨‹å‡ºé—®é¢˜æ—¶ä¹Ÿæ˜¯ç”±pm2å»æ§åˆ¶é‡å¯çš„. åœ¨å®é™…ä½¿ç”¨æƒ…å†µä¸­, ä¸€å®šè¦æ³¨æ„è¿™æ ·çš„ä½¿ç”¨æ–¹å¼ä¼šä¸ä¼šå¯¹åç»­çš„ç»´æŠ¤é€ æˆä¸ä¾¿. æˆ‘æ¨èä½¿ç”¨åŸç”Ÿçš„å‘½ä»¤å¯åŠ¨ä¸»è¿›ç¨‹, ä¸è¦åœ¨ä¸»è¿›ç¨‹å¤–é¢å†å¥—ä¸€å±‚ç¨‹åºç®¡ç†å±‚.</p>

      
    </div>

    
    
    
      

      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://docs.lvrui.io/2017/04/15/%E5%BF%AB%E9%80%9F%E5%AE%89%E8%A3%85Docker/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.JPG">
      <meta itemprop="name" content="æåœ°ç‘é›ª">
      <meta itemprop="description" content="æåœ°ç‘é›ªçš„ä¸ªäººæŠ€æœ¯åšå®¢. "å–ä¹‹å¼€æº ç”¨ä¹‹å¼€æº", åˆ†äº«è‡ªå·±çš„ç»éªŒä¹‹è°ˆ".">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Polar Snow Documentation">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/04/15/%E5%BF%AB%E9%80%9F%E5%AE%89%E8%A3%85Docker/" class="post-title-link" itemprop="url">å¿«é€Ÿå®‰è£…Docker</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2017-04-15 10:43:38" itemprop="dateCreated datePublished" datetime="2017-04-15T10:43:38+08:00">2017-04-15</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Docker/" itemprop="url" rel="index"><span itemprop="name">Docker</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqusï¼š</span>
    
    <a title="disqus" href="/2017/04/15/%E5%BF%AB%E9%80%9F%E5%AE%89%E8%A3%85Docker/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/04/15/å¿«é€Ÿå®‰è£…Docker/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="å®‰è£…å‘½ä»¤"><a href="#å®‰è£…å‘½ä»¤" class="headerlink" title="å®‰è£…å‘½ä»¤"></a>å®‰è£…å‘½ä»¤</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># å…¬ç½‘é€šç”¨</span></span><br><span class="line">curl -sSL http://acs-public-mirror.oss-cn-hangzhou.aliyuncs.com/docker-engine/internet | sh -</span><br><span class="line"></span><br><span class="line"><span class="comment"># é˜¿é‡Œäº‘ä¸“ç”¨</span></span><br><span class="line">curl -sSL http://acs-public-mirror.oss-cn-hangzhou.aliyuncs.com/docker-engine/intranet | sh -</span><br></pre></td></tr></table></figure>



<h1 id="å®‰è£…å®Œæˆåçš„ç»“æŸä¿¡æ¯"><a href="#å®‰è£…å®Œæˆåçš„ç»“æŸä¿¡æ¯" class="headerlink" title="å®‰è£…å®Œæˆåçš„ç»“æŸä¿¡æ¯:"></a>å®‰è£…å®Œæˆåçš„ç»“æŸä¿¡æ¯:</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># curl -sSL http://acs-public-mirror.oss-cn-hangzhou.aliyuncs.com/docker-engine/internet | sh -</span></span><br><span class="line">......</span><br><span class="line">......</span><br><span class="line">+ sh -c docker version</span><br><span class="line">Client:</span><br><span class="line"> Version:      17.04.0-ce</span><br><span class="line"> API version:  1.28</span><br><span class="line"> Go version:   go1.7.5</span><br><span class="line"> Git commit:   4845c56</span><br><span class="line"> Built:        Mon Apr  3 18:07:42 2017</span><br><span class="line"> OS/Arch:      linux/amd64</span><br><span class="line"></span><br><span class="line">Server:</span><br><span class="line"> Version:      17.04.0-ce</span><br><span class="line"> API version:  1.28 (minimum version 1.12)</span><br><span class="line"> Go version:   go1.7.5</span><br><span class="line"> Git commit:   4845c56</span><br><span class="line"> Built:        Mon Apr  3 18:07:42 2017</span><br><span class="line"> OS/Arch:      linux/amd64</span><br><span class="line"> Experimental: <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">If you would like to use Docker as a non-root user, you should now consider</span><br><span class="line">adding your user to the <span class="string">"docker"</span> group with something like:</span><br><span class="line"></span><br><span class="line">  sudo usermod -aG docker your-user</span><br><span class="line"></span><br><span class="line">Remember that you will have to <span class="built_in">log</span> out and back <span class="keyword">in</span> <span class="keyword">for</span> this to take effect!</span><br></pre></td></tr></table></figure>

<p>é‡ç‚¹æ³¨æ„: <code>sudo usermod -aG docker your-user</code></p>
<p>åœ¨ Ubuntu ç³»ç»Ÿä¸­, ä½¿ç”¨æ™®é€šç”¨æˆ·ç™»å½•çš„æƒ…å†µå¾ˆå¤š, å¦‚æœæ™®é€šç”¨æˆ·éœ€è¦ç›´æ¥æœ‰æƒé™æ§åˆ¶ docker æ‰€æœ‰çš„æ“ä½œçš„è¯, éœ€è¦å°†è¯¥æ™®é€šç”¨æˆ·åŠ å…¥åˆ° docker ç»„ä¸­.</p>
<p>Docker æ˜¯ C/S æ¶æ„, ä¸€èˆ¬æƒ…å†µä¸‹, C å’Œ S æ˜¯åœ¨å®‰è£…åœ¨ä¸€å°ä¸»æœºä¸Šçš„, æœ¬åœ°çš„ C æ§åˆ¶æœ¬åœ°çš„ S, åæœŸæ§åˆ¶å¤§è§„æ¨¡ Docker çš„æ—¶å€™, éœ€è¦å¼€æ”¾Docker API æ¥è¿œç¨‹æ§åˆ¶ Docker Server ç«¯</p>
<h1 id="æ£€æŸ¥-Docker-è¿è¡ŒçŠ¶æ€"><a href="#æ£€æŸ¥-Docker-è¿è¡ŒçŠ¶æ€" class="headerlink" title="æ£€æŸ¥ Docker è¿è¡ŒçŠ¶æ€"></a>æ£€æŸ¥ Docker è¿è¡ŒçŠ¶æ€</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># systemctl status docker</span></span><br><span class="line">â— docker.service - Docker Application Container Engine</span><br><span class="line">   Loaded: loaded (/lib/systemd/system/docker.service; enabled; vendor preset: enabled)</span><br><span class="line">   Active: active (running) since Fri 2017-04-07 20:43:48 PDT; 9min ago</span><br><span class="line">     Docs: https://docs.docker.com</span><br><span class="line"> Main PID: 4082 (dockerd)</span><br><span class="line">   CGroup: /system.slice/docker.service</span><br><span class="line">           â”œâ”€4082 /usr/bin/dockerd -H fd://</span><br><span class="line">           â””â”€4095 docker-containerd -l unix:///var/run/docker/libcontainerd/docker-containerd.sock --metri</span><br><span class="line"></span><br><span class="line">Apr 07 20:43:48 ubuntu dockerd[4082]: time=<span class="string">"2017-04-07T20:43:48.175051418-07:00"</span> level=warning msg=<span class="string">"Your k</span></span><br><span class="line"><span class="string">Apr 07 20:43:48 ubuntu dockerd[4082]: time="</span>2017-04-07T20:43:48.175185511-07:00<span class="string">" level=warning msg="</span>Your k</span><br><span class="line">Apr 07 20:43:48 ubuntu dockerd[4082]: time=<span class="string">"2017-04-07T20:43:48.175683715-07:00"</span> level=info msg=<span class="string">"Loading c</span></span><br><span class="line"><span class="string">Apr 07 20:43:48 ubuntu dockerd[4082]: time="</span>2017-04-07T20:43:48.228757745-07:00<span class="string">" level=info msg="</span>Firewalld</span><br><span class="line">Apr 07 20:43:48 ubuntu dockerd[4082]: time=<span class="string">"2017-04-07T20:43:48.327388388-07:00"</span> level=info msg=<span class="string">"Default b</span></span><br><span class="line"><span class="string">Apr 07 20:43:48 ubuntu dockerd[4082]: time="</span>2017-04-07T20:43:48.383792709-07:00<span class="string">" level=info msg="</span>Loading c</span><br><span class="line">Apr 07 20:43:48 ubuntu dockerd[4082]: time=<span class="string">"2017-04-07T20:43:48.420530516-07:00"</span> level=info msg=<span class="string">"Daemon ha</span></span><br><span class="line"><span class="string">Apr 07 20:43:48 ubuntu dockerd[4082]: time="</span>2017-04-07T20:43:48.420807227-07:00<span class="string">" level=info msg="</span>Docker da</span><br><span class="line">Apr 07 20:43:48 ubuntu systemd[1]: Started Docker Application Container Engine.</span><br><span class="line">Apr 07 20:43:48 ubuntu dockerd[4082]: time=<span class="string">"2017-04-07T20:43:48.434958396-07:00"</span> level=info msg=<span class="string">"API liste</span></span><br><span class="line"><span class="string">lines 1-19/19 (END)</span></span><br></pre></td></tr></table></figure>



<h2 id="æ“ä½œ-Docker-è¿›ç¨‹"><a href="#æ“ä½œ-Docker-è¿›ç¨‹" class="headerlink" title="æ“ä½œ Docker è¿›ç¨‹"></a>æ“ä½œ Docker è¿›ç¨‹</h2><ul>
<li>å…³é—­ Docker æœåŠ¡ <code>systemctl stop docker</code></li>
<li>é‡å¯ Docker æœåŠ¡ <code>systemctl restart docker</code></li>
<li>å¼€å¯ Docker æœåŠ¡ <code>systemctl start docker</code></li>
<li>å¼€æœºå¯åŠ¨ Docker <code>systemctl enable docker</code></li>
</ul>
<h1 id="æ£€æŸ¥-Docker-æœåŠ¡"><a href="#æ£€æŸ¥-Docker-æœåŠ¡" class="headerlink" title="æ£€æŸ¥ Docker æœåŠ¡"></a>æ£€æŸ¥ Docker æœåŠ¡</h1><ul>
<li>Docker æœåŠ¡è¿è¡Œæ­£å¸¸çš„å›æ˜¾</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker info</span></span><br><span class="line">Containers: 0</span><br><span class="line"> Running: 0</span><br><span class="line"> Paused: 0</span><br><span class="line"> Stopped: 0</span><br><span class="line">Images: 0</span><br><span class="line">Server Version: 17.04.0-ce</span><br><span class="line">Storage Driver: aufs</span><br><span class="line"> Root Dir: /var/lib/docker/aufs</span><br><span class="line"> Backing Filesystem: extfs</span><br><span class="line"> Dirs: 0</span><br><span class="line"> Dirperm1 Supported: <span class="literal">true</span></span><br><span class="line">Logging Driver: json-file</span><br><span class="line">Cgroup Driver: cgroupfs</span><br><span class="line">Plugins: </span><br><span class="line"> Volume: <span class="built_in">local</span></span><br><span class="line"> Network: bridge host macvlan null overlay</span><br><span class="line">Swarm: inactive</span><br><span class="line">Runtimes: runc</span><br><span class="line">Default Runtime: runc</span><br><span class="line">Init Binary: </span><br><span class="line">containerd version: 422e31ce907fd9c3833a38d7b8fdd023e5a76e73</span><br><span class="line">runc version: 9c2d8d184e5da67c95d601382adf14862e4f2228</span><br><span class="line">init version: 949e6fa</span><br><span class="line">Security Options:</span><br><span class="line"> apparmor</span><br><span class="line"> seccomp</span><br><span class="line">  Profile: default</span><br><span class="line">Kernel Version: 4.4.0-21-generic</span><br><span class="line">Operating System: Ubuntu 16.04 LTS</span><br><span class="line">OSType: linux</span><br><span class="line">Architecture: x86_64</span><br><span class="line">CPUs: 1</span><br><span class="line">Total Memory: 975.1MiB</span><br><span class="line">Name: ubuntu</span><br><span class="line">ID: VK2Y:PFFS:OEDA:7RIL:PLF5:SA4F:RJNS:7VEF:ODLG:LX6M:OVY4:BECX</span><br><span class="line">Docker Root Dir: /var/lib/docker</span><br><span class="line">Debug Mode (client): <span class="literal">false</span></span><br><span class="line">Debug Mode (server): <span class="literal">false</span></span><br><span class="line">Registry: https://index.docker.io/v1/</span><br><span class="line">Experimental: <span class="literal">false</span></span><br><span class="line">Insecure Registries:</span><br><span class="line"> 127.0.0.0/8</span><br><span class="line">Live Restore Enabled: <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">WARNING: No swap <span class="built_in">limit</span> support</span><br></pre></td></tr></table></figure>

<ul>
<li>Docker æœåŠ¡è¿è¡Œå¼‚å¸¸çš„å›æ˜¾(æ™®é€šç”¨æˆ·å¦‚æœæ²¡æœ‰åŠ å…¥åˆ° docker ç»„ä¸­, æ‰§è¡Œ docker å‘½ä»¤ä¹Ÿä¼šå‡ºç°ä»¥ä¸‹çš„æŠ¥é”™)</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker info</span></span><br><span class="line">Cannot connect to the Docker daemon at unix:///var/run/docker.sock. Is the docker daemon running?</span><br></pre></td></tr></table></figure>

<ul>
<li>è¿˜æœ‰ä¸€ç§æƒ…å†µ, å¯èƒ½ç”±äºæŸäº›åŸå› å¯¼è‡´ç»ˆç«¯é˜»å¡, å¤§å¤šæ•°æƒ…å†µä¸‹, å³ä½¿ä½¿ç”¨ <code>systemctl</code> å…³é—­ Docker æœåŠ¡ä¹Ÿæ— æ³•æ­£å¸¸å…³é—­, åªèƒ½é‡å¯æœåŠ¡å™¨å®¿ä¸»æœº</li>
</ul>
<h1 id="Docker-ä¿¡æ¯è§£è¯»"><a href="#Docker-ä¿¡æ¯è§£è¯»" class="headerlink" title="Docker ä¿¡æ¯è§£è¯»"></a>Docker ä¿¡æ¯è§£è¯»</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker info</span></span><br><span class="line">Containers: 0   <span class="comment"># æ€»å®¹å™¨æ•°é‡</span></span><br><span class="line"> Running: 0     <span class="comment"># è¿è¡Œä¸­çš„å®¹å™¨æ•°é‡</span></span><br><span class="line"> Paused: 0      <span class="comment"># æš‚åœçš„å®¹å™¨æ•°é‡</span></span><br><span class="line"> Stopped: 0     <span class="comment"># åœæ­¢çš„å®¹å™¨æ•°é‡</span></span><br><span class="line">Images: 0       <span class="comment"># æ€»é•œåƒæ•°é‡</span></span><br><span class="line">Server Version: 17.04.0-ce      <span class="comment"># Docker Server ç‰ˆæœ¬</span></span><br><span class="line">Storage Driver: aufs            <span class="comment"># å­˜å‚¨å¼•æ“</span></span><br><span class="line"> Root Dir: /var/lib/docker/aufs <span class="comment"># å­˜å‚¨å¼•æ“æ ¹ç›®å½•</span></span><br><span class="line"> Backing Filesystem: extfs      <span class="comment"># åç«¯æ–‡ä»¶ç³»ç»Ÿç±»å‹</span></span><br><span class="line"> Dirs: 0                        <span class="comment"># aufs çš„å±æ€§</span></span><br><span class="line"> Dirperm1 Supported: <span class="literal">true</span>       <span class="comment"># aufs çš„å±æ€§</span></span><br><span class="line">Logging Driver: json-file       <span class="comment"># æ—¥å¿—å¼•æ“</span></span><br><span class="line">Cgroup Driver: cgroupfs         <span class="comment"># Cgroup å¼•æ“</span></span><br><span class="line">Plugins:        <span class="comment"># æ’ä»¶ä¿¡æ¯</span></span><br><span class="line"> Volume: <span class="built_in">local</span>  <span class="comment"># æ•°æ®å·æ’ä»¶</span></span><br><span class="line"> Network: bridge host macvlan null overlay <span class="comment"># ç½‘ç»œæ’ä»¶</span></span><br><span class="line">Swarm: inactive <span class="comment"># swarmkit æ¨¡å¼çŠ¶æ€</span></span><br><span class="line">Runtimes: runc  <span class="comment"># å®¹å™¨æ‰§è¡Œå¼•æ“</span></span><br><span class="line">Default Runtime: runc           <span class="comment"># é»˜è®¤å®¹å™¨æ‰§è¡Œå¼•æ“</span></span><br><span class="line">Init Binary: </span><br><span class="line">containerd version: 422e31ce907fd9c3833a38d7b8fdd023e5a76e73</span><br><span class="line">runc version: 9c2d8d184e5da67c95d601382adf14862e4f2228</span><br><span class="line">init version: 949e6fa</span><br><span class="line">Security Options:       <span class="comment"># å®‰å…¨é¡¹</span></span><br><span class="line"> apparmor       <span class="comment"># Linuxå†…æ ¸ä¸­çš„å¼ºåˆ¶è®¿é—®æ§åˆ¶ç³»ç»Ÿ</span></span><br><span class="line"> seccomp        <span class="comment"># Linux kernel(2.6.23ç‰ˆæœ¬ä¹‹å)æ‰€æ”¯æŒçš„ä¸€ç§ç®€æ´çš„æ²™ç®±æœºåˆ¶</span></span><br><span class="line">  Profile: default</span><br><span class="line">Kernel Version: 4.4.0-21-generic    <span class="comment"># å®¿ä¸»æœºå†…æ ¸ç‰ˆæœ¬</span></span><br><span class="line">Operating System: Ubuntu 16.04 LTS  <span class="comment"># å®¿ä¸»æœºç³»ç»Ÿå‘è¡Œç‰ˆ</span></span><br><span class="line">OSType: linux           <span class="comment"># å®¿ä¸»æœºç³»ç»Ÿç±»å‹</span></span><br><span class="line">Architecture: x86_64    <span class="comment"># å®¿ä¸»æœº CPU æ¶æ„</span></span><br><span class="line">CPUs: 1                 <span class="comment"># å®¿ä¸»æœºæ€» CPU å®¹é‡</span></span><br><span class="line">Total Memory: 975.1MiB  <span class="comment"># å®¿ä¸»æœºæ€»å†…å­˜å®¹é‡</span></span><br><span class="line">Name: ubuntu            <span class="comment"># å®¿ä¸»æœºç³»ç»Ÿåç§°</span></span><br><span class="line">ID: VK2Y:PFFS:OEDA:7RIL:PLF5:SA4F:RJNS:7VEF:ODLG:LX6M:OVY4:BECX</span><br><span class="line">Docker Root Dir: /var/lib/docker    <span class="comment"># Docker å®¶ç›®å½•</span></span><br><span class="line">Debug Mode (client): <span class="literal">false</span>          <span class="comment"># å®¢æˆ·ç«¯æ˜¯å¦å¼€å¯ debug æ¨¡å¼</span></span><br><span class="line">Debug Mode (server): <span class="literal">false</span>          <span class="comment"># æœåŠ¡ç«¯æ˜¯å¦å¼€å¯ debug æ¨¡å¼</span></span><br><span class="line">Registry: https://index.docker.io/v1/   <span class="comment"># é»˜è®¤ä»“åº“åœ°å€</span></span><br><span class="line">Experimental: <span class="literal">false</span>     <span class="comment"># æ˜¯å¦æ˜¯ä½“éªŒç‰ˆ Docker(edge)</span></span><br><span class="line">Insecure Registries:    <span class="comment"># ä¸å®‰å…¨çš„ä»“åº“</span></span><br><span class="line"> 127.0.0.0/8</span><br><span class="line">Live Restore Enabled: <span class="literal">false</span>  <span class="comment"># åœ¨çº¿æ¢å¤/çƒ­æ¢å¤</span></span><br><span class="line"></span><br><span class="line">WARNING: No swap <span class="built_in">limit</span> support  <span class="comment"># cgroupsä¸­çš„swap accountæ²¡æœ‰å¼€å¯</span></span><br></pre></td></tr></table></figure>

<p>æ³¨æ„: ç”Ÿäº§ç¯å¢ƒä¸­, ä¾æ®è‡ªå·±çš„éœ€è¦, å¯ä»¥é€‚å½“è°ƒæ•´<code>swap limit support</code>çš„æ”¯æŒæƒ…å†µ. </p>
<p>å®å®•å‹¿æ…¢, å®æ…¢å‹¿å®•, ä¸¤ä¸ªè€ƒé‡ç³»ç»Ÿå¥å£®æ€§çš„æ€è·¯, æ²¡æœ‰æœ€å¥½çš„æ–¹æ¡ˆ, å„æœ‰åˆ©å¼Š, éœ€è¦ç»¼åˆè‡ªå·±çš„å®é™…æƒ…å†µè€ƒé‡</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Edit the /etc/default/grub file.</span><br><span class="line">Set the GRUB_CMDLINE_LINUX value as follows:</span><br><span class="line"></span><br><span class="line">GRUB_CMDLINE_LINUX=<span class="string">"cgroup_enable=memory swapaccount=1"</span></span><br><span class="line">Save and close the file.</span><br><span class="line"></span><br><span class="line">Update GRUB.</span><br><span class="line"></span><br><span class="line">$ sudo update-grub</span><br><span class="line">Reboot your system.</span><br></pre></td></tr></table></figure>



<h1 id="è¿è¡Œ-hello-wordå®¹å™¨"><a href="#è¿è¡Œ-hello-wordå®¹å™¨" class="headerlink" title="è¿è¡Œ hello wordå®¹å™¨"></a>è¿è¡Œ hello wordå®¹å™¨</h1><h2 id="æ·»åŠ ä»£ç†ä»“åº“-daocloud"><a href="#æ·»åŠ ä»£ç†ä»“åº“-daocloud" class="headerlink" title="æ·»åŠ ä»£ç†ä»“åº“-daocloud"></a>æ·»åŠ ä»£ç†ä»“åº“-daocloud</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># curl -sSL https://get.daocloud.io/daotools/set_mirror.sh | sh -s http://172d594a.m.daocloud.io</span></span><br><span class="line">docker version &gt;= 1.12</span><br><span class="line">&#123;<span class="string">"registry-mirrors"</span>: [<span class="string">"http://172d594a.m.daocloud.io"</span>]&#125;</span><br><span class="line">Success.</span><br><span class="line">You need to restart docker to take effect: sudo systemctl restart docker.service</span><br><span class="line">root@ubuntu:~<span class="comment"># systemctl restart docker</span></span><br></pre></td></tr></table></figure>



<h2 id="æŸ¥çœ‹ä»£ç†ä¿¡æ¯"><a href="#æŸ¥çœ‹ä»£ç†ä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹ä»£ç†ä¿¡æ¯"></a>æŸ¥çœ‹ä»£ç†ä¿¡æ¯</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker info</span></span><br><span class="line">Containers: 0</span><br><span class="line"> Running: 0</span><br><span class="line"> Paused: 0</span><br><span class="line"> Stopped: 0</span><br><span class="line">Images: 0</span><br><span class="line">Server Version: 17.04.0-ce</span><br><span class="line">Storage Driver: aufs</span><br><span class="line"> Root Dir: /var/lib/docker/aufs</span><br><span class="line"> Backing Filesystem: extfs</span><br><span class="line"> Dirs: 0</span><br><span class="line"> Dirperm1 Supported: <span class="literal">true</span></span><br><span class="line">Logging Driver: json-file</span><br><span class="line">Cgroup Driver: cgroupfs</span><br><span class="line">Plugins: </span><br><span class="line"> Volume: <span class="built_in">local</span></span><br><span class="line"> Network: bridge host macvlan null overlay</span><br><span class="line">Swarm: inactive</span><br><span class="line">Runtimes: runc</span><br><span class="line">Default Runtime: runc</span><br><span class="line">Init Binary: </span><br><span class="line">containerd version: 422e31ce907fd9c3833a38d7b8fdd023e5a76e73</span><br><span class="line">runc version: 9c2d8d184e5da67c95d601382adf14862e4f2228</span><br><span class="line">init version: 949e6fa</span><br><span class="line">Security Options:</span><br><span class="line"> apparmor</span><br><span class="line"> seccomp</span><br><span class="line">  Profile: default</span><br><span class="line">Kernel Version: 4.4.0-21-generic</span><br><span class="line">Operating System: Ubuntu 16.04 LTS</span><br><span class="line">OSType: linux</span><br><span class="line">Architecture: x86_64</span><br><span class="line">CPUs: 1</span><br><span class="line">Total Memory: 975.1MiB</span><br><span class="line">Name: ubuntu</span><br><span class="line">ID: VK2Y:PFFS:OEDA:7RIL:PLF5:SA4F:RJNS:7VEF:ODLG:LX6M:OVY4:BECX</span><br><span class="line">Docker Root Dir: /var/lib/docker</span><br><span class="line">Debug Mode (client): <span class="literal">false</span></span><br><span class="line">Debug Mode (server): <span class="literal">false</span></span><br><span class="line">Registry: https://index.docker.io/v1/</span><br><span class="line">Experimental: <span class="literal">false</span></span><br><span class="line">Insecure Registries:</span><br><span class="line"> 127.0.0.0/8</span><br><span class="line">Registry Mirrors:       <span class="comment"># é•œåƒä»£ç†</span></span><br><span class="line"> http://172d594a.m.daocloud.io/</span><br><span class="line">Live Restore Enabled: <span class="literal">false</span></span><br></pre></td></tr></table></figure>



<h2 id="è¿è¡Œ-hello-world-å®¹å™¨"><a href="#è¿è¡Œ-hello-world-å®¹å™¨" class="headerlink" title="è¿è¡Œ hello-world å®¹å™¨"></a>è¿è¡Œ hello-world å®¹å™¨</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker run hello-world</span></span><br><span class="line">Unable to find image <span class="string">'hello-world:latest'</span> locally   <span class="comment"># åœ¨æœ¬åœ°æ²¡æœ‰æ‰¾åˆ°è¯¥é•œåƒ</span></span><br><span class="line">latest: Pulling from library/hello-world        <span class="comment"># åœ¨è¿œç¨‹ä»“åº“ä¸­æŸ¥æ‰¾é•œåƒ</span></span><br><span class="line">78445dd45222: Pull complete         <span class="comment"># æ‹‰å–é•œåƒ</span></span><br><span class="line">Digest: sha256:c5515758d4c5e1e838e9cd307f6c6a0d620b5e07e6f927b07d05f6d12a1ac8d7</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> hello-world:latest <span class="comment"># é•œåƒæ‹‰å–å®Œæ¯•</span></span><br><span class="line"><span class="comment">#  ------ä»¥ä¸‹å†…å®¹æ˜¯è¿è¡Œå®¹å™¨æ—¶æ‰“å°åˆ°å±å¹•çš„å†…å®¹------</span></span><br><span class="line">Hello from Docker!</span><br><span class="line">This message shows that your installation appears to be working correctly.</span><br><span class="line"></span><br><span class="line">To generate this message, Docker took the following steps:</span><br><span class="line"> 1. The Docker client contacted the Docker daemon.</span><br><span class="line"> 2. The Docker daemon pulled the <span class="string">"hello-world"</span> image from the Docker Hub.</span><br><span class="line"> 3. The Docker daemon created a new container from that image <span class="built_in">which</span> runs the</span><br><span class="line">    executable that produces the output you are currently reading.</span><br><span class="line"> 4. The Docker daemon streamed that output to the Docker client, <span class="built_in">which</span> sent it</span><br><span class="line">    to your terminal.</span><br><span class="line"></span><br><span class="line">To try something more ambitious, you can run an Ubuntu container with:</span><br><span class="line"> $ docker run -it ubuntu bash</span><br><span class="line"></span><br><span class="line">Share images, automate workflows, and more with a free Docker ID:</span><br><span class="line"> https://cloud.docker.com/</span><br><span class="line"></span><br><span class="line">For more examples and ideas, visit:</span><br><span class="line"> https://docs.docker.com/engine/userguide/</span><br></pre></td></tr></table></figure>



<h1 id="æŸ¥çœ‹å®¹å™¨çŠ¶æ€"><a href="#æŸ¥çœ‹å®¹å™¨çŠ¶æ€" class="headerlink" title="æŸ¥çœ‹å®¹å™¨çŠ¶æ€"></a>æŸ¥çœ‹å®¹å™¨çŠ¶æ€</h1><h2 id="æŸ¥çœ‹è¿è¡ŒçŠ¶æ€çš„å®¹å™¨"><a href="#æŸ¥çœ‹è¿è¡ŒçŠ¶æ€çš„å®¹å™¨" class="headerlink" title="æŸ¥çœ‹è¿è¡ŒçŠ¶æ€çš„å®¹å™¨"></a>æŸ¥çœ‹è¿è¡ŒçŠ¶æ€çš„å®¹å™¨</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">root@ubuntu:~<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class="line">root@ubuntu:~<span class="comment">#</span></span><br></pre></td></tr></table></figure>



<p>æŸ¥çœ‹æ‰€æœ‰çŠ¶æ€çš„å®¹å™¨</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker ps -a</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                     PORTS               NAMES</span><br><span class="line">9c6fd12bef22        hello-world         <span class="string">"/hello"</span>            4 minutes ago       Exited (0) 4 minutes ago                       wizardly_mccarthy</span><br><span class="line">root@ubuntu:~<span class="comment">#</span></span><br></pre></td></tr></table></figure>



<h1 id="æ›´æ”¹å®¹å™¨åç§°"><a href="#æ›´æ”¹å®¹å™¨åç§°" class="headerlink" title="æ›´æ”¹å®¹å™¨åç§°"></a>æ›´æ”¹å®¹å™¨åç§°</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker run --name "sayHi" hello-world</span></span><br><span class="line">root@ubuntu:~<span class="comment"># docker ps -a</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                     PORTS               NAMES</span><br><span class="line">a74123af6f47        hello-world         <span class="string">"/hello"</span>            5 seconds ago       Exited (0) 4 seconds ago                       sayHi</span><br><span class="line">9c6fd12bef22        hello-world         <span class="string">"/hello"</span>            7 minutes ago       Exited (0) 7 minutes ago                       wizardly_mccarthy</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      

      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://docs.lvrui.io/2017/04/15/%E5%BF%AB%E9%80%9F%E5%AE%89%E8%A3%85Docker%205/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.JPG">
      <meta itemprop="name" content="æåœ°ç‘é›ª">
      <meta itemprop="description" content="æåœ°ç‘é›ªçš„ä¸ªäººæŠ€æœ¯åšå®¢. "å–ä¹‹å¼€æº ç”¨ä¹‹å¼€æº", åˆ†äº«è‡ªå·±çš„ç»éªŒä¹‹è°ˆ".">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Polar Snow Documentation">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/04/15/%E5%BF%AB%E9%80%9F%E5%AE%89%E8%A3%85Docker%205/" class="post-title-link" itemprop="url">å¿«é€Ÿå®‰è£…Docker</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2017-04-15 10:43:38" itemprop="dateCreated datePublished" datetime="2017-04-15T10:43:38+08:00">2017-04-15</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Docker/" itemprop="url" rel="index"><span itemprop="name">Docker</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqusï¼š</span>
    
    <a title="disqus" href="/2017/04/15/%E5%BF%AB%E9%80%9F%E5%AE%89%E8%A3%85Docker%205/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/04/15/å¿«é€Ÿå®‰è£…Docker 5/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="å®‰è£…å‘½ä»¤"><a href="#å®‰è£…å‘½ä»¤" class="headerlink" title="å®‰è£…å‘½ä»¤"></a>å®‰è£…å‘½ä»¤</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># å…¬ç½‘é€šç”¨</span></span><br><span class="line">curl -sSL http://acs-public-mirror.oss-cn-hangzhou.aliyuncs.com/docker-engine/internet | sh -</span><br><span class="line"></span><br><span class="line"><span class="comment"># é˜¿é‡Œäº‘ä¸“ç”¨</span></span><br><span class="line">curl -sSL http://acs-public-mirror.oss-cn-hangzhou.aliyuncs.com/docker-engine/intranet | sh -</span><br></pre></td></tr></table></figure>



<h1 id="å®‰è£…å®Œæˆåçš„ç»“æŸä¿¡æ¯"><a href="#å®‰è£…å®Œæˆåçš„ç»“æŸä¿¡æ¯" class="headerlink" title="å®‰è£…å®Œæˆåçš„ç»“æŸä¿¡æ¯:"></a>å®‰è£…å®Œæˆåçš„ç»“æŸä¿¡æ¯:</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># curl -sSL http://acs-public-mirror.oss-cn-hangzhou.aliyuncs.com/docker-engine/internet | sh -</span></span><br><span class="line">......</span><br><span class="line">......</span><br><span class="line">+ sh -c docker version</span><br><span class="line">Client:</span><br><span class="line"> Version:      17.04.0-ce</span><br><span class="line"> API version:  1.28</span><br><span class="line"> Go version:   go1.7.5</span><br><span class="line"> Git commit:   4845c56</span><br><span class="line"> Built:        Mon Apr  3 18:07:42 2017</span><br><span class="line"> OS/Arch:      linux/amd64</span><br><span class="line"></span><br><span class="line">Server:</span><br><span class="line"> Version:      17.04.0-ce</span><br><span class="line"> API version:  1.28 (minimum version 1.12)</span><br><span class="line"> Go version:   go1.7.5</span><br><span class="line"> Git commit:   4845c56</span><br><span class="line"> Built:        Mon Apr  3 18:07:42 2017</span><br><span class="line"> OS/Arch:      linux/amd64</span><br><span class="line"> Experimental: <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">If you would like to use Docker as a non-root user, you should now consider</span><br><span class="line">adding your user to the <span class="string">"docker"</span> group with something like:</span><br><span class="line"></span><br><span class="line">  sudo usermod -aG docker your-user</span><br><span class="line"></span><br><span class="line">Remember that you will have to <span class="built_in">log</span> out and back <span class="keyword">in</span> <span class="keyword">for</span> this to take effect!</span><br></pre></td></tr></table></figure>

<p>é‡ç‚¹æ³¨æ„: <code>sudo usermod -aG docker your-user</code></p>
<p>åœ¨ Ubuntu ç³»ç»Ÿä¸­, ä½¿ç”¨æ™®é€šç”¨æˆ·ç™»å½•çš„æƒ…å†µå¾ˆå¤š, å¦‚æœæ™®é€šç”¨æˆ·éœ€è¦ç›´æ¥æœ‰æƒé™æ§åˆ¶ docker æ‰€æœ‰çš„æ“ä½œçš„è¯, éœ€è¦å°†è¯¥æ™®é€šç”¨æˆ·åŠ å…¥åˆ° docker ç»„ä¸­.</p>
<p>Docker æ˜¯ C/S æ¶æ„, ä¸€èˆ¬æƒ…å†µä¸‹, C å’Œ S æ˜¯åœ¨å®‰è£…åœ¨ä¸€å°ä¸»æœºä¸Šçš„, æœ¬åœ°çš„ C æ§åˆ¶æœ¬åœ°çš„ S, åæœŸæ§åˆ¶å¤§è§„æ¨¡ Docker çš„æ—¶å€™, éœ€è¦å¼€æ”¾Docker API æ¥è¿œç¨‹æ§åˆ¶ Docker Server ç«¯</p>
<h1 id="æ£€æŸ¥-Docker-è¿è¡ŒçŠ¶æ€"><a href="#æ£€æŸ¥-Docker-è¿è¡ŒçŠ¶æ€" class="headerlink" title="æ£€æŸ¥ Docker è¿è¡ŒçŠ¶æ€"></a>æ£€æŸ¥ Docker è¿è¡ŒçŠ¶æ€</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># systemctl status docker</span></span><br><span class="line">â— docker.service - Docker Application Container Engine</span><br><span class="line">   Loaded: loaded (/lib/systemd/system/docker.service; enabled; vendor preset: enabled)</span><br><span class="line">   Active: active (running) since Fri 2017-04-07 20:43:48 PDT; 9min ago</span><br><span class="line">     Docs: https://docs.docker.com</span><br><span class="line"> Main PID: 4082 (dockerd)</span><br><span class="line">   CGroup: /system.slice/docker.service</span><br><span class="line">           â”œâ”€4082 /usr/bin/dockerd -H fd://</span><br><span class="line">           â””â”€4095 docker-containerd -l unix:///var/run/docker/libcontainerd/docker-containerd.sock --metri</span><br><span class="line"></span><br><span class="line">Apr 07 20:43:48 ubuntu dockerd[4082]: time=<span class="string">"2017-04-07T20:43:48.175051418-07:00"</span> level=warning msg=<span class="string">"Your k</span></span><br><span class="line"><span class="string">Apr 07 20:43:48 ubuntu dockerd[4082]: time="</span>2017-04-07T20:43:48.175185511-07:00<span class="string">" level=warning msg="</span>Your k</span><br><span class="line">Apr 07 20:43:48 ubuntu dockerd[4082]: time=<span class="string">"2017-04-07T20:43:48.175683715-07:00"</span> level=info msg=<span class="string">"Loading c</span></span><br><span class="line"><span class="string">Apr 07 20:43:48 ubuntu dockerd[4082]: time="</span>2017-04-07T20:43:48.228757745-07:00<span class="string">" level=info msg="</span>Firewalld</span><br><span class="line">Apr 07 20:43:48 ubuntu dockerd[4082]: time=<span class="string">"2017-04-07T20:43:48.327388388-07:00"</span> level=info msg=<span class="string">"Default b</span></span><br><span class="line"><span class="string">Apr 07 20:43:48 ubuntu dockerd[4082]: time="</span>2017-04-07T20:43:48.383792709-07:00<span class="string">" level=info msg="</span>Loading c</span><br><span class="line">Apr 07 20:43:48 ubuntu dockerd[4082]: time=<span class="string">"2017-04-07T20:43:48.420530516-07:00"</span> level=info msg=<span class="string">"Daemon ha</span></span><br><span class="line"><span class="string">Apr 07 20:43:48 ubuntu dockerd[4082]: time="</span>2017-04-07T20:43:48.420807227-07:00<span class="string">" level=info msg="</span>Docker da</span><br><span class="line">Apr 07 20:43:48 ubuntu systemd[1]: Started Docker Application Container Engine.</span><br><span class="line">Apr 07 20:43:48 ubuntu dockerd[4082]: time=<span class="string">"2017-04-07T20:43:48.434958396-07:00"</span> level=info msg=<span class="string">"API liste</span></span><br><span class="line"><span class="string">lines 1-19/19 (END)</span></span><br></pre></td></tr></table></figure>



<h2 id="æ“ä½œ-Docker-è¿›ç¨‹"><a href="#æ“ä½œ-Docker-è¿›ç¨‹" class="headerlink" title="æ“ä½œ Docker è¿›ç¨‹"></a>æ“ä½œ Docker è¿›ç¨‹</h2><ul>
<li>å…³é—­ Docker æœåŠ¡ <code>systemctl stop docker</code></li>
<li>é‡å¯ Docker æœåŠ¡ <code>systemctl restart docker</code></li>
<li>å¼€å¯ Docker æœåŠ¡ <code>systemctl start docker</code></li>
<li>å¼€æœºå¯åŠ¨ Docker <code>systemctl enable docker</code></li>
</ul>
<h1 id="æ£€æŸ¥-Docker-æœåŠ¡"><a href="#æ£€æŸ¥-Docker-æœåŠ¡" class="headerlink" title="æ£€æŸ¥ Docker æœåŠ¡"></a>æ£€æŸ¥ Docker æœåŠ¡</h1><ul>
<li>Docker æœåŠ¡è¿è¡Œæ­£å¸¸çš„å›æ˜¾</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker info</span></span><br><span class="line">Containers: 0</span><br><span class="line"> Running: 0</span><br><span class="line"> Paused: 0</span><br><span class="line"> Stopped: 0</span><br><span class="line">Images: 0</span><br><span class="line">Server Version: 17.04.0-ce</span><br><span class="line">Storage Driver: aufs</span><br><span class="line"> Root Dir: /var/lib/docker/aufs</span><br><span class="line"> Backing Filesystem: extfs</span><br><span class="line"> Dirs: 0</span><br><span class="line"> Dirperm1 Supported: <span class="literal">true</span></span><br><span class="line">Logging Driver: json-file</span><br><span class="line">Cgroup Driver: cgroupfs</span><br><span class="line">Plugins: </span><br><span class="line"> Volume: <span class="built_in">local</span></span><br><span class="line"> Network: bridge host macvlan null overlay</span><br><span class="line">Swarm: inactive</span><br><span class="line">Runtimes: runc</span><br><span class="line">Default Runtime: runc</span><br><span class="line">Init Binary: </span><br><span class="line">containerd version: 422e31ce907fd9c3833a38d7b8fdd023e5a76e73</span><br><span class="line">runc version: 9c2d8d184e5da67c95d601382adf14862e4f2228</span><br><span class="line">init version: 949e6fa</span><br><span class="line">Security Options:</span><br><span class="line"> apparmor</span><br><span class="line"> seccomp</span><br><span class="line">  Profile: default</span><br><span class="line">Kernel Version: 4.4.0-21-generic</span><br><span class="line">Operating System: Ubuntu 16.04 LTS</span><br><span class="line">OSType: linux</span><br><span class="line">Architecture: x86_64</span><br><span class="line">CPUs: 1</span><br><span class="line">Total Memory: 975.1MiB</span><br><span class="line">Name: ubuntu</span><br><span class="line">ID: VK2Y:PFFS:OEDA:7RIL:PLF5:SA4F:RJNS:7VEF:ODLG:LX6M:OVY4:BECX</span><br><span class="line">Docker Root Dir: /var/lib/docker</span><br><span class="line">Debug Mode (client): <span class="literal">false</span></span><br><span class="line">Debug Mode (server): <span class="literal">false</span></span><br><span class="line">Registry: https://index.docker.io/v1/</span><br><span class="line">Experimental: <span class="literal">false</span></span><br><span class="line">Insecure Registries:</span><br><span class="line"> 127.0.0.0/8</span><br><span class="line">Live Restore Enabled: <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">WARNING: No swap <span class="built_in">limit</span> support</span><br></pre></td></tr></table></figure>

<ul>
<li>Docker æœåŠ¡è¿è¡Œå¼‚å¸¸çš„å›æ˜¾(æ™®é€šç”¨æˆ·å¦‚æœæ²¡æœ‰åŠ å…¥åˆ° docker ç»„ä¸­, æ‰§è¡Œ docker å‘½ä»¤ä¹Ÿä¼šå‡ºç°ä»¥ä¸‹çš„æŠ¥é”™)</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker info</span></span><br><span class="line">Cannot connect to the Docker daemon at unix:///var/run/docker.sock. Is the docker daemon running?</span><br></pre></td></tr></table></figure>

<ul>
<li>è¿˜æœ‰ä¸€ç§æƒ…å†µ, å¯èƒ½ç”±äºæŸäº›åŸå› å¯¼è‡´ç»ˆç«¯é˜»å¡, å¤§å¤šæ•°æƒ…å†µä¸‹, å³ä½¿ä½¿ç”¨ <code>systemctl</code> å…³é—­ Docker æœåŠ¡ä¹Ÿæ— æ³•æ­£å¸¸å…³é—­, åªèƒ½é‡å¯æœåŠ¡å™¨å®¿ä¸»æœº</li>
</ul>
<h1 id="Docker-ä¿¡æ¯è§£è¯»"><a href="#Docker-ä¿¡æ¯è§£è¯»" class="headerlink" title="Docker ä¿¡æ¯è§£è¯»"></a>Docker ä¿¡æ¯è§£è¯»</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker info</span></span><br><span class="line">Containers: 0   <span class="comment"># æ€»å®¹å™¨æ•°é‡</span></span><br><span class="line"> Running: 0     <span class="comment"># è¿è¡Œä¸­çš„å®¹å™¨æ•°é‡</span></span><br><span class="line"> Paused: 0      <span class="comment"># æš‚åœçš„å®¹å™¨æ•°é‡</span></span><br><span class="line"> Stopped: 0     <span class="comment"># åœæ­¢çš„å®¹å™¨æ•°é‡</span></span><br><span class="line">Images: 0       <span class="comment"># æ€»é•œåƒæ•°é‡</span></span><br><span class="line">Server Version: 17.04.0-ce      <span class="comment"># Docker Server ç‰ˆæœ¬</span></span><br><span class="line">Storage Driver: aufs            <span class="comment"># å­˜å‚¨å¼•æ“</span></span><br><span class="line"> Root Dir: /var/lib/docker/aufs <span class="comment"># å­˜å‚¨å¼•æ“æ ¹ç›®å½•</span></span><br><span class="line"> Backing Filesystem: extfs      <span class="comment"># åç«¯æ–‡ä»¶ç³»ç»Ÿç±»å‹</span></span><br><span class="line"> Dirs: 0                        <span class="comment"># aufs çš„å±æ€§</span></span><br><span class="line"> Dirperm1 Supported: <span class="literal">true</span>       <span class="comment"># aufs çš„å±æ€§</span></span><br><span class="line">Logging Driver: json-file       <span class="comment"># æ—¥å¿—å¼•æ“</span></span><br><span class="line">Cgroup Driver: cgroupfs         <span class="comment"># Cgroup å¼•æ“</span></span><br><span class="line">Plugins:        <span class="comment"># æ’ä»¶ä¿¡æ¯</span></span><br><span class="line"> Volume: <span class="built_in">local</span>  <span class="comment"># æ•°æ®å·æ’ä»¶</span></span><br><span class="line"> Network: bridge host macvlan null overlay <span class="comment"># ç½‘ç»œæ’ä»¶</span></span><br><span class="line">Swarm: inactive <span class="comment"># swarmkit æ¨¡å¼çŠ¶æ€</span></span><br><span class="line">Runtimes: runc  <span class="comment"># å®¹å™¨æ‰§è¡Œå¼•æ“</span></span><br><span class="line">Default Runtime: runc           <span class="comment"># é»˜è®¤å®¹å™¨æ‰§è¡Œå¼•æ“</span></span><br><span class="line">Init Binary: </span><br><span class="line">containerd version: 422e31ce907fd9c3833a38d7b8fdd023e5a76e73</span><br><span class="line">runc version: 9c2d8d184e5da67c95d601382adf14862e4f2228</span><br><span class="line">init version: 949e6fa</span><br><span class="line">Security Options:       <span class="comment"># å®‰å…¨é¡¹</span></span><br><span class="line"> apparmor       <span class="comment"># Linuxå†…æ ¸ä¸­çš„å¼ºåˆ¶è®¿é—®æ§åˆ¶ç³»ç»Ÿ</span></span><br><span class="line"> seccomp        <span class="comment"># Linux kernel(2.6.23ç‰ˆæœ¬ä¹‹å)æ‰€æ”¯æŒçš„ä¸€ç§ç®€æ´çš„æ²™ç®±æœºåˆ¶</span></span><br><span class="line">  Profile: default</span><br><span class="line">Kernel Version: 4.4.0-21-generic    <span class="comment"># å®¿ä¸»æœºå†…æ ¸ç‰ˆæœ¬</span></span><br><span class="line">Operating System: Ubuntu 16.04 LTS  <span class="comment"># å®¿ä¸»æœºç³»ç»Ÿå‘è¡Œç‰ˆ</span></span><br><span class="line">OSType: linux           <span class="comment"># å®¿ä¸»æœºç³»ç»Ÿç±»å‹</span></span><br><span class="line">Architecture: x86_64    <span class="comment"># å®¿ä¸»æœº CPU æ¶æ„</span></span><br><span class="line">CPUs: 1                 <span class="comment"># å®¿ä¸»æœºæ€» CPU å®¹é‡</span></span><br><span class="line">Total Memory: 975.1MiB  <span class="comment"># å®¿ä¸»æœºæ€»å†…å­˜å®¹é‡</span></span><br><span class="line">Name: ubuntu            <span class="comment"># å®¿ä¸»æœºç³»ç»Ÿåç§°</span></span><br><span class="line">ID: VK2Y:PFFS:OEDA:7RIL:PLF5:SA4F:RJNS:7VEF:ODLG:LX6M:OVY4:BECX</span><br><span class="line">Docker Root Dir: /var/lib/docker    <span class="comment"># Docker å®¶ç›®å½•</span></span><br><span class="line">Debug Mode (client): <span class="literal">false</span>          <span class="comment"># å®¢æˆ·ç«¯æ˜¯å¦å¼€å¯ debug æ¨¡å¼</span></span><br><span class="line">Debug Mode (server): <span class="literal">false</span>          <span class="comment"># æœåŠ¡ç«¯æ˜¯å¦å¼€å¯ debug æ¨¡å¼</span></span><br><span class="line">Registry: https://index.docker.io/v1/   <span class="comment"># é»˜è®¤ä»“åº“åœ°å€</span></span><br><span class="line">Experimental: <span class="literal">false</span>     <span class="comment"># æ˜¯å¦æ˜¯ä½“éªŒç‰ˆ Docker(edge)</span></span><br><span class="line">Insecure Registries:    <span class="comment"># ä¸å®‰å…¨çš„ä»“åº“</span></span><br><span class="line"> 127.0.0.0/8</span><br><span class="line">Live Restore Enabled: <span class="literal">false</span>  <span class="comment"># åœ¨çº¿æ¢å¤/çƒ­æ¢å¤</span></span><br><span class="line"></span><br><span class="line">WARNING: No swap <span class="built_in">limit</span> support  <span class="comment"># cgroupsä¸­çš„swap accountæ²¡æœ‰å¼€å¯</span></span><br></pre></td></tr></table></figure>

<p>æ³¨æ„: ç”Ÿäº§ç¯å¢ƒä¸­, ä¾æ®è‡ªå·±çš„éœ€è¦, å¯ä»¥é€‚å½“è°ƒæ•´<code>swap limit support</code>çš„æ”¯æŒæƒ…å†µ. </p>
<p>å®å®•å‹¿æ…¢, å®æ…¢å‹¿å®•, ä¸¤ä¸ªè€ƒé‡ç³»ç»Ÿå¥å£®æ€§çš„æ€è·¯, æ²¡æœ‰æœ€å¥½çš„æ–¹æ¡ˆ, å„æœ‰åˆ©å¼Š, éœ€è¦ç»¼åˆè‡ªå·±çš„å®é™…æƒ…å†µè€ƒé‡</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Edit the /etc/default/grub file.</span><br><span class="line">Set the GRUB_CMDLINE_LINUX value as follows:</span><br><span class="line"></span><br><span class="line">GRUB_CMDLINE_LINUX=<span class="string">"cgroup_enable=memory swapaccount=1"</span></span><br><span class="line">Save and close the file.</span><br><span class="line"></span><br><span class="line">Update GRUB.</span><br><span class="line"></span><br><span class="line">$ sudo update-grub</span><br><span class="line">Reboot your system.</span><br></pre></td></tr></table></figure>



<h1 id="è¿è¡Œ-hello-wordå®¹å™¨"><a href="#è¿è¡Œ-hello-wordå®¹å™¨" class="headerlink" title="è¿è¡Œ hello wordå®¹å™¨"></a>è¿è¡Œ hello wordå®¹å™¨</h1><h2 id="æ·»åŠ ä»£ç†ä»“åº“-daocloud"><a href="#æ·»åŠ ä»£ç†ä»“åº“-daocloud" class="headerlink" title="æ·»åŠ ä»£ç†ä»“åº“-daocloud"></a>æ·»åŠ ä»£ç†ä»“åº“-daocloud</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># curl -sSL https://get.daocloud.io/daotools/set_mirror.sh | sh -s http://172d594a.m.daocloud.io</span></span><br><span class="line">docker version &gt;= 1.12</span><br><span class="line">&#123;<span class="string">"registry-mirrors"</span>: [<span class="string">"http://172d594a.m.daocloud.io"</span>]&#125;</span><br><span class="line">Success.</span><br><span class="line">You need to restart docker to take effect: sudo systemctl restart docker.service</span><br><span class="line">root@ubuntu:~<span class="comment"># systemctl restart docker</span></span><br></pre></td></tr></table></figure>



<h2 id="æŸ¥çœ‹ä»£ç†ä¿¡æ¯"><a href="#æŸ¥çœ‹ä»£ç†ä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹ä»£ç†ä¿¡æ¯"></a>æŸ¥çœ‹ä»£ç†ä¿¡æ¯</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker info</span></span><br><span class="line">Containers: 0</span><br><span class="line"> Running: 0</span><br><span class="line"> Paused: 0</span><br><span class="line"> Stopped: 0</span><br><span class="line">Images: 0</span><br><span class="line">Server Version: 17.04.0-ce</span><br><span class="line">Storage Driver: aufs</span><br><span class="line"> Root Dir: /var/lib/docker/aufs</span><br><span class="line"> Backing Filesystem: extfs</span><br><span class="line"> Dirs: 0</span><br><span class="line"> Dirperm1 Supported: <span class="literal">true</span></span><br><span class="line">Logging Driver: json-file</span><br><span class="line">Cgroup Driver: cgroupfs</span><br><span class="line">Plugins: </span><br><span class="line"> Volume: <span class="built_in">local</span></span><br><span class="line"> Network: bridge host macvlan null overlay</span><br><span class="line">Swarm: inactive</span><br><span class="line">Runtimes: runc</span><br><span class="line">Default Runtime: runc</span><br><span class="line">Init Binary: </span><br><span class="line">containerd version: 422e31ce907fd9c3833a38d7b8fdd023e5a76e73</span><br><span class="line">runc version: 9c2d8d184e5da67c95d601382adf14862e4f2228</span><br><span class="line">init version: 949e6fa</span><br><span class="line">Security Options:</span><br><span class="line"> apparmor</span><br><span class="line"> seccomp</span><br><span class="line">  Profile: default</span><br><span class="line">Kernel Version: 4.4.0-21-generic</span><br><span class="line">Operating System: Ubuntu 16.04 LTS</span><br><span class="line">OSType: linux</span><br><span class="line">Architecture: x86_64</span><br><span class="line">CPUs: 1</span><br><span class="line">Total Memory: 975.1MiB</span><br><span class="line">Name: ubuntu</span><br><span class="line">ID: VK2Y:PFFS:OEDA:7RIL:PLF5:SA4F:RJNS:7VEF:ODLG:LX6M:OVY4:BECX</span><br><span class="line">Docker Root Dir: /var/lib/docker</span><br><span class="line">Debug Mode (client): <span class="literal">false</span></span><br><span class="line">Debug Mode (server): <span class="literal">false</span></span><br><span class="line">Registry: https://index.docker.io/v1/</span><br><span class="line">Experimental: <span class="literal">false</span></span><br><span class="line">Insecure Registries:</span><br><span class="line"> 127.0.0.0/8</span><br><span class="line">Registry Mirrors:       <span class="comment"># é•œåƒä»£ç†</span></span><br><span class="line"> http://172d594a.m.daocloud.io/</span><br><span class="line">Live Restore Enabled: <span class="literal">false</span></span><br></pre></td></tr></table></figure>



<h2 id="è¿è¡Œ-hello-world-å®¹å™¨"><a href="#è¿è¡Œ-hello-world-å®¹å™¨" class="headerlink" title="è¿è¡Œ hello-world å®¹å™¨"></a>è¿è¡Œ hello-world å®¹å™¨</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker run hello-world</span></span><br><span class="line">Unable to find image <span class="string">'hello-world:latest'</span> locally   <span class="comment"># åœ¨æœ¬åœ°æ²¡æœ‰æ‰¾åˆ°è¯¥é•œåƒ</span></span><br><span class="line">latest: Pulling from library/hello-world        <span class="comment"># åœ¨è¿œç¨‹ä»“åº“ä¸­æŸ¥æ‰¾é•œåƒ</span></span><br><span class="line">78445dd45222: Pull complete         <span class="comment"># æ‹‰å–é•œåƒ</span></span><br><span class="line">Digest: sha256:c5515758d4c5e1e838e9cd307f6c6a0d620b5e07e6f927b07d05f6d12a1ac8d7</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> hello-world:latest <span class="comment"># é•œåƒæ‹‰å–å®Œæ¯•</span></span><br><span class="line"><span class="comment">#  ------ä»¥ä¸‹å†…å®¹æ˜¯è¿è¡Œå®¹å™¨æ—¶æ‰“å°åˆ°å±å¹•çš„å†…å®¹------</span></span><br><span class="line">Hello from Docker!</span><br><span class="line">This message shows that your installation appears to be working correctly.</span><br><span class="line"></span><br><span class="line">To generate this message, Docker took the following steps:</span><br><span class="line"> 1. The Docker client contacted the Docker daemon.</span><br><span class="line"> 2. The Docker daemon pulled the <span class="string">"hello-world"</span> image from the Docker Hub.</span><br><span class="line"> 3. The Docker daemon created a new container from that image <span class="built_in">which</span> runs the</span><br><span class="line">    executable that produces the output you are currently reading.</span><br><span class="line"> 4. The Docker daemon streamed that output to the Docker client, <span class="built_in">which</span> sent it</span><br><span class="line">    to your terminal.</span><br><span class="line"></span><br><span class="line">To try something more ambitious, you can run an Ubuntu container with:</span><br><span class="line"> $ docker run -it ubuntu bash</span><br><span class="line"></span><br><span class="line">Share images, automate workflows, and more with a free Docker ID:</span><br><span class="line"> https://cloud.docker.com/</span><br><span class="line"></span><br><span class="line">For more examples and ideas, visit:</span><br><span class="line"> https://docs.docker.com/engine/userguide/</span><br></pre></td></tr></table></figure>



<h1 id="æŸ¥çœ‹å®¹å™¨çŠ¶æ€"><a href="#æŸ¥çœ‹å®¹å™¨çŠ¶æ€" class="headerlink" title="æŸ¥çœ‹å®¹å™¨çŠ¶æ€"></a>æŸ¥çœ‹å®¹å™¨çŠ¶æ€</h1><h2 id="æŸ¥çœ‹è¿è¡ŒçŠ¶æ€çš„å®¹å™¨"><a href="#æŸ¥çœ‹è¿è¡ŒçŠ¶æ€çš„å®¹å™¨" class="headerlink" title="æŸ¥çœ‹è¿è¡ŒçŠ¶æ€çš„å®¹å™¨"></a>æŸ¥çœ‹è¿è¡ŒçŠ¶æ€çš„å®¹å™¨</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">root@ubuntu:~<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class="line">root@ubuntu:~<span class="comment">#</span></span><br></pre></td></tr></table></figure>



<p>æŸ¥çœ‹æ‰€æœ‰çŠ¶æ€çš„å®¹å™¨</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker ps -a</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                     PORTS               NAMES</span><br><span class="line">9c6fd12bef22        hello-world         <span class="string">"/hello"</span>            4 minutes ago       Exited (0) 4 minutes ago                       wizardly_mccarthy</span><br><span class="line">root@ubuntu:~<span class="comment">#</span></span><br></pre></td></tr></table></figure>



<h1 id="æ›´æ”¹å®¹å™¨åç§°"><a href="#æ›´æ”¹å®¹å™¨åç§°" class="headerlink" title="æ›´æ”¹å®¹å™¨åç§°"></a>æ›´æ”¹å®¹å™¨åç§°</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker run --name "sayHi" hello-world</span></span><br><span class="line">root@ubuntu:~<span class="comment"># docker ps -a</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                     PORTS               NAMES</span><br><span class="line">a74123af6f47        hello-world         <span class="string">"/hello"</span>            5 seconds ago       Exited (0) 4 seconds ago                       sayHi</span><br><span class="line">9c6fd12bef22        hello-world         <span class="string">"/hello"</span>            7 minutes ago       Exited (0) 7 minutes ago                       wizardly_mccarthy</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      

      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://docs.lvrui.io/2017/04/01/nginx%E9%85%8D%E7%BD%AEhttp%E5%BC%BA%E5%88%B6%E8%B7%B3%E8%BD%AChttps/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.JPG">
      <meta itemprop="name" content="æåœ°ç‘é›ª">
      <meta itemprop="description" content="æåœ°ç‘é›ªçš„ä¸ªäººæŠ€æœ¯åšå®¢. "å–ä¹‹å¼€æº ç”¨ä¹‹å¼€æº", åˆ†äº«è‡ªå·±çš„ç»éªŒä¹‹è°ˆ".">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Polar Snow Documentation">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/04/01/nginx%E9%85%8D%E7%BD%AEhttp%E5%BC%BA%E5%88%B6%E8%B7%B3%E8%BD%AChttps/" class="post-title-link" itemprop="url">nginxé…ç½®httpå¼ºåˆ¶è·³è½¬https</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2017-04-01 14:44:11" itemprop="dateCreated datePublished" datetime="2017-04-01T14:44:11+08:00">2017-04-01</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqusï¼š</span>
    
    <a title="disqus" href="/2017/04/01/nginx%E9%85%8D%E7%BD%AEhttp%E5%BC%BA%E5%88%B6%E8%B7%B3%E8%BD%AChttps/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/04/01/nginxé…ç½®httpå¼ºåˆ¶è·³è½¬https/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>å¾ˆå¤šç½‘ç«™è™½ç„¶æ”¯æŒ https, ä½†æ˜¯ç›´æ¥åœ¨æµè§ˆå™¨åœ°å€æ è¾“å…¥ç½‘å€å, é»˜è®¤ä»æ˜¯ä»¥ http åè®®å»è®¿é—®çš„, http å¼ºåˆ¶è·³è½¬ https çš„éœ€æ±‚åº”è¿è€Œç”Ÿ, ä»¥ä¸‹ä»‹ç»ä¸‰ç§å®ç°çš„æ–¹å¼</p>
</blockquote>
<h1 id="rewrite-æ–¹æ³•"><a href="#rewrite-æ–¹æ³•" class="headerlink" title="rewrite æ–¹æ³•"></a>rewrite æ–¹æ³•</h1><p>è¿™æ˜¯æœ€å¸¸ç”¨çš„å®ç°æ–¹æ³•, å°†æ‰€æœ‰ http è¯·æ±‚é€šè¿‡ rewrite é‡å®šå‘åˆ° https å³å¯</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">server &#123;  </span><br><span class="line">    listen  80;</span><br><span class="line">    server_name docs.lvrui.io</span><br><span class="line">      </span><br><span class="line">    rewrite ^(.*)$  https:&#x2F;&#x2F;$host$1 permanent;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen 443 ssl;</span><br><span class="line">    server_name docs.lvrui.io;</span><br><span class="line">    index index.html index.htm;</span><br><span class="line">    access_log  &#x2F;var&#x2F;log&#x2F;nginx&#x2F;docs.log  main;</span><br><span class="line">    ssl on;</span><br><span class="line">    ssl_certificate &#x2F;etc&#x2F;ssl&#x2F;docs.20150509.cn.crt;</span><br><span class="line">    ssl_certificate_key  &#x2F;etc&#x2F;ssl&#x2F;docs.20150509.cn.key;</span><br><span class="line">    error_page 404 &#x2F;404.html;</span><br><span class="line">    location &#x2F; &#123;</span><br><span class="line">	    root &#x2F;var&#x2F;www&#x2F;html&#x2F;docs;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="497-çŠ¶æ€ç "><a href="#497-çŠ¶æ€ç " class="headerlink" title="497 çŠ¶æ€ç "></a>497 çŠ¶æ€ç </h1><p>error code 497: normal request was sent to HTTPS</p>
<p>åœ¨ä¸€ä¸ªç«™ç‚¹åªå…è®¸ https è®¿é—®æ—¶, å¦‚æœä½¿ç”¨ http è®¿é—®ä¼šæŠ¥å‡º497é”™è¯¯ç </p>
<p>åˆ©ç”¨497çŠ¶æ€ç é‡å®šå‘åˆ° https</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name docs.lvrui.io</span><br><span class="line">    </span><br><span class="line">    error_page 497  https:&#x2F;&#x2F;$host$uri?$args;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen 443 ssl;</span><br><span class="line">    server_name docs.lvrui.io;</span><br><span class="line">    index index.html index.htm;</span><br><span class="line">    access_log  &#x2F;var&#x2F;log&#x2F;nginx&#x2F;docs.log  main;</span><br><span class="line">    ssl on;</span><br><span class="line">    ssl_certificate &#x2F;etc&#x2F;ssl&#x2F;docs.20150509.cn.crt;</span><br><span class="line">    ssl_certificate_key  &#x2F;etc&#x2F;ssl&#x2F;docs.20150509.cn.key;</span><br><span class="line">    error_page 404 &#x2F;404.html;</span><br><span class="line">    location &#x2F; &#123;</span><br><span class="line">	    root &#x2F;var&#x2F;www&#x2F;html&#x2F;docs;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="index-html-åˆ·æ–°ç½‘é¡µ"><a href="#index-html-åˆ·æ–°ç½‘é¡µ" class="headerlink" title="index.html åˆ·æ–°ç½‘é¡µ"></a>index.html åˆ·æ–°ç½‘é¡µ</h1><p>ä¸Šé¢ä¸¤ç§æ–¹æ³•å‡ä¼šè€—è´¹æœåŠ¡å™¨èµ„æº, æˆ‘ä»¬ä½¿ç”¨ <code>curl</code> æ¥çœ‹ä¸‹ç™¾åº¦æ˜¯å¦‚ä½•å®ç°çš„ <code>baidu.com</code> å‘ <code>www.baidu.com</code> çš„è·³è½¬</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">$ curl baidu.com -vv </span><br><span class="line">* Rebuilt URL to: baidu.com/</span><br><span class="line">*   Trying 220.181.57.217...</span><br><span class="line">* TCP_NODELAY <span class="built_in">set</span></span><br><span class="line">* Connected to baidu.com (220.181.57.217) port 80 (<span class="comment">#0)</span></span><br><span class="line">&gt; GET / HTTP/1.1</span><br><span class="line">&gt; Host: baidu.com</span><br><span class="line">&gt; User-Agent: curl/7.51.0</span><br><span class="line">&gt; Accept: */*</span><br><span class="line">&gt; </span><br><span class="line">&lt; HTTP/1.1 200 OK</span><br><span class="line">&lt; Date: Sat, 01 Apr 2017 06:32:35 GMT</span><br><span class="line">&lt; Server: Apache</span><br><span class="line">&lt; Last-Modified: Tue, 12 Jan 2010 13:48:00 GMT</span><br><span class="line">&lt; ETag: <span class="string">"51-47cf7e6ee8400"</span></span><br><span class="line">&lt; Accept-Ranges: bytes</span><br><span class="line">&lt; Content-Length: 81</span><br><span class="line">&lt; Cache-Control: max-age=86400</span><br><span class="line">&lt; Expires: Sun, 02 Apr 2017 06:32:35 GMT</span><br><span class="line">&lt; Connection: Keep-Alive</span><br><span class="line">&lt; Content-Type: text/html</span><br><span class="line">&lt; </span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">"refresh"</span> content=<span class="string">"0;url=http://www.baidu.com/"</span>&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line">* Curl_http_done: called premature == 0</span><br><span class="line">* Connection <span class="comment">#0 to host baidu.com left intact</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ç™¾åº¦å¾ˆå·§å¦™çš„åˆ©ç”¨metaçš„åˆ·æ–°ä½œç”¨ï¼Œå°†baidu.comè·³è½¬åˆ°<a href="http://www.baidu.com" target="_blank" rel="noopener">www.baidu.com</a></p>
<p>åŒç†, æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨è¿™ä¸ªç‰¹æ€§æ¥å®ç° http å‘ https çš„è·³è½¬</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># index.html</span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"refresh"</span> <span class="attr">content</span>=<span class="string">"0;url=https://docs.lvrui.io/"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name docs.lvrui.io;</span><br><span class="line">    </span><br><span class="line">    location &#x2F; &#123;</span><br><span class="line">        # å°† index.html æ–‡ä»¶æ”¾åˆ°ä¸‹é¢çš„ç›®å½•ä¸‹</span><br><span class="line">        root &#x2F;var&#x2F;www&#x2F;html&#x2F;refresh&#x2F;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen 443 ssl;</span><br><span class="line">    server_name docs.lvrui.io;</span><br><span class="line">    index index.html index.htm;</span><br><span class="line">    access_log  &#x2F;var&#x2F;log&#x2F;nginx&#x2F;docs.log  main;</span><br><span class="line">    ssl on;</span><br><span class="line">    ssl_certificate &#x2F;etc&#x2F;ssl&#x2F;docs.20150509.cn.crt;</span><br><span class="line">    ssl_certificate_key  &#x2F;etc&#x2F;ssl&#x2F;docs.20150509.cn.key;</span><br><span class="line">    error_page 404 &#x2F;404.html;</span><br><span class="line">    location &#x2F; &#123;</span><br><span class="line">	    root &#x2F;var&#x2F;www&#x2F;html&#x2F;docs;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      

      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

  </div>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/20/"><i class="fa fa-angle-left" aria-label="ä¸Šä¸€é¡µ"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/20/">20</a><span class="page-number current">21</span><a class="page-number" href="/page/22/">22</a><span class="space">&hellip;</span><a class="page-number" href="/page/58/">58</a><a class="extend next" rel="next" href="/page/22/"><i class="fa fa-angle-right" aria-label="ä¸‹ä¸€é¡µ"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="æåœ°ç‘é›ª"
      src="/images/avatar.JPG">
  <p class="site-author-name" itemprop="name">æåœ°ç‘é›ª</p>
  <div class="site-description" itemprop="description">æåœ°ç‘é›ªçš„ä¸ªäººæŠ€æœ¯åšå®¢. "å–ä¹‹å¼€æº ç”¨ä¹‹å¼€æº", åˆ†äº«è‡ªå·±çš„ç»éªŒä¹‹è°ˆ".</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">573</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">14</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">373</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/Larry0315" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;Larry0315" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:polarsnow@lvrui.io" title="E-Mail â†’ mailto:polarsnow@lvrui.io" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title">
      <i class="fa fa-fw fa-link"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://www.lvrui.io/" title="https:&#x2F;&#x2F;www.lvrui.io" rel="noopener" target="_blank">www.lvrui.io</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://20150509.cn/" title="https:&#x2F;&#x2F;20150509.cn" rel="noopener" target="_blank">20150509.cn</a>
        </li>
    </ul>
  </div>

      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        
  <div class="beian"><a href="http://www.beian.miit.gov.cn/" rel="noopener" target="_blank">å†€ICPå¤‡15013857å·-2 </a>
  </div>

<div class="copyright">
  
  &copy; 2015 â€“ 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">æåœ°ç‘é›ª</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  
  <script>
    (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      bp.src = (curProtocol === 'https') ? 'https://zz.bdstatic.com/linksubmit/push.js' : 'http://push.zhanzhang.baidu.com/push.js';
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>




  
<script src="/js/local-search.js"></script>











<script>
if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme    : 'forest',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    });
  }, window.mermaid);
}
</script>


  

  

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://polarsnow.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>

</body>
</html>
