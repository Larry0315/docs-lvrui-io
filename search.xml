<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>goè¯­è¨€ä¼˜ç§€çš„æ—¥å¿—åŒ…zapé¢„ç½®å‡½æ•°ç”¨æ³•</title>
    <url>/2020/03/21/go%E8%AF%AD%E8%A8%80%E4%BC%98%E7%A7%80%E7%9A%84%E6%97%A5%E5%BF%97%E5%8C%85zap%E9%A2%84%E7%BD%AE%E5%87%BD%E6%95%B0%E7%94%A8%E6%B3%95/</url>
    <content><![CDATA[<blockquote>
<p>zap å’Œ logrus æ˜¯ go è¯­è¨€ä¸­æ—¥å¿—åŒ…çš„ä½¼ä½¼è€…. ä¸¤è€…éƒ½æ¨èä½¿ç”¨ç»“æ„åŒ–çš„æ—¥å¿—æ‰“å°, ä»é€Ÿåº¦ä¸Šæ¥è¯´, zap è¦æ¯” logrus å¿«å¾ˆå¤š. zap çš„å®˜æ–¹æ¡ˆä¾‹ä¸­, ä»‹ç»äº†ä¸‰ç§ä½¿ç”¨æ–¹å¼, åˆ†åˆ«æ˜¯ <code>AdvancedConfiguration</code> <code>BasicConfiguration</code> å’Œ <code>Presets</code> æœ¬ç¯‡æ–‡ç« ä»‹ç» zap åŒ…çš„ Presets ç”¨æ³•</p>
</blockquote>
<a id="more"></a>

<p>Presets(é¢„ç½®å‡½æ•°) æ˜¯ zap æ—¥å¿—åŒ…æœ€ç®€å•çš„ç”¨æ³•, ä¸éœ€è¦è¿‡å¤šçš„è‡ªå®šä¹‰é…ç½®å°±å¯ä»¥ç”¨èµ·æ¥</p>
<h2 id="NewExample"><a href="#NewExample" class="headerlink" title="NewExample"></a>NewExample</h2><p>é¢„ç½®å‡½æ•° NewExample çš„æºç å®šä¹‰å¦‚ä¸‹</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewExample</span><span class="params">(options ...Option)</span> *<span class="title">Logger</span></span> &#123;</span><br><span class="line">	encoderCfg := zapcore.EncoderConfig&#123;</span><br><span class="line">		MessageKey:     <span class="string">"msg"</span>,</span><br><span class="line">		LevelKey:       <span class="string">"level"</span>,</span><br><span class="line">		NameKey:        <span class="string">"logger"</span>,</span><br><span class="line">		EncodeLevel:    zapcore.LowercaseLevelEncoder,</span><br><span class="line">		EncodeTime:     zapcore.ISO8601TimeEncoder,</span><br><span class="line">		EncodeDuration: zapcore.StringDurationEncoder,</span><br><span class="line">	&#125;</span><br><span class="line">	core := zapcore.NewCore(zapcore.NewJSONEncoder(encoderCfg), os.Stdout, DebugLevel)</span><br><span class="line">	<span class="keyword">return</span> New(core).WithOptions(options...)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°, é¢„ç½®å‡½æ•°ä¸ºæˆ‘ä»¬é…ç½®äº†ä»¥ä¸Šå†…å®¹, åŒ…æ‹¬</p>
<ul>
<li>å„ä¸ªå­—æ®µçš„åç§°</li>
<li>æ—¥å¿—çº§åˆ«çš„æ˜¾ç¤ºå½¢å¼</li>
<li>æ—¶é—´ç¼–ç ç±»å‹</li>
<li>åºåˆ—åŒ–æ—¶é—´çš„æ–¹å¼</li>
<li>è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡º</li>
<li>ä»¥jsonå½¢å¼æ‰“å°</li>
<li>æ—¥å¿—æ‰“å°çº§åˆ«ä¸ºDebug</li>
</ul>
<p><code>NewExample</code> è¾“å‡ºä¿¡æ¯æ¯”è¾ƒå°‘, æ‰“å°å†…å®¹æ¯”è¾ƒè¯¦ç»†, ä¸€èˆ¬ç”¨äºå¼€å‘æ—¶ä¸´æ—¶è°ƒè¯•ä½¿ç”¨</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"go.uber.org/zap"</span></span><br><span class="line">	<span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	logger := zap.NewExample()</span><br><span class="line">	<span class="keyword">defer</span> logger.Sync()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">const</span> url = <span class="string">"http://example.com"</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// sugar ç‰ˆæœ¬çš„ logger</span></span><br><span class="line">	sugar := logger.Sugar()</span><br><span class="line">	sugar.Infow(<span class="string">"Failed to fetch URL."</span>,</span><br><span class="line">		<span class="string">"url"</span>, url,</span><br><span class="line">		<span class="string">"attempt"</span>, <span class="number">3</span>,</span><br><span class="line">		<span class="string">"backoff"</span>, time.Second,</span><br><span class="line">	)</span><br><span class="line">	sugar.Infof(<span class="string">"Failed to fetch URL: %s"</span>, url)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// æé€Ÿç‰ˆ logger</span></span><br><span class="line">	logger.Info(<span class="string">"Failed to fetch URL."</span>,</span><br><span class="line">		zap.String(<span class="string">"url"</span>, url),</span><br><span class="line">		zap.Int(<span class="string">"attempt"</span>, <span class="number">3</span>),</span><br><span class="line">		zap.Duration(<span class="string">"backoff"</span>, time.Second),</span><br><span class="line">	)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&quot;level&quot;:&quot;info&quot;,&quot;msg&quot;:&quot;Failed to fetch URL.&quot;,&quot;url&quot;:&quot;http:&#x2F;&#x2F;example.com&quot;,&quot;attempt&quot;:3,&quot;backoff&quot;:&quot;1s&quot;&#125;</span><br><span class="line">&#123;&quot;level&quot;:&quot;info&quot;,&quot;msg&quot;:&quot;Failed to fetch URL: http:&#x2F;&#x2F;example.com&quot;&#125;</span><br><span class="line">&#123;&quot;level&quot;:&quot;info&quot;,&quot;msg&quot;:&quot;Failed to fetch URL.&quot;,&quot;url&quot;:&quot;http:&#x2F;&#x2F;example.com&quot;,&quot;attempt&quot;:3,&quot;backoff&quot;:&quot;1s&quot;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="NewDevelopment"><a href="#NewDevelopment" class="headerlink" title="NewDevelopment"></a>NewDevelopment</h2><p>é¢„ç½®å‡½æ•° NewDevelopment çš„æºç å®šä¹‰å¦‚ä¸‹</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewDevelopment</span><span class="params">(options ...Option)</span> <span class="params">(*Logger, error)</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> NewDevelopmentConfig().Build(options...)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewDevelopmentConfig</span><span class="params">()</span> <span class="title">Config</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> Config&#123;</span><br><span class="line">		Level:            NewAtomicLevelAt(DebugLevel),</span><br><span class="line">		Development:      <span class="literal">true</span>,</span><br><span class="line">		Encoding:         <span class="string">"console"</span>,</span><br><span class="line">		EncoderConfig:    NewDevelopmentEncoderConfig(),</span><br><span class="line">		OutputPaths:      []<span class="keyword">string</span>&#123;<span class="string">"stderr"</span>&#125;,</span><br><span class="line">		ErrorOutputPaths: []<span class="keyword">string</span>&#123;<span class="string">"stderr"</span>&#125;,</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewDevelopmentEncoderConfig</span><span class="params">()</span> <span class="title">zapcore</span>.<span class="title">EncoderConfig</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> zapcore.EncoderConfig&#123;</span><br><span class="line">		<span class="comment">// Keys can be anything except the empty string.</span></span><br><span class="line">		TimeKey:        <span class="string">"T"</span>,</span><br><span class="line">		LevelKey:       <span class="string">"L"</span>,</span><br><span class="line">		NameKey:        <span class="string">"N"</span>,</span><br><span class="line">		CallerKey:      <span class="string">"C"</span>,</span><br><span class="line">		MessageKey:     <span class="string">"M"</span>,</span><br><span class="line">		StacktraceKey:  <span class="string">"S"</span>,</span><br><span class="line">		LineEnding:     zapcore.DefaultLineEnding,</span><br><span class="line">		EncodeLevel:    zapcore.CapitalLevelEncoder,</span><br><span class="line">		EncodeTime:     zapcore.ISO8601TimeEncoder,</span><br><span class="line">		EncodeDuration: zapcore.StringDurationEncoder,</span><br><span class="line">		EncodeCaller:   zapcore.ShortCallerEncoder,</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(cfg Config)</span> <span class="title">Build</span><span class="params">(opts ...Option)</span> <span class="params">(*Logger, error)</span></span> &#123;</span><br><span class="line">	enc, err := cfg.buildEncoder()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	sink, errSink, err := cfg.openSinks()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> cfg.Level == (AtomicLevel&#123;&#125;) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, fmt.Errorf(<span class="string">"missing Level"</span>)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	log := New(</span><br><span class="line">		zapcore.NewCore(enc, sink, cfg.Level),</span><br><span class="line">		cfg.buildOptions(errSink)...,</span><br><span class="line">	)</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(opts) &gt; <span class="number">0</span> &#123;</span><br><span class="line">		log = log.WithOptions(opts...)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> log, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>NewDevelopment</code> æ‰“å°å†…å®¹æ¯”è¾ƒè¯¦ç»†(debug level), è¾“å‡ºæ ¼å¼ä¸º<code>console</code></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"go.uber.org/zap"</span></span><br><span class="line">	<span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	logger, err := zap.NewDevelopment()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> logger.Sync()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">const</span> url = <span class="string">"http://example.com"</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// sugar ç‰ˆæœ¬çš„ logger</span></span><br><span class="line">	sugar := logger.Sugar()</span><br><span class="line">	sugar.Infow(<span class="string">"Failed to fetch URL."</span>,</span><br><span class="line">		<span class="string">"url"</span>, url,</span><br><span class="line">		<span class="string">"attempt"</span>, <span class="number">3</span>,</span><br><span class="line">		<span class="string">"backoff"</span>, time.Second,</span><br><span class="line">	)</span><br><span class="line">	sugar.Infof(<span class="string">"Failed to fetch URL: %s"</span>, url)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// æé€Ÿç‰ˆ logger</span></span><br><span class="line">	logger.Info(<span class="string">"Failed to fetch URL."</span>,</span><br><span class="line">		zap.String(<span class="string">"url"</span>, url),</span><br><span class="line">		zap.Int(<span class="string">"attempt"</span>, <span class="number">3</span>),</span><br><span class="line">		zap.Duration(<span class="string">"backoff"</span>, time.Second),</span><br><span class="line">	)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">2020-03-17T22:52:45.665+0800    INFO    log&#x2F;l2.go:19    Failed to fetch URL.    &#123;&quot;url&quot;: &quot;http:&#x2F;&#x2F;example.com&quot;, &quot;attempt&quot;: 3, &quot;backoff&quot;: &quot;1s&quot;&#125;</span><br><span class="line">2020-03-17T22:52:45.666+0800    INFO    log&#x2F;l2.go:24    Failed to fetch URL: http:&#x2F;&#x2F;example.com</span><br><span class="line">2020-03-17T22:52:45.666+0800    INFO    log&#x2F;l2.go:27    Failed to fetch URL.    &#123;&quot;url&quot;: &quot;http:&#x2F;&#x2F;example.com&quot;, &quot;attempt&quot;: 3, &quot;backoff&quot;: &quot;1s&quot;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="NewProduction"><a href="#NewProduction" class="headerlink" title="NewProduction"></a>NewProduction</h2><p> æºç å¦‚ä¸‹</p>
 <figure class="highlight go"><table><tr><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">func</span> <span class="title">NewProduction</span><span class="params">(options ...Option)</span> <span class="params">(*Logger, error)</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> NewProductionConfig().Build(options...)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewProductionConfig</span><span class="params">()</span> <span class="title">Config</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> Config&#123;</span><br><span class="line">		Level:       NewAtomicLevelAt(InfoLevel),</span><br><span class="line">		Development: <span class="literal">false</span>,</span><br><span class="line">		Sampling: &amp;SamplingConfig&#123;</span><br><span class="line">			Initial:    <span class="number">100</span>,</span><br><span class="line">			Thereafter: <span class="number">100</span>,</span><br><span class="line">		&#125;,</span><br><span class="line">		Encoding:         <span class="string">"json"</span>,</span><br><span class="line">		EncoderConfig:    NewProductionEncoderConfig(),</span><br><span class="line">		OutputPaths:      []<span class="keyword">string</span>&#123;<span class="string">"stderr"</span>&#125;,</span><br><span class="line">		ErrorOutputPaths: []<span class="keyword">string</span>&#123;<span class="string">"stderr"</span>&#125;,</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewProductionEncoderConfig</span><span class="params">()</span> <span class="title">zapcore</span>.<span class="title">EncoderConfig</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> zapcore.EncoderConfig&#123;</span><br><span class="line">		TimeKey:        <span class="string">"ts"</span>,</span><br><span class="line">		LevelKey:       <span class="string">"level"</span>,</span><br><span class="line">		NameKey:        <span class="string">"logger"</span>,</span><br><span class="line">		CallerKey:      <span class="string">"caller"</span>,</span><br><span class="line">		MessageKey:     <span class="string">"msg"</span>,</span><br><span class="line">		StacktraceKey:  <span class="string">"stacktrace"</span>,</span><br><span class="line">		LineEnding:     zapcore.DefaultLineEnding,</span><br><span class="line">		EncodeLevel:    zapcore.LowercaseLevelEncoder,</span><br><span class="line">		EncodeTime:     zapcore.EpochTimeEncoder,</span><br><span class="line">		EncodeDuration: zapcore.SecondsDurationEncoder,</span><br><span class="line">		EncodeCaller:   zapcore.ShortCallerEncoder,</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(cfg Config)</span> <span class="title">Build</span><span class="params">(opts ...Option)</span> <span class="params">(*Logger, error)</span></span> &#123;</span><br><span class="line">	enc, err := cfg.buildEncoder()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	sink, errSink, err := cfg.openSinks()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> cfg.Level == (AtomicLevel&#123;&#125;) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, fmt.Errorf(<span class="string">"missing Level"</span>)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	log := New(</span><br><span class="line">		zapcore.NewCore(enc, sink, cfg.Level),</span><br><span class="line">		cfg.buildOptions(errSink)...,</span><br><span class="line">	)</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(opts) &gt; <span class="number">0</span> &#123;</span><br><span class="line">		log = log.WithOptions(opts...)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> log, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> <code>NewProduction</code> çš„æ—¥å¿—çº§åˆ«æé«˜åˆ°äº†info level, è€Œä¸”é»˜è®¤ä½¿ç”¨äº†ç»“æ„åŒ–æ›´å‹å¥½çš„jsonæ ¼å¼è¾“å‡ºæ—¥å¿—, è¯¥é¢„ç½®å‡½æ•°, é€‚ç”¨äºç”Ÿäº§ç¯å¢ƒ, ç¨‹åºä¸Šçº¿åä½¿ç”¨</p>
 <figure class="highlight go"><table><tr><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	logger, err := zap.NewProduction()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> logger.Sync()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">const</span> url = <span class="string">"http://example.com"</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// sugar ç‰ˆæœ¬çš„ logger</span></span><br><span class="line">	sugar := logger.Sugar()</span><br><span class="line">	sugar.Infow(<span class="string">"Failed to fetch URL."</span>,</span><br><span class="line">		<span class="string">"url"</span>, url,</span><br><span class="line">		<span class="string">"attempt"</span>, <span class="number">3</span>,</span><br><span class="line">		<span class="string">"backoff"</span>, time.Second,</span><br><span class="line">	)</span><br><span class="line">	sugar.Infof(<span class="string">"Failed to fetch URL: %s"</span>, url)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// æé€Ÿç‰ˆ logger</span></span><br><span class="line">	logger.Info(<span class="string">"Failed to fetch URL."</span>,</span><br><span class="line">		zap.String(<span class="string">"url"</span>, url),</span><br><span class="line">		zap.Int(<span class="string">"attempt"</span>, <span class="number">3</span>),</span><br><span class="line">		zap.Duration(<span class="string">"backoff"</span>, time.Second),</span><br><span class="line">	)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> æ‰§è¡Œç»“æœ</p>
 <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&quot;level&quot;:&quot;info&quot;,&quot;ts&quot;:1584457473.942979,&quot;caller&quot;:&quot;log&#x2F;l2.go:19&quot;,&quot;msg&quot;:&quot;Failed to fetch URL.&quot;,&quot;url&quot;:&quot;http:&#x2F;&#x2F;example.com&quot;,&quot;attempt&quot;:3,&quot;backoff&quot;:1&#125;</span><br><span class="line">&#123;&quot;level&quot;:&quot;info&quot;,&quot;ts&quot;:1584457473.943102,&quot;caller&quot;:&quot;log&#x2F;l2.go:24&quot;,&quot;msg&quot;:&quot;Failed to fetch URL: http:&#x2F;&#x2F;example.com&quot;&#125;</span><br><span class="line">&#123;&quot;level&quot;:&quot;info&quot;,&quot;ts&quot;:1584457473.943125,&quot;caller&quot;:&quot;log&#x2F;l2.go:27&quot;,&quot;msg&quot;:&quot;Failed to fetch URL.&quot;,&quot;url&quot;:&quot;http:&#x2F;&#x2F;example.com&quot;,&quot;attempt&quot;:3,&quot;backoff&quot;:1&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Go</category>
      </categories>
      <tags>
        <tag>log</tag>
        <tag>zap</tag>
        <tag>æ—¥å¿—</tag>
      </tags>
  </entry>
  <entry>
    <title>goè¯­è¨€structä¸­çš„åŒ¿åå­—æ®µä¸ç»„åˆ</title>
    <url>/2019/04/20/go%E8%AF%AD%E8%A8%80struct%E4%B8%AD%E7%9A%84%E5%8C%BF%E5%90%8D%E5%AD%97%E6%AE%B5%E4%B8%8E%E7%BB%84%E5%90%88/</url>
    <content><![CDATA[<blockquote>
<p>å¾ˆå¤šæ–‡æ¡£ä¸­éƒ½åå¤å¼ºè°ƒäº†, goè¯­è¨€ä¸­æ²¡æœ‰ç»§æ‰¿, åªæœ‰ç»„åˆ, æ´»ç”¨ç»„åˆçš„ç‰¹æ€§å¯ä»¥è®©ä»£ç æ›´åŠ ä¼˜é›…. åœ¨goè¯­è¨€ä¸­, structä¸­çš„åŒ¿åå­—æ®µå®ç°äº†ç»„åˆçš„ç‰¹æ€§</p>
</blockquote>
<a id="more"></a>

<h2 id="structåŒ¿åå­—æ®µ"><a href="#structåŒ¿åå­—æ®µ" class="headerlink" title="structåŒ¿åå­—æ®µ"></a>structåŒ¿åå­—æ®µ</h2><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> boy <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b boy)</span> <span class="title">eat</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"The boy is eating an apple"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> girl <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(g girl)</span> <span class="title">eat</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"The girl is eating an orange"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> human <span class="keyword">struct</span> &#123;</span><br><span class="line">	b boy</span><br><span class="line">	girl  <span class="comment">// åŒ¿åå­—æ®µ æ¥å£ä½“é‡åªå†™äº†æ•°æ®ç±»å‹çš„å­—æ®µå«åŒ¿åå­—æ®µ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ç»„åˆ"><a href="#ç»„åˆ" class="headerlink" title="ç»„åˆ"></a>ç»„åˆ</h2><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> boy <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b boy)</span> <span class="title">eat</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"The boy is eating an apple"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> girl <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(g girl)</span> <span class="title">eat</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"The girl is eating an orange"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> human <span class="keyword">struct</span> &#123;</span><br><span class="line">	b boy</span><br><span class="line">	girl  <span class="comment">// åŒ¿åå­—æ®µ</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> h human</span><br><span class="line">	h.b.eat()  </span><br><span class="line">	h.girl.eat()</span><br><span class="line">	h.eat()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">The boy is eating an apple</span><br><span class="line">The girl is eating an orange</span><br><span class="line">The girl is eating an orange</span><br></pre></td></tr></table></figure>

<p><code>h.b.eat()</code> çš„è¿è¡Œç»“æœ <code>The boy is eating an apple</code> æ˜¯ç¬¦åˆæˆ‘ä»¬çš„é¢„æœŸçš„. </p>
<p><code>h.girl.eat()</code> çš„è¿è¡Œç»“æœ <code>The girl is eating an orange</code> ä¹Ÿç¬¦åˆé¢„æœŸ, åªä¸è¿‡å› ä¸º<code>girl</code>åŒ¿åå­—æ®µ, æ²¡æœ‰å­—æ®µåç§°, æ‰€ä»¥è¿™é‡Œå¯ä»¥ä½¿ç”¨æ•°æ®ç±»å‹æ¥è°ƒç”¨å…¶å†…éƒ¨çš„<code>eat</code>å‡½æ•°</p>
<p><code>h.eat()</code> è¿™ä¸ªå‡½æ•°è°ƒç”¨æ¯”è¾ƒå¥‡æ€ª, æ­£å¸¸æƒ…å†µä¸‹, åº”è¯¥æ˜¯å®šä¹‰åœ¨<code>human</code>ä¸‹çš„<code>eat</code>æ–¹æ³•æ‰èƒ½è¢«æˆ‘ä»¬ç›´æ¥è°ƒç”¨, ä½†æ˜¯è¿™é‡Œ, åœ¨<code>human</code>æ²¡æœ‰ç›´æ¥å®šä¹‰<code>eat</code>æ–¹æ³•çš„æƒ…å†µä¸‹, <code>eat</code>å‡½æ•°ä¾ç„¶è¢«æ‰§è¡ŒæˆåŠŸ, è€Œä¸”è¾“å‡ºçš„ç»“æœä¸<code>h.girl.eat()</code>çš„ç»“æœç›¸åŒ</p>
<p>è¿™å°±æ˜¯ç»„åˆ, ä½¿ç”¨åŒ¿åå­—æ®µå®ç°çš„ç»„åˆ. ä½¿ç”¨ç»„åˆå, åŒ¿åå­—æ®µæ‹¥æœ‰çš„æ‰€æœ‰æ–¹æ³•éƒ½å¯ä»¥ç›´æ¥è¢«è°ƒç”¨, è€Œæ— éœ€åƒ<code>h.girl.eat()</code>è¿™æ ·å†™ä¸Šå­—æ®µç±»å‹æ¥è°ƒç”¨</p>
<h2 id="é‡å†™-é‡è½½"><a href="#é‡å†™-é‡è½½" class="headerlink" title="é‡å†™/é‡è½½"></a>é‡å†™/é‡è½½</h2><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> boy <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b boy)</span> <span class="title">eat</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"The boy is eating an apple"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> girl <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(g girl)</span> <span class="title">eat</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"The girl is eating an orange"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> human <span class="keyword">struct</span> &#123;</span><br><span class="line">	b boy</span><br><span class="line">	girl  <span class="comment">// åŒ¿åå­—æ®µ</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h human)</span> <span class="title">eat</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"The man is eating some strawberries"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> h human</span><br><span class="line">	h.b.eat()</span><br><span class="line">	h.girl.eat()</span><br><span class="line">	h.eat()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªdemoä»…æ¯”ä¸Šä¸ªä¾‹å­å¤šäº†ä¸€ä¸ª<code>human</code>çš„<code>eat</code>æ–¹æ³•</p>
<p>æ‰§è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">The boy is eating an apple</span><br><span class="line">The girl is eating an orange</span><br><span class="line">The man is eating some strawberries</span><br></pre></td></tr></table></figure>

<p>è¿™æ¬¡çš„æ‰§è¡Œç»“æœä¸­, <code>h.eat()</code> çš„æ‰§è¡Œç»“æœä¸å†æ˜¯ <code>The girl is eating an orange</code>, è€Œæ˜¯ <code>The man is eating some strawberries</code>. è¯´æ˜<code>human</code>ä¸‹å®šä¹‰çš„<code>eat</code>æ–¹æ³•é‡å†™äº†ç»„åˆä¸­åŒåçš„<code>eat</code>æ–¹æ³•, å½“è¯¥æ–¹æ³•è¢«ç›´æ¥è°ƒç”¨æ—¶, ä¼˜å…ˆæ‰§è¡Œ<code>human</code>ä¸‹çš„<code>eat</code>æ–¹æ³•. æ­¤æ—¶å¦‚æœè¿˜éœ€è¦æ‰§è¡Œ<code>girl</code>ä¸‹çš„<code>eat</code>æ–¹æ³•, åˆ™éœ€è¦å…ˆå¼•ç”¨å…¶æ•°æ®ç±»å‹, å†è°ƒç”¨<code>eat</code>æ–¹æ³• -&gt; <code>h.girl.eat()</code></p>
<p><img src="https://20150509.oss-cn-qingdao.aliyuncs.com/2020/02/20/15822044593973.jpg" alt=""></p>
<p>ç¼–è¾‘å™¨ä¸­ä¹Ÿä¼šæç¤ºä½ ä¸‹é¢çš„æ–¹æ³•é‡å†™äº†ä¸Šé¢çš„æ–¹æ³•</p>
]]></content>
      <categories>
        <category>Go</category>
      </categories>
      <tags>
        <tag>ç»„åˆ</tag>
        <tag>åŒ¿åå­—æ®µ</tag>
      </tags>
  </entry>
  <entry>
    <title>goè¯­è¨€å®ç°åŠ æƒè½®è¯¢è°ƒåº¦ç®—æ³•</title>
    <url>/2019/04/11/go%E8%AF%AD%E8%A8%80%E5%AE%9E%E7%8E%B0%E5%8A%A0%E6%9D%83%E8%BD%AE%E8%AF%A2%E8%B0%83%E5%BA%A6%E7%AE%97%E6%B3%95/</url>
    <content><![CDATA[<blockquote>
<p>ä¸Šç¯‡æ–‡ç« ä¸­ä»‹ç»äº†è½®è¯¢è°ƒåº¦ç®—æ³•, å¿½ç•¥åç«¯å…ƒç´ çš„å·®å¼‚æ€§, å°†è¯·æ±‚å‡åŒ€çš„â€æ¶‚æŠ¹â€åˆ°åç«¯èŠ‚ç‚¹. æœ¬ç¯‡ä»‹ç»æ›´ä¸ºå¤æ‚çš„åŠ æƒè½®è¯¢è°ƒåº¦ç®—æ³•, å¯ä»¥æ ¹æ®åç«¯èŠ‚ç‚¹å®é™…æ‰¿è½½èƒ½åŠ›, å•ç‹¬è°ƒæ•´æ¯ä¸ªèŠ‚ç‚¹çš„æƒé‡</p>
</blockquote>
<a id="more"></a>

<h2 id="æ¼”ç¤ºæ€è·¯"><a href="#æ¼”ç¤ºæ€è·¯" class="headerlink" title="æ¼”ç¤ºæ€è·¯"></a>æ¼”ç¤ºæ€è·¯</h2><p>åœ¨ç¼–å†™ä»£ç å‰, å…ˆæ¥è¯´ä¸‹å®ç°åŠ æƒè½®è¯¢è°ƒåº¦ç®—æ³•çš„æ€è·¯. åŠ æƒè½®è¯¢, æ˜¯åœ¨è½®è¯¢çš„åŸºç¡€ä¹‹ä¸Š, åŠ ä¸Šäº†å¯¹æƒé‡å€¼çš„åˆ¤æ–­, å…ˆçœ‹ä¸‹ä¸‹é¢çš„æƒé‡é…ç½®å®ä¾‹:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">a    b    c    d</span><br><span class="line">-    -    -    -</span><br><span class="line">-    -    -    -</span><br><span class="line">-    -    -</span><br><span class="line">-    -    -</span><br><span class="line">          -</span><br><span class="line">          -</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢<code>a, b, c, d</code>å››ä¸ªåç«¯èŠ‚ç‚¹, é…ç½®çš„æƒé‡åˆ†åˆ«ä¸º<code>4, 4, 6, 2</code>. ä¹Ÿå°±æ˜¯è¯´, å½“æ­£å¥½æœ‰16ä¸ªè¯·æ±‚æ‰“è¿‡æ¥ä¹‹å, åç«¯å®é™…è¢«è°ƒåº¦çš„æ¬¡æ•°åº”è¯¥å°±æ˜¯<code>4, 4, 6, 2</code></p>
<p>å®ç°åŠ æƒè½®è¯¢ç®—æ³•çš„æ ¸å¿ƒ, ä¾ç„¶ç¦»ä¸å¼€è½®è¯¢è°ƒåº¦ç®—æ³•, ä¾ç„¶éœ€è¦å‰ç¯‡æ–‡ç« ä»‹ç»çš„è½®è¯¢è°ƒåº¦ç®—æ³•æ¥æ§åˆ¶ç´¢å¼•ä¸‹æ ‡. ç¬¬ä¸€æ­¥, æˆ‘ä»¬å…ˆæ‰¾å‡ºåç«¯æ‰€æœ‰å…ƒç´ é…ç½®çš„æœ€å¤§æƒé‡, ç»“æœæ˜¯: æœ€å¤§æƒé‡ä¸º6, é‚£ä¹ˆæˆ‘ä»¬æœŸæœ›ç¬¬ä¸€æ¬¡çš„è°ƒåº¦ç»“æœå¦‚ä¸‹:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">a    b    c    d</span><br><span class="line">-    -    -    -</span><br><span class="line">-    -    -    -</span><br><span class="line">-    -    -</span><br><span class="line">-    -    -</span><br><span class="line">          -</span><br><span class="line">          âœ”ï¸</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡è½®è¯¢è°ƒåº¦ç®—æ³•, ä¾æ¬¡åˆ¤æ–­å“ªä¸ªå…ƒç´ <code>&gt;=</code>æœ€å¤§æƒé‡å€¼<code>6</code>, å½“å†…å­˜å¾ªç¯åˆ°<code>c</code>å…ƒç´ æ—¶, æ¡ä»¶æ»¡è¶³, åˆ™ç¬¬ä¸€æ¬¡è°ƒåº¦çš„ç»“æœ, åœ¨ç®—æ³•å†…éƒ¨å¾ªç¯äº†3æ¬¡å, è¿”å›äº†<code>c</code>.  </p>
<p>å½“æœ‰ç¬¬äºŒæ¬¡è¯·æ±‚åˆ°è¾¾æ—¶, æœŸæœ›ç»“æœå¦‚ä¸‹:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">a    b    c    d</span><br><span class="line">-    -    -    -</span><br><span class="line">-    -    -    -</span><br><span class="line">-    -    -</span><br><span class="line">-    -    -</span><br><span class="line">          âœ”ï¸</span><br><span class="line">          âœ”ï¸</span><br></pre></td></tr></table></figure>

<p>æ“ä½œæµç¨‹åŒä¸Š, ä¾æ¬¡åˆ¤æ–­å“ªä¸ªå…ƒç´ çš„æƒé‡<code>&gt;=æœ€å¤§æƒé‡å€¼</code> <code>æœ€å¤§æƒé‡å€¼</code>æ­¤æ—¶<code>=8</code>, å†…éƒ¨å¼€å§‹è½®è¯¢, æ ¹æ®ä¸Šæ¬¡çš„ç´¢å¼•ä¸‹æ ‡ç»§ç»­å‘ä¸‹è½®è¯¢, ä¸Šæ¬¡è½®è¯¢åˆ°<code>c</code>, æœ¬æ¬¡å°†ä»<code>d</code>å¼€å§‹è½®è¯¢, <code>d</code>çš„å€¼ä¸æ»¡è¶³<code>&gt;=æœ€å¤§æƒé‡å€¼</code>çš„æ¡ä»¶, åº”è¯¥å›åˆ°<code>a</code>ç»§ç»­è½®è¯¢åˆ¤æ–­, ç›´åˆ°ç¬¦åˆæ¡ä»¶ä¸ºæ­¢. </p>
<p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯, å†å›åˆ°<code>a</code>ä¹‹å‰, åº”è¯¥å°†æœ€å¤§æƒé‡å€¼<code>-1</code>, å› ä¸ºåœ¨ä¸Šä¸€è½®çš„è½®è¯¢ä¸­, å·²ç»å°†<code>=æœ€å¤§æƒé‡å€¼</code>çš„å…ƒç´ æ¶ˆç­, æ‰€ä»¥éœ€è¦å°†<code>æœ€å¤§æƒé‡å€¼-1</code>, ç»§ç»­è½®è¯¢åˆ¤æ–­, æ˜¯å¦æœ‰æ»¡è¶³æ¡ä»¶çš„å…ƒç´ , æˆ‘ä»¬åœ¨è¿™é‡Œä¸´æ—¶å‘½åä¸º<code>å½“å‰æœ€å¤§æƒé‡å€¼(åé¢ç”¨cwè¡¨ç¤º)</code>, <code>-1</code>æ“ä½œå, <code>cw=5</code>.</p>
<p><code>c</code>å…ƒç´ çš„æƒé‡å€¼<code>6</code>ç¬¦åˆ<code>&gt;=5</code>çš„æ¡ä»¶. ç«‹å³è¿”å›, æ‰€ä»¥ç¬¬äºŒæ¬¡çš„è°ƒåº¦ç»“æœ, ä¾ç„¶æ˜¯<code>c</code>. </p>
<p>å½“æœ‰ç¬¬ä¸‰æ¬¡è¯·æ±‚åˆ°è¾¾æ—¶, æœŸæœ›ç»“æœå¦‚ä¸‹:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">a    b    c    d</span><br><span class="line">-    -    -    -</span><br><span class="line">-    -    -    -</span><br><span class="line">-    -    -</span><br><span class="line">âœ”ï¸   -    -</span><br><span class="line">          âœ”ï¸</span><br><span class="line">          âœ”ï¸</span><br></pre></td></tr></table></figure>

<p>åŒä¸Š, ä¾æ¬¡åˆ¤æ–­å“ªä¸ªå…ƒç´ çš„æƒé‡<code>&gt;=cw</code> <code>cw</code>æ­¤æ—¶<code>=5</code>, å¼€å§‹è½®è¯¢, ä¸Šæ¬¡è½®è¯¢åˆ°<code>c</code>, æœ¬æ¬¡ä»ä¸‹ä¸€ä¸ªå…ƒç´ <code>d</code>å¼€å§‹è½®è¯¢, <code>d</code>ä¸æ»¡è¶³æ¡ä»¶, æ­¤æ—¶ä¸€æ•´è½®è½®è¯¢ç»“æŸğŸ”š, å†æ¬¡å°†<code>cw-1</code>, æ­¤æ—¶<code>cw=4</code>. å¹¶ä»<code>a</code>å¼€å§‹é‡æ–°è½®è¯¢, å‘ç°<code>a</code>ç¬¦åˆ<code>&gt;=4</code>çš„æ¡ä»¶, ç«‹å³è¿”å›, æ‰€ä»¥ç¬¬ä¸‰æ¬¡çš„è°ƒåº¦ç»“æœä¸º<code>a</code>.</p>
<p>å½“æœ‰ç¬¬å››æ¬¡è¯·æ±‚åˆ°è¾¾æ—¶, æœŸæœ›ç»“æœå¦‚ä¸‹:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">a    b    c    d</span><br><span class="line">-    -    -    -</span><br><span class="line">-    -    -    -</span><br><span class="line">-    -    -</span><br><span class="line">âœ”ï¸   âœ”ï¸   -</span><br><span class="line">          âœ”ï¸</span><br><span class="line">          âœ”ï¸</span><br></pre></td></tr></table></figure>

<p>åŒä¸Š, æ­¤æ—¶<code>cw=4</code>, ä»<code>b</code>å…ƒç´ å¼€å§‹è½®è¯¢, <code>b</code>å³ç¬¦åˆæ¡ä»¶, ç«‹å³è¿”å›, æ‰€ä»¥ç¬¬å››æ¬¡è°ƒåº¦ç»“æœä¸º<code>b</code></p>
<p>ç¬¬äº”æ¬¡è¯·æ±‚, æœŸæœ›ç»“æœå¦‚ä¸‹:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">a    b    c    d</span><br><span class="line">-    -    -    -</span><br><span class="line">-    -    -    -</span><br><span class="line">-    -    -</span><br><span class="line">âœ”ï¸  âœ”ï¸   âœ”ï¸</span><br><span class="line">          âœ”ï¸</span><br><span class="line">          âœ”ï¸</span><br></pre></td></tr></table></figure>

<p>æ­¤æ—¶<code>cw=4</code>, ä»ä¸Šæ¬¡ç»“æŸçš„ä¸‹ä¸€ä¸ªå…ƒç´ å¼€å§‹è½®è¯¢, <code>c</code>å³ç¬¦åˆæ¡ä»¶, ç«‹å³è¿”å›, æ‰€ä»¥ç¬¬äº”æ¬¡è°ƒåº¦ç»“æœä¸º<code>c</code></p>
<p>ç¬¬å…­æ¬¡è¯·æ±‚, æœŸæœ›ç»“æœå¦‚ä¸‹:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">a    b    c    d</span><br><span class="line">-    -    -    -</span><br><span class="line">-    -    -    -</span><br><span class="line">âœ”ï¸   -    -</span><br><span class="line">âœ”ï¸  âœ”ï¸   âœ”ï¸</span><br><span class="line">          âœ”ï¸</span><br><span class="line">          âœ”ï¸</span><br></pre></td></tr></table></figure>

<p>æ­¤æ—¶<code>cw=4</code>, ä»ä¸Šæ¬¡ç»“æŸçš„ä¸‹ä¸€ä¸ªå…ƒç´ å¼€å§‹è½®è¯¢, <code>d</code>ä¸ç¬¦åˆ<code>&gt;=cw</code>æ¡ä»¶, æœ¬è½®è½®è¯¢ç»“æŸ, <code>cw-1</code>, æ­¤æ—¶<code>cw=3</code>, ä»<code>a</code>å…ƒç´ å¼€å§‹è½®è¯¢, <code>a</code>å³ç¬¦åˆ<code>&gt;=cw</code>æ¡ä»¶, æ‰€ä»¥ç¬¬å…­æ¬¡è°ƒåº¦ç»“æœä¸º<code>a</code></p>
<p>ä»¥æ­¤ç±»æ¨~ å½“æ‰€æœ‰çš„å…ƒç´ éƒ½è¢«è°ƒåº¦è¿‡ä¸€æ¬¡ä¹‹å, </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">a    b   c    d</span><br><span class="line">âœ”ï¸  âœ”ï¸  âœ”ï¸   âœ”ï¸</span><br><span class="line">âœ”ï¸  âœ”ï¸  âœ”ï¸   âœ”ï¸</span><br><span class="line">âœ”ï¸  âœ”ï¸  âœ”ï¸</span><br><span class="line">âœ”ï¸  âœ”ï¸  âœ”ï¸</span><br><span class="line">         âœ”ï¸</span><br><span class="line">         âœ”ï¸</span><br></pre></td></tr></table></figure>

<p>éœ€è¦å°†<code>cw</code>çš„é‡ç½®ä¸º<code>æœ€å¤§æƒé‡å€¼</code>, ä»¥ä¾›åç»­è¯·æ±‚é‡æ–°è°ƒåº¦</p>
<p>æ€»ç»“: æˆ‘ä»¬æ€»ç»“ä¸€ä¸‹ä¸Šé¢æµç¨‹çš„å…³é”®ç‚¹</p>
<ul>
<li>é€šè¿‡<code>i = (i + 1) mod n</code>è½®è¯¢æ¯ä¸ªå…ƒç´ (è¿™æ˜¯ä¸Šä¸€ç¯‡è½®è¯¢è°ƒåº¦ç®—æ³•çš„æ ¸å¿ƒ)</li>
<li>éœ€è¦å–å¾—æ‰€æœ‰å…ƒç´ ä¸­æœ€å¤§çš„æƒé‡å€¼</li>
<li>éœ€è¦å®šä¹‰ä¸€ä¸ªcw(current weight)å˜é‡, ç”¨æ¥è®°å½•æœ€æ–°çš„â€æœ€å¤§æƒé‡å€¼â€</li>
<li>æ¯æ¬¡æ‰€æœ‰çš„å…ƒç´ è¢«è½®è¯¢ä¸€æ¬¡å, éƒ½éœ€è¦å°†<code>cw-1</code></li>
<li>å½“<code>cw-1</code>ä¹‹åçš„å€¼<code>&lt;=0</code>æ—¶, æ„å‘³ç€æ‰€æœ‰çš„å…ƒç´ æŒ‰ç…§æƒé‡ä¹‹æ¯”, éƒ½å·²ç»è¢«è°ƒåº¦è¿‡ä¸€æ¬¡äº†, æ­¤æ—¶éœ€è¦å°†<code>cw</code>çš„å€¼é‡ç½®ä¸º<code>æœ€å¤§æƒé‡å€¼</code>, ä»¥ä¾›åç»­è¯·æ±‚é‡æ–°è°ƒåº¦</li>
</ul>
<h2 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h2><h3 id="step-0-å‰æœŸå‡†å¤‡"><a href="#step-0-å‰æœŸå‡†å¤‡" class="headerlink" title="step 0: å‰æœŸå‡†å¤‡"></a>step 0: å‰æœŸå‡†å¤‡</h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰å¸¦æƒé‡å±æ€§çš„å…ƒç´ ç»“æ„ä½“</span></span><br><span class="line"><span class="keyword">type</span> Volume <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name   <span class="keyword">string</span></span><br><span class="line">	Weight <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰å…ƒç´ é›†åˆç±»å‹</span></span><br><span class="line"><span class="keyword">type</span> Volumes []Volume</span><br><span class="line"><span class="comment">// GetMaxWeight è·å–Sliceä¸­æœ€å¤§æƒé‡å€¼</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Volumes)</span> <span class="title">GetMaxWeight</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	maxWeight := <span class="number">0</span></span><br><span class="line">	<span class="keyword">for</span> _, volume := <span class="keyword">range</span> v &#123;</span><br><span class="line">		<span class="keyword">if</span> maxWeight &lt; volume.Weight &#123;</span><br><span class="line">			maxWeight = volume.Weight</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> maxWeight</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// è°ƒåº¦ç´¢å¼•</span></span><br><span class="line"><span class="keyword">var</span> i = <span class="number">-1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// current weight è®°å½•å½“å‰è°ƒåº¦çš„æƒé‡å€¼</span></span><br><span class="line"><span class="keyword">var</span> cw = <span class="number">0</span></span><br></pre></td></tr></table></figure>

<h3 id="step-1-é¦–å…ˆå®ç°è½®è¯¢è°ƒåº¦ç®—æ³•"><a href="#step-1-é¦–å…ˆå®ç°è½®è¯¢è°ƒåº¦ç®—æ³•" class="headerlink" title="step 1: é¦–å…ˆå®ç°è½®è¯¢è°ƒåº¦ç®—æ³•"></a>step 1: é¦–å…ˆå®ç°è½®è¯¢è°ƒåº¦ç®—æ³•</h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v volumes)</span> <span class="title">Select</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    <span class="comment">// è½®è¯¢è°ƒåº¦ç®—æ³• i = (i + 1) mod n</span></span><br><span class="line">	i = (i + <span class="number">1</span>) % <span class="built_in">len</span>(v)</span><br><span class="line">	<span class="keyword">return</span> v[i].name</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="step-2-æ¯æ¬¡æ‰€æœ‰çš„å…ƒç´ è¢«è½®è¯¢ä¸€æ¬¡åå°†cw-1"><a href="#step-2-æ¯æ¬¡æ‰€æœ‰çš„å…ƒç´ è¢«è½®è¯¢ä¸€æ¬¡åå°†cw-1" class="headerlink" title="step 2: æ¯æ¬¡æ‰€æœ‰çš„å…ƒç´ è¢«è½®è¯¢ä¸€æ¬¡åå°†cw-1"></a>step 2: æ¯æ¬¡æ‰€æœ‰çš„å…ƒç´ è¢«è½®è¯¢ä¸€æ¬¡åå°†cw-1</h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v volumes)</span> <span class="title">Select</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    <span class="comment">// è½®è¯¢è°ƒåº¦ç®—æ³• i = (i + 1) mod n</span></span><br><span class="line">	i = (i + <span class="number">1</span>) % <span class="built_in">len</span>(v)</span><br><span class="line">	<span class="comment">// å½“ (i + 1) mod n çš„ä½™æ•°ä¸º0æ—¶, æœ‰ä¸¤ç§æƒ…å†µ</span></span><br><span class="line">	<span class="comment">// 1. é¦–æ¬¡è¢«è°ƒç”¨æ‰§è¡Œæ—¶</span></span><br><span class="line">	<span class="comment">// 2. å·²ç»è½®è¯¢å®Œä¸€æ•´è½®, åˆå›åˆ°èµ·ç‚¹æ—¶</span></span><br><span class="line">	<span class="keyword">if</span> i  == <span class="number">0</span> &#123;</span><br><span class="line">	   <span class="comment">// æ¯æ¬¡è½®è¯¢å®Œä¸€è½®ä¹‹åå°†cw-1</span></span><br><span class="line">	   cw = cw - <span class="number">1</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> v[i].name</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="step-3-cw-lt-0æ—¶å°†cwé‡ç½®ä¸ºæœ€å¤§æƒé‡å€¼"><a href="#step-3-cw-lt-0æ—¶å°†cwé‡ç½®ä¸ºæœ€å¤§æƒé‡å€¼" class="headerlink" title="step 3: cw&lt;=0æ—¶å°†cwé‡ç½®ä¸ºæœ€å¤§æƒé‡å€¼"></a>step 3: cw&lt;=0æ—¶å°†cwé‡ç½®ä¸ºæœ€å¤§æƒé‡å€¼</h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æå‰ç®—å¥½æœ€å¤§æƒé‡å€¼, ä¼ è¿›å»</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v volumes)</span> <span class="title">Select</span><span class="params">(maxWeight <span class="keyword">int</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    <span class="comment">// è½®è¯¢è°ƒåº¦ç®—æ³• i = (i + 1) mod n</span></span><br><span class="line">	i = (i + <span class="number">1</span>) % <span class="built_in">len</span>(v)</span><br><span class="line">	<span class="comment">// å½“ (i + 1) mod n çš„ä½™æ•°ä¸º0æ—¶, æœ‰ä¸¤ç§æƒ…å†µ</span></span><br><span class="line">	<span class="comment">// 1. é¦–æ¬¡è¢«è°ƒç”¨æ‰§è¡Œæ—¶</span></span><br><span class="line">	<span class="comment">// 2. å·²ç»è½®è¯¢å®Œä¸€æ•´è½®, åˆå›åˆ°èµ·ç‚¹æ—¶</span></span><br><span class="line">	<span class="keyword">if</span> i  == <span class="number">0</span> &#123;</span><br><span class="line">	   <span class="comment">// æ¯æ¬¡è½®è¯¢å®Œä¸€è½®ä¹‹åå°†cw-1</span></span><br><span class="line">	   cw = cw - <span class="number">1</span></span><br><span class="line">	   <span class="comment">// cw ä¸ºè´Ÿæ•°æˆ–0çš„ä¸¤ç§ç‰¹æ®Šæƒ…å†µ</span></span><br><span class="line">	   <span class="comment">// 1. å½“é¦–æ¬¡è¢«è°ƒç”¨æ—¶, cwçš„å€¼ä¸º0, æ‰€ä»¥æ‰§è¡Œ cw - 1 å, cw çš„å€¼ä¸ºè´Ÿæ•°</span></span><br><span class="line">	   <span class="comment">// 2. å½“æ‰€æœ‰å…ƒç´ éƒ½å·²ç»è¢«è°ƒåº¦è¿‡ä¸€æ¬¡å, cwçš„å€¼å°†é€’å‡è‡³0</span></span><br><span class="line">	   <span class="comment">// æ‰€ä»¥è¿™é‡Œéœ€è¦å•ç‹¬å¤„ç†ä¸€ä¸‹cw&lt;=0çš„æƒ…å†µ</span></span><br><span class="line">	   <span class="keyword">if</span> cw &lt;= <span class="number">0</span> &#123;</span><br><span class="line">	       cw = maxWeight</span><br><span class="line">	   &#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> v[i].name</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="step-4-å½“ç´¢å¼•å¯¹åº”çš„å…ƒç´ æƒé‡å€¼-gt-cwæ—¶è¿”å›"><a href="#step-4-å½“ç´¢å¼•å¯¹åº”çš„å…ƒç´ æƒé‡å€¼-gt-cwæ—¶è¿”å›" class="headerlink" title="step 4: å½“ç´¢å¼•å¯¹åº”çš„å…ƒç´ æƒé‡å€¼&gt;=cwæ—¶è¿”å›"></a>step 4: å½“ç´¢å¼•å¯¹åº”çš„å…ƒç´ æƒé‡å€¼&gt;=cwæ—¶è¿”å›</h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æå‰ç®—å¥½æœ€å¤§æƒé‡å€¼, ä¼ è¿›å»</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v volumes)</span> <span class="title">Select</span><span class="params">(maxWeight <span class="keyword">int</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    <span class="comment">// è½®è¯¢è°ƒåº¦ç®—æ³• i = (i + 1) mod n</span></span><br><span class="line">	i = (i + <span class="number">1</span>) % <span class="built_in">len</span>(v)</span><br><span class="line">	<span class="comment">// å½“ (i + 1) mod n çš„ä½™æ•°ä¸º0æ—¶, æœ‰ä¸¤ç§æƒ…å†µ</span></span><br><span class="line">	<span class="comment">// 1. é¦–æ¬¡è¢«è°ƒç”¨æ‰§è¡Œæ—¶</span></span><br><span class="line">	<span class="comment">// 2. å·²ç»è½®è¯¢å®Œä¸€æ•´è½®, åˆå›åˆ°èµ·ç‚¹æ—¶</span></span><br><span class="line">	<span class="keyword">if</span> i  == <span class="number">0</span> &#123;</span><br><span class="line">	   <span class="comment">// æ¯æ¬¡è½®è¯¢å®Œä¸€è½®ä¹‹åå°†cw-1</span></span><br><span class="line">	   cw = cw - <span class="number">1</span></span><br><span class="line">	   <span class="comment">// cw ä¸ºè´Ÿæ•°æˆ–0çš„ä¸¤ç§ç‰¹æ®Šæƒ…å†µ</span></span><br><span class="line">	   <span class="comment">// 1. å½“é¦–æ¬¡è¢«è°ƒç”¨æ—¶, cwçš„å€¼ä¸º0, æ‰€ä»¥æ‰§è¡Œ cw - 1 å, cw çš„å€¼ä¸ºè´Ÿæ•°</span></span><br><span class="line">	   <span class="comment">// 2. å½“æ‰€æœ‰å…ƒç´ éƒ½å·²ç»è¢«è°ƒåº¦è¿‡ä¸€æ¬¡å, cwçš„å€¼å°†é€’å‡è‡³0</span></span><br><span class="line">	   <span class="comment">// æ‰€ä»¥è¿™é‡Œéœ€è¦å•ç‹¬å¤„ç†ä¸€ä¸‹cw&lt;=0çš„æƒ…å†µ</span></span><br><span class="line">	   <span class="keyword">if</span> cw &lt;= <span class="number">0</span> &#123;</span><br><span class="line">	       cw = maxWeight</span><br><span class="line">	   &#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// returnè¿™é‡Œéœ€è¦ç¨åŠ ä¿®æ”¹, åªæœ‰å…ƒç´ çš„æƒé‡å€¼&gt;=cwæ—¶æ‰å¯ä»¥è¿”å›</span></span><br><span class="line">	<span class="keyword">if</span> v[i].Weight &gt;= cw &#123;</span><br><span class="line">	   <span class="keyword">return</span> v[i].name</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å†…éƒ¨è½®è¯¢"><a href="#å†…éƒ¨è½®è¯¢" class="headerlink" title="å†…éƒ¨è½®è¯¢"></a>å†…éƒ¨è½®è¯¢</h3><p>ä¸Šé¢çš„returnä¸­, å®šä¹‰äº†åªæœ‰å½“å…ƒç´ çš„æƒé‡å€¼&gt;=cwæ—¶æ‰å¯ä»¥è¿”å›, é‚£ä¹ˆè¯¥æ¡ä»¶å¦‚æœä¸ç¬¦åˆæ—¶, éœ€è¦åœ¨å‡½æ•°å†…ç»§ç»­è½®è¯¢å…ƒç´ , ç›´è‡³æœ‰å…ƒç´ çš„æƒé‡å€¼ç¬¦åˆæ¡ä»¶ä¸ºæ­¢</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v volumes)</span> <span class="title">Select</span><span class="params">(maxWeight <span class="keyword">int</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		<span class="comment">// è½®è¯¢è°ƒåº¦ç®—æ³• i = (i + 1) mod n</span></span><br><span class="line">		i = (i + <span class="number">1</span>) % <span class="built_in">len</span>(v)</span><br><span class="line">		<span class="comment">// å½“ (i + 1) mod n çš„ä½™æ•°ä¸º0æ—¶, æœ‰ä¸¤ç§æƒ…å†µ</span></span><br><span class="line">		<span class="comment">// 1. é¦–æ¬¡è¢«è°ƒç”¨æ‰§è¡Œæ—¶</span></span><br><span class="line">		<span class="comment">// 2. å·²ç»è½®è¯¢å®Œä¸€æ•´è½®, åˆå›åˆ°èµ·ç‚¹æ—¶</span></span><br><span class="line">		<span class="keyword">if</span> i == <span class="number">0</span> &#123;</span><br><span class="line">			<span class="comment">// æ¯æ¬¡è½®è¯¢å®Œä¸€è½®ä¹‹åå°†cw-1</span></span><br><span class="line">			cw = cw - <span class="number">1</span></span><br><span class="line">			<span class="comment">// cw ä¸ºè´Ÿæ•°æˆ–0çš„ä¸¤ç§ç‰¹æ®Šæƒ…å†µ</span></span><br><span class="line">			<span class="comment">// 1. å½“é¦–æ¬¡è¢«è°ƒç”¨æ—¶, cwçš„å€¼ä¸º0, æ‰€ä»¥æ‰§è¡Œ cw - 1 å, cw çš„å€¼ä¸ºè´Ÿæ•°</span></span><br><span class="line">			<span class="comment">// 2. å½“æ‰€æœ‰å…ƒç´ éƒ½å·²ç»è¢«è°ƒåº¦è¿‡ä¸€æ¬¡å, cwçš„å€¼å°†é€’å‡è‡³0</span></span><br><span class="line">			<span class="comment">// æ‰€ä»¥è¿™é‡Œéœ€è¦å•ç‹¬å¤„ç†ä¸€ä¸‹cw&lt;=0çš„æƒ…å†µ</span></span><br><span class="line">			<span class="keyword">if</span> cw &lt;= <span class="number">0</span> &#123;</span><br><span class="line">				<span class="comment">// å°†cwé‡ç½®ä¸ºæœ€å¤§æƒé‡å€¼</span></span><br><span class="line">				cw = maxWeight</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// returnè¿™é‡Œéœ€è¦ç¨åŠ ä¿®æ”¹, åªæœ‰å…ƒç´ çš„æƒé‡å€¼&gt;=cwæ—¶æ‰å¯ä»¥è¿”å›</span></span><br><span class="line">		<span class="keyword">if</span> v[i].Weight &gt;= cw &#123;</span><br><span class="line">			<span class="keyword">return</span> v[i].name</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ä¼˜åŒ–é¡¹"><a href="#ä¼˜åŒ–é¡¹" class="headerlink" title="ä¼˜åŒ–é¡¹"></a>ä¼˜åŒ–é¡¹</h3><ul>
<li>æ€§èƒ½ä¼˜åŒ–: ä¸Šé¢çš„ä»£ç å®ç°ä¸­, æ‰€æœ‰çš„å…ƒç´ æ¯å½“è½®è¯¢ä¸€è½®å, cwéƒ½æ˜¯å†™æ­»äº†è¦<code>-1</code>, å…¶å®è¿™é‡Œå¯ä»¥å¯ä»¥ç¨åŠ ä¼˜åŒ–, é¢„å…ˆè®¡ç®—å‡ºæ‰€æœ‰å…ƒç´ æƒé‡å€¼å¾—æœ€å¤§å…¬çº¦æ•°, æ¯æ¬¡è½®è¯¢å®Œä¸€è½®åcwå¯ä»¥ç›´æ¥<code>-æœ€å¤§å…¬çº¦æ•°(gcd)</code>, è¿™æ ·å¯ä»¥å‡å°‘å†…éƒ¨å¾ªç¯çš„æ¬¡æ•°, è€Œä¸”è°ƒåº¦æ•ˆæœæ›´ä¸ºåˆ†æ•£. (å½“ç„¶é…ç½®çš„æƒé‡æœ€å¤§å…¬çº¦æ•°è®¡ç®—ä¹‹åå¦‚æœä¹Ÿæ˜¯1, åˆ™è¯¥ä¼˜åŒ–ä¸ç›´æ¥æ¯æ¬¡-1çš„å¾ªç¯æ¬¡æ•°ç›¸åŒ)</li>
</ul>
<p><strong>æ±‚æœ€å¤§å…¬çº¦æ•°ç®—æ³•å¯å‚è€ƒå‰é¢çš„æ–‡ç« </strong></p>
<h2 id="å®Œæ•´ä»£ç "><a href="#å®Œæ•´ä»£ç " class="headerlink" title="å®Œæ•´ä»£ç "></a>å®Œæ•´ä»£ç </h2><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰å¸¦æƒé‡å±æ€§çš„å…ƒç´ ç»“æ„ä½“</span></span><br><span class="line"><span class="keyword">type</span> Volume <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name   <span class="keyword">string</span></span><br><span class="line">	Weight <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰å…ƒç´ é›†åˆç±»å‹</span></span><br><span class="line"><span class="keyword">type</span> Volumes []Volume</span><br><span class="line"></span><br><span class="line"><span class="comment">// è°ƒåº¦ç´¢å¼•</span></span><br><span class="line"><span class="keyword">var</span> i = <span class="number">-1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// current weight è®°å½•å½“å‰è°ƒåº¦çš„æƒé‡å€¼</span></span><br><span class="line"><span class="keyword">var</span> cw = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Volumes)</span> <span class="title">Select</span><span class="params">(maxWeight, gcd <span class="keyword">int</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		<span class="comment">// è½®è¯¢è°ƒåº¦ç®—æ³• i = (i + 1) mod n</span></span><br><span class="line">		i = (i + <span class="number">1</span>) % <span class="built_in">len</span>(v)</span><br><span class="line">		<span class="comment">// å½“ (i + 1) mod n çš„ä½™æ•°ä¸º0æ—¶, æœ‰ä¸¤ç§æƒ…å†µ</span></span><br><span class="line">		<span class="comment">// 1. é¦–æ¬¡è¢«è°ƒç”¨æ‰§è¡Œæ—¶</span></span><br><span class="line">		<span class="comment">// 2. å·²ç»è½®è¯¢å®Œä¸€æ•´è½®, åˆå›åˆ°èµ·ç‚¹æ—¶</span></span><br><span class="line">		<span class="keyword">if</span> i == <span class="number">0</span> &#123;</span><br><span class="line">			<span class="comment">// æœ€æ–°æƒé‡å€¼ = å½“å‰æƒé‡å€¼ - æœ€å¤§å…¬çº¦æ•°</span></span><br><span class="line">			cw = cw - gcd</span><br><span class="line">			<span class="keyword">if</span> cw &lt;= <span class="number">0</span> &#123;</span><br><span class="line">				<span class="comment">// cw &lt;= 0 æ—¶, æœ‰ä¸¤ç§æƒ…å†µ</span></span><br><span class="line">				<span class="comment">// 1. é¦–æ¬¡è¢«è°ƒç”¨æ‰§è¡Œæ—¶, cwå€¼åˆå§‹åŒ–ä¸º0, åªè¦maxWeightæœ€å¤§æƒé‡æ•°å€¼åœ¨0ä»¥ä¸Š, cwçš„æœ€æ–°å€¼ä¸€å®š&lt;0</span></span><br><span class="line">				<span class="comment">// 2. å½“æ‰€æœ‰çš„å…ƒç´ æŒ‰ç…§æƒé‡éƒ½è¢«è°ƒåº¦/é€‰æ‹©ä¸€éä¹‹å, cwçš„å€¼ä¸€å®šä¸º0</span></span><br><span class="line">				<span class="comment">// æ­¤æ—¶éœ€è¦å°†æœ€å¤§æƒé‡å€¼(é‡æ–°)èµ‹å€¼åˆ°cw</span></span><br><span class="line">				cw = maxWeight</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// å½“ç´¢å¼•å€¼ &gt;= æœ€æ–°æƒé‡å€¼æ—¶, è¿”å›åç§°</span></span><br><span class="line">		<span class="keyword">if</span> v[i].Weight &gt;= cw &#123;</span><br><span class="line">			<span class="keyword">return</span> v[i].Name</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// GetMaxWeight è·å–Sliceä¸­æœ€å¤§æƒé‡å€¼</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Volumes)</span> <span class="title">GetMaxWeight</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	maxWeight := <span class="number">0</span></span><br><span class="line">	<span class="keyword">for</span> _, volume := <span class="keyword">range</span> v &#123;</span><br><span class="line">		<span class="keyword">if</span> maxWeight &lt; volume.Weight &#123;</span><br><span class="line">			maxWeight = volume.Weight</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> maxWeight</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Gcd</span><span class="params">(a, b <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> b == <span class="number">0</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> a</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> Gcd(b, a%b)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// GetGcd è·å–Sliceæœ€å¤§å…¬çº¦æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Volumes)</span> <span class="title">GetGcd</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	g := v[<span class="number">0</span>].Weight</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(v)<span class="number">-1</span>; i++ &#123;</span><br><span class="line">		g = Gcd(g, v[i+<span class="number">1</span>].Weight)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> g</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	v1 := Volume&#123;</span><br><span class="line">		Name:   <span class="string">"a"</span>,</span><br><span class="line">		Weight: <span class="number">4</span>,</span><br><span class="line">	&#125;</span><br><span class="line">	v2 := Volume&#123;</span><br><span class="line">		Name:   <span class="string">"b"</span>,</span><br><span class="line">		Weight: <span class="number">4</span>,</span><br><span class="line">	&#125;</span><br><span class="line">	v3 := Volume&#123;</span><br><span class="line">		Name:   <span class="string">"c"</span>,</span><br><span class="line">		Weight: <span class="number">6</span>,</span><br><span class="line">	&#125;</span><br><span class="line">	v4 := Volume&#123;</span><br><span class="line">		Name:   <span class="string">"d"</span>,</span><br><span class="line">		Weight: <span class="number">2</span>,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	vo := Volumes&#123;</span><br><span class="line">		v1, v2, v3, v4,</span><br><span class="line">	&#125;</span><br><span class="line">    <span class="comment">// è·å–å…ƒç´ é›†ä¸­çš„æœ€å¤§æƒé‡å€¼</span></span><br><span class="line">	maxWeight := vo.GetMaxWeight()</span><br><span class="line">	<span class="comment">// è·å–å…ƒç´ é›†ä¸­æƒé‡å€¼çš„æœ€å¤§å…¬çº¦æ•°</span></span><br><span class="line">	gcd := vo.GetGcd()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> j := <span class="number">0</span>; j &lt; <span class="number">18</span>; j++ &#123;</span><br><span class="line">		fmt.Println(j+<span class="number">1</span>, vo.Select(maxWeight, gcd))</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œç»“æœ: </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1 c</span><br><span class="line">2 a</span><br><span class="line">3 b</span><br><span class="line">4 c</span><br><span class="line">5 a</span><br><span class="line">6 b</span><br><span class="line">7 c</span><br><span class="line">8 d</span><br><span class="line">9 c</span><br><span class="line">10 a</span><br><span class="line">11 b</span><br><span class="line">12 c</span><br><span class="line">13 a</span><br><span class="line">14 b</span><br><span class="line">15 c</span><br><span class="line">16 d</span><br><span class="line">17 c</span><br><span class="line">18 a</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>ç®—æ³•</category>
        <category>Go</category>
      </categories>
      <tags>
        <tag>gcd</tag>
        <tag>wrr</tag>
      </tags>
  </entry>
  <entry>
    <title>goè¯­è¨€å®ç°è½®è¯¢è°ƒåº¦ç®—æ³•</title>
    <url>/2019/04/10/go%E8%AF%AD%E8%A8%80%E5%AE%9E%E7%8E%B0%E8%BD%AE%E8%AF%A2%E8%B0%83%E5%BA%A6%E7%AE%97%E6%B3%95/</url>
    <content><![CDATA[<blockquote>
<p>å®ç°è½®è¯¢è°ƒåº¦ç®—æ³•(Round-Robin/rr)çš„åŸç†æ˜¯é€šè¿‡å–æ¨¡æ‹¿åˆ°æ•°ç»„/åˆ‡ç‰‡çš„ä¸‹æ ‡, ä»è€Œæå–å‡ºä¸‹ä¸€æ¬¡å³å°†è°ƒåº¦çš„å…ƒç´ . å…¬å¼ä¸º<code>i = (i + 1) mod n</code><br><code>i</code>ä¸ºæ•°ç»„ä¸‹æ ‡, <code>n</code>ä¸ºæ•°ç»„é•¿åº¦<br>è½®è¯¢è°ƒåº¦ç®—æ³•çš„ä¼˜ç‚¹æ˜¯æ— çŠ¶æ€, å‡åŒ€çš„å°†è¯·æ±‚è°ƒåº¦åˆ°åç«¯çš„æ¯ä¸ªèŠ‚ç‚¹, å¹¶ä¸å…³å¿ƒåç«¯æ¯ä¸ªèŠ‚ç‚¹çš„å®é™…å·®å¼‚</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å£°æ˜åç«¯å…ƒç´ çš„æ•°æ®ç»“æ„</span></span><br><span class="line"><span class="keyword">type</span> volume <span class="keyword">struct</span> &#123;</span><br><span class="line">	name <span class="keyword">string</span></span><br><span class="line">	quota <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å£°æ˜æ•°æ®ç±»å‹å­˜æ”¾å…ƒç´ çš„Slice</span></span><br><span class="line"><span class="keyword">type</span> volumes []volume</span><br><span class="line"></span><br><span class="line"><span class="comment">// å£°æ˜å¹¶èµ‹å€¼ç´¢å¼•ä¸‹æ ‡</span></span><br><span class="line"><span class="keyword">var</span> i = <span class="number">-1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è½®è¯¢è°ƒåº¦ç®—æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v volumes)</span> <span class="title">Select</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">	i = (i + <span class="number">1</span>) % <span class="built_in">len</span>(v)</span><br><span class="line">	<span class="keyword">return</span> v[i].name</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	v1 := volume&#123;</span><br><span class="line">		name:   <span class="string">"a"</span>,</span><br><span class="line">		quota: <span class="number">4</span>,</span><br><span class="line">	&#125;</span><br><span class="line">	v2 := volume&#123;</span><br><span class="line">		name:   <span class="string">"b"</span>,</span><br><span class="line">		quota: <span class="number">4</span>,</span><br><span class="line">	&#125;</span><br><span class="line">	v3 := volume&#123;</span><br><span class="line">		name:   <span class="string">"c"</span>,</span><br><span class="line">		quota: <span class="number">8</span>,</span><br><span class="line">	&#125;</span><br><span class="line">	v4 := volume&#123;</span><br><span class="line">		name:   <span class="string">"d"</span>,</span><br><span class="line">		quota: <span class="number">2</span>,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	vo := volumes&#123;</span><br><span class="line">		v1, v2, v3, v4,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> j := <span class="number">0</span>; j &lt; <span class="number">20</span>; j++ &#123;</span><br><span class="line">		fmt.Println(j+<span class="number">1</span>, vo.Select())</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1 a</span><br><span class="line">2 b</span><br><span class="line">3 c</span><br><span class="line">4 d</span><br><span class="line">5 a</span><br><span class="line">6 b</span><br><span class="line">7 c</span><br><span class="line">8 d</span><br><span class="line">9 a</span><br><span class="line">10 b</span><br><span class="line">11 c</span><br><span class="line">12 d</span><br><span class="line">13 a</span><br><span class="line">14 b</span><br><span class="line">15 c</span><br><span class="line">16 d</span><br><span class="line">17 a</span><br><span class="line">18 b</span><br><span class="line">19 c</span><br><span class="line">20 d</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡è¿è¡Œç»“æœå¯ä»¥çœ‹å‡º, æ¯æ¬¡<code>Select</code>è¯·æ±‚éƒ½è¢«å‡åŒ€çš„è°ƒåº¦åˆ°â€åç«¯çš„èŠ‚ç‚¹â€. è€ƒè™‘åˆ°åç«¯èŠ‚ç‚¹å¯èƒ½å­˜åœ¨çš„å·®å¼‚æ€§, ä¸‹ç¯‡æ–‡ç« å°†ä»‹ç»æ›´ä¸ºå¤æ‚çš„åŠ æƒè½®è¯¢è°ƒåº¦ç®—æ³•</p>
]]></content>
      <categories>
        <category>ç®—æ³•</category>
        <category>Go</category>
      </categories>
      <tags>
        <tag>rr</tag>
        <tag>round-robin</tag>
      </tags>
  </entry>
  <entry>
    <title>goè¯­è¨€å®ç°æœ€å¤§å…¬çº¦æ•°ç®—æ³•</title>
    <url>/2019/03/17/go%E8%AF%AD%E8%A8%80%E5%AE%9E%E7%8E%B0%E6%9C%80%E5%A4%A7%E5%85%AC%E7%BA%A6%E6%95%B0%E7%AE%97%E6%B3%95/</url>
    <content><![CDATA[<h2 id="æœ€å¤§å…¬çº¦æ•°ç®€ä»‹"><a href="#æœ€å¤§å…¬çº¦æ•°ç®€ä»‹" class="headerlink" title="æœ€å¤§å…¬çº¦æ•°ç®€ä»‹"></a>æœ€å¤§å…¬çº¦æ•°ç®€ä»‹</h2><p>æœ€å¤§å…¬çº¦æ•°(GCD/Greatest Common Divisor)æŒ‡å‡ ä¸ªæ•´æ•°ä¸­å…±æœ‰çº¦æ•°ä¸­æœ€å¤§çš„ä¸€ä¸ª</p>
<h2 id="æ¬§å‡ é‡Œå¾·ç®—æ³•"><a href="#æ¬§å‡ é‡Œå¾·ç®—æ³•" class="headerlink" title="æ¬§å‡ é‡Œå¾·ç®—æ³•"></a>æ¬§å‡ é‡Œå¾·ç®—æ³•</h2><p>æ¬§å‡ é‡Œå¾·ç®—æ³•åˆç§°è¾—è½¬ç›¸é™¤æ³•, è¯¥ç®—æ³•ç”¨äºè®¡ç®—ä¸¤ä¸ªæ•´æ•°çš„æœ€å¤§å…¬çº¦æ•°. å®šç†å¦‚ä¸‹:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">gcd(a,b) &#x3D; gcd(b,a mod b)</span><br></pre></td></tr></table></figure>

<p>æ„æ€å°±æ˜¯è¯´: <code>a</code>å’Œ<code>b</code>çš„æœ€å¤§å…¬çº¦æ•° =  <code>b</code>å’Œ<code>aâ—bçš„ä½™æ•°</code>çš„æœ€å¤§å…¬çº¦æ•°</p>
<ul>
<li>å½“<code>aâ—bçš„ä½™æ•°</code>ä¸º0æ—¶, æœ€å¤§å…¬çº¦æ•°ä¸ºb</li>
<li>å½“<code>aâ—bçš„ä½™æ•°</code>ä¸ä¸º0æ—¶, åˆ™å°†<code>a=b</code>, <code>b=aâ—bçš„ä½™æ•°</code>, é€’å½’è¿ç®—, ç›´åˆ°ä½™æ•°ä¸º<code>0</code></li>
</ul>
<p>å…·ä½“è¯æ˜çš„è¿‡ç¨‹åœ¨æ­¤ä¸å†èµ˜è¿°, å¦‚æœ‰å…´è¶£å¯ä»¥è‡ªè¡Œè°·æ­Œä¸€ä¸‹, ä¸‹é¢ç›´æ¥ç»™å‡ºåŸºäºgoè¯­è¨€çš„å®ç°ä»£ç </p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">gcd</span><span class="params">(a,b <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> b == <span class="number">0</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> a</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> gcd(b, a % b)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(gcd(<span class="number">5</span>, <span class="number">10</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œç»“æœ: </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">5</span><br></pre></td></tr></table></figure>

<p>è§£æ:</p>
<p><strong>ç¬¬ä¸€æ¬¡è°ƒç”¨:</strong></p>
<p>è°ƒç”¨<code>gcd(5, 10)</code>åˆ™<code>a=5, b=10</code>, è¿›å…¥å‡½æ•°ååˆ¤æ–­<code>if b == 0</code>, æ­¤æ—¶<code>b=10</code>, åˆ¤æ–­æ¡ä»¶ä¸ºå‡, é€’å½’è°ƒç”¨<code>gcd(b, a % b)</code>, æ­¤æ—¶å®é™…å€¼ä¸º <code>gcd(10, 5 % 10)</code>, <code>5ä¸10è®¡ç®—å–ä½™</code>å•†0, ä½™5, åˆ™å®é™…è°ƒç”¨å‚æ•°ä¸º<code>gcd(10, 5)</code> </p>
<p><strong>ç¬¬äºŒæ¬¡è°ƒç”¨:</strong><br>è°ƒç”¨<code>gcd(10, 5)</code>åˆ™<code>a=10, b=5</code>, è¿›å…¥å‡½æ•°ååˆ¤æ–­<code>if b == 0</code>, æ­¤æ—¶<code>b=5</code>, åˆ¤æ–­æ¡ä»¶ä¸ºå‡, é€’å½’è°ƒç”¨<code>gcd(b, a % b)</code>, æ­¤æ—¶å®é™…å€¼ä¸º <code>gcd(5, 10 % 5)</code>, <code>10ä¸5è®¡ç®—å–ä½™</code>å•†2, ä½™0, åˆ™å®é™…è°ƒç”¨å‚æ•°ä¸º<code>gcd(5, 0)</code> </p>
<p><strong>ç¬¬ä¸‰æ¬¡è°ƒç”¨:</strong><br>è°ƒç”¨<code>gcd(5, 0)</code>åˆ™<code>a=5, b=0</code>, è¿›å…¥å‡½æ•°ååˆ¤æ–­<code>if b == 0</code>, æ­¤æ—¶<code>b=0</code>, åˆ¤æ–­æ¡ä»¶ä¸ºçœŸ, ç›´æ¥è¿”å›<code>a</code> æ­¤æ—¶<code>a</code>å³ä¸ºä¸¤ä¸ªæ•°çš„æœ€å¤§å…¬çº¦æ•°</p>
<h2 id="å¤šä¸ªæ•°æ±‚æœ€å¤§å…¬çº¦æ•°"><a href="#å¤šä¸ªæ•°æ±‚æœ€å¤§å…¬çº¦æ•°" class="headerlink" title="å¤šä¸ªæ•°æ±‚æœ€å¤§å…¬çº¦æ•°"></a>å¤šä¸ªæ•°æ±‚æœ€å¤§å…¬çº¦æ•°</h2><p>å®ç°æ€è·¯: å…ˆæ±‚å‡ºå¤´ä¸¤ä¸ªæ•°çš„æœ€å¤§å…¬çº¦æ•°, å†æ‹¿è®¡ç®—å‡ºçš„æœ€å¤§å…¬çº¦æ•°ä¾æ¬¡ä¸åé¢æ‰€æœ‰çš„æ•°æ±‚æœ€å¤§å…¬çº¦æ•°</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">gcd</span><span class="params">(a,b <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> b == <span class="number">0</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> a</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> gcd(b, a % b)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetGcd</span><span class="params">(n []<span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	<span class="comment">// å…ˆå–å¾—Sliceä¸­çš„ç¬¬ä¸€ä¸ªæ•°, å¹¶å‡è®¾ç¬¬ä¸€ä¸ªæ•°ä¸ºæœ€å¤§å…¬çº¦æ•°</span></span><br><span class="line">	g := n[<span class="number">0</span>]</span><br><span class="line">	<span class="comment">// ä¾æ¬¡ä¸Sliceä¸­çš„æ¯ä¸ªæ•°å­—æ±‚æœ€å¤§å…¬çº¦æ•°</span></span><br><span class="line">	<span class="comment">// è¿™é‡Œi=1, å› ä¸ºç¬¬0ä¸ªæ•°å­—å·²ç»å–å‡ºå¹¶å‡è®¾ä¸ºæœ€å¤§å…¬çº¦æ•°</span></span><br><span class="line">	<span class="keyword">for</span> i:=<span class="number">1</span>; i&lt;<span class="built_in">len</span>(n)<span class="number">-1</span>; i++ &#123;</span><br><span class="line">		oldGcd := g</span><br><span class="line">		<span class="comment">// ä½¿ç”¨ä¸¤ä¸ªæ•°å­—æ¯”è¾ƒçš„æœ€å¤§å…¬çº¦æ•°å‡½æ•°è¿›è¡Œè®¡ç®—, å¾—å‡ºå½“å‰ä¸¤ä¸ªæ•°å­—çš„æœ€å¤§å…¬çº¦æ•°</span></span><br><span class="line">		<span class="comment">// å¾ªç¯å¼€å§‹å, ä¾æ¬¡å°†å½“å‰æœ€å¤§å…¬çº¦æ•°ä¸åé¢çš„æ•°å­—ä¸€ä¸€è¿›è¡Œè¿ç®—, æ±‚æœ€å¤§å…¬çº¦æ•°</span></span><br><span class="line">		g = gcd(g, n[i])</span><br><span class="line">		fmt.Printf(<span class="string">"ç¬¬%dæ¬¡è¿ç®—, å½“å‰æœ€å¤§å…¬çº¦æ•°ä¸º%d, ä¸%dè¿ç®—å¾—å‡ºçš„æ–°æœ€å¤§å…¬çº¦æ•°ä¸º: %d \n"</span>, i, oldGcd, n[i], g)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> g</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	nums := []<span class="keyword">int</span>&#123;<span class="number">4</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">2</span>,<span class="number">8</span>,<span class="number">10</span>&#125;</span><br><span class="line">	fmt.Printf(<span class="string">"è¿ç®—ç»“æœ: \n\tæ•°åˆ—: %v çš„æœ€å¤§å…¬çº¦æ•°ä¸º: %d"</span>, nums, GetGcd(nums))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ç¬¬1æ¬¡è¿ç®—, å½“å‰æœ€å¤§å…¬çº¦æ•°ä¸º4, ä¸4è¿ç®—å¾—å‡ºçš„æ–°æœ€å¤§å…¬çº¦æ•°ä¸º: 4 </span><br><span class="line">ç¬¬2æ¬¡è¿ç®—, å½“å‰æœ€å¤§å…¬çº¦æ•°ä¸º4, ä¸6è¿ç®—å¾—å‡ºçš„æ–°æœ€å¤§å…¬çº¦æ•°ä¸º: 2 </span><br><span class="line">ç¬¬3æ¬¡è¿ç®—, å½“å‰æœ€å¤§å…¬çº¦æ•°ä¸º2, ä¸2è¿ç®—å¾—å‡ºçš„æ–°æœ€å¤§å…¬çº¦æ•°ä¸º: 2 </span><br><span class="line">ç¬¬4æ¬¡è¿ç®—, å½“å‰æœ€å¤§å…¬çº¦æ•°ä¸º2, ä¸8è¿ç®—å¾—å‡ºçš„æ–°æœ€å¤§å…¬çº¦æ•°ä¸º: 2 </span><br><span class="line">è¿ç®—ç»“æœ: </span><br><span class="line">        æ•°åˆ—: [4 4 6 2 8 10] çš„æœ€å¤§å…¬çº¦æ•°ä¸º: 2</span><br></pre></td></tr></table></figure>


]]></content>
      <categories>
        <category>ç®—æ³•</category>
        <category>Go</category>
      </categories>
      <tags>
        <tag>gcd</tag>
      </tags>
  </entry>
  <entry>
    <title>goè¯­è¨€å·§ç”¨intstræ¥å¤„ç†æ•°å­—ä¸å­—ç¬¦ç±»å‹</title>
    <url>/2019/03/06/go%E8%AF%AD%E8%A8%80%E5%B7%A7%E7%94%A8intstr%E6%9D%A5%E5%A4%84%E7%90%86%E6%95%B0%E5%AD%97%E4%B8%8E%E5%AD%97%E7%AC%A6%E7%B1%BB%E5%9E%8B/</url>
    <content><![CDATA[<blockquote>
<p><code>intstr</code> è¿™ä¸ªåŒ…æ˜¯å¶ç„¶åœ¨k8s client-goä¸­å‘ç°çš„, åœ¨ç¼–å†™<code>deployment</code>ç»“æ„ä½“å®šä¹‰æ—¶, <code>apiv1.Container</code>å®ä¾‹ä¸‹<code>LivenessProbe</code>ä¸­ç”¨åˆ°çš„<code>Port</code>, å°±æ˜¯<code>intstr.IntOrString</code>. ç‰¹åœ°çœ‹ä¸‹æ¥è¿™ä¸ªå‡½æ•°, å‘ç°è¿™ä¸ªå‡½æ•°æ°å·§è§£å†³äº†ä¸€ç›´å›°æ‰°æˆ‘çš„ä¸€ä¸ªé—®é¢˜: åœ¨<code>restful</code>æ¥å£ä¸­, å¦‚æœè¦æ±‚jsonæ ¼å¼<code>body</code>ä½“å†…ä¼ é€’<code>port</code>ç«¯å£å‚æ•°, é‚£ä¹ˆ<code>port</code>è¿™ä¸ªå­—æ®µ, æˆ‘åº”è¯¥åœ¨æœåŠ¡ç«¯å®šä¹‰æˆæ•´å‹å¥½å‘¢, è¿˜æ˜¯å­—ç¬¦ä¸²ç±»å‹å¥½å‘¢, ä¸€ç›´å¾ˆçº ç»“~ æœ‰äº†<code>intstr.IntOrString</code>å†ä¹Ÿä¸ç”¨ä¸ºè¿™äº‹å„¿å‘æ„äº†</p>
</blockquote>
<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>ä»¥å¾€æˆ‘ä»¬æ¥æ”¶<code>json</code>æˆ–<code>yaml</code>å­—ç¬¦ä¸²è¦è½¬æˆç»“æ„ä½“æ—¶, æ•°æ®ç±»å‹å¿…é¡»ä¸€ä¸€å¯¹åº”. æ¯”å¦‚æ•°æ®ä¸­çš„ç«¯å£å­—æ®µ, å¦‚æœ<code>json</code> ä¸­ä¼ é€’æ˜¯çš„æ•´å‹, åˆ™ä¸ºä»¥ä¸‹æ ·å¼ <code>{&quot;port&quot;: 8080}</code>; å¦‚æœä¼ é€’çš„æ˜¯å­—ç¬¦ä¸²ç±»å‹, åˆ™ä¸ºä»¥ä¸‹å½¢å¼<code>{&quot;port&quot;: &quot;8080&quot;}</code></p>
<p>æœåŠ¡ç«¯æ¥æ”¶åˆ°è¿™äº›å­—ç¬¦ä¸²å, éœ€è¦å°†æ•°æ®ä¸ç»“æ„ä½“ä¸­çš„å­—æ®µä¸€ä¸€ç»‘å®š, å½“ç„¶æ•°æ®ç±»å‹ä¹Ÿå¿…é¡»ä¸€è‡´. å¦‚æœåœ¨æœåŠ¡ç«¯å®šä¹‰äº†<code>port</code>å­—æ®µä¸º<code>int</code>, ä½†æ˜¯<code>json</code>å­—ç¬¦ä¸²ä¼ é€’è¿‡æ¥çš„æ˜¯<code>{&quot;port&quot;: &quot;8080&quot;}</code>, åˆ™ç»‘å®šæ•°æ®æ—¶å°†ä¼šæŠ¥é”™. åä¹‹ä¹Ÿä¸€æ ·, æ•°æ®ç±»å‹å¿…é¡»ä¸€è‡´.</p>
<p>æˆ‘è‡ªå·±å¼€å‘è¿‡å¾—é¡¹ç›®ä¸­, å¾ˆå¤šæ¥å£çš„<code>body</code>ä½“å†…éƒ½å‡ºç°äº†ç«¯å£å­—æ®µ, æœ‰çš„æ—¶å€™å®šä¹‰ä¸ºæ•´å‹, æœ‰çš„æ—¶å€™å®šä¹‰ä¸ºå­—ç¬¦ä¸²ç±»å‹, api docé‡Œä¹Ÿæ˜¯æœ‰çš„å†™å¾—æ•´å‹, æœ‰çš„å†™çš„å­—ç¬¦ä¸², æ¯æ¬¡éƒ½çº ç»“ç”¨ä»€ä¹ˆç±»å‹å¥½</p>
<p><code>intstr.IntOrString</code> æ•°æ®ç±»å‹é¡¾åæ€ä¹‰, è¯¥ç±»å‹å¯ä»¥æ—¢å¯ä»¥æ¥å—æ•´å‹, ä¹Ÿå¯ä»¥æ¥å—å­—ç¬¦ä¸²ç±»å‹. å†ä¹Ÿä¸ç”¨çº ç»“è¿™ç§ç”¨æ•´å‹å’Œå­—ç¬¦ä¸²ç±»å‹éƒ½åˆé€‚çš„å­—æ®µåˆ°åº•ç”¨ä»€ä¹ˆæ•°æ®ç±»å‹äº†</p>
<p><code>intstr.IntOrString</code> ä¸ä»…å¯ä»¥å…¼å®¹æ¥æ”¶æ•´å‹æˆ–å­—ç¬¦ä¸²ç±»å‹, è€Œä¸”å¯ä»¥é€šè¿‡å…¶å†…ç½®çš„å‡½æ•°, åœ¨ä¸¤ä¸ªæ•°æ®ç±»å‹ä¹‹é—´è‡ªç”±è½¬æ¢</p>
<h2 id="json-yamlä¸²è½¬ç»“æ„ä½“"><a href="#json-yamlä¸²è½¬ç»“æ„ä½“" class="headerlink" title="json/yamlä¸²è½¬ç»“æ„ä½“"></a>json/yamlä¸²è½¬ç»“æ„ä½“</h2><p>ä»¥ä¸‹demoçš„åœºæ™¯ä¸º, æ‹¿åˆ°<code>json/yaml</code>ä¸², è½¬æ¢æˆç»“æ„ä½“çš„ä½¿ç”¨åœºæ™¯</p>
<h3 id="ç«¯å£å­—æ®µä¸ºæ•´å‹"><a href="#ç«¯å£å­—æ®µä¸ºæ•´å‹" class="headerlink" title="ç«¯å£å­—æ®µä¸ºæ•´å‹"></a>ç«¯å£å­—æ®µä¸ºæ•´å‹</h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"encoding/json"</span></span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"k8s.io/apimachinery/pkg/util/intstr"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> service <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name <span class="keyword">string</span> <span class="string">`json:"name"`</span></span><br><span class="line">	Host <span class="keyword">string</span> <span class="string">`json:"host"`</span></span><br><span class="line">	Port intstr.IntOrString <span class="string">`json:"port"`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// å®šä¹‰jsonå­—ç¬¦ä¸², portå­—æ®µçš„å€¼è®¾ç½®ä¸ºæ•´å‹</span></span><br><span class="line">	jsonStr := <span class="string">`&#123;"name": "nginx", "host": "192.168.1.2", "port": 8080&#125;`</span></span><br><span class="line"></span><br><span class="line">	nginxService := &amp;service&#123;&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// å°†jsonå­—ç¬¦ä¸²çš„æ•°æ®, ç»‘å®šåˆ°ç»“æ„ä½“å®ä¾‹ä¸­</span></span><br><span class="line">	json.Unmarshal([]<span class="keyword">byte</span>(jsonStr), nginxService)</span><br><span class="line"></span><br><span class="line">	fmt.Printf(<span class="string">"æå–æ•°æ®ç±»å‹: %T å®é™…æ•°æ®ç±»å‹(ç¼–å·): %v å€¼: %#v \n"</span>, nginxService.Port.IntVal, nginxService.Port.Type, nginxService.Port.IntVal)</span><br><span class="line">	fmt.Printf(<span class="string">"æå–æ•°æ®ç±»å‹: %T å®é™…æ•°æ®ç±»å‹(ç¼–å·): %v å€¼: %#v \n"</span>, nginxService.Port.StrVal, nginxService.Port.Type, nginxService.Port.StrVal)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æå–æ•°æ®ç±»å‹: int32 å®é™…æ•°æ®ç±»å‹(ç¼–å·): 0 å€¼: 8080 </span><br><span class="line">æå–æ•°æ®ç±»å‹: string å®é™…æ•°æ®ç±»å‹(ç¼–å·): 0 å€¼: &quot;&quot;</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„ä¾‹å­ä¸­, jsonå­—ç¬¦ä¸²ä¸­çš„ç«¯å£å­—æ®µä¸ºæ•´å‹, ç»‘å®šåˆ°ç»“æ„ä½“çš„å®ä¾‹å, é€šè¿‡<code>nginxService.Port.Type</code> å¯ä»¥å–å¾—jsonä¸²ä¸­å®é™…ä¼ é€’çš„æ˜¯å“ªç§æ•°æ®ç±»å‹, åœ¨æœ¬ä¾‹ä¸­, è°ƒç”¨<code>nginxService.Port.Type</code>çš„ç»“æœæ˜¯<code>0</code>, é€šè¿‡æŸ¥çœ‹æºç å¾—çŸ¥, <code>0</code>è¡¨ç¤ºjsonä¸²ä¸­ä¼ é€’çš„æ•°æ®æ˜¯æ•´å‹</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æºç å®šä¹‰</span></span><br><span class="line"><span class="comment">// Type represents the stored type of IntOrString.</span></span><br><span class="line"><span class="keyword">type</span> Type <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">	Int    Type = <span class="literal">iota</span> <span class="comment">// The IntOrString holds an int.</span></span><br><span class="line">	String             <span class="comment">// The IntOrString holds a string.</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>åœ¨å®é™…ä½¿ç”¨æ—¶, å¯ä»¥å…ˆåˆ¤æ–­<code>nginxService.Port.Type</code>çš„ç»“æœæ˜¯0, è¿˜æ˜¯1</p>
<ul>
<li>å¦‚æœæ˜¯0, åˆ™å–æ•´å‹<code>nginxService.Port.IntVal</code></li>
<li>å¦‚æœæ˜¯1, åˆ™å–å­—ç¬¦ä¸²ç±»å‹<code>nginxService.Port.StrVal</code></li>
</ul>
<p>è¿˜æœ‰ä¸€ç§æ›´ç›´æ¥çš„ç”¨æ³•, å°±æ˜¯æ ¹æ®éœ€è¦, æ˜¾å¼çš„ç±»å‹è½¬æ¢</p>
<p>æ¯”å¦‚ä¸Šé¢çš„ä¾‹å­ä¸­, jsonä¼ é€’çš„ç«¯å£å€¼ä¸ºæ•´å‹, ä½†æ˜¯æœåŠ¡ç«¯ç»‘å®šåˆ°ç»“æ„ä½“ä¹‹å, å½“ä½¿ç”¨è¯¥ç«¯å£æ—¶, éœ€è¦è¯¥ç«¯å£å€¼å¾—æ•°æ®ç±»å‹ä¸ºå­—ç¬¦ä¸²ç±»å‹, ä½ å¯ä»¥ç›´æ¥è¿™æ ·åš:</p>
<p><code>fmt.Printf(&quot;%#v&quot;, nginxService.Port.String())</code></p>
<p>è¿è¡Œç»“æœ:</p>
<p><code>&quot;8080&quot;</code></p>
<p>å¯ä»¥çœ‹åˆ°, æ•´å‹çš„æ•°æ®, å·²ç»å¸®ä½ è½¬æ¢æˆä¸ºå­—ç¬¦ä¸²ç±»å‹, åæœŸä½¿ç”¨éå¸¸çµæ´», å¯ä»¥éšæ—¶æå–ä¸¤ç§æ•°æ®ç±»å‹çš„å€¼</p>
<h3 id="ç«¯å£ä¸ºå­—ç¬¦ä¸²ç±»å‹"><a href="#ç«¯å£ä¸ºå­—ç¬¦ä¸²ç±»å‹" class="headerlink" title="ç«¯å£ä¸ºå­—ç¬¦ä¸²ç±»å‹"></a>ç«¯å£ä¸ºå­—ç¬¦ä¸²ç±»å‹</h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"encoding/json"</span></span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"k8s.io/apimachinery/pkg/util/intstr"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> service <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name <span class="keyword">string</span> <span class="string">`json:"name"`</span></span><br><span class="line">	Host <span class="keyword">string</span> <span class="string">`json:"host"`</span></span><br><span class="line">	Port intstr.IntOrString <span class="string">`json:"port"`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// å®šä¹‰jsonå­—ç¬¦ä¸², portå­—æ®µçš„å€¼è®¾ç½®ä¸ºå­—ç¬¦ä¸²ç±»å‹</span></span><br><span class="line">	jsonStr := <span class="string">`&#123;"name": "nginx", "host": "192.168.1.2", "port": "8080""&#125;`</span></span><br><span class="line">	</span><br><span class="line">	nginxService := &amp;service&#123;&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// å°†jsonå­—ç¬¦ä¸²çš„æ•°æ®, ç»‘å®šåˆ°ç»“æ„ä½“å®ä¾‹ä¸­</span></span><br><span class="line">	json.Unmarshal([]<span class="keyword">byte</span>(jsonStr), nginxService)</span><br><span class="line"></span><br><span class="line">	fmt.Printf(<span class="string">"æå–æ•°æ®ç±»å‹: %T å®é™…æ•°æ®ç±»å‹(ç¼–å·): %v å€¼: %#v \n"</span>, nginxService.Port.IntVal, nginxService.Port.Type, nginxService.Port.IntVal)</span><br><span class="line">	fmt.Printf(<span class="string">"æå–æ•°æ®ç±»å‹: %T å®é™…æ•°æ®ç±»å‹(ç¼–å·): %v å€¼: %#v \n"</span>, nginxService.Port.StrVal, nginxService.Port.Type, nginxService.Port.StrVal)</span><br><span class="line">	fmt.Printf(<span class="string">"å€¼: %#v å®é™…æ•°æ®ç±»å‹: %T \t \n"</span>, nginxService.Port.String(), nginxService.Port.String())</span><br><span class="line">	fmt.Printf(<span class="string">"å€¼: %#v å®é™…æ•°æ®ç±»å‹: %T \t \n"</span>, nginxService.Port.String(), nginxService.Port.IntValue())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æå–æ•°æ®ç±»å‹: int32 å®é™…æ•°æ®ç±»å‹(ç¼–å·): 1 å€¼: 0 </span><br><span class="line">æå–æ•°æ®ç±»å‹: string å®é™…æ•°æ®ç±»å‹(ç¼–å·): 1 å€¼: &quot;8080&quot; </span><br><span class="line">å€¼: &quot;8080&quot; å®é™…æ•°æ®ç±»å‹: string          </span><br><span class="line">å€¼: &quot;8080&quot; å®é™…æ•°æ®ç±»å‹: int</span><br></pre></td></tr></table></figure>

<h2 id="ç»“æ„ä½“è½¬json-yaml"><a href="#ç»“æ„ä½“è½¬json-yaml" class="headerlink" title="ç»“æ„ä½“è½¬json/yaml"></a>ç»“æ„ä½“è½¬json/yaml</h2><h3 id="æ•°æ®ç±»å‹-æ•´å‹"><a href="#æ•°æ®ç±»å‹-æ•´å‹" class="headerlink" title="æ•°æ®ç±»å‹: æ•´å‹"></a>æ•°æ®ç±»å‹: æ•´å‹</h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"encoding/json"</span></span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"k8s.io/apimachinery/pkg/util/intstr"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> service <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name <span class="keyword">string</span> <span class="string">`json:"name"`</span></span><br><span class="line">	Host <span class="keyword">string</span> <span class="string">`json:"host"`</span></span><br><span class="line">	Port intstr.IntOrString <span class="string">`json:"port"`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	</span><br><span class="line">	nginxService := service&#123;</span><br><span class="line">		Name: <span class="string">"nginx"</span>,</span><br><span class="line">		Host: <span class="string">"192.168.1.2"</span>,</span><br><span class="line">		Port: intstr.IntOrString&#123;</span><br><span class="line">			Type:   <span class="number">0</span>,    <span class="comment">// è¿™é‡Œè®¾ç½®ä¸º0, æ„ä¸ºæ•°æ®ç±»å‹ä¸ºæ•´å‹</span></span><br><span class="line">			IntVal: <span class="number">2222</span>,</span><br><span class="line">			StrVal: <span class="string">"1111"</span>,</span><br><span class="line">		&#125;,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	jsonBytes, _ := json.Marshal(nginxService)</span><br><span class="line">	fmt.Println(<span class="keyword">string</span>(jsonBytes))</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ä¸Šé¢<code>intstr.IntOrString.Type</code>çš„å€¼è®¾ç½®ä¸º<code>0</code>, è¿è¡Œç»“æœ: </p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;<span class="attr">"name"</span>:<span class="string">"nginx"</span>,<span class="attr">"host"</span>:<span class="string">"192.168.1.2"</span>,<span class="attr">"port"</span>:<span class="number">2222</span>&#125;</span><br></pre></td></tr></table></figure>

<p><code>intstr.IntOrString.Type</code>çš„å€¼è®¾ç½®ä¸º<code>0</code>, è¡¨ç¤ºè¯¥ç»“æ„ä½“å®ä¾‹å†…çš„æ•°æ®ä¸ºæ•´å‹, æ•…è½¬jsonæ—¶, æŒ‰ç…§<code>IntVal</code>ä¸­çš„å€¼æ¥ç”Ÿæˆå­—ç¬¦ä¸²</p>
<p>*<em>æ³¨æ„: *</em> å¦‚æœæ²¡æœ‰æ˜¾å¼ä¸º<code>intstr.IntOrString.Type</code>èµ‹å€¼, åˆ™è¯¥å€¼é»˜è®¤ä¸º0, é»˜è®¤ä¼šå–<code>IntVal</code>ä¸­çš„æ•°æ®, ä¹Ÿå°±æ˜¯è¯´, å¯ä»¥ç®€å†™ä¸ºä»¥ä¸‹å½¢å¼</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">nginxService := service&#123;</span><br><span class="line">	Name: <span class="string">"nginx"</span>,</span><br><span class="line">	Host: <span class="string">"192.168.1.2"</span>,</span><br><span class="line">	Port: intstr.IntOrString&#123;IntVal: <span class="number">2222</span>&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ•°æ®ç±»å‹-å­—ç¬¦ä¸²"><a href="#æ•°æ®ç±»å‹-å­—ç¬¦ä¸²" class="headerlink" title="æ•°æ®ç±»å‹: å­—ç¬¦ä¸²"></a>æ•°æ®ç±»å‹: å­—ç¬¦ä¸²</h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"encoding/json"</span></span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"k8s.io/apimachinery/pkg/util/intstr"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> service <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name <span class="keyword">string</span> <span class="string">`json:"name"`</span></span><br><span class="line">	Host <span class="keyword">string</span> <span class="string">`json:"host"`</span></span><br><span class="line">	Port intstr.IntOrString <span class="string">`json:"port"`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	</span><br><span class="line">	nginxService := service&#123;</span><br><span class="line">		Name: <span class="string">"nginx"</span>,</span><br><span class="line">		Host: <span class="string">"192.168.1.2"</span>,</span><br><span class="line">		Port: intstr.IntOrString&#123;</span><br><span class="line">			Type:   <span class="number">1</span>,    <span class="comment">// è¿™é‡Œè®¾ç½®ä¸º1, æ„ä¸ºæ•°æ®ç±»å‹ä¸ºstr</span></span><br><span class="line">			IntVal: <span class="number">2222</span>,</span><br><span class="line">			StrVal: <span class="string">"1111"</span>,</span><br><span class="line">		&#125;,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	jsonBytes, _ := json.Marshal(nginxService)</span><br><span class="line">	fmt.Println(<span class="keyword">string</span>(jsonBytes))</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ä¸Šé¢<code>intstr.IntOrString.Type</code>çš„å€¼è®¾ç½®ä¸º<code>1</code>, è¿è¡Œç»“æœ: </p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;<span class="attr">"name"</span>:<span class="string">"nginx"</span>,<span class="attr">"host"</span>:<span class="string">"192.168.1.2"</span>,<span class="attr">"port"</span>:<span class="string">"1111"</span>&#125;</span><br></pre></td></tr></table></figure>

<p><code>intstr.IntOrString.Type</code>çš„å€¼è®¾ç½®ä¸º<code>1</code>, è¡¨ç¤ºè¯¥ç»“æ„ä½“å®ä¾‹å†…çš„æ•°æ®ä¸ºå­—ç¬¦ä¸²ç±»å‹, æ•…è½¬jsonæ—¶, æŒ‰ç…§<code>StrVal</code>ä¸­çš„å€¼æ¥ç”Ÿæˆå­—ç¬¦ä¸²</p>
]]></content>
      <categories>
        <category>Go</category>
      </categories>
      <tags>
        <tag>struct</tag>
        <tag>json</tag>
        <tag>intstr</tag>
        <tag>IntOrString</tag>
      </tags>
  </entry>
  <entry>
    <title>goè¯­è¨€ç»“æ„ä½“å¤šå­—æ®µå¤šå› ç´ æ’åº</title>
    <url>/2019/03/04/go%E8%AF%AD%E8%A8%80%E7%BB%93%E6%9E%84%E4%BD%93%E5%A4%9A%E5%AD%97%E6%AE%B5%E5%A4%9A%E5%9B%A0%E7%B4%A0%E6%8E%92%E5%BA%8F/</url>
    <content><![CDATA[<blockquote>
<p>ä¸Šç¯‡ç»“æ„ä½“æ’åºçš„æ–‡æ¡£ä»‹ç»äº†å¦‚æœä¾æ®å¤šä¸ªå­—æ®µè¿›è¡Œå•å› ç´ æ’åº, ä¸¾ä¾‹æ¥è¯´, ä¸€ä¸ªå­¦ç”Ÿå®ä¾‹, å¯ä»¥å•ç‹¬æŒ‰ç…§å§“åæ’åº, å¯ä»¥å•ç‹¬æŒ‰ç…§å¹´é¾„æ’åº, å¯ä»¥å•ç‹¬æŒ‰ç…§ä½“é‡æ’åº. æœ¬ç¯‡æ–‡ç« ä»‹ç»å¦‚æœè¿›è¡Œå¤šå› ç´ æ’åº, ä¹Ÿå°±æ˜¯æŒ‰ç…§å§“åæ’åº, å½“å§“åç›¸åŒæ—¶, æŒ‰ç…§å¹´é¾„æ’åºâ€¦</p>
</blockquote>
<p>ä»¥å®˜æ–¹æ–‡æ¡£çš„demoæ¥åšæ¼”ç¤º</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"sort"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ•°æ®ç±»å‹</span></span><br><span class="line"><span class="keyword">type</span> Change <span class="keyword">struct</span> &#123;</span><br><span class="line">	user     <span class="keyword">string</span></span><br><span class="line">	language <span class="keyword">string</span></span><br><span class="line">	lines    <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// sortæ¥å£æ–¹æ³•ä¹‹ä¸€(Less)</span></span><br><span class="line"><span class="keyword">type</span> lessFunc <span class="function"><span class="keyword">func</span><span class="params">(p1, p2 *Change)</span> <span class="title">bool</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ•°æ®é›†ç±»å‹, ä¸ä¸Šä¸€ç¯‡æ’åºæ–‡ç« (å¤šå­—æ®µå•ç‹¬æ’åº)æ¯”è¾ƒ, lesså­—æ®µçš„æ•°æ®ç±»å‹ä¸å†æ˜¯ func(p1, p2 *Change) bool</span></span><br><span class="line"><span class="comment">// è€Œæ˜¯ []func(p1, p2 *Change) bool å› ä¸ºåœ¨ç¬¬ä¸€ä¸ªæ¯”è¾ƒçš„å€¼ç›¸ç­‰çš„æƒ…å†µä¸‹, è¿˜è¦æ¯”è¾ƒç¬¬äºŒä¸ªå€¼, æ‰€ä»¥è¿™é‡Œéœ€è¦å¤šä¸ªæ¯”è¾ƒå‡½æ•°</span></span><br><span class="line"><span class="keyword">type</span> multiSorter <span class="keyword">struct</span> &#123;</span><br><span class="line">	changes []Change</span><br><span class="line">	less    []lessFunc</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Sort å‡½æ•°æœ‰ä¸¤ä¸ªä½œç”¨</span></span><br><span class="line"><span class="comment">// ç¬¬ä¸€, å°†å‚æ•°(å®é™…çš„æ•°æ®é›†)èµ‹å€¼ç»™mså¯¹è±¡</span></span><br><span class="line"><span class="comment">// ç¬¬äºŒ, è°ƒç”¨å†…ç½®sortå‡½æ•°è¿›è¡Œæ’åºæ“ä½œ</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(ms *multiSorter)</span> <span class="title">Sort</span><span class="params">(changes []Change)</span></span> &#123;</span><br><span class="line">	ms.changes = changes</span><br><span class="line">	sort.Sort(ms)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// OrderedBy å‡½æ•°çš„ä½œç”¨æ˜¯è¿”å›ä¸€ä¸ªmultiSorterå®ä¾‹, å¹¶å°†æ‰€æœ‰çš„å®é™…æ’åºå‡½æ•°èµ‹å€¼ç»™å®ä¾‹çš„lesså­—æ®µ,</span></span><br><span class="line"><span class="comment">// ä¸Šé¢å·²ç»ä¸ºmultiSorterç»“æ„ä½“å®šä¹‰äº†Sortæ–¹æ³•, æ‰€ä»¥è¯¥å‡½æ•°çš„è¿”å›å€¼å¯ä»¥ç›´æ¥è°ƒç”¨Sortæ–¹æ³•è¿›è¡Œæ’åº</span></span><br><span class="line"><span class="comment">// è¯¥å‡½æ•°ä¸­, ä¸ºmultiSorterç»“æ„ä½“ä¸­çš„lesså­—æ®µèµ‹å€¼, Sortæ–¹æ³•ä¸­åˆå°†å®é™…æ•°æ®é›†ä¼ å…¥, èµ‹å€¼ç»™multiSorterçš„changeså­—æ®µ</span></span><br><span class="line"><span class="comment">// ä¸€ä¸ªå‡½æ•°, ä¸€ä¸ªæ–¹æ³•è°ƒç”¨è¿‡å, multiSorterå®ä¾‹ä¸­ä¸¤ä¸ªå­—æ®µå°±å·²ç»å…¨éƒ¨è¢«æ­£ç¡®èµ‹å€¼, å¯ä»¥è°ƒç”¨ç³»ç»Ÿsortå‡½æ•°è¿›è¡Œæ’åº</span></span><br><span class="line"><span class="comment">// è¯¥å‡½æ•°ä¹Ÿå¯çœ‹ä½œæ˜¯ä¸€ä¸ªå·¥å‚æ–¹æ³•, ç”¨æ¥ç”Ÿæˆlesså­—æ®µå·²ç»è¢«èµ‹å€¼çš„multiSorterå®ä¾‹</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">OrderedBy</span><span class="params">(less ...lessFunc)</span> *<span class="title">multiSorter</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> &amp;multiSorter&#123;</span><br><span class="line">		less: less,</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Len ä¸ºsortæ¥å£æ–¹æ³•ä¹‹ä¸€</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(ms *multiSorter)</span> <span class="title">Len</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">len</span>(ms.changes)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Swap ä¸ºsortæ¥å£æ–¹æ³•ä¹‹ä¸€</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(ms *multiSorter)</span> <span class="title">Swap</span><span class="params">(i, j <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">	ms.changes[i], ms.changes[j] = ms.changes[j], ms.changes[i]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Less ä¸ºsortæ¥å£æ–¹æ³•ä¹‹ä¸€</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(ms *multiSorter)</span> <span class="title">Less</span><span class="params">(i, j <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">	<span class="comment">// ä¸ºäº†åé¢ç¼–å†™ç®€ä¾¿, è¿™é‡Œå°†éœ€è¦æ¯”è¾ƒçš„ä¸¤ä¸ªå…ƒç´ èµ‹å€¼ç»™ä¸¤ä¸ªå•ç‹¬çš„å˜é‡</span></span><br><span class="line">	p, q := &amp;ms.changes[i], &amp;ms.changes[j]</span><br><span class="line">	<span class="comment">// Try all but the last comparison.</span></span><br><span class="line">	<span class="keyword">var</span> k <span class="keyword">int</span></span><br><span class="line">	<span class="comment">// ç”±äºå¯èƒ½æœ‰å¤šä¸ªéœ€è¦æ’åºçš„å­—æ®µ, ä¹Ÿå°±å¯¹åº”äº†å¤šä¸ªlesså‡½æ•°, å½“ç¬¬ä¸€ä¸ªå­—æ®µçš„å€¼ç›¸ç­‰æ—¶,</span></span><br><span class="line">	<span class="comment">// éœ€è¦ä¾æ¬¡å°è¯•æ¯”å¯¹åç»­å…¶ä»–å­—æ®µçš„å€¼å¾—å¤§å°, æ‰€ä»¥è¿™é‡Œéœ€è¦è·å–æ¯”è¾ƒå‡½æ•°çš„é•¿åº¦, ä»¥ä¾¿éå†æ¯”è¾ƒ</span></span><br><span class="line">	<span class="keyword">for</span> k = <span class="number">0</span>; k &lt; <span class="built_in">len</span>(ms.less)<span class="number">-1</span>; k++ &#123;</span><br><span class="line">		<span class="comment">// æå–æ¯”è¾ƒå‡½æ•°, å°†å‡½æ•°èµ‹å€¼åˆ°æ–°çš„å˜é‡ä¸­ä»¥ä¾¿è°ƒç”¨</span></span><br><span class="line">		less := ms.less[k]</span><br><span class="line">		<span class="keyword">switch</span> &#123;</span><br><span class="line">		<span class="keyword">case</span> less(p, q):</span><br><span class="line">			<span class="comment">// å¦‚æœ p &lt; q, è¿”å›å€¼ä¸ºtrue, ä¸å­˜åœ¨ä¸¤ä¸ªå€¼ç›¸ç­‰éœ€è¦æ¯”è¾ƒåç»­å­—æ®µçš„æƒ…å†µ, æ‰€ä»¥è¿™é‡Œç›´æ¥è¿”å›</span></span><br><span class="line">			<span class="comment">// å¦‚æœ p &gt; q, è¿”å›å€¼ä¸ºfalse, åˆ™è°ƒåˆ°ä¸‹ä¸€ä¸ªcaseä¸­å¤„ç†</span></span><br><span class="line">			<span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">		<span class="keyword">case</span> less(q, p):</span><br><span class="line">			<span class="comment">// å¦‚æœ p &gt; q, è¿”å›å€¼ä¸ºfalse, ä¸å­˜åœ¨ä¸¤ä¸ªå€¼ç›¸ç­‰éœ€è¦æ¯”è¾ƒåç»­å­—æ®µçš„æƒ…å†µ, æ‰€ä»¥è¿™é‡Œç›´æ¥è¿”å›</span></span><br><span class="line">			<span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// å¦‚æœä»£ç èµ°åˆ°è¿™é‡Œ, è¯´æ˜ms.less[k]å‡½æ•°æ¯”è¾ƒå p == q; é‡æ–°å¼€å§‹ä¸‹ä¸€æ¬¡å¾ªç¯, æ›´æ¢åˆ°ä¸‹ä¸€ä¸ªæ¯”è¾ƒå‡½æ•°å¤„ç†</span></span><br><span class="line">		<span class="keyword">continue</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// å¦‚æœä»£ç èµ°åˆ°è¿™é‡Œ, è¯´æ˜æ‰€æœ‰çš„æ¯”è¾ƒå‡½æ•°æ‰§è¡Œè¿‡å, æ‰€æœ‰æ¯”è¾ƒçš„å€¼éƒ½ç›¸ç­‰</span></span><br><span class="line">	<span class="comment">// ç›´æ¥è¿”å›æœ€åä¸€æ¬¡çš„æ¯”è¾ƒç»“æœæ•°æ®å³å¯</span></span><br><span class="line">	<span class="keyword">return</span> ms.less[k](p, q)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> changes = []Change&#123;</span><br><span class="line">	&#123;<span class="string">"gri"</span>, <span class="string">"Go"</span>, <span class="number">100</span>&#125;,</span><br><span class="line">	&#123;<span class="string">"ken"</span>, <span class="string">"C"</span>, <span class="number">150</span>&#125;,</span><br><span class="line">	&#123;<span class="string">"glenda"</span>, <span class="string">"Go"</span>, <span class="number">200</span>&#125;,</span><br><span class="line">	&#123;<span class="string">"rsc"</span>, <span class="string">"Go"</span>, <span class="number">200</span>&#125;,</span><br><span class="line">	&#123;<span class="string">"r"</span>, <span class="string">"Go"</span>, <span class="number">100</span>&#125;,</span><br><span class="line">	&#123;<span class="string">"ken"</span>, <span class="string">"Go"</span>, <span class="number">200</span>&#125;,</span><br><span class="line">	&#123;<span class="string">"dmr"</span>, <span class="string">"C"</span>, <span class="number">100</span>&#125;,</span><br><span class="line">	&#123;<span class="string">"r"</span>, <span class="string">"C"</span>, <span class="number">150</span>&#125;,</span><br><span class="line">	&#123;<span class="string">"gri"</span>, <span class="string">"Smalltalk"</span>, <span class="number">80</span>&#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// é¢„å®šä¹‰æ’åºå‡½æ•°: æŒ‰ç…§å§“åå‡åºæ’åˆ—</span></span><br><span class="line">	user := <span class="function"><span class="keyword">func</span><span class="params">(c1, c2 *Change)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">		<span class="keyword">return</span> c1.user &lt; c2.user</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// é¢„å®šä¹‰æ’åºå‡½æ•°: æŒ‰ç…§è¯­è¨€å‡åºæ’åˆ—</span></span><br><span class="line">	language := <span class="function"><span class="keyword">func</span><span class="params">(c1, c2 *Change)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">		<span class="keyword">return</span> c1.language &lt; c2.language</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// é¢„å®šä¹‰æ’åºå‡½æ•°: æŒ‰ç…§è¡Œæ•°å‡åºæ’åˆ—</span></span><br><span class="line">	increasingLines := <span class="function"><span class="keyword">func</span><span class="params">(c1, c2 *Change)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">		<span class="keyword">return</span> c1.lines &lt; c2.lines</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//é¢„å®šä¹‰æ’åºå‡½æ•°: æŒ‰ç…§è¡Œæ•°é™åºæ’åˆ—</span></span><br><span class="line">	decreasingLines := <span class="function"><span class="keyword">func</span><span class="params">(c1, c2 *Change)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">		<span class="keyword">return</span> c1.lines &gt; c2.lines</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// æŒ‰ç…§å§“åå‡åºæ’åˆ—</span></span><br><span class="line">	OrderedBy(user).Sort(changes)</span><br><span class="line">	fmt.Println(<span class="string">"By user:\t\t"</span>, changes)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// æŒ‰ç…§å§“åå‡åºæ’åˆ—, å§“åç›¸åŒçš„æŒ‰è¡Œæ•°å‡åºæ’åˆ—</span></span><br><span class="line">	OrderedBy(user, increasingLines).Sort(changes)</span><br><span class="line">	fmt.Println(<span class="string">"By user,&lt;lines:\t\t"</span>, changes)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// æŒ‰å§“åå‡åºæ’åˆ—, å§“åç›¸åŒçš„æŒ‰è¡Œæ•°é™åºæ’åˆ—</span></span><br><span class="line">	OrderedBy(user, decreasingLines).Sort(changes)</span><br><span class="line">	fmt.Println(<span class="string">"By user,&gt;lines:\t\t"</span>, changes)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// æŒ‰è¯­è¨€å‡åºæ’åˆ—, è¯­è¨€ç›¸åŒæŒ‰è¡Œæ•°å‡åºæ’åˆ—</span></span><br><span class="line">	OrderedBy(language, increasingLines).Sort(changes)</span><br><span class="line">	fmt.Println(<span class="string">"By language,&lt;lines:\t"</span>, changes)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// æŒ‰è¯­è¨€å‡åºæ’åˆ—, è¯­è¨€ç›¸åŒæŒ‰è¡Œæ•°å‡åºæ’åˆ—, è¡Œæ•°ä¹Ÿç›¸åŒçš„, æŒ‰å§“åå‡åºæ’åˆ—</span></span><br><span class="line">	OrderedBy(language, increasingLines, user).Sort(changes)</span><br><span class="line">	fmt.Println(<span class="string">"By language,&lt;lines,user:"</span>, changes)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">By user:                 [&#123;dmr C 100&#125; &#123;glenda Go 200&#125; &#123;gri Go 100&#125; &#123;gri Smalltalk 80&#125; &#123;ken C 150&#125; &#123;ken Go 200&#125; &#123;r Go 100&#125; &#123;r C 150&#125; &#123;rsc Go 200&#125;]</span><br><span class="line">By user,&lt;lines:          [&#123;dmr C 100&#125; &#123;glenda Go 200&#125; &#123;gri Smalltalk 80&#125; &#123;gri Go 100&#125; &#123;ken C 150&#125; &#123;ken Go 200&#125; &#123;r Go 100&#125; &#123;r C 150&#125; &#123;rsc Go 200&#125;]</span><br><span class="line">By user,&gt;lines:          [&#123;dmr C 100&#125; &#123;glenda Go 200&#125; &#123;gri Go 100&#125; &#123;gri Smalltalk 80&#125; &#123;ken Go 200&#125; &#123;ken C 150&#125; &#123;r C 150&#125; &#123;r Go 100&#125; &#123;rsc Go 200&#125;]</span><br><span class="line">By language,&lt;lines:      [&#123;dmr C 100&#125; &#123;ken C 150&#125; &#123;r C 150&#125; &#123;r Go 100&#125; &#123;gri Go 100&#125; &#123;ken Go 200&#125; &#123;glenda Go 200&#125; &#123;rsc Go 200&#125; &#123;gri Smalltalk 80&#125;]</span><br><span class="line">By language,&lt;lines,user: [&#123;dmr C 100&#125; &#123;ken C 150&#125; &#123;r C 150&#125; &#123;gri Go 100&#125; &#123;r Go 100&#125; &#123;glenda Go 200&#125; &#123;ken Go 200&#125; &#123;rsc Go 200&#125; &#123;gri Smalltalk 80&#125;]</span><br></pre></td></tr></table></figure>

<p>ä¸ä¸Šä¸€ç¯‡æ–‡ç« &lt;goè¯­è¨€ç»“æ„ä½“æ’åº&gt;(ç®€ç§°A)ä¸­&lt;ç»“æ„ä½“å¤šå­—æ®µå•ç‹¬æ’åº&gt;çš„ä»£ç åŒºåˆ« (æœ¬ç¯‡ç®€ç§°B):</p>
<p>A:</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> By <span class="function"><span class="keyword">func</span><span class="params">(i, j student)</span> <span class="title">bool</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b By)</span> <span class="title">Sort</span> <span class="params">(students []student)</span></span> &#123;</span><br><span class="line">	<span class="comment">// ç”Ÿæˆæ•°æ®é›†</span></span><br><span class="line">	ss := studentSorter&#123;</span><br><span class="line">		students: students,</span><br><span class="line">		by:       b,</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// å¯¹æ•°æ®é›†è¿›è¡Œæ’åº</span></span><br><span class="line">	sort.Sort(ss)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>B:</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> multiSorter <span class="keyword">struct</span> &#123;</span><br><span class="line">	changes []Change</span><br><span class="line">	less    []lessFunc</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨æ•°æ®é›†ç±»å‹ä¸­ç¼–å†™Sortæ’åºæ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(ms *multiSorter)</span> <span class="title">Sort</span><span class="params">(changes []Change)</span></span> &#123;</span><br><span class="line">	ms.changes = changes</span><br><span class="line">	<span class="comment">// å¯¹æ•°æ®é›†è¿›è¡Œæ’åº</span></span><br><span class="line">	sort.Sort(ms)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">OrderedBy</span><span class="params">(less ...lessFunc)</span> *<span class="title">multiSorter</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> &amp;multiSorter&#123;</span><br><span class="line">		less: less,</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>A Bä¸¤ç¯‡ä¸­å„æˆªå–äº†éƒ¨åˆ†ä»£ç , å‡æ¶‰åŠä¸¤é¡¹æ“ä½œ</p>
<ul>
<li>ç”Ÿæˆæ•°æ®é›†</li>
<li>æ’åº</li>
</ul>
<p>Aç¯‡çš„æ“ä½œä¸º: å•ç‹¬å£°æ˜ä¸€ä¸ª<code>By</code>æ•°æ®ç±»å‹, ä¸ºè¯¥æ•°æ®ç±»å‹ç¼–å†™æ–¹æ³•, æ–¹æ³•ä¸­çš„ç¬¬ä¸€æ­¥ä¸ºç”Ÿæˆæ•°æ®é›†, ç¬¬äºŒæ­¥ä¸ºæ’åºæ“ä½œ. è°ƒç”¨æ—¶<code>By(name).Sort(students)</code>ä¸­çš„<code>By(name)</code>æ˜¯ç±»å‹è½¬æ¢æ“ä½œ, åç»­çš„<code>.Sort()</code>æ–¹æ³•æ˜¯è°ƒç”¨<code>By</code>è‡ªå·±çš„<code>Sort</code>æ–¹æ³•å¾—åˆ°çš„æ’åºç»“æœ</p>
<p>Bç¯‡çš„æ“ä½œä¸º: å•ç‹¬ç¼–å†™ä¸€ä¸ª<code>OrderBy</code>å‡½æ•°, è¯¥<code>OrderBy</code>å‡½æ•°ä»…ç”¨äºç”Ÿæˆæ•°æ®é›†å¹¶è¿”å›, éœ€è¦æ³¨æ„çš„æ˜¯, è¿™é‡Œç”Ÿæˆçš„æ•°æ®é›†, ä»…åŒ…å«æœ‰æ’åºå‡½æ•°, ä¸åŒ…å«å®é™…æ•°æ®. ç”±äºæ•°æ®é›†ç±»å‹æœ¬èº«è‡ªå¸¦<code>Sort</code>æ–¹æ³•, æ‰€ä»¥è¿”å›çš„æ•°æ®å¯ä»¥ç›´æ¥è°ƒç”¨<code>Sort</code>æ–¹æ³•æ‰§è¡Œæ’åºæ“ä½œ, æ’åºä¹‹å‰, å°†å‚æ•°ä¸­çš„æ•°æ®å¡«å……åˆ°æ•°æ®é›†ä¸­, å½¢æˆå®Œæ•´çš„æ•°æ®é›†. è°ƒç”¨æ—¶<code>OrderedBy(user).Sort(changes)</code>ä¸­çš„<code>OrderedBy(user)</code>ä¸Aç¯‡ä¸åŒ, æ­¤å¤„ä¸æ˜¯ç±»å‹è½¬æ¢, è€Œæ˜¯å‡½æ•°è°ƒç”¨, åç»­çš„<code>.Sort()</code>æ–¹æ³•æ˜¯ç”±<code>OrderedBy()</code>å‡½æ•°è¿”å›çš„<code>multiSorter</code>å¯¹è±¡, è°ƒç”¨<code>multiSorter</code>ä¸­çš„<code>Sort</code>æ–¹æ³•å¾—åˆ°çš„æ’åºç»“æœ</p>
<p>A Bä¸¤ç¯‡çš„æ’åºæ–¹æ³•ç•¥æœ‰å·®åˆ«, ä½†æœ¬è´¨éƒ½æ˜¯ä¸€æ ·çš„, æ ¸å¿ƒæ“ä½œéƒ½æ˜¯<code>ç”Ÿæˆæ•°æ®é›†</code>å’Œ<code>æ’åº</code>, åªæ˜¯Bç¯‡ä¸­, Lessæ–¹æ³•éœ€è¦æ ¹æ®å¤šå› ç´ æ’åº, ç•¥å¾®å¤æ‚ä¸€äº›. ä¸Šé¢çš„ä¾‹å­æ˜¯å®˜æ–¹çš„demo, å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥å®Œå…¨æŒ‰ç…§Aç¯‡çš„é£æ ¼æ”¹å†™</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åˆ é™¤multiSorteræ•°æ®ç±»å‹ä¸­çš„Sortæ–¹æ³•</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å£°æ˜OrderedByæ•°æ®ç±»å‹</span></span><br><span class="line"><span class="keyword">type</span> OrderedBy []lessFunc</span><br><span class="line"><span class="comment">// ä¸Aç¯‡é£æ ¼ä¿æŒä¸€è‡´, åœ¨OrderedByçš„æ–¹æ³•ä¸­è¿›è¡Œæ•°æ®é›†çš„å®Œæ•´ç”Ÿæˆå’Œæ’åºæ“ä½œ</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(ob OrderedBy)</span> <span class="title">Sort</span> <span class="params">(changes []Change)</span></span> &#123;</span><br><span class="line">    <span class="comment">// ç”Ÿæˆå®Œæ•´çš„æ•°æ®é›†</span></span><br><span class="line">	ms := &amp;multiSorter&#123;</span><br><span class="line">		changes: changes,</span><br><span class="line">		less: ob,</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// æ’åº</span></span><br><span class="line">	sort.Sort(ms)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·ä¿®æ”¹ä¹‹å, è°ƒç”¨æ–¹å¼ä¹Ÿå‘ç”Ÿäº†å˜æ›´</p>
<p><code>OrderedBy()</code>æ˜¯ä¸€ä¸ªç±»å‹è½¬æ¢çš„æ“ä½œ, æ ¹æ®ä¸Šé¢çš„å£°æ˜, å®ƒåªèƒ½è½¬æ¢<code>[]lessFunc</code>ç±»å‹çš„æ•°æ®, æ‰€ä»¥éœ€è¦å…ˆå£°æ˜å¹¶èµ‹å€¼<code>[]lessFunc{}</code>å¯¹è±¡, ç„¶åæ‰èƒ½äº¤ç»™<code>OrderedBy()</code>å‡½æ•°è¿›è¡Œç±»å‹è½¬æ¢. è½¬æ¢åå…¶è‡ªèº«æ‹¥æœ‰<code>Sort</code>æ–¹æ³•å¯ä¾›è°ƒç”¨</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">   OrderedBy([]lessFunc&#123;user&#125;).Sort(changes)</span><br><span class="line">fmt.Println(<span class="string">"By user:\t\t"</span>, changes)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŒ‰ç…§å§“åå‡åºæ’åˆ—, å§“åç›¸åŒçš„æŒ‰è¡Œæ•°å‡åºæ’åˆ—</span></span><br><span class="line">OrderedBy([]lessFunc&#123;user, increasingLines&#125;).Sort(changes)</span><br><span class="line">fmt.Println(<span class="string">"By user,&lt;lines:\t\t"</span>, changes)</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸‹æ˜¯Aç¯‡é£æ ¼çš„å®Œæ•´ä»£ç </p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"sort"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ•°æ®ç±»å‹</span></span><br><span class="line"><span class="keyword">type</span> Change <span class="keyword">struct</span> &#123;</span><br><span class="line">	user     <span class="keyword">string</span></span><br><span class="line">	language <span class="keyword">string</span></span><br><span class="line">	lines    <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// sortæ¥å£æ–¹æ³•ä¹‹ä¸€(Less)</span></span><br><span class="line"><span class="keyword">type</span> lessFunc <span class="function"><span class="keyword">func</span><span class="params">(p1, p2 *Change)</span> <span class="title">bool</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ•°æ®é›†ç±»å‹, ä¸ä¸Šä¸€ç¯‡æ’åºæ–‡ç« (å¤šå­—æ®µå•ç‹¬æ’åº)æ¯”è¾ƒ, lesså­—æ®µçš„æ•°æ®ç±»å‹ä¸å†æ˜¯ func(p1, p2 *Change) bool</span></span><br><span class="line"><span class="comment">// è€Œæ˜¯ []func(p1, p2 *Change) bool å› ä¸ºåœ¨ç¬¬ä¸€ä¸ªæ¯”è¾ƒçš„å€¼ç›¸ç­‰çš„æƒ…å†µä¸‹, è¿˜è¦æ¯”è¾ƒç¬¬äºŒä¸ªå€¼, æ‰€ä»¥è¿™é‡Œéœ€è¦å¤šä¸ªæ¯”è¾ƒå‡½æ•°</span></span><br><span class="line"><span class="keyword">type</span> multiSorter <span class="keyword">struct</span> &#123;</span><br><span class="line">	changes []Change</span><br><span class="line">	less    []lessFunc</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> OrderedBy []lessFunc</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(ob OrderedBy)</span> <span class="title">Sort</span> <span class="params">(changes []Change)</span></span> &#123;</span><br><span class="line">	ms := &amp;multiSorter&#123;</span><br><span class="line">		changes: changes,</span><br><span class="line">		less: ob,</span><br><span class="line">	&#125;</span><br><span class="line">	sort.Sort(ms)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Len ä¸ºsortæ¥å£æ–¹æ³•ä¹‹ä¸€</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(ms *multiSorter)</span> <span class="title">Len</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">len</span>(ms.changes)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Swap ä¸ºsortæ¥å£æ–¹æ³•ä¹‹ä¸€</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(ms *multiSorter)</span> <span class="title">Swap</span><span class="params">(i, j <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">	ms.changes[i], ms.changes[j] = ms.changes[j], ms.changes[i]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Less ä¸ºsortæ¥å£æ–¹æ³•ä¹‹ä¸€</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(ms *multiSorter)</span> <span class="title">Less</span><span class="params">(i, j <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">	<span class="comment">// ä¸ºäº†åé¢ç¼–å†™ç®€ä¾¿, è¿™é‡Œå°†éœ€è¦æ¯”è¾ƒçš„ä¸¤ä¸ªå…ƒç´ èµ‹å€¼ç»™ä¸¤ä¸ªå•ç‹¬çš„å˜é‡</span></span><br><span class="line">	p, q := &amp;ms.changes[i], &amp;ms.changes[j]</span><br><span class="line">	<span class="comment">// Try all but the last comparison.</span></span><br><span class="line">	<span class="keyword">var</span> k <span class="keyword">int</span></span><br><span class="line">	<span class="comment">// ç”±äºå¯èƒ½æœ‰å¤šä¸ªéœ€è¦æ’åºçš„å­—æ®µ, ä¹Ÿå°±å¯¹åº”äº†å¤šä¸ªlesså‡½æ•°, å½“ç¬¬ä¸€ä¸ªå­—æ®µçš„å€¼ç›¸ç­‰æ—¶,</span></span><br><span class="line">	<span class="comment">// éœ€è¦ä¾æ¬¡å°è¯•æ¯”å¯¹åç»­å…¶ä»–å­—æ®µçš„å€¼å¾—å¤§å°, æ‰€ä»¥è¿™é‡Œéœ€è¦è·å–æ¯”è¾ƒå‡½æ•°çš„é•¿åº¦, ä»¥ä¾¿éå†æ¯”è¾ƒ</span></span><br><span class="line">	<span class="keyword">for</span> k = <span class="number">0</span>; k &lt; <span class="built_in">len</span>(ms.less)<span class="number">-1</span>; k++ &#123;</span><br><span class="line">		<span class="comment">// æå–æ¯”è¾ƒå‡½æ•°, å°†å‡½æ•°èµ‹å€¼åˆ°æ–°çš„å˜é‡ä¸­ä»¥ä¾¿è°ƒç”¨</span></span><br><span class="line">		less := ms.less[k]</span><br><span class="line">		<span class="keyword">switch</span> &#123;</span><br><span class="line">		<span class="keyword">case</span> less(p, q):</span><br><span class="line">			<span class="comment">// å¦‚æœ p &lt; q, è¿”å›å€¼ä¸ºtrue, ä¸å­˜åœ¨ä¸¤ä¸ªå€¼ç›¸ç­‰éœ€è¦æ¯”è¾ƒåç»­å­—æ®µçš„æƒ…å†µ, æ‰€ä»¥è¿™é‡Œç›´æ¥è¿”å›</span></span><br><span class="line">			<span class="comment">// å¦‚æœ p &gt; q, è¿”å›å€¼ä¸ºfalse, åˆ™è°ƒåˆ°ä¸‹ä¸€ä¸ªcaseä¸­å¤„ç†</span></span><br><span class="line">			<span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">		<span class="keyword">case</span> less(q, p):</span><br><span class="line">			<span class="comment">// å¦‚æœ p &gt; q, è¿”å›å€¼ä¸ºfalse, ä¸å­˜åœ¨ä¸¤ä¸ªå€¼ç›¸ç­‰éœ€è¦æ¯”è¾ƒåç»­å­—æ®µçš„æƒ…å†µ, æ‰€ä»¥è¿™é‡Œç›´æ¥è¿”å›</span></span><br><span class="line">			<span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// å¦‚æœä»£ç èµ°åˆ°è¿™é‡Œ, è¯´æ˜ms.less[k]å‡½æ•°æ¯”è¾ƒå p == q; é‡æ–°å¼€å§‹ä¸‹ä¸€æ¬¡å¾ªç¯, æ›´æ¢åˆ°ä¸‹ä¸€ä¸ªæ¯”è¾ƒå‡½æ•°å¤„ç†</span></span><br><span class="line">		<span class="keyword">continue</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// å¦‚æœä»£ç èµ°åˆ°è¿™é‡Œ, è¯´æ˜æ‰€æœ‰çš„æ¯”è¾ƒå‡½æ•°æ‰§è¡Œè¿‡å, æ‰€æœ‰æ¯”è¾ƒçš„å€¼éƒ½ç›¸ç­‰</span></span><br><span class="line">	<span class="comment">// ç›´æ¥è¿”å›æœ€åä¸€æ¬¡çš„æ¯”è¾ƒç»“æœæ•°æ®å³å¯</span></span><br><span class="line">	<span class="keyword">return</span> ms.less[k](p, q)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> changes = []Change&#123;</span><br><span class="line">	&#123;<span class="string">"gri"</span>, <span class="string">"Go"</span>, <span class="number">100</span>&#125;,</span><br><span class="line">	&#123;<span class="string">"ken"</span>, <span class="string">"C"</span>, <span class="number">150</span>&#125;,</span><br><span class="line">	&#123;<span class="string">"glenda"</span>, <span class="string">"Go"</span>, <span class="number">200</span>&#125;,</span><br><span class="line">	&#123;<span class="string">"rsc"</span>, <span class="string">"Go"</span>, <span class="number">200</span>&#125;,</span><br><span class="line">	&#123;<span class="string">"r"</span>, <span class="string">"Go"</span>, <span class="number">100</span>&#125;,</span><br><span class="line">	&#123;<span class="string">"ken"</span>, <span class="string">"Go"</span>, <span class="number">200</span>&#125;,</span><br><span class="line">	&#123;<span class="string">"dmr"</span>, <span class="string">"C"</span>, <span class="number">100</span>&#125;,</span><br><span class="line">	&#123;<span class="string">"r"</span>, <span class="string">"C"</span>, <span class="number">150</span>&#125;,</span><br><span class="line">	&#123;<span class="string">"gri"</span>, <span class="string">"Smalltalk"</span>, <span class="number">80</span>&#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// é¢„å®šä¹‰æ’åºå‡½æ•°: æŒ‰ç…§å§“åå‡åºæ’åˆ—</span></span><br><span class="line">	user := <span class="function"><span class="keyword">func</span><span class="params">(c1, c2 *Change)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">		<span class="keyword">return</span> c1.user &lt; c2.user</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// é¢„å®šä¹‰æ’åºå‡½æ•°: æŒ‰ç…§è¯­è¨€å‡åºæ’åˆ—</span></span><br><span class="line">	language := <span class="function"><span class="keyword">func</span><span class="params">(c1, c2 *Change)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">		<span class="keyword">return</span> c1.language &lt; c2.language</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// é¢„å®šä¹‰æ’åºå‡½æ•°: æŒ‰ç…§è¡Œæ•°å‡åºæ’åˆ—</span></span><br><span class="line">	increasingLines := <span class="function"><span class="keyword">func</span><span class="params">(c1, c2 *Change)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">		<span class="keyword">return</span> c1.lines &lt; c2.lines</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//é¢„å®šä¹‰æ’åºå‡½æ•°: æŒ‰ç…§è¡Œæ•°é™åºæ’åˆ—</span></span><br><span class="line">	decreasingLines := <span class="function"><span class="keyword">func</span><span class="params">(c1, c2 *Change)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">		<span class="keyword">return</span> c1.lines &gt; c2.lines</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">// æŒ‰ç…§å§“åå‡åºæ’åˆ—</span></span><br><span class="line">	OrderedBy([]lessFunc&#123;user&#125;).Sort(changes)</span><br><span class="line">	fmt.Println(<span class="string">"By user:\t\t"</span>, changes)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// æŒ‰ç…§å§“åå‡åºæ’åˆ—, å§“åç›¸åŒçš„æŒ‰è¡Œæ•°å‡åºæ’åˆ—</span></span><br><span class="line">	OrderedBy([]lessFunc&#123;user, increasingLines&#125;).Sort(changes)</span><br><span class="line">	fmt.Println(<span class="string">"By user,&lt;lines:\t\t"</span>, changes)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// æŒ‰å§“åå‡åºæ’åˆ—, å§“åç›¸åŒçš„æŒ‰è¡Œæ•°é™åºæ’åˆ—</span></span><br><span class="line">	OrderedBy([]lessFunc&#123;user, decreasingLines&#125;).Sort(changes)</span><br><span class="line">	fmt.Println(<span class="string">"By user,&gt;lines:\t\t"</span>, changes)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// æŒ‰è¯­è¨€å‡åºæ’åˆ—, è¯­è¨€ç›¸åŒæŒ‰è¡Œæ•°å‡åºæ’åˆ—</span></span><br><span class="line">	OrderedBy([]lessFunc&#123;language, increasingLines&#125;).Sort(changes)</span><br><span class="line">	fmt.Println(<span class="string">"By language,&lt;lines:\t"</span>, changes)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// æŒ‰è¯­è¨€å‡åºæ’åˆ—, è¯­è¨€ç›¸åŒæŒ‰è¡Œæ•°å‡åºæ’åˆ—, è¡Œæ•°ä¹Ÿç›¸åŒçš„, æŒ‰å§“åå‡åºæ’åˆ—</span></span><br><span class="line">	OrderedBy([]lessFunc&#123;language, increasingLines, user&#125;).Sort(changes)</span><br><span class="line">	fmt.Println(<span class="string">"By language,&lt;lines,user:"</span>, changes)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Go</category>
      </categories>
      <tags>
        <tag>go</tag>
        <tag>sort</tag>
      </tags>
  </entry>
  <entry>
    <title>goè¯­è¨€ç»“æ„ä½“æ’åº</title>
    <url>/2019/02/22/go%E8%AF%AD%E8%A8%80%E7%BB%93%E6%9E%84%E4%BD%93%E6%8E%92%E5%BA%8F/</url>
    <content><![CDATA[<blockquote>
<p>æœ‰äº†goè¯­è¨€ä¸­çš„æ’åºæ¥å£, å¯ä»¥å¾ˆå®¹æ˜“çš„å¯¹ç»“æ„ä½“çš„ä»»æ„ä¸€ä¸ªå­—æ®µè¿›è¡Œæ’åº, å…·ä½“ä»¥å“ªä¸ªå­—æ®µæ’åº, å®šä¹‰åœ¨è¯¥ç»“æ„ä½“Sliceçš„<code>Less</code>æ–¹æ³•ä¸­. ä¸€ä¸ªç»“æ„ä½“çš„Sliceä»…å¯ä»¥å®ç°ä¸€æ¬¡<code>sort</code>æ¥å£, å¦‚æœä¸€ä¸ªç»“æ„ä½“ä¸­æœ‰å¤šä¸ªå­—æ®µéœ€è¦å•ç‹¬è¿›è¡Œæ’åº, æœ€ç²—é²çš„åŠæ³•åªèƒ½æ˜¯å®šä¹‰å¤šä¸ªSliceç±»å‹, ä¸ºæ¯ä¸ªç±»å‹éƒ½ç¼–å†™ä¸åŒçš„<code>Less</code>æ–¹æ³•</p>
</blockquote>
<p>çº¦å®šå…³é”®å­—:</p>
<p>å¤šå­—æ®µå•ç‹¬æ’åº: ä¸€ä¸ªç»“æ„ä½“ä¸­, éœ€è¦æœ‰å¤šä¸ªå­—æ®µä½œä¸ºä¾æ®, å•ç‹¬è¿›è¡Œæ’åº, å•ä¸ªå­—æ®µæ’åºæ—¶ä¸å—å…¶ä»–å­—æ®µæ’åºç­–ç•¥çš„å½±å“<br>å¤šå­—æ®µå¤šå› ç´ æ’åº: ä¸€ä¸ªç»“æ„ä½“ä¸­, å¯¹ç¬¬ä¸€ä¸ªå­—æ®µæ’åºæ—¶, å¦‚æœè¯¥å­—æ®µçš„æ•°å€¼ç›¸ç­‰, æŒ‰å…¶ä»–å­—æ®µå†æ¬¡è¿›è¡Œæ’åºæ“ä½œ(ä¾‹å¦‚: æŒ‰å¹´é¾„è¿›è¡Œæ’åº, å¹´é¾„ç›¸åŒçš„æŒ‰ä½“é‡æ’åº)</p>
<h2 id="ç»“æ„ä½“å•å­—æ®µæ’åº"><a href="#ç»“æ„ä½“å•å­—æ®µæ’åº" class="headerlink" title="ç»“æ„ä½“å•å­—æ®µæ’åº"></a>ç»“æ„ä½“å•å­—æ®µæ’åº</h2><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"sort"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…ƒç´ ç±»å‹</span></span><br><span class="line"><span class="keyword">type</span> student <span class="keyword">struct</span> &#123;</span><br><span class="line">	name <span class="keyword">string</span></span><br><span class="line">	age <span class="keyword">uint</span></span><br><span class="line">	weight <span class="keyword">float32</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ•°æ®é›†ç±»å‹</span></span><br><span class="line"><span class="keyword">type</span> students []student</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s students)</span> <span class="title">Len</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">len</span>(s)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s students)</span> <span class="title">Swap</span><span class="params">(i, j <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">	s[i], s[j] = s[j], s[i]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s students)</span> <span class="title">Less</span><span class="params">(i, j <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> s[i].age &lt; s[j].age</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ•°æ®é›†</span></span><br><span class="line"><span class="keyword">var</span> ss = students&#123;</span><br><span class="line">	&#123;<span class="string">"d"</span>, <span class="number">7</span>, <span class="number">28</span>&#125;,</span><br><span class="line">	&#123;<span class="string">"c"</span>, <span class="number">3</span>, <span class="number">40</span>&#125;,</span><br><span class="line">	&#123;<span class="string">"b"</span>, <span class="number">8</span>, <span class="number">35</span>&#125;,</span><br><span class="line">	&#123;<span class="string">"a"</span>, <span class="number">5</span>, <span class="number">30</span>&#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	sort.Sort(ss)</span><br><span class="line">	fmt.Println(ss)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[&#123;c 3 40&#125; &#123;a 5 30&#125; &#123;d 7 28&#125; &#123;b 8 35&#125;]</span><br></pre></td></tr></table></figure>

<h2 id="ç»“æ„ä½“å¤šå­—æ®µå•ç‹¬æ’åº"><a href="#ç»“æ„ä½“å¤šå­—æ®µå•ç‹¬æ’åº" class="headerlink" title="ç»“æ„ä½“å¤šå­—æ®µå•ç‹¬æ’åº"></a>ç»“æ„ä½“å¤šå­—æ®µå•ç‹¬æ’åº</h2><p>å¤šå­—æ®µéœ€è¦æ’åºçš„, æœ€ç²—é²çš„åŠæ³•æ˜¯ä¸ºæ¯ä¸€ä¸ªéœ€è¦æ’åºçš„å­—æ®µå•ç‹¬å£°æ˜ä¸€ä¸ªæ•°æ®é›†ç±»å‹, ç„¶ååœ¨æ¯ä¸ªæ•°æ®é›†ç±»å‹ä¸­å®ç°å…¶å¯¹åº”çš„<code>Less</code>æ–¹æ³•</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"sort"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> student <span class="keyword">struct</span> &#123;</span><br><span class="line">	name <span class="keyword">string</span></span><br><span class="line">	age <span class="keyword">uint</span></span><br><span class="line">	weight <span class="keyword">float32</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> studentsSortByName []student</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s studentsSortByName)</span> <span class="title">Len</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">len</span>(s)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s studentsSortByName)</span> <span class="title">Swap</span><span class="params">(i, j <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">	s[i], s[j] = s[j], s[i]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s studentsSortByName)</span> <span class="title">Less</span><span class="params">(i, j <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> s[i].name &lt; s[j].name</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> studentsSortByAge []student</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s studentsSortByAge)</span> <span class="title">Len</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">len</span>(s)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s studentsSortByAge)</span> <span class="title">Swap</span><span class="params">(i, j <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">	s[i], s[j] = s[j], s[i]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s studentsSortByAge)</span> <span class="title">Less</span><span class="params">(i, j <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> s[i].age &lt; s[j].age</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> studentsSortByWeight []student</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s studentsSortByWeight)</span> <span class="title">Len</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">len</span>(s)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s studentsSortByWeight)</span> <span class="title">Swap</span><span class="params">(i, j <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">	s[i], s[j] = s[j], s[i]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s studentsSortByWeight)</span> <span class="title">Less</span><span class="params">(i, j <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> s[i].weight &lt; s[j].weight</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ•°æ®é›†</span></span><br><span class="line"><span class="keyword">var</span> ss = []student&#123;</span><br><span class="line">	&#123;<span class="string">"d"</span>, <span class="number">7</span>, <span class="number">28</span>&#125;,</span><br><span class="line">	&#123;<span class="string">"c"</span>, <span class="number">3</span>, <span class="number">40</span>&#125;,</span><br><span class="line">	&#123;<span class="string">"b"</span>, <span class="number">8</span>, <span class="number">35</span>&#125;,</span><br><span class="line">	&#123;<span class="string">"a"</span>, <span class="number">5</span>, <span class="number">30</span>&#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	sort.Sort(studentsSortByName(ss))</span><br><span class="line">	fmt.Println(ss)</span><br><span class="line"></span><br><span class="line">	sort.Sort(studentsSortByAge(ss))</span><br><span class="line">	fmt.Println(ss)</span><br><span class="line"></span><br><span class="line">	sort.Sort(studentsSortByWeight(ss))</span><br><span class="line">	fmt.Println(ss)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[&#123;a 5 30&#125; &#123;b 8 35&#125; &#123;c 3 40&#125; &#123;d 7 28&#125;]  &#x2F;&#x2F; æŒ‰å§“åæ’åº</span><br><span class="line">[&#123;c 3 40&#125; &#123;a 5 30&#125; &#123;d 7 28&#125; &#123;b 8 35&#125;]  &#x2F;&#x2F; æŒ‰å¹´é¾„æ’åº</span><br><span class="line">[&#123;d 7 28&#125; &#123;a 5 30&#125; &#123;b 8 35&#125; &#123;c 3 40&#125;]  &#x2F;&#x2F; æŒ‰ä½“é‡æ’åº</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªæ’åºçš„åŠæ³•çš„åŠ£åŠ¿æ˜¯éœ€è¦å†™å¾ˆå¤šé‡å¤ä»£ç , é€šè¿‡è¿™ä¸ªä¾‹å­ä¹Ÿå¯ä»¥çœ‹å‡º, æŒ‰ä¸åŠ¨å­—æ®µæ’åºå®é™…åªæ˜¯<code>Less</code>æ–¹æ³•çš„å®ç°ä¸åŒ</p>
<h2 id="ç»“æ„ä½“å¤šå­—æ®µå•ç‹¬æ’åº-æ¨è"><a href="#ç»“æ„ä½“å¤šå­—æ®µå•ç‹¬æ’åº-æ¨è" class="headerlink" title="ç»“æ„ä½“å¤šå­—æ®µå•ç‹¬æ’åº(æ¨è)"></a>ç»“æ„ä½“å¤šå­—æ®µå•ç‹¬æ’åº(æ¨è)</h2><p>è¿™é‡Œä»‹ç»ä¸€ä¸ªæ›´ä¼˜é›…çš„æ–¹å¼, è§£å†³ä¸Šé¢å¤šå­—æ®µæ’åºéœ€è¦ç¼–å†™<code>n * 3</code>æ–¹æ³•çš„é—®é¢˜</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"sort"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰å…ƒç´ ç±»å‹</span></span><br><span class="line"><span class="keyword">type</span> student <span class="keyword">struct</span> &#123;</span><br><span class="line">	name <span class="keyword">string</span></span><br><span class="line">	age <span class="keyword">uint</span></span><br><span class="line">	weight <span class="keyword">float32</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰æ•°æ®é›†ç±»å‹</span></span><br><span class="line"><span class="comment">// åœ¨å•å­—æ®µæ’åºä¸­, æ•°æ®é›†ç±»å‹ä»…ä»…æ˜¯å…ƒç´ ç±»å‹çš„Slice, ä½†æ˜¯åœ¨æ­¤æ–¹æ³•ä¸­, å…ƒç´ ç±»å‹çš„Sliceä½œä¸ºæ•°æ®é›†ç±»å‹çš„ä¸€ä¸ªå­—æ®µå‡ºç°</span></span><br><span class="line"><span class="comment">// ç”±äºéœ€è¦å¯¹å¤šä¸ªå­—æ®µæ’åº, ä¸”æ¯ä¸ªå­—æ®µå®ç°çš„`Less`æ–¹æ³•ä¸åŒ, è¿™é‡Œå°†æ’åºæ–¹æ³•(å‡½æ•°)ä½œä¸ºæ•°æ®é›†ç±»å‹çš„ä¸€ä¸ªå­—æ®µ</span></span><br><span class="line"><span class="keyword">type</span> studentSorter <span class="keyword">struct</span> &#123;</span><br><span class="line">	students []student  <span class="comment">// å…·ä½“çš„æ•°æ®é›†, å¾…æ’åºçš„æ•°æ®éƒ½ä¼šå­˜æ”¾åœ¨è¿™é‡Œ</span></span><br><span class="line">	by <span class="function"><span class="keyword">func</span><span class="params">(i, j student)</span> <span class="title">bool</span>  // æ’åºå‡½æ•°, æ’åºçš„ä¾æ®, å…·ä½“æ’åºçš„ç­–ç•¥, ä¼šè¢«æ”¾ç½®åœ¨è¿™é‡Œ</span></span><br><span class="line">	<span class="comment">// å¯ä»¥æ˜æ˜¾çš„çœ‹å‡º, by å‡½æ•°çš„å…¥å‚ä¸è¿”å› ä¸ `Less` å‡½æ•°çš„å…¥å‚ä¸è¿”å›æ˜¯ä¸€è‡´çš„</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨æ•°æ®é›†ç±»å‹ä¹‹ä¸Šå®ç°æ’åºæ¥å£çš„Lenæ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s studentSorter)</span> <span class="title">Len</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">len</span>(s.students)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨æ•°æ®é›†ç±»å‹ä¹‹ä¸Šå®ç°äº¤æ¢å…ƒç´ çš„Swapæ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s studentSorter)</span> <span class="title">Swap</span><span class="params">(i, j <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">	s.students[i], s.students[j] = s.students[j], s.students[i]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨æ•°æ®é›†ç±»å‹ä¹‹ä¸Šå®ç°æ¯”è¾ƒå…ƒç´ å¤§å°çš„Lessæ–¹æ³•</span></span><br><span class="line"><span class="comment">// ç”±äºå¤šä¸ªå­—æ®µéœ€è¦æ’åº, è¿™é‡Œçš„è¿”å›å€¼, è¿”å›çš„æ˜¯ä¸€ä¸ªæ’åºå‡½æ•°</span></span><br><span class="line"><span class="comment">// ä¸Šé¢çš„æ•°æ®é›†ç»“æ„ä½“ä¸­, å·²ç»æ˜ç¡®å®šä¹‰äº†ä¸€ä¸ª by å­—æ®µ, è¯¥å­—æ®µç”¨æ¥ä¿å­˜å…·ä½“çš„æ’åºå‡½æ•°</span></span><br><span class="line"><span class="comment">// æ‰€ä»¥è¿™é‡Œçš„è¿”å›å€¼å¹¶æ²¡æœ‰ç›´æ¥æŒ‡å®šæ•°æ®çš„å¤§å°çš„æ¯”è¾ƒæ–¹æ³•, è€Œæ˜¯è°ƒç”¨äº†ä¿å­˜åœ¨æ•°æ®é›†byå­—æ®µä¸­çš„å‡½æ•°å»å¤„ç†</span></span><br><span class="line"><span class="comment">// å¯ä»¥ç®€å•çš„ç†è§£ä¸º, å°†æ¯”è¾ƒæ•°æ®å¤§å°çš„æ“ä½œå§”æ‰˜ç»™äº† æ•°æ®é›†ç±»å‹.by çš„å‡½æ•°, å…·ä½“çš„æ’åºç­–ç•¥ä¹Ÿå°±äº¤ç»™äº† by å¯¹åº”çš„å…·ä½“å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s studentSorter)</span> <span class="title">Less</span><span class="params">(i, j <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> s.by(s.students[i], s.students[j])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å£°æ˜å¹¶èµ‹å€¼æµ‹è¯•æ•°æ®é›†</span></span><br><span class="line"><span class="keyword">var</span> students = []student&#123;</span><br><span class="line">	&#123;<span class="string">"d"</span>, <span class="number">7</span>, <span class="number">28</span>&#125;,</span><br><span class="line">	&#123;<span class="string">"c"</span>, <span class="number">3</span>, <span class="number">40</span>&#125;,</span><br><span class="line">	&#123;<span class="string">"b"</span>, <span class="number">8</span>, <span class="number">35</span>&#125;,</span><br><span class="line">	&#123;<span class="string">"a"</span>, <span class="number">5</span>, <span class="number">30</span>&#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨å·¥å‚æ–¹æ³•å®šä¹‰æ’åºæ•°æ®é›†, å¹¶è¿›è¡Œæ’åº</span></span><br><span class="line"><span class="comment">// ä¸Šé¢çš„ students ä»…ä»…æ˜¯å®é™…çš„å¾…æ’åºæ•°æ®, ä»…ä»…æ˜¯æ•°æ®é›†å¯¹è±¡ä¸­çš„ studentSorter.students å­—æ®µçš„å€¼</span></span><br><span class="line"><span class="comment">// å·¥å‚æ–¹æ³•å°±æ˜¯ç”¨æ¥æ ¹æ®å®é™…çš„æ’åºç­–ç•¥, ä¸ºæ•°æ®é›†å¯¹è±¡ä¸­çš„byèµ‹å€¼, ç”Ÿæˆä¸€ä¸ªå®Œæ•´çš„æ•°æ®é›†, ä»è€Œå®Œæˆæ’åºæ“ä½œ</span></span><br><span class="line"><span class="keyword">type</span> By <span class="function"><span class="keyword">func</span><span class="params">(i, j student)</span> <span class="title">bool</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b By)</span> <span class="title">Sort</span> <span class="params">(students []student)</span></span> &#123;</span><br><span class="line">	<span class="comment">// ç”Ÿæˆæ•°æ®é›†</span></span><br><span class="line">	ss := studentSorter&#123;</span><br><span class="line">		students: students,</span><br><span class="line">		by:       b,</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// å¯¹æ•°æ®é›†è¿›è¡Œæ’åº</span></span><br><span class="line">	sort.Sort(ss)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é¢„å®šä¹‰æ’åºç­–ç•¥å‡½æ•°, è¿™äº›å‡½æ•°éƒ½å®ç°äº†sortæ¥å£ä¸­çš„lessæ–¹æ³•</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// é¢„å…ˆå®šä¹‰çš„æ’åºå‡½æ•°: æŒ‰ç…§å§“åæ’åº</span></span><br><span class="line"><span class="keyword">var</span> name = <span class="function"><span class="keyword">func</span><span class="params">(i, j student)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> i.name &lt; j.name</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é¢„å…ˆå®šä¹‰çš„æ’åºå‡½æ•°: æŒ‰ç…§å¹´é¾„æ’åº</span></span><br><span class="line"><span class="keyword">var</span> age = <span class="function"><span class="keyword">func</span><span class="params">(i, j student)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> i.age &lt; j.age</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é¢„å…ˆå®šä¹‰çš„æ’åºå‡½æ•°: æŒ‰ç…§ä½“é‡æ’åº</span></span><br><span class="line"><span class="keyword">var</span> weight = <span class="function"><span class="keyword">func</span><span class="params">(i, j student)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> i.weight &lt; j.weight</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	By(name).Sort(students)</span><br><span class="line">	fmt.Println(<span class="string">"By name:"</span>, students)</span><br><span class="line"></span><br><span class="line">	By(age).Sort(students)</span><br><span class="line">	fmt.Println(<span class="string">"By age:"</span>, students)</span><br><span class="line"></span><br><span class="line">	By(weight).Sort(students)</span><br><span class="line">	fmt.Println(<span class="string">"By weight:"</span>, students)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">By name: [&#123;a 5 30&#125; &#123;b 8 35&#125; &#123;c 3 40&#125; &#123;d 7 28&#125;]</span><br><span class="line">By age: [&#123;c 3 40&#125; &#123;a 5 30&#125; &#123;d 7 28&#125; &#123;b 8 35&#125;]</span><br><span class="line">By weight: [&#123;d 7 28&#125; &#123;a 5 30&#125; &#123;b 8 35&#125; &#123;c 3 40&#125;]</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå¤šå­—æ®µå•ç‹¬æ’åºçš„æ–¹æ³•, çœå»äº†éœ€è¦é‡å¤ç¼–å†™<code>Len()``Swap()</code>æ–¹æ³•çš„éº»çƒ¦, ä¹Ÿæ˜¯<code>sort</code>åŒ…å®˜æ–¹æ¨èçš„å¤šå­—æ®µæ’åºæ¡ˆä¾‹</p>
<h2 id="ç»“æ„ä½“å¤šå­—æ®µå•ç‹¬æ’åº2-æ¨è"><a href="#ç»“æ„ä½“å¤šå­—æ®µå•ç‹¬æ’åº2-æ¨è" class="headerlink" title="ç»“æ„ä½“å¤šå­—æ®µå•ç‹¬æ’åº2(æ¨è)"></a>ç»“æ„ä½“å¤šå­—æ®µå•ç‹¬æ’åº2(æ¨è)</h2><p>å®˜æ–¹æ–‡æ¡£ä¸­è¿˜ä»‹ç»äº†å¦ä¸€ç§æ’åºæ–¹å¼, é€šè¿‡Goè¯­è¨€ç‹¬ç‰¹çš„ç»„åˆç‰¹æ€§æ¥å®ç°sortæ¥å£çš„ä¸‰ä¸ªæ–¹æ³•</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"sort"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> student <span class="keyword">struct</span> &#123;</span><br><span class="line">	name   <span class="keyword">string</span></span><br><span class="line">	age <span class="keyword">int</span></span><br><span class="line">	weight <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> students []student</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s students)</span> <span class="title">Len</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">len</span>(s)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s students)</span> <span class="title">Swap</span><span class="params">(i, j <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">	s[i], s[j] = s[j], s[i]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> ByName <span class="keyword">struct</span> &#123;</span><br><span class="line">	students</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s ByName)</span> <span class="title">Less</span><span class="params">(i, j <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> s.students[i].name &lt; s.students[j].name</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> ByWeight <span class="keyword">struct</span> &#123;</span><br><span class="line">	students</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s ByWeight)</span> <span class="title">Less</span><span class="params">(i, j <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> s.students[i].weight &lt; s.students[j].weight</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ss = []student&#123;</span><br><span class="line">	&#123;<span class="string">"d"</span>, <span class="number">7</span>, <span class="number">28</span>&#125;,</span><br><span class="line">	&#123;<span class="string">"c"</span>, <span class="number">3</span>, <span class="number">40</span>&#125;,</span><br><span class="line">	&#123;<span class="string">"b"</span>, <span class="number">8</span>, <span class="number">35</span>&#125;,</span><br><span class="line">	&#123;<span class="string">"a"</span>, <span class="number">5</span>, <span class="number">30</span>&#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	sort.Sort(ByWeight&#123;ss&#125;)</span><br><span class="line">	fmt.Println(<span class="string">"Organs by weight: "</span>, ss)</span><br><span class="line"></span><br><span class="line">	sort.Sort(ByName&#123;ss&#125;)</span><br><span class="line">	fmt.Println(<span class="string">"Organs by name: "</span>, ss)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<hr>
<ul>
<li>å‚è€ƒæ–‡æ¡£: <a href="https://golang.org/pkg/sort" target="_blank" rel="noopener">https://golang.org/pkg/sort</a></li>
</ul>
]]></content>
      <categories>
        <category>Go</category>
      </categories>
      <tags>
        <tag>struct</tag>
        <tag>sort</tag>
      </tags>
  </entry>
  <entry>
    <title>goè¯­è¨€sortæ’åºåŸºæœ¬ç”¨æ³•</title>
    <url>/2019/02/08/go%E8%AF%AD%E8%A8%80sort%E6%8E%92%E5%BA%8F%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95/</url>
    <content><![CDATA[<blockquote>
<p>goè¯­è¨€ä¸­é¢„ç½®äº†<code>[]int</code> <code>[]float64</code> <code>[]String</code>ä¸‰ç§æ•°æ®ç±»å‹çš„æ’åºå‡½æ•°, å¦‚æœéœ€è¦å¯¹å…¶ä»–æ•°æ®ç±»å‹è¿›è¡Œæ’åº, éœ€è¦è‡ªå·±å®ç°<code>sort interface</code></p>
</blockquote>
<h2 id="å†…ç½®æ•°æ®ç±»å‹æ’åº"><a href="#å†…ç½®æ•°æ®ç±»å‹æ’åº" class="headerlink" title="å†…ç½®æ•°æ®ç±»å‹æ’åº"></a>å†…ç½®æ•°æ®ç±»å‹æ’åº</h2><h3 id="int-ç±»å‹æ’åº"><a href="#int-ç±»å‹æ’åº" class="headerlink" title="[]int ç±»å‹æ’åº"></a>[]int ç±»å‹æ’åº</h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"------------ Int Slice ------------"</span>)</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// å¾…æ’åºçš„æ•°æ®</span></span><br><span class="line">	is := []<span class="keyword">int</span>&#123;<span class="number">19</span>, <span class="number">26</span>, <span class="number">3</span>, <span class="number">78</span>, <span class="number">56</span>&#125;</span><br><span class="line">	fmt.Println(<span class="string">"æ’åºå‰çš„Int Slice"</span>, is)</span><br><span class="line">	fmt.Println(<span class="string">"Int Sliceæ˜¯å¦å·²ç»æŒ‰å‡åºæ’åº"</span>, sort.IntsAreSorted(is))</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// ä½¿ç”¨å†…ç½®çš„æ’åºå‡½æ•°è¿›è¡Œæ’åº</span></span><br><span class="line">	sort.Ints(is)</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// æ’åºå</span></span><br><span class="line">	fmt.Println(<span class="string">"æ’åºåçš„Int Slice"</span>, is)</span><br><span class="line">	fmt.Println(<span class="string">"Int Sliceæ˜¯å¦å·²ç»æŒ‰å‡åºæ’åº"</span>, sort.IntsAreSorted(is))</span><br><span class="line">	sort.Sort(sort.Reverse(sort.IntSlice(is)))</span><br><span class="line">	fmt.Println(<span class="string">"é€†åºæ’åˆ—(é™åº)åçš„Int Slice"</span>, is)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">------------ Int Slice ------------</span><br><span class="line">æ’åºå‰çš„Int Slice [19 26 3 78 56]</span><br><span class="line">Int Sliceæ˜¯å¦å·²ç»æŒ‰å‡åºæ’åº false</span><br><span class="line">æ’åºåçš„Int Slice [3 19 26 56 78]</span><br><span class="line">Int Sliceæ˜¯å¦å·²ç»æŒ‰å‡åºæ’åº true</span><br><span class="line">é€†åºæ’åˆ—(é™åº)åçš„Int Slice [78 56 26 19 3]</span><br></pre></td></tr></table></figure>

<h3 id="float64-ç±»å‹æ’åº"><a href="#float64-ç±»å‹æ’åº" class="headerlink" title="[]float64 ç±»å‹æ’åº"></a>[]float64 ç±»å‹æ’åº</h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"------------ Float64 Slice ------------"</span>)</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// å¾…æ’åºæ•°æ®</span></span><br><span class="line">	f64s := []<span class="keyword">float64</span>&#123;<span class="number">98.5</span>, <span class="number">53.2</span>, <span class="number">78.5</span>, <span class="number">12.78</span>&#125;</span><br><span class="line">	fmt.Println(<span class="string">"æ’åºå‰çš„Float64 Slice"</span>, f64s)</span><br><span class="line">	fmt.Println(<span class="string">"Float64 Sliceæ˜¯å¦å·²ç»æŒ‰å‡åºæ’åº"</span>, sort.Float64sAreSorted(f64s))</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// ä½¿ç”¨å†…ç½®çš„æ’åºå‡½æ•°è¿›è¡Œæ’åº</span></span><br><span class="line">	sort.Float64s(f64s)</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// æ’åºå</span></span><br><span class="line">	fmt.Println(<span class="string">"æ’åºåçš„Float64 Slice"</span>, f64s)</span><br><span class="line">	fmt.Println(<span class="string">"Float64 Sliceæ˜¯å¦å·²ç»æŒ‰å‡åºæ’åº"</span>, sort.Float64sAreSorted(f64s))</span><br><span class="line">	sort.Sort(sort.Reverse(sort.Float64Slice(f64s)))</span><br><span class="line">	fmt.Println(<span class="string">"é€†åºæ’åˆ—(é™åº)åçš„Float64 Slice"</span>, f64s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">------------ Float64 Slice ------------</span><br><span class="line">æ’åºå‰çš„Float64 Slice [98.5 53.2 78.5 12.78]</span><br><span class="line">Float64 Sliceæ˜¯å¦å·²ç»æŒ‰å‡åºæ’åº false</span><br><span class="line">æ’åºåçš„Float64 Slice [12.78 53.2 78.5 98.5]</span><br><span class="line">Float64 Sliceæ˜¯å¦å·²ç»æŒ‰å‡åºæ’åº true</span><br><span class="line">é€†åºæ’åˆ—(é™åº)åçš„Float64 Slice [98.5 78.5 53.2 12.78]</span><br></pre></td></tr></table></figure>

<h3 id="string-ç±»å‹æ’åº"><a href="#string-ç±»å‹æ’åº" class="headerlink" title="[]string ç±»å‹æ’åº"></a>[]string ç±»å‹æ’åº</h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"------------ String Slice ------------"</span>)</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// å¾…æ’åºæ•°æ®</span></span><br><span class="line">	ss := []<span class="keyword">string</span>&#123;<span class="string">"watermelon"</span>, <span class="string">"apple"</span>, <span class="string">"strawberry"</span>, <span class="string">"orange"</span>&#125;</span><br><span class="line">	fmt.Println(<span class="string">"æ’åºå‰çš„String Slice"</span>, ss)</span><br><span class="line">	fmt.Println(<span class="string">"String Sliceæ˜¯å¦å·²ç»æŒ‰å‡åºæ’åº"</span>, sort.StringsAreSorted(ss))</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// ä½¿ç”¨å†…ç½®çš„æ’åºå‡½æ•°è¿›è¡Œæ’åº</span></span><br><span class="line">	sort.Strings(ss)</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// æ’åºå</span></span><br><span class="line">	fmt.Println(<span class="string">"æ’åºåçš„String Slice"</span>, ss)</span><br><span class="line">	fmt.Println(<span class="string">"String Sliceæ˜¯å¦å·²ç»æŒ‰å‡åºæ’åº"</span>, sort.StringsAreSorted(ss))</span><br><span class="line">	sort.Sort(sort.Reverse(sort.StringSlice(ss)))</span><br><span class="line">	fmt.Println(<span class="string">"é€†åºæ’åˆ—(é™åº)åçš„String Slice"</span>, ss)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">------------ String Slice ------------</span><br><span class="line">æ’åºå‰çš„String Slice [watermelon apple strawberry orange]</span><br><span class="line">String Sliceæ˜¯å¦å·²ç»æŒ‰å‡åºæ’åº false</span><br><span class="line">æ’åºåçš„String Slice [apple orange strawberry watermelon]</span><br><span class="line">String Sliceæ˜¯å¦å·²ç»æŒ‰å‡åºæ’åº true</span><br><span class="line">é€†åºæ’åˆ—(é™åº)åçš„String Slice [watermelon strawberry orange apple]</span><br></pre></td></tr></table></figure>

<h2 id="å…¶ä»–æ•°æ®ç±»å‹æ’åº"><a href="#å…¶ä»–æ•°æ®ç±»å‹æ’åº" class="headerlink" title="å…¶ä»–æ•°æ®ç±»å‹æ’åº"></a>å…¶ä»–æ•°æ®ç±»å‹æ’åº</h2><p><code>int8</code> <code>int16</code> <code>int32</code> <code>int64</code> <code>float32</code> è™½ç„¶ä¹Ÿæ˜¯å¸¸ç”¨çš„æ•°æ®ç±»å‹, ä½†æ˜¯è¿™äº›æ•°æ®ç±»å‹éœ€è¦è‡ªå·±å®ç°æ’åºæ¥å£</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// A type, typically a collection, that satisfies sort.Interface can be</span></span><br><span class="line"><span class="comment">// sorted by the routines in this package. The methods require that the</span></span><br><span class="line"><span class="comment">// elements of the collection be enumerated by an integer index.</span></span><br><span class="line"><span class="keyword">type</span> Interface <span class="keyword">interface</span> &#123;</span><br><span class="line">	<span class="comment">// Len is the number of elements in the collection.</span></span><br><span class="line">	Len() <span class="keyword">int</span></span><br><span class="line">	<span class="comment">// Less reports whether the element with</span></span><br><span class="line">	<span class="comment">// index i should sort before the element with index j.</span></span><br><span class="line">	Less(i, j <span class="keyword">int</span>) <span class="keyword">bool</span></span><br><span class="line">	<span class="comment">// Swap swaps the elements with indexes i and j.</span></span><br><span class="line">	Swap(i, j <span class="keyword">int</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="int32-ç±»å‹æ’åº"><a href="#int32-ç±»å‹æ’åº" class="headerlink" title="[]int32 ç±»å‹æ’åº"></a>[]int32 ç±»å‹æ’åº</h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Int32Slice []<span class="keyword">int32</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s Int32Slice)</span> <span class="title">Len</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">len</span>(s)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s Int32Slice)</span> <span class="title">Swap</span><span class="params">(i, j <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">	s[i], s[j] = s[j], s[i]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s Int32Slice)</span> <span class="title">Less</span><span class="params">(i, j <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> s[i] &lt; s[j]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    i32s := Int32Slice&#123;<span class="number">19</span>, <span class="number">26</span>, <span class="number">3</span>, <span class="number">78</span>, <span class="number">56</span>&#125;</span><br><span class="line">	sort.Sort(i32s)</span><br><span class="line">	fmt.Println(i32s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[3 19 26 56 78]</span><br></pre></td></tr></table></figure>

<h3 id="float32-ç±»å‹æ’åº"><a href="#float32-ç±»å‹æ’åº" class="headerlink" title="[]float32 ç±»å‹æ’åº"></a>[]float32 ç±»å‹æ’åº</h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Float32Slice []<span class="keyword">float32</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s Float32Slice)</span> <span class="title">Len</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">len</span>(s)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s Float32Slice)</span> <span class="title">Swap</span><span class="params">(i, j <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">	s[i], s[j] = s[j], s[i]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s Float32Slice)</span> <span class="title">Less</span><span class="params">(i, j <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> s[i] &lt; s[j]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    f32s := Float32Slice&#123;<span class="number">98.5</span>, <span class="number">53.2</span>, <span class="number">78.5</span>, <span class="number">12.78</span>&#125;</span><br><span class="line">	sort.Sort(f32s)</span><br><span class="line">	fmt.Println(f32s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[12.78 53.2 78.5 98.5]</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Go</category>
      </categories>
      <tags>
        <tag>sort</tag>
      </tags>
  </entry>
  <entry>
    <title>ginæ·»åŠ è‡ªå®šä¹‰ä¸­é—´ä»¶</title>
    <url>/2019/01/27/gin%E6%B7%BB%E5%8A%A0%E8%87%AA%E5%AE%9A%E4%B9%89%E4%B8%AD%E9%97%B4%E4%BB%B6/</url>
    <content><![CDATA[<h2 id="ä¸­é—´ä»¶çš„ä½œç”¨"><a href="#ä¸­é—´ä»¶çš„ä½œç”¨" class="headerlink" title="ä¸­é—´ä»¶çš„ä½œç”¨"></a>ä¸­é—´ä»¶çš„ä½œç”¨</h2><p>åœ¨æˆ‘ä»¬ç†Ÿæ‚‰çš„ä¸€ä¸ªå®Œæ•´çš„<code>http</code>è¯·æ±‚ä¸­, å®¢æˆ·ç«¯å…ˆå‘æœåŠ¡ç«¯å‘é€çš„<code>http request</code>, æœåŠ¡ç«¯æ¥æ”¶åˆ°<code>request</code>ä¹‹å, æ ¹æ®å®é™…éœ€è¦, ç»™å®¢æˆ·ç«¯è¿”å›<code>http response</code></p>
<p>ç«™åœ¨æœåŠ¡ç«¯çš„è§’åº¦æ¥çœ‹, å°±æ˜¯æ¥æ”¶<code>request</code>, å“åº”<code>response</code>, è€Œä¸­é—´ä»¶çš„ä½œç”¨, å°±åœ¨<code>request</code>ä¸<code>response</code>ä¹‹é—´</p>
<ul>
<li>æ”¶åˆ°<code>request</code>ä¹‹å, åœ¨<code>request</code>è¿˜æœªåˆ°è¾¾å¤„ç†çš„<code>handler</code>ä¹‹å‰, å¯ä»¥é€šè¿‡ä¸­é—´ä»¶åšå‡ºä¸€ç³»åˆ—çš„æ•°æ®å¤„ç†, å¯ä»¥çœ‹åšæ˜¯å‰ç½®æ ¡éªŒæˆ–è¿‡æ»¤</li>
<li><code>request</code>åˆ°è¾¾<code>handler</code>ä¹‹å, ä¸­é—´ä»¶è¿˜å¯ä»¥æ ¹æ®éœ€è¦å¯¹å“åº”ä½“åšç»Ÿä¸€çš„æ•°æ®å¤„ç†</li>
</ul>
<p><strong>ginå†…ç½®çš„ä¸­é—´ä»¶</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">func BasicAuth(accounts Accounts) HandlerFunc</span><br><span class="line">func BasicAuthForRealm(accounts Accounts, realm string) HandlerFunc</span><br><span class="line">func Bind(val interface&#123;&#125;) HandlerFunc </span><br><span class="line">func ErrorLogger() HandlerFunc </span><br><span class="line">func ErrorLoggerT(typ ErrorType) HandlerFunc</span><br><span class="line">func Logger() HandlerFunc</span><br><span class="line">func LoggerWithConfig(conf LoggerConfig) HandlerFunc</span><br><span class="line">func LoggerWithFormatter(f LogFormatter) HandlerFunc</span><br><span class="line">func LoggerWithWriter(out io.Writer, notlogged ...string) HandlerFunc</span><br><span class="line">func Recovery() HandlerFunc</span><br><span class="line">func RecoveryWithWriter(out io.Writer) HandlerFunc</span><br><span class="line">func WrapF(f http.HandlerFunc) HandlerFunc </span><br><span class="line">func WrapH(h http.Handler) HandlerFunc</span><br></pre></td></tr></table></figure>

<h2 id="ä¸­é—´ä»¶çš„ä½œç”¨åŸŸ"><a href="#ä¸­é—´ä»¶çš„ä½œç”¨åŸŸ" class="headerlink" title="ä¸­é—´ä»¶çš„ä½œç”¨åŸŸ"></a>ä¸­é—´ä»¶çš„ä½œç”¨åŸŸ</h2><figure class="highlight go"><table><tr><td class="code"><pre><span class="line">r := gin.Default()  <span class="comment">//é»˜è®¤å¸¦Logger(), Recovery()è¿™ä¸¤ä¸ªå†…ç½®ä¸­é—´ä»¶</span></span><br><span class="line">r := gin.New()      <span class="comment">//ä¸å¸¦ä»»ä½•ä¸­é—´ä»¶</span></span><br></pre></td></tr></table></figure>

<h3 id="å…¨å±€ä½œç”¨åŸŸ"><a href="#å…¨å±€ä½œç”¨åŸŸ" class="headerlink" title="å…¨å±€ä½œç”¨åŸŸ"></a>å…¨å±€ä½œç”¨åŸŸ</h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line">r := gin.New()  <span class="comment">//ä¸å¸¦ä»»ä½•ä¸­é—´ä»¶</span></span><br><span class="line">r.Use(gin.Recovery()) <span class="comment">//åœ¨å…¨å±€ä½¿ç”¨å†…ç½®ä¸­é—´ä»¶</span></span><br></pre></td></tr></table></figure>

<h3 id="ç»„ä½œç”¨åŸŸ"><a href="#ç»„ä½œç”¨åŸŸ" class="headerlink" title="ç»„ä½œç”¨åŸŸ"></a>ç»„ä½œç”¨åŸŸ</h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line">r := gin.New()</span><br><span class="line">vm := r.Group(<span class="string">"vm"</span>, gin.Logger(),gin.Recovery())</span><br><span class="line">&#123;</span><br><span class="line">    vm.GET(<span class="string">"cpu"</span>, <span class="function"><span class="keyword">func</span><span class="params">(context *gin.Context)</span></span> &#123;&#125;)</span><br><span class="line">    vm.GET(<span class="string">"ram"</span>, <span class="function"><span class="keyword">func</span><span class="params">(context *gin.Context)</span></span> &#123;&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å•ä¸ªè·¯ç”±ä½œç”¨åŸŸ"><a href="#å•ä¸ªè·¯ç”±ä½œç”¨åŸŸ" class="headerlink" title="å•ä¸ªè·¯ç”±ä½œç”¨åŸŸ"></a>å•ä¸ªè·¯ç”±ä½œç”¨åŸŸ</h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line">r := gin.New()</span><br><span class="line">router.GET(<span class="string">"/healthcheck"</span>,gin.Recovery(),gin.Logger(),<span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span>&#123;</span><br><span class="line">    c.JSON(<span class="number">200</span>,<span class="string">"ok"</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="è‡ªå®šä¹‰ä¸­é—´ä»¶"><a href="#è‡ªå®šä¹‰ä¸­é—´ä»¶" class="headerlink" title="è‡ªå®šä¹‰ä¸­é—´ä»¶"></a>è‡ªå®šä¹‰ä¸­é—´ä»¶</h2><ul>
<li>ç¬¬ä¸€ç§å½¢å¼</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å®šä¹‰ä¸­é—´ä»¶</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">middleware1</span><span class="params">(c *gin.Context)</span></span>&#123;</span><br><span class="line">    <span class="comment">//ä¸­é—´ä»¶é€»è¾‘ </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å¼•ç”¨ä¸­é—´ä»¶</span></span><br><span class="line">r := gin.Default()</span><br><span class="line">r.Use(middleware1)</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„: <code>r.Use()</code>ä¸­çš„ä¸­é—´ä»¶å‡½æ•°æ²¡æœ‰<code>()</code></p>
<ul>
<li>ç¬¬äºŒç§å½¢å¼</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">middleware2</span><span class="params">()</span> <span class="title">gin</span>.<span class="title">HandlerFunc</span></span> &#123;</span><br><span class="line">    <span class="comment">//è‡ªå®šä¹‰é€»è¾‘</span></span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">        <span class="comment">//ä¸­é—´ä»¶é€»è¾‘</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å¼•ç”¨ä¸­é—´ä»¶</span></span><br><span class="line">r := gin.Default()</span><br><span class="line">r.Use(middleware2())</span><br></pre></td></tr></table></figure>

<h3 id="æ•°æ®ä¼ é€’"><a href="#æ•°æ®ä¼ é€’" class="headerlink" title="æ•°æ®ä¼ é€’"></a>æ•°æ®ä¼ é€’</h3><p><code>gin.Context</code>ä¸­æä¾›äº†<code>Set``Get</code>å‡½æ•°ç”¨æ¥å­˜å‚¨å’Œæå–æ•°æ®</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ä¸­é—´ä»¶setæ•°æ®</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">middleware2</span><span class="params">()</span> <span class="title">gin</span>.<span class="title">HandlerFunc</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		c.Set(<span class="string">"name"</span>, c.Request.Header.Get(<span class="string">"name"</span>))</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">//handlerä¸­getæ•°æ®</span></span><br><span class="line">r.GET(<span class="string">"/"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		c.JSON(<span class="number">200</span>, gin.H&#123;</span><br><span class="line">			<span class="string">"name"</span>: c.Get(<span class="string">"name"</span>),</span><br><span class="line">			<span class="string">"message"</span>: <span class="string">"ok"</span>,</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;)</span><br></pre></td></tr></table></figure>

<p><code>Set</code>æ–¹æ³•å­˜å‚¨çš„å€¼ä¸º<code>interface{}</code>ç±»å‹, <code>Get</code>æ–¹æ³•ä¸­æä¾›ä»¥ä¸‹å¸¸ç”¨çš„æ•°æ®ç±»å‹æ–¹ä¾¿æå–æ•°æ®</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">func (c *Context) GetBool(key string) (b bool)</span><br><span class="line">func (c *Context) GetDuration(key string) (d time.Duration)</span><br><span class="line">func (c *Context) GetFloat64(key string) (f64 float64)</span><br><span class="line">func (c *Context) GetInt(key string) (i int)</span><br><span class="line">func (c *Context) GetInt64(key string) (i64 int64)</span><br><span class="line">func (c *Context) GetString(key string) (s string)</span><br><span class="line">func (c *Context) GetStringMap(key string) (sm map[string]interface&#123;&#125;)</span><br><span class="line">func (c *Context) GetStringMapString(key string) (sms map[string]string)</span><br><span class="line">func (c *Context) GetStringMapStringSlice(key string) (smss map[string][]string)</span><br><span class="line">func (c *Context) GetStringSlice(key string) (ss []string)</span><br><span class="line">func (c *Context) GetTime(key string) (t time.Time)</span><br></pre></td></tr></table></figure>

<h3 id="æ‹¦æˆªrequestè¯·æ±‚"><a href="#æ‹¦æˆªrequestè¯·æ±‚" class="headerlink" title="æ‹¦æˆªrequestè¯·æ±‚"></a>æ‹¦æˆªrequestè¯·æ±‚</h3><ul>
<li>ä¸º<code>request</code>è¯·æ±‚æ·»åŠ <code>header</code></li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ä¸­é—´ä»¶</span></span><br><span class="line"><span class="comment">//åœ¨è¯·æ±‚åˆ°è¾¾`handler`ä¹‹å‰, ä¸º`request`è¯·æ±‚æ·»åŠ `header`</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">middleware1</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">	c.Request.Header.Set(<span class="string">"abc"</span>, <span class="string">"123"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">//handler</span></span><br><span class="line">r.GET(<span class="string">"/"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">        <span class="comment">//è·å–è¯·æ±‚å¤´</span></span><br><span class="line">		fmt.Println(c.Request.Header.Get(<span class="string">"abc"</span>))</span><br><span class="line">		c.JSON(<span class="number">200</span>, gin.H&#123;</span><br><span class="line">			<span class="string">"message"</span>: <span class="string">"ok"</span>,</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;)</span><br></pre></td></tr></table></figure>

<ul>
<li>ä¸º<code>response</code>å“åº”æ·»åŠ <code>header</code></li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">middleware2</span><span class="params">()</span> <span class="title">gin</span>.<span class="title">HandlerFunc</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">	   <span class="comment">//åœ¨æ¥æ”¶requestè¯·æ±‚æ—¶å°±è®¾ç½®å¥½responseæ—¶è¦æ·»åŠ çš„header</span></span><br><span class="line">		c.Header(<span class="string">"xyz"</span>, <span class="string">"789"</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="è¿½åŠ handlerå¤„ç†åçš„åŠ¨ä½œ"><a href="#è¿½åŠ handlerå¤„ç†åçš„åŠ¨ä½œ" class="headerlink" title="è¿½åŠ handlerå¤„ç†åçš„åŠ¨ä½œ"></a>è¿½åŠ handlerå¤„ç†åçš„åŠ¨ä½œ</h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"github.com/gin-gonic/gin"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">middleware2</span><span class="params">()</span> <span class="title">gin</span>.<span class="title">HandlerFunc</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		c.Next()</span><br><span class="line">		c.String(<span class="number">200</span>, <span class="string">"handler ok\n"</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	r := gin.Default()</span><br><span class="line">	</span><br><span class="line">	r.Use(middleware2())</span><br><span class="line"></span><br><span class="line">	r.GET(<span class="string">"/"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		c.String(<span class="number">200</span>, <span class="string">"handler ok\n"</span>)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> err := r.Run(<span class="string">":8080"</span>); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl http://127.0.0.1:8080/</span><br><span class="line">handler ok</span><br><span class="line">middleware ok</span><br></pre></td></tr></table></figure>

<h3 id="c-Next"><a href="#c-Next" class="headerlink" title="c.Next()"></a>c.Next()</h3><p><code>c.Next()</code>å‡½æ•°å…è®¸æˆ‘ä»¬åœ¨ä¸­é—´ä»¶ä¸­æ§åˆ¶è°ƒåº¦çš„é€»è¾‘, æ¯æ‰§è¡Œåˆ°<code>c.Next()</code>ä¸€æ¬¡, æ‰§è¡Œæƒå°±ä¼šåˆ«åˆ‡æ¢åˆ°å…¶ä»–ä¸­é—´ä»¶æˆ–<code>handler</code>å‡½æ•°ä¸­</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"github.com/gin-gonic/gin"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">middleware1</span><span class="params">()</span> <span class="title">gin</span>.<span class="title">HandlerFunc</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"start middleware1"</span>)</span><br><span class="line">		c.Next()</span><br><span class="line">		fmt.Println(<span class="string">"end middleware1"</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">middleware2</span><span class="params">()</span> <span class="title">gin</span>.<span class="title">HandlerFunc</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"start middleware2"</span>)</span><br><span class="line">		c.Next()</span><br><span class="line">		fmt.Println(<span class="string">"end middleware2"</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">middleware3</span><span class="params">()</span> <span class="title">gin</span>.<span class="title">HandlerFunc</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"start middleware3"</span>)</span><br><span class="line">		c.Next()</span><br><span class="line">		fmt.Println(<span class="string">"end middleware3"</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	r := gin.Default()</span><br><span class="line"></span><br><span class="line">	r.Use(middleware1(), middleware2(), middleware3())</span><br><span class="line"></span><br><span class="line">	r.GET(<span class="string">"/"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"start handler"</span>)</span><br><span class="line">		c.String(<span class="number">200</span>, <span class="string">"ok\n"</span>)</span><br><span class="line">		fmt.Println(<span class="string">"end handler"</span>)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> err := r.Run(<span class="string">":8080"</span>); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œ:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">go run main.go</span><br></pre></td></tr></table></figure>

<p>è®¿é—®:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl http://127.0.0.1:8080  <span class="comment"># è¿”å›ç»“æœ: ok</span></span><br></pre></td></tr></table></figure>

<p>ç¨‹åºæ—¥å¿—:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">start middleware1</span><br><span class="line">start middleware2</span><br><span class="line">start middleware3</span><br><span class="line">start handler</span><br><span class="line">end handler</span><br><span class="line">end middleware3</span><br><span class="line">end middleware2</span><br><span class="line">end middleware1</span><br></pre></td></tr></table></figure>

<p>ä¾æ®æ³¨å†Œä¸­é—´ä»¶çš„é¡ºåº, æ¯æ¬¡é‡åˆ°<code>c.Next()</code>å‡½æ•°å°±è·³è½¬åˆ°ä¸‹ä¸€ä¸ªä¸­é—´ä»¶æ‰§è¡Œ, ç›´åˆ°è·³è½¬åˆ°æœ€åä¸€ä¸ªä¸­é—´ä»¶, å†æ¬¡é‡åˆ°<code>c.Next()</code>çš„æ—¶å€™, å°±è·³åˆ°<code>handler</code>ä¸»å‡½æ•°ä¸­è¿è¡Œ, å½“<code>handler</code>æ‰§è¡Œå®Œæ¯•å, å†é€å±‚å‘ä¸Šè¿”å›, ç»§ç»­æ‰§è¡Œ<code>c.Next()</code>ä¹‹åçš„ä»£ç </p>
<h3 id="c-Abord"><a href="#c-Abord" class="headerlink" title="c.Abord()"></a>c.Abord()</h3><p><code>c.Abord()</code>ç”¨æ¥ç»ˆæ­¢<code>request</code>, é˜»æ­¢å…¶åˆ°è¾¾<code>handler</code> ä¸€èˆ¬æƒ…å†µä¸‹ç”¨åœ¨é‰´æƒä¸è®¤è¯çš„ä¸­é—´ä»¶ä¸­</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"github.com/gin-gonic/gin"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">middleware1</span><span class="params">()</span> <span class="title">gin</span>.<span class="title">HandlerFunc</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"start middleware1"</span>)</span><br><span class="line">		c.Next()</span><br><span class="line">		fmt.Println(<span class="string">"end middleware1"</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è·Ÿä¸Šé¢c.Next()çš„ä»£ç ç›¸æ¯”, åªæ˜¯middleware2ä¸­çš„Nextæ¢æˆäº†Abort</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">middleware2</span><span class="params">()</span> <span class="title">gin</span>.<span class="title">HandlerFunc</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"start middleware2"</span>)</span><br><span class="line">		c.Abort()</span><br><span class="line">		fmt.Println(<span class="string">"end middleware2"</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">middleware3</span><span class="params">()</span> <span class="title">gin</span>.<span class="title">HandlerFunc</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"start middleware3"</span>)</span><br><span class="line">		c.Next()</span><br><span class="line">		fmt.Println(<span class="string">"end middleware3"</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	r := gin.Default()</span><br><span class="line"></span><br><span class="line">	r.Use(middleware1(), middleware2(), middleware3())</span><br><span class="line"></span><br><span class="line">	r.GET(<span class="string">"/"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"start handler"</span>)</span><br><span class="line">		c.String(<span class="number">200</span>, <span class="string">"ok\n"</span>)</span><br><span class="line">		fmt.Println(<span class="string">"end handler"</span>)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> err := r.Run(<span class="string">":8080"</span>); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è®¿é—®å, ç¨‹åºæ—¥å¿—:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">start middleware1</span><br><span class="line">start middleware2</span><br><span class="line">end middleware2</span><br><span class="line">end middleware1</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°å³ä½¿åœ¨<code>middleware2</code>ä¸­æ‰§è¡Œäº†<code>c.Abord()</code>, <code>c.Abord()</code>åé¢çš„ä»£ç ä¾ç„¶è¢«å®Œæ•´çš„æ‰§è¡Œ, å¹¶ä¸”è¿”å›åˆ°äº†<code>middleware1</code>è·³è½¬çš„åœ°æ–¹, ç»§ç»­æ‰§è¡Œäº†åç»­ä»£ç </p>
]]></content>
      <categories>
        <category>Go</category>
      </categories>
      <tags>
        <tag>go</tag>
        <tag>gin</tag>
        <tag>middleware</tag>
      </tags>
  </entry>
  <entry>
    <title>goè¯­è¨€ä¸­çš„å¸¸é‡ä¸æšä¸¾</title>
    <url>/2018/12/26/go%E8%AF%AD%E8%A8%80%E4%B8%AD%E7%9A%84%E5%B8%B8%E9%87%8F%E4%B8%8E%E6%9E%9A%E4%B8%BE/</url>
    <content><![CDATA[<blockquote>
<p>goè¯­è¨€ä¸­ä½¿ç”¨å…³é”®å­—<code>const</code>æ¥å®šä¹‰å¸¸é‡. æœ€è¿‘åœ¨é¡¹ç›®å¼€å‘ä¸­, åœ¨ovirt-go sdkä¸­ç»å¸¸ä¼šç”¨åˆ°å…¶å†…ç½®å¸¸é‡, å–„ç”¨goçš„å¸¸é‡, ä¸ä»…å¯ä»¥å¢åŠ ä»£ç çš„å¯è¯»æ€§, è¿˜èƒ½çœå»ä¸€äº›â€å°éº»çƒ¦â€~</p>
</blockquote>
<h2 id="å¸¸é‡çš„å®šä¹‰"><a href="#å¸¸é‡çš„å®šä¹‰" class="headerlink" title="å¸¸é‡çš„å®šä¹‰"></a>å¸¸é‡çš„å®šä¹‰</h2><p>å¸¸é‡å¯ä»¥å•ä¸ªå®šä¹‰</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> HttpStatusOk = <span class="number">200</span></span><br><span class="line"><span class="keyword">const</span> HttpStatusNotFound = <span class="number">404</span></span><br></pre></td></tr></table></figure>

<p>ä¹Ÿå¯ä»¥æ‰¹é‡å®šä¹‰</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> (</span><br><span class="line">	VMStatusDown        = <span class="string">"down"</span></span><br><span class="line">	VMStatusUp          = <span class="string">"up"</span></span><br><span class="line">	VMStatusImageLocked = <span class="string">"image_locked"</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h2 id="å¸¸é‡çš„ä¼˜åŠ¿"><a href="#å¸¸é‡çš„ä¼˜åŠ¿" class="headerlink" title="å¸¸é‡çš„ä¼˜åŠ¿"></a>å¸¸é‡çš„ä¼˜åŠ¿</h2><p>goåœ¨ä»£ç ç¼–è¯‘å‰, å˜é‡çš„ç±»å‹å°±å·²ç»ç¡®å®š, å¹¶ä¸å¯æ›´æ”¹. ä½†æ˜¯å¸¸é‡å°±æ¯”è¾ƒç‰¹æ®Š, å¸¸é‡åœ¨ä»£ç ç¼–è¯‘çš„æ—¶å€™, ç±»å‹æ‰ä¼šç¡®å®šä¸‹æ¥, ä¸‹é¢æ¥ä¸¾ä¸ªä¾‹å­ğŸŒ°</p>
<ul>
<li>å˜é‡</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a <span class="keyword">int16</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> b <span class="keyword">int32</span></span><br><span class="line">	</span><br><span class="line">	a = <span class="number">1</span></span><br><span class="line">	b = <span class="number">2</span></span><br><span class="line"></span><br><span class="line">	fmt.Println(a + b)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœ:</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"># command-line-arguments</span><br><span class="line">./demo.<span class="keyword">go</span>:<span class="number">19</span>:<span class="number">16</span>: invalid operation: a + b (mismatched types <span class="keyword">int16</span> and <span class="keyword">int32</span>)</span><br></pre></td></tr></table></figure>

<p>å¾ˆæ˜¾ç„¶, ä»£ç åœ¨ç¼–è¯‘å‰, <code>a,b</code> ä¸¤ä¸ªå˜é‡çš„æ•°æ®ç±»å‹å·²ç»ç¡®å®š, ä¸¤ä¸ªä¸åŒçš„æ•°æ®ç±»å‹, æ˜¯ä¸äºˆè®¸è¿›è¡Œè¿ç®—æ“ä½œçš„.</p>
<ul>
<li>å¸¸é‡</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> a = <span class="number">1</span></span><br><span class="line"><span class="keyword">var</span> aa = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Printf(<span class="string">"type: %v\n"</span>, reflect.TypeOf(aa))</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">var</span> b <span class="keyword">float32</span></span><br><span class="line">	b = <span class="number">2.1</span></span><br><span class="line">	fmt.Println(a + b)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> c <span class="keyword">int32</span></span><br><span class="line">	c = <span class="number">3</span></span><br><span class="line">	fmt.Println(a + c)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œç»“æœ:</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span>: <span class="keyword">int</span></span><br><span class="line"><span class="number">3.1</span></span><br><span class="line"><span class="number">4</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœå…¶ä¸­ä¸€ä¸ªæ•°å­—æ˜¯å¸¸é‡çš„æƒ…å†µ, è¿è¡Œç»“æœå°±å¤§ä¸ç›¸åŒäº†, å¯ä»¥çœ‹åˆ°, è¯¥ç¨‹åºå¯ä»¥æ­£å¸¸æ‰§è¡Œ, è€Œä¸”æ‹¿åˆ°äº†æ­£ç¡®çš„ç»“æœ. è¿™æ˜¯å› ä¸º, è™½ç„¶<code>b</code>å˜é‡åœ¨ç¼–è¯‘å‰ç¡®å®šäº†æ•°æ®ç±»å‹, ä½†æ˜¯<code>a</code>å¸¸é‡å¹¶æ²¡æœ‰, <code>a</code>å¸¸é‡æ˜¯åœ¨ç¼–è¯‘æ—¶æ‰æ ¹æ®å®é™…æƒ…å†µç¡®å®šäº†æ•°æ®ç±»å‹, å¸¸é‡ä¼šæ ¹æ®ç¼–è¯‘æ—¶çš„è¿ç®—, è‡ªåŠ¨æ‰§è¡Œç±»å‹è½¬æ¢</p>
<p>ä¸Šé¢çš„ä¾‹å­ä¸­, å£°æ˜äº†<code>a</code>å¸¸é‡, åŒæ—¶å£°æ˜äº†<code>aa</code>å˜é‡, èµ‹å€¼å‡ä¸º<code>1</code>, é€šè¿‡ç¼–è¯‘æ‰§è¡Œ, å¾—åˆ°<code>aa</code>çš„æ•°æ®ç±»å‹è‡ªåŠ¨åˆ¤å®šä¸º<code>int</code>, è€Œ<code>a</code>å¸¸é‡å´å¯ä»¥å…ˆå’Œ<code>float32</code>ç±»å‹çš„<code>b</code>è¿ç®—, è€Œååˆå’Œ<code>int32</code>ç±»å‹çš„<code>c</code>è¿›è¡Œè¿ç®—. è¯´æ˜<code>a</code>å¸¸é‡çš„æ•°æ®ç±»å‹, æ˜¯åœ¨ç¼–è¯‘æ—¶, æ ¹æ®å®é™…çš„è¿ç®—éœ€è¦è€Œå˜åŒ–çš„</p>
<p>æ‰€ä»¥, é¡¹ç›®ä¸­çš„ä¸€äº›æ•°å­—å¯ä»¥å¤šå¤šå®šä¹‰ä¸ºå¸¸é‡, è¿™æ ·åœ¨è¿ç®—çš„æ—¶å€™, ä¹Ÿå¯ä»¥å‡å°‘æ˜¾å¼çš„æ•°æ®ç±»å‹è½¬æ¢</p>
<h2 id="æšä¸¾"><a href="#æšä¸¾" class="headerlink" title="æšä¸¾"></a>æšä¸¾</h2><p>go è¯­è¨€ä¸­æ²¡æœ‰ä¸“é—¨çš„æšä¸¾å…³é”®å­—, æ˜¯é€šè¿‡å¸¸é‡<code>const</code>å…³é”®å­—å®ç°çš„, æšä¸¾çš„æ ‡å¿—æ€§å…³é”®å­—ä¸º<code>iota</code>. </p>
<p><code>iota</code>å…³é”®å­—åœ¨<code>const</code>å…³é”®å­—å‡ºç°çš„æ—¶å€™, è¢«é‡ç½®ä¸º<code>0</code>, ä¸”<code>const</code>ä¸­æ¯æ–°å¢ä¸€è¡Œå¸¸é‡çš„å£°æ˜, <code>iota</code>è®¡æ•°å™¨å°†è¢«<code>+1</code></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">	a = <span class="literal">iota</span></span><br><span class="line">	b</span><br><span class="line">	c</span><br><span class="line">	d</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(a)</span><br><span class="line">	fmt.Println(b)</span><br><span class="line">	fmt.Println(c)</span><br><span class="line">	fmt.Println(d)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td></tr></table></figure>

<h3 id="åŒè¡Œå£°æ˜çš„æƒ…å†µ"><a href="#åŒè¡Œå£°æ˜çš„æƒ…å†µ" class="headerlink" title="åŒè¡Œå£°æ˜çš„æƒ…å†µ"></a>åŒè¡Œå£°æ˜çš„æƒ…å†µ</h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">	a, b = <span class="literal">iota</span>, <span class="literal">iota</span></span><br><span class="line">	c, d = <span class="literal">iota</span>, <span class="literal">iota</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(a)</span><br><span class="line">	fmt.Println(b)</span><br><span class="line">	fmt.Println(c)</span><br><span class="line">	fmt.Println(d)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0</span><br><span class="line">0</span><br><span class="line">1</span><br><span class="line">1</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„: <code>iota</code> ä»…ä¼šåœ¨æ–°å¢çš„å¸¸é‡å£°æ˜ä¸­æ‰ä¼šè‡ªå¢, å£°æ˜åœ¨åŒä¸€è¡Œçš„å¸¸é‡, <code>iota</code>çš„å€¼æ˜¯ç›¸åŒçš„</p>
<h3 id="è·¨è¡Œå£°æ˜çš„æƒ…å†µ"><a href="#è·¨è¡Œå£°æ˜çš„æƒ…å†µ" class="headerlink" title="è·¨è¡Œå£°æ˜çš„æƒ…å†µ"></a>è·¨è¡Œå£°æ˜çš„æƒ…å†µ</h3><ul>
<li>æƒ…å†µ1</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">	a = <span class="literal">iota</span></span><br><span class="line">	b = <span class="number">1024</span></span><br><span class="line">	c</span><br><span class="line">	d</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(a)</span><br><span class="line">	fmt.Println(b)</span><br><span class="line">	fmt.Println(c)</span><br><span class="line">	fmt.Println(d)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0</span><br><span class="line">1024</span><br><span class="line">1024</span><br><span class="line">1024</span><br></pre></td></tr></table></figure>

<p><code>const</code>æ‰¹é‡å£°æ˜çš„ç‰¹ç‚¹, å¦‚æœåé¢çš„å¸¸é‡æ²¡æœ‰æ˜¾å¼èµ‹å€¼, åˆ™å®ƒä»¬çš„å€¼ç­‰äºä¸Šä¸€ä¸ªæ˜¾å¼èµ‹å€¼çš„å€¼</p>
<ul>
<li>æƒ…å†µ2</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">	a = <span class="literal">iota</span></span><br><span class="line">	b = <span class="number">1024</span></span><br><span class="line">	c = <span class="literal">iota</span></span><br><span class="line">	d</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(a)</span><br><span class="line">	fmt.Println(b)</span><br><span class="line">	fmt.Println(c)</span><br><span class="line">	fmt.Println(d)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0</span><br><span class="line">1024</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td></tr></table></figure>

<p>ç”±äº<code>iota</code>çš„ç‰¹ç‚¹, æ¯æ–°å¢ä¸€è¡Œ<code>const</code>çš„å®šä¹‰, è®¡æ•°å™¨å°±ä¼šè‡ªå¢1, æ‰€ä»¥å³ä½¿ä¸­é—´æ˜¾å¼èµ‹å€¼äº†ä¸€äº›å¸¸é‡, ä¾ç„¶ä¸ä¼šå½±å“<code>iota</code>çš„è‡ªå¢</p>
<h3 id="æšä¸¾çš„åº”ç”¨"><a href="#æšä¸¾çš„åº”ç”¨" class="headerlink" title="æšä¸¾çš„åº”ç”¨"></a>æšä¸¾çš„åº”ç”¨</h3><h4 id="è‡ªå®šä¹‰è‡ªå¢å¤§å°"><a href="#è‡ªå®šä¹‰è‡ªå¢å¤§å°" class="headerlink" title="è‡ªå®šä¹‰è‡ªå¢å¤§å°"></a>è‡ªå®šä¹‰è‡ªå¢å¤§å°</h4><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">	_ = <span class="literal">iota</span>      <span class="comment">// 0</span></span><br><span class="line">	a = <span class="literal">iota</span> * <span class="number">2</span>  <span class="comment">// 1 * 2</span></span><br><span class="line">	b             <span class="comment">// 2 * 2</span></span><br><span class="line">	c             <span class="comment">// 3 * 2</span></span><br><span class="line">	d             <span class="comment">// 4 * 2</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(a)</span><br><span class="line">	fmt.Println(b)</span><br><span class="line">	fmt.Println(c)</span><br><span class="line">	fmt.Println(d)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">2</span><br><span class="line">4</span><br><span class="line">6</span><br><span class="line">8</span><br></pre></td></tr></table></figure>

<h4 id="æ•°æ®å•ä½è¿ç®—"><a href="#æ•°æ®å•ä½è¿ç®—" class="headerlink" title="æ•°æ®å•ä½è¿ç®—"></a>æ•°æ®å•ä½è¿ç®—</h4><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">	b = <span class="number">1</span> &lt;&lt; (<span class="number">10</span> * <span class="literal">iota</span>) <span class="comment">// 1 &lt;&lt; (10 * 0)</span></span><br><span class="line">	kb</span><br><span class="line">	mb</span><br><span class="line">	gb</span><br><span class="line">	tb</span><br><span class="line">	pb</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(b)</span><br><span class="line">	fmt.Println(kb)</span><br><span class="line">	fmt.Println(mb)</span><br><span class="line">	fmt.Println(gb)</span><br><span class="line">	fmt.Println(tb)</span><br><span class="line">	fmt.Println(pb)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1</span><br><span class="line">1024</span><br><span class="line">1048576</span><br><span class="line">1073741824</span><br><span class="line">1099511627776</span><br><span class="line">1125899906842624</span><br></pre></td></tr></table></figure>

<ul>
<li>b = 1 &lt;&lt; (10 * iota)</li>
</ul>
<p>ç¬¬ä¸€ä¸ªå¸¸é‡: iotaè¢«åˆå§‹åŒ–ä¸º0, åˆ™è¡¨è¾¾å¼ä¸º<code>1 &lt;&lt; (10 * 0)</code> â€“&gt; <code>1 &lt;&lt; 0</code>, 1 å‘å·¦ä½ç§»0ä½, è¿˜æ˜¯<code>1</code></p>
<ul>
<li>kb</li>
</ul>
<p>ç¬¬äºŒä¸ªå¸¸é‡: æ²¡æœ‰æ˜¾å¼èµ‹å€¼, è¯¥å€¼åº”è¯¥ç­‰äºä¸Šä¸€è¡Œæ˜¾å¼èµ‹å€¼çš„â€å€¼â€, ç”±äºä¸Šä¸€è¡Œæ˜¾å¼èµ‹å€¼çš„å€¼ä¸ºä¸€ä¸ªè¡¨è¾¾å¼, æ‰€ä»¥å°†è¯¥è¡¨è¾¾å¼å®Œæ•´çš„ç»§æ‰¿ä¸‹æ¥. ä¸”è¯¥è¡Œä¸ºæ–°å¢å¸¸é‡å£°æ˜, æ‰€ä»¥<code>iota</code>å˜é‡è‡ªå¢1, åˆ™èµ‹å€¼è¡¨è¾¾å¼å®é™…ä¸º: <code>1 &lt;&lt; (10 * 1)</code> â€“&gt; <code>1 &lt;&lt; 10</code>, 1 å‘å·¦ä½ç§» 10 ä½, äºŒè¿›åˆ¶è¡¨ç¤ºä¸º<code>10000000000</code>(2çš„10æ¬¡æ–¹), è½¬æ¢ä¸º10è¿›åˆ¶ä¸º<code>1024</code>, æ‰€ä»¥ kb ç»è¿‡è¡¨è¾¾å¼è¿ç®—å, å€¼ä¸º: <code>1024</code></p>
<ul>
<li>mb</li>
</ul>
<p>ç¬¬ä¸‰ä¸ªå¸¸é‡: åŒç†, iota è‡ªå¢ 1 å, èµ‹å€¼è¡¨è¾¾å¼å®é™…ä¸º: <code>1 &lt;&lt; (10 * 2)</code> â€”&gt; <code>1 &lt;&lt; 20</code>, 1 å‘å·¦ä½ç§» 20 ä½, äºŒè¿›åˆ¶è¡¨ç¤ºä¸º<code>100000000000000000000</code>(2çš„20æ¬¡æ–¹), è½¬æ¢ä¸º10è¿›åˆ¶ä¸º<code>1048576</code></p>
<ul>
<li>ä»¥æ­¤ç±»æ¨</li>
</ul>
]]></content>
      <categories>
        <category>Go</category>
      </categories>
      <tags>
        <tag>const</tag>
      </tags>
  </entry>
  <entry>
    <title>overlayfsä¸overlayfs2ä¸‹ç¼–è¯‘é•œåƒçš„åŒºåˆ«</title>
    <url>/2018/12/11/overlayfs%E4%B8%8Eoverlayfs2%E4%B8%8B%E7%BC%96%E8%AF%91%E9%95%9C%E5%83%8F%E7%9A%84%E5%8C%BA%E5%88%AB/</url>
    <content><![CDATA[<blockquote>
<p>è¿‘æœŸç¼–è¯‘é•œåƒæ—¶, å‡ºç°äº†é•œåƒä½“ç§¯éª¤å¢çš„æƒ…å†µ, æ’æŸ¥å, å‘ç°æœ¬è´¨åŸå› å±…ç„¶æ˜¯ç”±äºå‡çº§äº†å­˜å‚¨å¼•æ“å¯¼è‡´çš„é—®é¢˜, overlayfs ä¸ overlayfs2 å­˜å‚¨å¼•æ“å®ç°å¤šå±‚è”åˆæ–‡ä»¶ç³»ç»Ÿçš„åŸç†ä¸åŒ, æœ€ç»ˆå¯¼è‡´äº†æˆ‘ä»¬é‡åˆ°çš„è¿™ä¸ªé—®é¢˜</p>
</blockquote>
<h2 id="æ˜¨æ—¥é‡ç°"><a href="#æ˜¨æ—¥é‡ç°" class="headerlink" title="æ˜¨æ—¥é‡ç°"></a>æ˜¨æ—¥é‡ç°</h2><p>é•œåƒå¼•ç”¨å…³ç³»å›¾</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">centos:7.5</span><br><span class="line">   â†‘</span><br><span class="line">base-os (åˆ›å»ºäº†ä¸€ç³»åˆ—ç›®å½•, å®‰è£…äº†éƒ¨åˆ†å‘½ä»¤å·¥å…·)</span><br><span class="line">   â†‘</span><br><span class="line">open-jdk (ä¸‹è½½å¹¶éƒ¨ç½² jdk è‡³ &#x2F;opt&#x2F;soft ä¸‹, 335MB)</span><br><span class="line">   â†‘</span><br><span class="line">application (åº”ç”¨éƒ¨ç½², ä¸”æ‰§è¡Œäº† chown user:user &#x2F;opt)</span><br></pre></td></tr></table></figure>

<p>å¼•å‘é•œåƒä½“ç§¯å¢å¤§çš„åŸå› : åœ¨ open-jdk dockerfile ä¸­, å°† jdk æ–‡ä»¶æ‹·è´è‡³ <code>/opt/soft</code> ä¸‹, è¯¥æ–‡ä»¶å¤¹ä½“ç§¯ä¸º335MB; åœ¨ application dockerfile ä¸­, æ‰§è¡Œäº†ä¸€è¡Œ shell å‘½ä»¤ <code>chown -R /opt</code></p>
<p>ä»ç¼–è¯‘é•œåƒæœ€ä½³å®è·µæ¥è¯´, <code>chown -R /opt</code> è¿™æ ·çš„åŒ¹é…å‘½ä»¤æ˜¯ä¸åº”è¯¥å‡ºç°çš„, å…¶å®ä½“ç§¯å¢å¤§çš„é“ç†ä¹Ÿå¾ˆç®€å•, ç”±äºæ›´æ”¹äº†æ•´ä¸ª<code>/opt</code>ç›®å½•çš„å±æ€§, å¯¼è‡´<code>/opt</code>ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶è¢«é‡æ–°æ‹·è´åˆ° application é•œåƒå±‚ä¸­, ä¹Ÿå°±é€ æˆäº† 335MB ç©ºé—´çš„æµªè´¹, ä½“ç§¯è‡³å°‘ä¹Ÿæ— ç«¯å¢å¤§äº† 335MB. ä½†é—®é¢˜æ˜¯, ä¹‹å‰åœ¨ overlayfs å­˜å‚¨å¼•æ“ä¸‹ç¼–è¯‘é•œåƒ, å´ä¸€ç›´ç›¸å®‰æ— äº‹, æ‰€æœ‰é•œåƒç‰ˆæœ¬éƒ½è¿­ä»£äº†å¾ˆå¤šæ¬¡, æ²¡æœ‰å‡ºç°ä¸Šé¢é¢„æœŸçš„335MB çš„ç©ºé—´æµªè´¹. é€ æˆè¿™æ ·çš„é—®é¢˜, æ˜¯ç”±äº overlayfs å’Œ overlayfs2 åœ¨å®ç°å¤šå±‚è”åˆæ–‡ä»¶ç³»ç»Ÿçš„åŸç†ä¸åŒ.</p>
<h2 id="overlayfs-vs-overlayfs2"><a href="#overlayfs-vs-overlayfs2" class="headerlink" title="overlayfs vs overlayfs2"></a>overlayfs vs overlayfs2</h2><blockquote>
<p>overlayfså°†å•ä¸ªLinuxä¸»æœºä¸Šçš„ä¸¤ä¸ªç›®å½•åˆ†å±‚å¹¶å°†å®ƒä»¬å‘ˆç°ä¸ºå•ä¸ªç›®å½•. è¿™äº›ç›®å½•ç§°ä¸ºå›¾å±‚, ç»Ÿä¸€è¿‡ç¨‹ç§°ä¸ºè”åˆè£…è½½. overlayfså°†ä¸‹éƒ¨ç›®å½•ç§°ä¸ºlowerdirä¸Šéƒ¨ç›®å½•upperdir. ç»Ÿä¸€è§†å›¾é€šè¿‡è‡ªå·±çš„ç›®å½•å…¬å¼€merged.<br>è™½ç„¶overlayé©±åŠ¨ç¨‹åºåªèƒ½ä½¿ç”¨ä¸€ä¸ªè¾ƒä½çš„overlayfså±‚, å› æ­¤éœ€è¦ç¡¬é“¾æ¥æ¥å®ç°å¤šå±‚å›¾åƒ, ä½†è¯¥overlay2é©±åŠ¨ç¨‹åºæœ¬èº«æœ€å¤šæ”¯æŒ128ä¸ªè¾ƒä½çš„overlayfså±‚. æ­¤åŠŸèƒ½ä¸ºå’Œå±‚ç›¸å…³çš„Dockerå‘½ä»¤ï¼ˆå¦‚docker buildï¼‰æä¾›æ›´å¥½çš„æ€§èƒ½docker commitï¼Œå¹¶ä¸”åœ¨åå¤‡æ–‡ä»¶ç³»ç»Ÿä¸Šå ç”¨æ›´å°‘çš„inode    â€”-å¼•ç”¨è‡ª<a href="https://cloud.tencent.com/developer/section/1091813" target="_blank" rel="noopener">https://cloud.tencent.com/developer/section/1091813</a></p>
</blockquote>
<h2 id="é—®é¢˜åŸå› "><a href="#é—®é¢˜åŸå› " class="headerlink" title="é—®é¢˜åŸå› "></a>é—®é¢˜åŸå› </h2><p>ç®€å•æ¥è¯´, ä¹‹å‰åœ¨ application å±‚æ‰§è¡Œ <code>chown</code> ä¸€ä¸ª335MBæ–‡ä»¶å¤¹ä¹‹æ‰€æœ‰æ²¡æœ‰å¼•å‘ç©ºé—´æµªè´¹é—®é¢˜, å®Œå…¨æ˜¯ç”±äºä½¿ç”¨ overlayfs çš„ç¡¬é“¾æ¥ç‰¹æ€§é€ æˆçš„. </p>
<p>ä¹‹åæ”¹ä¸º overlayfs2 å­˜å‚¨å¼•æ“å, å±‚ä¸å±‚ä¹‹é—´ä¸å†ä½¿ç”¨ç¡¬é“¾æ¥å½¢å¼å¼•ç”¨, æ‰€ä»¥æ ¹æ®æ ‡å‡†æƒ…å†µä¸‹é•œåƒå±‚ä¹‹é—´çš„å¢åˆ æ”¹åŸç†æ¨æ–­, application é•œåƒå±‚è‡³å°‘æµªè´¹äº† 335MB çš„ç©ºé—´.(ç”±äº chown æ“ä½œå¯¼è‡´æ•´ä¸ª/optç›®å½•æ–‡ä»¶è¢«æ‹·è´è‡³ application å±‚)</p>
<p><code>chown</code> æ˜¯ä¸ªå¾ˆç¥å¥‡çš„å‘½ä»¤, å®ƒåªä¿®æ”¹æ–‡ä»¶çš„ metadata å±æ€§, è¿™å®Œç¾çš„åˆ‡ä¸­äº† overlayfs ä¸ overlayfs2 æœ€æœ¬è´¨çš„åŒºåˆ«.</p>
<h2 id="ç§‘æ™®ç¡¬é“¾æ¥"><a href="#ç§‘æ™®ç¡¬é“¾æ¥" class="headerlink" title="ç§‘æ™®ç¡¬é“¾æ¥"></a>ç§‘æ™®ç¡¬é“¾æ¥</h2><p>ç®€å•æ¥è¯´, ç¡¬é“¾æ¥æ˜¯æœ‰ç€ç›¸åŒ inode å·ä»…æ–‡ä»¶åä¸åŒçš„æ–‡ä»¶, å› æ­¤ç¡¬é“¾æ¥å­˜åœ¨ä»¥ä¸‹å‡ ç‚¹ç‰¹æ€§: </p>
<ul>
<li>æ–‡ä»¶æœ‰ç›¸åŒçš„ inode åŠ data block</li>
<li>åªèƒ½å¯¹å·²å­˜åœ¨çš„æ–‡ä»¶è¿›è¡Œåˆ›å»º</li>
<li>ä¸èƒ½äº¤å‰æ–‡ä»¶ç³»ç»Ÿè¿›è¡Œç¡¬é“¾æ¥çš„åˆ›å»º</li>
<li>ä¸èƒ½å¯¹ç›®å½•è¿›è¡Œåˆ›å»ºï¼Œåªå¯å¯¹æ–‡ä»¶åˆ›å»º</li>
<li>åˆ é™¤ä¸€ä¸ªç¡¬é“¾æ¥æ–‡ä»¶å¹¶ä¸å½±å“å…¶ä»–æœ‰ç›¸åŒ inode å·çš„æ–‡ä»¶</li>
</ul>
<p>ç”±äº overlayfs çš„ç¡¬é“¾æ¥å¼•ç”¨çš„åŸç†, chown åªæ›´æ”¹ metadata æ•°æ®, è€Œ metadata æ˜¯ä½œç”¨åœ¨ inode èŠ‚ç‚¹ä¸Šçš„, ä¸€ä¸ªç¡¬é“¾æ¥æ–‡ä»¶çš„å±æ€§è¢«ä¿®æ”¹, åŒæ­¥çš„, æ‰€æœ‰æŒ‡å‘è¿™ä¸ª inode èŠ‚ç‚¹çš„æ–‡ä»¶çš„å±æ€§éƒ½ä¼šå˜åŒ–. ä¹Ÿå°±æ˜¯è¯´, overlayfs é€šè¿‡ç¡¬é“¾æ¥å°†æ–‡ä»¶æŒ‚è½½åˆ°æ–°çš„é•œåƒå±‚ä¹‹å, å¯¹é‡Œé¢å·²å­˜åœ¨çš„æ–‡ä»¶åš chown æ“ä½œ, æ„å‘³ç€åº•å±‚(åªè¯»å±‚)çš„æ–‡ä»¶å±æ€§ä¹Ÿä¼šè¢«ä¿®æ”¹, docker å°±ä¼šè®¤ä¸ºè¿™ä¸ªæ“ä½œæ²¡æœ‰å¼•å‘ä»»ä½•æ–‡ä»¶çš„å˜åŒ–, æ‰€ä»¥å°±ä¸ä¼šå†æ‹·è´é‚£335MB çš„æ–‡ä»¶. è€Œ overlayfs2 çš„æ¯å±‚éƒ½æ˜¯ç‹¬ç«‹çš„, å³ä½¿æ–‡ä»¶å±æ€§çš„å˜åŒ–, ä¹Ÿä¼šå¯¼è‡´æ•´ä¸ªæ–‡ä»¶è¢«æ‹·è´, æ‰€ä»¥åœ¨ overlayfs2 ä¸‹, ä¼šäº§ç”Ÿ335MB çš„ç©ºé—´æµªè´¹</p>
<hr>
<p>å‚è€ƒæ–‡æ¡£:</p>
<ul>
<li><a href="https://cloud.tencent.com/developer/section/1091813" target="_blank" rel="noopener">https://cloud.tencent.com/developer/section/1091813</a></li>
<li><a href="https://www.ibm.com/developerworks/cn/linux/l-cn-hardandsymb-links/index.html" target="_blank" rel="noopener">https://www.ibm.com/developerworks/cn/linux/l-cn-hardandsymb-links/index.html</a></li>
</ul>
]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>image</tag>
        <tag>docker</tag>
        <tag>overlay</tag>
        <tag>overlay2</tag>
        <tag>overlayfs</tag>
        <tag>overlayfs2</tag>
        <tag>build</tag>
        <tag>é•œåƒç¼–è¯‘</tag>
        <tag>ç¡¬é“¾æ¥</tag>
      </tags>
  </entry>
  <entry>
    <title>è®°å½•K8s 1.10.x TLS Bootstrap Bugä¸€æš</title>
    <url>/2018/12/11/%E8%AE%B0%E5%BD%95K8s-1-10-x-TLS-Bootstrap-Bug%E4%B8%80%E6%9E%9A/</url>
    <content><![CDATA[<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">OS-Release: CentOS7</span><br><span class="line">kernel: 4.4-LTS</span><br><span class="line">kubernetes version: 1.10.9</span><br><span class="line">kubelet ä¸ kube-apiserver é€šä¿¡æ–¹å¼: TLS Bootstrap</span><br></pre></td></tr></table></figure>

<h2 id="é—®é¢˜å¤ç°"><a href="#é—®é¢˜å¤ç°" class="headerlink" title="é—®é¢˜å¤ç°"></a>é—®é¢˜å¤ç°</h2><p>é›†ç¾¤åŸºäº<code>Bear Token</code>æ–¹å¼çš„ TLS Bootstrap è¿›è¡Œé€šä¿¡, ä¸”ä½¿ç”¨ kubelet å®¢æˆ·ç«¯è¯ä¹¦è¿‡æœŸè½®æ¢çš„ç‰¹æ€§</p>
<p>æ ¹æ® 1.10.x ç‰ˆæœ¬çš„å®˜æ–¹æ–‡æ¡£ä»‹ç», é…ç½®ä½¿ç”¨æ­¤ç‰¹æ€§, è¿™é‡Œå…·ä½“åˆ—å‡º kubelet ä¸Šçš„ç›¸å…³é…ç½®</p>
<ul>
<li>åœ¨ kubelet çš„å¯åŠ¨å‚æ•°ä¸­ä¼ å…¥<code>--rotate-certificates</code> æ­¤å‚æ•°æ„ä¸ºå£°æ˜å¼€å¯è¯ä¹¦è½®æ¢æœºåˆ¶, ä¸ºå³å°†è¿‡æœŸçš„å®¢æˆ·ç«¯èŠ‚ç‚¹é¢å‘æ–°çš„è¯ä¹¦æ–‡ä»¶</li>
<li>åœ¨ kubelet å‚æ•°é…ç½®æ¨¡æ¿æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹é…ç½®, è¯¥é…ç½®é»˜è®¤å¼€å¯</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">featureGates:</span><br><span class="line">  RotateKubeletClientCertificate: true</span><br></pre></td></tr></table></figure>

<h3 id="åˆ›å»ºé›†ç¾¤è§’è‰²ç»‘å®š"><a href="#åˆ›å»ºé›†ç¾¤è§’è‰²ç»‘å®š" class="headerlink" title="åˆ›å»ºé›†ç¾¤è§’è‰²ç»‘å®š"></a>åˆ›å»ºé›†ç¾¤è§’è‰²ç»‘å®š</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">kubectl create clusterrolebinding kubelet-bootstrap \</span><br><span class="line"> --clusterrole=system:node-bootstrapper \</span><br><span class="line"> --group=system:bootstrappers</span><br></pre></td></tr></table></figure>

<h3 id="ä¸ºèŠ‚ç‚¹åˆ›å»º-Bootstrap-Token"><a href="#ä¸ºèŠ‚ç‚¹åˆ›å»º-Bootstrap-Token" class="headerlink" title="ä¸ºèŠ‚ç‚¹åˆ›å»º Bootstrap Token"></a>ä¸ºèŠ‚ç‚¹åˆ›å»º Bootstrap Token</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">TOKEN=`kubeadm token create \</span><br><span class="line">--description kubelet-bootstrap-token \</span><br><span class="line">--groups system:bootstrappers:node6752 \</span><br><span class="line">--kubeconfig ~/.kube/config`</span><br></pre></td></tr></table></figure>

<h3 id="ä¸ºèŠ‚ç‚¹åˆ›å»º-Bootstrap-kubeconfig"><a href="#ä¸ºèŠ‚ç‚¹åˆ›å»º-Bootstrap-kubeconfig" class="headerlink" title="ä¸ºèŠ‚ç‚¹åˆ›å»º Bootstrap kubeconfig"></a>ä¸ºèŠ‚ç‚¹åˆ›å»º Bootstrap kubeconfig</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">kubectl config <span class="built_in">set</span>-cluster kubernetes \</span><br><span class="line">--certificate-authority=/opt/soft/k8s/pki/ca/ca.crt \</span><br><span class="line">--embed-certs=<span class="literal">true</span> \</span><br><span class="line">--server=https://k8smaster:6443 \</span><br><span class="line">--kubeconfig=kubelet-bootstrap-node6752.kubeconfig</span><br><span class="line"></span><br><span class="line">kubectl config <span class="built_in">set</span>-credentials kubelet-bootstrap \</span><br><span class="line">--token=<span class="variable">$TOKEN</span> \</span><br><span class="line">--kubeconfig=kubelet-bootstrap-node6752.kubeconfig</span><br><span class="line"></span><br><span class="line">kubectl config <span class="built_in">set</span>-context default \</span><br><span class="line">--cluster=kubernetes \</span><br><span class="line">--user=kubelet-bootstrap \</span><br><span class="line">--kubeconfig=kubelet-bootstrap-node6752.kubeconfig</span><br><span class="line"></span><br><span class="line">kubectl config use-context default --kubeconfig=kubelet-bootstrap-node6752.kubeconfig</span><br></pre></td></tr></table></figure>

<p>å°†<code>kubelet-bootstrap-node6752.kubeconfig</code> Bootstrap kubeconfig æ–‡ä»¶åˆ†å‘ç»™ kubelet å®¢æˆ·ç«¯</p>
<h3 id="åœ¨kubeletå®¢æˆ·ç«¯æŒ‡å®šé…ç½®æ–‡ä»¶"><a href="#åœ¨kubeletå®¢æˆ·ç«¯æŒ‡å®šé…ç½®æ–‡ä»¶" class="headerlink" title="åœ¨kubeletå®¢æˆ·ç«¯æŒ‡å®šé…ç½®æ–‡ä»¶"></a>åœ¨kubeletå®¢æˆ·ç«¯æŒ‡å®šé…ç½®æ–‡ä»¶</h3><ul>
<li>â€“bootstrap-kubeconfig=â€/path/to/bootstrap/kubeconfigâ€</li>
<li>â€“kubeconfig=kubelet.kubeconfig</li>
</ul>
<p>æ³¨æ„: è¿™é‡ŒæŒ‡å®šçš„<code>--kubeconfig</code>æ–‡ä»¶å¹¶ä¸å­˜åœ¨, å½“ kubelet å®Œæˆè®¤è¯, æ‹¿åˆ°ä¸‹å‘çš„è¯ä¹¦å, è¯ä¹¦ä¼šå­˜æ”¾åˆ°<code>--cert-dir</code>æŒ‡å®šçš„æ–‡ä»¶å¤¹, ç„¶åæ ¹æ®å®é™…è¯ä¹¦æ¥åˆ›å»º kubeconfig æ–‡ä»¶å¹¶å†™å…¥åˆ°<code>--kubeconfig</code>æŒ‡å®šçš„è·¯å¾„</p>
<h2 id="å¤ç°é—®é¢˜"><a href="#å¤ç°é—®é¢˜" class="headerlink" title="å¤ç°é—®é¢˜"></a>å¤ç°é—®é¢˜</h2><p>åœ¨å¯åŠ¨ kubelet æœåŠ¡å, åœ¨ master ç«¯å¯ä»¥çœ‹åˆ° csr è¯·æ±‚, æ‰‹åŠ¨å®¡æ‰¹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">kubectl certificate approve node-csr-32YapU7hg6hB_87Hyus7NkD6a7-ew8sX2qP09ikjUh6</span><br></pre></td></tr></table></figure>

<p>å®¡æ‰¹å, åœ¨ kubelet å®¢æˆ·ç«¯æŒ‡å®šçš„è¯ä¹¦ç›®å½•ä¸‹, ä½ å¯ä»¥çœ‹åˆ°å¦‚ä¸‹æ–‡ä»¶:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">kubelet-client.crt (ç”± kube-controller-manager é¢å‘çš„å®¢æˆ·ç«¯è¯ä¹¦)</span><br><span class="line">kubelet-client.key (æœ¬åœ°è‡ªåŠ¨åˆ›å»ºçš„å®¢æˆ·ç«¯ç§˜é’¥)</span><br><span class="line">kubelet.crt (kubeletæœ¬åœ°è‡ªç­¾åæœåŠ¡ç«¯è¯ä¹¦)</span><br><span class="line">kubelet.key (æœ¬åœ°è‡ªåŠ¨åˆ›å»ºçš„æœåŠ¡ç«¯ç§˜é’¥)</span><br></pre></td></tr></table></figure>

<p>åœ¨ kubelet æŒ‡å®šçš„ <code>--kubeconfig</code> æ–‡ä»¶, ä¹Ÿè¢«å†™å…¥äº†å¯¹åº”çš„å†…å®¹, é—®é¢˜å°±å‡ºç°åœ¨äº†è¿™é‡Œ</p>
<p>å…¶ä¸­<code>users.user.client-certificate</code>å’Œ<code>users.user.client-key</code>çš„é…ç½®ä¸­, åˆ†åˆ«æŒ‡å®šäº†<code>kubelet-client.crt</code>å’Œ<code>kubelet-client.key</code></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">users:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">default-auth</span></span><br><span class="line">  <span class="attr">user:</span></span><br><span class="line">    <span class="attr">client-certificate:</span> <span class="string">/path/pki/kubelet-client.crt</span></span><br><span class="line">    <span class="attr">client-key:</span> <span class="string">/path/pki/kubelet-client.key</span></span><br></pre></td></tr></table></figure>

<p>ä½†é—®é¢˜æ˜¯, å½“<code>kubelet-client.crt</code>è¯ä¹¦è¿‡æœŸå, ç”± Kubernetes è¯ä¹¦è½®æ¢ç‰¹æ€§ç»­æœŸçš„æ–°è¯ä¹¦, å´æ˜¯ä»¥è½¯è¿æ¥çš„æ–¹å¼æä¾›çš„, è€Œä¸”, è½¯è¿æ¥çš„åå­—å’Œ<code>kubeconfig</code>ä¸­é…ç½®çš„è¯ä¹¦åå­—ä¸ä¸€è‡´. ä»¥ä¸‹æ˜¯ kube-controller-manager é¢å‘çš„æ–°è¯ä¹¦å½¢å¼</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">kubelet-client-2018-12-11-11-14-18.pem</span><br><span class="line">kubelet-client-current.pem -&gt; &#x2F;path&#x2F;pki&#x2F;kubelet-client-2018-12-11-11-14-18.pem</span><br></pre></td></tr></table></figure>

<ul>
<li>æ–°çš„è¯ä¹¦åªæœ‰ä¸€ä¸ªæ–‡ä»¶, æ ¼å¼ä¸º pem. è¯¥æ–‡ä»¶ä¸­æ—¢åŒ…å«äº†è¯ä¹¦å†…å®¹ä¹ŸåŒ…å«äº† key çš„å†…å®¹</li>
<li>æ–°è¯ä¹¦çš„å®é™…æ–‡ä»¶åä¸º: <code>kubelet-client-DATE.pem</code></li>
<li>æ–°è¯ä¹¦çš„è½¯è¿æ¥ä¸º: <code>kubelet-client-current.pem</code></li>
</ul>
<p>å¯ä»¥çœ‹å‡º, å½“è¯ä¹¦ç»­æœŸä¹‹å, æ–°è¯ä¹¦çš„å¼•ç”¨è·¯å¾„(æ–‡ä»¶å)ä¸æœ€å¼€å§‹è‡ªåŠ¨åˆ›å»ºçš„ kubeconfig æ–‡ä»¶ä¸­æŒ‡å®šçš„è¯ä¹¦æ–‡ä»¶ä¸ä¸€è‡´. è¿™ä¸ªé—®é¢˜å°†å¯¼è‡´åŸæœ‰è¯ä¹¦è¿‡æœŸä¸” kubelet é‡å¯å, å°†æ— æ³•å†ä¸ apiserver é€šä¿¡, apiserver ç«¯ä¹Ÿå°†æ ‡è®°è¯¥èŠ‚ç‚¹ä¸º<code>NotReady</code></p>
<h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><h3 id="è§£å†³æ–¹æ¡ˆ1-æ‰‹åŠ¨ä¿®æ”¹-kubeconfig-æ–‡ä»¶"><a href="#è§£å†³æ–¹æ¡ˆ1-æ‰‹åŠ¨ä¿®æ”¹-kubeconfig-æ–‡ä»¶" class="headerlink" title="è§£å†³æ–¹æ¡ˆ1: æ‰‹åŠ¨ä¿®æ”¹ kubeconfig æ–‡ä»¶"></a>è§£å†³æ–¹æ¡ˆ1: æ‰‹åŠ¨ä¿®æ”¹ kubeconfig æ–‡ä»¶</h3><p>æ‰§è¡Œä»¥ä¸‹æ“ä½œ:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cat kubelet-client.crt kubelet.key &gt; kubelet-origin.pem</span><br><span class="line">ln -s kubelet-origin.pem /path/to/pki/kubelet-client-current.pem</span><br><span class="line">sed -i <span class="string">'s/kubelet-client.crt/kubelet-client-current.pem/g'</span> /path/to/kubelet.kubeconfig</span><br><span class="line">sed -i <span class="string">'s/kubelet-client.key/kubelet-client-current.pem/g'</span> /path/to/kubelet.kubeconfig</span><br><span class="line">systemctl restart kubelet</span><br></pre></td></tr></table></figure>

<p>åŸç†å°±æ˜¯åœ¨è¯ä¹¦ç»­æœŸä¹‹å‰å°±æ‰‹åŠ¨æ„é€ è¯ä¹¦ç»­æœŸä¹‹åçš„ç»“æ„, è¿™æ ·åœ¨è¯ä¹¦ç»­æœŸå, å°±å¯ä»¥æ— ç¼ä½¿ç”¨æ–°è¯ä¹¦äº†</p>
<h3 id="è§£å†³æ–¹æ¡ˆ2-å‡çº§é›†ç¾¤ç‰ˆæœ¬"><a href="#è§£å†³æ–¹æ¡ˆ2-å‡çº§é›†ç¾¤ç‰ˆæœ¬" class="headerlink" title="è§£å†³æ–¹æ¡ˆ2: å‡çº§é›†ç¾¤ç‰ˆæœ¬"></a>è§£å†³æ–¹æ¡ˆ2: å‡çº§é›†ç¾¤ç‰ˆæœ¬</h3><p>é€šè¿‡æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£, åœ¨<code>1.11.0</code>ç‰ˆæœ¬ä¸­, è¯¥é—®é¢˜å¾—åˆ°äº†ä¿®å¤, ä½ ä¹Ÿå¯ä»¥é€šè¿‡å‡çº§é›†ç¾¤ç‰ˆæœ¬æ¥è§£å†³è¿™ä¸ªé—®é¢˜</p>
<p>æ³¨æ„, é›†ç¾¤å‡çº§å, åŸæœ‰çš„è¯ä¹¦éƒ½è¿˜æ˜¯ç»§ç»­ä½¿ç”¨çš„, æ‰€ä»¥å‡çº§å¹¶è§£å†³ä¸äº†åŸæ¥çš„é—®é¢˜, é™¤éä½ å°†èŠ‚ç‚¹åˆ é™¤å, é‡æ–°ä½¿ç”¨ BearToken çš„æ–¹å¼é‡æ–°ç”³è¯·åŠ å…¥é›†ç¾¤</p>
<hr>
<p>å‚è€ƒæ–‡æ¡£:</p>
<ul>
<li>1.13ç‰ˆæœ¬ TLS Bootstrap å®˜æ–¹æ–‡æ¡£: <a href="https://kubernetes.io/docs/reference/command-line-tools-reference/kubelet-tls-bootstrapping/" target="_blank" rel="noopener">https://kubernetes.io/docs/reference/command-line-tools-reference/kubelet-tls-bootstrapping/</a></li>
<li>1.10ç‰ˆæœ¬ TLS Bootstrap å®˜æ–¹æ–‡æ¡£: <a href="https://github.com/kubernetes/website/blob/release-1.10/content/en/docs/reference/command-line-tools-reference/kubelet-tls-bootstrapping.md" target="_blank" rel="noopener">https://github.com/kubernetes/website/blob/release-1.10/content/en/docs/reference/command-line-tools-reference/kubelet-tls-bootstrapping.md</a></li>
<li>1.11ç‰ˆæœ¬Changelog: <a href="https://github.com/kubernetes/kubernetes/blob/8c0542dcf126222481390cd0606e3b7f43830a64/CHANGELOG-1.11.md" target="_blank" rel="noopener">https://github.com/kubernetes/kubernetes/blob/8c0542dcf126222481390cd0606e3b7f43830a64/CHANGELOG-1.11.md</a></li>
<li>ä¿®å¤è¯¥ BUG çš„ PR: <a href="https://github.com/kubernetes/kubernetes/pull/62152" target="_blank" rel="noopener">https://github.com/kubernetes/kubernetes/pull/62152</a></li>
</ul>
]]></content>
      <categories>
        <category>Kubernetes</category>
      </categories>
      <tags>
        <tag>Kubernetes</tag>
        <tag>kubelet</tag>
        <tag>k8s</tag>
        <tag>TLS Bootstrap</tag>
        <tag>Token</tag>
      </tags>
  </entry>
  <entry>
    <title>systemd-journaldçš„SIGPIPEä¿¡å·BUG</title>
    <url>/2018/11/22/systemd-journald%E7%9A%84SIGPIPE%E4%BF%A1%E5%8F%B7BUG/</url>
    <content><![CDATA[<blockquote>
<p>åœ¨é‡å¯<code>systemd-journald</code>å, æ„å¤–çš„å‘ç°, æœ¬å°æœåŠ¡å™¨ä¸Šçš„å…¶ä»–ç”± systemd æ‰˜ç®¡çš„éƒ¨åˆ†æœåŠ¡, å´æ„å¤–è¢« stop æ‰äº†, ç”±äºå¤§éƒ¨åˆ†æœåŠ¡çš„ unit æ–‡ä»¶ä¸­éƒ½é…ç½®äº† Restart è§„åˆ™ä¸º on-failure. æ‰€ä»¥å¦‚æœæ˜¯å¼‚å¸¸çš„é€€å‡º, è¿™äº›æœåŠ¡åº”è¯¥ä¼šé‡å¯æ‰å¯¹. å¾ˆæ˜æ˜¾, è¿™äº›æœåŠ¡æ˜¯è¢«â€æ­£å¸¸â€å…³é—­çš„.</p>
</blockquote>
<p>åœ¨æŸ¥çœ‹è¢« stop çš„åº”ç”¨çŠ¶æ€æ—¶, å‘ç°äº†ä»¥ä¸‹çº¿ç´¢</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo systemctl status kube-apiserver</span><br><span class="line">......</span><br><span class="line">Active: inactive (dead) since Thu 2018-11-22 13:53:46 CST; 25min ago</span><br><span class="line">Main PID: 90457 (code=killed, signal=PIPE)</span><br><span class="line">......</span><br></pre></td></tr></table></figure>

<p><code>code=killed, signal=PIPE</code> è¿™äº›ä¿¡æ¯å‘Šè¯‰æˆ‘ä»¬, è¿™ä¸ªè¿›ç¨‹æ˜¯è¢«<code>SIGPIPE</code>ä¿¡å·å…³é—­çš„. åœ¨ç½‘ä¸ŠæŸ¥é˜…èµ„æ–™æ—¶, å‘ç° github ä¸­å¤§é‡çš„é¡¹ç›® issue ä¸‹éƒ½æœ‰ç›¸å…³çš„é—®é¢˜. è€Œé—®é¢˜çš„çŸ›å¤´éƒ½æŒ‡å‘äº†<code>systemd-journald</code>è¿™ä¸ªæœåŠ¡çš„é‡å¯äº‹ä»¶!</p>
<p>é—®é¢˜çš„åŸå› åœ¨äº: <code>systemd-journald</code>è¿™ä¸ªæœåŠ¡é‡å¯çš„æ—¶å€™, ä¼šç»™æ‰€æœ‰çš„è¿›ç¨‹å‘é€<code>SIGPIPE</code>ä¿¡å·, è€Œåœ¨é»˜è®¤çš„ systemd å®šä¹‰ä¸­, <code>SIGPIPE</code> ä¿¡å·å±äºæ­£å¸¸é€€å‡ºçš„èŒƒå›´. æ‰€ä»¥å³ä½¿ unit æ–‡ä»¶é…ç½®äº†<code>Restart on-failure</code>ä¹Ÿä¸ä¼šè¢«é‡å¯</p>
<p>è¯¥é—®é¢˜æ˜¯ systemd çš„å·²çŸ¥ BUG ä¹‹ä¸€. è§„é¿è¯¥é—®é¢˜çš„æ–¹å¼æœ‰å¾ˆå¤šç§, å…¶ä¸­ä»¥ä¸‹è¿™ç§æ–¹å¼å¹¶æ²¡æœ‰ç”Ÿæ•ˆ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ systemctl show kube-apiserver | grep PIPE</span><br><span class="line">IgnoreSIGPIPE&#x3D;yes</span><br></pre></td></tr></table></figure>
<p>é»˜è®¤æƒ…å†µä¸‹, <code>IgnoreSIGPIPE=yes</code>æ˜¯é…ç½®å¥½çš„, ç†è®ºä¸Šä¼šå¿½ç•¥æ‰æ¥æ”¶åˆ°çš„<code>SIGPIPE</code>ä¿¡å·, ä½†å®é™…æƒ…å†µè¡¨æ˜, å¹¶æ²¡æœ‰è¢«å¿½ç•¥</p>
<p>è§£å†³æ–¹æ¡ˆ:</p>
<ul>
<li>åœ¨ systemd çš„ unit æ–‡ä»¶ä¸­çš„ <code>Restart</code> ç­–ç•¥è®¾ç½®ä¸º <code>Always</code>, è¿™æ ·å³ä½¿æ˜¯æ­£å¸¸çš„å…³é—­, ä¹Ÿä¼šé‡å¯æœåŠ¡</li>
<li>åœ¨ systemd çš„ unit æ–‡ä»¶ä¸­é…ç½® <code>RestartForceExitStatus=SIGPIPE</code> æŒ‡å®šæ”¶åˆ°è¿™ä¸ªä¿¡å·æ—¶, å¼ºåˆ¶é‡å¯æœåŠ¡</li>
</ul>
<p>åæ¶ˆæ¯:</p>
<p><code>RestartForceExitStatus</code> çš„é…ç½®åœ¨ systemd 215ä¸­æ‰è¢«åŠ å…¥, å¯¹äºä½¿ç”¨ä¹‹å‰ç‰ˆæœ¬çš„æƒ…å†µæ¥è¯´, å¹¶æ²¡æœ‰ä»€ä¹ˆå¸®åŠ©, å¯èƒ½<code>Always</code>æ˜¯å”¯ä¸€çš„é€‰æ‹©</p>
<hr>
<p>ç—…å‹:</p>
<ul>
<li><a href="https://github.com/influxdata/influxdb/issues/7040" target="_blank" rel="noopener">https://github.com/influxdata/influxdb/issues/7040</a></li>
<li><a href="https://github.com/syncthing/syncthing/issues/2350" target="_blank" rel="noopener">https://github.com/syncthing/syncthing/issues/2350</a></li>
<li><a href="https://github.com/moby/moby/issues/7087" target="_blank" rel="noopener">https://github.com/moby/moby/issues/7087</a></li>
<li><a href="https://github.com/systemd/systemd/issues/6620" target="_blank" rel="noopener">https://github.com/systemd/systemd/issues/6620</a></li>
</ul>
<p>å‚è€ƒæ–‡æ¡£:</p>
<ul>
<li>systemd-journald BUGè®°å½•: <a href="https://bugs.freedesktop.org/show_bug.cgi?id=84923" target="_blank" rel="noopener">https://bugs.freedesktop.org/show_bug.cgi?id=84923</a></li>
<li>systemd.service ä¸­æ–‡æ‰‹å†Œ: <a href="http://www.jinbuguo.com/systemd/systemd.service.html" target="_blank" rel="noopener">http://www.jinbuguo.com/systemd/systemd.service.html</a></li>
</ul>
]]></content>
      <categories>
        <category>Kubernetes</category>
      </categories>
      <tags>
        <tag>journald</tag>
        <tag>systemd</tag>
        <tag>BUG</tag>
        <tag>SIGPIPE</tag>
        <tag>kube-apiserver</tag>
      </tags>
  </entry>
  <entry>
    <title>systemd-journal: Suppressed N messages</title>
    <url>/2018/11/22/systemd-journal-Suppressed-N-messages/</url>
    <content><![CDATA[<blockquote>
<p>é—®é¢˜ç°è±¡: docker container logs æŸ¥çœ‹å®¹å™¨æ—¥å¿—å´æ²¡æœ‰ä»»ä½•è¿”å›ç»“æœ. å¼€å§‹ä»¥ä¸ºæ˜¯ç¨‹åºæ²¡æœ‰ stdout æ ‡å‡†è¾“å‡º, ä½†æ˜¯åæ¥æµ‹è¯•, å°†<code>echo &quot;log&quot;</code>ä½œä¸ºæ­»å¾ªç¯è¿è¡Œåœ¨å®¹å™¨ä¸­, å†æ¬¡æ‰§è¡Œ<code>docker container logs</code>ä¾ç„¶æ²¡æœ‰ä»»ä½•æ—¥å¿—è¾“å‡º. æ‰¾åˆ°ä¸€å°â€å¹²å‡€çš„â€docker æœåŠ¡å™¨æµ‹è¯•å´å¯ä»¥æ­£å¸¸æ˜¾ç¤ºæ—¥å¿—</p>
</blockquote>
<p>è¿™å°æ— æ³•æŸ¥çœ‹æ—¥å¿—å›æ˜¾çš„æœåŠ¡å™¨, Docker çš„æ—¥å¿—å¼•æ“é…ç½®ä¸º<code>journald</code>, æŸ¥çœ‹ journald æœåŠ¡æ—¥å¿—å‘ç°å¤§é‡ç±»ä¼¼æ—¥å¿—:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">systemd-journal: Suppressed 9567 messages from &#x2F;system.slice&#x2F;</span><br><span class="line">systemd-journal: Suppressed 6735 messages from &#x2F;system.slice&#x2F;</span><br><span class="line">......</span><br></pre></td></tr></table></figure>

<p>æ ¹æ®å­—é¢æ„æ€ç†è§£å°±æ˜¯æ—¥å¿—è¢«ä¸¢å¼ƒäº†, çœ‹æ¥æ˜¯ç”±äº journald æœåŠ¡çš„é—®é¢˜å¯¼è‡´çš„æ—¥å¿—é—®é¢˜</p>
<p>åœ¨ journald ä¸­, æœ‰å¦‚ä¸‹ä¸¤ä¸ªå‚æ•°è·Ÿæ­¤é—®é¢˜ç›¸å…³:</p>
<ul>
<li>RateLimitInterval</li>
<li>RateLimitBurst</li>
</ul>
<p><code>RateLimitInterval</code>æ˜¯æŒ‡å®šæ—¶é—´é—´éš”, æ„æ€å°±æ˜¯è¯´, åœ¨<code>RateLimitInterval</code>è¿™æ®µæ—¶é—´å†…çš„æ—¥å¿—æ€»é‡(æ€»æ¡æ•°)æ§åˆ¶åœ¨<code>RateLimitBurst</code>ä»¥å†…. è¿™ä¸¤ä¸ªå‚æ•°æ­é…ä½¿ç”¨å¯ä»¥ç”¨æ¥æ§åˆ¶æ—¥å¿—é€Ÿç‡, é¿å…ç”±äºå¤§é‡æ—¥å¿—è¾“å‡ºå¯¼è‡´çš„ä¸€ç³»åˆ—æ€§èƒ½é—®é¢˜.</p>
<p>è¯¥é—®é¢˜çš„æ ¹æºåœ¨äºè¯¥ä¸»æœºç›®å‰æ—¥å¿—è¾“å‡ºçš„é€Ÿç‡è¶…å‡ºäº† journald é»˜è®¤çš„é…ç½®, ä½ å¯ä»¥è‡ªå®šå®šä¹‰è¯¥é€Ÿç‡, ä¹Ÿå¯ä»¥å°†<code>RateLimitInterval</code>è®¾ç½®ä¸º<code>0</code>, ä»¥ç¦ç”¨é€Ÿç‡æ§åˆ¶</p>
<p>æ¥ä¸‹æ¥é‡å¯ journald ä»¥ç”Ÿæ•ˆé…ç½®</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">systemctl restart systemd-journald</span><br></pre></td></tr></table></figure>

<p><strong>æ³¨æ„: é‡å¯ journald æœåŠ¡å¯èƒ½ä¼šå¼•å‘ä¸€ä¸ª systemd çš„ bug, è¯¦æƒ…è¯·å‚è€ƒä¸‹ç¯‡æ–‡ç« &lt;systemd-journaldçš„SIGPIPEä¿¡å·BUG&gt;</strong></p>
<p>å‚è€ƒæ–‡æ¡£:</p>
<ul>
<li><a href="https://www.freedesktop.org/software/systemd/man/journald.conf.html" target="_blank" rel="noopener">https://www.freedesktop.org/software/systemd/man/journald.conf.html</a></li>
<li><a href="https://bani.com.br/2015/06/systemd-journal-what-does-systemd-journal-suppressed-n-messages-from-system-slice-mean/" target="_blank" rel="noopener">https://bani.com.br/2015/06/systemd-journal-what-does-systemd-journal-suppressed-n-messages-from-system-slice-mean/</a></li>
</ul>
]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>Kubernetes</tag>
        <tag>container</tag>
        <tag>log</tag>
        <tag>Docker</tag>
        <tag>journald</tag>
      </tags>
  </entry>
  <entry>
    <title>heapsteréƒ¨ç½²åŠé…ç½®ä½¿ç”¨httpsè®¿é—®kubelet10250ç«¯å£</title>
    <url>/2018/11/14/heapster%E9%83%A8%E7%BD%B2%E5%8F%8A%E9%85%8D%E7%BD%AE%E4%BD%BF%E7%94%A8https%E8%AE%BF%E9%97%AEkubelet10250%E7%AB%AF%E5%8F%A3/</url>
    <content><![CDATA[<p>é»˜è®¤æƒ…å†µä¸‹, heapster ä½¿ç”¨ http åè®®è®¿é—®æ¯ä¸ª kubelet èŠ‚ç‚¹çš„10255è¿™ä¸ªéå®‰å…¨ç«¯å£, åœ¨kubelet å…³é—­æ­¤ç«¯å£çš„æƒ…å†µä¸‹, ä»…å…è®¸é€šè¿‡ https é€šä¿¡æ—¶, heapster æ‰¾ kubeletæ‹¿æ•°æ®æˆäº†å¤§é—®é¢˜</p>
<p>åŸºç¡€ç¯å¢ƒ:</p>
<p>auth mode: RBAC<br>kubelet port: only https(10250)<br>kubelet ca: SelfSign</p>
<h2 id="åˆ›å»º-ServiceAccount"><a href="#åˆ›å»º-ServiceAccount" class="headerlink" title="åˆ›å»º ServiceAccount"></a>åˆ›å»º ServiceAccount</h2><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">heapster</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br></pre></td></tr></table></figure>

<h2 id="åˆ›å»º-ClusterRoleBinding"><a href="#åˆ›å»º-ClusterRoleBinding" class="headerlink" title="åˆ›å»º ClusterRoleBinding"></a>åˆ›å»º ClusterRoleBinding</h2><p>å®˜æ–¹æ–‡æ¡£ä¸­çš„é…ç½®å¦‚ä¸‹:</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRoleBinding</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1beta1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">heapster</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">system:heapster</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">heapster</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br></pre></td></tr></table></figure>

<p>å®˜æ–¹æ–‡æ¡£ä¸­çš„é…ç½®åœ¨ heapster ä½¿ç”¨ http åè®®è®¿é—® kubelet 10255 ç«¯å£çš„æ—¶å€™æ—¶æ²¡æœ‰ä»»ä½•é—®é¢˜çš„, ä½†æ˜¯ç”¨è¿™ä»½é…ç½®è®¿é—® kubelet çš„ 10250 ç«¯å£, ä½ åœ¨ heapster çš„ console log æ—¥å¿—ä¸­, å¯ä»¥çœ‹åˆ° 403 Forbidden çš„æŠ¥é”™, å› ä¸ºç»‘å®šçš„è§’è‰²æƒé™æ²¡æœ‰è¾¾åˆ°è¦æ±‚, æ‰€ä»¥ä½ éœ€è¦ä¸‹é¢è¿™ä»½ç»‘å®šæ–‡ä»¶</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRoleBinding</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1beta1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">heapster</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">system:kubelet-api-admin</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">heapster</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br></pre></td></tr></table></figure>

<p>å…¶å®åªæ˜¯ç»‘å®šçš„è§’è‰²ä» <code>system:heapster</code> æ¢æˆäº† <code>system:kubelet-api-admin</code></p>
<h2 id="åˆ›å»º-heapster-æœåŠ¡"><a href="#åˆ›å»º-heapster-æœåŠ¡" class="headerlink" title="åˆ›å»º heapster æœåŠ¡"></a>åˆ›å»º heapster æœåŠ¡</h2><p>ä»¥ä¸‹æ˜¯å®˜æ–¹ç¤ºä¾‹:</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">extensions/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">heapster</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">task:</span> <span class="string">monitoring</span></span><br><span class="line">        <span class="attr">k8s-app:</span> <span class="string">heapster</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">serviceAccountName:</span> <span class="string">heapster</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">heapster</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">k8s.gcr.io/heapster-amd64:v1.5.4</span></span><br><span class="line">        <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">        <span class="attr">command:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">/heapster</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">--source=kubernetes:https://kubernetes.default</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">--sink=influxdb:http://monitoring-influxdb.kube-system.svc:8086</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬éœ€è¦å¯¹å¦‚ä¸‹å‚æ•°åšä¿®æ”¹:</p>
<ul>
<li>â€“source=kubernetes:https://è¿™é‡Œå†™ä½ masterçš„åŸŸå:6443 </li>
<li>â€“sink=influxdb:http://è¿™é‡Œå†™ä½ influxdbçš„åœ°å€æˆ–åŸŸå:8086</li>
</ul>
<p><code>--sink</code> é…ç½®ä¸­æœ‰å¦‚ä¸‹å‚æ•°å¯ä»¥é€‰æ‹©</p>
<ul>
<li>inClusterConfig - Use kube config in service accounts associated with Heapsterâ€™s namespace. (default: true)</li>
<li>kubeletPort - kubelet port to use (default: 10255)</li>
<li>kubeletHttps - whether to use https to connect to kubelets (default: false)</li>
<li>insecure - whether to trust Kubernetes certificates (default: false)</li>
<li>auth - client auth file to use. Set auth if the service accounts are not usable.</li>
<li>useServiceAccount - whether to use the service account token if one is mounted at /var/run/secrets/kubernetes.io/serviceaccount/token (default: false)</li>
</ul>
<p>éœ€è¦è®¾ç½®è®¿é—® kubelet çš„å®‰å…¨ç«¯å£, éœ€è¦å¦‚ä¸‹å‚æ•°</p>
<ul>
<li>kubeletPort 10250  è®¿é—®10250ç«¯å£</li>
<li>kubeletHttps true  ä»¥httpsåè®®è®¿é—®</li>
<li>insecure true      ä¿¡ä»»kubernetesè¯ä¹¦</li>
<li>useServiceAccount true ä½¿ç”¨æŒ‚è½½è¿›æ¥çš„SAè´¦æˆ·è¿›è¡Œè®¿é—®</li>
</ul>
<p>æœ€ç»ˆçš„é…ç½®ç»“æœå¦‚ä¸‹:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">--source&#x3D;kubernetes:https:&#x2F;&#x2F;k8s-master:6443?useServiceAccount&#x3D;true&amp;kubeletHttps&#x3D;true&amp;kubeletPort&#x3D;10250&amp;insecure&#x3D;true</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œç€é‡è¯´æ˜ä¸€ä¸‹<code>insecure</code>é…ç½®, ä¸€èˆ¬æƒ…å†µä¸‹, kubelet èŠ‚ç‚¹åœ¨æ²¡æœ‰é™æ€é…ç½®<strong>æœåŠ¡ç«¯è¯ä¹¦</strong>çš„æƒ…å†µä¸‹, kubelet èŠ‚ç‚¹ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªè‡ªç­¾åçš„æœåŠ¡ç«¯è¯ä¹¦åˆ°æŒ‡å®šæˆ–é»˜è®¤çš„ç›®å½•ä¸‹. è¿™ä¸ªè¯ä¹¦æ˜¯ç‹¬ç«‹äºkubernetesé›†ç¾¤çš„è¯ä¹¦, ä¸æ˜¯kubernetesé›†ç¾¤æ ¹è¯ä¹¦æ‰€ç­¾å‘çš„. æ‰€ä»¥ç†è®ºä¸Š, åœ¨ kubernetse çš„åŒå‘è®¤è¯ä¸­, å½“ apiserver å‘ kubeletä¸»åŠ¨å‘èµ· https è¯·æ±‚å, æœåŠ¡ç«¯é¦–å…ˆä¼šå°†è‡ªå·±çš„æœåŠ¡ç«¯è¯ä¹¦å‘é€ç»™å®¢æˆ·ç«¯(apiserver), ä¸€èˆ¬æƒ…å†µä¸‹, apiserver æ˜¯éœ€è¦æ ¡éªŒæœåŠ¡ç«¯è¯ä¹¦æ˜¯å¦å¯ä¿¡çš„. ä½†æ˜¯åœ¨ apiserver ä¸ kubelet é€šä¿¡ä¸­æ¯”è¾ƒç‰¹æ®Š, é»˜è®¤æƒ…å†µä¸‹, apiserver æ˜¯ä¸ä¼šæ ¡éªŒ kubelet çš„æœåŠ¡ç«¯è¯ä¹¦çš„, å› ä¸º kubelet ä¸€èˆ¬æ˜¯ç‹¬ç«‹äºk8é›†ç¾¤çš„è‡ªç­¾åè¯ä¹¦, å¦‚æœçœŸçš„æ ¡éªŒ, ç»“æœè‚¯å®šæ˜¯æœåŠ¡ç«¯è¯ä¹¦ä¸å¯ä¿¡, æ‰€ä»¥ç´¢æ€§é»˜è®¤å°±ä¸æ ¡éªŒäº†, è€Œæ˜¯ç›´æ¥å°† apiserver æŒæœ‰çš„ kubelet å®¢æˆ·ç«¯è¯ä¹¦å‘é€ç»™ kubelet, ä¾› kubelet æ ¡éªŒ, æ­¤æ—¶, kubelet ä¾æ®é…ç½®ä¸­æŒ‡å®šçš„caè¯ä¹¦å¯¹ apiserver å‘æ¥çš„å®¢æˆ·ç«¯è¯ä¹¦è¿›è¡Œæ ¡éªŒ.</p>
<p>è¯é¢˜å†å›åˆ°<code>insecure</code>é…ç½®. å¦‚æœä½ è®¾ç½®è¿™ä¸ªå‚æ•°ä¸º<code>true</code>, è¿˜è¦ä½¿ç”¨ https åè®®å»è®¿é—® kubelet, é‚£ä¹ˆ heapster æ—¥å¿—ä¸­å°†ä¼šæŠ¥è¯ä¹¦éªŒè¯å¤±è´¥çš„é”™è¯¯. heapster ä¼šå–åˆ°æ¯ä¸ª kubelet çš„IPåœ°å€, ç„¶åè¿›è¡Œè®¿é—®, ä½†é—®é¢˜æ˜¯, kubelet åœ¨è‡ªç­¾åè¯ä¹¦æ—¶, é»˜è®¤ä¾æ®çš„æ˜¯è‡ªå·±çš„ä¸»æœºå, æ‰€ä»¥ heapster ä»¥ https è®¿é—® kubelet, ä¸€æ˜¯è¯ä¹¦ä¸æ˜¯è‡ªå·±æŒæœ‰çš„æ ¹è¯ä¹¦ç­¾å‘çš„,ä¸å¯ä¿¡; äºŒæ˜¯æœåŠ¡ç«¯çš„åœ°å€é™å®šæ˜¯åŸºäºDNSçš„ä¸»æœºå, å¹¶æ²¡æœ‰è®¾ç½®IP, æ‰€ä»¥ä¹Ÿä¸ä¼šæ ¡éªŒé€šè¿‡</p>
<hr>
<p>å‚è€ƒæ–‡æ¡£:</p>
<ul>
<li>å®˜æ–¹æ–‡æ¡£ä¹‹sourceé…ç½® <a href="https://github.com/kubernetes/heapster/blob/master/docs/source-configuration.md" target="_blank" rel="noopener">https://github.com/kubernetes/heapster/blob/master/docs/source-configuration.md</a></li>
</ul>
]]></content>
      <categories>
        <category>Kubernetes</category>
      </categories>
      <tags>
        <tag>kubelet</tag>
        <tag>heapster</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸ºk8s-masterèŠ‚ç‚¹æ·»åŠ æ±¡ç‚¹taints</title>
    <url>/2018/11/14/%E4%B8%BAk8s-master%E8%8A%82%E7%82%B9%E6%B7%BB%E5%8A%A0%E6%B1%A1%E7%82%B9taints/</url>
    <content><![CDATA[<p>æ‰‹åŠ¨éƒ¨ç½²çš„k8sé›†ç¾¤, éœ€è¦ä¸ºmasterèŠ‚ç‚¹æ‰‹åŠ¨è®¾ç½®taints</p>
<h2 id="è®¾ç½®taint"><a href="#è®¾ç½®taint" class="headerlink" title="è®¾ç½®taint"></a>è®¾ç½®taint</h2><p>è¯­æ³•:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">kubectl taint node [node] key&#x3D;value[effect]   </span><br><span class="line">     å…¶ä¸­[effect] å¯å–å€¼: [ NoSchedule | PreferNoSchedule | NoExecute ]</span><br><span class="line">      NoSchedule: ä¸€å®šä¸èƒ½è¢«è°ƒåº¦</span><br><span class="line">      PreferNoSchedule: å°½é‡ä¸è¦è°ƒåº¦</span><br><span class="line">      NoExecute: ä¸ä»…ä¸ä¼šè°ƒåº¦, è¿˜ä¼šé©±é€Nodeä¸Šå·²æœ‰çš„Pod</span><br></pre></td></tr></table></figure>

<p>ç¤ºä¾‹:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">kubectl taint node node1 key1&#x3D;value1:NoSchedule</span><br><span class="line">kubectl taint node node1 key1&#x3D;value1:NoExecute</span><br><span class="line">kubectl taint node node1 key2&#x3D;value2:NoSchedule</span><br></pre></td></tr></table></figure>

<h2 id="æŸ¥çœ‹taintï¼š"><a href="#æŸ¥çœ‹taintï¼š" class="headerlink" title="æŸ¥çœ‹taintï¼š"></a>æŸ¥çœ‹taintï¼š</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">kubectl describe node node1</span><br></pre></td></tr></table></figure>

<h2 id="åˆ é™¤taint"><a href="#åˆ é™¤taint" class="headerlink" title="åˆ é™¤taint:"></a>åˆ é™¤taint:</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">kubectl taint node node1 key1:NoSchedule-  <span class="comment"># è¿™é‡Œçš„keyå¯ä»¥ä¸ç”¨æŒ‡å®švalue</span></span><br><span class="line">kubectl taint node node1 key1:NoExecute-</span><br><span class="line"><span class="comment"># kubectl taint node node1 key1-  åˆ é™¤æŒ‡å®škeyæ‰€æœ‰çš„effect</span></span><br><span class="line">kubectl taint node node1 key2:NoSchedule-</span><br></pre></td></tr></table></figure>

<h2 id="masterèŠ‚ç‚¹è®¾ç½®taint"><a href="#masterèŠ‚ç‚¹è®¾ç½®taint" class="headerlink" title="masterèŠ‚ç‚¹è®¾ç½®taint"></a>masterèŠ‚ç‚¹è®¾ç½®taint</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">kubectl taint nodes master1 node-role.kubernetes.io&#x2F;master&#x3D;:NoSchedule</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„âš ï¸ : ä¸ºmasterè®¾ç½®çš„è¿™ä¸ªtaintä¸­, <code>node-role.kubernetes.io/master</code>ä¸º<code>key</code>, <code>value</code>ä¸ºç©º, <code>effect</code>ä¸º<code>NoSchedule</code></p>
<p>å¦‚æœè¾“å…¥å‘½ä»¤æ—¶, ä½ ä¸¢æ‰äº†<code>=</code>ç¬¦å·, å†™æˆäº†<code>node-role.kubernetes.io/master:NoSchedule</code>, ä¼šæŠ¥<code>error: at least one taint update is required</code>é”™è¯¯</p>
<h2 id="å®¹å¿tolerationsä¸»èŠ‚ç‚¹çš„taints"><a href="#å®¹å¿tolerationsä¸»èŠ‚ç‚¹çš„taints" class="headerlink" title="å®¹å¿tolerationsä¸»èŠ‚ç‚¹çš„taints"></a>å®¹å¿tolerationsä¸»èŠ‚ç‚¹çš„taints</h2><p>ä»¥ä¸Šé¢ä¸º master1 è®¾ç½®çš„ taints ä¸ºä¾‹, ä½ éœ€è¦ä¸ºä½ çš„ yaml æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹é…ç½®, æ‰èƒ½å®¹å¿ master èŠ‚ç‚¹çš„æ±¡ç‚¹</p>
<p>åœ¨ pod çš„ spec ä¸­è®¾ç½® tolerations å­—æ®µ</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">tolerations:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">key:</span> <span class="string">"node-role.kubernetes.io/master"</span></span><br><span class="line">  <span class="attr">operator:</span> <span class="string">"Equal"</span></span><br><span class="line">  <span class="attr">value:</span> <span class="string">""</span></span><br><span class="line">  <span class="attr">effect:</span> <span class="string">"NoSchedule"</span></span><br></pre></td></tr></table></figure>


]]></content>
      <categories>
        <category>Kubernetes</category>
      </categories>
      <tags>
        <tag>taints</tag>
        <tag>tolerations</tag>
      </tags>
  </entry>
  <entry>
    <title>k8sè®¾ç½®nodeèŠ‚ç‚¹Roleå±æ€§</title>
    <url>/2018/11/01/k8s%E8%AE%BE%E7%BD%AEnode%E8%8A%82%E7%82%B9Role%E5%B1%9E%E6%80%A7/</url>
    <content><![CDATA[<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@k8s-master:~# kubectl get nodes</span><br><span class="line">NAME         STATUS     ROLES     AGE       VERSION</span><br><span class="line">k8s-master   Ready      master    50d       v1.11.2</span><br><span class="line">k8s-node1    NotReady   &lt;none&gt;    50d       v1.11.2</span><br><span class="line">k8s-node2    NotReady   &lt;none&gt;    50d       v1.11.2</span><br></pre></td></tr></table></figure>

<p>åœ¨ kubeadm å¼•å¯¼çš„ k8s é›†ç¾¤ä¸­, æŸ¥çœ‹ nodes ä¿¡æ¯æ—¶, ROLES ä¸€åˆ—æ ‡è®°äº† master èŠ‚ç‚¹çš„èº«ä»½, å…¶ä»–èŠ‚ç‚¹é»˜è®¤æ²¡æœ‰æ ‡è®°. åœ¨æ‰‹åŠ¨å®‰è£…çš„ k8s é›†ç¾¤ä¸­, ä½ çœ‹åˆ°æƒ…å†µå¯èƒ½æ˜¯å¦‚ä¸‹è¿™æ ·çš„:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@k8s-master:~# kubectl get nodes</span><br><span class="line">NAME         STATUS     ROLES     AGE       VERSION</span><br><span class="line">k8s-master   Ready      &lt;none&gt;    50d       v1.11.2</span><br><span class="line">k8s-node1    NotReady   &lt;none&gt;    50d       v1.11.2</span><br><span class="line">k8s-node2    NotReady   &lt;none&gt;    50d       v1.11.2</span><br></pre></td></tr></table></figure>

<p>æ²¡é”™, è¿ master èŠ‚ç‚¹çš„æ ‡è®°éƒ½æ²¡æœ‰, æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨ç»™ä»»æ„ node è®¾ç½® ROLES</p>
<p>åŸç†å°±æ˜¯ç»™ node æ‰“æ ‡ç­¾, åªä¸è¿‡æ˜¯ç‰¹æ®Šçš„æ ‡ç­¾</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@k8s-master:~# kubectl get nodes</span><br><span class="line">NAME         STATUS     ROLES     AGE       VERSION</span><br><span class="line">k8s-master   Ready      master    50d       v1.11.2</span><br><span class="line">k8s-node1    NotReady   &lt;none&gt;    50d       v1.11.2</span><br><span class="line">k8s-node2    NotReady   &lt;none&gt;    50d       v1.11.2</span><br><span class="line">root@k8s-master:~# kubectl label node k8s-node1 node-role.kubernetes.io&#x2F;worker&#x3D;worker</span><br><span class="line">node&#x2F;k8s-node1 labeled</span><br><span class="line">root@k8s-master:~# kubectl get nodes</span><br><span class="line">NAME         STATUS     ROLES     AGE       VERSION</span><br><span class="line">k8s-master   Ready      master    50d       v1.11.2</span><br><span class="line">k8s-node1    NotReady   worker    50d       v1.11.2</span><br><span class="line">k8s-node2    NotReady   &lt;none&gt;    50d       v1.11.2</span><br><span class="line">root@k8s-master:~#</span><br></pre></td></tr></table></figure>

<p>å‚è€ƒæ–‡æ¡£:</p>
<p><a href="https://kubernetes.io/docs/reference/setup-tools/kubeadm/implementation-details/" target="_blank" rel="noopener">https://kubernetes.io/docs/reference/setup-tools/kubeadm/implementation-details/</a></p>
]]></content>
      <categories>
        <category>Kubernetes</category>
      </categories>
      <tags>
        <tag>kubernetes</tag>
        <tag>role</tag>
        <tag>node</tag>
        <tag>label</tag>
      </tags>
  </entry>
  <entry>
    <title>yumå®‰è£…è½¯ä»¶åŒ…å¤±è´¥çš„æ’é”™è¿‡ç¨‹</title>
    <url>/2018/11/01/yum%E5%AE%89%E8%A3%85%E8%BD%AF%E4%BB%B6%E5%8C%85%E5%A4%B1%E8%B4%A5%E7%9A%84%E6%8E%92%E9%94%99%E8%BF%87%E7%A8%8B/</url>
    <content><![CDATA[<p>å®‰è£… docker-ce æ—¶, ä¾èµ–å®‰è£… libcgroup å¤±è´¥</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Total download size: 65 k</span><br><span class="line">Installed size: 130 k</span><br><span class="line">Is this ok [y/d/N]: y</span><br><span class="line">Downloading packages:</span><br><span class="line">libcgroup-0.41-15.el7.x86_64.rpm                                                                                                           |  65 kB  00:00:00</span><br><span class="line">Member: libcgroup.x86_64 0:0.41-15.el7 - u</span><br><span class="line">Adding Package libcgroup-0.41-15.el7.x86_64 <span class="keyword">in</span> mode u</span><br><span class="line">Running transaction check</span><br><span class="line">Transaction check time: 0.108</span><br><span class="line">Running transaction <span class="built_in">test</span></span><br><span class="line">Transaction <span class="built_in">test</span> succeeded</span><br><span class="line">Transaction <span class="built_in">test</span> time: 0.069</span><br><span class="line">Running transaction</span><br><span class="line">groupadd: cannot open /etc/group</span><br><span class="line">error: %pre(libcgroup-0.41-15.el7.x86_64) scriptlet failed, <span class="built_in">exit</span> status 10</span><br><span class="line">Error <span class="keyword">in</span> PREIN scriptlet <span class="keyword">in</span> rpm package libcgroup-0.41-15.el7.x86_64</span><br><span class="line">Warning: scriptlet or other non-fatal errors occurred during transaction.</span><br><span class="line">  Verifying  : libcgroup-0.41-15.el7.x86_64                                                                                                                   1/1</span><br><span class="line">What is this? libcgroup-0.41-15.el7.x86_64</span><br><span class="line">VerifyTransaction time: 0.003</span><br><span class="line">Transaction time: 0.810</span><br><span class="line"></span><br><span class="line">Failed:</span><br><span class="line">  libcgroup.x86_64 0:0.41-15.el7</span><br></pre></td></tr></table></figure>

<p>çœ‹åˆ°æŠ¥é”™ä¿¡æ¯<code>groupadd: cannot open /etc/group</code>, å®‰è£…ç¨‹åºæ“ä½œäº†è¿™ä¸ªæ–‡ä»¶, ä½†æ˜¯æŠ¥è¿™ä¸ªæ–‡ä»¶ä¸å¯è®¿é—®çš„é”™è¯¯</p>
<p>å®é™…æ£€æŸ¥ä¸­, è¯¥æ–‡ä»¶å·²ç»å­˜åœ¨</p>
<p>å°†å®‰è£…åŒ…å•ç‹¬ä¸‹è½½ä¸‹æ¥, æ‰‹åŠ¨å®‰è£…æŸ¥çœ‹è¯¦ç»†æ“ä½œ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum install --downloadonly libcgroup</span><br><span class="line">Loaded plugins: fastestmirror, langpacks, priorities</span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line"> * elrepo: mirrors.neusoft.edu.cn</span><br><span class="line">Resolving Dependencies</span><br><span class="line">--&gt; Running transaction check</span><br><span class="line">---&gt; Package libcgroup.x86_64 0:0.41-15.el7 will be installed</span><br><span class="line">--&gt; Finished Dependency Resolution</span><br><span class="line"></span><br><span class="line">Dependencies Resolved</span><br><span class="line"></span><br><span class="line">==================================================================================================================================================================</span><br><span class="line"> Package                                 Arch                                 Version                                    Repository                          Size</span><br><span class="line">==================================================================================================================================================================</span><br><span class="line">Installing:</span><br><span class="line"> libcgroup                               x86_64                               0.41-15.el7                                base                                65 k</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">==================================================================================================================================================================</span><br><span class="line">Install  1 Package</span><br><span class="line"></span><br><span class="line">Total download size: 65 k</span><br><span class="line">Installed size: 130 k</span><br><span class="line">Background downloading packages, <span class="keyword">then</span> exiting:</span><br><span class="line">libcgroup-0.41-15.el7.x86_64.rpm                                                                                                           |  65 kB  00:00:00</span><br><span class="line">exiting because <span class="string">"Download Only"</span> specified</span><br></pre></td></tr></table></figure>

<p>æ‰¾åˆ°æ–‡ä»¶ä½ç½®</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">find / -name <span class="string">"libcgroup-0.41-15.el7.x86_64.rpm"</span> -<span class="built_in">type</span> f</span><br><span class="line">/var/cache/yum/x86_64/7/base/packages/libcgroup-0.41-15.el7.x86_64.rpm</span><br></pre></td></tr></table></figure>

<p>æ‰‹åŠ¨å®‰è£…</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rpm -ivvvh /var/cache/yum/x86_64/7/base/packages/libcgroup-0.41-15.el7.x86_64.rpm</span><br><span class="line">D: ============== /var/cache/yum/x86_64/7/base/packages/libcgroup-0.41-15.el7.x86_64.rpm</span><br><span class="line">D: loading keyring from pubkeys <span class="keyword">in</span> /var/lib/rpm/pubkeys/*.key</span><br><span class="line">D: couldn<span class="string">'t find any keys in /var/lib/rpm/pubkeys/*.key</span></span><br><span class="line"><span class="string">D: loading keyring from rpmdb</span></span><br><span class="line"><span class="string">D: opening  db environment /var/lib/rpm cdb:0x401</span></span><br><span class="line"><span class="string">D: opening  db index       /var/lib/rpm/Packages 0x400 mode=0x0</span></span><br><span class="line"><span class="string">D: locked   db index       /var/lib/rpm/Packages</span></span><br><span class="line"><span class="string">D: opening  db index       /var/lib/rpm/Name 0x400 mode=0x0</span></span><br><span class="line"><span class="string">D:  read h#     671 Header SHA1 digest: OK (6c239af7e9e88852422394529fbf054ef1cd4921)</span></span><br><span class="line"><span class="string">D: added key gpg-pubkey-baadae52-49beffa4 to keyring</span></span><br><span class="line"><span class="string">D: Using legacy gpg-pubkey(s) from rpmdb</span></span><br><span class="line"><span class="string">D: Expected size:        66752 = lead(96)+sigs(1284)+pad(4)+data(65368)</span></span><br><span class="line"><span class="string">D:   Actual size:        66752</span></span><br><span class="line"><span class="string">warning: /var/cache/yum/x86_64/7/base/packages/libcgroup-0.41-15.el7.x86_64.rpm: Header V3 RSA/SHA256 Signature, key ID f4a80eb5: NOKEY</span></span><br><span class="line"><span class="string">D: 	added binary package [0]</span></span><br><span class="line"><span class="string">D: found 0 source and 1 binary packages</span></span><br><span class="line"><span class="string">D: opening  db index       /var/lib/rpm/Conflictname 0x400 mode=0x0</span></span><br><span class="line"><span class="string">D: ========== +++ libcgroup-0.41-15.el7 x86_64/linux 0x2</span></span><br><span class="line"><span class="string">D: opening  db index       /var/lib/rpm/Basenames 0x400 mode=0x0</span></span><br><span class="line"><span class="string">D:  read h#     606 Header SHA1 digest: OK (83b77b161083033277b34d5b3705b5e3a2a52ab3)</span></span><br><span class="line"><span class="string">D:  Requires: /bin/sh                                       YES (db files)</span></span><br><span class="line"><span class="string">D:  Requires: /bin/sh                                       YES (cached)</span></span><br><span class="line"><span class="string">D:  read h#      36 Header V3 RSA/SHA256 Signature, key ID f4a80eb5: NOKEY</span></span><br><span class="line"><span class="string">D:  Requires: /sbin/ldconfig                                YES (db files)</span></span><br><span class="line"><span class="string">D:  Requires: /sbin/ldconfig                                YES (cached)</span></span><br><span class="line"><span class="string">D: opening  db index       /var/lib/rpm/Providename 0x400 mode=0x0</span></span><br><span class="line"><span class="string">D:  read h#      36 Header V3 RSA/SHA256 Signature, key ID f4a80eb5: NOKEY</span></span><br><span class="line"><span class="string">D:  Requires: ld-linux-x86-64.so.2()(64bit)                 YES (db provides)</span></span><br><span class="line"><span class="string">D:  read h#      36 Header V3 RSA/SHA256 Signature, key ID f4a80eb5: NOKEY</span></span><br><span class="line"><span class="string">D:  Requires: ld-linux-x86-64.so.2(GLIBC_2.3)(64bit)        YES (db provides)</span></span><br><span class="line"><span class="string">D:  read h#      36 Header V3 RSA/SHA256 Signature, key ID f4a80eb5: NOKEY</span></span><br><span class="line"><span class="string">D:  Requires: libc.so.6()(64bit)                            YES (db provides)</span></span><br><span class="line"><span class="string">D:  read h#      36 Header V3 RSA/SHA256 Signature, key ID f4a80eb5: NOKEY</span></span><br><span class="line"><span class="string">D:  Requires: libc.so.6(GLIBC_2.11)(64bit)                  YES (db provides)</span></span><br><span class="line"><span class="string">D:  read h#      36 Header V3 RSA/SHA256 Signature, key ID f4a80eb5: NOKEY</span></span><br><span class="line"><span class="string">D:  Requires: libc.so.6(GLIBC_2.14)(64bit)                  YES (db provides)</span></span><br><span class="line"><span class="string">D:  read h#      36 Header V3 RSA/SHA256 Signature, key ID f4a80eb5: NOKEY</span></span><br><span class="line"><span class="string">D:  Requires: libc.so.6(GLIBC_2.2.5)(64bit)                 YES (db provides)</span></span><br><span class="line"><span class="string">D:  read h#      36 Header V3 RSA/SHA256 Signature, key ID f4a80eb5: NOKEY</span></span><br><span class="line"><span class="string">D:  Requires: libc.so.6(GLIBC_2.3)(64bit)                   YES (db provides)</span></span><br><span class="line"><span class="string">D:  read h#      36 Header V3 RSA/SHA256 Signature, key ID f4a80eb5: NOKEY</span></span><br><span class="line"><span class="string">D:  Requires: libc.so.6(GLIBC_2.3.4)(64bit)                 YES (db provides)</span></span><br><span class="line"><span class="string">D:  read h#      36 Header V3 RSA/SHA256 Signature, key ID f4a80eb5: NOKEY</span></span><br><span class="line"><span class="string">D:  Requires: libc.so.6(GLIBC_2.4)(64bit)                   YES (db provides)</span></span><br><span class="line"><span class="string">D:  read h#      36 Header V3 RSA/SHA256 Signature, key ID f4a80eb5: NOKEY</span></span><br><span class="line"><span class="string">D:  Requires: libc.so.6(GLIBC_2.8)(64bit)                   YES (db provides)</span></span><br><span class="line"><span class="string">D:  read h#      36 Header V3 RSA/SHA256 Signature, key ID f4a80eb5: NOKEY</span></span><br><span class="line"><span class="string">D:  Requires: libpthread.so.0()(64bit)                      YES (db provides)</span></span><br><span class="line"><span class="string">D:  read h#      36 Header V3 RSA/SHA256 Signature, key ID f4a80eb5: NOKEY</span></span><br><span class="line"><span class="string">D:  Requires: libpthread.so.0(GLIBC_2.2.5)(64bit)           YES (db provides)</span></span><br><span class="line"><span class="string">D:  Requires: rpmlib(CompressedFileNames) &lt;= 3.0.4-1        YES (rpmlib provides)</span></span><br><span class="line"><span class="string">D:  Requires: rpmlib(FileDigests) &lt;= 4.6.0-1                YES (rpmlib provides)</span></span><br><span class="line"><span class="string">D:  Requires: rpmlib(PayloadFilesHavePrefix) &lt;= 4.0-1       YES (rpmlib provides)</span></span><br><span class="line"><span class="string">D:  read h#      36 Header V3 RSA/SHA256 Signature, key ID f4a80eb5: NOKEY</span></span><br><span class="line"><span class="string">D:  Requires: rtld(GNU_HASH)                                YES (db provides)</span></span><br><span class="line"><span class="string">D:  read h#     344 Header V3 RSA/SHA256 Signature, key ID f4a80eb5: NOKEY</span></span><br><span class="line"><span class="string">D:  Requires: shadow-utils                                  YES (db provides)</span></span><br><span class="line"><span class="string">D:  read h#     365 Header V3 RSA/SHA256 Signature, key ID f4a80eb5: NOKEY</span></span><br><span class="line"><span class="string">D:  Requires: systemd                                       YES (db provides)</span></span><br><span class="line"><span class="string">D:  Requires: systemd                                       YES (cached)</span></span><br><span class="line"><span class="string">D:  Requires: systemd                                       YES (cached)</span></span><br><span class="line"><span class="string">D:  Requires: rpmlib(PayloadIsXz) &lt;= 5.2-1                  YES (rpmlib provides)</span></span><br><span class="line"><span class="string">D: opening  db index       /var/lib/rpm/Obsoletename 0x400 mode=0x0</span></span><br><span class="line"><span class="string">D: ========== recording tsort relations</span></span><br><span class="line"><span class="string">D: ========== tsorting packages (order, #predecessors, #succesors, depth)</span></span><br><span class="line"><span class="string">D:     0    0    0    1   +libcgroup-0.41-15.el7.x86_64</span></span><br><span class="line"><span class="string">D: installing binary packages</span></span><br><span class="line"><span class="string">D: Selinux disabled.</span></span><br><span class="line"><span class="string">D: closed   db index       /var/lib/rpm/Obsoletename</span></span><br><span class="line"><span class="string">D: closed   db index       /var/lib/rpm/Conflictname</span></span><br><span class="line"><span class="string">D: closed   db index       /var/lib/rpm/Providename</span></span><br><span class="line"><span class="string">D: closed   db index       /var/lib/rpm/Basenames</span></span><br><span class="line"><span class="string">D: closed   db index       /var/lib/rpm/Name</span></span><br><span class="line"><span class="string">D: closed   db index       /var/lib/rpm/Packages</span></span><br><span class="line"><span class="string">D: closed   db environment /var/lib/rpm</span></span><br><span class="line"><span class="string">D: opening  db environment /var/lib/rpm cdb:0x401</span></span><br><span class="line"><span class="string">D: opening  db index       /var/lib/rpm/Packages (none) mode=0x42</span></span><br><span class="line"><span class="string">D: sanity checking 1 elements</span></span><br><span class="line"><span class="string">D: opening  db index       /var/lib/rpm/Name (none) mode=0x42</span></span><br><span class="line"><span class="string">D: running pre-transaction scripts</span></span><br><span class="line"><span class="string">D: computing 5 file fingerprints</span></span><br><span class="line"><span class="string">D: opening  db index       /var/lib/rpm/Basenames (none) mode=0x42</span></span><br><span class="line"><span class="string">D: opening  db index       /var/lib/rpm/Group (none) mode=0x42</span></span><br><span class="line"><span class="string">D: opening  db index       /var/lib/rpm/Requirename (none) mode=0x42</span></span><br><span class="line"><span class="string">D: opening  db index       /var/lib/rpm/Providename (none) mode=0x42</span></span><br><span class="line"><span class="string">D: opening  db index       /var/lib/rpm/Conflictname (none) mode=0x42</span></span><br><span class="line"><span class="string">D: opening  db index       /var/lib/rpm/Obsoletename (none) mode=0x42</span></span><br><span class="line"><span class="string">D: opening  db index       /var/lib/rpm/Triggername (none) mode=0x42</span></span><br><span class="line"><span class="string">D: opening  db index       /var/lib/rpm/Dirnames (none) mode=0x42</span></span><br><span class="line"><span class="string">D: opening  db index       /var/lib/rpm/Installtid (none) mode=0x42</span></span><br><span class="line"><span class="string">D: opening  db index       /var/lib/rpm/Sigmd5 (none) mode=0x42</span></span><br><span class="line"><span class="string">D: opening  db index       /var/lib/rpm/Sha1header (none) mode=0x42</span></span><br><span class="line"><span class="string">Preparing...                          D: computing file dispositions</span></span><br><span class="line"><span class="string">D: 0x00000803     4096     72372888    146033401 /</span></span><br><span class="line"><span class="string">################################# [100%]</span></span><br><span class="line"><span class="string">D: ========== +++ libcgroup-0.41-15.el7 x86_64-linux 0x2</span></span><br><span class="line"><span class="string">D: Expected size:        66752 = lead(96)+sigs(1284)+pad(4)+data(65368)</span></span><br><span class="line"><span class="string">D:   Actual size:        66752</span></span><br><span class="line"><span class="string">D: libcgroup-0.41-15.el7.x86_64: Header V3 RSA/SHA256 Signature, key ID f4a80eb5: NOKEY</span></span><br><span class="line"><span class="string">D:   install: libcgroup-0.41-15.el7 has 5 files</span></span><br><span class="line"><span class="string">D: %pre(libcgroup-0.41-15.el7.x86_64): scriptlet start</span></span><br><span class="line"><span class="string">D: %pre(libcgroup-0.41-15.el7.x86_64): execv(/bin/sh) pid 43192</span></span><br><span class="line"><span class="string">+ getent group cgred</span></span><br><span class="line"><span class="string">+ groupadd -r cgred</span></span><br><span class="line"><span class="string">groupadd: cannot open /etc/group</span></span><br><span class="line"><span class="string">D: %pre(libcgroup-0.41-15.el7.x86_64): waitpid(43192) rc 43192 status a00</span></span><br><span class="line"><span class="string">error: %pre(libcgroup-0.41-15.el7.x86_64) scriptlet failed, exit status 10</span></span><br><span class="line"><span class="string">error: libcgroup-0.41-15.el7.x86_64: install failed</span></span><br><span class="line"><span class="string">D: running post-transaction scripts</span></span><br><span class="line"><span class="string">D: closed   db index       /var/lib/rpm/Sha1header</span></span><br><span class="line"><span class="string">D: closed   db index       /var/lib/rpm/Sigmd5</span></span><br><span class="line"><span class="string">D: closed   db index       /var/lib/rpm/Installtid</span></span><br><span class="line"><span class="string">D: closed   db index       /var/lib/rpm/Dirnames</span></span><br><span class="line"><span class="string">D: closed   db index       /var/lib/rpm/Triggername</span></span><br><span class="line"><span class="string">D: closed   db index       /var/lib/rpm/Obsoletename</span></span><br><span class="line"><span class="string">D: closed   db index       /var/lib/rpm/Conflictname</span></span><br><span class="line"><span class="string">D: closed   db index       /var/lib/rpm/Providename</span></span><br><span class="line"><span class="string">D: closed   db index       /var/lib/rpm/Requirename</span></span><br><span class="line"><span class="string">D: closed   db index       /var/lib/rpm/Group</span></span><br><span class="line"><span class="string">D: closed   db index       /var/lib/rpm/Basenames</span></span><br><span class="line"><span class="string">D: closed   db index       /var/lib/rpm/Name</span></span><br><span class="line"><span class="string">D: closed   db index       /var/lib/rpm/Packages</span></span><br><span class="line"><span class="string">D: closed   db environment /var/lib/rpm</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°, åœ¨å®‰è£…çš„è¿‡ç¨‹ä¸­, æ˜¯æ‰§è¡Œäº†<code>groupadd -r cgred</code>å¯¼è‡´çš„æŠ¥é”™</p>
<p>æ‰‹åŠ¨æ‰§è¡Œ <code>groupadd -r cgred</code>, ä¾ç„¶æŠ¥é”™ <code>groupadd: cannot open /etc/group</code></p>
<p>æŸ¥çœ‹æ–‡ä»¶å±æ€§</p>
<p>lsattr /etc/group<br>â€”-iâ€”â€”â€”â€“ /etc/group</p>
<p>åŸæ¥æ˜¯æœ‰ç‰¹æ®Šæƒé™, ä¿®æ”¹ä»–</p>
<p>chattr -i /etc/group</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>yum</tag>
        <tag>getent</tag>
        <tag>rpm</tag>
      </tags>
  </entry>
  <entry>
    <title>k8sè¯ä¹¦çš„KeyUsageé—®é¢˜</title>
    <url>/2018/11/01/k8s%E8%AF%81%E4%B9%A6%E7%9A%84KeyUsage%E9%97%AE%E9%A2%98/</url>
    <content><![CDATA[<p>å®˜æ–¹æ–‡æ¡£ä¸­, å¯¹ k8s çš„è¯ä¹¦åˆ¶ä½œæä¾›äº†ä¸‰ç§æ–¹å¼, ä¸»æµä½¿ç”¨æœ‰ä¸¤ç§</p>
<ul>
<li>openssl</li>
<li>cfssl</li>
</ul>
<p>å…·ä½“è¯ä¹¦åˆ¶ä½œæ­¥éª¤åœ¨æ­¤å°±ä¸è¯¦ç»†è¯´æ˜, é‡ç‚¹æ³¨æ„å‚è€ƒå®˜æ–¹æ–‡æ¡£, ä½¿ç”¨ openssl æ–¹å¼åˆ¶ä½œè¯ä¹¦æ—¶éœ€è¦æ³¨æ„çš„äº‹é¡¹</p>
<p>å®˜æ–¹æ–‡æ¡£ä¸­, ä½¿ç”¨ OpenSSL åˆ¶ä½œè¯ä¹¦, åœ¨ KeyUsage çš„è®¾ç½®ä¸Š, æŒ‡å®šäº†å¦‚ä¸‹åŠŸèƒ½:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">keyUsage&#x3D;keyEncipherment,dataEncipherment</span><br></pre></td></tr></table></figure>

<p>åœ¨åˆ¶ä½œå®Œ crt è¯ä¹¦å, ä½¿ç”¨ <code>openssl x509 -in /path/to/xxx.crt -text -noout</code> å‘½ä»¤æŸ¥çœ‹è¯ä¹¦ä¿¡æ¯:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">X509v3 Key Usage:</span><br><span class="line">    Key Encipherment, Data Encipherment</span><br></pre></td></tr></table></figure>

<p>æ²¡æ¯›ç—…, å°±æ˜¯ä¹‹å‰æŒ‡å®šçš„ä¸¤ä¸ªåŠŸèƒ½, ä¸€ä¸ªä¸å¤šä¸€ä¸ªä¸å°‘, ä½†é—®é¢˜ä¹Ÿå‡ºç°åœ¨è¿™é‡Œ. </p>
<p>åœ¨å®é™…ä½¿ç”¨ä¸­, ä½¿ç”¨ä»…å¸¦æœ‰<code>keyUsage=keyEncipherment,dataEncipherment</code>è¿™ä¸¤ä¸ªåŠŸèƒ½çš„è¯ä¹¦å¼•å¯¼é›†ç¾¤, å¹¶æ²¡æœ‰å‡ºç°ä»€ä¹ˆé—®é¢˜, ä½†æ˜¯åœ¨ä½¿ç”¨ Java å®¢æˆ·ç«¯è®¿é—® apiserver æ—¶, å´æŠ¥ä»¥ä¸‹é”™è¯¯:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">io.kubernetes.client.ApiException: javax.net.ssl.SSLHandshakeException: sun.security.validator.ValidatorException: KeyUsage does not allow digital signatures</span><br></pre></td></tr></table></figure>

<p>æŠ¥é”™ä¿¡æ¯å¾ˆæ˜ç¡®, è¯ä¹¦æ²¡æœ‰æä¾›<code>digital signatures</code>çš„åŠŸèƒ½. æŸ¥è¯¢å¦ä¸€ç¯‡è¯ä¹¦è¯´æ˜æ–‡æ¡£(<a href="https://kubernetes.io/docs/setup/certificates/" target="_blank" rel="noopener">https://kubernetes.io/docs/setup/certificates/</a>) é‡Œé¢è¯´çš„å¾ˆæ¸…æ¥š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">kind	Key usage</span><br><span class="line">server	digital signature, key encipherment, server auth</span><br><span class="line">client	digital signature, key encipherment, client auth</span><br></pre></td></tr></table></figure>

<p>ä¸ç®¡æ˜¯æœåŠ¡ç«¯è¯ä¹¦è¿˜æ˜¯å®¢æˆ·ç«¯è¯ä¹¦, éƒ½è‡³å°‘éœ€è¦æä¾›<code>digital signature, key encipherment</code>è¿™ä¸¤ä¸ªåŠŸèƒ½, ä½†æ˜¯åˆ¶ä½œè¯ä¹¦çš„å®˜æ–¹æ–‡æ¡£ä¸­, openssl æ–¹å¼åˆ›å»ºçš„è¯ä¹¦, å´æ²¡æœ‰æ˜¾å¼æŒ‡å®š <code>digital signatures</code> åŠŸèƒ½. åœ¨åæœŸçš„åˆ¶ä½œä¸­, openssl ä¹Ÿæ²¡æœ‰é»˜è®¤ç»™æˆ‘ä»¬åŠ å…¥æ­¤åŠŸèƒ½, ç»“æœå¯¼è‡´ java å®¢æˆ·ç«¯æ— æ³•å®Œæˆ ssl è®¤è¯.</p>
<p>ä½†æ˜¯å®˜æ–¹æ–‡æ¡£ä¸­, ä½¿ç”¨ cfssl å·¥å…·ä¹Ÿæ²¡æœ‰æ˜¾ç¤ºæŒ‡å®šåŠ å…¥ <code>digital signatures</code> åŠŸèƒ½, ä½†æ˜¯åˆ¶ä½œè¯ä¹¦æ—¶, é»˜è®¤ä¸ºæˆ‘ä»¬åŠ å…¥äº†è¯¥åŠŸèƒ½. å°±å†²è¿™ç‚¹, ä¹Ÿå¼ºçƒˆå»ºè®®ä½¿ç”¨ cfssl å·¥å…·åˆ¶ä½œè¯ä¹¦ğŸ˜†</p>
<p>è§£å†³æ–¹æ³•: </p>
<ul>
<li>ä½¿ç”¨ openssl ç­¾å‘è¯ä¹¦çš„è¯, å°† <code>keyUsage=keyEncipherment,dataEncipherment</code> ä¿®æ”¹ä¸ºâ€“&gt; <code>keyUsage=digitalSignature,keyEncipherment,dataEncipherment</code> å³å¯</li>
<li>ä½¿ç”¨ cfssl ç­¾å‘è¯ä¹¦, é»˜è®¤å°±ä¼šåŠ å…¥<code>digitalSignature</code>åŠŸèƒ½</li>
</ul>
<p>è§£å†³æ–¹æ¡ˆ:<br>   æ–¹æ¡ˆä¸€: é‡æ–°åˆ¶ä½œæ‰€æœ‰è¯ä¹¦, åŠ å…¥<code>digital signatures</code>åŠŸèƒ½, å¹¶ä¸ºé›†ç¾¤æ›´æ¢è¯ä¹¦<br>   æ–¹æ¡ˆäºŒ: é‡æ–°åˆ¶ä½œ apiserver æœåŠ¡ç«¯è¯ä¹¦å’Œ java å®¢æˆ·ç«¯ä½¿ç”¨çš„å®¢æˆ·ç«¯è¯ä¹¦, åŠ å…¥<code>digital signatures</code>åŠŸèƒ½, æ›¿æ¢æ‰€æœ‰ apiserver å’Œ java ä½¿ç”¨çš„è¯ä¹¦, å³å¯å®Œæˆæœ€å°ä»£ä»·çš„æ›¿æ¢</p>
<p>é™„å½•:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">KeyUsage ::&#x3D; BIT STRING &#123;</span><br><span class="line">          digitalSignature        (0),</span><br><span class="line">          nonRepudiation          (1), -- recent editions of X.509 have</span><br><span class="line">                               -- renamed this bit to contentCommitment</span><br><span class="line">          keyEncipherment         (2),</span><br><span class="line">          dataEncipherment        (3),</span><br><span class="line">          keyAgreement            (4),</span><br><span class="line">          keyCertSign             (5),</span><br><span class="line">          cRLSign                 (6),</span><br><span class="line">          encipherOnly            (7),</span><br><span class="line">          decipherOnly            (8) &#125;</span><br><span class="line"></span><br><span class="line">  Bits in the KeyUsage type are used as follows:</span><br><span class="line"></span><br><span class="line">     The digitalSignature bit is asserted when the subject public key</span><br><span class="line">     is used for verifying digital signatures, other than signatures on</span><br><span class="line">     certificates (bit 5) and CRLs (bit 6), such as those used in an</span><br><span class="line">     entity authentication service, a data origin authentication</span><br><span class="line">     service, and&#x2F;or an integrity service.</span><br></pre></td></tr></table></figure>

<p>å‚è€ƒæ–‡æ¡£:</p>
<p>k8sè¯ä¹¦åˆ¶ä½œæ–‡æ¡£</p>
<ul>
<li>ä¸­æ–‡æ–‡æ¡£: <a href="https://k8smeetup.github.io/docs/concepts/cluster-administration/certificates/#openssl" target="_blank" rel="noopener">https://k8smeetup.github.io/docs/concepts/cluster-administration/certificates/#openssl</a></li>
<li>è‹±æ–‡æ–‡æ¡£: <a href="https://kubernetes.io/docs/concepts/cluster-administration/certificates/" target="_blank" rel="noopener">https://kubernetes.io/docs/concepts/cluster-administration/certificates/</a></li>
</ul>
<p>k8sè¯ä¹¦ä½¿ç”¨è¯´æ˜æ–‡æ¡£</p>
<ul>
<li><a href="https://kubernetes.io/docs/setup/certificates/" target="_blank" rel="noopener">https://kubernetes.io/docs/setup/certificates/</a></li>
</ul>
<p>KeyUsage æ–‡æ¡£:</p>
<ul>
<li><a href="https://tools.ietf.org/html/rfc5280#section-4.2.1.3" target="_blank" rel="noopener">https://tools.ietf.org/html/rfc5280#section-4.2.1.3</a></li>
</ul>
]]></content>
      <categories>
        <category>Kubernetes</category>
      </categories>
      <tags>
        <tag>ssl</tag>
        <tag>ca</tag>
        <tag>kubernetes</tag>
        <tag>KeyUsage</tag>
        <tag>k8s</tag>
        <tag>digital</tag>
      </tags>
  </entry>
  <entry>
    <title>DHCPæ¨¡å¼ä¸‹çš„k8sæ’é”™</title>
    <url>/2018/11/01/DHCP%E6%A8%A1%E5%BC%8F%E4%B8%8B%E7%9A%84k8s%E6%8E%92%E9%94%99/</url>
    <content><![CDATA[<p>ç¯å¢ƒ: </p>
<ul>
<li>Kubernetes</li>
<li>Bridge+DHCP</li>
</ul>
<p>kubelet æ—¥å¿—å¦‚ä¸‹:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Oct 10 16:52:58 k8node3 kubelet[38221]: E1010 16:52:58.848278   38221 kuberuntime_sandbox.go:54] CreatePodSandbox for pod &quot;log-pilot-msvj7_default(88d40907-cc60-11e8-9598-ecebb88a11d4)&quot; failed: rpc error: code &#x3D; Unknown desc &#x3D; NetworkPlugin cni failed to set up pod &quot;log-pilot-msvj7_default&quot; network: error calling DHCP.Allocate: no more tries</span><br><span class="line">Oct 10 16:52:58 k8node3 kubelet[38221]: E1010 16:52:58.848293   38221 kuberuntime_manager.go:646] createPodSandbox for pod &quot;log-pilot-msvj7_default(88d40907-cc60-11e8-9598-ecebb88a11d4)&quot; failed: rpc error: code &#x3D; Unknown desc &#x3D; NetworkPlugin cni failed to set up pod &quot;log-pilot-msvj7_default&quot; network: error calling DHCP.Allocate: no more tries</span><br><span class="line">Oct 10 16:52:58 k8node3 kubelet[38221]: E1010 16:52:58.848349   38221 pod_workers.go:186] Error syncing pod 88d40907-cc60-11e8-9598-ecebb88a11d4 (&quot;log-pilot-msvj7_default(88d40907-cc60-11e8-9598-ecebb88a11d4)&quot;), skipping: failed to &quot;CreatePodSandbox&quot; for &quot;log-pilot-msvj7_default(88d40907-cc60-11e8-9598-ecebb88a11d4)&quot; with CreatePodSandboxError: &quot;CreatePodSandbox for pod \&quot;log-pilot-msvj7_default(88d40907-cc60-11e8-9598-ecebb88a11d4)\&quot; failed: rpc error: code &#x3D; Unknown desc &#x3D; NetworkPlugin cni failed to set up pod \&quot;log-pilot-msvj7_default\&quot; network: error calling DHCP.Allocate: no more tries&quot;</span><br><span class="line">Oct 10 16:53:43 k8node3 kubelet[38221]: E1010 16:53:43.433003   38221 cni.go:259] Error adding network: error calling DHCP.Allocate: no more tries</span><br><span class="line">Oct 10 16:53:43 k8node3 kubelet[38221]: E1010 16:53:43.433036   38221 cni.go:227] Error while adding to cni network: error calling DHCP.Allocate: no more tries</span><br><span class="line">Oct 10 16:53:43 k8node3 kubelet[38221]: E1010 16:53:43.505258   38221 remote_runtime.go:92] RunPodSandbox from runtime service failed: rpc error: code &#x3D; Unknown desc &#x3D; NetworkPlugin cni failed to set up pod &quot;log-pilot-msvj7_default&quot; network: error calling DHCP.Allocate: no more tries</span><br><span class="line">Oct 10 16:53:43 k8node3 kubelet[38221]: E1010 16:53:43.505313   38221 kuberuntime_sandbox.go:54] CreatePodSandbox for pod &quot;log-pilot-msvj7_default(88d40907-cc60-11e8-9598-ecebb88a11d4)&quot; failed: rpc error: code &#x3D; Unknown desc &#x3D; NetworkPlugin cni failed to set up pod &quot;log-pilot-msvj7_default&quot; network: error calling DHCP.Allocate: no more tries</span><br><span class="line">Oct 10 16:53:43 k8node3 kubelet[38221]: E1010 16:53:43.505327   38221 kuberuntime_manager.go:646] createPodSandbox for pod &quot;log-pilot-msvj7_default(88d40907-cc60-11e8-9598-ecebb88a11d4)&quot; failed: rpc error: code &#x3D; Unknown desc &#x3D; NetworkPlugin cni failed to set up pod &quot;log-pilot-msvj7_default&quot; network: error calling DHCP.Allocate: no more tries</span><br><span class="line">Oct 10 16:53:43 k8node3 kubelet[38221]: E1010 16:53:43.505388   38221 pod_workers.go:186] Error syncing pod 88d40907-cc60-11e8-9598-ecebb88a11d4 (&quot;log-pilot-msvj7_default(88d40907-cc60-11e8-9598-ecebb88a11d4)&quot;), skipping: failed to &quot;CreatePodSandbox&quot; for &quot;log-pilot-msvj7_default(88d40907-cc60-11e8-9598-ecebb88a11d4)&quot; with CreatePodSandboxError: &quot;CreatePodSandbox for pod \&quot;log-pilot-msvj7_default(88d40907-cc60-11e8-9598-ecebb88a11d4)\&quot; failed: rpc error: code &#x3D; Unknown desc &#x3D; NetworkPlugin cni failed to set up pod \&quot;log-pilot-msvj7_default\&quot; network: error calling DHCP.Allocate: no more tries&quot;</span><br><span class="line">Oct 10 16:54:29 k8node3 kubelet[38221]: E1010 16:54:29.112837   38221 cni.go:259] Error adding network: error calling DHCP.Allocate: no more tries</span><br><span class="line">Oct 10 16:54:29 k8node3 kubelet[38221]: E1010 16:54:29.112865   38221 cni.go:227] Error while adding to cni network: error calling DHCP.Allocate: no more tries</span><br><span class="line">Oct 10 16:54:29 k8node3 kubelet[38221]: E1010 16:54:29.190742   38221 remote_runtime.go:92] RunPodSandbox from runtime service failed: rpc error: code &#x3D; Unknown desc &#x3D; NetworkPlugin cni failed to set up pod &quot;log-pilot-msvj7_default&quot; network: error calling DHCP.Allocate: no more tries</span><br><span class="line">Oct 10 16:54:29 k8node3 kubelet[38221]: E1010 16:54:29.190800   38221 kuberuntime_sandbox.go:54] CreatePodSandbox for pod &quot;log-pilot-msvj7_default(88d40907-cc60-11e8-9598-ecebb88a11d4)&quot; failed: rpc error: code &#x3D; Unknown desc &#x3D; NetworkPlugin cni failed to set up pod &quot;log-pilot-msvj7_default&quot; network: error calling DHCP.Allocate: no more tries</span><br><span class="line">Oct 10 16:54:29 k8node3 kubelet[38221]: E1010 16:54:29.190815   38221 kuberuntime_manager.go:646] createPodSandbox for pod &quot;log-pilot-msvj7_default(88d40907-cc60-11e8-9598-ecebb88a11d4)&quot; failed: rpc error: code &#x3D; Unknown desc &#x3D; NetworkPlugin cni failed to set up pod &quot;log-pilot-msvj7_default&quot; network: error calling DHCP.Allocate: no more tries</span><br><span class="line">Oct 10 16:54:29 k8node3 kubelet[38221]: E1010 16:54:29.190899   38221 pod_workers.go:186] Error syncing pod 88d40907-cc60-11e8-9598-ecebb88a11d4 (&quot;log-pilot-msvj7_default(88d40907-cc60-11e8-9598-ecebb88a11d4)&quot;), skipping: failed to &quot;CreatePodSandbox&quot; for &quot;log-pilot-msvj7_default(88d40907-cc60-11e8-9598-ecebb88a11d4)&quot; with CreatePodSandboxError: &quot;CreatePodSandbox for pod \&quot;log-pilot-msvj7_default(88d40907-cc60-11e8-9598-ecebb88a11d4)\&quot; failed: rpc error: code &#x3D; Unknown desc &#x3D; NetworkPlugin cni failed to set up pod \&quot;log-pilot-msvj7_default\&quot; network: error calling DHCP.Allocate: no more tries&quot;</span><br><span class="line">Oct 10 16:55:13 k8node3 kubelet[38221]: E1010 16:55:13.604965   38221 cni.go:259] Error adding network: error calling DHCP.Allocate: no more tries</span><br><span class="line">Oct 10 16:55:13 k8node3 kubelet[38221]: E1010 16:55:13.605013   38221 cni.go:227] Error while adding to cni network: error calling DHCP.Allocate: no more tries</span><br><span class="line">Oct 10 16:55:13 k8node3 kubelet[38221]: E1010 16:55:13.692412   38221 remote_runtime.go:92] RunPodSandbox from runtime service failed: rpc error: code &#x3D; Unknown desc &#x3D; NetworkPlugin cni failed to set up pod &quot;log-pilot-msvj7_default&quot; network: error calling DHCP.Allocate: no more tries</span><br></pre></td></tr></table></figure>

<p>cni æ’ä»¶æ—¥å¿—å¦‚ä¸‹:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">2018&#x2F;10&#x2F;10 16:55:15 d61d6dd5cbda1c51769489334a566a1c4ca6f258efee60375aaf2e71bc116c32&#x2F;zzcloudnet: acquiring lease</span><br><span class="line">2018&#x2F;10&#x2F;10 16:55:20 resource temporarily unavailable</span><br><span class="line">2018&#x2F;10&#x2F;10 16:55:29 resource temporarily unavailable</span><br><span class="line">2018&#x2F;10&#x2F;10 16:55:43 resource temporarily unavailable</span><br><span class="line">2018&#x2F;10&#x2F;10 16:56:00 bb55ff4ecac38220cbe88d0e34c7bc4296c6faf181fb24499694f9c76881e02c&#x2F;zzcloudnet: acquiring lease</span><br><span class="line">2018&#x2F;10&#x2F;10 16:56:05 resource temporarily unavailable</span><br><span class="line">2018&#x2F;10&#x2F;10 16:56:15 resource temporarily unavailable</span><br><span class="line">2018&#x2F;10&#x2F;10 16:56:28 resource temporarily unavailable</span><br><span class="line">2018&#x2F;10&#x2F;10 16:56:45 07c373e24b35ec12d66f991b32a206217288ba018648071cea4f87fc9e055658&#x2F;zzcloudnet: acquiring lease</span><br><span class="line">2018&#x2F;10&#x2F;10 16:56:50 resource temporarily unavailable</span><br><span class="line">2018&#x2F;10&#x2F;10 16:57:00 resource temporarily unavailable</span><br><span class="line">2018&#x2F;10&#x2F;10 16:57:12 resource temporarily unavailable</span><br><span class="line">2018&#x2F;10&#x2F;10 16:57:30 c3d52c2c4ea0db096b079da202ba0733b91e9c68d3b2db7ba6dc4d67c71e6546&#x2F;zzcloudnet: acquiring lease</span><br><span class="line">2018&#x2F;10&#x2F;10 16:57:35 resource temporarily unavailable</span><br><span class="line">2018&#x2F;10&#x2F;10 16:57:44 resource temporarily unavailable</span><br></pre></td></tr></table></figure>

<p>DHCP æœåŠ¡ç«¯æŠ“åŒ… <code>tcpdump -n -i cni0</code> å‘ç°, æœåŠ¡ç«¯æ¥æ”¶åˆ°äº†å®¢æˆ·ç«¯çš„ <code>DISCOVER</code>, å¹¶ä¸”æœåŠ¡ç«¯ç»™äº† <code>OFFER</code>, ä½†å´è¿Ÿè¿Ÿæ”¶ä¸åˆ°å®¢æˆ·ç«¯å‘æ¥çš„ <code>REQUEST</code>, ç”±æ­¤å¯ä»¥å®šä½åˆ°é—®é¢˜, è¦ä¹ˆåŒ…åœ¨æœåŠ¡ç«¯å‘ä¸å‡ºå», è¦ä¹ˆæ˜¯å®¢æˆ·ç«¯æ”¶ä¸ç€, ç€é‡æ£€æŸ¥ä¸¤è€…ä¹‹é—´çš„é˜²ç«å¢™è®¾ç½®ä»¥åŠç½‘ç»œè¿é€šæ€§.</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>DHCP</tag>
        <tag>tcpdump</tag>
      </tags>
  </entry>
  <entry>
    <title>Kubernetesä¸­å†…å­˜èµ„æºé™åˆ¶å¼•å‘çš„æŠ¥é”™</title>
    <url>/2018/11/01/Kubernetes%E4%B8%AD%E5%86%85%E5%AD%98%E8%B5%84%E6%BA%90%E9%99%90%E5%88%B6%E5%BC%95%E5%8F%91%E7%9A%84%E6%8A%A5%E9%94%99/</url>
    <content><![CDATA[<p>ä¸€ä¸ª Pod è¢«åˆ›å»ºå, ä¸€ç›´å¡åœ¨<code>ContainerCreating</code>çš„çŠ¶æ€, æ‰§è¡Œ<code>describe</code>å‘½ä»¤æŸ¥çœ‹è¯¥ Pod è¯¦ç»†ä¿¡æ¯åå‘ç°å¦‚ä¸‹ Event</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Events:</span><br><span class="line">  Type     Reason                  Age               From                            Message</span><br><span class="line">  ----     ------                  ----              ----                            -------</span><br><span class="line">  Normal   Scheduled               2m                default-scheduler               Successfully assigned 61f983b5-19ca-4b33-8647-6b279ae93812 to k8node3</span><br><span class="line">  Normal   SuccessfulMountVolume   2m                kubelet, k8node3  MountVolume.SetUp succeeded for volume &quot;default-token-7r9jt&quot;</span><br><span class="line">  Warning  FailedCreatePodSandBox  2m (x12 over 2m)  kubelet, k8node3  Failed create pod sandbox: rpc error: code &#x3D; Unknown desc &#x3D; failed to start sandbox container for pod &quot;61f983b5-19ca-4b33-8647-6b279ae93812&quot;: Error response from daemon: oci runtime error: container_linux.go:247: starting container process caused &quot;process_linux.go:286: decoding sync type from init pipe caused \&quot;read parent: connection reset by peer\&quot;&quot;</span><br><span class="line">  Normal   SandboxChanged          2m (x12 over 2m)  kubelet, k8node3  Pod sandbox changed, it will be killed and re-created.</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Š Event ä¿¡æ¯ä¸­, èƒ½è§£è¯»åˆ°çš„ä¿¡æ¯æå…¶æœ‰é™</p>
<ul>
<li>Failed create pod sandbox: Google æä¾›çš„ pause å®¹å™¨å¯åŠ¨å¤±è´¥</li>
<li>oci runtime error: è¿è¡Œæ—¶æ¥å£å‡ºçš„é—®é¢˜, æˆ‘çš„ç¯å¢ƒä¸­è¿è¡Œæ—¶ç¯å¢ƒä¸º docker</li>
<li>connection reset by peer: è¿æ¥è¢«é‡ç½®</li>
<li>Pod sandbox changed, it will be killed and re-created: pause å®¹å™¨å¼•å¯¼çš„ Pod ç¯å¢ƒè¢«æ”¹å˜, é‡æ–°åˆ›å»º Pod ä¸­çš„ pause å¼•å¯¼</li>
</ul>
<p>çœ‹å®Œä¸Šé¢çš„æŠ¥é”™ä¿¡æ¯å¹¶ä¸èƒ½å‡†ç¡®å®šä½åˆ°é—®é¢˜çš„æ ¹æº, åªèƒ½å¤§è‡´äº†è§£åˆ°æ˜¯å› ä¸ºåˆ›å»ºSandBoxå¤±è´¥å¯¼è‡´çš„, æ¥ä¸‹æ¥æŸ¥çœ‹ kubelet çš„æ—¥å¿—</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Oct 31 16:33:57 k8node3 kubelet[1865]: E1031 16:33:57.551282    1865 remote_runtime.go:92] RunPodSandbox from runtime service failed: rpc error: code &#x3D; Unknown desc &#x3D; failed to start sandbox container for pod &quot;61f983b5-19ca-4b33-8647-6b279ae93812&quot;: Error response from daemon: oci runtime error: container_linux.go:247: starting container process caused &quot;process_linux.go:286: decoding sync type from init pipe caused \&quot;read parent: connection reset by peer\&quot;&quot;</span><br><span class="line">Oct 31 16:33:57 k8node3 kubelet[1865]: E1031 16:33:57.551415    1865 kuberuntime_sandbox.go:54] CreatePodSandbox for pod &quot;61f983b5-19ca-4b33-8647-6b279ae93812_default(77b2b948-dce4-11e8-afec-b82a72cf3061)&quot; failed: rpc error: code &#x3D; Unknown desc &#x3D; failed to start sandbox container for pod &quot;61f983b5-19ca-4b33-8647-6b279ae93812&quot;: Error response from daemon: oci runtime error: container_linux.go:247: starting container process caused &quot;process_linux.go:286: decoding sync type from init pipe caused \&quot;read parent: connection reset by peer\&quot;&quot;</span><br><span class="line">Oct 31 16:33:57 k8node3 kubelet[1865]: E1031 16:33:57.551459    1865 kuberuntime_manager.go:646] createPodSandbox for pod &quot;61f983b5-19ca-4b33-8647-6b279ae93812_default(77b2b948-dce4-11e8-afec-b82a72cf3061)&quot; failed: rpc error: code &#x3D; Unknown desc &#x3D; failed to start sandbox container for pod &quot;61f983b5-19ca-4b33-8647-6b279ae93812&quot;: Error response from daemon: oci runtime error: container_linux.go:247: starting container process caused &quot;process_linux.go:286: decoding sync type from init pipe caused \&quot;read parent: connection reset by peer\&quot;&quot;</span><br><span class="line">Oct 31 16:33:57 k8node3 kubelet[1865]: E1031 16:33:57.551581    1865 pod_workers.go:186] Error syncing pod 77b2b948-dce4-11e8-afec-b82a72cf3061 (&quot;61f983b5-19ca-4b33-8647-6b279ae93812_default(77b2b948-dce4-11e8-afec-b82a72cf3061)&quot;), skipping: failed to &quot;CreatePodSandbox&quot; for &quot;61f983b5-19ca-4b33-8647-6b279ae93812_default(77b2b948-dce4-11e8-afec-b82a72cf3061)&quot; with CreatePodSandboxError: &quot;CreatePodSandbox for pod \&quot;61f983b5-19ca-4b33-8647-6b279ae93812_default(77b2b948-dce4-11e8-afec-b82a72cf3061)\&quot; failed: rpc error: code &#x3D; Unknown desc &#x3D; failed to start sandbox container for pod \&quot;61f983b5-19ca-4b33-8647-6b279ae93812\&quot;: Error response from daemon: oci runtime error: container_linux.go:247: starting container process caused \&quot;process_linux.go:286: decoding sync type from init pipe caused \\\&quot;read parent: connection reset by peer\\\&quot;\&quot;&quot;</span><br><span class="line">Oct 31 16:33:58 k8node3 kubelet[1865]: E1031 16:33:58.718255    1865 remote_runtime.go:92] RunPodSandbox from runtime service failed: rpc error: code &#x3D; Unknown desc &#x3D; failed to start sandbox container for pod &quot;61f983b5-19ca-4b33-8647-6b279ae93812&quot;: Error response from daemon: oci runtime error: container_linux.go:247: starting container process caused &quot;process_linux.go:286: decoding sync type from init pipe caused \&quot;read parent: connection reset by peer\&quot;&quot;</span><br><span class="line">Oct 31 16:33:58 k8node3 kubelet[1865]: E1031 16:33:58.718406    1865 kuberuntime_sandbox.go:54] CreatePodSandbox for pod &quot;61f983b5-19ca-4b33-8647-6b279ae93812_default(77b2b948-dce4-11e8-afec-b82a72cf3061)&quot; failed: rpc error: code &#x3D; Unknown desc &#x3D; failed to start sandbox container for pod &quot;61f983b5-19ca-4b33-8647-6b279ae93812&quot;: Error response from daemon: oci runtime error: container_linux.go:247: starting container process caused &quot;process_linux.go:286: decoding sync type from init pipe caused \&quot;read parent: connection reset by peer\&quot;&quot;</span><br><span class="line">Oct 31 16:33:58 k8node3 kubelet[1865]: E1031 16:33:58.718443    1865 kuberuntime_manager.go:646] createPodSandbox for pod &quot;61f983b5-19ca-4b33-8647-6b279ae93812_default(77b2b948-dce4-11e8-afec-b82a72cf3061)&quot; failed: rpc error: code &#x3D; Unknown desc &#x3D; failed to start sandbox container for pod &quot;61f983b5-19ca-4b33-8647-6b279ae93812&quot;: Error response from daemon: oci runtime error: container_linux.go:247: starting container process caused &quot;process_linux.go:286: decoding sync type from init pipe caused \&quot;read parent: connection reset by peer\&quot;&quot;</span><br><span class="line">Oct 31 16:33:58 k8node3 kubelet[1865]: E1031 16:33:58.718597    1865 pod_workers.go:186] Error syncing pod 77b2b948-dce4-11e8-afec-b82a72cf3061 (&quot;61f983b5-19ca-4b33-8647-6b279ae93812_default(77b2b948-dce4-11e8-afec-b82a72cf3061)&quot;), skipping: failed to &quot;CreatePodSandbox&quot; for &quot;61f983b5-19ca-4b33-8647-6b279ae93812_default(77b2b948-dce4-11e8-afec-b82a72cf3061)&quot; with CreatePodSandboxError: &quot;CreatePodSandbox for pod \&quot;61f983b5-19ca-4b33-8647-6b279ae93812_default(77b2b948-dce4-11e8-afec-b82a72cf3061)\&quot; failed: rpc error: code &#x3D; Unknown desc &#x3D; failed to start sandbox container for pod \&quot;61f983b5-19ca-4b33-8647-6b279ae93812\&quot;: Error response from daemon: oci runtime error: container_linux.go:247: starting container process caused \&quot;process_linux.go:286: decoding sync type from init pipe caused \\\&quot;read parent: connection reset by peer\\\&quot;\&quot;&quot;</span><br><span class="line">Oct 31 16:36:02 k8node3 kubelet[1865]: E1031 16:36:02.114171    1865 kubelet.go:1644] Unable to mount volumes for pod &quot;61f983b5-19ca-4b33-8647-6b279ae93812_default(77b2b948-dce4-11e8-afec-b82a72cf3061)&quot;: timeout expired waiting for volumes to attach or mount for pod &quot;default&quot;&#x2F;&quot;61f983b5-19ca-4b33-8647-6b279ae93812&quot;. list of unmounted volumes&#x3D;[default-token-7r9jt]. list of unattached volumes&#x3D;[default-token-7r9jt]; skipping pod</span><br><span class="line">Oct 31 16:36:02 k8node3 kubelet[1865]: E1031 16:36:02.114262    1865 pod_workers.go:186] Error syncing pod 77b2b948-dce4-11e8-afec-b82a72cf3061 (&quot;61f983b5-19ca-4b33-8647-6b279ae93812_default(77b2b948-dce4-11e8-afec-b82a72cf3061)&quot;), skipping: timeout expired waiting for volumes to attach or mount for pod &quot;default&quot;&#x2F;&quot;61f983b5-19ca-4b33-8647-6b279ae93812&quot;. list of unmounted volumes&#x3D;[default-token-7r9jt]. list of unattached volumes&#x3D;[default-token-7r9jt]</span><br></pre></td></tr></table></figure>

<p>kubelet çš„æ—¥å¿—ä¸­, ä¸ describe å‡ºæ¥çš„ä¿¡æ¯å·®ä¸å¤š, tail çš„æ—¶å€™æ›´ç›´è§‚çš„æ„Ÿè§‰åˆ°é¢‘ç¹çš„Sandboxåˆ›å»ºçš„è¿‡ç¨‹, æ—¢ç„¶æ˜¯ OCI è¿è¡Œæ—¶æŠ¥é”™, åªèƒ½å» docker çš„æ—¥å¿—ä¸­æ‰¾æ‰¾çœ‹äº†</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Oct 31 16:33:58 k8node3 dockerd[1715]: time&#x3D;&quot;2018-10-31T16:33:58.671146675+08:00&quot; level&#x3D;error msg&#x3D;&quot;containerd: start container&quot; error&#x3D;&quot;oci runtime error: container_linux.go:247: starting container process caused \&quot;process_linux.go:286: decoding sync type from init pipe caused \\\&quot;read parent: connection reset by peer\\\&quot;\&quot;\n&quot; id&#x3D;029d9e843eedb822370c285b5abf1f37556461083d3bda2c7af38b3b00695b0f</span><br><span class="line">Oct 31 16:33:58 k8node3 dockerd[1715]: time&#x3D;&quot;2018-10-31T16:33:58.671871096+08:00&quot; level&#x3D;error msg&#x3D;&quot;Create container failed with error: oci runtime error: container_linux.go:247: starting container process caused \&quot;process_linux.go:286: decoding sync type from init pipe caused \\\&quot;read parent: connection reset by peer\\\&quot;\&quot;\n&quot;</span><br><span class="line">Oct 31 16:33:58 k8node3 dockerd[1715]: time&#x3D;&quot;2018-10-31T16:33:58.717553371+08:00&quot; level&#x3D;error msg&#x3D;&quot;Handler for POST &#x2F;v1.27&#x2F;containers&#x2F;029d9e843eedb822370c285b5abf1f37556461083d3bda2c7af38b3b00695b0f&#x2F;start returned error: oci runtime error: container_linux.go:247: starting container process caused \&quot;process_linux.go:286: decoding sync type from init pipe caused \\\&quot;read parent: connection reset by peer\\\&quot;\&quot;\n&quot;</span><br><span class="line">Oct 31 16:34:22 k8node3 dockerd[1715]: time&#x3D;&quot;2018-10-31T16:34:22.759631102+08:00&quot; level&#x3D;error msg&#x3D;&quot;Handler for POST &#x2F;v1.27&#x2F;containers&#x2F;207f0ffb4b5ecc5f8261af40cd7a2c4c2800a2c30b027c4fb95648f8c1b00274&#x2F;stop returned error: Container 207f0ffb4b5ecc5f8261af40cd7a2c4c2800a2c30b027c4fb95648f8c1b00274 is already stopped&quot;</span><br><span class="line">Oct 31 16:34:22 k8node3 dockerd[1715]: time&#x3D;&quot;2018-10-31T16:34:22.768603351+08:00&quot; level&#x3D;error msg&#x3D;&quot;Handler for POST &#x2F;v1.27&#x2F;containers&#x2F;03bf9bfcf4e3f66655b0124d6779ff649b2b00219b83645ca18b4bb08d1cc573&#x2F;stop returned error: Container 03bf9bfcf4e3f66655b0124d6779ff649b2b00219b83645ca18b4bb08d1cc573 is already stopped&quot;</span><br><span class="line">Oct 31 16:34:22 k8node3 dockerd[1715]: time&#x3D;&quot;2018-10-31T16:34:22.777073508+08:00&quot; level&#x3D;error msg&#x3D;&quot;Handler for POST &#x2F;v1.27&#x2F;containers&#x2F;7b37f5aee7afe01f209bcdc6b3568b522fb0bbda5cb4b322e10b05ec603f5728&#x2F;stop returned error: Container 7b37f5aee7afe01f209bcdc6b3568b522fb0bbda5cb4b322e10b05ec603f5728 is already stopped&quot;</span><br><span class="line">Oct 31 16:34:22 k8node3 dockerd[1715]: time&#x3D;&quot;2018-10-31T16:34:22.785774443+08:00&quot; level&#x3D;error msg&#x3D;&quot;Handler for POST &#x2F;v1.27&#x2F;containers&#x2F;1a01419973e4701b231556d74c619c30e0966889948e810b46567f08475ec431&#x2F;stop returned error: Container 1a01419973e4701b231556d74c619c30e0966889948e810b46567f08475ec431 is already stopped&quot;</span><br><span class="line">Oct 31 16:34:22 k8node3 dockerd[1715]: time&#x3D;&quot;2018-10-31T16:34:22.794198279+08:00&quot; level&#x3D;error msg&#x3D;&quot;Handler for POST &#x2F;v1.27&#x2F;containers&#x2F;c3c4049e7b1942395b3cc3a45cf0cc69b34bab6271cb940a70c7d9aed3ba6176&#x2F;stop returned error: Container c3c4049e7b1942395b3cc3a45cf0cc69b34bab6271cb940a70c7d9aed3ba6176 is already stopped&quot;</span><br><span class="line">Oct 31 16:34:22 k8node3 dockerd[1715]: time&#x3D;&quot;2018-10-31T16:34:22.802698120+08:00&quot; level&#x3D;error msg&#x3D;&quot;Handler for POST &#x2F;v1.27&#x2F;containers&#x2F;8d2c8a4cd5b43b071a9976251932955937d5b1f0f34dca1482cde4195df4747d&#x2F;stop returned error: Container 8d2c8a4cd5b43b071a9976251932955937d5b1f0f34dca1482cde4195df4747d is already stopped&quot;</span><br><span class="line">Oct 31 16:34:22 k8node3 dockerd[1715]: time&#x3D;&quot;2018-10-31T16:34:22.811103238+08:00&quot; level&#x3D;error msg&#x3D;&quot;Handler for POST &#x2F;v1.27&#x2F;containers&#x2F;7fdb697e251cec249c0a17f1fdcc6d76fbec13a60929eb0217c744c181702c1f&#x2F;stop returned error: Container 7fdb697e251cec249c0a17f1fdcc6d76fbec13a60929eb0217c744c181702c1f is already stopped&quot;</span><br></pre></td></tr></table></figure>

<p>Docker çš„æ—¥å¿—ä¸­, é™¤äº†å·²ç»çœ‹äº†å¾ˆå¤šéçš„<code>connection reset by peer</code>ä¹‹å¤–, è¿˜æœ‰ä¸€äº›æ–°çš„å‘ç°</p>
<ul>
<li>xxx is already stopped: çœ‹æ—¥å¿—, æ„Ÿè§‰æ˜¯å‘å®¹å™¨æ¥å£å‘é€äº† POST è¯·æ±‚ä»¥ stop å®¹å™¨, ä½†æ˜¯è¯¥å®¹å™¨å·²ç»è¢« stop æ‰äº†</li>
</ul>
<p>Docker çš„æ—¥å¿—å’Œ kubelet çš„æ—¥å¿—çš„å…±åŒç‚¹å°±æ˜¯, kubelet é¢‘ç¹ recreate Sandbox</p>
<p>æ‰§è¡Œ <code>docker container ls -a</code> å‘½ä»¤å‘ç°å­˜åœ¨å¤§é‡ create çŠ¶æ€çš„ pause å®¹å™¨</p>
<p>æŸ¥çœ‹ <code>demesg -T</code> ä¿¡æ¯, å‘ç°äº†å¤§é‡ oom-killer çš„å­—çœ¼çš„æ—¥å¿—, åˆæ­¥åˆ¤æ–­æ˜¯ç”±äºå†…å­˜æº¢å‡º, å¯¼è‡´ç³»ç»Ÿä¸»åŠ¨ kill è¿›ç¨‹.</p>
<p>å‘ç”Ÿè¿™æ ·çš„æƒ…å†µçš„æ¦‚ç‡å¹¶ä¸é«˜, ä¸€èˆ¬æƒ…å†µä¸‹æœ‰ä¸¤ç§ç±»å‹çš„ oom kill</p>
<ul>
<li>ç”±äº pod å†…è¿›ç¨‹è¶…å‡ºäº† pod æŒ‡å®š Limit é™åˆ¶çš„å€¼, å°†å¯¼è‡´ oom kill, æ­¤æ—¶ pod é€€å‡ºçš„ Reason ä¼šæ˜¾ç¤º OOMKilled</li>
<li>å¦ä¸€ç§æƒ…å†µæ˜¯ pod å†…çš„è¿›ç¨‹ç»™è‡ªå·±è®¾ç½®äº†å¯ç”¨å†…å­˜, æ¯”å¦‚ jvm å†…å­˜é™åˆ¶è®¾ç½®ä¸º2G, pod Limit è®¾ç½®ä¸º6G, æ­¤æ—¶ç”±äºç¨‹åºçš„åŸå› å¯¼è‡´å†…å­˜ä½¿ç”¨è¶…è¿‡2G æ—¶, ä¹Ÿä¼šå¼•å‘ oom kill</li>
</ul>
<p>è¿™ä¸¤ç§å†…å­˜æº¢å‡ºçš„ kill åŒºåˆ«æ˜¯ç¬¬ä¸€ç§åŸå› ç›´æ¥æ˜¾ç¤ºåœ¨ pod çš„ Event é‡Œ; ç¬¬äºŒç§ä½ åœ¨ Event é‡Œæ‰¾ä¸åˆ°, åœ¨å®¿ä¸»æœºçš„ dmesg é‡Œé¢å¯ä»¥æ‰¾åˆ° invoked oom-killer çš„æ—¥å¿—</p>
<p>è¿™æ¬¡çš„æƒ…å†µçœ‹èµ·æ¥åƒå±äºç¬¬äºŒç§æƒ…å†µ, äºæ˜¯èµ¶ç´§å†æ¬¡ describe pod, æŸ¥çœ‹ Limit é™åˆ¶</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Containers:</span><br><span class="line">  61f983b5-19ca-4b33-8647-6b279ae93812:</span><br><span class="line">    Container ID:</span><br><span class="line">    Image:          reg.lvrui.io&#x2F;public&#x2F;testpublish:latest</span><br><span class="line">    Image ID:</span><br><span class="line">    Port:           &lt;none&gt;</span><br><span class="line">    Host Port:      &lt;none&gt;</span><br><span class="line">    State:          Waiting</span><br><span class="line">      Reason:       ContainerCreating</span><br><span class="line">    Ready:          False</span><br><span class="line">    Restart Count:  0</span><br><span class="line">    Limits:</span><br><span class="line">      cpu:     1</span><br><span class="line">      memory:  2k</span><br><span class="line">    Requests:</span><br><span class="line">      cpu:     1</span><br><span class="line">      memory:  2k</span><br><span class="line">    Environment:</span><br><span class="line">      key:  value</span><br><span class="line">    Mounts:</span><br><span class="line">      &#x2F;var&#x2F;run&#x2F;secrets&#x2F;kubernetes.io&#x2F;serviceaccount from default-token-7r9jt (ro)</span><br></pre></td></tr></table></figure>

<p>ç»ˆäºæ‰¾åˆ°äº†åŸå› , å°±æ˜¯å› ä¸ºå¯¹å†…å­˜çš„ Limit å¯¼è‡´çš„. è¿™é‡Œæ˜¾ç¤ºå†…å­˜ Limit ä¸º2k, å®é™…ä¸Šæ˜¯å› ä¸ºåœ¨åˆ›å»ºèµ„æºæ—¶, å†™çš„æ˜¯ 2000(ä¸åŠ å•ä½æ—¶, é»˜è®¤å•ä½ä¸º bytes), k8s è‡ªåŠ¨è½¬æˆäº†ä»¥å°å†™ k çš„å•ä½è¡¨ç¤ºæ–¹å¼,  æ‰€ä»¥å°±å˜æˆäº†2k</p>
<p>ç†è®ºä¸Šæ¥è¯´,  æŒ‰ç…§ä¹‹å‰çš„ç»éªŒ, æ­¤ç§æƒ…å†µ(å®é™…ä½¿ç”¨å†…å­˜è¶…è¿‡ Limit å†…å­˜çš„æƒ…å†µ)åº”è¯¥å±äºç¬¬ä¸€ç§, ä¼šåœ¨ Event é‡Œæ˜¾ç¤ºçš„ç”±äº OOMkilled åŸå› å¯¼è‡´ Terminated çŠ¶æ€. ä½†å®é™…æƒ…å†µå´æ˜¯åœ¨ Event é‡Œæ‰¾ä¸åˆ° oom kill çš„æ—¥å¿—, ä¸” pod çŠ¶æ€å¤„äº ContainerCreating çŠ¶æ€.</p>
<ul>
<li>ç”±äº OOMkilled å¤„äº Terminated çš„çŠ¶æ€æ˜¯å› ä¸º pod å·²ç»æ­£å¸¸è¢«å¼•å¯¼åˆ›å»ºå, å¯¼è‡´çš„å†…å­˜æº¢å‡º</li>
<li>ç”±äºç³»ç»Ÿ invoked oom-killer å¯¼è‡´çš„å¤„äº ContainerCreating çŠ¶æ€çš„ pod æ˜¯å› ä¸º pod è¿˜æ²¡æ­£å¸¸è¢«åˆ›å»º, pod ä¸­çš„ pause å®¹å™¨éƒ½æ²¡æœ‰è¢«æ­£å¸¸å¼•å¯¼å°±å·²ç»è¢« cgroup çš„å†…å­˜é™åˆ¶è€Œæ‹›æ¥æ€èº«ä¹‹ç¥¸</li>
</ul>
]]></content>
      <categories>
        <category>Kubernetes</category>
      </categories>
      <tags>
        <tag>docker</tag>
        <tag>kubelet</tag>
        <tag>Limit</tag>
        <tag>oom</tag>
        <tag>OOMKilled</tag>
        <tag>kill</tag>
        <tag>ContainerCreating</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸ºå®¹å™¨é•œåƒå®šåˆ¶å®‰è£…Linuxå·¥å…·</title>
    <url>/2018/10/19/%E4%B8%BA%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F%E5%AE%9A%E5%88%B6%E5%AE%89%E8%A3%85Linux%E5%B7%A5%E5%85%B7/</url>
    <content><![CDATA[<blockquote>
<p>åœ¨è°ƒè¯•çš„åœºæ™¯ä¸‹, å®¹å™¨åœ¨ä½¿ç”¨ä¸­é€šå¸¸éœ€è¦è¿›å…¥å®¹å™¨å¹¶æ‰§è¡Œä¸€äº›å·¥å…·å‘½ä»¤, æ¯”å¦‚ wget, htop, lsof, rz, sz ç­‰. æœ¬ç¯‡æ–‡ç« å°±è®¨è®ºå¦‚ä½•ä¸ºé•œåƒå®šåˆ¶å®‰è£…è¿™äº›å·¥å…·</p>
</blockquote>
<h2 id="ä¼ ç»Ÿçš„å·¥å…·å®‰è£…æ–¹å¼"><a href="#ä¼ ç»Ÿçš„å·¥å…·å®‰è£…æ–¹å¼" class="headerlink" title="ä¼ ç»Ÿçš„å·¥å…·å®‰è£…æ–¹å¼"></a>ä¼ ç»Ÿçš„å·¥å…·å®‰è£…æ–¹å¼</h2><p>ä¼ ç»Ÿçš„è¿ç»´ä¸­, å®‰è£… Linux å·¥å…·ç›´æ¥ä½¿ç”¨å„è‡ªå‘è¡Œç‰ˆçš„åŒ…ç®¡ç†å™¨å°±å¯ä»¥äº†, æ–¹ä¾¿, å¿«æ·, çœå¿ƒ</p>
<ul>
<li>RedHat ç³»åˆ—: <code>yum install lsof</code></li>
<li>Debian ç³»åˆ—: <code>apt update &amp;&amp; apt install lsof</code></li>
</ul>
<p>å½“ä½¿ç”¨ç‰©ç†æœºæˆ–è™šæ‹Ÿæœºæ—¶, ä½¿ç”¨ä¸Šé¢çš„å®‰è£…æ–¹æ³•æ²¡æœ‰ä»»ä½•é—®é¢˜, ä½†æ˜¯åˆ°äº†å®¹å™¨é•œåƒé¢†åŸŸ, æŒ‰ç…§ä¸Šé¢çš„å®‰è£…æ–¹å¼å°±ä¸è¡Œäº†. è¯•è¿‡çš„ç«¥é‹ä¼šå‘ç°, ä¸€ä¸ª centos çš„åŸºç¡€é•œåƒå¤§çº¦ <strong>200MB</strong> å·¦å³, ç”¨ä»¥ä¸Š<code>yum</code>çš„æ–¹å¼å®‰è£…å®Œ<code>lsof</code>å·¥å…·ä¹‹å, é•œåƒçš„ä½“ç§¯å¢å¤§åˆ°äº† <strong>300MB</strong> ä»…ä»…ä¸€ä¸ªå°å·¥å…·çš„å®‰è£…, å°±ä¼šè®©å®¹å™¨é•œåƒçš„ä½“ç§¯å¿«é€Ÿè†¨èƒ€, è™½ç„¶æˆåŠŸçš„å®Œæˆäº†å®‰è£…, å•è¿™æ˜¾ç„¶ä¸æ˜¯æˆ‘ä»¬å¸Œæœ›çœ‹åˆ°çš„ç»“æœ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker image ls</span><br><span class="line">REPOSITORY                                    TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">centos                                        latest              75835a67d134        9 days ago          200MB</span><br></pre></td></tr></table></figure>

<h2 id="é•œåƒä¸­çš„å·¥å…·å®‰è£…æ–¹å¼"><a href="#é•œåƒä¸­çš„å·¥å…·å®‰è£…æ–¹å¼" class="headerlink" title="é•œåƒä¸­çš„å·¥å…·å®‰è£…æ–¹å¼"></a>é•œåƒä¸­çš„å·¥å…·å®‰è£…æ–¹å¼</h2><p>åœ¨é•œåƒä¸­å®‰è£…åŸºç¡€å·¥å…·, å°±ä¸èƒ½åƒåœ¨ä¼ ç»Ÿè™šæ‹Ÿæœºé‡Œé‚£æ ·ç²—çŠ·æ“ä½œäº†, é•œåƒçš„ä½“ç§¯æ˜¯ä¸ªéå¸¸æ•æ„Ÿçš„æ•°å­—, ç‰µåŠ¨ç€æ‰“åŒ…è€…çš„ç¥ç», ä»¥ä¸‹ä¹ƒå®‰è£…å·¥å…·ä¹‹æ­£é“</p>
<ul>
<li>RedHat ç³»åˆ—: <code>yum install lsof &amp;&amp; yum clean all</code></li>
<li>Debian ç³»åˆ—: <code>apt update &amp;&amp; apt install lsof &amp;&amp; apt clean &amp;&amp; apt autoclean &amp;&amp; rm -fr /var/lib/apt/lists/*</code></li>
</ul>
<p>ç»è¿‡å–„åå¤„ç†çš„å®‰è£…æ–¹å¼, ä»ä»¥ centos å®‰è£… lsof å·¥å…·ä¸ºä¾‹, å®‰è£…å®Œæˆå, ä½“ç§¯ä¸º <strong>223MB</strong> ç›¸æ¯”ä¹‹å‰ <strong>300MB</strong> çš„ä½“ç§¯, å¯ä»¥è¯´å·²ç»å¾—åˆ°äº†å¾ˆå¤§çš„ä¼˜åŒ–</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker image ls</span><br><span class="line">REPOSITORY                                    TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">mycentos                                      0.1                 80bb7d931f74        1 minutes ago       223MB</span><br></pre></td></tr></table></figure>

<p>Debian ç³»åˆ—æ¯”è¾ƒç‰¹æ®Š, <code>apt clean</code> æ“ä½œæ˜¯ä¸ºäº†åˆ é™¤æ‰ <code>/var/cache/apt/archives/</code> ä¸‹çš„è½¯ä»¶åŒ…, åé¢è¿˜æŒ‡å®šåˆ é™¤äº† <code>/var/lib/apt/lists/*</code> æ­¤è·¯å¾„ä¸‹çš„æ‰€æœ‰æ–‡ä»¶, æ˜¯ä¸ºäº†åˆ é™¤ <code>apt update</code> æ“ä½œåæ›´æ–°åˆ°æ­¤ç›®å½•çš„è¿œç¨‹æœåŠ¡å™¨æä¾›çš„è½¯ä»¶åˆ—è¡¨ä¿¡æ¯</p>
<h2 id="ä¸ºå®¹å™¨å®šåˆ¶å®‰è£…å·¥å…·åŒ…"><a href="#ä¸ºå®¹å™¨å®šåˆ¶å®‰è£…å·¥å…·åŒ…" class="headerlink" title="ä¸ºå®¹å™¨å®šåˆ¶å®‰è£…å·¥å…·åŒ…"></a>ä¸ºå®¹å™¨å®šåˆ¶å®‰è£…å·¥å…·åŒ…</h2><p>ç»è¿‡ä¸Šé¢çš„å®è·µ, åœ¨ centos é•œåƒä¸­å®‰è£… lsof å·¥å…·çš„ä½“ç§¯æˆæœ¬, å·²ç»æˆåŠŸä» 300MB é™åˆ°äº† 223 MB, æ˜¯å¦è¿˜æœ‰æ›´æè‡´çš„å®‰è£…æ–¹æ³•å‘¢? å½“ç„¶æœ‰çš„, å°±æ˜¯ç›´æ¥æ‹·è´äºŒè¿›åˆ¶æ–‡ä»¶åˆ°é•œåƒä¸­</p>
<h3 id="æ‰¾åˆ°å‘½ä»¤æ–‡ä»¶ä½ç½®åŠä¾èµ–"><a href="#æ‰¾åˆ°å‘½ä»¤æ–‡ä»¶ä½ç½®åŠä¾èµ–" class="headerlink" title="æ‰¾åˆ°å‘½ä»¤æ–‡ä»¶ä½ç½®åŠä¾èµ–"></a>æ‰¾åˆ°å‘½ä»¤æ–‡ä»¶ä½ç½®åŠä¾èµ–</h3><h4 id="æ‰¾å‘½ä»¤ä½ç½®"><a href="#æ‰¾å‘½ä»¤ä½ç½®" class="headerlink" title="æ‰¾å‘½ä»¤ä½ç½®"></a>æ‰¾å‘½ä»¤ä½ç½®</h4><p>å¯åŠ¨ä¸´æ—¶å®¹å™¨, ä¼ ç»Ÿå®‰è£… lsof</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker container run -it centos:latest /bin/bash</span><br></pre></td></tr></table></figure>

<p>è¿›å…¥åˆ°å®¹å™¨å, æ­£å¸¸å®‰è£…å·¥å…·åŒ…</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum -y install lsof</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹è¯¥å·¥å…·åŒ…å®‰è£…çš„æ‰€æœ‰æ–‡ä»¶</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@7b532cd952dc /]<span class="comment"># rpm -qa | grep lsof</span></span><br><span class="line">lsof-4.87-5.el7.x86_64</span><br><span class="line">[root@7b532cd952dc /]<span class="comment"># rpm -ql lsof-4.87-5.el7.x86_64</span></span><br><span class="line">/usr/sbin/lsof</span><br><span class="line">/usr/share/doc/lsof-4.87</span><br><span class="line">/usr/share/doc/lsof-4.87/00.README.FIRST</span><br><span class="line">/usr/share/doc/lsof-4.87/00.README.FIRST_4.87</span><br><span class="line">/usr/share/doc/lsof-4.87/00CREDITS</span><br><span class="line">/usr/share/doc/lsof-4.87/00DCACHE</span><br><span class="line">/usr/share/doc/lsof-4.87/00DIALECTS</span><br><span class="line">/usr/share/doc/lsof-4.87/00DIST</span><br><span class="line">/usr/share/doc/lsof-4.87/00FAQ</span><br><span class="line">/usr/share/doc/lsof-4.87/00LSOF-L</span><br><span class="line">/usr/share/doc/lsof-4.87/00MANIFEST</span><br><span class="line">/usr/share/doc/lsof-4.87/00PORTING</span><br><span class="line">/usr/share/doc/lsof-4.87/00QUICKSTART</span><br><span class="line">/usr/share/doc/lsof-4.87/00README</span><br><span class="line">/usr/share/doc/lsof-4.87/00TEST</span><br><span class="line">/usr/share/doc/lsof-4.87/00XCONFIG</span><br><span class="line">/usr/share/doc/lsof-4.87/README.lsof_4.87</span><br><span class="line">/usr/share/man/man8/lsof.8.gz</span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸Šæ–‡ä»¶ä¸­, é™¤äº†ç¬¬ä¸€ä¸ªä¸»ç¨‹åºå¤–, å…¶ä»–çš„éƒ½æ˜¯æ–‡æ¡£æ–‡ä»¶, ç”±äº centos åŸºç¡€é•œåƒä¸­å¹¶ä¸åŒ…å« man å‘½ä»¤, æ‰€ä»¥, é»˜è®¤è¿™äº›æ–‡ä»¶éƒ½æ²¡æœ‰å®é™…å­˜åœ¨åœ¨ç£ç›˜ä¸­, æˆ‘ä»¬è¦æ‹·è´çš„ç›®æ ‡åªæœ‰ç¬¬ä¸€ä¸ªä¸»ç¨‹åº</p>
<p>å®‰è£…å®Œæˆå, æ‰¾åˆ°è½¯ä»¶åŒ…çš„å®‰è£…ä½ç½®(ç”±äºæ²¡æœ‰ which å‘½ä»¤, æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ find å‘½ä»¤)</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@7b532cd952dc /]<span class="comment"># find / -name "lsof"</span></span><br><span class="line">/usr/sbin/lsof</span><br></pre></td></tr></table></figure>

<h4 id="æ‰¾ä¾èµ–"><a href="#æ‰¾ä¾èµ–" class="headerlink" title="æ‰¾ä¾èµ–"></a>æ‰¾ä¾èµ–</h4><p>ä½¿ç”¨ <code>ldd</code> å‘½ä»¤, æ‰¾åˆ° lsof å‘½ä»¤ä¾èµ–çš„åº“æ–‡ä»¶</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@7b532cd952dc /]<span class="comment"># ldd /usr/sbin/lsof</span></span><br><span class="line">	linux-vdso.so.1 =&gt;  (0x00007ffca8dd6000)</span><br><span class="line">	libselinux.so.1 =&gt; /lib64/libselinux.so.1 (0x00007f09b6b7e000)</span><br><span class="line">	libc.so.6 =&gt; /lib64/libc.so.6 (0x00007f09b67b1000)</span><br><span class="line">	libpcre.so.1 =&gt; /lib64/libpcre.so.1 (0x00007f09b654f000)</span><br><span class="line">	libdl.so.2 =&gt; /lib64/libdl.so.2 (0x00007f09b634b000)</span><br><span class="line">	/lib64/ld-linux-x86-64.so.2 (0x00007f09b6da5000)</span><br><span class="line">	libpthread.so.0 =&gt; /lib64/libpthread.so.0 (0x00007f09b612f000)</span><br></pre></td></tr></table></figure>

<ul>
<li>ç¬¬ä¸€åˆ—ï¼šç¨‹åºéœ€è¦ä¾èµ–ä»€ä¹ˆåº“</li>
<li>ç¬¬äºŒåˆ—: ç³»ç»Ÿæä¾›çš„ä¸ç¨‹åºéœ€è¦çš„åº“æ‰€å¯¹åº”çš„åº“</li>
<li>ç¬¬ä¸‰åˆ—ï¼šåº“åŠ è½½çš„å¼€å§‹åœ°å€</li>
</ul>
<p>é€šè¿‡ä¸Šé¢çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ä»¥ä¸‹å‡ ä¸ªä¿¡æ¯ï¼š</p>
<ul>
<li>é€šè¿‡å¯¹æ¯”ç¬¬ä¸€åˆ—å’Œç¬¬äºŒåˆ—ï¼Œæˆ‘ä»¬å¯ä»¥åˆ†æç¨‹åºéœ€è¦ä¾èµ–çš„åº“å’Œç³»ç»Ÿå®é™…æä¾›çš„ï¼Œæ˜¯å¦ç›¸åŒ¹é…</li>
<li>é€šè¿‡è§‚å¯Ÿç¬¬ä¸‰åˆ—ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“åœ¨å½“å‰çš„åº“ä¸­çš„ç¬¦å·åœ¨å¯¹åº”çš„è¿›ç¨‹çš„åœ°å€ç©ºé—´ä¸­çš„å¼€å§‹ä½ç½®</li>
</ul>
<p>åœ¨æœ¬æ–‡çš„åœºæ™¯ä¸­, æˆ‘ä»¬éœ€è¦å…³å¿ƒçš„å°±æ˜¯ç¬¬ä¸€åˆ—å’Œç¬¬äºŒåˆ—, æˆ‘ä»¬éœ€è¦è®°ä¸‹ç¬¬ä¸€åˆ—çš„æ‰€æœ‰åº“æ–‡ä»¶, ç„¶ååˆ°åˆå§‹çš„ centos é•œåƒä¸­å»æŒ¨ä¸ªå„¿æŸ¥æ‰¾</p>
<p>å“ªäº›åº“æ–‡ä»¶éœ€è¦æŸ¥æ‰¾å‘¢, ç€é‡æ‰¾é‚£äº› <code>ç¬¬ä¸€åˆ— =&gt; ç¬¬äºŒåˆ—</code> çš„åº“æ–‡ä»¶åœ¨æ–°é•œåƒä¸­æ˜¯å¦å­˜åœ¨, å› ä¸ºå‡ºç°äº†<code>=&gt;</code>æ ‡å¿—, å°±æ„å‘³ç€å½“å‰å®¹å™¨æä¾›äº†è¿™ä¸ªæ–‡ä»¶ç»™ç¨‹åºä½¿ç”¨</p>
<p>æ‹¿ä¸Šé¢çš„ä¾‹å­æ¥è¯´, ç€é‡æŸ¥æ‰¾ä»¥ä¸‹æ–‡ä»¶:</p>
<ul>
<li>libselinux.so.1 =&gt; /lib64/libselinux.so.1</li>
<li>libc.so.6 =&gt; /lib64/libc.so.6</li>
<li>libpcre.so.1 =&gt; /lib64/libpcre.so.1</li>
<li>libdl.so.2 =&gt; /lib64/libdl.so.2</li>
<li>/lib64/ld-linux-x86-64.so.2</li>
<li>libpthread.so.0 =&gt; /lib64/libpthread.so.0</li>
</ul>
<p>å¦‚æœä½ å«Œå¤šçš„è¯, è¿˜å¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤, æŸ¥æ‰¾è¯¥ç¨‹åºæ²¡æœ‰ä½¿ç”¨åˆ°çš„ç›´æ¥ä¾èµ–æ–‡ä»¶</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@7b532cd952dc /]<span class="comment"># ldd -u /usr/sbin/lsof</span></span><br><span class="line">Unused direct dependencies:</span><br><span class="line">	/lib64/libselinux.so.1</span><br></pre></td></tr></table></figure>

<p>ä¹Ÿå°±æ˜¯è¯´, åœ¨ä¸Šé¢çš„åˆ—è¡¨ä¸­, å¯ä»¥å»æ‰æ£€æŸ¥ <code>/lib64/libselinux.so.1</code> è¯¥åº“æ–‡ä»¶</p>
<h4 id="æ£€æŸ¥ä¾èµ–"><a href="#æ£€æŸ¥ä¾èµ–" class="headerlink" title="æ£€æŸ¥ä¾èµ–"></a>æ£€æŸ¥ä¾èµ–</h4><p><strong>å¯åŠ¨ä¸€ä¸ªæ–°çš„åŸå§‹é•œåƒè¿›è¡Œä¸Šé¢æ£€æŸ¥åˆ—è¡¨çš„æŸ¥æ‰¾</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker container run -it centos:latest /bin/bash                                                                          </span><br><span class="line">[root@099f82deeb3d /]<span class="comment">#</span></span><br><span class="line">[root@099f82deeb3d /]<span class="comment"># find / -name "libc.so.6"</span></span><br><span class="line">/usr/lib64/libc.so.6</span><br><span class="line"></span><br><span class="line"><span class="comment"># ...... æŒ‰ç…§ä¸Šé¢çš„åˆ—è¡¨æ–‡ä»¶, æŒ¨ä¸ªå„¿æŸ¥æ‰¾</span></span><br></pre></td></tr></table></figure>

<p><strong>ç¡®ä¿åŸå§‹é•œåƒä¸­çš„å¯¹åº”åˆ—è¡¨æ–‡ä»¶éƒ½å·²ç»å­˜åœ¨, å¦‚æœæœ‰éƒ¨åˆ†åº“æ–‡ä»¶ä¸å­˜åœ¨, éœ€è¦åœ¨åé¢çš„æ“ä½œä¸­, å’Œ lsof ä¸»ç¨‹åºæ–‡ä»¶ä¸€åŒæ‹·è´æ–°çš„é•œåƒä¸­</strong></p>
<h4 id="æ‹·è´ç¨‹åºåŠä¾èµ–åº“"><a href="#æ‹·è´ç¨‹åºåŠä¾èµ–åº“" class="headerlink" title="æ‹·è´ç¨‹åºåŠä¾èµ–åº“"></a>æ‹·è´ç¨‹åºåŠä¾èµ–åº“</h4><p>æˆ‘ä»¬å°†ç¬¬ä¸€å¯åŠ¨çš„å®¹å™¨, ä½¿ç”¨ yum å®‰è£…äº† lsof å‘½ä»¤çš„å®¹å™¨ç§°ä¹‹ä¸º A å®¹å™¨; å°†ç¬¬äºŒæ¬¡å¯åŠ¨çš„åŸå§‹å®¹å™¨, æ£€æŸ¥äº†ä¾èµ–æ–‡ä»¶çš„å®¹å™¨ç§°ä¹‹ä¸º B å®¹å™¨</p>
<p>å°† A å®¹å™¨çš„ä¸»ç¨‹åºæ–‡ä»¶ä»¥åŠåœ¨ B å®¹å™¨ä¸­ç¼ºå¤±çš„åº“æ–‡ä»¶ä¸€åŒæ‹·è´å‡ºæ¥(æ“ä½œå¯¹è±¡: A å®¹å™¨)</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ‰¾åˆ° A å®¹å™¨çš„ containerID: 7b532cd952dc</span></span><br><span class="line"><span class="comment"># æˆ‘ä»¬å‡è®¾åœ¨ B å®¹å™¨ä¸­æ£€æŸ¥æ–‡ä»¶åˆ—è¡¨æ—¶, åŒæ—¶ç¼ºå¤±äº† `libc.so.6` åº“æ–‡ä»¶ (æ³¨æ„: æ˜¯å‡è®¾!!!)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†ä¸»æ–‡ä»¶å’Œç¼ºå¤±çš„åº“æ–‡ä»¶ä»å®¹å™¨ä¸­æ‹·è´åˆ°æœ¬åœ°ç›®å½•</span></span><br><span class="line">docker container cp 7b532cd952dc:/usr/sbin/lsof ./                                                                        </span><br><span class="line">docker container cp 7b532cd952dc:/usr/lib64/libc.so.6 ./</span><br></pre></td></tr></table></figure>

<p>ç„¶ååˆ¶ä½œæ–°çš„é•œåƒ, ä»¥æ”¯æŒä½¿ç”¨ lsof å‘½ä»¤</p>
<p>æ–°çš„ dockerfile å†…å®¹å¦‚ä¸‹:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">FROM centos:latest</span><br><span class="line"></span><br><span class="line">COPY lsof /usr/sbin/</span><br><span class="line">COPY libc.so.6 /usr/lib64/</span><br></pre></td></tr></table></figure>

<p><strong>æ³¨æ„: ç”±äºä¸Šé¢ğŸ‘†æˆ‘æ˜¯å‡è®¾çš„ç¼ºå¤±äº†libc.so.6æ–‡ä»¶, æ‰€ä»¥åœ¨ dockerfile é‡ŒåŠ å…¥äº†è¿™ä¸ªæ–‡ä»¶çš„æ‹·è´, å®é™…ä¸Šè¿™ä¸ªæ–‡ä»¶åœ¨ centos åŸºç¡€é•œåƒæ˜¯å­˜åœ¨çš„, è€Œä¸”æ˜¯ä»¥è½¯è¿æ¥çš„å½¢å¼å­˜åœ¨çš„, å½“æˆ‘ä»¬çœŸçš„<code>COPY libc.so.6 /usr/lib64/</code>è¿™ä¹ˆæ“ä½œæ—¶, åè€Œä¼šæŠ¥é”™. ä¸€å®šæ³¨æ„: æ­¤å¤„åªæ˜¯æ¼”ç¤ºç¼ºå¤±åº“æ–‡ä»¶çš„å¤„ç†æƒ…å†µ, åº“æ–‡ä»¶å·²ç»å­˜åœ¨çš„è¯, æœ€å¥½ä¸è¦åŠ¨åŸé…!!!</strong></p>
<p>ç„¶åæˆ‘ä»¬æ‰§è¡Œç¼–è¯‘æ–°é•œåƒçš„å‘½ä»¤</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker build -t mycentos:0.2 ./</span><br></pre></td></tr></table></figure>

<p>è¿›å…¥åˆ°æ–°çš„å®¹å™¨éªŒè¯ lsof æ˜¯å¦å¯ä»¥æ­£å¸¸ä½¿ç”¨</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker container run -it mycentos:0.2 /bin/bash                                                                           </span><br><span class="line">[root@032d75e40f56 /]<span class="comment"># lsof</span></span><br><span class="line">COMMAND PID USER   FD   TYPE DEVICE SIZE/OFF    NODE NAME</span><br><span class="line">bash      1 root  cwd    DIR  0,133     4096   47026 /</span><br><span class="line">bash      1 root  rtd    DIR  0,133     4096   47026 /</span><br><span class="line">bash      1 root  txt    REG    8,1   964544  917638 /usr/bin/bash</span><br><span class="line">bash      1 root  mem    REG    8,1    62184  919647 /usr/lib64/libnss_files-2.17.so</span><br><span class="line">bash      1 root  mem    REG    8,1  2173512  919510 /usr/lib64/libc-2.17.so</span><br><span class="line">bash      1 root  mem    REG    8,1    19776  919537 /usr/lib64/libdl-2.17.so</span><br><span class="line">......</span><br></pre></td></tr></table></figure>

<p>æ”¯æŒ, å…³äºä¸ºå®¹å™¨é•œåƒå®šåˆ¶çš„Linuxå·¥å…·å‘½ä»¤çš„å·¥ä½œå°±å·²ç»å…¨éƒ¨å®Œæˆäº†, æˆ‘ä»¬å†çœ‹ä¸‹å®šåˆ¶ç‰ˆçš„é•œåƒä½“ç§¯å¤§å°</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker image ls                                                                                                           </span><br><span class="line">REPOSITORY                                    TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">mycentos                                      0.2                 805d98b565c8        7 minutes ago       201MB</span><br></pre></td></tr></table></figure>

<p>ç²¾ç®€åˆ°äº†åªæœ‰ <strong>201MB</strong> ä¸åŸå§‹çš„é•œåƒç›¸æ¯”, åªå¢åŠ äº† <strong>1MB</strong></p>
<hr>
<p>å‚è€ƒæ–‡æ¡£:</p>
<ul>
<li>æŸ¥çœ‹ç¨‹åºä¾èµ–åº“: <a href="https://linuxtools-rst.readthedocs.io/zh_CN/latest/tool/ldd.html" target="_blank" rel="noopener">https://linuxtools-rst.readthedocs.io/zh_CN/latest/tool/ldd.html</a></li>
</ul>
]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>image</tag>
        <tag>ldd</tag>
        <tag>yum</tag>
        <tag>apt</tag>
        <tag>ä¼˜åŒ–</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS7ä¸‹æŸ¥çœ‹å¼€æœºå¯åŠ¨é¡¹</title>
    <url>/2018/10/11/CentOS7%E4%B8%8B%E6%9F%A5%E7%9C%8B%E5%BC%80%E6%9C%BA%E5%90%AF%E5%8A%A8%E9%A1%B9/</url>
    <content><![CDATA[<h1 id="æŸ¥çœ‹å¼€æœºå¯åŠ¨é¡¹"><a href="#æŸ¥çœ‹å¼€æœºå¯åŠ¨é¡¹" class="headerlink" title="æŸ¥çœ‹å¼€æœºå¯åŠ¨é¡¹"></a>æŸ¥çœ‹å¼€æœºå¯åŠ¨é¡¹</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">systemctl list-unit-files</span><br></pre></td></tr></table></figure>

<h1 id="æŸ¥çœ‹æŸä¸€æœåŠ¡æ˜¯å¦å¼€å¯å¯åŠ¨"><a href="#æŸ¥çœ‹æŸä¸€æœåŠ¡æ˜¯å¦å¼€å¯å¯åŠ¨" class="headerlink" title="æŸ¥çœ‹æŸä¸€æœåŠ¡æ˜¯å¦å¼€å¯å¯åŠ¨"></a>æŸ¥çœ‹æŸä¸€æœåŠ¡æ˜¯å¦å¼€å¯å¯åŠ¨</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">systemctl is-enabled kubelet.service</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>systemctl</tag>
      </tags>
  </entry>
  <entry>
    <title>kubeletåˆ é™¤PodæŠ¥device or resource busy</title>
    <url>/2018/10/11/Kubelet%E5%88%A0%E9%99%A4Pod%E6%8A%A5device-or-resource-busy/</url>
    <content><![CDATA[<p>åˆ é™¤ deployment èµ„æºå, æŸäº› pod èµ„æºçš„çŠ¶æ€ä¸€ç›´æ˜¾ç¤º Terminating, è¿›å…¥åˆ°è¯¥ pod æ‰€åœ¨çš„å®¿ä¸»æœº, æŸ¥çœ‹ kubelet æ—¥å¿—:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">journalctl -u kubelet -f</span><br></pre></td></tr></table></figure>

<p>ä¼šå‘ç°æœ‰åˆ é™¤æŸäº›ç›®å½•/æ–‡ä»¶ <code>device or resource busy</code> çš„é”™è¯¯å‡ºç°, è¯´æ˜æœ‰å…¶ä»–çš„è¿›ç¨‹åœ¨æŒ‚è½½å®¹å™¨å†…ä½¿ç”¨çš„ç›®å½•</p>
<p>ä½¿ç”¨å¦‚ä¸‹è„šæœ¬, æ£€æŸ¥ç›®å½•æŒ‚è½½æƒ…å†µ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@k8s-node ~]<span class="comment"># cat leak.sh </span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">declare</span> -A map</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `find /proc/*/mounts -<span class="built_in">exec</span> grep <span class="variable">$1</span> &#123;&#125; + 2&gt;/dev/null | awk <span class="string">'&#123;print $1"#"$2&#125;'</span>`</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    pid=`<span class="built_in">echo</span> <span class="variable">$i</span> | awk -F <span class="string">"[/]"</span> <span class="string">'&#123;print $3&#125;'</span>`</span><br><span class="line">    point=`<span class="built_in">echo</span> <span class="variable">$i</span> | awk -F <span class="string">"[#]"</span> <span class="string">'&#123;print $2&#125;'</span>`</span><br><span class="line">    mnt=`ls -l /proc/<span class="variable">$pid</span>/ns/mnt |awk <span class="string">'&#123;print $11&#125;'</span>`</span><br><span class="line">    map[<span class="string">"<span class="variable">$mnt</span>"</span>]=<span class="string">"exist"</span></span><br><span class="line">    cmd=`cat /proc/<span class="variable">$pid</span>/cmdline`</span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">"<span class="variable">$pid</span>\t<span class="variable">$mnt</span>\t<span class="variable">$cmd</span>\t<span class="variable">$point</span>"</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `ps aux|grep docker-containerd-shim |grep -v <span class="string">"grep"</span> |awk <span class="string">'&#123;print $2&#125;'</span>`</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    mnt=`ls -l /proc/<span class="variable">$i</span>/ns/mnt  2&gt;/dev/null | awk <span class="string">'&#123;print $11&#125;'</span>`</span><br><span class="line">    <span class="keyword">if</span> [[ <span class="string">"<span class="variable">$&#123;map[$mnt]&#125;</span>"</span> == <span class="string">"exist"</span> ]];<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="variable">$mnt</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œè„šæœ¬, åè·Ÿ<code>device or resource busy</code>çš„ç›®å½•ç»å¯¹è·¯å¾„</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sh leak.sh &#x2F;var&#x2F;lib&#x2F;kubelet&#x2F;pods&#x2F;81791176-a505-11e7-accf-5254fe5a9007&#x2F;volumes&#x2F;kubernetes.io~secret&#x2F;default-token-pzyxh</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œå, å¯ä»¥çœ‹åˆ°è¯¥ç›®å½•è¢«å“ªäº›è¿›ç¨‹æ‰€æŒ‚è½½</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">8392    mnt:[4026532536]    &#x2F;bin&#x2F;bash&#x2F;start.sh--logtostderr -v&#x3D;2    &#x2F;var&#x2F;lib&#x2F;kubelet&#x2F;pods&#x2F;81791176-a505-11e7-accf-5254fe5a9007&#x2F;volumes&#x2F;kubernetes.io~secret&#x2F;default-token-pzyxh</span><br></pre></td></tr></table></figure>

<p>ä¸€çº§ä¸€çº§å¾€ä¸Šè¿½è¸ªçˆ¶è¿›ç¨‹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@k8s-node ~]<span class="comment"># ps -ef | grep 8392</span></span><br><span class="line">root      8392  8345  0 9æœˆ30 ?       00:00:00 /bin/bash /start.sh --logtostderr -v=2</span><br><span class="line">root      8420  8392  0 9æœˆ30 ?       00:17:19 /usr/bin/python /usr/bin/supervisord -c supervisord.conf</span><br><span class="line">root     13757  7126  0 13:35 pts/2    00:00:00 grep --color=auto 8392</span><br><span class="line">[root@k8s-node ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘é‡åˆ°çš„æƒ…å†µæ˜¯å¦ä¸€ä¸ªä¸“é—¨ç”¨äºæ”¶é›†æ—¥å¿—çš„å®¹å™¨, æŒ‚è½½äº†è¿™ä¸ªå®¹å™¨ä¸­çš„æ•°æ®ç›®å½•, å¯¼è‡´åˆ é™¤è¯¥å®¹å™¨æ—¶, æŠ¥<code>device or resource busy</code>çš„é”™è¯¯</p>
<p>è¿™ç§æƒ…å†µä¸‹, ä½ å¯ä»¥æ˜¯ç”¨<code>kubectl exec</code>æˆ–<code>docker exec</code>è¿›å…¥åˆ°å®¹å™¨ä¸­, å°†è¯¥ç›®å½• umount æ‰, è¿‡ä¸€ä¼šå„¿, è¯¥ pod å³å¯è¢« Kubernetes æ­£ç¡®åˆ é™¤</p>
<hr>
<p>å‚è€ƒæ–‡æ¡£:</p>
<ul>
<li><a href="https://www.jianshu.com/p/4fc11a0a31da" target="_blank" rel="noopener">https://www.jianshu.com/p/4fc11a0a31da</a></li>
</ul>
]]></content>
      <categories>
        <category>Kubernetes</category>
      </categories>
      <tags>
        <tag>Kubernetes</tag>
        <tag>kubelet</tag>
        <tag>Pod</tag>
        <tag>Terminating</tag>
      </tags>
  </entry>
  <entry>
    <title>caè¯ä¹¦éªŒè¯</title>
    <url>/2018/10/09/ca%E8%AF%81%E4%B9%A6%E9%AA%8C%E8%AF%81/</url>
    <content><![CDATA[<h1 id="éªŒè¯è¯ä¹¦æ˜¯å¦æ˜¯æŸ-ca-æœºæ„é¢å‘"><a href="#éªŒè¯è¯ä¹¦æ˜¯å¦æ˜¯æŸ-ca-æœºæ„é¢å‘" class="headerlink" title="éªŒè¯è¯ä¹¦æ˜¯å¦æ˜¯æŸ ca æœºæ„é¢å‘"></a>éªŒè¯è¯ä¹¦æ˜¯å¦æ˜¯æŸ ca æœºæ„é¢å‘</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@k8s-master:/var/lib/kubelet/pki<span class="comment"># openssl verify -CAfile /etc/kubernetes/pki/ca.crt kubelet-client-current.pem</span></span><br><span class="line">kubelet-client-current.pem: OK</span><br></pre></td></tr></table></figure>

<p><code>kubelet-client-current.pem</code> è¯ä¹¦æ˜¯ <code>/etc/kubernetes/pki/ca.crt</code> è¯¥ ca æœºæ„é¢å‘</p>
<h1 id="æŸ¥çœ‹è¯ä¹¦è¯¦æƒ…"><a href="#æŸ¥çœ‹è¯ä¹¦è¯¦æƒ…" class="headerlink" title="æŸ¥çœ‹è¯ä¹¦è¯¦æƒ…"></a>æŸ¥çœ‹è¯ä¹¦è¯¦æƒ…</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@k8s-master:~/ssl/admin<span class="comment"># openssl x509 -in /etc/kubernetes/pki/front-proxy-client.crt -text -noout</span></span><br><span class="line">Certificate:</span><br><span class="line">    Data:</span><br><span class="line">        Version: 3 (0x2)</span><br><span class="line">        Serial Number: 8005382448281716991 (0x6f18d4ec20fa88ff)</span><br><span class="line">    Signature Algorithm: sha256WithRSAEncryption</span><br><span class="line">        Issuer: CN=kubernetes</span><br><span class="line">        Validity</span><br><span class="line">            Not Before: Sep 11 15:15:40 2018 GMT</span><br><span class="line">            Not After : Sep 11 15:15:40 2019 GMT</span><br><span class="line">        Subject: CN=front-proxy-client</span><br><span class="line">        Subject Public Key Info:</span><br><span class="line">            Public Key Algorithm: rsaEncryption</span><br><span class="line">                Public-Key: (2048 bit)</span><br><span class="line">                Modulus:</span><br><span class="line">                    00:c5:b4:21:b9:ad:4e:19:25:e2:12:78:5b:e3:75:</span><br><span class="line">                    3f:41:70:8d:05:f6:30:7f:72:8d:e7:cb:8b:82:de:</span><br><span class="line">                    be:be:fb:5b:57:fd:4f:7d:12:b7:e3:a8:d3:05:02:</span><br><span class="line">                    59:83:95:dd:14:19:c9:13:cf:96:80:1e:f0:70:39:</span><br><span class="line">                    30:4c:b6:a4:5b:47:83:14:04:fd:b7:b9:6d:4b:3d:</span><br><span class="line">                    a0:f1:e3:39:68:5d:b4:7d:af:3e:99:aa:43:30:d9:</span><br><span class="line">                    e9:45:87:47:c2:4f:61:81:0b:d3:f7:83:bb:98:5c:</span><br><span class="line">                    8e:e5:97:16:8e:23:a3:03:28:19:58:ee:3a:6b:de:</span><br><span class="line">                    ad:bf:54:42:90:80:4f:8f:28:76:bc:49:8d:35:d1:</span><br><span class="line">                    2e:e5:37:8a:aa:d2:be:ec:be:12:d6:b8:88:0b:85:</span><br><span class="line">                    88:1b:7d:1e:23:37:25:2d:c0:ea:d6:4e:6b:5f:81:</span><br><span class="line">                    93:26:6e:be:69:a1:67:e5:75:9a:85:db:a4:56:30:</span><br><span class="line">                    54:13:21:c5:41:46:9a:fd:c9:41:11:13:b9:b8:77:</span><br><span class="line">                    ba:74:26:85:5c:e2:78:b6:61:3b:5f:3c:bc:1a:00:</span><br><span class="line">                    3a:e7:e7:2d:a7:3a:04:17:46:86:66:c3:6c:25:3a:</span><br><span class="line">                    f5:b5:fa:d6:28:cc:7c:6e:08:47:2f:0e:08:f2:8a:</span><br><span class="line">                    46:33:e1:00:d7:9a:ce:e8:fe:80:e9:80:c4:58:53:</span><br><span class="line">                    c4:f1</span><br><span class="line">                Exponent: 65537 (0x10001)</span><br><span class="line">        X509v3 extensions:</span><br><span class="line">            X509v3 Key Usage: critical</span><br><span class="line">                Digital Signature, Key Encipherment</span><br><span class="line">            X509v3 Extended Key Usage:</span><br><span class="line">                TLS Web Client Authentication</span><br><span class="line">    Signature Algorithm: sha256WithRSAEncryption</span><br><span class="line">         41:0b:22:92:b5:33:4a:57:76:2f:69:51:12:d1:64:46:4d:f9:</span><br><span class="line">         72:1d:bb:32:2a:f4:c1:e4:58:ae:a3:53:be:8b:b3:da:6b:10:</span><br><span class="line">         ee:4a:15:4d:ad:71:27:6b:d5:dc:ff:12:56:a8:b7:8e:fd:b3:</span><br><span class="line">         ae:90:07:26:6b:e3:16:11:c7:56:79:db:04:f8:09:ca:c5:19:</span><br><span class="line">         c9:0c:54:8e:84:d0:09:e2:34:ed:9b:9c:b4:e8:6a:ae:6a:d1:</span><br><span class="line">         b2:b6:51:22:1c:c0:67:da:9d:1b:06:da:b7:cf:42:2a:98:38:</span><br><span class="line">         d0:48:93:4d:ef:71:73:60:6c:09:19:1d:d9:4e:f1:2d:d2:d4:</span><br><span class="line">         a5:e9:2c:a9:5a:b1:39:54:27:07:09:81:29:54:f8:37:20:db:</span><br><span class="line">         70:8e:7d:16:23:4f:5b:21:a3:02:df:a6:a9:87:f6:a0:10:4a:</span><br><span class="line">         43:73:97:4d:14:b7:4b:06:00:1c:c6:a8:45:d8:97:df:0e:1e:</span><br><span class="line">         70:87:98:ee:08:1f:31:e7:cf:6d:9d:06:05:47:8f:6a:e6:10:</span><br><span class="line">         c8:d7:0a:d3:7a:36:42:a5:05:ef:ba:bb:26:58:aa:ac:<span class="built_in">fc</span>:8d:</span><br><span class="line">         e4:11:45:12:ef:49:b9:fb:7a:f1:74:c7:41:d5:2f:1b:c2:15:</span><br><span class="line">         7d:87:e1:28:7d:05:e5:59:dc:1d:16:0f:e5:ac:a0:07:e4:f0:</span><br><span class="line">         cf:21:42:a4</span><br></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>Kubernetes</category>
      </categories>
      <tags>
        <tag>ca</tag>
        <tag>è¯ä¹¦</tag>
        <tag>openssl</tag>
        <tag>crt</tag>
        <tag>key</tag>
        <tag>pem</tag>
      </tags>
  </entry>
  <entry>
    <title>Kubeletçš„è®¤è¯å’Œæˆæƒ</title>
    <url>/2018/10/08/Kubelet-%E7%9A%84%E8%AE%A4%E8%AF%81%E5%92%8C%E6%8E%88%E6%9D%83/</url>
    <content><![CDATA[<p>kubelet ä¸ kube-apiserver ä¹‹é—´çš„é€šä¿¡æ˜¯åŒå‘çš„, kubelet æ—¢éœ€è¦è®¿é—® kube-apiserver è·å–åˆ†é…åˆ°è‡ªå·±èŠ‚ç‚¹ä¸Šçš„ pod ä¿¡æ¯, kube-apiserver ä¹Ÿéœ€è¦ä¸»åŠ¨è®¿é—® kubelet æ‹‰å–æ—¥å¿—, çŠ¶æ€, ç›‘æ§æ•°æ®ç­‰ä¿¡æ¯, æ‰€ä»¥å¯¹ä¸¤ä¸ªç»„ä»¶æ¥è¯´, è®¤è¯æ˜¯åŒå‘çš„, kube-apiserver éœ€è¦æŒæœ‰ kubelet çš„å®¢æˆ·ç«¯è¯ä¹¦, ä»¥å®Œæˆ kubelet å¯¹è‡ªå·±èº«ä»½çš„æ ¡éªŒ; kubelet ä¹Ÿéœ€è¦æŒæœ‰ kube-apiserver çš„å®¢æˆ·ç«¯è¯ä¹¦, å®Œæˆ kube-apiserver å¯¹è‡ªå·±èº«ä»½çš„è®¤è¯.</p>
<h1 id="Kubelet-çš„è®¤è¯"><a href="#Kubelet-çš„è®¤è¯" class="headerlink" title="Kubelet çš„è®¤è¯"></a>Kubelet çš„è®¤è¯</h1><p>é»˜è®¤æƒ…å†µä¸‹, å¯¹ kubelet çš„ https è¯·æ±‚, å¦‚æœæ²¡æœ‰è¢«é…ç½®çš„å…¶ä»–èº«ä»½éªŒè¯æ‹’ç»çš„è¯, åˆ™è¢«è§†ä¸ºåŒ¿åè¯·æ±‚, å¹¶ä¸ºè¿™ä¸ªè¯·æ±‚èµ‹äºˆ<code>system:anonymous</code>ç”¨æˆ·åå’Œ<code>system:unauthenticated</code>ç”¨æˆ·ç»„</p>
<h2 id="ç¦ç”¨åŒ¿åè®¿é—®"><a href="#ç¦ç”¨åŒ¿åè®¿é—®" class="headerlink" title="ç¦ç”¨åŒ¿åè®¿é—®"></a>ç¦ç”¨åŒ¿åè®¿é—®</h2><p>å¦‚éœ€è¦ç¦ç”¨åŒ¿åè®¿é—®, å¯ä»¥åœ¨å¯åŠ¨ kubelet Daemon æ—¶åŠ å…¥<code>--anonymous-auth=false</code>é…ç½®, å½“æœ‰åŒ¿åè®¿é—®æ—¶, å°†å›å¤<code>401 Unauthorized</code>å“åº”æœªè®¤è¯çš„è¯·æ±‚</p>
<h2 id="å¼€å¯-X509-è®¤è¯"><a href="#å¼€å¯-X509-è®¤è¯" class="headerlink" title="å¼€å¯ X509 è®¤è¯"></a>å¼€å¯ X509 è®¤è¯</h2><ul>
<li>kubelet å¯åŠ¨æ—¶æ·»åŠ <code>--client-ca-file</code>å‚æ•°, å¹¶æŒ‡å®šç­¾å‘å®¢æˆ·ç«¯è¯ä¹¦çš„ ca æ ¹è¯ä¹¦æ‰€åœ¨è·¯å¾„</li>
<li>kube-apiserver å¯åŠ¨æ—¶æ·»åŠ <code>--kubelet-client-certificate</code>å’Œ<code>--kubelet-client-key</code>å‚æ•°, å¹¶åˆ†åˆ«ä¸ºå…¶æŒ‡å®šç”± kubelet ca æ ¹è¯ä¹¦ç­¾å‘çš„å®¢æˆ·ç«¯è¯ä¹¦å’Œç§˜é’¥</li>
</ul>
<h1 id="Kubelet-çš„æˆæƒ"><a href="#Kubelet-çš„æˆæƒ" class="headerlink" title="Kubelet çš„æˆæƒ"></a>Kubelet çš„æˆæƒ</h1><p>ä»»ä½•è¢«æˆåŠŸè®¤è¯çš„è¯·æ±‚(åŒ…æ‹¬åŒ¿åè¯·æ±‚)éƒ½å°†è¢«æˆæƒ. é»˜è®¤çš„æˆæƒæ¨¡å¼ä¸º<code>AlwaysAllow</code>, å³å…è®¸æ‰€æœ‰ç±»å‹çš„è¯·æ±‚</p>
<h2 id="ç»†åˆ†å¯¹-kubelet-API-è®¿é—®æƒé™çš„åŸå› "><a href="#ç»†åˆ†å¯¹-kubelet-API-è®¿é—®æƒé™çš„åŸå› " class="headerlink" title="ç»†åˆ†å¯¹ kubelet API è®¿é—®æƒé™çš„åŸå› "></a>ç»†åˆ†å¯¹ kubelet API è®¿é—®æƒé™çš„åŸå› </h2><ul>
<li>åŒ¿åè®¿é—®å¯ç”¨æ—¶, åº”é™åˆ¶å…¶è°ƒç”¨ kubelet API çš„èƒ½åŠ›</li>
<li>å®¢æˆ·ç«¯è¯ä¹¦èº«ä»½è®¤è¯å¯ç”¨æ—¶, åªå…è®¸é…ç½® CA ç­¾åçš„å®¢æˆ·ç«¯è¯ä¹¦ä½¿ç”¨ kubelet API</li>
</ul>
<h2 id="ç»†åˆ†æƒé™"><a href="#ç»†åˆ†æƒé™" class="headerlink" title="ç»†åˆ†æƒé™"></a>ç»†åˆ†æƒé™</h2><ul>
<li>ç¡®ä¿<code>authorization.k8s.io/v1beta1</code>è¯¥ API Group åœ¨ kube-apiserver ä¸­æ˜¯è¢«å¯åŠ¨çš„çŠ¶æ€</li>
<li>åœ¨ kubelet Daemon å¯åŠ¨å‚æ•°ä¸­, ç¡®ä¿é…ç½®äº†<code>--authorization-mode=Webhook</code>å’Œ<code>--kubeconfig</code>ä¸¤ä¸ªå‚æ•°</li>
</ul>
<p>kubelet åœ¨æ¥æ”¶åˆ°æ¯ä¸ªè¯·æ±‚å, ä¼šå‘æŒ‡å®šçš„ kube-apiserver å‘èµ· <code>SubjectAccessReview</code> API çš„è¯·æ±‚, æ¥ç¡®å®šè¯¥è¯·æ±‚æ˜¯å¦è¢«å…è®¸</p>
<hr>
<p><strong>å‚è€ƒæ–‡æ¡£</strong></p>
<ul>
<li>å®˜æ–¹æ–‡æ¡£  <a href="https://kubernetes.io/docs/reference/command-line-tools-reference/kubelet-authentication-authorization/" target="_blank" rel="noopener">https://kubernetes.io/docs/reference/command-line-tools-reference/kubelet-authentication-authorization/</a></li>
</ul>
]]></content>
      <categories>
        <category>Kubernetes</category>
      </categories>
      <tags>
        <tag>Kubernetes</tag>
        <tag>kubelet</tag>
        <tag>Authentication</tag>
        <tag>Authorization</tag>
      </tags>
  </entry>
  <entry>
    <title>è¯¦è§£kubeadmç”Ÿæˆçš„è¯ä¹¦</title>
    <url>/2018/09/28/%E8%AF%A6%E8%A7%A3kubeadm%E7%94%9F%E6%88%90%E7%9A%84%E8%AF%81%E4%B9%A6/</url>
    <content><![CDATA[<blockquote>
<p>å¦‚æœä½ ä½¿ç”¨è¿‡kubeadméƒ¨ç½²è¿‡Kubernetesçš„ç¯å¢ƒ, masterä¸»æœºèŠ‚ç‚¹ä¸Šå°±ä¸€å®šä¼šåœ¨ç›¸åº”çš„ç›®å½•åˆ›å»ºäº†ä¸€å¤§æ‰¹è¯ä¹¦æ–‡ä»¶, æœ¬ç¯‡æ–‡ç« å°±æ¥è¯´è¯´kubeadmåˆ°åº•ä¸ºæˆ‘ä»¬ç”Ÿæˆäº†å“ªäº›è¯ä¹¦</p>
</blockquote>
<p>åœ¨Kubernetesçš„éƒ¨ç½²ä¸­, åˆ›å»ºè¯ä¹¦, é…ç½®è¯ä¹¦æ˜¯ä¸€é“ç»•ä¸è¿‡å»åå„¿, å¥½åœ¨æœ‰kubeadmè¿™æ ·çš„è‡ªåŠ¨åŒ–å·¥å…·, å¸®æˆ‘ä»¬å»ç”Ÿæˆ, é…ç½®è¿™äº›è¯ä¹¦. å¯¹äºåªæ˜¯æƒ³ä½“éªŒKubernetesæˆ–åªæ˜¯æƒ³æµ‹è¯•çš„äº²æ¥è¯´, è¿™å·²ç»å¤Ÿäº†, ä½†æ˜¯ä½œä¸ºKubernetesçš„é›†ç¾¤ç»´æŠ¤è€…æ¥è¯´, kubeadmæ›´åƒæ˜¯ä¸€ä¸ªé»‘ç›’, æœ¬ç¯‡æ–‡ç« å°±æ¥è¯´è¯´é»‘ç›’ä¸­å…³äºè¯ä¹¦çš„äº‹å„¿~</p>
<p>ä½¿ç”¨kubeadmåˆ›å»ºå®ŒKubernetesé›†ç¾¤å, é»˜è®¤ä¼šåœ¨<code>/etc/kubernetes/pki</code>ç›®å½•ä¸‹å­˜æ”¾é›†ç¾¤ä¸­éœ€è¦ç”¨åˆ°çš„è¯ä¹¦æ–‡ä»¶, æ•´ä½“ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤º:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@k8s-master:&#x2F;etc&#x2F;kubernetes&#x2F;pki# tree</span><br><span class="line">.</span><br><span class="line">|-- apiserver.crt</span><br><span class="line">|-- apiserver-etcd-client.crt</span><br><span class="line">|-- apiserver-etcd-client.key</span><br><span class="line">|-- apiserver.key</span><br><span class="line">|-- apiserver-kubelet-client.crt</span><br><span class="line">|-- apiserver-kubelet-client.key</span><br><span class="line">|-- ca.crt</span><br><span class="line">|-- ca.key</span><br><span class="line">|-- etcd</span><br><span class="line">|   |-- ca.crt</span><br><span class="line">|   |-- ca.key</span><br><span class="line">|   |-- healthcheck-client.crt</span><br><span class="line">|   |-- healthcheck-client.key</span><br><span class="line">|   |-- peer.crt</span><br><span class="line">|   |-- peer.key</span><br><span class="line">|   |-- server.crt</span><br><span class="line">|   &#96;-- server.key</span><br><span class="line">|-- front-proxy-ca.crt</span><br><span class="line">|-- front-proxy-ca.key</span><br><span class="line">|-- front-proxy-client.crt</span><br><span class="line">|-- front-proxy-client.key</span><br><span class="line">|-- sa.key</span><br><span class="line">&#96;-- sa.pub</span><br><span class="line"></span><br><span class="line">1 directory, 22 files</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Š22ä¸ªæ–‡ä»¶å°±æ˜¯kubeadmä¸ºæˆ‘ä»¬åˆ›å»ºçš„æ‰€æœ‰è¯ä¹¦ç›¸å…³çš„æ–‡ä»¶, ä¸‹é¢æˆ‘ä»¬æ¥ä¸€ä¸€è§£æ</p>
<h2 id="è¯ä¹¦åˆ†ç»„"><a href="#è¯ä¹¦åˆ†ç»„" class="headerlink" title="è¯ä¹¦åˆ†ç»„"></a>è¯ä¹¦åˆ†ç»„</h2><p>KubernetesæŠŠè¯ä¹¦æ”¾åœ¨äº†ä¸¤ä¸ªæ–‡ä»¶å¤¹ä¸­</p>
<ul>
<li>/etc/kubernetes/pki</li>
<li>/etc/kubernetes/pki/etcd</li>
</ul>
<p>æˆ‘ä»¬å†å°†è¿™22ä¸ªæ–‡ä»¶æŒ‰ç…§æ›´ç»†çš„ç²’åº¦å»åˆ†ç»„</p>
<h2 id="Kubernetes-é›†ç¾¤æ ¹è¯ä¹¦"><a href="#Kubernetes-é›†ç¾¤æ ¹è¯ä¹¦" class="headerlink" title="Kubernetes é›†ç¾¤æ ¹è¯ä¹¦"></a>Kubernetes é›†ç¾¤æ ¹è¯ä¹¦</h2><p>Kubernetes é›†ç¾¤æ ¹è¯ä¹¦CA(Kubernetesé›†ç¾¤ç»„ä»¶çš„è¯ä¹¦ç­¾å‘æœºæ„)</p>
<ul>
<li><code>/etc/kubernetes/pki/ca.crt</code></li>
<li><code>/etc/kubernetes/pki/ca.key</code></li>
</ul>
<p>ä»¥ä¸Šè¿™ç»„è¯ä¹¦ä¸ºç­¾å‘å…¶ä»–Kubernetesç»„ä»¶è¯ä¹¦ä½¿ç”¨çš„æ ¹è¯ä¹¦, å¯ä»¥è®¤ä¸ºæ˜¯Kubernetesé›†ç¾¤ä¸­è¯ä¹¦ç­¾å‘æœºæ„ä¹‹ä¸€</p>
<p>ç”±æ­¤æ ¹è¯ä¹¦ç­¾å‘çš„è¯ä¹¦æœ‰:</p>
<ol>
<li><p>kube-apiserver ç»„ä»¶æŒæœ‰çš„æœåŠ¡ç«¯è¯ä¹¦</p>
<ul>
<li><code>/etc/kubernetes/pki/apiserver.crt</code></li>
<li><code>/etc/kubernetes/pki/apiserver.key</code></li>
</ul>
</li>
<li><p>kubelet ç»„ä»¶æŒæœ‰çš„å®¢æˆ·ç«¯è¯ä¹¦, ç”¨ä½œ kube-apiserver ä¸»åŠ¨å‘ kubelet å‘èµ·è¯·æ±‚æ—¶çš„å®¢æˆ·ç«¯è®¤è¯</p>
<ul>
<li><code>/etc/kubernetes/pki/apiserver-kubelet-client.crt</code></li>
<li><code>/etc/kubernetes/pki/apiserver-kubelet-client.key</code></li>
</ul>
</li>
</ol>
<blockquote>
<p>æ³¨æ„: Kubernetesé›†ç¾¤ç»„ä»¶ä¹‹é—´çš„äº¤äº’æ˜¯åŒå‘çš„, kubelet æ—¢éœ€è¦ä¸»åŠ¨è®¿é—® kube-apiserver, kube-apiserver ä¹Ÿéœ€è¦ä¸»åŠ¨å‘ kubelet å‘èµ·è¯·æ±‚, æ‰€ä»¥åŒæ–¹éƒ½éœ€è¦æœ‰è‡ªå·±çš„æ ¹è¯ä¹¦ä»¥åŠä½¿ç”¨è¯¥æ ¹è¯ä¹¦ç­¾å‘çš„æœåŠ¡ç«¯è¯ä¹¦å’Œå®¢æˆ·ç«¯è¯ä¹¦. åœ¨ kube-apiserver ä¸­, ä¸€èˆ¬æ˜ç¡®æŒ‡å®šç”¨äº https è®¿é—®çš„æœåŠ¡ç«¯è¯ä¹¦å’Œå¸¦æœ‰<code>CN ç”¨æˆ·å</code>ä¿¡æ¯çš„å®¢æˆ·ç«¯è¯ä¹¦. è€Œåœ¨ kubelet çš„å¯åŠ¨é…ç½®ä¸­, ä¸€èˆ¬åªæŒ‡å®šäº† ca æ ¹è¯ä¹¦, è€Œæ²¡æœ‰æ˜ç¡®æŒ‡å®šç”¨äº https è®¿é—®çš„æœåŠ¡ç«¯è¯ä¹¦, è¿™æ˜¯å› ä¸º, åœ¨ç”ŸæˆæœåŠ¡ç«¯è¯ä¹¦æ—¶, ä¸€èˆ¬ä¼šæŒ‡å®šæœåŠ¡ç«¯åœ°å€æˆ–ä¸»æœºå, kube-apiserver ç›¸å¯¹å˜åŒ–ä¸æ˜¯å¾ˆé¢‘ç¹, æ‰€ä»¥åœ¨åˆ›å»ºé›†ç¾¤ä¹‹åˆå°±å¯ä»¥é¢„å…ˆåˆ†é…å¥½ç”¨ä½œ kube-apiserver çš„ IP æˆ–ä¸»æœºå/åŸŸå, ä½†æ˜¯ç”±äºéƒ¨ç½²åœ¨ node èŠ‚ç‚¹ä¸Šçš„ kubelet ä¼šå› ä¸ºé›†ç¾¤è§„æ¨¡çš„å˜åŒ–è€Œé¢‘ç¹å˜åŒ–, è€Œæ— æ³•é¢„çŸ¥ node çš„æ‰€æœ‰ IP ä¿¡æ¯, æ‰€ä»¥ kubelet ä¸Šä¸€èˆ¬ä¸ä¼šæ˜ç¡®æŒ‡å®šæœåŠ¡ç«¯è¯ä¹¦, è€Œæ˜¯åªæŒ‡å®š ca æ ¹è¯ä¹¦, è®© kubelet æ ¹æ®æœ¬åœ°ä¸»æœºä¿¡æ¯è‡ªåŠ¨ç”ŸæˆæœåŠ¡ç«¯è¯ä¹¦å¹¶ä¿å­˜åˆ°é…ç½®çš„<code>cert-dir</code>æ–‡ä»¶å¤¹ä¸­.</p>
</blockquote>
<p>å¥½äº†, è‡³æ­¤, Kubernetesé›†ç¾¤æ ¹è¯ä¹¦æ‰€ç­¾å‘çš„è¯ä¹¦éƒ½åœ¨ä¸Šé¢äº†, ç®—ä¸Šæ ¹è¯ä¹¦ä¸€å…±æ¶‰åŠåˆ°6ä¸ªæ–‡ä»¶, 22-6=16, æˆ‘ä»¬è¿˜å‰©ä¸‹16ä¸ªæ–‡ä»¶</p>
<h2 id="æ±‡èšå±‚è¯ä¹¦"><a href="#æ±‡èšå±‚è¯ä¹¦" class="headerlink" title="æ±‡èšå±‚è¯ä¹¦"></a>æ±‡èšå±‚è¯ä¹¦</h2><p>kube-apiserver çš„å¦ä¸€ç§è®¿é—®æ–¹å¼å°±æ˜¯ä½¿ç”¨ <code>kubectl proxy</code> æ¥ä»£ç†è®¿é—®, è€Œè¯¥è¯ä¹¦å°±æ˜¯ç”¨æ¥æ”¯æŒSSLä»£ç†è®¿é—®çš„. åœ¨è¯¥ç§è®¿é—®æ¨¡å¼ä¸‹, æˆ‘ä»¬æ˜¯ä»¥httpçš„æ–¹å¼å‘èµ·è¯·æ±‚åˆ°ä»£ç†æœåŠ¡çš„, æ­¤æ—¶, ä»£ç†æœåŠ¡ä¼šå°†è¯¥è¯·æ±‚å‘é€ç»™ kube-apiserver, åœ¨æ­¤ä¹‹å‰, ä»£ç†ä¼šå°†å‘é€ç»™ kube-apiserver çš„è¯·æ±‚å¤´é‡ŒåŠ å…¥è¯ä¹¦ä¿¡æ¯, ä»¥ä¸‹ä¸¤ä¸ªé…ç½®</p>
<p>API Aggregationå…è®¸åœ¨ä¸ä¿®æ”¹Kubernetesæ ¸å¿ƒä»£ç çš„åŒæ—¶æ‰©å±•Kubernetes API.  å¼€å¯ API Aggregation éœ€è¦åœ¨ kube-apiserver ä¸­æ·»åŠ å¦‚ä¸‹é…ç½®:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">--requestheader-client-ca-file&#x3D;&lt;path to aggregator CA cert&gt;</span><br><span class="line">--requestheader-allowed-names&#x3D;front-proxy-client</span><br><span class="line">--requestheader-extra-headers-prefix&#x3D;X-Remote-Extra-</span><br><span class="line">--requestheader-group-headers&#x3D;X-Remote-Group</span><br><span class="line">--requestheader-username-headers&#x3D;X-Remote-User</span><br><span class="line">--proxy-client-cert-file&#x3D;&lt;path to aggregator proxy cert&gt;</span><br><span class="line">--proxy-client-key-file&#x3D;&lt;path to aggregator proxy key&gt;</span><br></pre></td></tr></table></figure>

<p><strong>å®˜æ–¹è­¦å‘Š: é™¤éä½ äº†è§£ä¿æŠ¤ CA ä½¿ç”¨çš„é£é™©å’Œæœºåˆ¶, å¦åˆ™ä¸è¦åœ¨ä¸é€šä¸Šä¸‹æ–‡ä¸­é‡ç”¨å·²ç»ä½¿ç”¨è¿‡çš„ CA</strong></p>
<p>å¦‚æœ kube-proxy æ²¡æœ‰å’Œ API server è¿è¡Œåœ¨åŒä¸€å°ä¸»æœºä¸Šï¼Œé‚£ä¹ˆéœ€è¦ç¡®ä¿å¯ç”¨äº†å¦‚ä¸‹ apiserver æ ‡è®°ï¼š</p>
<p><code>--enable-aggregator-routing=true</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">å®¢æˆ·ç«¯ ---å‘èµ·è¯·æ±‚---&gt; ä»£ç† ---Add Header:å‘èµ·è¯·æ±‚---&gt; kube-apiserver</span><br><span class="line">                   (å®¢æˆ·ç«¯è¯ä¹¦)                        (æœåŠ¡ç«¯è¯ä¹¦)</span><br></pre></td></tr></table></figure>

<p>kube-apiserver ä»£ç†æ ¹è¯ä¹¦(å®¢æˆ·ç«¯è¯ä¹¦)</p>
<p>ç”¨åœ¨<code>requestheader-client-ca-file</code>é…ç½®é€‰é¡¹ä¸­, kube-apiserver ä½¿ç”¨è¯¥è¯ä¹¦æ¥éªŒè¯å®¢æˆ·ç«¯è¯ä¹¦æ˜¯å¦ä¸ºè‡ªå·±æ‰€ç­¾å‘</p>
<ul>
<li><code>/etc/kubernetes/pki/front-proxy-ca.crt</code></li>
<li><code>/etc/kubernetes/pki/front-proxy-ca.key</code></li>
</ul>
<p>ç”±æ­¤æ ¹è¯ä¹¦ç­¾å‘çš„è¯ä¹¦åªæœ‰ä¸€ç»„:</p>
<p>ä»£ç†å±‚(å¦‚æ±‡èšå±‚aggregator)ä½¿ç”¨æ­¤å¥—ä»£ç†è¯ä¹¦æ¥å‘ kube-apiserver è¯·æ±‚è®¤è¯</p>
<ol>
<li>ä»£ç†ç«¯ä½¿ç”¨çš„å®¢æˆ·ç«¯è¯ä¹¦, ç”¨ä½œä»£ç”¨æˆ·ä¸ kube-apiserver è®¤è¯<ul>
<li><code>/etc/kubernetes/pki/front-proxy-client.crt</code></li>
<li><code>/etc/kubernetes/pki/front-proxy-client.key</code></li>
</ul>
</li>
</ol>
<p>å‚è€ƒæ–‡æ¡£:</p>
<ul>
<li>kube-apiserver é…ç½®å‚æ•°: <a href="https://kubernetes.io/docs/reference/command-line-tools-reference/kube-apiserver/" target="_blank" rel="noopener">https://kubernetes.io/docs/reference/command-line-tools-reference/kube-apiserver/</a></li>
<li>ä½¿ç”¨æ±‡èšå±‚æ‰©å±• Kubernetes API: <a href="https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/apiserver-aggregation/" target="_blank" rel="noopener">https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/apiserver-aggregation/</a></li>
<li>é…ç½®æ±‡èšå±‚: <a href="https://kubernetes.io/docs/tasks/access-kubernetes-api/configure-aggregation-layer/" target="_blank" rel="noopener">https://kubernetes.io/docs/tasks/access-kubernetes-api/configure-aggregation-layer/</a></li>
</ul>
<p>è‡³æ­¤, åˆ¨é™¤ä»£ç†ä¸“ç”¨çš„è¯ä¹¦å¤–, è¿˜å‰©ä¸‹ 16-4=12 ä¸ªæ–‡ä»¶</p>
<h2 id="etcd-é›†ç¾¤æ ¹è¯ä¹¦"><a href="#etcd-é›†ç¾¤æ ¹è¯ä¹¦" class="headerlink" title="etcd é›†ç¾¤æ ¹è¯ä¹¦"></a>etcd é›†ç¾¤æ ¹è¯ä¹¦</h2><p>etcdé›†ç¾¤æ‰€ç”¨åˆ°çš„è¯ä¹¦éƒ½ä¿å­˜åœ¨<code>/etc/kubernetes/pki/etcd</code>è¿™è·¯å¾„ä¸‹, å¾ˆæ˜æ˜¾, è¿™ä¸€å¥—è¯ä¹¦æ˜¯ç”¨æ¥ä¸“é—¨ç»™etcdé›†ç¾¤æœåŠ¡ä½¿ç”¨çš„, è®¾è®¡ä»¥ä¸‹è¯ä¹¦æ–‡ä»¶</p>
<p>etcd é›†ç¾¤æ ¹è¯ä¹¦CA(etcd æ‰€ç”¨åˆ°çš„æ‰€æœ‰è¯ä¹¦çš„ç­¾å‘æœºæ„)</p>
<ul>
<li><code>/etc/kubernetes/pki/etcd/ca.crt</code></li>
<li><code>/etc/kubernetes/pki/etcd/ca.key</code></li>
</ul>
<p>ç”±æ­¤æ ¹è¯ä¹¦ç­¾å‘æœºæ„ç­¾å‘çš„è¯ä¹¦æœ‰:</p>
<ol>
<li><p>etcd server æŒæœ‰çš„æœåŠ¡ç«¯è¯ä¹¦</p>
<ul>
<li><code>/etc/kubernetes/pki/etcd/server.crt</code></li>
<li><code>/etc/kubernetes/pki/etcd/server.key</code></li>
</ul>
</li>
<li><p>peer é›†ç¾¤ä¸­èŠ‚ç‚¹äº’ç›¸é€šä¿¡ä½¿ç”¨çš„å®¢æˆ·ç«¯è¯ä¹¦</p>
<ul>
<li><p><code>/etc/kubernetes/pki/etcd/peer.crt</code></p>
</li>
<li><p><code>/etc/kubernetes/pki/etcd/peer.key</code></p>
<p>æ³¨: Peerï¼šå¯¹åŒä¸€ä¸ªetcdé›†ç¾¤ä¸­å¦å¤–ä¸€ä¸ªMemberçš„ç§°å‘¼</p>
</li>
</ul>
</li>
<li><p>pod ä¸­å®šä¹‰ Liveness æ¢é’ˆä½¿ç”¨çš„å®¢æˆ·ç«¯è¯ä¹¦</p>
<p>kubeadm éƒ¨ç½²çš„ Kubernetes é›†ç¾¤æ˜¯ä»¥ pod çš„æ–¹å¼è¿è¡Œ etcd æœåŠ¡çš„, åœ¨è¯¥ pod çš„å®šä¹‰ä¸­, é…ç½®äº† Liveness æ¢æ´»æ¢é’ˆ</p>
<ul>
<li><p><code>/etc/kubernetes/pki/etcd/healthcheck-client.crt</code></p>
</li>
<li><p><code>/etc/kubernetes/pki/etcd/healthcheck-client.key</code></p>
<p>å½“ä½  describe etcd çš„ pod æ—¶, ä¼šçœ‹åˆ°å¦‚ä¸‹ä¸€è¡Œé…ç½®:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Liveness:       exec [&#x2F;bin&#x2F;sh -ec ETCDCTL_API&#x3D;3 etcdctl --endpoints&#x3D;https:&#x2F;&#x2F;[127.0.0.1]:2379 --cacert&#x3D;&#x2F;etc&#x2F;kubernetes&#x2F;pki&#x2F;etcd&#x2F;ca.crt --cert&#x3D;&#x2F;etc&#x2F;kubernetes&#x2F;pki&#x2F;etcd&#x2F;healthcheck-client.crt --key&#x3D;&#x2F;etc&#x2F;kubernetes&#x2F;pki&#x2F;etcd&#x2F;healthcheck-client.key get foo] delay&#x3D;15s timeout&#x3D;15s period&#x3D;10s #success&#x3D;1 #failure&#x3D;8</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>é…ç½®åœ¨ kube-apiserver ä¸­ç”¨æ¥ä¸ etcd server åšåŒå‘è®¤è¯çš„å®¢æˆ·ç«¯è¯ä¹¦</p>
<ul>
<li><code>/etc/kubernetes/pki/apiserver-etcd-client.crt</code></li>
<li><code>/etc/kubernetes/pki/apiserver-etcd-client.key</code></li>
</ul>
</li>
</ol>
<p>è‡³æ­¤, ä»‹ç»äº†æ¶‰åŠåˆ° etcd æœåŠ¡çš„10ä¸ªè¯ä¹¦æ–‡ä»¶, 12-10=2, ä»…å‰©ä¸¤ä¸ªæ²¡æœ‰ä»‹ç»åˆ°çš„æ–‡ä»¶å•¦, èƒœåˆ©âœŒï¸åœ¨æœ›, åšæŒä¸€ä¸‹~</p>
<h2 id="Serveice-Accountç§˜é’¥"><a href="#Serveice-Accountç§˜é’¥" class="headerlink" title="Serveice Accountç§˜é’¥"></a>Serveice Accountç§˜é’¥</h2><p>æœ€åä»‹ç»çš„è¿™ç»„â€è¯ä¹¦â€å…¶å®ä¸æ˜¯è¯ä¹¦, è€Œæ˜¯ä¸€ç»„ç§˜é’¥. çœ‹ç€åç¼€åæ˜¯ä¸æ˜¯æœ‰ç‚¹çœ¼ç†Ÿå‘¢, æ²¡é”™, è¿™ç»„ç§˜é’¥å¯¹å„¿å…¶å®è·Ÿæˆ‘ä»¬åœ¨Linuxä¸Šåˆ›å»º, ç”¨äºå…å¯†ç™»å½•çš„å¯†é’¥å¯¹å„¿åŸç†æ˜¯ä¸€æ ·çš„~</p>
<blockquote>
<p>è¿™ç»„çš„å¯†é’¥å¯¹å„¿ä»…æä¾›ç»™ kube-controller-manager ä½¿ç”¨. kube-controller-manager é€šè¿‡ sa.key å¯¹ token è¿›è¡Œç­¾å, master èŠ‚ç‚¹é€šè¿‡å…¬é’¥ sa.pub è¿›è¡Œç­¾åçš„éªŒè¯</p>
</blockquote>
<ul>
<li><code>/etc/kubernetes/pki/sa.key</code></li>
<li><code>/etc/kubernetes/pki/sa.pub</code></li>
</ul>
<p>è‡³æ­¤, kubeadm å·¥å…·å¸®æˆ‘ä»¬åˆ›å»ºçš„æ‰€æœ‰è¯ä¹¦æ–‡ä»¶éƒ½å·²ç»ä»‹ç»å®Œäº†, æ•´ä¸ª Kubernetes&amp;etcd é›†ç¾¤ä¸­æ‰€æ¶‰åŠåˆ°çš„ç»å¤§éƒ¨åˆ†è¯ä¹¦éƒ½å·®ä¸å¤šåœ¨è¿™é‡Œäº†. æœ‰çš„è¡Œå®¶å¯èƒ½ä¼šçœ‹å‡ºæ¥, è‡³å°‘è¿˜å°‘äº†ä¸€ç»„è¯ä¹¦å‘€, å°±æ˜¯ kube-proxy æŒæœ‰çš„è¯ä¹¦æ€ä¹ˆæ²¡æœ‰è‡ªåŠ¨ç”Ÿæˆå‘€. å› ä¸º kubeadm åˆ›å»ºçš„é›†ç¾¤, kube-proxy æ˜¯ä»¥ pod å½¢å¼è¿è¡Œçš„, åœ¨ pod ä¸­, ç›´æ¥ä½¿ç”¨ service account ä¸ kube-apiserver è¿›è¡Œè®¤è¯, æ­¤æ—¶å°±ä¸éœ€è¦å†å•ç‹¬ä¸º kube-proxy åˆ›å»ºè¯ä¹¦äº†. å¦‚æœä½ çš„ kube-proxy æ˜¯ä»¥å®ˆæŠ¤è¿›ç¨‹çš„æ–¹å¼ç›´æ¥è¿è¡Œåœ¨å®¿ä¸»æœºçš„, é‚£ä¹ˆä½ å°±éœ€è¦ä¸ºå®ƒåˆ›å»ºä¸€å¥—è¯ä¹¦äº†. åˆ›å»ºçš„æ–¹å¼ä¹Ÿå¾ˆç®€å•, ç›´æ¥ä½¿ç”¨ä¸Šé¢ç¬¬ä¸€æ¡æåˆ°çš„ <code>Kubernetes é›†ç¾¤æ ¹è¯ä¹¦</code> è¿›è¡Œç­¾å‘å°±å¯ä»¥äº†(æ³¨æ„CNå’ŒOçš„è®¾ç½®)</p>
<p>ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­, å°†å®é™…æ“ä½œåˆ›å»ºæ‰€æœ‰è¯ä¹¦çš„æµç¨‹(å«kube-proxyè¯ä¹¦), å¹¶é€ä¸€è§£é‡Šå‚æ•°çš„ä½¿ç”¨</p>
<hr>
<p>å‚è€ƒæ–‡æ¡£:</p>
<ul>
<li>PKI è®¤è¯: <a href="https://kubernetes.io/docs/setup/certificates/" target="_blank" rel="noopener">https://kubernetes.io/docs/setup/certificates/</a></li>
</ul>
]]></content>
      <categories>
        <category>Kubernetes</category>
      </categories>
      <tags>
        <tag>Kubernetes</tag>
        <tag>è¯ä¹¦</tag>
        <tag>crt</tag>
        <tag>key</tag>
        <tag>pem</tag>
        <tag>kubeadm</tag>
      </tags>
  </entry>
  <entry>
    <title>HTTPåŸºæœ¬æ¦‚å¿µ</title>
    <url>/2018/09/18/HTTP%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/</url>
    <content><![CDATA[<p>#HTTPå‘å±•å†å²</p>
<h2 id="HTTP-0-9"><a href="#HTTP-0-9" class="headerlink" title="HTTP 0.9"></a>HTTP 0.9</h2><ul>
<li>åªæœ‰ä¸€ä¸ªGETæ–¹æ³•</li>
<li>æ²¡æœ‰headerç­‰æè¿°æ•°æ®ä¿¡æ¯</li>
<li>æœåŠ¡å™¨å‘é€å®Œæ¯•, å°±å…³é—­TCPè¿æ¥</li>
</ul>
<h2 id="HTTP-1-0"><a href="#HTTP-1-0" class="headerlink" title="HTTP 1.0"></a>HTTP 1.0</h2><ul>
<li>å¢åŠ äº†å¾ˆå¤šæ–¹æ³•, ä¾‹å¦‚POST, PUT, DELETEç­‰</li>
<li>å¢åŠ äº†status codeå’Œheader</li>
<li>å¢åŠ äº†å¤šå­—ç¬¦é›†çš„æ”¯æŒ, å¤šéƒ¨åˆ†å‘é€, æƒé™, ç¼“å­˜ç­‰</li>
</ul>
<h2 id="HTTP-1-1"><a href="#HTTP-1-1" class="headerlink" title="HTTP 1.1"></a>HTTP 1.1</h2><ul>
<li>æŒä¹…è¿æ¥/é•¿è¿æ¥</li>
<li>Pipeline å®¢æˆ·ç«¯å¯ä»¥åœ¨åŒä¸€ä¸ªè¿æ¥ä¸­å‘é€å¤šä¸ªè¯·æ±‚, æœåŠ¡ç«¯æŒ‰é¡ºåºè¿”å›(ä¸²è¡Œ)</li>
<li>å¢åŠ hostå¤´, æœ‰äº†hostä¹‹åå¯ä»¥å®ç°ä¸€å°webæœåŠ¡å¯ä»¥æ¥æ”¶/å¤„ç†å¤šä¸ªåŸŸåçš„è¯·æ±‚</li>
<li>å¢åŠ äº†å…¶ä»–æ›´å¤šçš„æ–¹æ³•</li>
</ul>
<h2 id="HTTP-2-0"><a href="#HTTP-2-0" class="headerlink" title="HTTP 2.0"></a>HTTP 2.0</h2><ul>
<li>2.0æ‰€æœ‰çš„æ•°æ®ä»¥äºŒè¿›åˆ¶è¿›è¡Œä¼ è¾“(å¸§), åœ¨1.1å¤§éƒ¨åˆ†æ˜¯ä»¥å­—ç¬¦ä¸²çš„å½¢å¼ä¼ è¾“</li>
<li>å¾—ç›ŠäºåŸºäºå¸§çš„ä¼ è¾“, å¯ä»¥å®ç°åœ¨åŒä¸€ä¸ªè¿æ¥é‡Œé¢å‘é€å¤šä¸ªè¯·æ±‚ä¸å†éœ€è¦æŒ‰é¡ºåºæ¥è¿”å›(å¹¶è¡Œ)</li>
<li>å¤´ä¿¡æ¯å‹ç¼©, 1.1çš„headerå¤´ä»¥å­—ç¬¦ä¸²çš„å½¢å¼è¿›è¡Œä¼ è¾“, å ç”¨äº†å¤§é‡å¸¦å®½</li>
<li>æ¨é€, 1.1ä¹‹å‰åªæ”¯æŒå®¢æˆ·ç«¯ä¸»åŠ¨å‘æœåŠ¡ç«¯å‘èµ·è¯·æ±‚, æœåŠ¡ç«¯è¢«åŠ¨å‘å®¢æˆ·ç«¯å“åº”è¯·æ±‚; 2.0ä¹‹åæœåŠ¡å¯ä»¥ä¸»åŠ¨å‘å®¢æˆ·ç«¯å‘é€æ•°æ®(ä¾‹å­ğŸŒ°: å®¢æˆ·ç«¯åœ¨å‘èµ·è¯·æ±‚è®¿é—®æœåŠ¡ç«¯é¡µé¢æ—¶, å…ˆè¯·æ±‚htmlé¡µé¢, å½“å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡ç«¯å‘æ¥çš„htmlæ•°æ®ä¹‹å, å®¢æˆ·ç«¯æµè§ˆå™¨è¿›è¡Œè§£æå¹¶æ¸²æŸ“, åœ¨å…¶ä¸­, å‘ç°äº†å¼•ç”¨åˆ°äº†å…¶ä»–æ–‡ä»¶, å¦‚css, jsæ–‡ä»¶, å‡ä»¥urlé“¾æ¥å½¢å¼å¼•ç”¨, æ­¤æ—¶æµè§ˆå™¨ä¼šæŒ‰é¡ºåºå†æ¬¡å¯¹æ–°çš„èµ„æºå‘èµ·è¯·æ±‚; 2.0ä¸­, æ­¤åœºæ™¯ä¸‹, å®¢æˆ·ç«¯åœ¨è¯·æ±‚äº†htmlé¡µé¢å, æœåŠ¡ç«¯å¯ä»¥å®ç°ä¸»åŠ¨å°†css, jsæ•°æ®æ¨é€åˆ°å®¢æˆ·ç«¯, ä»è€Œè§£å†³äº†1.1ä¸²è¡Œè¯·æ±‚èµ„æºçš„æ€§èƒ½ä½ä¸‹é—®é¢˜. å¹¶ä¸”æœåŠ¡ç«¯ä¸»åŠ¨æ¨é€èµ„æºåˆ°å®¢æˆ·ç«¯, ä¹Ÿå¯ä»¥è§£å†³å®¢æˆ·ç«¯å› å„ç§åŸå› , è¯·æ±‚ä¸åˆ°æŒ‡å®šèµ„æºçš„æƒ…å†µ)</li>
</ul>
<p>2.0 ä»¥æé«˜æ•ˆç‡ä¸ºä¸»è¦ç›®æ ‡å¯¹1.1è¿›è¡Œäº†å¤§é‡æ”¹è¿›</p>
<h1 id="ç»å…¸äº”å±‚æ¨¡å‹"><a href="#ç»å…¸äº”å±‚æ¨¡å‹" class="headerlink" title="ç»å…¸äº”å±‚æ¨¡å‹"></a>ç»å…¸äº”å±‚æ¨¡å‹</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">åº”ç”¨å±‚  â€”&gt; HTTP&#x2F;FTP</span><br><span class="line">    ğŸ”½</span><br><span class="line">ä¼ è¾“å±‚  â€”&gt; TCP&#x2F;UDP</span><br><span class="line">    ğŸ”½</span><br><span class="line">ç½‘ç»œå±‚: æ•°æ®åœ¨èŠ‚ç‚¹ä¹‹é—´ä¼ è¾“åˆ›å»ºé€»è¾‘é“¾è·¯</span><br><span class="line">    ğŸ”½</span><br><span class="line">æ•°æ®é“¾è·¯å±‚: åœ¨é€šä¿¡çš„å®ä½“é—´å»ºç«‹æ•°æ®é“¾è·¯è¿æ¥(0101)</span><br><span class="line">    ğŸ”½</span><br><span class="line">ç‰©ç†å±‚: å®šä¹‰ç‰©ç†è®¾å¤‡å¦‚ä½•ä¼ è¾“æ•°æ®</span><br></pre></td></tr></table></figure>

<h2 id="ä¼ è¾“å±‚"><a href="#ä¼ è¾“å±‚" class="headerlink" title="ä¼ è¾“å±‚"></a>ä¼ è¾“å±‚</h2><p>å‘ç”¨æˆ·æä¾›å¯é çš„ç«¯åˆ°ç«¯çš„æœåŠ¡, ä¼ è¾“å±‚å‘é«˜å±‚å±è”½äº†ä¸‹å±‚æ•°æ®é€šä¿¡çš„ç»†èŠ‚</p>
<h2 id="åº”ç”¨å±‚"><a href="#åº”ç”¨å±‚" class="headerlink" title="åº”ç”¨å±‚"></a>åº”ç”¨å±‚</h2><p>ä¸ºåº”ç”¨è½¯ä»¶æä¾›æœåŠ¡, æ„å»ºåœ¨ä¼ è¾“å±‚åè®®ä¹‹ä¸Š, å±è”½ç½‘ç»œé€šä¿¡ç»†èŠ‚</p>
<h1 id="HTTP-TCP-çš„ä¸‰æ¬¡æ¡æ‰‹"><a href="#HTTP-TCP-çš„ä¸‰æ¬¡æ¡æ‰‹" class="headerlink" title="HTTP(TCP)çš„ä¸‰æ¬¡æ¡æ‰‹"></a>HTTP(TCP)çš„ä¸‰æ¬¡æ¡æ‰‹</h1><p>ä¸‰æ¬¡æ¡æ‰‹æ˜¯TCPè¿æ¥ä¸­çš„æ¦‚å¿µ,  HTTPä¸å­˜åœ¨è¿æ¥çš„æ¦‚å¿µ, HTTPåªæœ‰è¯·æ±‚å’Œå“åº”çš„æ¦‚å¿µ</p>
<p>æ¯ä¸ªHTTPçš„è¯·æ±‚ä¸å“åº”éƒ½æ˜¯éœ€è¦åŸºäºä¸€ä¸ªTCPçš„è¿æ¥çš„</p>
<p>User http requests â€”â€”â€”â€” <code>TCP connection</code> â€”â€”â€”â€” Server http response</p>
<p>åœ¨HTTP 1.0 ç‰ˆæœ¬ä¸­, å®¢æˆ·ç«¯å‘èµ·ä¸€ä¸ªHTTPè¯·æ±‚, æ­¤æ—¶, ä¼šåˆ›å»ºä¸€æ¡TCPè¿æ¥é€šé“, åœ¨æœåŠ¡ç«¯å¤„ç†å®Œæ¯•, å“åº”ç»™å®¢æˆ·ç«¯ä¹‹å, è¿™æ¡TCPè¿æ¥å°±ä¼šè¢«æ–­æ‰</p>
<p>åœ¨HTTP 1.1ç‰ˆæœ¬ä¸­, é€šè¿‡å£°æ˜ç‰¹æ®Šçš„å±æ€§, å¯ä»¥å®ç°ä¸€ä¸ªTCPè¿æ¥ä¸Š, å¯ä»¥å‘é€å¤šä¸ªHTTPè¯·æ±‚(é•¿è¿æ¥/Keepalive)</p>
<p>åœ¨HTTP 2.0 ç‰ˆæœ¬ä¸­, å¯ä»¥å®ç°, åŒä¸€ä¸ªå®¢æˆ·ç«¯è¯·æ±‚åŒä¸€ä¸ªæœåŠ¡ç«¯, åªéœ€è¦ä¸€ä¸ªTCPè¿æ¥å³å¯, å› ä¸º2.0ç‰ˆæœ¬æ”¯æŒå¹¶è¡Œå‘é€è¯·æ±‚, å’Œå¹¶è¡Œæ¥æ”¶è¯·æ±‚, ä¸éœ€è¦å†é¢å¤–åˆ›å»ºæ›´å¤šçš„TCPè¿æ¥</p>
<h2 id="ä¸‰æ¬¡æ¡æ‰‹"><a href="#ä¸‰æ¬¡æ¡æ‰‹" class="headerlink" title="ä¸‰æ¬¡æ¡æ‰‹"></a>ä¸‰æ¬¡æ¡æ‰‹</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">client                                                 server</span><br><span class="line">    â€”â€”â€”â€”â€”â€”â€”SYN&#x3D;1, Seq&#x3D;xâ€”â€”â€”â€”â€”â€” &gt;</span><br><span class="line">    &lt;â€”â€”SYN&#x3D;1, ACK&#x3D;x+1, Seq&#x3D;Yâ€”â€”</span><br><span class="line">    â€”â€”â€”â€”â€”â€”â€”ACK&#x3D;Y+1, Seq&#x3D;Zâ€”â€”â€”â€”&gt;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>TCP/HTTP</category>
      </categories>
      <tags>
        <tag>HTTP</tag>
        <tag>TCP</tag>
      </tags>
  </entry>
  <entry>
    <title>Goé¢å‘å¯¹è±¡ä¹‹ç»“æ„ä½“å’Œæ–¹æ³•</title>
    <url>/2018/08/14/Go%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E4%B9%8B%E7%BB%93%E6%9E%84%E4%BD%93%E5%92%8C%E6%96%B9%E6%B3%95/</url>
    <content><![CDATA[<blockquote>
<p>goè¯­è¨€åªæ”¯æŒå°è£…, ä¸æ”¯æŒç»§æ‰¿å’Œå¤šæ€. Javaæ˜¯å…¸å‹çš„æ”¯æŒé¢å‘å¯¹è±¡çš„è¯­è¨€ä¹‹ä¸€, ä»–æœ¬èº«æ”¯æŒé¢å‘å¯¹è±¡çš„ä¸‰å¤§ç‰¹å¾, å°è£…ç»§æ‰¿å’Œå¤šæ€; åˆ°äº†Pythonä¸­, Pythonæ˜¾å¼çš„æ”¯æŒå°è£…å’Œç»§æ‰¿, Pythonå¤šæ€çš„ç‰¹æ€§å¤§å®¶äº‰è®ºä¸ä¼‘, è™½ç„¶Pythonæ²¡æœ‰æ˜¾å¼çš„å¤šæ€è¯­æ³•, ä½†æ˜¯ç”±äºPythonè¿™ç§åŠ¨æ€è¯­è¨€çš„è®¾è®¡, ä»–æœ¬èº«å°±æ˜¯å¤šæ€çš„; åˆ°äº†Goè¿™é‡Œ, å´åªæ”¯æŒå°è£…äº†, ä¸å…¶è¯´Goè¯­è¨€æ˜¯ä¸€ç§é¢å‘å¯¹è±¡çš„è¯­è¨€, å€’ä¸å¦‚è¯´ä»–æ˜¯ä¸€ç§é¢å‘æ¥å£çš„è¯­è¨€</p>
</blockquote>
<p>goè¯­è¨€æ²¡æœ‰class, åªæœ‰struct, Goè¯­è¨€ä¸­ä¹Ÿæ²¡æœ‰æ„é€ å‡½æ•°çš„è¯´æ³•</p>
<h1 id="å®šä¹‰ç»“æ„ä½“"><a href="#å®šä¹‰ç»“æ„ä½“" class="headerlink" title="å®šä¹‰ç»“æ„ä½“"></a>å®šä¹‰ç»“æ„ä½“</h1><p>åœ¨ç»“æ„ä½“ä¸­, å¯ä»¥ä¸ºä¸åŒçš„keyå®šä¹‰ä¸åŒçš„æ•°æ®ç±»å‹, ç»“æ„ä½“æ˜¯ç”±ä¸€ç³»åˆ—å…·æœ‰ç›¸åŒç±»å‹æˆ–ä¸åŒç±»å‹çš„æ•°æ®æ„æˆçš„æ•°æ®é›†åˆ</p>
<p>ç»“æ„ä½“æ›´ç±»ä¼¼äºåœ¨ä¼ ç»Ÿçš„åˆ†å±‚å¼€å‘é¢†åŸŸä¸­çš„moduleå±‚(å®ä½“å±‚), ä¸€èˆ¬æƒ…å†µä¸‹, å®ä½“å±‚ä¸­çš„æ¯ä¸ªæˆå‘˜å±æ€§éƒ½å¯¹åº”äº†æ•°æ®åº“ä¸­æ•°æ®è¡¨çš„ä¸€ä¸ªå­—æ®µ, å®åŠ›å±‚å­˜åœ¨çš„æ„ä¹‰åœ¨äºä»¥å¯¹è±¡çš„å½¢å¼è¿›è¡Œä¼ å€¼. æ‹¿ä¸‰å±‚å¼€å‘æ¥è¯´, ä¸€èˆ¬åˆ†ä¸ºè¡¨ç¤ºå±‚/æ¥å£å±‚, ä¸šåŠ¡é€»è¾‘å±‚, æ•°æ®è®¿é—®å±‚. æ¯å±‚ä¸æ¯å±‚ä¹‹é—´çš„æ•°æ®æµè½¬æ­£æ˜¯é€šè¿‡å¼•å…¥çš„å®ä½“å±‚, å®ä¾‹åŒ–å®ä½“å±‚çš„å¯¹è±¡æ¥å®ç°çš„. ç»“æ„ä½“ä¹‹äºGo, ç±»ä¼¼äºå®ä½“å±‚ä¸­çš„ç±»ä¹‹äºJava</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> employee <span class="keyword">struct</span> &#123;</span><br><span class="line">	id <span class="keyword">int</span></span><br><span class="line">	name <span class="keyword">string</span></span><br><span class="line">	age <span class="keyword">int</span></span><br><span class="line">	department <span class="keyword">string</span></span><br><span class="line">	city <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	e := employee&#123;id:<span class="number">123</span>, name:<span class="string">"larry"</span>, age:<span class="number">28</span>, department:<span class="string">"paas"</span>, city:<span class="string">"TangShan"</span>&#125;</span><br><span class="line">	ee := employee&#123;id:<span class="number">234</span>, name:<span class="string">"sam"</span>, age:<span class="number">45</span>, department:<span class="string">"daas"</span>, city:<span class="string">"BeiJing"</span>&#125;</span><br><span class="line">	fmt.Println(e)</span><br><span class="line">	fmt.Println(ee)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;123 larry 28 paas TangShan&#125;</span><br><span class="line">&#123;234 sam 45 daas BeiJing&#125;</span><br></pre></td></tr></table></figure>

<h1 id="è®¿é—®ç»“æ„ä½“æˆå‘˜"><a href="#è®¿é—®ç»“æ„ä½“æˆå‘˜" class="headerlink" title="è®¿é—®ç»“æ„ä½“æˆå‘˜"></a>è®¿é—®ç»“æ„ä½“æˆå‘˜</h1><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> employee <span class="keyword">struct</span> &#123;</span><br><span class="line">	id <span class="keyword">int</span></span><br><span class="line">	name <span class="keyword">string</span></span><br><span class="line">	age <span class="keyword">int</span></span><br><span class="line">	department <span class="keyword">string</span></span><br><span class="line">	city <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> e1 employee  <span class="comment">// å£°æ˜e1å˜é‡ä¸ºemployeeç±»å‹</span></span><br><span class="line">	<span class="keyword">var</span> e2 employee  <span class="comment">// å£°æ˜e2å˜é‡ä¸ºemployeeç±»å‹</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// ä¸ºe1å¯¹è±¡èµ‹å€¼</span></span><br><span class="line">	e1.id = <span class="number">123</span></span><br><span class="line">	e1.name = <span class="string">"larry"</span></span><br><span class="line">	e1.age = <span class="number">28</span></span><br><span class="line">	e1.department = <span class="string">"paas"</span></span><br><span class="line">	e1.city = <span class="string">"TangShan"</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// ä¸ºe2å¯¹è±¡èµ‹å€¼</span></span><br><span class="line">	e2.id = <span class="number">234</span></span><br><span class="line">	e2.name = <span class="string">"sam"</span></span><br><span class="line">	e2.age = <span class="number">45</span></span><br><span class="line">	e2.department = <span class="string">"daas"</span></span><br><span class="line">	e2.city = <span class="string">"BeiJing"</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// è®¿é—®ç»“æ„ä½“å¯¹è±¡çš„æˆå‘˜</span></span><br><span class="line">	fmt.Println(e1.name, e1.age)</span><br><span class="line">	fmt.Println(e2.name, e2.age)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">larry 28</span><br><span class="line">sam 45</span><br></pre></td></tr></table></figure>

<h1 id="ç»“æ„ä½“ä½œä¸ºå‡½æ•°å‚æ•°"><a href="#ç»“æ„ä½“ä½œä¸ºå‡½æ•°å‚æ•°" class="headerlink" title="ç»“æ„ä½“ä½œä¸ºå‡½æ•°å‚æ•°"></a>ç»“æ„ä½“ä½œä¸ºå‡½æ•°å‚æ•°</h1><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> employee <span class="keyword">struct</span> &#123;</span><br><span class="line">	id <span class="keyword">int</span></span><br><span class="line">	name <span class="keyword">string</span></span><br><span class="line">	age <span class="keyword">int</span></span><br><span class="line">	department <span class="keyword">string</span></span><br><span class="line">	city <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">printEmpInfo</span><span class="params">(emp employee)</span></span> &#123;</span><br><span class="line">	fmt.Println(emp.name, emp.city)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	e := employee&#123;id:<span class="number">123</span>, name:<span class="string">"larry"</span>, age:<span class="number">28</span>, department:<span class="string">"paas"</span>, city:<span class="string">"TangShan"</span>&#125;</span><br><span class="line">	ee := employee&#123;id:<span class="number">234</span>, name:<span class="string">"sam"</span>, age:<span class="number">45</span>, department:<span class="string">"daas"</span>, city:<span class="string">"BeiJing"</span>&#125;</span><br><span class="line"></span><br><span class="line">	printEmpInfo(e)</span><br><span class="line">	printEmpInfo(ee)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç»“æ„ä½“ç”¨ä½œå‡½æ•°å‚æ•°çš„æ—¶å€™, æœ€åƒä¸‰å±‚å¼€å‘ä¸­çš„å®ä½“å±‚ç”¨æ³•</p>
<h1 id="ç»“æ„ä½“æŒ‡é’ˆ"><a href="#ç»“æ„ä½“æŒ‡é’ˆ" class="headerlink" title="ç»“æ„ä½“æŒ‡é’ˆ"></a>ç»“æ„ä½“æŒ‡é’ˆ</h1><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> employee <span class="keyword">struct</span> &#123;</span><br><span class="line">	id <span class="keyword">int</span></span><br><span class="line">	name <span class="keyword">string</span></span><br><span class="line">	age <span class="keyword">int</span></span><br><span class="line">	department <span class="keyword">string</span></span><br><span class="line">	city <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	e := employee&#123;id:<span class="number">123</span>, name:<span class="string">"larry"</span>, age:<span class="number">28</span>, department:<span class="string">"paas"</span>, city:<span class="string">"TangShan"</span>&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> e1 *employee</span><br><span class="line"></span><br><span class="line">	e1 = &amp;e</span><br><span class="line"></span><br><span class="line">	fmt.Println(e1.age, e.age)</span><br><span class="line"></span><br><span class="line">	e1.age = <span class="number">29</span></span><br><span class="line">	</span><br><span class="line">	fmt.Println(e1.age, e.age)  <span class="comment">// ç”±äºe1å¯¹è±¡æ‹¿åˆ°çš„æ˜¯eå¯¹è±¡çš„æŒ‡é’ˆ, æ‰€ä»¥å¯¹ä»»æ„ä¸€ä¸ªå˜é‡èµ‹å€¼éƒ½ä¼šè¢«æ›´æ”¹</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">28 28</span><br><span class="line">29 29</span><br></pre></td></tr></table></figure>

<h1 id="æ–¹æ³•"><a href="#æ–¹æ³•" class="headerlink" title="æ–¹æ³•"></a>æ–¹æ³•</h1><p>åœ¨Pythonä¸­, æ–¹æ³•å’Œå‡½æ•°çš„åŒºåˆ«å¯ä»¥ç®€å•ç†è§£ä¸ºåœ¨ç±»ä¸­çš„å‡½æ•°å°±å«æ–¹æ³•. åœ¨Goè¯­è¨€ä¸­, ä»€ä¹ˆæ˜¯æ–¹æ³•å‘¢, å¯ä»¥ç®€å•è®¤ä¸º, ä¸ºç»“æ„ä½“å®šä¹‰çš„å‡½æ•°å°±å«æ–¹æ³•</p>
<p>ä¸å…¶ä»–è¯­è¨€ä¸åŒçš„æ˜¯, ä¸ºç»“æ„ä½“å®šä¹‰çš„æ–¹æ³•, ä»å½¢å¼ä¸Šçœ‹ä¸æ˜¯å†™åœ¨ç»“æ„ä½“é‡Œé¢çš„, è€Œæ˜¯å†™åœ¨ç»“æ„ä½“å¤–é¢çš„</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> employee <span class="keyword">struct</span> &#123;</span><br><span class="line">	id <span class="keyword">int</span></span><br><span class="line">	name <span class="keyword">string</span></span><br><span class="line">	age <span class="keyword">int</span></span><br><span class="line">	department <span class="keyword">string</span></span><br><span class="line">	city <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰ç»“æ„ä½“æ–¹æ³•</span></span><br><span class="line"><span class="comment">// (emp employee) åœ¨å‡½æ•°åçš„å‰é¢å®šä¹‰äº†æ¥æ”¶è€…, ç±»ä¼¼äºå…¶ä»–è¯­è¨€çš„this, æˆ–æ˜¯Pythonçš„self</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(emp employee)</span> <span class="title">printEmpInfo</span><span class="params">(arg <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">	fmt.Printf(<span class="string">"æˆ‘æ˜¯å½¢å¼å‚æ•° %s\n"</span>, arg)</span><br><span class="line">	fmt.Println(emp.name)</span><br><span class="line">	fmt.Println(emp.age)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	e := employee&#123;id:<span class="number">123</span>, name:<span class="string">"larry"</span>, age:<span class="number">28</span>, department:<span class="string">"paas"</span>, city:<span class="string">"TangShan"</span>&#125;</span><br><span class="line">	e.printEmpInfo(<span class="string">"PolarSnow"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æˆ‘æ˜¯å½¢å¼å‚æ•° PolarSnow</span><br><span class="line">larry</span><br><span class="line">28</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„demoä¸­, <code>e.printEmpInfo(&quot;PolarSnow&quot;)</code> eå¯¹è±¡è°ƒç”¨äº†printEmpInfoæ–¹æ³•, å¹¶æ˜¾å¼ä¼ é€’äº†PolarSnowå‚æ•°, å…¶å®åœ¨èƒŒå, åœ¨å­˜åœ¨ä¸€ä¸ªéšå¼ä¼ å‚, å°±æ˜¯eæŠŠè‡ªå·±ä¼ é€’ç»™äº†æ–¹æ³•å®šä¹‰ä¸­çš„<code>(emp employee)</code>, ç±»ä¼¼äºJavaä¸­çš„this, å’ŒPythonä¸­çš„self</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> employee <span class="keyword">struct</span> &#123;</span><br><span class="line">	id <span class="keyword">int</span></span><br><span class="line">	name <span class="keyword">string</span></span><br><span class="line">	age <span class="keyword">int</span></span><br><span class="line">	department <span class="keyword">string</span></span><br><span class="line">	city <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰æ™®é€šå‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">printEmpInfo</span><span class="params">(emp employee, arg <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">	fmt.Printf(<span class="string">"æˆ‘æ˜¯å½¢å¼å‚æ•° %s\n"</span>, arg)</span><br><span class="line">	fmt.Println(emp.name)</span><br><span class="line">	fmt.Println(emp.age)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	e := employee&#123;id:<span class="number">123</span>, name:<span class="string">"larry"</span>, age:<span class="number">28</span>, department:<span class="string">"paas"</span>, city:<span class="string">"TangShan"</span>&#125;</span><br><span class="line">	printEmpInfo(e, <span class="string">"PolarSnow"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¹ˆå†™æ•ˆæœæ˜¯ä¸€æ ·çš„, åªæ˜¯è°ƒç”¨çš„æ—¶å€™æ˜¯ç›´æ¥è°ƒç”¨å‡½æ•°, æŠŠç»“æ„ä½“å¯¹è±¡å½“åšå½¢å¼å‚æ•°ä¼ é€’, è€Œä¸æ˜¯è°ƒç”¨ç»“æ„ä½“è‡ªå·±çš„æ–¹æ³•, å°†è‡ªå·±éšå¼ä¼ é€’åˆ°æ–¹æ³•ä¸­</p>
<h1 id="ç»“æ„ä½“æ–¹æ³•ä¸­éšå¼ä¼ å‚çš„é—®é¢˜"><a href="#ç»“æ„ä½“æ–¹æ³•ä¸­éšå¼ä¼ å‚çš„é—®é¢˜" class="headerlink" title="ç»“æ„ä½“æ–¹æ³•ä¸­éšå¼ä¼ å‚çš„é—®é¢˜"></a>ç»“æ„ä½“æ–¹æ³•ä¸­éšå¼ä¼ å‚çš„é—®é¢˜</h1><p><strong>æ³¨æ„: é»˜è®¤æƒ…å†µä¸‹, Goè¯­è¨€æ‰€æœ‰å‚æ•°éƒ½æ˜¯ä¼ å€¼, <code>func (emp employee) printEmpInfo(arg string)</code> ä¹Ÿä¸ä¾‹å¤–, åŒæ ·æ˜¯å€¼ä¼ é€’</strong></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> employee <span class="keyword">struct</span> &#123;</span><br><span class="line">	id <span class="keyword">int</span></span><br><span class="line">	name <span class="keyword">string</span></span><br><span class="line">	age <span class="keyword">int</span></span><br><span class="line">	department <span class="keyword">string</span></span><br><span class="line">	city <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰ç»“æ„ä½“æ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(emp employee)</span> <span class="title">setEmpAge</span><span class="params">(age <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">	emp.age = age</span><br><span class="line">	fmt.Println(<span class="string">"æˆ‘æ˜¯ç»“æ„ä½“æ–¹æ³•é‡Œçš„å€¼"</span>, emp.age)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	e := employee&#123;id:<span class="number">123</span>, name:<span class="string">"larry"</span>, age:<span class="number">28</span>, department:<span class="string">"paas"</span>, city:<span class="string">"TangShan"</span>&#125;</span><br><span class="line">	e.setEmpAge(<span class="number">29</span>)</span><br><span class="line">	fmt.Println(<span class="string">"æˆ‘æ˜¯ç»“æ„ä½“æ–¹æ³•å¤–é¢çš„å€¼"</span>, e.age)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æˆ‘æ˜¯ç»“æ„ä½“æ–¹æ³•é‡Œçš„å€¼ 29</span><br><span class="line">æˆ‘æ˜¯ç»“æ„ä½“æ–¹æ³•å¤–é¢çš„å€¼ 28</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> employee <span class="keyword">struct</span> &#123;</span><br><span class="line">	id <span class="keyword">int</span></span><br><span class="line">	name <span class="keyword">string</span></span><br><span class="line">	age <span class="keyword">int</span></span><br><span class="line">	department <span class="keyword">string</span></span><br><span class="line">	city <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰ç»“æ„ä½“æ–¹æ³•</span></span><br><span class="line"><span class="comment">// åªè¦å°†æ¥æ”¶ç»“æ„ä½“å¯¹è±¡çš„æ•°æ®ç±»å‹å‰åŠ *(å–æŒ‡é’ˆ) åˆ™æ–¹æ³•å†…å¯¹ç»“æ„ä½“å¯¹è±¡æˆå‘˜çš„ä¿®æ”¹å°±ä¼šåŒæ­¥åˆ°æ–¹æ³•å¤–éƒ¨</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(emp *employee)</span> <span class="title">setEmpAge</span><span class="params">(age <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">	emp.age = age</span><br><span class="line">	fmt.Println(<span class="string">"æˆ‘æ˜¯ç»“æ„ä½“æ–¹æ³•é‡Œçš„å€¼"</span>, emp.age)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	e := employee&#123;id:<span class="number">123</span>, name:<span class="string">"larry"</span>, age:<span class="number">28</span>, department:<span class="string">"paas"</span>, city:<span class="string">"TangShan"</span>&#125;</span><br><span class="line">	<span class="comment">// è°ƒç”¨æ–¹ä¸éœ€è¦ä»»ä½•æ›´æ”¹, Goä¼šè‡ªåŠ¨å»è¯†åˆ«æ˜¯åº”è¯¥ä¼ å€¼è¿˜æ˜¯ä¼ å€</span></span><br><span class="line">	e.setEmpAge(<span class="number">29</span>)</span><br><span class="line">	fmt.Println(<span class="string">"æˆ‘æ˜¯ç»“æ„ä½“æ–¹æ³•å¤–é¢çš„å€¼"</span>, e.age)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æˆ‘æ˜¯ç»“æ„ä½“æ–¹æ³•é‡Œçš„å€¼ 29</span><br><span class="line">æˆ‘æ˜¯ç»“æ„ä½“æ–¹æ³•å¤–é¢çš„å€¼ 29</span><br></pre></td></tr></table></figure>

<p><strong>æ³¨æ„: åªæœ‰æŒ‡é’ˆæ‰å¯ä»¥æ”¹å˜ç»“æ„ä½“ä¸­çš„å†…å®¹</strong></p>
<p>nilæŒ‡é’ˆä¹Ÿæ˜¯å¯ä»¥è°ƒç”¨æ–¹æ³•çš„</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> employee <span class="keyword">struct</span> &#123;</span><br><span class="line">	id <span class="keyword">int</span></span><br><span class="line">	name <span class="keyword">string</span></span><br><span class="line">	age <span class="keyword">int</span></span><br><span class="line">	department <span class="keyword">string</span></span><br><span class="line">	city <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(emp *employee)</span> <span class="title">setEmpAge</span><span class="params">(age <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> emp == <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"employee å¯¹è±¡ä¸º nil æŒ‡é’ˆ"</span>)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> e *employee</span><br><span class="line">	e.setEmpAge(<span class="number">29</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">employee å¯¹è±¡ä¸º nil æŒ‡é’ˆ</span><br></pre></td></tr></table></figure>

<h1 id="å€¼æ¥æ”¶è€…-vs-æŒ‡é’ˆæ¥æ”¶è€…"><a href="#å€¼æ¥æ”¶è€…-vs-æŒ‡é’ˆæ¥æ”¶è€…" class="headerlink" title="å€¼æ¥æ”¶è€… vs æŒ‡é’ˆæ¥æ”¶è€…"></a>å€¼æ¥æ”¶è€… vs æŒ‡é’ˆæ¥æ”¶è€…</h1><ul>
<li>è¦æ”¹å˜å†…å®¹å¿…é¡»ä½¿ç”¨æŒ‡é’ˆæ¥æ”¶è€…</li>
<li>ç»“æ„è¿‡å¤§ä¹Ÿéœ€è¦è€ƒè™‘ä½¿ç”¨æŒ‡é’ˆæ¥å—è€…</li>
<li>ä¸€è‡´æ€§: å¦‚æœæœ‰æŒ‡é’ˆæ¥æ”¶è€…, æœ€å¥½éƒ½æ˜¯æŒ‡é’ˆæ¥æ”¶è€…</li>
</ul>
]]></content>
      <categories>
        <category>Go</category>
      </categories>
      <tags>
        <tag>Go</tag>
        <tag>struct</tag>
        <tag>æ–¹æ³•</tag>
        <tag>ç»“æ„ä½“</tag>
      </tags>
  </entry>
  <entry>
    <title>GoåŸºç¡€ä¹‹å­—ç¬¦å’Œå­—ç¬¦ä¸²çš„å¤„ç†</title>
    <url>/2018/08/13/Go%E5%9F%BA%E7%A1%80%E4%B9%8B%E5%AD%97%E7%AC%A6%E5%92%8C%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E5%A4%84%E7%90%86/</url>
    <content><![CDATA[<p>åœ¨Goè¯­è¨€ä¸­, å½“æˆ‘ä»¬å°è¯•éå†ä¸€ä¸ªå­—ç¬¦ä¸²çš„æ—¶å€™</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	s := <span class="string">"æˆ‘æ˜¯å¸¦ğŸ˜ˆemojiçš„å­—ç¬¦ä¸²!"</span></span><br><span class="line">	fmt.Println(s)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i, ch := <span class="keyword">range</span> s &#123;</span><br><span class="line">		fmt.Printf(<span class="string">"%d %c\n"</span>, i, ch)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æˆ‘æ˜¯å¸¦ğŸ˜ˆemojiçš„å­—ç¬¦ä¸²!</span><br><span class="line">0 æˆ‘</span><br><span class="line">3 æ˜¯</span><br><span class="line">6 å¸¦</span><br><span class="line">9 ğŸ˜ˆ</span><br><span class="line">13 e</span><br><span class="line">14 m</span><br><span class="line">15 o</span><br><span class="line">16 j</span><br><span class="line">17 i</span><br><span class="line">18 çš„</span><br><span class="line">21 å­—</span><br><span class="line">24 ç¬¦</span><br><span class="line">27 ä¸²</span><br><span class="line">30 !</span><br></pre></td></tr></table></figure>

<p>æ¯ä¸ª<code>i</code>å¯¹åº”çš„éƒ½æ˜¯ä¸€ä¸ªå­—èŠ‚, ç»“æœä¸­å‡ºç°çš„<code>0 3 6 9</code>æ˜¯å¯¹åº”äº†è·å–åº•å±‚å­—èŠ‚çš„ç´¢å¼•ç , ç¬¬äºŒä¸ªå­—ç¬¦çš„å­—èŠ‚ç ä¹‹æ‰€ä»¥ä¼šä»ç¬¬3ä½å¼€å§‹å–, æ˜¯å› ä¸ºç¬¬ä¸€ä¸ªä¸­æ–‡å­—ç¬¦å…¶å®å ç”¨äº†ä¸‰ä¸ªå­—èŠ‚, æ‰€ä»¥ä¸‹ä¸€ä¸ªå­—éœ€è¦ä»ç´¢å¼•ä¸º3çš„å­—èŠ‚å¼€å§‹è¯»å–</p>
<p>Goè¯­è¨€ä¸­, æœ‰ä¸€ç§æ•°æ®ç±»å‹å«<code>rune</code>, ä»–æ˜¯ç”±ä¸€ä¸ª<code>int32</code>ç±»å‹æ„æˆçš„æ–°çš„æ•°æ®ç±»å‹, ä¸“é—¨ç”¨æ¥å¤„ç†Goè¯­è¨€ä¸­çš„å­—ç¬¦é—®é¢˜</p>
<p>ä¸‹é¢çš„demoä¸­, æˆ‘ä»¬ä½¿ç”¨å¼ºåˆ¶ç±»å‹è½¬æ¢æ¥å°†å­—ç¬¦ä¸², å¼ºåˆ¶è½¬æ¢ä¸ºruneç±»å‹</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	s := <span class="string">"æˆ‘æ˜¯å¸¦ğŸ˜ˆemojiçš„å­—ç¬¦ä¸²!"</span></span><br><span class="line">	fmt.Println(s)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i, ch := <span class="keyword">range</span> []<span class="keyword">rune</span>(s) &#123;</span><br><span class="line">		fmt.Printf(<span class="string">"%d %c\n"</span>, i, ch)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æˆ‘æ˜¯å¸¦ğŸ˜ˆemojiçš„å­—ç¬¦ä¸²!</span><br><span class="line">0 æˆ‘</span><br><span class="line">1 æ˜¯</span><br><span class="line">2 å¸¦</span><br><span class="line">3 ğŸ˜ˆ</span><br><span class="line">4 e</span><br><span class="line">5 m</span><br><span class="line">6 o</span><br><span class="line">7 j</span><br><span class="line">8 i</span><br><span class="line">9 çš„</span><br><span class="line">10 å­—</span><br><span class="line">11 ç¬¦</span><br><span class="line">12 ä¸²</span><br><span class="line">13 !</span><br></pre></td></tr></table></figure>

<p>å°ç»“:</p>
<ul>
<li>runeç›¸å½“äºGoè¯­è¨€ä¸­çš„char</li>
<li>ä½¿ç”¨rangeéå†position, rune</li>
<li>ä½¿ç”¨utf8.RuneCountInStringæ¥è·å¾—å­—ç¬¦çš„é•¿åº¦</li>
<li>ä½¿ç”¨len(s)æ¥è·å¾—å­—èŠ‚çš„é•¿åº¦, len([]rune(s))æ¥è·å¾—å­—ç¬¦çš„é•¿åº¦</li>
<li>ä½¿ç”¨[]byteè·å¾—å­—èŠ‚</li>
</ul>
<h1 id="ä½¿ç”¨stringsåŒ…æ“ä½œå­—ç¬¦ä¸²"><a href="#ä½¿ç”¨stringsåŒ…æ“ä½œå­—ç¬¦ä¸²" class="headerlink" title="ä½¿ç”¨stringsåŒ…æ“ä½œå­—ç¬¦ä¸²"></a>ä½¿ç”¨stringsåŒ…æ“ä½œå­—ç¬¦ä¸²</h1><p>ä¸€ä¸‹åˆ—å‡ºå¸¸ç”¨çš„å‡½æ•°, æ›´å¤šä½¿ç”¨æ–¹æ³•å’Œdemoè¯·å‚è€ƒå®˜æ–¹æ–‡æ¡£: <a href="https://golang.org/pkg/strings/" target="_blank" rel="noopener">https://golang.org/pkg/strings/</a></p>
<h2 id="Compare"><a href="#Compare" class="headerlink" title="Compare"></a>Compare</h2><p><code>func Compare(a, b string) int</code></p>
<p>Compareå‡½æ•°ç”¨æ¥æ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸², è¿”å›å€¼ä¸ºintç±»å‹, å¦‚æœä¸¤ä¸ªå­—ç¬¦ä¸²ç›¸ç­‰, è¿”å›<code>0</code>; å¦‚æœ<code>a&gt;b</code>è¿”å›<code>1</code>; <code>a&lt;b</code>è¿”å›<code>-1</code></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"strings"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(strings.Compare(<span class="string">"a"</span>, <span class="string">"b"</span>))</span><br><span class="line">	fmt.Println(strings.Compare(<span class="string">"a"</span>, <span class="string">"a"</span>))</span><br><span class="line">	fmt.Println(strings.Compare(<span class="string">"b"</span>, <span class="string">"a"</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">-1</span><br><span class="line">0</span><br><span class="line">1</span><br></pre></td></tr></table></figure>

<h2 id="Contains"><a href="#Contains" class="headerlink" title="Contains"></a>Contains</h2><p><code>func Contains(s, substr string) bool</code></p>
<p>Containså‡½æ•°ç”¨æ¥åˆ¤æ–­ç¬¬äºŒä¸ªå‚æ•°çš„å­—ç¬¦ä¸²æ˜¯å¦æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°å­—ç¬¦ä¸²çš„å­ä¸², è¿”å›å€¼ä¸ºboolç±»å‹</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"strings"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(strings.Contains(<span class="string">"seafood"</span>, <span class="string">"foo"</span>))</span><br><span class="line">	fmt.Println(strings.Contains(<span class="string">"seafood"</span>, <span class="string">"bar"</span>))</span><br><span class="line">	fmt.Println(strings.Contains(<span class="string">"seafood"</span>, <span class="string">""</span>))</span><br><span class="line">	fmt.Println(strings.Contains(<span class="string">""</span>, <span class="string">""</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">true</span><br><span class="line">false</span><br><span class="line">true</span><br><span class="line">true</span><br></pre></td></tr></table></figure>

<h2 id="Count"><a href="#Count" class="headerlink" title="Count"></a>Count</h2><p><code>func Count(s, substr string) int</code></p>
<p>Countå‡½æ•°ç”¨æ¥è®¡ç®—å­ä¸²åœ¨så­—ç¬¦ä¸²ä¸­å‡ºç°çš„æ¬¡æ•°</p>
<h2 id="Fields"><a href="#Fields" class="headerlink" title="Fields"></a>Fields</h2><p><code>func Fields(s string) []string</code></p>
<p>Fieldså‡½æ•°ä»¥ç©ºæ ¼ä¸ºåˆ†éš”ç¬¦, å°†å­—ç¬¦ä¸²åˆ†å‰²æˆslice</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"strings"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Printf(<span class="string">"Fields are: %q"</span>, strings.Fields(<span class="string">"  foo bar  baz   "</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Fields are: [&quot;foo&quot; &quot;bar&quot; &quot;baz&quot;]</span><br></pre></td></tr></table></figure>

<h2 id="Index"><a href="#Index" class="headerlink" title="Index"></a>Index</h2><p><code>func Index(s, substr string) int</code></p>
<p>Indexå‡½æ•°è¿”å›ç¬¬ä¸€ä¸ªsubstråœ¨sä¸­å‡ºç°çš„ä½ç½®, å¦‚æœæ²¡æœ‰æ‰¾åˆ°, å°†è¿”å›<code>-1</code></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"strings"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(strings.Index(<span class="string">"chicken"</span>, <span class="string">"ken"</span>))</span><br><span class="line">	fmt.Println(strings.Index(<span class="string">"chicken"</span>, <span class="string">"dmr"</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">4</span><br><span class="line">-1</span><br></pre></td></tr></table></figure>

<h2 id="Join"><a href="#Join" class="headerlink" title="Join"></a>Join</h2><p><code>func Join(a []string, sep string) string</code></p>
<p>Joinå‡½æ•°ç”¨æ¥å°†sliceä»¥æŒ‡å®šçš„å­—ç¬¦æ‹¼æ¥æˆå­—ç¬¦ä¸²</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"strings"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	s := []<span class="keyword">string</span>&#123;<span class="string">"foo"</span>, <span class="string">"bar"</span>, <span class="string">"baz"</span>&#125;</span><br><span class="line">	fmt.Println(strings.Join(s, <span class="string">", "</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">foo, bar, baz</span><br></pre></td></tr></table></figure>

<h2 id="LastIndex"><a href="#LastIndex" class="headerlink" title="LastIndex"></a>LastIndex</h2><p><code>func LastIndex(s, substr string) int</code></p>
<p>LastIndexå‡½æ•°ç”¨æ¥æŸ¥æ‰¾åœ¨sä¸­æœ€åä¸€æ¬¡å‡ºç°å­ä¸²çš„ä½ç½®</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"strings"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(strings.Index(<span class="string">"go gopher"</span>, <span class="string">"go"</span>))</span><br><span class="line">	fmt.Println(strings.LastIndex(<span class="string">"go gopher"</span>, <span class="string">"go"</span>))</span><br><span class="line">	fmt.Println(strings.LastIndex(<span class="string">"go gopher"</span>, <span class="string">"rodent"</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0</span><br><span class="line">3</span><br><span class="line">-1</span><br></pre></td></tr></table></figure>

<h2 id="Repeat"><a href="#Repeat" class="headerlink" title="Repeat"></a>Repeat</h2><p><code>func Repeat(s string, count int) string</code></p>
<p>Repeatå‡½æ•°è¿”å›ä»¥æŒ‡å®šæ¬¡æ•°é‡å¤çš„å­—ç¬¦(ä¸²)</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"strings"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"ba"</span> + strings.Repeat(<span class="string">"na"</span>, <span class="number">2</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">banana</span><br></pre></td></tr></table></figure>

<h2 id="Replace"><a href="#Replace" class="headerlink" title="Replace"></a>Replace</h2><p><code>func Replace(s, old, new string, n int) string</code></p>
<p>æ›¿æ¢</p>
<h2 id="Split"><a href="#Split" class="headerlink" title="Split"></a>Split</h2><p><code>func Split(s, sep string) []string</code></p>
<p>å°†å­—ç¬¦ä¸²ä»¥æŒ‡å®šå­—ç¬¦åˆ‡å‰²æˆslice</p>
<h2 id="Title"><a href="#Title" class="headerlink" title="Title"></a>Title</h2><p><code>func Title(s string) string</code></p>
<p>æ¯ä¸ªå•è¯çš„é¦–å­—ç¬¦å¤§å†™</p>
<h2 id="ToLower"><a href="#ToLower" class="headerlink" title="ToLower"></a>ToLower</h2><p><code>func ToLower(s string) string</code></p>
<p>è½¬å°å†™</p>
<h2 id="ToUpper"><a href="#ToUpper" class="headerlink" title="ToUpper"></a>ToUpper</h2><p><code>func ToUpper(s string) string</code></p>
<p>è½¬å¤§å†™</p>
<h2 id="Trim-TrimLeft-TrimRight"><a href="#Trim-TrimLeft-TrimRight" class="headerlink" title="Trim/TrimLeft/TrimRight"></a>Trim/TrimLeft/TrimRight</h2><p><code>func Trim(s string, cutset string) string</code></p>
<p>å»æ‰ä¸¤è¾¹ç©ºæ ¼/å»æ‰å·¦è¾¹ç©ºæ ¼/å»æ‰å³è¾¹ç©ºæ ¼</p>
]]></content>
      <categories>
        <category>Go</category>
      </categories>
      <tags>
        <tag>Go</tag>
        <tag>rune</tag>
      </tags>
  </entry>
  <entry>
    <title>GoåŸºç¡€ä¹‹Map</title>
    <url>/2018/08/13/Go%E5%9F%BA%E7%A1%80%E4%B9%8BMap/</url>
    <content><![CDATA[<h2 id="mapä¸­çš„key"><a href="#mapä¸­çš„key" class="headerlink" title="mapä¸­çš„key"></a>mapä¸­çš„key</h2><p>Goè¯­è¨€ä¸­å¯¹mapä¸­çš„keyçš„æ•°æ®ç±»å‹æœ‰å¦‚ä¸‹è¦æ±‚:</p>
<ul>
<li>mapä½¿ç”¨å“ˆå¸Œè¡¨, keyå¿…é¡»å¯ä»¥æ¯”è¾ƒç›¸ç­‰</li>
<li>é™¤äº†slice, map, functionçš„å†…å»ºç±»å‹éƒ½å¯ä»¥ä½œä¸ºkey</li>
<li>structç±»å‹å¦‚æœä¸åŒ…å«ç¬¬äºŒæ¡ä¸­æ’é™¤çš„æ•°æ®ç±»å‹, ä¹Ÿå¯ä»¥åšä¸ºkey</li>
</ul>
<h2 id="mapçš„å£°æ˜ä¸èµ‹å€¼"><a href="#mapçš„å£°æ˜ä¸èµ‹å€¼" class="headerlink" title="mapçš„å£°æ˜ä¸èµ‹å€¼"></a>mapçš„å£°æ˜ä¸èµ‹å€¼</h2><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	m := <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span> &#123;</span><br><span class="line">		<span class="string">"name"</span>: <span class="string">"larry"</span>,</span><br><span class="line">		<span class="string">"company"</span>: <span class="string">"PolarSnow Inc."</span>,</span><br><span class="line">		<span class="string">"website"</span>: <span class="string">"https://lvrui.io"</span>,</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(m)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">map[name:larry company:PolarSnow Inc. website:https:&#x2F;&#x2F;lvrui.io]</span><br></pre></td></tr></table></figure>

<h3 id="åµŒå¥—Map"><a href="#åµŒå¥—Map" class="headerlink" title="åµŒå¥—Map"></a>åµŒå¥—Map</h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	m := <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span> &#123;</span><br><span class="line">		<span class="string">"member"</span>: &#123;</span><br><span class="line">			<span class="string">"name"</span>: <span class="string">"larry"</span>,</span><br><span class="line">			<span class="string">"company"</span>: <span class="string">"PolarSnow Inc."</span>,</span><br><span class="line">			<span class="string">"website"</span>: <span class="string">"https://lvrui.io"</span>,</span><br><span class="line">		&#125;,</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(m[<span class="string">"member"</span>][<span class="string">"name"</span>])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">larry</span><br></pre></td></tr></table></figure>

<h3 id="å…¶ä»–å£°æ˜mapçš„æ–¹å¼"><a href="#å…¶ä»–å£°æ˜mapçš„æ–¹å¼" class="headerlink" title="å…¶ä»–å£°æ˜mapçš„æ–¹å¼"></a>å…¶ä»–å£°æ˜mapçš„æ–¹å¼</h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	m := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>)  <span class="comment">// m == empty map</span></span><br><span class="line">	<span class="keyword">var</span> mm <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>  <span class="comment">// mm == nil</span></span><br><span class="line">	fmt.Println(m, mm)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">map[] map[]</span><br></pre></td></tr></table></figure>

<h2 id="mapçš„éå†"><a href="#mapçš„éå†" class="headerlink" title="mapçš„éå†"></a>mapçš„éå†</h2><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	m := <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span> &#123;</span><br><span class="line">		<span class="string">"name"</span>: <span class="string">"larry"</span>,</span><br><span class="line">		<span class="string">"company"</span>: <span class="string">"PolarSnow Inc."</span>,</span><br><span class="line">		<span class="string">"website"</span>: <span class="string">"https://lvrui.io"</span>,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> k, v := <span class="keyword">range</span> m &#123;</span><br><span class="line">		fmt.Println(k, v)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">company PolarSnow Inc.</span><br><span class="line">website https:&#x2F;&#x2F;lvrui.io</span><br><span class="line">name larry</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„: mapæ˜¯æ— åºçš„</p>
<h2 id="è¯»å–mapä¸­çš„å€¼"><a href="#è¯»å–mapä¸­çš„å€¼" class="headerlink" title="è¯»å–mapä¸­çš„å€¼"></a>è¯»å–mapä¸­çš„å€¼</h2><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	m := <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span> &#123;</span><br><span class="line">		<span class="string">"name"</span>: <span class="string">"larry"</span>,</span><br><span class="line">		<span class="string">"company"</span>: <span class="string">"PolarSnow Inc."</span>,</span><br><span class="line">		<span class="string">"website"</span>: <span class="string">"https://lvrui.io"</span>,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	fmt.Println(m[<span class="string">"website"</span>])</span><br><span class="line"></span><br><span class="line">	fmt.Println(m[<span class="string">"site"</span>])  <span class="comment">// mapä¸­æ— æ­¤key, ä½†æ˜¯ä¸ä¼šæŠ¥é”™, æ‹¿åˆ°çš„æ˜¯stringçš„zero value</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// é€šå¸¸åˆ¤æ–­mapå–å€¼æœ‰æ²¡æœ‰æˆåŠŸçš„æ–¹å¼</span></span><br><span class="line">	<span class="keyword">if</span> address, ok := m[<span class="string">"website"</span>]; ok &#123;</span><br><span class="line">		fmt.Println(address)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"Key does not exist"</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;lvrui.io</span><br><span class="line"></span><br><span class="line">https:&#x2F;&#x2F;lvrui.io</span><br></pre></td></tr></table></figure>

<h2 id="å¢åŠ -ä¿®æ”¹å…ƒç´ "><a href="#å¢åŠ -ä¿®æ”¹å…ƒç´ " class="headerlink" title="å¢åŠ /ä¿®æ”¹å…ƒç´ "></a>å¢åŠ /ä¿®æ”¹å…ƒç´ </h2><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	m := <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span> &#123;</span><br><span class="line">		<span class="string">"name"</span>: <span class="string">"larry"</span>,</span><br><span class="line">		<span class="string">"company"</span>: <span class="string">"PolarSnow Inc."</span>,</span><br><span class="line">		<span class="string">"website"</span>: <span class="string">"https://lvrui.io"</span>,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	fmt.Println(m)</span><br><span class="line"></span><br><span class="line">	m[<span class="string">"country"</span>] = <span class="string">"China"</span></span><br><span class="line"></span><br><span class="line">	fmt.Println(m)</span><br><span class="line"></span><br><span class="line">	m[<span class="string">"name"</span>] = <span class="string">"Polar Snow"</span></span><br><span class="line"></span><br><span class="line">	fmt.Println(m)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">map[company:PolarSnow Inc. website:https:&#x2F;&#x2F;lvrui.io name:larry]</span><br><span class="line">map[name:larry company:PolarSnow Inc. website:https:&#x2F;&#x2F;lvrui.io country:China]</span><br><span class="line">map[name:Polar Snow company:PolarSnow Inc. website:https:&#x2F;&#x2F;lvrui.io country:China]</span><br></pre></td></tr></table></figure>

<p>Goå¯¹mapæ·»åŠ /ä¿®æ”¹å…ƒç´ çš„æ“ä½œå½¢å¼, ä¸Pythonç›¸åŒ</p>
<h3 id="åˆ é™¤å…ƒç´ "><a href="#åˆ é™¤å…ƒç´ " class="headerlink" title="åˆ é™¤å…ƒç´ "></a>åˆ é™¤å…ƒç´ </h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	m := <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span> &#123;</span><br><span class="line">		<span class="string">"name"</span>: <span class="string">"larry"</span>,</span><br><span class="line">		<span class="string">"company"</span>: <span class="string">"PolarSnow Inc."</span>,</span><br><span class="line">		<span class="string">"website"</span>: <span class="string">"https://lvrui.io"</span>,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	fmt.Println(m)</span><br><span class="line"></span><br><span class="line">	<span class="built_in">delete</span>(m, <span class="string">"company"</span>)</span><br><span class="line"></span><br><span class="line">	fmt.Println(m)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">map[name:larry company:PolarSnow Inc. website:https:&#x2F;&#x2F;lvrui.io]</span><br><span class="line">map[name:larry website:https:&#x2F;&#x2F;lvrui.io]</span><br></pre></td></tr></table></figure>

<h2 id="è·å–mapå…ƒç´ çš„ä¸ªæ•°"><a href="#è·å–mapå…ƒç´ çš„ä¸ªæ•°" class="headerlink" title="è·å–mapå…ƒç´ çš„ä¸ªæ•°"></a>è·å–mapå…ƒç´ çš„ä¸ªæ•°</h2><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	m := <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span> &#123;</span><br><span class="line">		<span class="string">"name"</span>: <span class="string">"larry"</span>,</span><br><span class="line">		<span class="string">"company"</span>: <span class="string">"PolarSnow Inc."</span>,</span><br><span class="line">		<span class="string">"website"</span>: <span class="string">"https://lvrui.io"</span>,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="built_in">len</span>(m))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">3</span><br></pre></td></tr></table></figure>


<h2 id="mapçš„åº”ç”¨"><a href="#mapçš„åº”ç”¨" class="headerlink" title="mapçš„åº”ç”¨"></a>mapçš„åº”ç”¨</h2><h3 id="å–å‡ºæ‰€æœ‰keyå’Œæ‰€æœ‰value"><a href="#å–å‡ºæ‰€æœ‰keyå’Œæ‰€æœ‰value" class="headerlink" title="å–å‡ºæ‰€æœ‰keyå’Œæ‰€æœ‰value"></a>å–å‡ºæ‰€æœ‰keyå’Œæ‰€æœ‰value</h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	m := <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span> &#123;</span><br><span class="line">		<span class="string">"name"</span>: <span class="string">"larry"</span>,</span><br><span class="line">		<span class="string">"company"</span>: <span class="string">"PolarSnow Inc."</span>,</span><br><span class="line">		<span class="string">"website"</span>: <span class="string">"https://lvrui.io"</span>,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> key []<span class="keyword">string</span></span><br><span class="line">	<span class="keyword">var</span> value []<span class="keyword">string</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> k, v := <span class="keyword">range</span> m &#123;</span><br><span class="line">		key = <span class="built_in">append</span>(key, k)</span><br><span class="line">		value = <span class="built_in">append</span>(value, v)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	fmt.Println(key)</span><br><span class="line">	fmt.Println(value)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[name company website]</span><br><span class="line">[larry PolarSnow Inc. https:&#x2F;&#x2F;lvrui.io]</span><br></pre></td></tr></table></figure>


]]></content>
      <categories>
        <category>Go</category>
      </categories>
      <tags>
        <tag>Map</tag>
        <tag>Go</tag>
      </tags>
  </entry>
  <entry>
    <title>GoåŸºç¡€ä¹‹rangeéå†</title>
    <url>/2018/08/13/Go%E5%9F%BA%E7%A1%80%E4%B9%8Brange%E9%81%8D%E5%8E%86/</url>
    <content><![CDATA[<blockquote>
<p>Goè¯­è¨€çš„<code>range</code>å…³é”®å­—ç”¨äºåœ¨<code>for</code>è¯­å¥ä¸­éå†æ•°ç»„Array, Slice, Mapå’ŒChannelä¸­çš„å…ƒç´ .</p>
</blockquote>
<h1 id="éå†Array"><a href="#éå†Array" class="headerlink" title="éå†Array"></a>éå†Array</h1><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// å®šä¹‰ä¸€ä¸ªarray</span></span><br><span class="line">	arr := [<span class="number">4</span>]<span class="keyword">string</span> &#123;<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>, <span class="string">"d"</span>&#125;</span><br><span class="line">	<span class="comment">// éå†array</span></span><br><span class="line">	<span class="keyword">for</span> i, v := <span class="keyword">range</span> arr &#123;</span><br><span class="line">		fmt.Println(i, v)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0 a</span><br><span class="line">1 b</span><br><span class="line">2 c</span><br><span class="line">3 d</span><br></pre></td></tr></table></figure>

<h1 id="éå†Slice"><a href="#éå†Slice" class="headerlink" title="éå†Slice"></a>éå†Slice</h1><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// å®šä¹‰ä¸€ä¸ªslice</span></span><br><span class="line">	arr := []<span class="keyword">string</span> &#123;<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>, <span class="string">"d"</span>&#125;</span><br><span class="line">	<span class="comment">// éå†array</span></span><br><span class="line">	<span class="keyword">for</span> i, v := <span class="keyword">range</span> arr &#123;</span><br><span class="line">		fmt.Println(i, v)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0 a</span><br><span class="line">1 b</span><br><span class="line">2 c</span><br><span class="line">3 d</span><br></pre></td></tr></table></figure>

<h1 id="éå†Map"><a href="#éå†Map" class="headerlink" title="éå†Map"></a>éå†Map</h1><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// å®šä¹‰ä¸€ä¸ªmap</span></span><br><span class="line">	m := <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>&#123;<span class="string">"k1"</span>: <span class="string">"polarsnow"</span>, <span class="string">"k2"</span>: <span class="string">"larry"</span>, <span class="string">"k3"</span>: <span class="string">"lyu"</span>&#125;</span><br><span class="line">	<span class="comment">// éå†array</span></span><br><span class="line">	<span class="keyword">for</span> k, v := <span class="keyword">range</span> m &#123;</span><br><span class="line">		fmt.Println(k, v)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">k1 polarsnow</span><br><span class="line">k2 larry</span><br><span class="line">k3 lyu</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Go</category>
      </categories>
      <tags>
        <tag>Go</tag>
        <tag>range</tag>
      </tags>
  </entry>
  <entry>
    <title>mysqldump unknown table &#39;column_statistics&#39; in information_schema</title>
    <url>/2018/08/08/mysqldump-unknown-table-column-statistics-in-information-schema/</url>
    <content><![CDATA[<p>å¦‚æœä½¿ç”¨MySQL 8.0+ç‰ˆæœ¬æä¾›çš„å‘½ä»¤è¡Œå·¥å…·mysqldumpæ¥å¯¼å‡ºä½äº8.0ç‰ˆæœ¬çš„MySQLæ•°æ®åº“åˆ°SQLæ–‡ä»¶ï¼Œä¼šå‡ºç°<code>Unknown table &#39;column_statistics&#39; in information_schema</code>çš„é”™è¯¯ï¼Œå› ä¸ºæ—©æœŸç‰ˆæœ¬çš„MySQLæ•°æ®åº“çš„information_schemaæ•°æ®åº“ä¸­æ²¡æœ‰åä¸ºCOLUMN_STATISTICSçš„æ•°æ®è¡¨ã€‚  </p>
<p>è§£å†³æ–¹æ³•: ä½¿ç”¨8.0ä»¥å‰ç‰ˆæœ¬MySQLé™„å¸¦çš„mysqldumpå·¥å…·ï¼Œæœ€å¥½ä½¿ç”¨å¾…å¤‡ä»½çš„MySQLæœåŠ¡å™¨ç‰ˆæœ¬å¯¹åº”ç‰ˆæœ¬å·çš„mysqldumpå·¥å…·.</p>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
        <tag>mysqldump</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonè¯­è¨€å®ç°å·¥å‚æ–¹æ³•è®¾è®¡æ¨¡å¼</title>
    <url>/2018/08/08/Python%E8%AF%AD%E8%A8%80%E5%AE%9E%E7%8E%B0%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/</url>
    <content><![CDATA[<blockquote>
<p>æ ¹æ®è½¯ä»¶è®¾è®¡åŸåˆ™ä¸­<code>å¼€æ”¾å°é—­åŸåˆ™</code>çš„æŒ‡å¯¼æ€æƒ³, ä¸€ä¸ªç±»å†™å¥½åï¼Œå°½é‡ä¸è¦ä¿®æ”¹é‡Œé¢çš„å†…å®¹, è€Œæ˜¯é€šè¿‡æ·»åŠ æ–°çš„ç»§æ‰¿åº”å¯¹å˜åŒ–, ç®€å•å·¥å‚ä¸ç¬¦åˆè¿™ä¸ªè®¾è®¡åŸåˆ™, æ‰€ä»¥æœ¬ç¯‡æ–‡ç« å°†ä½¿ç”¨ä¼ªä»£ç ä»‹ç»å·¥å‚æ–¹æ³•è®¾è®¡æ¨¡å¼çš„ä½¿ç”¨</p>
</blockquote>
<p>èƒŒæ™¯: ç°å…¬å¸ç›‘æ§ç³»ç»ŸæŠ¥è­¦éœ€è¦å¯¹æ¥ä¼ä¸šå¾®ä¿¡å…¬ä¼—å·, ç”±äºæœªè®¤è¯ä¼ä¸šå¾®ä¿¡æ¨é€æ¶ˆæ¯çš„é™åˆ¶, é»˜è®¤æ¯å¤©æ¨é€æ¡æ•°ä¸Šé™ä¸º<code>6000</code>æ¡, è€ƒè™‘åˆ°æŠ¥è­¦ç³»ç»Ÿå¤š, è§„åˆ™æ²¡æœ‰æ”¶æ•›, æ¥æ”¶çš„äººå‘˜å¤š, æ¯å¤©6000æ¡å¯èƒ½ä¸å¤Ÿç”¨, æ‰€ä»¥éœ€è¦åˆ›å»ºå¤šä¸ªæœªè®¤è¯çš„ä¼ä¸šå¾®ä¿¡è´¦å·ç”¨äºå‘é€æŠ¥è­¦ä¿¡æ¯. æˆ‘ä»¬å°†ä»¥æ­¤éœ€æ±‚ä¸ºèƒŒæ™¯, æ¼”ç¤ºå·¥å‚æ–¹æ³•çš„è®¾è®¡æ¨¡å¼</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WeChat</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">send_message</span><span class="params">(self, content)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">send_image</span><span class="params">(self, imageid)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AccountA</span><span class="params">(WeChat)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">send_message</span><span class="params">(self, content)</span>:</span></span><br><span class="line">        print(<span class="string">"ä½¿ç”¨ä¼ä¸šå¾®ä¿¡è´¦å·Aæ¨é€ä¿¡æ¯: "</span>, content)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">send_image</span><span class="params">(self, imageid)</span>:</span></span><br><span class="line">        print(<span class="string">"ä½¿ç”¨ä¼ä¸šå¾®ä¿¡è´¦å·Aæ¨é€å›¾ç‰‡: "</span>, imageid)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AccountB</span><span class="params">(WeChat)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">send_message</span><span class="params">(self, content)</span>:</span></span><br><span class="line">        print(<span class="string">"ä½¿ç”¨ä¼ä¸šå¾®ä¿¡è´¦å·Bæ¨é€ä¿¡æ¯: "</span>, content)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">send_image</span><span class="params">(self, imageid)</span>:</span></span><br><span class="line">        print(<span class="string">"ä½¿ç”¨ä¼ä¸šå¾®ä¿¡è´¦å·Bæ¨é€å›¾ç‰‡: "</span>, imageid)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WeChatFactory</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create_wechat</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AccountAFactory</span><span class="params">(WeChatFactory)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create_wechat</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> AccountA()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AccountBFactory</span><span class="params">(WeChatFactory)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create_wechat</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> AccountB()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">	<span class="comment"># å®ä¾‹åŒ–è´¦å·A</span></span><br><span class="line">    wechat_factory_a = AccountAFactory()</span><br><span class="line">	<span class="comment"># åˆ›å»ºè´¦å·Açš„å¾®ä¿¡å¯¹è±¡</span></span><br><span class="line">    wechat1 = wechat_factory_a.create_wechat()</span><br><span class="line">    wechat2 = wechat_factory_a.create_wechat()</span><br><span class="line">    wechat3 = wechat_factory_a.create_wechat()</span><br><span class="line">	<span class="comment"># ä½¿ç”¨è´¦å·Aå¯¹è±¡å‘é€ä¿¡æ¯</span></span><br><span class="line">    wechat1.send_message(content=<span class="string">"haha"</span>)</span><br><span class="line">    wechat2.send_message(content=<span class="string">"hehe"</span>)</span><br><span class="line">    wechat3.send_message(content=<span class="string">"xixi"</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment"># å®ä¾‹åŒ–è´¦å·B</span></span><br><span class="line">    wechat_factory_b = AccountBFactory()</span><br><span class="line">	<span class="comment"># åˆ›å»ºè´¦å·Bçš„å¾®ä¿¡å¯¹è±¡</span></span><br><span class="line">    wechat4 = wechat_factory_b.create_wechat()</span><br><span class="line">    wechat5 = wechat_factory_b.create_wechat()</span><br><span class="line">	<span class="comment"># ä½¿ç”¨è´¦å·Bå¯¹è±¡å‘é€ä¿¡æ¯</span></span><br><span class="line">    wechat4.send_message(content=<span class="string">"heihei"</span>)</span><br><span class="line">    wechat5.send_message(content=<span class="string">"pupu"</span>)</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ä½¿ç”¨ä¼ä¸šå¾®ä¿¡è´¦å·Aæ¨é€ä¿¡æ¯:  haha</span><br><span class="line">ä½¿ç”¨ä¼ä¸šå¾®ä¿¡è´¦å·Aæ¨é€ä¿¡æ¯:  hehe</span><br><span class="line">ä½¿ç”¨ä¼ä¸šå¾®ä¿¡è´¦å·Aæ¨é€ä¿¡æ¯:  xixi</span><br><span class="line">ä½¿ç”¨ä¼ä¸šå¾®ä¿¡è´¦å·Bæ¨é€ä¿¡æ¯:  heihei</span><br><span class="line">ä½¿ç”¨ä¼ä¸šå¾®ä¿¡è´¦å·Bæ¨é€ä¿¡æ¯:  pupu</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæ­¤æ—¶, ä¸¤ä¸ªå¾®ä¿¡è´¦å·éƒ½ä¸å¤Ÿç”¨äº†, éœ€è¦å¢åŠ ç¬¬ä¸‰ä¸ªè´¦å·æ—¶, æ‰€æœ‰çš„ç±»éƒ½ä¸éœ€è¦ä¿®æ”¹, åªéœ€åˆ›å»ºæ–°çš„ç±»å³å¯, ç¬¦åˆå¼€æ”¾å°é—­åŸåˆ™</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AccountC</span><span class="params">(WeChat)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">send_message</span><span class="params">(self, content)</span>:</span></span><br><span class="line">        print(<span class="string">"ä½¿ç”¨ä¼ä¸šå¾®ä¿¡è´¦å·Cæ¨é€ä¿¡æ¯: "</span>, content)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">send_image</span><span class="params">(self, imageid)</span>:</span></span><br><span class="line">        print(<span class="string">"ä½¿ç”¨ä¼ä¸šå¾®ä¿¡è´¦å·Cæ¨é€å›¾ç‰‡: "</span>, imageid)</span><br><span class="line">      </span><br><span class="line">    </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AccountCFactory</span><span class="params">(WeChatFactory)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create_wechat</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> AccountC()</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>è®¾è®¡æ¨¡å¼</tag>
        <tag>å·¥å‚æ–¹æ³•æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonä½¿ç”¨sortedå¯¹å­—å…¸çš„keyæˆ–valueæ’åº</title>
    <url>/2018/08/08/Python%E4%BD%BF%E7%94%A8sorted%E5%AF%B9%E5%AD%97%E5%85%B8%E7%9A%84key%E6%88%96value%E6%8E%92%E5%BA%8F/</url>
    <content><![CDATA[<h2 id="sortedå‡½æ•°"><a href="#sortedå‡½æ•°" class="headerlink" title="sortedå‡½æ•°"></a>sortedå‡½æ•°</h2><p>sorted(iterable,key,reverse)</p>
<ul>
<li>iterable å¾…æ’åºçš„å¯è¿­ä»£å¯¹è±¡</li>
<li>key å¯¹åº”çš„æ˜¯ä¸ªå‡½æ•°, è¯¥å‡½æ•°ç”¨æ¥å†³å®šé€‰å–ç”¨å“ªäº›å€¼æ¥è¿›è¡Œæ’åº</li>
<li>reverse åè½¬æ’åº</li>
</ul>
<h2 id="å¯¹keyæ’åº"><a href="#å¯¹keyæ’åº" class="headerlink" title="å¯¹keyæ’åº"></a>å¯¹keyæ’åº</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">d: dict = &#123;<span class="string">"p"</span>: <span class="number">59</span>, <span class="string">"o"</span>: <span class="number">9</span>, <span class="string">"s"</span>: <span class="number">5</span>, <span class="string">"a"</span>: <span class="number">20</span>, <span class="string">"z"</span>: <span class="number">18</span>&#125;</span><br><span class="line"></span><br><span class="line">li: list = sorted(d.keys())</span><br><span class="line">print(li)</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[&#39;a&#39;, &#39;o&#39;, &#39;p&#39;, &#39;s&#39;, &#39;z&#39;]</span><br></pre></td></tr></table></figure>



<h2 id="å¯¹valueæ’åº"><a href="#å¯¹valueæ’åº" class="headerlink" title="å¯¹valueæ’åº"></a>å¯¹valueæ’åº</h2><p>åœ¨å¯¹valueä¹‹å‰, å…ˆæ¥å›ç‚‰ä¸€ä¸‹Pythonçš„lambdaè¡¨è¾¾å¼</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">f = <span class="keyword">lambda</span> x: x+<span class="number">1</span></span><br><span class="line">print(f(<span class="number">5</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ff</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> x+<span class="number">1</span></span><br><span class="line">print(ff(<span class="number">5</span>))</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">6</span><br><span class="line">6</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šä¸¤ç§æ–¹å¼æ˜¯ç­‰ä»·çš„, lambdaè¡¨è¾¾å¼å†™æ³•æ›´ç®€æ´, ä¸€èˆ¬å½“åšåŒ¿åè¡¨è¾¾å¼/åŒ¿åå‡½æ•°ä½¿ç”¨</p>
<p><code>lambda x:y</code> </p>
<ul>
<li>x ä¸ºå…¥å‚</li>
<li>y ä¸ºè®¡ç®—è¡¨è¾¾å¼, è¿ç®—åè¿”å›</li>
</ul>
<p>æ¥ä¸‹æ¥è¿›å…¥åˆ°å¯¹å­—å…¸çš„valueæ’åºæ­£é¢˜, è¿™é‡Œå°±éœ€è¦ä½¿ç”¨åˆ°lambdaè¡¨è¾¾å¼</p>
<h3 id="ç›´æ¥å¯¹å€¼æ’åº"><a href="#ç›´æ¥å¯¹å€¼æ’åº" class="headerlink" title="ç›´æ¥å¯¹å€¼æ’åº"></a>ç›´æ¥å¯¹å€¼æ’åº</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">d: dict = &#123;<span class="string">"p"</span>: <span class="number">59</span>, <span class="string">"o"</span>: <span class="number">9</span>, <span class="string">"s"</span>: <span class="number">5</span>, <span class="string">"a"</span>: <span class="number">20</span>, <span class="string">"z"</span>: <span class="number">18</span>&#125;</span><br><span class="line"></span><br><span class="line">li: list = sorted(d.values())</span><br><span class="line">print(li)</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[5, 9, 18, 20, 59]</span><br></pre></td></tr></table></figure>

<h3 id="åœ¨åŒ…å«Keyçš„æƒ…å†µä¸‹å¯¹å€¼æ’åº"><a href="#åœ¨åŒ…å«Keyçš„æƒ…å†µä¸‹å¯¹å€¼æ’åº" class="headerlink" title="åœ¨åŒ…å«Keyçš„æƒ…å†µä¸‹å¯¹å€¼æ’åº"></a>åœ¨åŒ…å«Keyçš„æƒ…å†µä¸‹å¯¹å€¼æ’åº</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">d: dict = &#123;<span class="string">"p"</span>: <span class="number">59</span>, <span class="string">"o"</span>: <span class="number">9</span>, <span class="string">"s"</span>: <span class="number">5</span>, <span class="string">"a"</span>: <span class="number">20</span>, <span class="string">"z"</span>: <span class="number">18</span>&#125;</span><br><span class="line"></span><br><span class="line">li: list = sorted(d.items(), key=<span class="keyword">lambda</span> x: x[<span class="number">1</span>])</span><br><span class="line">print(li)</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[(&#39;s&#39;, 5), (&#39;o&#39;, 9), (&#39;z&#39;, 18), (&#39;a&#39;, 20), (&#39;p&#39;, 59)]</span><br></pre></td></tr></table></figure>



<p><code>d.items()</code> è¿”å›ä»¥å…ƒç»„å½¢å¼æ„æˆçš„åˆ—è¡¨ <code>dict_items([(&#39;p&#39;, 59), (&#39;o&#39;, 9), (&#39;s&#39;, 5), (&#39;a&#39;, 20), (&#39;z&#39;, 18)])</code>  (åˆ—è¡¨ä¸ºå¯è¿­ä»£å¯¹è±¡)</p>
<p><code>lambda x: x[1]</code> lambdaè¡¨è¾¾å¼ä¸­, xä¸ºå…¥å‚, æ¯æ¬¡xçš„å€¼ä¸ºä¸€ä¸ª<code>d.items()</code>ä¸­çš„å…ƒç´ (ä¸€ä¸ªå…ƒç»„), ç¬¬ä¸€ä¸ªå…¥å‚ä¸º<code>(&#39;p&#39;, 59)</code> å†’å·åé¢çš„x[1]æ˜¯è¿ç®—è¡¨è¾¾å¼, æ„æ€æ˜¯å–å…ƒç»„ä¸­çš„ç¬¬äºŒä¸ªå…ƒç´ è¿”å›(ç´¢å¼•ä¸º1), è¿”å›çš„å…ƒç´ å³ä¸ºæ’åºçš„ä¾æ®. æ‰€ä»¥å¦‚æœéœ€è¦å¯¹keyè¿›è¡Œæ’åº, ä¹Ÿå¯ä»¥åœ¨è¡¨è¾¾å¼é‡Œå†™ <code>x[0]</code></p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>lambda</tag>
        <tag>sorted</tag>
        <tag>dict</tag>
      </tags>
  </entry>
  <entry>
    <title>aiohttp+uvloop+gunicorn</title>
    <url>/2018/08/08/aiohttp-uvloop-gunicorn/</url>
    <content><![CDATA[<h1 id="aiohttp-uvloop"><a href="#aiohttp-uvloop" class="headerlink" title="aiohttp+uvloop"></a>aiohttp+uvloop</h1><p><strong>main.py</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> uvloop</span><br><span class="line"><span class="keyword">from</span> aiohttp <span class="keyword">import</span> web</span><br><span class="line"><span class="keyword">from</span> utils.logger_helper <span class="keyword">import</span> LogFactory</span><br><span class="line"></span><br><span class="line">logger = LogFactory.get_logger()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    logger.info(<span class="string">"Server Starting at &#123;0&#125;;&#123;1&#125;"</span>.format(cfg.host, cfg.port))</span><br><span class="line">    app = web.Application()</span><br><span class="line">    setup_routes(app)</span><br><span class="line">    app.on_shutdown.append(shutdown)</span><br><span class="line">    web.run_app(app, host=cfg.host, port=cfg.port)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    <span class="comment"># ä½¿ç”¨ uvloop æ›¿æ¢æ‰ asyncio é»˜è®¤çš„äº‹ä»¶å¾ªç¯</span></span><br><span class="line">    asyncio.set_event_loop_policy(uvloop.EventLoopPolicy())</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># å¯åŠ¨ Server</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        main()</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        logger.error(e)</span><br></pre></td></tr></table></figure>



<h1 id="aiohttp-uvloop-gunicorn"><a href="#aiohttp-uvloop-gunicorn" class="headerlink" title="aiohttp+uvloop+gunicorn"></a>aiohttp+uvloop+gunicorn</h1><p><strong>main.py</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># For Gunicorn</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">web_app</span><span class="params">()</span>:</span></span><br><span class="line">    logger.info(<span class="string">"Server Starting at &#123;0&#125;;&#123;1&#125;"</span>.format(cfg.host, cfg.port))</span><br><span class="line">    app = web.Application()</span><br><span class="line">    setup_routes(app)</span><br><span class="line">    app.on_shutdown.append(shutdown)</span><br><span class="line">    <span class="keyword">return</span> app</span><br></pre></td></tr></table></figure>

<p><code>gunicorn ... --worker-class aiohttp.worker.GunicornUVLoopWebWorker</code></p>
<p>åœ¨å¯åŠ¨gunicornçš„æ—¶å€™, æŒ‡å®šuvloopçš„worker-classå³å¯</p>
<h1 id="How-to-use-uvloop-in-an-asyncio-application"><a href="#How-to-use-uvloop-in-an-asyncio-application" class="headerlink" title="How to use uvloop in an asyncio application"></a>How to use uvloop in an asyncio application</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> uvloop</span><br><span class="line">asyncio.set_event_loop_policy(uvloop.EventLoopPolicy())</span><br></pre></td></tr></table></figure>

<h1 id="How-to-use-uvloop-with-Tornado"><a href="#How-to-use-uvloop-with-Tornado" class="headerlink" title="How to use uvloop with Tornado"></a>How to use uvloop with Tornado</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> tornado.platform.asyncio <span class="keyword">import</span> AsyncIOMainLoop</span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> uvloop</span><br><span class="line"></span><br><span class="line">asyncio.set_event_loop_policy(uvloop.EventLoopPolicy())</span><br><span class="line">AsyncIOMainLoop().install()</span><br><span class="line">asyncio.get_event_loop().run_forever()</span><br></pre></td></tr></table></figure>

<p>å‚è€ƒæ–‡æ¡£:</p>
<ul>
<li><a href="https://github.com/MagicStack/uvloop/wiki" target="_blank" rel="noopener">https://github.com/MagicStack/uvloop/wiki</a></li>
</ul>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>aiohttp</tag>
        <tag>uvloop</tag>
        <tag>gunicorn</tag>
        <tag>tornado</tag>
      </tags>
  </entry>
  <entry>
    <title>Python SMTPException: No suitable authentication method found</title>
    <url>/2018/08/08/Python-SMTPException-No-suitable-authentication-method-found/</url>
    <content><![CDATA[<p>æœ€è¿‘åœ¨å‘é€é‚®ä»¶æ—¥æŠ¥æ—¶, ä½¿ç”¨<code>smtplib</code>åº“æŠ›äº†ä¸€ä¸ªå¼‚å¸¸<code>raise SMTPException(&quot;No suitable authentication method found.&quot;)</code></p>
<p>åŸå› æ˜¯é…ç½®äº†<code>https</code>çš„é‚®ä»¶æœåŠ¡å™¨, åœ¨åˆå§‹åŒ–SMTPå’Œloginä¹‹é—´è°ƒç”¨<code>starttls()</code>æ–¹æ³•å³å¯è§£å†³é—®é¢˜</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> smtplib</span><br><span class="line">server = smtplib.SMTP(self.server, self.port)</span><br><span class="line">server.set_debuglevel(<span class="number">1</span>)</span><br><span class="line">server.starttls()</span><br><span class="line">server.login(self.send_user, self.password)</span><br><span class="line">server.sendmail(self.send_user, [to], msg.as_string())</span><br><span class="line">server.quit()</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>smtplib</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonä¸­çš„æŠ½è±¡æ–¹æ³•@abstractmethod</title>
    <url>/2018/08/08/Python%E4%B8%AD%E7%9A%84%E6%8A%BD%E8%B1%A1%E6%96%B9%E6%B3%95-abstractmethod/</url>
    <content><![CDATA[<blockquote>
<p>æŠ½è±¡æ–¹æ³•æ˜¯çˆ¶ç±»çš„ä¸€ä¸ªæ–¹æ³•, çˆ¶ç±»æ²¡æœ‰å®ç°è¿™ä¸ªæ–¹æ³•, çˆ¶ç±»æ˜¯ä¸å¯ä»¥å®ä¾‹åŒ–çš„. å­ç±»ç»§æ‰¿çˆ¶ç±», å­ç±»å¿…é¡»å®ç°çˆ¶ç±»å®šä¹‰çš„æŠ½è±¡æ–¹æ³•, å­ç±»æ‰å¯ä»¥è¢«å®ä¾‹åŒ–. Pythonä¸­çš„abcæä¾›äº†@abstractmethodè£…é¥°å™¨å®ç°æŠ½è±¡æ–¹æ³•çš„å®šä¹‰</p>
</blockquote>
<h2 id="æŠ½è±¡ç±»çš„å®ç°"><a href="#æŠ½è±¡ç±»çš„å®ç°" class="headerlink" title="æŠ½è±¡ç±»çš„å®ç°"></a>æŠ½è±¡ç±»çš„å®ç°</h2><p>Python 3.4+</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span><span class="params">(ABC)</span>:</span></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">fun</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        ä½ éœ€è¦åœ¨å­ç±»ä¸­å®ç°è¯¥æ–¹æ³•, å­ç±»æ‰å…è®¸è¢«å®ä¾‹åŒ–</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SubFoo</span><span class="params">(Foo)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">fun</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"å­ç±»å®ç°çˆ¶ç±»çš„æŠ½è±¡æ–¹æ³•"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line"></span><br><span class="line">    sf = SubFoo()</span><br><span class="line">    sf.fun()</span><br></pre></td></tr></table></figure>

<p>Python 3.0 - 3.3 ç‰ˆæœ¬</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> abstractmethod, ABCMeta</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span><span class="params">(metaclass=ABCMeta)</span>:</span></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">fun</span><span class="params">(self)</span>:</span></span><br><span class="line">    	<span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<p>Python 2 ç‰ˆæœ¬</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABCMeta, abstractmethod</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FooBar</span><span class="params">()</span>:</span></span><br><span class="line">    __metaclass__ = ABCMeta</span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">fun</span><span class="params">(self)</span>:</span></span><br><span class="line">    	<span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<h2 id="æµ…è°ˆæŠ½è±¡ç±»"><a href="#æµ…è°ˆæŠ½è±¡ç±»" class="headerlink" title="æµ…è°ˆæŠ½è±¡ç±»"></a>æµ…è°ˆæŠ½è±¡ç±»</h2><p>ç±», æ˜¯ä»ä¸€å †å¯¹è±¡ä¸­æŠ½è±¡å‡ºæ¥çš„, æ¯”å¦‚<code>çŒ«ç±»</code>,<code>ç‹—ç±»</code>,<code>äººç±»</code></p>
<p>æŠ½è±¡ç±», æ˜¯ä»ä¸€å †ç±»ä¸­æŠ½è±¡å‡ºæ¥çš„,  æ¯”å¦‚ä¸Šé¢çš„ä¸‰ä¸ªç±»å¯ä»¥æŠ½å–å‡º<code>åŠ¨ç‰©ç±»</code></p>
<p>æŠ½è±¡ç±»çš„ç‰¹ç‚¹æ˜¯ä¸èƒ½ç»™å®ä¾‹åŒ–, åªèƒ½è¢«å­ç±»ç»§æ‰¿, ç”±å­ç±»å®ç°äº†çˆ¶ç±»çš„æŠ½è±¡æ–¹æ³•å, å­ç±»æ‰èƒ½è¢«å®ä¾‹åŒ–</p>
<h2 id="Pythonä¸­çš„æ¥å£-æŠ½è±¡ç±»-æŠ½è±¡å‡½æ•°"><a href="#Pythonä¸­çš„æ¥å£-æŠ½è±¡ç±»-æŠ½è±¡å‡½æ•°" class="headerlink" title="Pythonä¸­çš„æ¥å£, æŠ½è±¡ç±», æŠ½è±¡å‡½æ•°"></a>Pythonä¸­çš„æ¥å£, æŠ½è±¡ç±», æŠ½è±¡å‡½æ•°</h2><p>Pythonä¸­çš„æ¥å£æ˜¯ä¸ªå¼±æ¦‚å¿µ, ä»Javaä¸­çš„æ¦‚å¿µå»¶ä¼¸è€Œæ¥, Pythonä¸­é€šè¿‡æŠ½è±¡ç±»å’ŒæŠ½è±¡æ–¹æ³•æ¥å®ç°ä¸€ä¸ªæ¥å£, ä¾‹å¦‚Python3ä¸­, class ç±»ç»§æ‰¿çš„ <code>abc.ABC</code> å³ä¸ºæŠ½è±¡ç±», <code>@abstractmethod</code> è£…é¥°å™¨ä½¿å…¶è£…é¥°çš„å‡½æ•°æˆä¸ºæŠ½è±¡å‡½æ•°</p>
<p>ä¸€èˆ¬æƒ…å†µä¸‹, Pythonå¤šåœ¨å•ç»§æ‰¿çš„æƒ…å†µä¸‹ä½¿ç”¨æŠ½è±¡ç±»</p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>abstractmethod</tag>
        <tag>æŠ½è±¡ç±»</tag>
        <tag>æŠ½è±¡æ–¹æ³•</tag>
        <tag>æ¥å£</tag>
      </tags>
  </entry>
  <entry>
    <title>GoåŸºç¡€ä¹‹åˆ‡ç‰‡Sliceæ“ä½œ</title>
    <url>/2018/08/08/Go%E5%9F%BA%E7%A1%80%E4%B9%8B%E5%88%87%E7%89%87Slice%E6%93%8D%E4%BD%9C/</url>
    <content><![CDATA[<h2 id="å‘Sliceä¸­æ·»åŠ å…ƒç´ "><a href="#å‘Sliceä¸­æ·»åŠ å…ƒç´ " class="headerlink" title="å‘Sliceä¸­æ·»åŠ å…ƒç´ "></a>å‘Sliceä¸­æ·»åŠ å…ƒç´ </h2><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	arr := [...]<span class="keyword">string</span>&#123;<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>, <span class="string">"d"</span>, <span class="string">"e"</span>, <span class="string">"f"</span>, <span class="string">"g"</span>, <span class="string">"h"</span>&#125;</span><br><span class="line">	s := arr[<span class="number">2</span>:<span class="number">6</span>]</span><br><span class="line">	ss := <span class="built_in">append</span>(s, <span class="string">"xx"</span>)</span><br><span class="line">	sss := <span class="built_in">append</span>(ss, <span class="string">"yy"</span>)</span><br><span class="line">	ssss := <span class="built_in">append</span>(sss, <span class="string">"zz"</span>)</span><br><span class="line">	fmt.Println(<span class="string">"s"</span>, s)</span><br><span class="line">	fmt.Println(<span class="string">"ss"</span>, ss)</span><br><span class="line">	fmt.Println(<span class="string">"sss"</span>, sss)</span><br><span class="line">	fmt.Println(<span class="string">"ssss"</span>, ssss)</span><br><span class="line">	fmt.Println(<span class="string">"arr"</span>, arr)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">s [c d e f]</span><br><span class="line">ss [c d e f xx]</span><br><span class="line">sss [c d e f xx yy]</span><br><span class="line">ssss [c d e f xx yy zz]</span><br><span class="line">arr [a b c d e f xx yy]</span><br></pre></td></tr></table></figure>

<p>ä»æ‰§è¡Œç»“æœä¸­å¯ä»¥çœ‹å‡º, å‘Sliceä¸­appendå…ƒç´ å, ä¼šè¦†ç›–æ‰åº•å±‚Arrayçš„å€¼, ä¼šè¦†ç›–æ‰ç´¢å¼•ä¸º<code>ptr+len(Slice)</code>çš„å€¼. å½“Slice appendå, è¶…å‡ºäº†capçš„é•¿åº¦, åº•å±‚Arrayä¸­å·²ç»æ²¡æœ‰å¤šä½™çš„å€¼å¯ä»¥ç»™ä»–è¦†ç›–å, è¿™æ—¶, æ–°çš„Sliceå…¶å®å·²ç»ä¸å†æ˜¯è€çš„Arrayçš„viewäº†, Goè¯­è¨€ä¼šåœ¨å†…éƒ¨åˆ›å»ºä¸€ä¸ªæ–°çš„Array, æŠŠè€æ•°æ®æ‹·è´è¿‡å», ä¸”æ–°çš„Arrayçš„é•¿åº¦ä¼šè®¾ç½®çš„æ›´é•¿ä¸€äº›. ä¸Šé¢çš„Demoä¸­, sssså·²ç»ä¸å†æ˜¯åŸå§‹Arrayçš„view</p>
<ul>
<li><p>å½“æ·»åŠ å…ƒç´ æ—¶, å¦‚æœè¶…è¶Šäº†cap, ç³»ç»Ÿä¼šé‡æ–°åˆ†é…æ›´å¤§çš„åº•å±‚æ•°ç»„, åŸæ¥çš„Arrayå¦‚æœæ²¡æœ‰è¢«ä»»ä½•å¯¹è±¡ä½¿ç”¨, å°†è¢«åƒåœ¾å›æ”¶æœºåˆ¶å›æ”¶</p>
</li>
<li><p>ç”±äºGoè¯­è¨€æ˜¯å€¼ä¼ é€’, åœ¨appendå, å¿…é¡»æ¥æ”¶å…¶è¿”å›å€¼. åŸå› æ˜¯åœ¨appendæ“ä½œå, Sliceçš„lenè‚¯å®šä¼šå˜åŒ–, å¦‚æœè¶…è¿‡äº†Arrayé•¿åº¦, capçš„å€¼ä¹Ÿä¼šå˜åŒ–, æ‰€ä»¥éœ€è¦æˆ‘ä»¬ä½¿ç”¨æ–°çš„Sliceå¯¹è±¡å»æ¥æ”¶æ–°çš„è¿”å›å€¼</p>
</li>
</ul>
<h2 id="åˆ›å»ºSlice"><a href="#åˆ›å»ºSlice" class="headerlink" title="åˆ›å»ºSlice"></a>åˆ›å»ºSlice</h2><p>ä¸Šä¸€ç¯‡æ–‡ç« çš„ä»‹ç»ä¸­, å…¨ç¯‡éƒ½ä½¿ç”¨äº†Arrayå»åˆ›å»ºSlice, æˆ‘ä»¬å¯ä»¥ç›´æ¥åˆ›å»ºSlice</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">printSliceInfo</span><span class="params">(s []<span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">	fmt.Printf(<span class="string">"len=%d cap=%d\n"</span>, <span class="built_in">len</span>(s), <span class="built_in">cap</span>(s))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> s []<span class="keyword">int</span>  <span class="comment">// å£°æ˜åˆ›å»ºä¸€ä¸ªintç±»å‹çš„Slice</span></span><br><span class="line">	<span class="comment">// å¦‚æœå˜é‡æ²¡æœ‰è¢«èµ‹å€¼, Goè¯­è¨€ä¼šä¸ºæ¯ä¸ªå˜é‡å®šä¹‰Zero Value</span></span><br><span class="line">	<span class="comment">// Sliceçš„Zero Value ä¸º nil</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i:=<span class="number">0</span>; i&lt;=<span class="number">59</span>; i++ &#123;</span><br><span class="line">		printSliceInfo(s)</span><br><span class="line">		s = <span class="built_in">append</span>(s, i)</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">len&#x3D;0 cap&#x3D;0</span><br><span class="line">len&#x3D;1 cap&#x3D;1</span><br><span class="line">len&#x3D;2 cap&#x3D;2</span><br><span class="line">len&#x3D;3 cap&#x3D;4</span><br><span class="line">len&#x3D;4 cap&#x3D;4</span><br><span class="line">len&#x3D;5 cap&#x3D;8</span><br><span class="line">len&#x3D;6 cap&#x3D;8</span><br><span class="line">len&#x3D;7 cap&#x3D;8</span><br><span class="line">len&#x3D;8 cap&#x3D;8</span><br><span class="line">len&#x3D;9 cap&#x3D;16</span><br><span class="line">len&#x3D;10 cap&#x3D;16</span><br><span class="line">len&#x3D;11 cap&#x3D;16</span><br><span class="line">len&#x3D;12 cap&#x3D;16</span><br><span class="line">len&#x3D;13 cap&#x3D;16</span><br><span class="line">len&#x3D;14 cap&#x3D;16</span><br><span class="line">len&#x3D;15 cap&#x3D;16</span><br><span class="line">len&#x3D;16 cap&#x3D;16</span><br><span class="line">len&#x3D;17 cap&#x3D;32</span><br><span class="line">len&#x3D;18 cap&#x3D;32</span><br><span class="line">len&#x3D;19 cap&#x3D;32</span><br><span class="line">len&#x3D;20 cap&#x3D;32</span><br><span class="line">len&#x3D;21 cap&#x3D;32</span><br><span class="line">len&#x3D;22 cap&#x3D;32</span><br><span class="line">len&#x3D;23 cap&#x3D;32</span><br><span class="line">len&#x3D;24 cap&#x3D;32</span><br><span class="line">len&#x3D;25 cap&#x3D;32</span><br><span class="line">len&#x3D;26 cap&#x3D;32</span><br><span class="line">len&#x3D;27 cap&#x3D;32</span><br><span class="line">len&#x3D;28 cap&#x3D;32</span><br><span class="line">len&#x3D;29 cap&#x3D;32</span><br><span class="line">len&#x3D;30 cap&#x3D;32</span><br><span class="line">len&#x3D;31 cap&#x3D;32</span><br><span class="line">len&#x3D;32 cap&#x3D;32</span><br><span class="line">len&#x3D;33 cap&#x3D;64</span><br><span class="line">len&#x3D;34 cap&#x3D;64</span><br><span class="line">len&#x3D;35 cap&#x3D;64</span><br><span class="line">len&#x3D;36 cap&#x3D;64</span><br><span class="line">len&#x3D;37 cap&#x3D;64</span><br><span class="line">len&#x3D;38 cap&#x3D;64</span><br><span class="line">len&#x3D;39 cap&#x3D;64</span><br><span class="line">len&#x3D;40 cap&#x3D;64</span><br><span class="line">len&#x3D;41 cap&#x3D;64</span><br><span class="line">len&#x3D;42 cap&#x3D;64</span><br><span class="line">len&#x3D;43 cap&#x3D;64</span><br><span class="line">len&#x3D;44 cap&#x3D;64</span><br><span class="line">len&#x3D;45 cap&#x3D;64</span><br><span class="line">len&#x3D;46 cap&#x3D;64</span><br><span class="line">len&#x3D;47 cap&#x3D;64</span><br><span class="line">len&#x3D;48 cap&#x3D;64</span><br><span class="line">len&#x3D;49 cap&#x3D;64</span><br><span class="line">len&#x3D;50 cap&#x3D;64</span><br><span class="line">len&#x3D;51 cap&#x3D;64</span><br><span class="line">len&#x3D;52 cap&#x3D;64</span><br><span class="line">len&#x3D;53 cap&#x3D;64</span><br><span class="line">len&#x3D;54 cap&#x3D;64</span><br><span class="line">len&#x3D;55 cap&#x3D;64</span><br><span class="line">len&#x3D;56 cap&#x3D;64</span><br><span class="line">len&#x3D;57 cap&#x3D;64</span><br><span class="line">len&#x3D;58 cap&#x3D;64</span><br><span class="line">len&#x3D;59 cap&#x3D;64</span><br><span class="line">[0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59]</span><br></pre></td></tr></table></figure>

<p>ä»ä¸Šé¢çš„æ‰§è¡Œç»“æœå¯ä»¥çœ‹å‡º, Goè¯­è¨€ä¼šæ ¹æ®ä½¿ç”¨æƒ…å†µè‡ªåŠ¨å»æ‰©å±•Sliceçš„lenä»¥åŠcap</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">printSliceInfo</span><span class="params">(s []<span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">	fmt.Printf(<span class="string">"len=%d cap=%d\n"</span>, <span class="built_in">len</span>(s), <span class="built_in">cap</span>(s))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	s := []<span class="keyword">string</span>&#123;<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>&#125;  <span class="comment">// é¦–å…ˆåˆ›å»ºäº†ä¸ªArray, ç„¶åå¯¹å…¶view</span></span><br><span class="line">	printSliceInfo(s)</span><br><span class="line"></span><br><span class="line">	ss := <span class="built_in">make</span>([]<span class="keyword">string</span>, <span class="number">16</span>, <span class="number">32</span>)  <span class="comment">// åˆ›å»ºä¸€ä¸ªlenä¸º16, capä¸º32çš„stringç±»å‹Slice</span></span><br><span class="line">	printSliceInfo(ss)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">len&#x3D;3 cap&#x3D;3</span><br><span class="line">  len&#x3D;16 cap&#x3D;32</span><br></pre></td></tr></table></figure>

<h2 id="æ‹·è´Slice"><a href="#æ‹·è´Slice" class="headerlink" title="æ‹·è´Slice"></a>æ‹·è´Slice</h2><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">printSliceInfo</span><span class="params">(s []<span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">	fmt.Printf(<span class="string">"len=%d cap=%d\n"</span>, <span class="built_in">len</span>(s), <span class="built_in">cap</span>(s))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	s := []<span class="keyword">int</span>&#123;<span class="number">2015</span>, <span class="number">5</span>, <span class="number">9</span>&#125;  <span class="comment">// é¦–å…ˆåˆ›å»ºäº†ä¸ªArray, ç„¶åå¯¹å…¶view</span></span><br><span class="line">	printSliceInfo(s)</span><br><span class="line">	fmt.Println(<span class="string">"s"</span>, s)</span><br><span class="line"></span><br><span class="line">	ss := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">4</span>, <span class="number">8</span>)  <span class="comment">// åˆ›å»ºä¸€ä¸ªlenä¸º16, capä¸º32çš„stringç±»å‹Slice</span></span><br><span class="line">	printSliceInfo(ss)</span><br><span class="line">	fmt.Println(<span class="string">"ss"</span>, ss)</span><br><span class="line"></span><br><span class="line">	<span class="built_in">copy</span>(ss, s)  <span class="comment">// å°†såˆ‡ç‰‡çš„æ•°æ®æ‹·è´åˆ°ssåˆ‡ç‰‡ä¸­</span></span><br><span class="line">	fmt.Println(<span class="string">"ss"</span>, ss)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">len&#x3D;3 cap&#x3D;3</span><br><span class="line">s [2015 5 9]</span><br><span class="line">len&#x3D;4 cap&#x3D;8</span><br><span class="line">ss [0 0 0 0]</span><br><span class="line">ss [2015 5 9 0]</span><br></pre></td></tr></table></figure>

<h2 id="åˆ é™¤Sliceä¸­çš„å…ƒç´ "><a href="#åˆ é™¤Sliceä¸­çš„å…ƒç´ " class="headerlink" title="åˆ é™¤Sliceä¸­çš„å…ƒç´ "></a>åˆ é™¤Sliceä¸­çš„å…ƒç´ </h2><p>å¯¹äºSliceçš„åˆ é™¤åŠŸèƒ½, Goè¯­è¨€æ²¡æœ‰æä¾›ç›´æ¥çš„æ“ä½œè¯­å¥, ä½†æ˜¯å¯ä»¥é€šè¿‡Resliceæ¥å®ç°</p>
<p>éœ€æ±‚: åˆ é™¤Sliceä¸­çš„ç¬¬3ä¸ªå…ƒç´  [12, 34, 56, 78, 90, 89, 72]</p>
<p>æ€è·¯: ä½¿ç”¨Reslice, s[:3] + s[4:] å–å¾—çš„å°±æ˜¯åˆ é™¤åŸåˆ‡ç‰‡ç¬¬ä¸‰ä¸ªå…ƒç´ çš„æ•°æ®, ä½†Goè¯­è¨€ä¹Ÿæ²¡æœ‰æä¾›Sliceç›¸åŠ çš„åŠŸèƒ½, åªèƒ½é€šè¿‡appendå‡½æ•°æ¥å®ç°, append(s[:3], s[4:]), é—®é¢˜åˆæ¥äº†, appendçš„æºç ä¸­è¦æ±‚ç¬¬äºŒå‚æ•°å¿…é¡»æ˜¯å¯å˜å‚æ•°, ä¹Ÿå°±æ˜¯ä¸€ä¸ªå€¼ä¸€ä¸ªå€¼çš„å†™åœ¨åé¢ <code>func append(slice []Type, elems ...Type) []Type</code></p>
<p>Goè¯­è¨€ä¸­æä¾›äº†ç›¸å…³çš„è¯­æ³•, æ¥è§£å†³s[4:]å˜æˆå¯å˜å‚æ•°çš„é—®é¢˜</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	s := []<span class="keyword">int</span>&#123;<span class="number">12</span>, <span class="number">34</span>, <span class="number">56</span>, <span class="number">78</span>, <span class="number">90</span>, <span class="number">89</span>, <span class="number">72</span>&#125;</span><br><span class="line">	fmt.Println(s)</span><br><span class="line"></span><br><span class="line">	ss := <span class="built_in">append</span>(s[:<span class="number">3</span>], s[<span class="number">4</span>:]...)</span><br><span class="line">	fmt.Println(ss)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœ: </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[12 34 56 78 90 89 72]</span><br><span class="line">[12 34 56 90 89 72]</span><br></pre></td></tr></table></figure>

<h3 id="åˆ é™¤å¤´å°¾"><a href="#åˆ é™¤å¤´å°¾" class="headerlink" title="åˆ é™¤å¤´å°¾"></a>åˆ é™¤å¤´å°¾</h3><p>åˆ å¤´</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	s := []<span class="keyword">int</span>&#123;<span class="number">12</span>, <span class="number">34</span>, <span class="number">56</span>, <span class="number">78</span>, <span class="number">90</span>, <span class="number">89</span>, <span class="number">72</span>&#125;</span><br><span class="line">	fmt.Println(s)</span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="string">"Poping from front"</span>)</span><br><span class="line">	front := s[<span class="number">0</span>]</span><br><span class="line">	ss := s[<span class="number">1</span>:]</span><br><span class="line">	fmt.Println(<span class="string">"å–å‡ºçš„å¤´éƒ¨å…ƒç´ ä¸º"</span>, front)</span><br><span class="line">	fmt.Println(<span class="string">"å–å‡ºå¤´éƒ¨å…ƒç´ åçš„Sliceä¸º"</span>, ss)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[12 34 56 78 90 89 72]</span><br><span class="line">Poping from front</span><br><span class="line">å–å‡ºçš„å¤´éƒ¨å…ƒç´ ä¸º 12</span><br><span class="line">å–å‡ºå¤´éƒ¨å…ƒç´ åçš„Sliceä¸º [34 56 78 90 89 72]</span><br></pre></td></tr></table></figure>

<p>åˆ å°¾</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	s := []<span class="keyword">int</span>&#123;<span class="number">12</span>, <span class="number">34</span>, <span class="number">56</span>, <span class="number">78</span>, <span class="number">90</span>, <span class="number">89</span>, <span class="number">72</span>&#125;</span><br><span class="line">	fmt.Println(s)</span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="string">"Poping from front"</span>)</span><br><span class="line">	tail := s[<span class="built_in">len</span>(s)<span class="number">-1</span>]</span><br><span class="line">	ss := s[:<span class="built_in">len</span>(s)<span class="number">-1</span>]</span><br><span class="line">	fmt.Println(<span class="string">"å–å‡ºçš„å°¾éƒ¨å…ƒç´ ä¸º"</span>, tail)</span><br><span class="line">	fmt.Println(<span class="string">"å–å‡ºå°¾éƒ¨å…ƒç´ åçš„Sliceä¸º"</span>, ss)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[12 34 56 78 90 89 72]</span><br><span class="line">Poping from front</span><br><span class="line">å–å‡ºçš„å°¾éƒ¨å…ƒç´ ä¸º 72</span><br><span class="line">å–å‡ºå°¾éƒ¨å…ƒç´ åçš„Sliceä¸º [12 34 56 78 90 89]</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Go</category>
      </categories>
      <tags>
        <tag>Go</tag>
        <tag>Slice</tag>
        <tag>åˆ‡ç‰‡</tag>
      </tags>
  </entry>
  <entry>
    <title>GoåŸºç¡€ä¹‹åˆ‡ç‰‡Sliceçš„æ¦‚å¿µ</title>
    <url>/2018/08/07/Go%E5%9F%BA%E7%A1%80%E4%B9%8B%E5%88%87%E7%89%87Slice%E7%9A%84%E6%A6%82%E5%BF%B5/</url>
    <content><![CDATA[<h2 id="Sliceçš„åŸºæœ¬ä½¿ç”¨"><a href="#Sliceçš„åŸºæœ¬ä½¿ç”¨" class="headerlink" title="Sliceçš„åŸºæœ¬ä½¿ç”¨"></a>Sliceçš„åŸºæœ¬ä½¿ç”¨</h2><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	arr := [...]<span class="keyword">string</span>&#123;<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>, <span class="string">"d"</span>, <span class="string">"e"</span>, <span class="string">"f"</span>, <span class="string">"g"</span>, <span class="string">"h"</span>&#125;</span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="string">"arr[2:6]"</span>, arr[<span class="number">2</span>:<span class="number">6</span>])</span><br><span class="line">	fmt.Println(<span class="string">"arr[:6]"</span>, arr[:<span class="number">6</span>])</span><br><span class="line">	fmt.Println(<span class="string">"arr[2:]"</span>, arr[<span class="number">2</span>:])</span><br><span class="line">	fmt.Println(<span class="string">"arr[:]"</span>, arr[:])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">arr[2:6] [c d e f]</span><br><span class="line">arr[:6] [a b c d e f]</span><br><span class="line">arr[2:] [c d e f g h]</span><br><span class="line">arr[:] [a b c d e f g h]</span><br></pre></td></tr></table></figure>

<p><strong>æ³¨æ„: å·¦å¼€å³é—­åŒºé—´; Sliceæ˜¯å¯¹æ•°ç»„çš„View(è§†å›¾)</strong></p>
<h2 id="Sliceæ˜¯å¼•ç”¨ç±»å‹"><a href="#Sliceæ˜¯å¼•ç”¨ç±»å‹" class="headerlink" title="Sliceæ˜¯å¼•ç”¨ç±»å‹"></a>Sliceæ˜¯å¼•ç”¨ç±»å‹</h2><p>ç”±äºSliceæ˜¯å¯¹åº•å±‚æ•°ç»„çš„è§†å›¾, å½“Sliceä¸­çš„å…ƒç´ è¢«ä¿®æ”¹å, åŒæ ·çš„, åº•å±‚æ•°ç»„ä¸­çš„å…ƒç´ ä¹Ÿå°†è¢«ä¿®æ”¹</p>
<p>çœ‹ä»¥ä¸‹demo</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	arr := [...]<span class="keyword">string</span>&#123;<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>, <span class="string">"d"</span>, <span class="string">"e"</span>, <span class="string">"f"</span>, <span class="string">"g"</span>, <span class="string">"h"</span>&#125;</span><br><span class="line"></span><br><span class="line">	s := arr[<span class="number">2</span>:<span class="number">6</span>]</span><br><span class="line">	fmt.Println(<span class="string">"åŸå§‹så˜é‡çš„å€¼"</span>, s)</span><br><span class="line">	fmt.Println(<span class="string">"åŸå§‹æ•°ç»„çš„å€¼"</span>, arr)</span><br><span class="line">	s[<span class="number">0</span>] = <span class="string">"xx"</span>  <span class="comment">// æ”¹å˜è§†å›¾ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">	fmt.Println(<span class="string">"ä¿®æ”¹åå˜é‡çš„å€¼"</span>, s)</span><br><span class="line">	fmt.Println(<span class="string">"ä¿®æ”¹åæ•°ç»„çš„å€¼"</span>, arr)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">åŸå§‹så˜é‡çš„å€¼ [c d e f]</span><br><span class="line">åŸå§‹æ•°ç»„çš„å€¼ [a b c d e f g h]</span><br><span class="line">ä¿®æ”¹åå˜é‡çš„å€¼ [xx d e f]</span><br><span class="line">ä¿®æ”¹åæ•°ç»„çš„å€¼ [a b xx d e f g h]</span><br></pre></td></tr></table></figure>

<h2 id="Slice-amp-Array"><a href="#Slice-amp-Array" class="headerlink" title="Slice &amp; Array"></a>Slice &amp; Array</h2><p>åˆ‡ç‰‡å’Œæ•°ç»„çš„å†™æ³•å¾ˆç›¸ä¼¼, è¿™é‡ŒæŠŠä»–ä»¬æ”¾åˆ°ä¸€èµ·åŒºåˆ†ä»¥ä¸‹</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">funcName</span><span class="params">(arr [5]<span class="keyword">int</span>)</span> // æ¥æ”¶ä¸€ä¸ªé•¿åº¦ä¸º5çš„<span class="title">int</span>ç±»å‹çš„æ•°ç»„<span class="params">(å€¼ä¼ é€’)</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">funcName</span><span class="params">(arr *[5]<span class="keyword">int</span>)</span>  // æ¥æ”¶ä¸€ä¸ªé•¿åº¦5çš„<span class="title">int</span>ç±»å‹çš„æ•°ç»„çš„æŒ‡é’ˆ<span class="params">(å¼•ç”¨ä¼ é€’)</span></span></span><br><span class="line"><span class="comment">// &amp;arr ç”¨&amp;ä¼ é€’å‚æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">funcName</span><span class="params">(sli []<span class="keyword">int</span>)</span>  // æ¥æ”¶ä¸€ä¸ª<span class="title">Slice</span>åˆ‡ç‰‡<span class="params">(å¼•ç”¨ä¼ é€’)</span></span></span><br><span class="line"><span class="comment">// arr[:] ç”¨[:]åˆ‡ç‰‡è¯­æ³•ä¼ é€’å‚æ•°</span></span><br></pre></td></tr></table></figure>

<h2 id="Reslice"><a href="#Reslice" class="headerlink" title="Reslice"></a>Reslice</h2><p>Sliceå¯ä»¥åœ¨Sliceçš„åŸºç¡€ä¸Šå†æ¬¡Slice, åˆ›å»ºSliceçš„è§†å›¾</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	arr := [...]<span class="keyword">string</span>&#123;<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>, <span class="string">"d"</span>, <span class="string">"e"</span>, <span class="string">"f"</span>, <span class="string">"g"</span>, <span class="string">"h"</span>&#125;</span><br><span class="line"></span><br><span class="line">	s := arr[<span class="number">2</span>:<span class="number">6</span>]</span><br><span class="line">	fmt.Println(<span class="string">"æ•°ç»„arrçš„å€¼"</span>, arr)</span><br><span class="line">	fmt.Println(<span class="string">"såˆ‡ç‰‡çš„å€¼"</span>, s)</span><br><span class="line"></span><br><span class="line">	s2 := s[:<span class="number">3</span>]</span><br><span class="line">	s3 := s[<span class="number">2</span>:]</span><br><span class="line">	fmt.Println(<span class="string">"s2, åŸºäºsåˆ‡ç‰‡çš„view"</span>, s2)</span><br><span class="line">	fmt.Println(<span class="string">"s3, åŸºäºsåˆ‡ç‰‡çš„view"</span>, s3)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æ•°ç»„arrçš„å€¼ [a b c d e f g h]</span><br><span class="line">såˆ‡ç‰‡çš„å€¼ [c d e f]</span><br><span class="line">s2, åŸºäºsåˆ‡ç‰‡çš„view [c d e]</span><br><span class="line">s3, åŸºäºsåˆ‡ç‰‡çš„view [e f]</span><br></pre></td></tr></table></figure>

<p><strong>ä¸Šé¢çš„Demoä¸­, å³ä½¿æœ‰å¤šä¸ªSlice, ä½†å…¶æœ¬è´¨, è¿˜æ˜¯viewäº†åŒä¸€ä¸ªArray</strong></p>
<h2 id="Sliceçš„æ‰©å±•"><a href="#Sliceçš„æ‰©å±•" class="headerlink" title="Sliceçš„æ‰©å±•"></a>Sliceçš„æ‰©å±•</h2><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	arr := [...]<span class="keyword">string</span>&#123;<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>, <span class="string">"d"</span>, <span class="string">"e"</span>, <span class="string">"f"</span>, <span class="string">"g"</span>, <span class="string">"h"</span>&#125;</span><br><span class="line"></span><br><span class="line">	s := arr[<span class="number">2</span>:<span class="number">6</span>]</span><br><span class="line">	fmt.Println(<span class="string">"æ•°ç»„arrçš„å€¼"</span>, arr)</span><br><span class="line">	fmt.Println(<span class="string">"såˆ‡ç‰‡æ˜¯å¯¹arrçš„view, å€¼ä¸º"</span>, s)</span><br><span class="line"></span><br><span class="line">	ss := s[<span class="number">3</span>:<span class="number">5</span>]</span><br><span class="line">	fmt.Println(<span class="string">"ssåˆ‡ç‰‡æ˜¯å¯¹såˆ‡ç‰‡çš„view, å€¼ä¸º"</span>, ss)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æ•°ç»„arrçš„å€¼ [a b c d e f g h]</span><br><span class="line">såˆ‡ç‰‡æ˜¯å¯¹arrçš„view, å€¼ä¸º [c d e f]</span><br><span class="line">ssåˆ‡ç‰‡æ˜¯å¯¹såˆ‡ç‰‡çš„view, å€¼ä¸º [f g]</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„Demoä¸­, å‡ºç°äº†ä¸€ä¸ªå¾ˆæœ‰æ„æ€çš„é—®é¢˜, å°±æ˜¯ssåˆ‡ç‰‡, æ ¹æ®ä¸Šé¢ä»‹ç»çš„ç†è®º, ssåˆ‡ç‰‡æ˜¯å¯¹såˆ‡ç‰‡çš„view, ä¹Ÿå°±æ˜¯Reslice, ä½†æ˜¯såˆ‡ç‰‡ä¸­åªæœ‰4ä¸ªå€¼, å…ƒç´ ç´¢å¼•ä¸º<code>0-3</code>, è€Œsså¯¹å…¶è¿›è¡Œresliceå, å´è¦çœ‹<code>3-5</code>çš„ç´¢å¼•, å¦‚æœæ˜¯æ™®é€šArrayçš„è¯, è‚¯å®šä¼šæŠ¥ç´¢å¼•è¶Šç•Œçš„å¼‚å¸¸, ä½†æ˜¯ä¸Šé¢Demoæˆ‘ä»¬çœ‹å‡º, ä»£ç å¹¶æ²¡æœ‰æŠ›å‡ºä»»ä½•å¼‚å¸¸, ä¸ä»…è¿˜å–åˆ°äº†å€¼, è¿˜å–åˆ°äº†såˆ‡ç‰‡ä¸­ä¸å­˜åœ¨çš„å€¼</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;, &quot;e&quot;, &quot;f&quot;, &quot;g&quot;, &quot;h&quot;  &lt;&#x3D;&#x3D; Array</span><br><span class="line"> 0    1    2    3    4    5    6    7   &lt;&#x3D;&#x3D; Array Index</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">          &quot;c&quot;, &quot;d&quot;, &quot;e&quot;, &quot;f&quot;            &lt;&#x3D;&#x3D; Slice arr[2:6]</span><br><span class="line">           0    1    2    3    4    5   &lt;&#x3D;&#x3D; Sline Index</span><br><span class="line">           </span><br><span class="line">                         &quot;f&quot;, &quot;g&quot;       &lt;&#x3D;&#x3D; Reslice sli[3:5]</span><br><span class="line">                          0    1    2   &lt;&#x3D;&#x3D; Reslice Index</span><br></pre></td></tr></table></figure>

<p><strong>Goè¯­è¨€Sliceçš„æ‰©å±•ç‰¹æ€§: åœ¨Sliceå, Arrayåé¢çš„å…ƒç´ ä¾ç„¶å¯ä»¥è¢«Sliceæ„ŸçŸ¥, ä½†æ˜¯Sliceåé¢è¿™äº›å…ƒç´ ä¸èƒ½ç›´æ¥è¢«å–å‡º, ç›´æ¥å–å€¼ä¼šæŠ¥ç´¢å¼•è¶Šç•Œçš„é”™è¯¯. ä½†æ˜¯å½“Sliceè¢«Resliceæ—¶, Sliceåé¢éšè—çš„å€¼æ˜¯å¯ä»¥åœ¨Resliceä¸­é‡è§å¤©æ—¥çš„</strong></p>
<h2 id="Sliceçš„å®ç°"><a href="#Sliceçš„å®ç°" class="headerlink" title="Sliceçš„å®ç°"></a>Sliceçš„å®ç°</h2><p>å‡è®¾: <code>- - - -</code>ä¸ºSliceå¯¹Arrayçš„è§†å›¾</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Array:  &#96;+ + + + - - - - ~ ~ ~ ~&#96;</span><br><span class="line">                 â†‘     |       |</span><br><span class="line">                ptr    |       |</span><br><span class="line">                 |-len-|       |</span><br><span class="line">                 |-----cap-----|</span><br></pre></td></tr></table></figure>


<p>Sliceå†…éƒ¨æœ‰ä¸‰ä¸ªå…ƒç´ : </p>
<ul>
<li>ptr: æŒ‡å‘äº†Sliceå¼€å¤´çš„å…ƒç´ . ä¾æ®ä¸Šå›¾, ä¹Ÿå°±æ˜¯æŒ‡å‘äº†ç¬¬ä¸€ä¸ª<code>-</code></li>
<li>len: ä¿å­˜äº†Sliceçš„é•¿åº¦, ä½¿ç”¨ sli[x] è¿™ç§æ–¹å¼å–å€¼, åªèƒ½å–åˆ°sli[len-1]. ä¾æ®ä¸Šå›¾, lenä¿å­˜äº†<code>-</code>çš„é•¿åº¦, 4</li>
<li>cap: capä¿å­˜äº†ä»ptrå¼€å§‹åˆ°Arrayæ•°ç»„ç»“æŸçš„é•¿åº¦. ä¾æ®ä¸Šå›¾, ä¹Ÿå°±æ˜¯è¯´capä¿å­˜äº†ä»ç¬¬ä¸€ä¸ª<code>-</code>å¼€å§‹, åˆ°æœ€åä¸€ä¸ª<code>~</code>ä¸ºæ­¢çš„é•¿åº¦, 8</li>
</ul>
<p>æ‰€ä»¥GoçŸ¥é“, Sliceåœ¨æ‰©å±•çš„æ—¶å€™, åªè¦ä¸è¶…è¿‡capçš„é•¿åº¦, å°±æ˜¯å¯ä»¥å–åˆ°çš„</p>
<p><strong>æ³¨æ„: Sliceå¯ä»¥å‘åæ‰©å±•, ä½†æ˜¯ä¸èƒ½å‘å‰æ‰©å±•, å›¾ç¤ºä¸­<code>+</code>éƒ¨åˆ†çš„å€¼åœ¨Sliceä¸­æ°¸è¿œä¸ä¼šè¢«å–å‡ºæ¥, é™¤éé‡æ–°ä½¿ç”¨Sliceå¯¹Arrayè¿›è¡Œviewæ“ä½œ`</strong></p>
<p><strong>sli[x]å–å€¼ä¸å¯ä»¥è¶…è¶Šlen(sli); å‘åæ‰©å±•, ä¸å¯ä»¥è¶…è¶Šåº•å±‚Array cap(sli)</strong></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	arr := [...]<span class="keyword">string</span>&#123;<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>, <span class="string">"d"</span>, <span class="string">"e"</span>, <span class="string">"f"</span>, <span class="string">"g"</span>, <span class="string">"h"</span>&#125;</span><br><span class="line">	fmt.Println(<span class="string">"Arrayæ•°ç»„çš„capé•¿åº¦ä¸º: "</span>, <span class="built_in">cap</span>(arr))  <span class="comment">// ç»“æœä¸º: 8</span></span><br><span class="line"></span><br><span class="line">	s := arr[<span class="number">2</span>:<span class="number">6</span>]</span><br><span class="line">	fmt.Println(<span class="string">"æ•°ç»„arrçš„å€¼"</span>, arr)</span><br><span class="line">	fmt.Println(<span class="string">"såˆ‡ç‰‡æ˜¯å¯¹arrçš„view, å€¼ä¸º"</span>, s)</span><br><span class="line">	fmt.Println(<span class="string">"såˆ‡ç‰‡çš„lené•¿åº¦å’Œcapé•¿åº¦åˆ†åˆ«ä¸º: "</span>, <span class="built_in">len</span>(s), <span class="built_in">cap</span>(s))</span><br><span class="line"></span><br><span class="line">	ss := s[<span class="number">3</span>:<span class="number">5</span>]</span><br><span class="line">	fmt.Println(<span class="string">"ssåˆ‡ç‰‡æ˜¯å¯¹såˆ‡ç‰‡çš„view, å€¼ä¸º"</span>, ss)</span><br><span class="line">	fmt.Println(<span class="string">"ssåˆ‡ç‰‡çš„lené•¿åº¦å’Œcapé•¿åº¦åˆ†åˆ«ä¸º: "</span>, <span class="built_in">len</span>(ss), <span class="built_in">cap</span>(ss))</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Arrayæ•°ç»„çš„capé•¿åº¦ä¸º:  8</span><br><span class="line">æ•°ç»„arrçš„å€¼ [a b c d e f g h]</span><br><span class="line">såˆ‡ç‰‡æ˜¯å¯¹arrçš„view, å€¼ä¸º [c d e f]</span><br><span class="line">såˆ‡ç‰‡çš„lené•¿åº¦å’Œcapé•¿åº¦åˆ†åˆ«ä¸º:  4 6</span><br><span class="line">ssåˆ‡ç‰‡æ˜¯å¯¹såˆ‡ç‰‡çš„view, å€¼ä¸º [f g]</span><br><span class="line">ssåˆ‡ç‰‡çš„lené•¿åº¦å’Œcapé•¿åº¦åˆ†åˆ«ä¸º:  2 3</span><br></pre></td></tr></table></figure>


]]></content>
      <categories>
        <category>Go</category>
      </categories>
      <tags>
        <tag>Go</tag>
        <tag>Slice</tag>
        <tag>åˆ‡ç‰‡</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonä¹‹ä¸€ä¸ªå‚æ•°å¼•å‘çš„è¡€æ¡ˆ</title>
    <url>/2018/08/02/Python%E4%B9%8B%E4%B8%80%E4%B8%AA%E5%8F%82%E6%95%B0%E5%BC%95%E5%8F%91%E7%9A%84%E8%A1%80%E6%A1%88/</url>
    <content><![CDATA[<h2 id="å‚æ•°ä¸ºå¯å˜å¯¹è±¡å¼•å‘çš„é—®é¢˜"><a href="#å‚æ•°ä¸ºå¯å˜å¯¹è±¡å¼•å‘çš„é—®é¢˜" class="headerlink" title="å‚æ•°ä¸ºå¯å˜å¯¹è±¡å¼•å‘çš„é—®é¢˜"></a>å‚æ•°ä¸ºå¯å˜å¯¹è±¡å¼•å‘çš„é—®é¢˜</h2><p>å…ˆæ¥çœ‹ä¸€ä¸ªç»“æœç¬¦åˆç»å¤§å¤šæ•°äººé¢„æœŸçš„ä¾‹å­ğŸŒ°</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Company</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name: str, staffs: list=[])</span>:</span></span><br><span class="line">        self.name: str = name</span><br><span class="line">        self.staffs: list = staffs</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(self, staff_name: str)</span>:</span></span><br><span class="line">        self.staffs.append(staff_name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    co = Company(<span class="string">"xx"</span>, [<span class="string">"A"</span>, <span class="string">"B"</span>])</span><br><span class="line">    co.add(<span class="string">"C"</span>)</span><br><span class="line">    print(co.staffs)</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[&#39;A&#39;, &#39;B&#39;, &#39;C&#39;]</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªç»“æœæƒ³å¿…å¤§å®¶éƒ½èƒ½çŒœå¾—åˆ°, æ¥ä¸‹æ¥çœ‹ä¸‹é¢çš„ä¾‹å­</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Company</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name: str, staffs: list=[])</span>:</span></span><br><span class="line">        self.name: str = name</span><br><span class="line">        self.staffs: list = staffs</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(self, staff_name: str)</span>:</span></span><br><span class="line">        self.staffs.append(staff_name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    co1 = Company(<span class="string">"yy"</span>)</span><br><span class="line">    co1.add(<span class="string">"D"</span>)</span><br><span class="line">    print(<span class="string">"co1's staffs: &#123;0&#125;"</span>.format(co1.staffs))</span><br><span class="line"></span><br><span class="line">    co2 = Company(<span class="string">"oo"</span>)</span><br><span class="line">    co2.add(<span class="string">"E"</span>)</span><br><span class="line">    print(<span class="string">"co1's staffs: &#123;0&#125;"</span>.format(co1.staffs))</span><br><span class="line">    print(<span class="string">"co2's staffs: &#123;0&#125;"</span>.format(co2.staffs))</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">co1&#39;s staffs: [&#39;D&#39;]</span><br><span class="line">co1&#39;s staffs: [&#39;D&#39;, &#39;E&#39;]</span><br><span class="line">co2&#39;s staffs: [&#39;D&#39;, &#39;E&#39;]</span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸€è¡Œçš„ç»“æœ, åº”è¯¥æ˜¯ç¬¦åˆå¤§å®¶çš„é¢„æœŸçš„, ä½†æ˜¯ç¬¬äºŒè¡Œç¬¬ä¸‰è¡Œçš„ç»“æœå¯ä»¥çœ‹å‡º, è™½ç„¶æ˜¯ä¸¤ä¸ªå®Œå…¨ä¸åŒçš„å¯¹è±¡, ä½†æ˜¯äº’ç›¸å—åˆ°äº†å½±å“! å¯¹<code>co2</code>æ·»åŠ å‘˜å·¥çš„æ“ä½œå½±å“äº†<code>co1</code>ä¸­çš„æˆå‘˜, è€Œæœ€å¼€å§‹<code>co1</code>ä¸­æ·»åŠ æˆå‘˜çš„æ“ä½œä¹Ÿé»˜è®¤å½±å“åˆ°äº†<code>co2</code>çš„å‘˜å·¥åˆ—è¡¨</p>
<p>è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢?</p>
<p>å¦‚æœä½ ç”¨çš„<code>PyCharm IDE</code>åœ¨ä½ å®šä¹‰å‡½æ•°/æ–¹æ³•å‚æ•°çš„æ—¶å€™, å¦‚æœå®šä¹‰çš„é»˜è®¤å‚æ•°ä¸ºåˆ—è¡¨, é‚£ä¹ˆIDEä¼šæç¤ºä½ : <code>Default argument value is mutable</code>, ä¸æ¨èåœ¨å‡½æ•°çš„å‚æ•°ä¸­ç›´æ¥æ¥æ”¶åˆ—è¡¨ç±»å‹çš„æ•°æ®(ä¸æ¨èä½¿ç”¨å¯å˜å¯¹è±¡).</p>
<p>é‚£ä¹ˆæŠ›å¼€å»ºè®®, ä¸ºä»€ä¹ˆä¼šå‡ºç°ä¸Šé¢ä¸¤ä¸ªå¯¹è±¡ä¹‹é—´çš„å€¼äº’ç›¸å½±å“çš„æƒ…å†µå‘¢?</p>
<p>æ˜¯å› ä¸º<code>co1</code>å’Œ<code>co2</code>ä¸¤ä¸ªå¯¹è±¡åœ¨åˆ›å»ºçš„æ—¶å€™, éƒ½æ²¡æœ‰æ˜ç¡®æŒ‡å®š<code>staffs</code>åˆ—è¡¨, è€Œæ˜¯éƒ½ä½¿ç”¨äº†é»˜è®¤çš„ç©ºåˆ—è¡¨, åœ¨è¿™ç§æƒ…å†µä¸‹ä»–ä»¬å®é™…å°±å…±ç”¨äº†ä¸€ä¸ªå¯¹è±¡, è€Œæ°å·§è¯¥å¯¹è±¡åˆæ˜¯å¯å˜å¯¹è±¡, æ‰€ä»¥åˆ›å»ºå¯¹è±¡å, ä»»æ„ä¸€ä¸ªå¯¹è±¡å¯¹è¯¥å¯å˜å¯¹è±¡çš„æ“ä½œéƒ½ä¼šå½±å“åˆ°å¦ä¸€ä¸ªå¯¹è±¡, åœ¨Pythonä»£ç ä¸­, å¯ä»¥ä½¿ç”¨<code>is</code>è¯­å¥æ¥éªŒè¯ä¸¤ä¸ªå¯¹è±¡çš„ä¸¤ä¸ªå­—æ®µæ˜¯å¦éƒ½å¼•ç”¨äº†åŒä¸€ä¸ªå¯¹è±¡</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(co1.staffs <span class="keyword">is</span> co2.staffs)</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">True</span><br></pre></td></tr></table></figure>

<p>éªŒè¯ç»“æœä¹Ÿæ˜ç¡®æ˜¾ç¤ºäº†, ä¸¤ä¸ªå¯¹è±¡çš„ä¸¤ä¸ªå­—æ®µ, å…¶å®æ˜¯å¼•ç”¨äº†åŒä¸€ä¸ªå¯¹è±¡, åŒä¸€å—å†…å­˜, æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ç‰¹å®šå‡½æ•°æŸ¥çœ‹ç±»ä¸­æ„é€ æ–¹æ³•é»˜è®¤å€¼çš„ä½¿ç”¨æƒ…å†µ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Company</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name: str, staffs: list=[])</span>:</span></span><br><span class="line">        self.name: str = name</span><br><span class="line">        self.staffs: list = staffs</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(self, staff_name: str)</span>:</span></span><br><span class="line">        self.staffs.append(staff_name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    print(Company.__init__.__defaults__)  <span class="comment"># ([],)</span></span><br><span class="line">    co1 = Company(<span class="string">"yy"</span>)</span><br><span class="line">    co1.add(<span class="string">"D"</span>)</span><br><span class="line">    print(<span class="string">"co1's staffs: &#123;0&#125;"</span>.format(co1.staffs))  <span class="comment"># co1's staffs: ['D']</span></span><br><span class="line">    print(Company.__init__.__defaults__)  <span class="comment"># (['D'],)</span></span><br><span class="line">    co2 = Company(<span class="string">"oo"</span>)</span><br><span class="line">    co2.add(<span class="string">"E"</span>)</span><br><span class="line">    print(<span class="string">"co1's staffs: &#123;0&#125;"</span>.format(co1.staffs))  <span class="comment"># co1's staffs: ['D', 'E']</span></span><br><span class="line">    print(<span class="string">"co2's staffs: &#123;0&#125;"</span>.format(co2.staffs))  <span class="comment"># co2's staffs: ['D', 'E']</span></span><br><span class="line">    print(Company.__init__.__defaults__)  <span class="comment"># (['D', 'E'],)</span></span><br><span class="line">    print(co1.staffs <span class="keyword">is</span> co2.staffs)  <span class="comment"># True</span></span><br></pre></td></tr></table></figure>

<p>å½“å‡½æ•°çš„å‚æ•°æ²¡æœ‰æŒ‡å®šå€¼çš„æ—¶å€™, å°±ä¼šæŒ‡å‘<code>Company.__init__.__defaults__</code>è¿™é‡Œçš„é»˜è®¤å€¼</p>
<h2 id="å¦‚æœè§£å†³è¿™ç±»é—®é¢˜"><a href="#å¦‚æœè§£å†³è¿™ç±»é—®é¢˜" class="headerlink" title="å¦‚æœè§£å†³è¿™ç±»é—®é¢˜"></a>å¦‚æœè§£å†³è¿™ç±»é—®é¢˜</h2><ul>
<li>ç¬¬ä¸€: æœ€ç›´æ¥çš„è§£å†³ä¹‹é“å°±æ˜¯ä¸è¦ä½¿ç”¨åˆ—è¡¨å’Œå­—å…¸è¿™ç§å¯å˜å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’</li>
<li>ç¬¬äºŒ: å¯ä»¥ä½¿ç”¨å…ƒç»„ä¼ é€’</li>
<li>ç¬¬ä¸‰: å‚æ•°çš„é»˜è®¤å€¼ä¸è¦ä½¿ç”¨åˆ—è¡¨æˆ–å­—å…¸, è®©è°ƒç”¨è€…æ¯æ¬¡éƒ½æ˜¾å¼ä¼ é€’å‚æ•°</li>
<li>ç¬¬å››: ä½¿ç”¨ def func(<em>args, *</em>kwargs) çš„æ–¹å¼ä¼ é€’</li>
</ul>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>å‚æ•°</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonä¸­åƒåœ¾å›æ”¶å’Œdelè¯­å¥</title>
    <url>/2018/08/01/Python%E4%B8%AD%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%92%8Cdel%E8%AF%AD%E5%8F%A5/</url>
    <content><![CDATA[<blockquote>
<p>Pythonä¸­çš„åƒåœ¾å›æ”¶ç®—æ³•æ˜¯é‡‡ç”¨<code>å¼•ç”¨è®¡æ•°</code>, å½“ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨è®¡æ•°ä¸º0æ—¶, Pythonçš„åƒåœ¾å›æ”¶æœºåˆ¶å°±ä¼šå°†å¯¹è±¡å›æ”¶</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a = <span class="string">"larry"</span></span><br><span class="line">b = a</span><br></pre></td></tr></table></figure>

<p><code>larry</code>è¿™ä¸ªå­—ç¬¦ä¸²å¯¹è±¡, åœ¨ç¬¬ä¸€è¡Œè¢«è´´äº†<code>a</code>æ ‡ç­¾å, å¼•ç”¨è®¡æ•°ä¸º1, ä¹‹ååœ¨ç¬¬äºŒè¡Œ, ç”±è´´ä¸Šäº†<code>b</code>æ ‡ç­¾, æ­¤æ—¶, è¯¥å­—ç¬¦ä¸²å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ä¸º2</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a = <span class="string">"larry"</span></span><br><span class="line">b = a</span><br><span class="line"><span class="keyword">del</span> a</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„: åœ¨Pythonè¯­è¨€ä¸­, <code>del</code>è¯­å¥æ“ä½œæŸä¸ªå¯¹è±¡çš„æ—¶å€™, å¹¶ä¸æ˜¯ç›´æ¥å°†è¯¥å¯¹è±¡åœ¨å†…å­˜ä¸­åˆ é™¤, è€Œæ˜¯å°†è¯¥å¯¹è±¡çš„å¼•ç”¨è®¡æ•°<code>-1</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = <span class="string">"larry"</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = a</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">del</span> a</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>id(b)</span><br><span class="line"><span class="number">4572141808</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>id(a)</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;input&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    id(a)</span><br><span class="line">NameError: name <span class="string">'a'</span> <span class="keyword">is</span> <span class="keyword">not</span> defined</span><br></pre></td></tr></table></figure>

<p>ä»ä»¥ä¸Šç¤ºä¾‹ä¸­å¯ä»¥çœ‹å‡º, <code>larry</code>è¿™ä¸ªå­—ç¬¦ä¸²å¯¹è±¡åœ¨ç¬¬ä¸€è¡Œè¢«è´´ä¸Šäº†<code>a</code>æ ‡ç­¾, æ­¤æ—¶å­—ç¬¦ä¸²å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ä¸º1, æ¥ç€ç¬¬äºŒè¡Œåˆè¢«è´´ä¸Šäº†<code>b</code>æ ‡ç­¾, æ­¤æ—¶è¯¥å­—ç¬¦ä¸²å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ä¸º2, åœ¨ç¬¬ä¸‰è¡Œä¸­, delè¯­è¨€åˆ é™¤äº†aå˜é‡(æ ‡ç­¾), åœ¨åç»­çš„printä¸­å¯ä»¥çœ‹å‡º, å†…å­˜ä¸­å®é™…çš„å­—ç¬¦ä¸²å¯¹è±¡å¹¶æ²¡æœ‰è¢«åˆ é™¤, delè¯­è¨€åªæ˜¯åˆ é™¤äº†ä¸€ä¸ªå˜é‡å¯¹è¯¥å­—ç¬¦ä¸²å¯¹è±¡çš„å¼•ç”¨, æ‰€ä»¥å¯¹äº<code>larry</code>è¿™ä¸ªå­—ç¬¦ä¸²å¯¹è±¡æ¥è¯´, æ•ˆæœåªæ˜¯å¼•ç”¨è®¡æ•°<code>-1</code></p>
<h2 id="é­”æ³•å‡½æ•°ä¹‹-del"><a href="#é­”æ³•å‡½æ•°ä¹‹-del" class="headerlink" title="é­”æ³•å‡½æ•°ä¹‹__del__"></a>é­”æ³•å‡½æ•°ä¹‹<code>__del__</code></h2><p>ç±»ä¸­çš„<code>__del__</code>é­”æ³•å‡½æ•°, æ”¯æŒæˆ‘ä»¬è‡ªå®šä¹‰æ¸…ç†å¯¹è±¡çš„é€»è¾‘, å½“Pythonè§£é‡Šå™¨ä½¿ç”¨delè¯­è¨€åˆ é™¤ç±»çš„å¯¹è±¡çš„æ—¶å€™, ä¼šè‡ªåŠ¨è°ƒç”¨ç±»ä¸­çš„<code>__del__</code>å‡½æ•°, æˆ‘ä»¬å¯ä»¥å¯¹å…¶è¿›è¡Œé‡è½½</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Ref</span>:</span></span><br><span class="line">...</span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line"><span class="meta">... </span>        self.name = name</span><br><span class="line">...</span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__del__</span><span class="params">(self)</span>:</span></span><br><span class="line"><span class="meta">... </span>        print(<span class="string">"åˆ é™¤å¯¹è±¡"</span>)</span><br><span class="line"><span class="meta">... </span>        <span class="keyword">del</span> self.name</span><br><span class="line">...</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r = Ref(name=<span class="string">"larry"</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(r.name)</span><br><span class="line">larry</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">del</span> r</span><br><span class="line">åˆ é™¤å¯¹è±¡</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(r.name)</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;input&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    print(r.name)</span><br><span class="line">NameError: name <span class="string">'r'</span> <span class="keyword">is</span> <span class="keyword">not</span> defined</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡é‡è½½<code>__del__</code>é­”æ³•å‡½æ•°, è‡ªå·±çµæ´»æ§åˆ¶åœ¨<code>del å¯¹è±¡</code>çš„æ—¶å€™æ‰§è¡Œå“ªäº›å–„åæ“ä½œ</p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>del</tag>
        <tag>åƒåœ¾å›æ”¶</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonä¸­çš„==å’Œisçš„åŒºåˆ«</title>
    <url>/2018/08/01/Python%E4%B8%AD%E7%9A%84-%E5%92%8Cis%E7%9A%84%E5%8C%BA%E5%88%AB/</url>
    <content><![CDATA[<h2 id="Pythonä¸­is"><a href="#Pythonä¸­is" class="headerlink" title="Pythonä¸­is"></a>Pythonä¸­is</h2><p>Pythonä¸­çš„isç”¨æ¥åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯åŒä¸€ä¸ªå¯¹è±¡, ç®€å•æ¥è¯´, å°±æ˜¯ä½ é€šè¿‡ä½¿ç”¨Pythonä¸­çš„<code>id()</code>å‡½æ•°å»è·å–ä¸¤ä¸ªå¯¹è±¡çš„å†…å­˜åœ°å€, å¦‚æœåœ°å€ç›¸åŒ, å³ä¸ºåŒä¸€ä¸ªå¯¹è±¡</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = <span class="string">"abc"</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = a</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>id(a)</span><br><span class="line"><span class="number">4363614224</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>id(b)</span><br><span class="line"><span class="number">4363614224</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a <span class="keyword">is</span> b</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = <span class="string">"abc"</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = <span class="string">"abc"</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>id(a)</span><br><span class="line"><span class="number">4408735760</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>id(b)</span><br><span class="line"><span class="number">4408735760</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a <span class="keyword">is</span> b</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure>

<p>åœ¨Pythonçš„å†…éƒ¨æœ‰ä¸€ç§internæœºåˆ¶, åœ¨åˆ›å»ºå°æ®µå­—ç¬¦ä¸²å’Œä¸€å®šèŒƒå›´å†…çš„æ•´å‹å¯¹è±¡çš„æ—¶å€™, ä¼šå»å»ºç«‹ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„å¯¹è±¡, å½“æœ‰å…¶ä»–â€æ ‡ç­¾â€(å˜é‡)å¼•ç”¨åˆ°è¿™ä¸ªå¯¹è±¡çš„æ—¶å€™, ä¸ä¼šé‡æ–°ç”Ÿæˆä¸€ä¸ªæ–°çš„å¯¹è±¡, è€Œæ˜¯ä¼šå¤ç”¨è¿™ä¸ªå¯¹è±¡, æ‰€ä»¥ä¸Šé¢çš„ä¾‹å­ğŸŒ°ä¸­, è™½ç„¶å•ç‹¬ä¸ºä¸¤ä¸ªå˜é‡èµ‹å€¼äº†çŸ­å­—ç¬¦ä¸², ä½†æ˜¯ä»–ä»¬å®é™…æŒ‡å‘çš„è¿˜æ˜¯åŒä¸€ä¸ªå¯¹è±¡, åŒä¸€å—å†…å­˜</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = <span class="number">1.1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = <span class="number">1.1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>id(a)</span><br><span class="line"><span class="number">4420807080</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>id(b)</span><br><span class="line"><span class="number">4420807488</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a <span class="keyword">is</span> b</span><br><span class="line"><span class="literal">False</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°, Pythonä¸­çš„internæœºåˆ¶åªé€‚ç”¨äºå°æ•´æ•°æˆ–çŸ­å­—ç¬¦ä¸², åŒæ ·ä¸ºåŸºç¡€æ•°æ®ç±»å‹çš„æµ®ç‚¹å‹, ä¹Ÿæ˜¯ä¸æ”¯æŒçš„</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = [<span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = [<span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>id(a)</span><br><span class="line"><span class="number">4428278664</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>id(b)</span><br><span class="line"><span class="number">4428154376</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a <span class="keyword">is</span> b</span><br><span class="line"><span class="literal">False</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = [<span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = a</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>id(a)</span><br><span class="line"><span class="number">4432739208</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>id(b)</span><br><span class="line"><span class="number">4432739208</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a <span class="keyword">is</span> b</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure>

<h2 id="Pythonä¸­çš„"><a href="#Pythonä¸­çš„" class="headerlink" title="Pythonä¸­çš„=="></a>Pythonä¸­çš„==</h2><p>Pythonä¸­çš„<code>==</code>ç”¨æ¥åˆ¤æ–­ä¸¤ä¸ªå˜é‡çš„å€¼æ˜¯å¦ç›¸ç­‰, è€Œä¸ä¼šçº ç»“äºä¸¤ä¸ªå˜é‡çš„å¯¹è±¡æ˜¯å¦ä¸ºåŒä¸€ä¸ªå¯¹è±¡</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = <span class="number">1.1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = <span class="number">1.1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a == b</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„ä¾‹å­ä¸­, ä½¿ç”¨isåˆ¤æ–­çš„è¯, ä¸¤ä¸ªå¯¹è±¡æ˜¯ä¸¤ä¸ªå•ç‹¬çš„å¯¹è±¡, ä½†æ˜¯ä½¿ç”¨<code>==</code>åˆ¤æ–­çš„è¯, åªæ˜¯åˆ¤æ–­ä»–ä»¬çš„å€¼æ˜¯å¦ç›¸ç­‰, æ˜¾è€Œæ˜“è§, è™½ç„¶å­˜æ”¾åœ¨ä¸åŒçš„å†…å­˜åœ°å€ä¸Š, ä½†æ˜¯ä»–ä»¬çš„å€¼æ˜¯ç›¸ç­‰çš„</p>
<h3 id="é­”æ³•å‡½æ•°-eq"><a href="#é­”æ³•å‡½æ•°-eq" class="headerlink" title="é­”æ³•å‡½æ•°__eq__"></a>é­”æ³•å‡½æ•°<code>__eq__</code></h3><p><code>==</code>çš„åˆ¤æ–­å®é™…ä¸Šæ˜¯ç”±ç±»ä¸­çš„<code>__eq__</code>è¿™ä¸ªé­”æ³•å‡½æ•°æ¥å®ç°çš„</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">    self.name = name</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__eq__</span><span class="params">(self, obj)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> self.name == obj.name</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">a = A(name=<span class="string">"larry"</span>)</span><br><span class="line">aa = A(name=<span class="string">"larry"</span>)</span><br><span class="line"></span><br><span class="line">print(a == aa)</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">True</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>is</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonä¸­çš„å˜é‡çš„æœ¬è´¨</title>
    <url>/2018/07/31/Python%E4%B8%AD%E7%9A%84%E5%8F%98%E9%87%8F%E7%9A%84%E6%9C%AC%E8%B4%A8/</url>
    <content><![CDATA[<blockquote>
<p>Pythonå’ŒJavaä¸­å˜é‡çš„æœ¬è´¨ä¸ä¸€æ ·. Javaåœ¨å®šä¹‰å˜é‡çš„æ—¶å€™, å°±å·²ç»ç¡®å®šäº†è¯¥å˜é‡çš„æ•°æ®ç±»å‹ä¸”ä¸å¯æ”¹å˜. Pythonçš„å˜é‡å®è´¨ä¸Šæ˜¯ä¸€ä¸ªæŒ‡é’ˆ, æŒ‡é’ˆæœ¬èº«çš„å¤§å°æ˜¯å›ºå®šçš„, å®ƒå¯ä»¥æŒ‡å‘ä¸€ä¸ªint, ä¹Ÿå¯ä»¥æŒ‡å‘stræˆ–å…¶ä»–ä»»ä½•æ•°æ®ç±»å‹. åœ¨Pythonä¸­æŸ¥æ‰¾æ•°æ®, åªéœ€è¦æ‰¾åˆ°æŒ‡é’ˆå³å¯æ‰¾åˆ°å¯¹åº”çš„æ•°æ®. å¯ä»¥ç®€å•æŠŠPythonå˜é‡ç†è§£ä¸ºä¸€ä¸ªæ ‡ç­¾, è¿™ä¸ªæ ‡ç­¾çš„å¤§å°æ˜¯å›ºå®šçš„, æ ‡ç­¾å¯ä»¥è´´åœ¨ä»»ä½•å¯¹è±¡ä¸Š</p>
</blockquote>
<h1 id="åˆ›å»ºå˜é‡çš„è¿‡ç¨‹"><a href="#åˆ›å»ºå˜é‡çš„è¿‡ç¨‹" class="headerlink" title="åˆ›å»ºå˜é‡çš„è¿‡ç¨‹"></a>åˆ›å»ºå˜é‡çš„è¿‡ç¨‹</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a = <span class="number">1</span></span><br><span class="line">a = <span class="string">"abc"</span></span><br></pre></td></tr></table></figure>

<ul>
<li>é¦–å…ˆ, åœ¨å†…å­˜ä¸­å£°æ˜ä¸€ä¸ªintå¯¹è±¡, ç”¨æ¥æ”¾æ•°æ®</li>
<li>ç„¶åç»™å¯¹è±¡è´´ä¸Šæ ‡ç­¾</li>
</ul>
<p>æ³¨æ„: å¯¹äºPythonæ¥è¯´, æ˜¯<code>a</code>æ ‡ç­¾è´´åœ¨äº†å¯¹è±¡ä¸Š, è€Œä¸æ˜¯å°†å¯¹è±¡åˆ†é…ç»™<code>a</code>. åœ¨Javaæ¥è¯´, æ‰æ˜¯å°†å¯¹è±¡åˆ†é…åˆ°äº†<code>a</code>çš„â€ç›’å­â€é‡Œ. â€œæ ‡ç­¾â€æ˜¯åŠ¨æ€è¯­è¨€çš„æ ¸å¿ƒ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">b = a</span><br><span class="line">b.append(d)</span><br><span class="line">print(a)</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[1, 2, 3, 4]</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°, aæ ‡ç­¾è´´åœ¨äº†ä¸€ä¸ªåˆ—è¡¨å¯¹è±¡ä¸Š, ç„¶åå°†bä¹Ÿè´´åœ¨äº†è¿™ä¸ªåˆ—è¡¨ä¸Š, æ‰€ä»¥åé¢å¯¹bæ ‡ç­¾çš„æ“ä½œ, å®é™…ä¹Ÿæ˜¯åœ¨æ“ä½œaæ ‡ç­¾ä¸‹çš„æ•°æ®, å› ä¸ºa, bä¸¤ä¸ªæ ‡ç­¾æ­¤æ—¶å¯¹åº”çš„æ˜¯åŒä¸€å¯¹è±¡</p>
<p>æ­¤æ—¶å¯èƒ½æœ‰äººä¼šæœ‰ç–‘é—®, ä¸Šé¢æ˜¯å¼•ç”¨æ•°æ®ç±»å‹, å¦‚æœæˆ‘æ“ä½œçš„æ˜¯åŸºæœ¬æ•°æ®ç±»å‹å‘¢? è¯·çœ‹å¦‚ä¸‹å®éªŒ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a = <span class="string">"abc"</span></span><br><span class="line">b = a</span><br><span class="line">b.replace(<span class="string">"c"</span>, <span class="string">"x"</span>)</span><br><span class="line">print(a)</span><br><span class="line">print(b)</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#39;abc&#39;</span><br><span class="line">&#39;abc&#39;</span><br></pre></td></tr></table></figure>

<p>åœ¨ç¬¬ä¸‰è¡Œä¸­, æˆ‘å¯¹å­—ç¬¦ä¸²è¿›è¡Œäº†æ›¿æ¢æ“ä½œ, ä¸ºä»€ä¹ˆæ²¡æœ‰å½±å“åˆ°æœ€ç»ˆçš„ç»“æœå‘¢? å› ä¸ºåœ¨<code>å­—ç¬¦ä¸²</code>.replace()çš„æ“ä½œå, ä¼šè¿”å›ä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²å¯¹è±¡, è¯¥å­—ç¬¦ä¸²å¯¹è±¡æ‰æ˜¯ç¬¦åˆé¢„æœŸä¿®æ”¹çš„å­—ç¬¦ä¸², è¯¥æ“ä½œæ–°ç”Ÿæˆäº†å¯¹è±¡è¿”å›, æ²¡æœ‰å½±å“åˆ°åŸå§‹å¯¹è±¡çš„æ•°æ®. è€Œä¸”æˆ‘ä»¬å¯ä»¥é€šè¿‡id()å‡½æ•°æ¥è§‚å¯Ÿ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">id(a)</span><br><span class="line">id(b)</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">4554176528</span><br><span class="line">4554176528</span><br></pre></td></tr></table></figure>

<p>ä»æ‰§è¡Œç»“æœå¯ä»¥çœ‹å‡º, å³ä½¿å¯¹è±¡æ˜¯åŸºç¡€æ•°æ®ç±»å‹, a, bä¸¤ä¸ªæ ‡ç­¾ä¾ç„¶æ˜¯è´´åœ¨åŒä¸€ä¸ªå¯¹è±¡ä¸Š, æ²¡æœ‰ç”Ÿæˆæ–°çš„å¯¹è±¡</p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>å˜é‡</tag>
      </tags>
  </entry>
  <entry>
    <title>GoåŸºç¡€ä¹‹æŒ‡é’ˆ</title>
    <url>/2018/07/27/Go%E5%9F%BA%E7%A1%80%E4%B9%8B%E6%8C%87%E9%92%88/</url>
    <content><![CDATA[<h1 id="Go-è¯­è¨€çš„æŒ‡é’ˆ"><a href="#Go-è¯­è¨€çš„æŒ‡é’ˆ" class="headerlink" title="Go è¯­è¨€çš„æŒ‡é’ˆ"></a>Go è¯­è¨€çš„æŒ‡é’ˆ</h1><h2 id="Go-è¯­è¨€ä¸­è·å–å†…å­˜åœ°å€"><a href="#Go-è¯­è¨€ä¸­è·å–å†…å­˜åœ°å€" class="headerlink" title="Go è¯­è¨€ä¸­è·å–å†…å­˜åœ°å€"></a>Go è¯­è¨€ä¸­è·å–å†…å­˜åœ°å€</h2><p>Goè¯­è¨€ä½¿ç”¨<code>&amp;</code>ç¬¦å·æ¥å–åœ°å€</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="keyword">var</span> lv <span class="keyword">int</span> = <span class="number">10</span></span><br><span class="line"></span><br><span class="line">   fmt.Println(&amp;lv)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœä¸º:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0xc420080030</span><br></pre></td></tr></table></figure>

<h2 id="Goè¯­è¨€ä¸­çš„æŒ‡é’ˆ"><a href="#Goè¯­è¨€ä¸­çš„æŒ‡é’ˆ" class="headerlink" title="Goè¯­è¨€ä¸­çš„æŒ‡é’ˆ"></a>Goè¯­è¨€ä¸­çš„æŒ‡é’ˆ</h2><p>ä¸€ä¸ªæŒ‡é’ˆå˜é‡æŒ‡å‘äº†ä¸€ä¸ªå€¼çš„å†…å­˜åœ°å€, æŒ‡é’ˆä¹Ÿæ˜¯ä¸€ç§æ•°æ®ç±»å‹, åœ¨ä½¿ç”¨ä¹‹å‰, ä½ éœ€è¦å…ˆå£°æ˜æŒ‡é’ˆ</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> age *<span class="keyword">int</span>  <span class="comment">// æŒ‡å‘æ•´å‹çš„æŒ‡é’ˆ</span></span><br><span class="line"><span class="keyword">var</span> name *<span class="keyword">string</span>  <span class="comment">// æŒ‡å‘å­—ç¬¦ä¸²çš„æŒ‡é’ˆ</span></span><br></pre></td></tr></table></figure>

<p>*<em>å˜é‡: *</em> å˜é‡æ˜¯ä¸€ç§å ä½ç¬¦, ç”¨äºå¼•ç”¨è®¡ç®—æœºå†…å­˜çš„åœ°å€, å¯ä»¥ç†è§£ä¸ºå†…å­˜åœ°å€çš„æ ‡ç­¾</p>
<p>*<em>æŒ‡é’ˆ: *</em> æŒ‡å‘å…¶ä»–å˜é‡å†…å­˜åœ°å€çš„å€¼</p>
<p>*<em>&amp;: *</em> å–å˜é‡çš„å†…å­˜åœ°å€</p>
<p><em>*\</em>: ** å–æŒ‡é’ˆæŒ‡å‘çš„å†…å­˜åœ°å€çš„å€¼</p>
<p>æ¯”å–»: ç°å±‹é‡Œæœ‰ä¸€ä¸ª2*2çš„ç®±å­, å·¦ä¸‹è§’ç®±å­çš„ç¼–å·æ˜¯<code>1-1</code>æ ‡ç­¾è´´äº†è‹¹æœ, å³ä¸‹è§’ç®±å­çš„ç¼–å·æ˜¯<code>1-2</code>æ ‡ç­¾è´´äº†ç‰ç±³, å·¦ä¸Šè§’ç®±å­çš„ç¼–å·æ˜¯<code>2-1</code>æ ‡ç­¾è´´äº†æ¡ƒå­, å³ä¸Šè§’ç®±å­çš„ç¼–å·æ˜¯<code>2-2</code>æ ‡ç­¾è´´äº†åœŸè±†, æˆ¿é—´é‡Œè¿˜ç«‹ç€ä¸€ä¸ªå¤§æŒ‡ç¤ºç‰Œ. ğŸ”œ å¦‚ä¸‹å›¾æ‰€ç¤º</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">-----------------</span><br><span class="line">|æ¡ƒå­ğŸ‘ | åœŸè±†ğŸ¥” |</span><br><span class="line">|2-1   | 2-2    |</span><br><span class="line">----------------|</span><br><span class="line">|è‹¹æœğŸ | ç‰ç±³ğŸŒ½ |</span><br><span class="line">|1-1   |1-2     |</span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">ğŸ”œ  æŒ‡ç¤ºç‰Œ</span><br></pre></td></tr></table></figure>

<ul>
<li>å˜é‡: å˜é‡å°±æ˜¯ç®±å­ä¸Šçš„æ ‡ç­¾, æ¡ƒå­å°±æ˜¯ä¸€ä¸ªå˜é‡å, è€Œç®±å­é‡Œçš„æ¡ƒå­ğŸ‘åˆ™æ˜¯å€¼</li>
<li>å€¼: å®é™…ä¿å­˜å†…å®¹çš„åœ°æ–¹, ä¹Ÿå°±æ˜¯å®é™…æ”¾åœ¨ç›’å­é‡Œçš„ä¸œè¥¿</li>
<li>æŒ‡é’ˆ: æŒ‡é’ˆå°±ç†è§£ä¸ºæ‘†åœ¨æˆ¿é—´é‡Œçš„æŒ‡ç¤ºç‰Œ, æŒ‡ç¤ºç‰Œå¯ä»¥æŒ‡å‘ä»»æ„ä¸€ä¸ªç®±å­çš„åœ°å€, ä¹Ÿå°±æ˜¯å¯ä»¥æŒ‡å‘<code>1-1</code> <code>1-2</code> <code>2-1</code> æˆ– <code>2-2</code></li>
<li>&amp;: è·å–å˜é‡çš„åœ°å€, ç”¨åœ¨å˜é‡åå‰é¢, ç†è§£ä¸ºè·å–æ ‡ç­¾çš„åœ°å€, æ¯”å¦‚&amp;ç‰ç±³, æ„æ€å°±æ˜¯è·å–ç‰ç±³æ‰€åœ¨ç®±å­çš„åœ°å€, ä¹Ÿå°±æ˜¯<code>1-2</code></li>
<li>*: è·å–æŒ‡é’ˆæŒ‡å‘å†…å­˜åœ°å€çš„å€¼, å‡å¦‚è¯¥æŒ‡é’ˆæŒ‡å‘äº†ç‰ç±³çš„åœ°å€, åˆ™ä½¿ç”¨<code>*</code>è·å–è¯¥æŒ‡é’ˆçš„å€¼å³ä¸ºç®±å­é‡Œæ‰€æœ‰çš„ç‰ç±³ğŸŒ½</li>
</ul>
<p>*<em>æ³¨æ„: *</em> æŒ‡é’ˆæ˜¯æœ‰æ•°æ®ç±»å‹çš„, æ¯”å¦‚ä½ å£°æ˜äº†ä¸€ä¸ªæ°´æœç±»å‹çš„æŒ‡é’ˆ, é‚£ä¹ˆè¿™ä¸ªæŒ‡é’ˆ(è¿™ä¸ªæŒ‡ç¤ºç‰Œ)å°±åªèƒ½æŒ‡å‘<code>1-1</code> æˆ– <code>2-1</code> è¿™ä¸¤ä¸ªåœ°å€, å› ä¸ºåªæœ‰è¿™ä¸¤ä¸ªåœ°å€çš„å€¼ç±»å‹ä¸ºæ°´æœ; åŒç†, å¦‚æœä½ å£°æ˜äº†ä¸€ä¸ªè”¬èœç±»å‹çš„æŒ‡é’ˆ, ä¹Ÿåªèƒ½æŒ‡å‘ <code>1-2</code> å’Œ <code>2-2</code> è¿™ä¸¤å—å†…å­˜åœ°å€, ä¸‹é¢ä»‹ç»æŒ‡é’ˆçš„ä½¿ç”¨æ—¶, ä»å°†ä½¿ç”¨åˆ°è¯¥æ¯”å–»</p>
<h2 id="æŒ‡é’ˆçš„ä½¿ç”¨"><a href="#æŒ‡é’ˆçš„ä½¿ç”¨" class="headerlink" title="æŒ‡é’ˆçš„ä½¿ç”¨"></a>æŒ‡é’ˆçš„ä½¿ç”¨</h2><ul>
<li>å®šä¹‰æŒ‡é’ˆå˜é‡</li>
<li>ä¸ºæŒ‡é’ˆèµ‹å€¼</li>
<li>è®¿é—®æŒ‡é’ˆå˜é‡ä¸­æŒ‡å‘åœ°å€çš„å€¼</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// å£°æ˜ä¸€ä¸ªæ°´æœå˜é‡, å‡è®¾intç±»å‹ä¸ºæ°´æœç±»å‹</span></span><br><span class="line">	<span class="comment">// å‡è®¾59ä¸ºè‹¹æœğŸ, 59å³ä¸ºç›’å­å®é™…å­˜æ”¾çš„ä¸œè¥¿</span></span><br><span class="line">	<span class="keyword">var</span> fruit <span class="keyword">int</span> = <span class="number">59</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// å£°æ˜ä¸€ä¸ªintç±»å‹(æ°´æœç±»å‹)çš„æŒ‡é’ˆå˜é‡</span></span><br><span class="line">	<span class="keyword">var</span> indicator *<span class="keyword">int</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// å°†fruitå˜é‡çš„åœ°å€èµ‹å€¼ç»™æŒ‡é’ˆ</span></span><br><span class="line">	<span class="comment">// (å°†è‹¹æœç›’å­çš„åœ°å€1-1èµ‹å€¼ç»™æŒ‡ç¤ºç‰Œ, æŒ‡ç¤ºç‰Œä¸Šå†™äº†/æŒ‡å‘äº†1-1)</span></span><br><span class="line">	indicator = &amp;fruit</span><br><span class="line"></span><br><span class="line">	<span class="comment">// è®¿é—®æŒ‡é’ˆæŒ‡å‘çš„å€¼</span></span><br><span class="line">	<span class="comment">// æ‰“å¼€æŒ‡ç¤ºç‰ŒæŒ‡å‘çš„ç›’å­, æ‰“å¼€1-1ç›’å­å‘ç°äº†çœŸæ­£å­˜æ”¾çš„è‹¹æœğŸ</span></span><br><span class="line">	fmt.Println(*indicator)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœä¸º:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">59</span><br></pre></td></tr></table></figure>

<h2 id="ç©ºæŒ‡é’ˆ"><a href="#ç©ºæŒ‡é’ˆ" class="headerlink" title="ç©ºæŒ‡é’ˆ"></a>ç©ºæŒ‡é’ˆ</h2><p>å½“ä¸€ä¸ªæŒ‡é’ˆè¢«å£°æ˜å, å´æ²¡æœ‰è¢«èµ‹äºˆä»»ä½•å˜é‡çš„å†…å­˜åœ°å€, æ­¤æ—¶, è¯¥æŒ‡é’ˆçš„å€¼ä¸º<code>nil</code>, nilæŒ‡é’ˆä¹Ÿè¢«ç§°ä½œç©ºæŒ‡é’ˆ</p>
<p>nilåœ¨æ¦‚å¿µä¸Šå’Œå…¶å®ƒè¯­è¨€çš„nullã€Noneã€nilã€NULLä¸€æ ·ï¼Œéƒ½æŒ‡ä»£é›¶å€¼æˆ–ç©ºå€¼, ä¸€ä¸ªæŒ‡é’ˆå˜é‡é€šå¸¸ç¼©å†™ä¸º ptr</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> ptr *<span class="keyword">int</span></span><br><span class="line">	fmt.Println(ptr)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> ptr == <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"pträ¸ºç©ºæŒ‡é’ˆ"</span>)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"pträ¸ºéç©ºæŒ‡é’ˆ"</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœä¸º:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;nil&gt;</span><br><span class="line">pträ¸ºç©ºæŒ‡é’ˆ</span><br></pre></td></tr></table></figure>

<h2 id="GoæŒ‡é’ˆå¼•ç”¨ä¹‹å‘å‡½æ•°ä¼ é€’æŒ‡é’ˆå‚æ•°"><a href="#GoæŒ‡é’ˆå¼•ç”¨ä¹‹å‘å‡½æ•°ä¼ é€’æŒ‡é’ˆå‚æ•°" class="headerlink" title="GoæŒ‡é’ˆå¼•ç”¨ä¹‹å‘å‡½æ•°ä¼ é€’æŒ‡é’ˆå‚æ•°"></a>GoæŒ‡é’ˆå¼•ç”¨ä¹‹å‘å‡½æ•°ä¼ é€’æŒ‡é’ˆå‚æ•°</h2><p><strong>å€¼ä¼ é€’? å¼•ç”¨ä¼ é€’?</strong></p>
<p>åœ¨Pythonä¸­, é™¤äº†åƒint, strè¿™æ ·åŸºæœ¬æ•°æ®ç±»å‹æ˜¯å€¼ä¼ é€’å¤–, å…¶ä½™ç»å¤§éƒ¨åˆ†éƒ½æ˜¯å¼•ç”¨ä¼ é€’.<br>è€Œåœ¨Goè¯­è¨€ä¸­, åªæœ‰å€¼ä¼ é€’ä¸€ç§æ–¹å¼, Goè¯­è¨€ä¸­æ˜¯é€šè¿‡ä¼ é€’æŒ‡é’ˆæ¥å®ç°å¼•ç”¨ä¼ é€’çš„</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//äº¤æ¢å€¼çš„å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">swap1</span><span class="params">(a, b <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">	b, a = a, b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// *int æŒ‡å‘æ•´å‹çš„æŒ‡é’ˆ</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">swap2</span><span class="params">(a, b *<span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">	<span class="comment">// bæŒ‡å‘çš„å€¼èµ‹å€¼ç»™a, aæŒ‡å‘çš„å€¼èµ‹å€¼ç»™b</span></span><br><span class="line">	<span class="comment">// *b, *a = *a, *b</span></span><br><span class="line">	<span class="comment">// *a å–å‡º a æŒ‡é’ˆæŒ‡å‘çš„å€¼èµ‹å€¼ç»™ c å˜é‡(ä¸­é—´å˜é‡)</span></span><br><span class="line">	c := *a</span><br><span class="line">	<span class="comment">// *b å–å‡º b æŒ‡é’ˆçš„æŒ‡å‘çš„å€¼èµ‹å€¼ç»™ aæŒ‡é’ˆçš„å€¼</span></span><br><span class="line">	<span class="comment">// æ³¨æ„, ä¸èƒ½æŠŠå€¼ç›´æ¥èµ‹å€¼ç»™æŒ‡é’ˆ</span></span><br><span class="line">	<span class="comment">// æŒ‡é’ˆåªæ˜¯ä¿å­˜å€¼çš„åœ°å€</span></span><br><span class="line">	<span class="comment">// æ‰€ä»¥è¿™é‡Œå°† b æŒ‡é’ˆæŒ‡å‘çš„å€¼èµ‹å€¼ç»™ a æŒ‡é’ˆæŒ‡å‘çš„å€¼, å³ç”¨ b å€¼è¦†ç›– a å€¼</span></span><br><span class="line">	*a = *b</span><br><span class="line">	<span class="comment">// æœ€åç”¨ c å˜é‡çš„å€¼, è¦†ç›– b å€¼</span></span><br><span class="line">	*b = c</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">swap3</span><span class="params">(a, b *<span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">	*a, *b = *b, *a</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">swap4</span><span class="params">(a, b <span class="keyword">int</span>)</span> <span class="params">(<span class="keyword">int</span>, <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">	<span class="comment">// ä½¿ç”¨å€¼ä¼ é€’çš„æ–¹å¼, åˆ©ç”¨è¿”å›å€¼æ¥å®ç°å€¼çš„äº¤æ¢</span></span><br><span class="line">	<span class="keyword">return</span> b, a</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	a, b := <span class="number">5</span>, <span class="number">9</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// å€¼ä¼ é€’, äº¤æ¢åªåœ¨å‡½æ•°å†…ç”Ÿæ•ˆ, ä¸èƒ½æ”¹å˜å¤–é¢çš„å€¼</span></span><br><span class="line">	swap1(a, b)</span><br><span class="line">	fmt.Println(a, b)  <span class="comment">// ç»“æœä¸º: 5 9</span></span><br><span class="line">	<span class="comment">// ä»ç»“æœä¸­å¯ä»¥çœ‹å‡º, a, bä¸¤ä¸ªå˜é‡è¿›å…¥åˆ°å‡½æ•°æ˜¯å€¼æ‹·è´, åœ¨å‡½æ•°å†…çš„æ“ä½œå¹¶æ²¡æœ‰æ”¹å˜å‡½æ•°å¤–a, bå®é™…çš„å€¼</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// äº¤æ¢åœ°å€(å¼•ç”¨ä¼ é€’)</span></span><br><span class="line">	swap2(&amp;a, &amp;b)</span><br><span class="line">	fmt.Println(a, b)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// å†æ¬¡äº¤æ¢åœ°å€(å¼•ç”¨ä¼ é€’)</span></span><br><span class="line">	swap3(&amp;a, &amp;b)</span><br><span class="line">	fmt.Println(a, b)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// å€¼ä¼ é€’, åˆ©ç”¨è¿”å›å€¼äº¤æ¢å€¼</span></span><br><span class="line">	<span class="comment">// æ³¨æ„è¿”å›å€¼çš„é¡ºåº, è¿”å›å€¼é‡Œäº¤æ¢äº†, æ¥æ”¶è¿”å›å€¼çš„é¡ºåºå°±ä¸è¦å˜</span></span><br><span class="line">	<span class="comment">// å¦‚æœreturnæ˜¯ a,b é‚£ä¹ˆæ¥æ”¶çš„æ—¶å€™å°±è¦å˜æˆ b, a å»æ¥æ”¶</span></span><br><span class="line">	a, b = swap4(a, b)</span><br><span class="line">	fmt.Println(a, b)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ä»¥ä¸Šäº¤æ¢çš„åœºæ™¯ä¸­, swap4ä¸ºæœ€ä½³æ–¹æ¡ˆ, ç®€å•æœ‰æ•ˆ! æŒ‡é’ˆåœ¨å®é™…ä½¿ç”¨ä¸­ä¹Ÿè¦å……åˆ†è€ƒè™‘ä½¿ç”¨åœºæ™¯, æ˜¯å¦éç”¨æŒ‡é’ˆä¸å¯</strong></p>
<h2 id="GoæŒ‡é’ˆå¼•ç”¨ä¹‹æŒ‡å‘æŒ‡é’ˆçš„æŒ‡é’ˆ"><a href="#GoæŒ‡é’ˆå¼•ç”¨ä¹‹æŒ‡å‘æŒ‡é’ˆçš„æŒ‡é’ˆ" class="headerlink" title="GoæŒ‡é’ˆå¼•ç”¨ä¹‹æŒ‡å‘æŒ‡é’ˆçš„æŒ‡é’ˆ"></a>GoæŒ‡é’ˆå¼•ç”¨ä¹‹æŒ‡å‘æŒ‡é’ˆçš„æŒ‡é’ˆ</h2><p>å¾…ç»­â€¦</p>
]]></content>
      <categories>
        <category>Go</category>
      </categories>
      <tags>
        <tag>Go</tag>
        <tag>æŒ‡é’ˆ</tag>
      </tags>
  </entry>
  <entry>
    <title>GoåŸºç¡€ä¹‹å‡½æ•°çš„ç”¨æ³•</title>
    <url>/2018/07/26/Go%E5%9F%BA%E7%A1%80%E4%B9%8B%E5%87%BD%E6%95%B0%E7%9A%84%E7%94%A8%E6%B3%95/</url>
    <content><![CDATA[<blockquote>
<p>æœ¬æ–‡Demoä»‹ç»Goè¯­è¨€å‡½æ•°çš„ä½¿ç”¨, åŒ…å«å¤šè¿”å›å€¼, é—­åŒ…, å¸¦å‚é—­åŒ…, å‡½æ•°ä½œä¸ºå˜é‡çš„å€¼, å‡½æ•°çš„å‚æ•°ä¸ºå‡½æ•°, å‡½æ•°å‚æ•°ä¸ºå¯å˜å‚æ•°åˆ—è¡¨çš„è¿™å‡ ç§æƒ…å†µ</p>
</blockquote>
<p><strong>åœ¨Goè¯­è¨€çš„å‡½æ•°çš„å‚æ•°ä¸­, æ²¡æœ‰Pythonä¸­ç±»ä¼¼çš„é»˜è®¤å‚æ•°, å¯å˜å‚æ•°ç­‰æ¦‚å¿µ, åªæœ‰ä¸€ä¸ªå¯å˜å‚æ•°åˆ—è¡¨çš„åŠŸèƒ½</strong></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‡½æ•°çš„ç”¨æ³•</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Goè¯­è¨€æ”¯æŒå¤šè¿”å›å€¼, å¤§å¤šæ•°æƒ…å†µä¸‹, è¿”å›ä¸¤ä¸ªå€¼, ä¸€ä¸ªå€¼æ˜¯ç»“æœ, ä¸€ä¸ªå€¼æ˜¯error</span></span><br><span class="line"><span class="comment">// å¦‚æœå‡½æ•°æ‰§è¡Œæ­£ç¡®, errorå€¼è¿”å›ä¸ºnil</span></span><br><span class="line"><span class="comment">// è¿™æ ·åœ¨ifåˆ¤æ–­çš„æ—¶å€™, å°±å¯ä»¥åˆ¤æ–­å‡½æ•°çš„ç¬¬äºŒä¸ªè¿”å›å€¼æ˜¯å¦énil</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">FuncDemo5</span><span class="params">(arg1, arg2 <span class="keyword">float64</span>)</span> <span class="params">(<span class="keyword">float64</span>, error)</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> arg2 == <span class="number">0</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">float64</span>(<span class="number">0</span>), fmt.Errorf(<span class="string">"è¢«é™¤æ•°ä¸èƒ½ä¸º0"</span>)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> arg1/arg2, <span class="literal">nil</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‡½æ•°çš„ç”¨æ³•ä¹‹é—­åŒ…</span></span><br><span class="line"><span class="comment">// é—­åŒ…çš„è¡¨ç°å½¢å¼ä¸ºå‡½æ•°é‡Œè¿”å›å¦å¤–ä¸€ä¸ªåŒ¿åå‡½æ•°, è¯¥åŒ¿åå‡½æ•°ä¸ºä¸€ä¸ªå†…è”çš„è¯­å¥æˆ–è¡¨è¾¾å¼</span></span><br><span class="line"><span class="comment">// func å‡½æ•°å() åŒ¿åå‡½æ•°() åŒ¿åå‡½æ•°è¿”å›å€¼</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">FuncDemo6</span><span class="params">()</span> <span class="title">func</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	<span class="comment">// åœ¨å‘½åå‡½æ•°å†…å£°æ˜å˜é‡</span></span><br><span class="line">	i := <span class="number">0</span></span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">		<span class="comment">// åœ¨åŒ¿åå‡½æ•°ä¸­å¯ä»¥ç›´æ¥è®¿é—®æˆ–æ“ä½œå‘½åå‡½æ•°ä¸­å®šä¹‰çš„å˜é‡</span></span><br><span class="line">		i++</span><br><span class="line">		<span class="keyword">return</span> i</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¸¦å‚é—­åŒ…</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">FuncDemo7</span><span class="params">(arg1, arg2 <span class="keyword">int</span>)</span> <span class="title">func</span><span class="params">(arg3, arg4 <span class="keyword">int</span>)</span> <span class="params">(<span class="keyword">int</span>, error)</span></span> &#123;</span><br><span class="line">	i := <span class="number">0</span></span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(arg3, arg4 <span class="keyword">int</span>)</span> <span class="params">(<span class="keyword">int</span>, error)</span></span> &#123;</span><br><span class="line">		i++</span><br><span class="line">		sum := arg1 + arg2 + arg3 + arg4 + i</span><br><span class="line">		<span class="keyword">return</span> sum, <span class="literal">nil</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‡½æ•°è¿˜æœ‰ä¸€ç§ç”¨æ³•: ä½œä¸ºå˜é‡çš„å€¼</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">FuncDemo8</span><span class="params">(arg1, arg2 <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// å£°æ˜ä¸€ä¸ªæ™®é€šå˜é‡, è¯¥å˜é‡çš„å€¼ä¸ºä¸€ä¸ªå‡½æ•°</span></span><br><span class="line">	result := <span class="function"><span class="keyword">func</span><span class="params">(arg3, arg4 <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">		<span class="keyword">return</span> arg1 * arg2</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// è¯¥å˜é‡è¢«èµ‹å€¼ä¸ºä¸€ä¸ªå‡½æ•°å, è¯¥å˜é‡å³å¯è¢«å½“åšå…¶å‡½æ•°è°ƒç”¨</span></span><br><span class="line">	r := result(arg1, arg2)</span><br><span class="line">	fmt.Println(r)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‡½æ•°çš„å‚æ•°ä¸ºå‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">FuncDemo9</span><span class="params">(arg1, arg2 <span class="keyword">int</span>)</span> <span class="params">(<span class="keyword">int</span>, error)</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> arg1 + arg2, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">FuncDemo10</span><span class="params">(op <span class="keyword">func</span>(arg1, arg2 <span class="keyword">int</span>)</span> <span class="params">(<span class="keyword">int</span>, error)</span>, <span class="title">arg3</span>, <span class="title">arg4</span> <span class="title">int</span>) <span class="params">(<span class="keyword">int</span>, error)</span></span> &#123;</span><br><span class="line">	result, err := op(arg3, arg4)</span><br><span class="line">	<span class="keyword">return</span> result, err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‡½æ•°çš„å‚æ•°ä¸ºå¯å˜å‚æ•°åˆ—è¡¨(å‚æ•°ä¼ å¤šå°‘ä¸ªå€¼éƒ½å¯ä»¥)</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">FuncDemo11</span><span class="params">(numbers ...<span class="keyword">int</span>)</span> <span class="params">(<span class="keyword">int</span>, error)</span></span> &#123;</span><br><span class="line">	s := <span class="number">0</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="keyword">range</span> numbers &#123;</span><br><span class="line">		s += numbers[i]</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> s, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> result, err := FuncDemo5(<span class="number">13</span>,<span class="number">6</span>); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"Error"</span>)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		fmt.Println(result)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> result, err := FuncDemo5(<span class="number">13</span>,<span class="number">0</span>); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"Error"</span>)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		fmt.Println(result)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	nextValue := FuncDemo6()</span><br><span class="line">	fmt.Println(nextValue())</span><br><span class="line">	fmt.Println(nextValue())</span><br><span class="line">	fmt.Println(nextValue())</span><br><span class="line"></span><br><span class="line">	nextValue2 := FuncDemo6()</span><br><span class="line">	fmt.Println(nextValue2())</span><br><span class="line">	fmt.Println(nextValue2())</span><br><span class="line"></span><br><span class="line">	demo7 :=  FuncDemo7(<span class="number">5</span>,<span class="number">9</span>)</span><br><span class="line">	fmt.Println(demo7(<span class="number">6</span>,<span class="number">13</span>)) <span class="comment">// i==1  5+9+6+13+1</span></span><br><span class="line">	fmt.Println(demo7(<span class="number">6</span>,<span class="number">13</span>)) <span class="comment">// i==2  5+9+6+13+2</span></span><br><span class="line">	fmt.Println(demo7(<span class="number">10</span>,<span class="number">10</span>)) <span class="comment">// i==3  5+9+10+10+3</span></span><br><span class="line"></span><br><span class="line">	FuncDemo8(<span class="number">5</span>,<span class="number">6</span>)</span><br><span class="line"></span><br><span class="line">	fmt.Println(FuncDemo10(FuncDemo9, <span class="number">5</span>,<span class="number">9</span>))</span><br><span class="line"></span><br><span class="line">	fmt.Println(FuncDemo11(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">2.1666666666666665</span><br><span class="line">Error</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">34 &lt;nil&gt;</span><br><span class="line">35 &lt;nil&gt;</span><br><span class="line">37 &lt;nil&gt;</span><br><span class="line">30</span><br><span class="line">14 &lt;nil&gt;</span><br><span class="line">15 &lt;nil&gt;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Go</category>
      </categories>
      <tags>
        <tag>Go</tag>
        <tag>func</tag>
        <tag>é—­åŒ…</tag>
      </tags>
  </entry>
  <entry>
    <title>GoåŸºç¡€ä¹‹å‡½æ•°</title>
    <url>/2018/07/25/Go%E5%9F%BA%E7%A1%80%E4%B9%8B%E5%87%BD%E6%95%B0/</url>
    <content><![CDATA[<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// func å‡½æ•°å(å‚æ•°1 å‚æ•°ç±»å‹, å‚æ•°2 å‚æ•°ç±»å‹....) è¿”å›å€¼ç±»å‹</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">FuncName</span><span class="params">(arg1 <span class="keyword">int</span>, arg2 <span class="keyword">int</span>, arg3 <span class="keyword">string</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	<span class="keyword">switch</span> arg3 &#123;</span><br><span class="line">	<span class="keyword">case</span> <span class="string">"+"</span>: <span class="keyword">return</span> arg1 + arg2</span><br><span class="line">	<span class="keyword">case</span> <span class="string">"-"</span>: <span class="keyword">return</span> arg1 - arg2</span><br><span class="line">	<span class="keyword">default</span>:</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‚æ•°åˆ—è¡¨ä¸­, ç›¸åŒç±»å‹çš„å‚æ•°å¯ä»¥ç»Ÿä¸€å£°æ˜</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">FuncDemo2</span><span class="params">(arg1, arg2 <span class="keyword">int</span>, arg3 <span class="keyword">string</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	<span class="keyword">switch</span> arg3 &#123;</span><br><span class="line">	<span class="keyword">case</span> <span class="string">"+"</span>: <span class="keyword">return</span> arg1 + arg2</span><br><span class="line">	<span class="keyword">case</span> <span class="string">"-"</span>: <span class="keyword">return</span> arg1 - arg2</span><br><span class="line">	<span class="keyword">default</span>:</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤šè¿”å›å€¼</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">FuncDemo3</span><span class="params">(arg1, arg2 <span class="keyword">int</span>, arg3 <span class="keyword">string</span>)</span> <span class="params">(<span class="keyword">int</span>, <span class="keyword">int</span>, <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> arg1, arg2, arg3</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‘½åè¿”å›å€¼</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">FuncDemo4</span><span class="params">(arg1, arg2 <span class="keyword">int</span>, arg3 <span class="keyword">string</span>)</span> <span class="params">(a, b <span class="keyword">int</span>, c <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">	a = arg1</span><br><span class="line">	b = arg2</span><br><span class="line">	c = arg3</span><br><span class="line">	<span class="comment">// ç”±äºä¸Šé¢å·²ç»ä¸ºè¿”å›å€¼å˜é‡èµ‹å€¼, returnæ—¶åé¢å¯ä»¥çœç•¥ä¸å†™</span></span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‡½æ•°å‚æ•°</span></span><br><span class="line"><span class="comment">// å€¼ä¼ é€’: æŒ‡åœ¨è°ƒç”¨å‡½æ•°æ—¶å°†å®é™…å‚æ•°å¤åˆ¶ä¸€ä»½ä¼ é€’åˆ°å‡½æ•°ä¸­ï¼Œè¿™æ ·åœ¨å‡½æ•°ä¸­å¦‚æœå¯¹å‚æ•°è¿›è¡Œä¿®æ”¹ï¼Œå°†ä¸ä¼šå½±å“åˆ°å®é™…å‚æ•°</span></span><br><span class="line"><span class="comment">// å¼•ç”¨ä¼ é€’: æŒ‡åœ¨è°ƒç”¨å‡½æ•°æ—¶å°†å®é™…å‚æ•°çš„åœ°å€ä¼ é€’åˆ°å‡½æ•°ä¸­ï¼Œé‚£ä¹ˆåœ¨å‡½æ•°ä¸­å¯¹å‚æ•°æ‰€è¿›è¡Œçš„ä¿®æ”¹ï¼Œå°†å½±å“åˆ°å®é™…å‚æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	result := FuncName(<span class="number">5</span>, <span class="number">9</span>, <span class="string">"+"</span>)</span><br><span class="line">	result2 := FuncDemo2(<span class="number">9</span>, <span class="number">5</span>, <span class="string">"-"</span>)</span><br><span class="line">	fmt.Println(result, result2)</span><br><span class="line"></span><br><span class="line">	a, b, c := FuncDemo3(<span class="number">5</span>,<span class="number">9</span>,<span class="string">"*"</span>)</span><br><span class="line">	fmt.Println(a, b, c)</span><br><span class="line"></span><br><span class="line">	d, e, f := FuncDemo4(<span class="number">5</span>,<span class="number">6</span>, <span class="string">"/"</span>)</span><br><span class="line">	fmt.Println(d, e, f)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">14 4</span><br><span class="line">5 9 *</span><br><span class="line">5 6 &#x2F;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Go</category>
      </categories>
      <tags>
        <tag>Go</tag>
        <tag>func</tag>
      </tags>
  </entry>
  <entry>
    <title>GoåŸºç¡€ä¹‹å¾ªç¯</title>
    <url>/2018/07/25/Go%E5%9F%BA%E7%A1%80%E4%B9%8B%E5%BE%AA%E7%8E%AF/</url>
    <content><![CDATA[<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ForDemo1</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// åˆå§‹å€¼; å¾ªç¯æ¡ä»¶è¡¨è¾¾å¼; èµ‹å€¼</span></span><br><span class="line">	<span class="keyword">for</span> i:=<span class="number">1</span>; i&lt;=<span class="number">5</span> ; i++ &#123;</span><br><span class="line">		fmt.Println(<span class="string">"--&gt;"</span>, i)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ForDemo2</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> i <span class="keyword">int</span></span><br><span class="line">	<span class="comment">// ä¹Ÿå¯ä»¥åªå†™ä¸€ä¸ªå¾ªç¯æ¡ä»¶è¡¨è¾¾å¼, ç±»ä¼¼äºPythonä¸­çš„while æ¡ä»¶è¡¨è¾¾å¼å¾ªç¯</span></span><br><span class="line">	<span class="keyword">for</span> i &lt;= <span class="number">5</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"---&gt;"</span>, i)</span><br><span class="line">		i++</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ForDemo3</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// æ­»å¾ªç¯, ç±»ä¼¼äºPythonä¸­çš„while True</span></span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"è¿™æ˜¯ä¸ªæ­»å¾ªç¯"</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	ForDemo1()</span><br><span class="line">	ForDemo2()</span><br><span class="line">	ForDemo3()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">--&gt; 1</span><br><span class="line">--&gt; 2</span><br><span class="line">--&gt; 3</span><br><span class="line">--&gt; 4</span><br><span class="line">--&gt; 5</span><br><span class="line">---&gt; 0</span><br><span class="line">---&gt; 1</span><br><span class="line">---&gt; 2</span><br><span class="line">---&gt; 3</span><br><span class="line">---&gt; 4</span><br><span class="line">---&gt; 5</span><br><span class="line">è¿™æ˜¯ä¸ªæ­»å¾ªç¯</span><br><span class="line">è¿™æ˜¯ä¸ªæ­»å¾ªç¯</span><br><span class="line">è¿™æ˜¯ä¸ªæ­»å¾ªç¯</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Go</category>
      </categories>
      <tags>
        <tag>Go</tag>
        <tag>for</tag>
      </tags>
  </entry>
  <entry>
    <title>GoåŸºç¡€ä¹‹æ¡ä»¶åˆ¤æ–­</title>
    <url>/2018/07/25/Go%E5%9F%BA%E7%A1%80%E4%B9%8B%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD/</url>
    <content><![CDATA[<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"runtime"</span></span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">IfDemo</span><span class="params">()</span></span> &#123;</span><br><span class="line">	OSName := runtime.GOOS</span><br><span class="line">	<span class="comment">// ç°åœ¨ifæ¡ä»¶å¤–é¢èµ‹å€¼, å†è¿›è¡Œåˆ¤æ–­</span></span><br><span class="line">	<span class="keyword">if</span> OSName == <span class="string">"windows"</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"It's Windows"</span>)</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> OSName == <span class="string">"linux"</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"It's LinuxğŸ§"</span>)</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> OSName == <span class="string">"darwin"</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"It's MacOSğŸ"</span>)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"Other OS"</span>)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ä¹Ÿå¯ä»¥åœ¨ifæ¡ä»¶è¯­å¥ä¸­å…ˆèµ‹å€¼å†åˆ¤æ–­</span></span><br><span class="line">	<span class="comment">// ifæ¡ä»¶é‡Œçš„å˜é‡ä½œç”¨åŸŸåªåœ¨ifä»£ç å—ä¸­</span></span><br><span class="line">	<span class="keyword">if</span> OSArch := runtime.GOARCH; OSArch == <span class="string">"amd64"</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"64ä½æ“ä½œç³»ç»Ÿâ—ï¸"</span>)</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> OSArch == <span class="string">"amd32"</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"32ä½æ“ä½œç³»ç»Ÿâ—ï¸ï¸"</span>)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"ä»€ä¹ˆé¬¼â“"</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">SwitchDemo</span><span class="params">()</span></span> &#123;</span><br><span class="line">	OSName := runtime.GOOS</span><br><span class="line">	<span class="comment">// switchè¯­å¥, switchåå¯ä»¥è·Ÿä»»ä½•ç±»å‹çš„å˜é‡, caseåè·Ÿè¯¥å˜é‡ç›¸åŒç±»å‹çš„å€¼</span></span><br><span class="line">	<span class="keyword">switch</span> OSName &#123;</span><br><span class="line">	<span class="keyword">case</span> <span class="string">"windows"</span>: fmt.Println(<span class="string">"It's Windows"</span>)</span><br><span class="line">	<span class="keyword">case</span> <span class="string">"linux"</span>: fmt.Println(<span class="string">"It's LinuxğŸ§"</span>)</span><br><span class="line">	<span class="keyword">case</span> <span class="string">"darwin"</span>: fmt.Println(<span class="string">"It's MacOSğŸ"</span>)</span><br><span class="line">	<span class="keyword">case</span> <span class="string">"unix"</span>, <span class="string">"ios"</span>, <span class="string">"android"</span>: fmt.Println(<span class="string">"ğŸ™ƒ"</span>)</span><br><span class="line">	<span class="keyword">default</span>:</span><br><span class="line">		fmt.Println(<span class="string">"ä»€ä¹ˆé¬¼â“"</span>)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	OSArch := runtime.GOARCH</span><br><span class="line">	<span class="comment">// switchè¯­å¥, switchåé¢å¯ä»¥ä¸è·Ÿä»»ä½•ç±»å‹çš„å˜é‡, ç”±caseåå®šä¹‰è¡¨è¾¾å¼</span></span><br><span class="line">	<span class="keyword">switch</span> &#123;</span><br><span class="line">	<span class="keyword">case</span> OSArch == <span class="string">"amd64"</span>: fmt.Println(<span class="string">"64ä½æ“ä½œç³»ç»Ÿâ—ï¸"</span>)</span><br><span class="line">	<span class="keyword">case</span> OSArch == <span class="string">"amd32"</span>: fmt.Println(<span class="string">"32ä½æ“ä½œç³»ç»Ÿâ—ï¸"</span>)</span><br><span class="line">	<span class="keyword">default</span>:</span><br><span class="line">		fmt.Println(<span class="string">"ä»€ä¹ˆé¬¼â“"</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	IfDemo()</span><br><span class="line">	SwitchDemo()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">It&#39;s MacOSğŸ</span><br><span class="line">64ä½æ“ä½œç³»ç»Ÿâ—ï¸</span><br><span class="line">It&#39;s MacOSğŸ</span><br><span class="line">64ä½æ“ä½œç³»ç»Ÿâ—</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Go</category>
      </categories>
      <tags>
        <tag>Go</tag>
        <tag>if</tag>
        <tag>switch</tag>
      </tags>
  </entry>
  <entry>
    <title>GoåŸºç¡€ä¹‹æšä¸¾ç±»å‹</title>
    <url>/2018/07/24/Go%E5%9F%BA%E7%A1%80%E4%B9%8B%E6%9E%9A%E4%B8%BE%E7%B1%BB%E5%9E%8B/</url>
    <content><![CDATA[<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//æšä¸¾</span></span><br><span class="line"><span class="comment">//GOè¯­è¨€æ²¡æœ‰æšä¸¾çš„å…³é”®å­—</span></span><br><span class="line"><span class="comment">//è€Œæ˜¯é€šè¿‡å®šä¹‰ä¸€ç»„å¸¸é‡æ¥å®ç°</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">enums</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">const</span> (</span><br><span class="line">		cpp = <span class="number">0</span></span><br><span class="line">		java = <span class="number">1</span></span><br><span class="line">		python = <span class="number">2</span></span><br><span class="line">		golang = <span class="number">3</span></span><br><span class="line">	)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">const</span> (</span><br><span class="line">		iPhone = <span class="number">2</span> * <span class="literal">iota</span> <span class="comment">//iotaè¡¨ç¤ºè‡ªå¢å€¼</span></span><br><span class="line">		_</span><br><span class="line">		iPad</span><br><span class="line">		iMac</span><br><span class="line">		iPod</span><br><span class="line">	)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">const</span> (</span><br><span class="line">		b = <span class="number">1</span> &lt;&lt; (<span class="number">10</span> * <span class="literal">iota</span>)</span><br><span class="line">		kb</span><br><span class="line">		mb</span><br><span class="line">		gb</span><br><span class="line">		tb</span><br><span class="line">		pb</span><br><span class="line">	)</span><br><span class="line"></span><br><span class="line">	fmt.Println(cpp, java, python, golang)</span><br><span class="line">	fmt.Println(iPhone, iPad, iMac, iPod)</span><br><span class="line">	fmt.Println(b, kb, mb, gb, tb, pb)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	enums()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0 1 2 3</span><br><span class="line">0 4 6 8</span><br><span class="line">1 1024 1048576 1073741824 1099511627776 1125899906842624</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Go</category>
      </categories>
      <tags>
        <tag>Go</tag>
        <tag>æšä¸¾</tag>
      </tags>
  </entry>
  <entry>
    <title>GoåŸºç¡€ä¹‹å¸¸é‡çš„å®šä¹‰</title>
    <url>/2018/07/24/Go%E5%9F%BA%E7%A1%80%E4%B9%8B%E5%B8%B8%E9%87%8F%E7%9A%84%E5%AE%9A%E4%B9%89/</url>
    <content><![CDATA[<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"math"</span></span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">//Goè¯­è¨€çš„å¸¸é‡åä¸€èˆ¬ä¸ä¼šä½¿ç”¨å…¨éƒ¨å¤§å†™æˆ–é¦–å­—ç¬¦å¤§å†™</span></span><br><span class="line"><span class="comment">//åœ¨Goè¯­è¨€ä¸­, é¦–å­—æ¯å¤§å†™ä¸€èˆ¬è¡¨ç¤ºPublic</span></span><br><span class="line"><span class="comment">//å¸¸é‡çš„æ•°å€¼å¯ä»¥ä½œä¸ºå„ç§ç±»å‹ä½¿ç”¨</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//åŒ…å†…å¸¸é‡</span></span><br><span class="line"><span class="keyword">const</span> car = <span class="string">"logo"</span></span><br><span class="line"><span class="comment">//æ‰¹é‡å£°æ˜å¸¸é‡æ—¶å¿…é¡»ä¸ºå¸¸é‡èµ‹å€¼, ä¸èƒ½åƒå˜é‡ä¸€æ ·åªå£°æ˜ä¸èµ‹å€¼</span></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">	page = <span class="number">59</span></span><br><span class="line">	book = <span class="string">"0 to 1"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">consts</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">//å¯ä»¥ä¸å£°æ˜ç±»å‹</span></span><br><span class="line">	<span class="keyword">const</span> filename = <span class="string">"x.txt"</span></span><br><span class="line">	<span class="comment">//å¯ä»¥æ˜¾ç¤ºçš„å£°æ˜ç±»å‹, æ˜¾ç¤ºå£°æ˜å, è¯¥å¸¸é‡çš„ç±»å‹å°±å·²ç»ç¡®å®š</span></span><br><span class="line">	<span class="keyword">const</span> os <span class="keyword">string</span> = <span class="string">"mac os"</span></span><br><span class="line">	<span class="comment">//ä¸å£°æ˜ç±»å‹, è™½ç„¶å·²ç»èµ‹å€¼, ä½†å€¼çš„ç±»å‹ä¸ç¡®å®š, åªæ˜¯æ–‡æœ¬</span></span><br><span class="line">	<span class="keyword">const</span> a, b = <span class="number">3</span>, <span class="number">4</span></span><br><span class="line">	<span class="keyword">var</span> c <span class="keyword">int</span></span><br><span class="line">	<span class="comment">//ç”±äºå¸¸é‡a, bæ²¡æœ‰å£°æ˜ç±»å‹, åœ¨ä½¿ç”¨a,b æ—¶ä¼šè‡ªåŠ¨è½¬æ¢ä¸ºåˆé€‚çš„æ•°æ®ç±»å‹</span></span><br><span class="line">	c = <span class="keyword">int</span>(math.Sqrt(a*a + b*b))</span><br><span class="line">	fmt.Println(c)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Go</category>
      </categories>
      <tags>
        <tag>Go</tag>
        <tag>å¸¸é‡</tag>
      </tags>
  </entry>
  <entry>
    <title>GoåŸºç¡€ä¹‹åŸºæœ¬æ•°æ®ç±»å‹</title>
    <url>/2018/07/24/Go%E5%9F%BA%E7%A1%80%E4%B9%8B%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/</url>
    <content><![CDATA[<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"math"</span></span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">//å†…å»ºå˜é‡ç±»å‹</span></span><br><span class="line"><span class="comment">//bool string</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//u æ— ç¬¦å·æ•´æ•°, ä¸å¸¦uä¸ºæœ‰ç¬¦å·æ•´æ•°</span></span><br><span class="line"><span class="comment">//(u)int (u)int8 (u)int16 (u)int32 (u)int64 uintptr</span></span><br><span class="line"><span class="comment">//int ä¸ºä¸è§„å®šé•¿åº¦çš„æ•´å½¢, å…¶é•¿åº¦ç”±æ“ä½œç³»ç»Ÿçš„ä½æ•°å†³å®š</span></span><br><span class="line"><span class="comment">//pträ¸ºæŒ‡é’ˆ</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//byte rune(å­—ç¬¦å‹)é•¿åº¦32ä½</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//float32 float64 complex64 complex128(å¤æ•°)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Goè¯­è¨€ä¸­, æ‰€æœ‰çš„ç±»å‹è½¬æ¢éƒ½æ˜¯æ˜¾ç¤ºçš„å¼ºåˆ¶ç±»å‹è½¬æ¢</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">triangle</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> a, b <span class="keyword">int</span> = <span class="number">3</span>, <span class="number">4</span></span><br><span class="line">	<span class="keyword">var</span> c <span class="keyword">int</span></span><br><span class="line">	<span class="comment">//func Sqrt(x float64) float64 æ¥æ”¶float64ç±»å‹çš„å‚æ•°, è¿”å›float64ç±»å‹çš„å€¼</span></span><br><span class="line">	<span class="comment">//åœ¨å…¶ä»–è¯­è¨€ä¸­, intç±»å‹å¯ä»¥è¢«éšå¼çš„è½¬æ¢ä¸ºfloatè¿›è¡Œè®¡ç®—, ä½†æ˜¯åœ¨Go, å¿…é¡»æ˜¾ç¤ºå¼ºåˆ¶ç±»å‹è½¬æ¢</span></span><br><span class="line">	<span class="comment">//c ä¸ºintç±»å‹, è€Œå‡½æ•°è¿”å›å€¼ä¸ºfloat64ç±»å‹, æ‰€ä»¥ä¹Ÿéœ€è¦å¼ºåˆ¶ç±»å‹è½¬æ¢ä¸ºint</span></span><br><span class="line">	c = <span class="keyword">int</span>(math.Sqrt(<span class="keyword">float64</span>(a*a + b*b)))</span><br><span class="line">	fmt.Println(c)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	triangle()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Go</category>
      </categories>
      <tags>
        <tag>Go</tag>
        <tag>æ•°æ®ç±»å‹</tag>
      </tags>
  </entry>
  <entry>
    <title>GoåŸºç¡€ä¹‹å˜é‡çš„å®šä¹‰</title>
    <url>/2018/07/24/Go%E5%9F%BA%E7%A1%80%E4%B9%8B%E5%8F%98%E9%87%8F%E7%9A%84%E5%AE%9A%E4%B9%89/</url>
    <content><![CDATA[<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//åœ¨funcå¤–é¢å®šä¹‰çš„å˜é‡, å¿…é¡»ä½¿ç”¨varå…³é”®å­—å£°æ˜, ä¸ç”¨ä½¿ç”¨ := çš„ç®€å†™æ–¹å¼</span></span><br><span class="line"><span class="comment">//å˜é‡ä½œç”¨åŸŸä¸ºåŒ…å†…</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//å£°æ˜å˜é‡</span></span><br><span class="line"><span class="comment">//å£°æ˜çš„åŒ…å˜é‡åªèƒ½åœ¨å‡½æ•°å†…è¢«èµ‹å€¼, åŒ…å†…ä¸å…è®¸è¢«èµ‹å€¼</span></span><br><span class="line"><span class="keyword">var</span> a <span class="keyword">int</span></span><br><span class="line"><span class="keyword">var</span> b <span class="keyword">string</span></span><br><span class="line"><span class="keyword">var</span> c <span class="keyword">bool</span></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">	d <span class="keyword">int</span></span><br><span class="line">	e <span class="keyword">int</span></span><br><span class="line">	f <span class="keyword">int</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">//å£°æ˜å¹¶èµ‹å€¼</span></span><br><span class="line"><span class="comment">//å¯ä»¥åœ¨å˜é‡åå£°æ˜æ•°æ®ç±»å‹</span></span><br><span class="line"><span class="keyword">var</span> name1 <span class="keyword">int</span> = <span class="number">9</span></span><br><span class="line"><span class="comment">//ä¹Ÿå¯ä»¥è®©Goè‡ªåŠ¨å»åˆ¤æ–­æ•°æ®ç±»å‹</span></span><br><span class="line"><span class="keyword">var</span> name2 = <span class="string">"ps"</span></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">	age <span class="keyword">int</span> = <span class="number">28</span></span><br><span class="line">	address = <span class="string">"China"</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">var</span> g, h, i = <span class="number">78</span>, <span class="string">"uu"</span>, <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//å‡½æ•°å†…å˜é‡</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="comment">//å£°æ˜</span></span><br><span class="line">	<span class="keyword">var</span> j <span class="keyword">int</span></span><br><span class="line">	<span class="keyword">var</span> (</span><br><span class="line">		k <span class="keyword">int</span></span><br><span class="line">		l <span class="keyword">string</span></span><br><span class="line">	)</span><br><span class="line">	<span class="comment">//x y z å…¨éƒ¨ä¸ºboolç±»å‹</span></span><br><span class="line">	<span class="keyword">var</span> x, y, z <span class="keyword">bool</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//èµ‹å€¼</span></span><br><span class="line">	j = <span class="number">2</span></span><br><span class="line">	k = <span class="number">78</span></span><br><span class="line">	l = <span class="string">"BJ"</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//å£°æ˜å¹¶èµ‹å€¼</span></span><br><span class="line">	<span class="comment">//Goç¼–è¯‘å™¨è‡ªåŠ¨å†³å®šå˜é‡ç±»å‹</span></span><br><span class="line">	<span class="keyword">var</span> m, n = <span class="number">56</span>, <span class="string">"SOHO"</span></span><br><span class="line">	<span class="comment">//r s t å…¨éƒ¨ä¸ºstringç±»å‹</span></span><br><span class="line">	<span class="keyword">var</span> r, s, t <span class="keyword">string</span> = <span class="string">"hehe"</span>, <span class="string">"heihei"</span>, <span class="string">"haha"</span></span><br><span class="line">	<span class="comment">//åŒ…å†…çš„å˜é‡å£°æ˜å¹¶èµ‹å€¼å¯ä»¥ä½¿ç”¨ç®€å†™æ–¹å¼</span></span><br><span class="line">	o, p, q := <span class="literal">true</span>, <span class="literal">false</span>, <span class="number">87</span></span><br><span class="line"></span><br><span class="line">	fmt.Println(j, k, l, x, y, z, m, n, r, s, t, o, q, p)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(a, b, c, d, e, f, g, h, i, name1, name2, age, address)</span><br><span class="line">	test()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Go</category>
      </categories>
      <tags>
        <tag>Go</tag>
        <tag>å˜é‡</tag>
      </tags>
  </entry>
  <entry>
    <title>TypeError: not all arguments converted during string formatting python</title>
    <url>/2018/03/16/TypeError-not-all-arguments-converted-during-string-formatting-python/</url>
    <content><![CDATA[<p>è¯¥æŠ¥é”™å‘ç”Ÿåœ¨å­—ç¬¦ä¸²æ‹¼æ¥æ—¶çš„æ“ä½œ, ä»¥ä¸‹å­—ç¬¦ä¸²æ‹¼æ¥çš„æ–¹å¼, åªè¦ä¸æ··ç”¨, è¯¥é—®é¢˜å°±å¯ä»¥è§£å†³</p>
<h1 id="ç¬¬ä¸€ç§-å ä½ç¬¦"><a href="#ç¬¬ä¸€ç§-å ä½ç¬¦" class="headerlink" title="ç¬¬ä¸€ç§ % å ä½ç¬¦"></a>ç¬¬ä¸€ç§ % å ä½ç¬¦</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">2</span>]: s  = <span class="string">"abc %s"</span> % <span class="number">123</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">3</span>]: s</span><br><span class="line">Out[<span class="number">3</span>]: <span class="string">'abc 123'</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">4</span>]: s = <span class="string">'abc %s %s'</span> % (<span class="number">123</span>, <span class="number">456</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">5</span>]: s</span><br><span class="line">Out[<span class="number">5</span>]: <span class="string">'abc 123 456'</span></span><br></pre></td></tr></table></figure>

<h1 id="ç¬¬äºŒç§-å¤§æ‹¬å·"><a href="#ç¬¬äºŒç§-å¤§æ‹¬å·" class="headerlink" title="ç¬¬äºŒç§ {} å¤§æ‹¬å·"></a>ç¬¬äºŒç§ {} å¤§æ‹¬å·</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">6</span>]: s = <span class="string">'abc &#123;0&#125;'</span>.format(<span class="number">123</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">7</span>]: s</span><br><span class="line">Out[<span class="number">7</span>]: <span class="string">'abc 123'</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">8</span>]: s = <span class="string">'abc &#123;0&#125; &#123;1&#125;'</span>.format(<span class="number">123</span>, <span class="number">456</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">9</span>]: s</span><br><span class="line">Out[<span class="number">9</span>]: <span class="string">'abc 123 456'</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>format</tag>
      </tags>
  </entry>
  <entry>
    <title>pythonä¸­çš„mysqlè¿æ¥æ± </title>
    <url>/2018/03/16/python%E4%B8%AD%E7%9A%84mysql%E8%BF%9E%E6%8E%A5%E6%B1%A0/</url>
    <content><![CDATA[<h1 id="code"><a href="#code" class="headerlink" title="code"></a>code</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"><span class="keyword">from</span> DBUtils.PooledDB <span class="keyword">import</span> PooledDB</span><br><span class="line"></span><br><span class="line">MYSQL_HOST = <span class="string">'127.0.0.1'</span></span><br><span class="line">USER = <span class="string">'zabbix'</span></span><br><span class="line">PASSWORD = <span class="string">'p@55w0rd'</span></span><br><span class="line">DB = <span class="string">'zabbix'</span></span><br><span class="line">PORT = <span class="number">3306</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºæ•°æ®åº“è¿æ¥æ± </span></span><br><span class="line">mp = PooledDB(</span><br><span class="line">    pymysql, mincached=<span class="number">5</span>, maxconnections=<span class="number">10</span>, blocking=<span class="literal">True</span>,</span><br><span class="line">    host=MYSQL_HOST, user=USER, passwd=PASSWORD, db=DB, port=PORT, charset=<span class="string">"utf8"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">conn = mp.connection()</span><br><span class="line">cur = conn.cursor()</span><br><span class="line"></span><br><span class="line">sql = <span class="string">"select hostid from hosts where name='xxx';"</span></span><br><span class="line">mysql.cur.execute(sql)</span><br><span class="line"></span><br><span class="line">cur.close()</span><br><span class="line">conn.close()</span><br></pre></td></tr></table></figure>

<h1 id="PooledDBçš„å‚æ•°"><a href="#PooledDBçš„å‚æ•°" class="headerlink" title="PooledDBçš„å‚æ•°"></a>PooledDBçš„å‚æ•°</h1><ul>
<li>mincached: æœ€å°‘çš„ç©ºé—²è¿æ¥æ•°, å¦‚æœç©ºé—²è¿æ¥æ•°å°äºè¿™ä¸ªæ•°, poolä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„è¿æ¥</li>
<li>maxcached: æœ€å¤§çš„ç©ºé—²è¿æ¥æ•°, å¦‚æœç©ºé—²è¿æ¥æ•°å¤§äºè¿™ä¸ªæ•°, poolä¼šå…³é—­ç©ºé—²è¿æ¥</li>
<li>maxconnections: æœ€å¤§çš„è¿æ¥æ•°</li>
<li>blocking: å½“è¿æ¥æ•°è¾¾åˆ°æœ€å¤§çš„è¿æ¥æ•°æ—¶, åœ¨è¯·æ±‚è¿æ¥çš„æ—¶å€™, å¦‚æœè¿™ä¸ªå€¼æ˜¯True, è¯·æ±‚è¿æ¥çš„ç¨‹åºä¼šä¸€ç›´ç­‰å¾…, ç›´åˆ°å½“å‰è¿æ¥æ•°å°äºæœ€å¤§è¿æ¥æ•°, å¦‚æœè¿™ä¸ªå€¼æ˜¯False, ä¼šæŠ¥é”™</li>
</ul>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>pymysql</tag>
        <tag>pool</tag>
      </tags>
  </entry>
  <entry>
    <title>pythonä¸‹http.clientä¸urllibè®¿é—®httpsæŠ¥è¯ä¹¦è®¤è¯å¤±è´¥</title>
    <url>/2018/03/16/python%E4%B8%8Bhttp-client%E4%B8%8Eurllib%E8%AE%BF%E9%97%AEhttps%E6%8A%A5%E8%AF%81%E4%B9%A6%E8%AE%A4%E8%AF%81%E5%A4%B1%E8%B4%A5/</url>
    <content><![CDATA[<p>åœ¨python3ä»£ç ä¸­, ä½¿ç”¨http.clientæˆ–urllib.requestè¿›è¡Œhttpsè®¿é—®çš„æ—¶å€™, å‡ºç°ä»¥ä¸‹æŠ¥é”™</p>
<p><code>ssl.SSLError: [SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed (_ssl.c:777)</code></p>
<p>è§£å†³æ–¹æ³•å¦‚ä¸‹:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import ssl</span><br><span class="line"></span><br><span class="line">ssl._create_default_https_context &#x3D; ssl._create_unverified_context</span><br></pre></td></tr></table></figure>

<p>å†æ¬¡è®¿é—®, å³å¯æ­£å¸¸è®¿é—®httpsç«™ç‚¹</p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>ssl</tag>
        <tag>http.client</tag>
        <tag>urllib.request</tag>
      </tags>
  </entry>
  <entry>
    <title>pythonè¿æ¥mysqlæŠ¥é”™:&#39;latin-1&#39; codec can&#39;t encode characters</title>
    <url>/2018/03/16/python%E8%BF%9E%E6%8E%A5mysql%E6%8A%A5%E9%94%99-latin-1-codec-can-t-encode-characters/</url>
    <content><![CDATA[<blockquote>
<p>pythonè¿æ¥mysqlæ•°æ®åº“è¿›è¡ŒæŸ¥è¯¢æ—¶, é‡åˆ°ä»¥ä¸‹æŠ¥é”™: <code>UnicodeEncodeError: &#39;latin-1&#39; codec can&#39;t encode characters in position 40-41: ordinal not in range(256)</code> å¾ˆæ˜æ˜¾æç¤ºäº†æ˜¯å­—ç¬¦ç¼–ç çš„é—®é¢˜</p>
</blockquote>
<p>å‘ç”Ÿä»¥ä¸Šé—®é¢˜, æ˜¯å› ä¸ºæˆ‘åœ¨sqlè¯­å¥ä¸­å‡ºç°äº†ä¸­æ–‡, åœ¨æ‹¿åˆ°dbæ¸¸æ ‡å¯¹è±¡ä¹‹å, å»æ‰§è¡Œsqlçš„æ—¶å€™çš„æŠ¥é”™</p>
<h1 id="æ’æŸ¥æ•°æ®åº“å­—ç¬¦ç¼–ç "><a href="#æ’æŸ¥æ•°æ®åº“å­—ç¬¦ç¼–ç " class="headerlink" title="æ’æŸ¥æ•°æ®åº“å­—ç¬¦ç¼–ç "></a>æ’æŸ¥æ•°æ®åº“å­—ç¬¦ç¼–ç </h1><p>ç™»å½•MySQLæ•°æ®åº“, æ‰§è¡Œä»¥ä¸‹SQLè¯­å¥æ‰§è¡ŒæŸ¥è¯¢:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; SHOW VARIABLES WHERE Variable_name LIKE 'character\_set\_%' OR Variable_name LIKE 'collation%';</span><br><span class="line">+<span class="comment">--------------------------+--------------------+</span></span><br><span class="line">| Variable_name            | Value              |</span><br><span class="line">+<span class="comment">--------------------------+--------------------+</span></span><br><span class="line">| character_set_client     | utf8mb4            |</span><br><span class="line">| character_set_connection | utf8mb4            |</span><br><span class="line">| character_set_database   | utf8mb4            |</span><br><span class="line">| character_set_filesystem | binary             |</span><br><span class="line">| character_set_results    | utf8mb4            |</span><br><span class="line">| character_set_server     | utf8mb4            |</span><br><span class="line">| character_set_system     | utf8               |</span><br><span class="line">| collation_connection     | utf8mb4_unicode_ci |</span><br><span class="line">| collation_database       | utf8mb4_unicode_ci |</span><br><span class="line">| collation_server         | utf8mb4_unicode_ci |</span><br><span class="line">+<span class="comment">--------------------------+--------------------+</span></span><br><span class="line">10 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<p>ç»è¿‡æŸ¥è¯¢, å‘ç°mysqlæ•°æ®åº“æœ¬èº«å·²æ˜¯ <code>utf8</code> çš„å­—ç¬¦ç¼–ç </p>
<p>åˆ†æå¯èƒ½çš„åŸå› :</p>
<p>mysqlä¸€èˆ¬æœ‰ä¸‰æ®µé…ç½®, åˆ†åˆ«æ˜¯: <code>[mysql]</code> <code>[clinet]</code> <code>[mysqld]</code></p>
<ul>
<li>[mysql] å¯¹å…¶ä»–è¿œç¨‹è¿æ¥çš„mysqlå®¢æˆ·ç«¯çš„é…ç½®, ä¾‹å¦‚åœ¨å…¶ä»–æœåŠ¡å™¨æ‰§è¡Œ<code>mysql -h -u -p</code>æˆ–ä½¿ç”¨ä»£ç è¿›è¡Œè¿æ¥</li>
<li>[client] å¯¹æœ¬åœ°çš„mysqlå®¢æˆ·ç«¯çš„é…ç½®, ä¾‹å¦‚åœ¨æœ¬åœ°æ‰§è¡Œ<code>mysql -u -p</code></li>
<li>[mysqld] å¯¹mysqlæœåŠ¡è¿›è¡Œé…ç½®</li>
</ul>
<p>æœ‰å¯èƒ½mysqlé…ç½®æ–‡ä»¶ä¸­çš„[mysql]ä¸‹æ²¡æœ‰é…ç½® <code>default-character-set = utf8mb4</code>, å¯¼è‡´è¿œç¨‹å®¢æˆ·ç«¯è¿æ¥åˆ°æœåŠ¡å™¨ç«¯å, æ²¡æœ‰è·å¾—æœåŠ¡ç«¯å£°æ˜çš„å­—ç¬¦ç¼–ç , è€Œä½¿ç”¨å®¢æˆ·ç«¯é»˜è®¤å¸¦çš„å­—ç¬¦ç¼–ç è¿›è¡Œè¿æ¥, å¦‚æœæ˜¯è¿™ç§æƒ…å†µ, å¯ä»¥åœ¨mysqlæœåŠ¡ç«¯æ›´æ”¹é…ç½®æ–‡ä»¶å¹¶é‡å¯mysqlæœåŠ¡, å¦‚æœä½ ä¸æƒ³é‡å¯æ•°æ®åº“, å¯ä»¥æ˜¾ç¤ºåœ°åœ¨mysqlå®¢æˆ·ç«¯å£°æ˜ä½¿ç”¨çš„å­—ç¬¦ç¼–ç </p>
<h1 id="è§£å†³pymysqlå­—ç¬¦ç¼–ç é—®é¢˜"><a href="#è§£å†³pymysqlå­—ç¬¦ç¼–ç é—®é¢˜" class="headerlink" title="è§£å†³pymysqlå­—ç¬¦ç¼–ç é—®é¢˜"></a>è§£å†³pymysqlå­—ç¬¦ç¼–ç é—®é¢˜</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"></span><br><span class="line">db = pymysql.connect(<span class="string">"localhost"</span>,<span class="string">"root"</span>,<span class="string">"123"</span>,<span class="string">"mysql"</span>, charset=<span class="string">"utf8"</span>)</span><br><span class="line">cursor = db.cursor()</span><br><span class="line"></span><br><span class="line">sql = <span class="string">"select Host, User from user where User='ä¸­æ–‡';"</span></span><br><span class="line">cursor.execute(sql)</span><br></pre></td></tr></table></figure>

<p>è§£å†³æ–¹æ³•å¾ˆç®€å•, åªéœ€è¦åœ¨åˆ›å»ºæ•°æ®åº“è¿æ¥å¯¹è±¡çš„æ—¶å€™, æ˜¾ç¤ºåœ°å£°æ˜å­—ç¬¦ç¼–ç å°±å¯ä»¥äº† <code>charset=&quot;utf8&quot;</code></p>
<p>æ³¨æ„: å¦‚æœä½ çš„MySQLæœåŠ¡å™¨çš„å­—ç¬¦ç¼–ç ä½¿ç”¨çš„æ˜¯<code>utf-8</code> çš„è¯, ä½ éœ€è¦å£°æ˜ä½ çš„è¿æ¥å¯¹è±¡çš„å­—ç¬¦ç¼–ç ä¹Ÿæ˜¯ <code>utf-8</code></p>
<p>å¦‚æœä½ çš„MySQLæœåŠ¡å™¨çš„å­—ç¬¦ç¼–ç ä½¿ç”¨çš„æ˜¯<code>utf8mb4</code> çš„è¯, ç›¸å¯¹åº”çš„, ä½ åº”è¯¥å£°æ˜è‡ªå·±å®¢æˆ·ç«¯çš„å­—ç¬¦ç¼–ç æ˜¯ <code>utf8mb4</code></p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>pymysql</tag>
      </tags>
  </entry>
  <entry>
    <title>heartbeat-elasticæŠ¥é”™:system_api_version [6] is not supported by system_id [beats]</title>
    <url>/2018/02/11/heartbeat-elastic%E6%8A%A5%E9%94%99-system-api-version-6-is-not-supported-by-system-id-beats/</url>
    <content><![CDATA[<blockquote>
<p>é…ç½®heartbeat-elasticæœåŠ¡æ—¶æ—¥å¿—æŠ¥é”™å¦‚ä¸‹<code>2018-02-11T07:36:29.217-0500    ERROR   pipeline/output.go:92   Failed to publish events: 400 Bad Request: {&quot;error&quot;:{&quot;root_cause&quot;:[{&quot;type&quot;:&quot;illegal_argument_exception&quot;,&quot;reason&quot;:&quot;system_api_version [6] is not supported by system_id [beats]&quot;}],&quot;type&quot;:&quot;illegal_argument_exception&quot;,&quot;reason&quot;:&quot;system_api_version [6] is not supported by system_id [beats]&quot;},&quot;status&quot;:400}</code></p>
</blockquote>
<p>è§£å†³æ–¹æ³•:</p>
<p>æ‰‹åŠ¨è®¾ç½®<code>/etc/heartbeat/heartbeat.yml</code> é…ç½®æ–‡ä»¶ä¸­çš„ <code>name</code>å˜é‡ <code>name: 10.10.62.16</code> </p>
<p>é‡å¯<code>heartbeat-elastic</code>æœåŠ¡å³å¯</p>
<p><code>systemctl restart heartbeat-elastic.service</code></p>
]]></content>
      <categories>
        <category>ELK Stack</category>
      </categories>
      <tags>
        <tag>elasticsearch</tag>
        <tag>heartbeat-elastic</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonå®ç°redisçš„è‡ªå¢æ“ä½œ</title>
    <url>/2018/01/29/Python%E5%AE%9E%E7%8E%B0redis%E7%9A%84%E8%87%AA%E5%A2%9E%E6%93%8D%E4%BD%9C/</url>
    <content><![CDATA[<blockquote>
<p>åœ¨ä¼ ç»Ÿçš„æ•°æ®åº“ä¸­, å¦‚æœå®ç°ä¸€ä¸ªè®¡æ•°å™¨çš„æ“ä½œ, éœ€è¦å…ˆå»æ•°æ®åº“ä¸­è¯»å–è¯¥å€¼, å†ç¨‹åºä¸­åŠ 1, å†è®²æœ€æ–°çš„å€¼å­˜å…¥æ•°æ®åº“. ç”¨æˆ·æ“ä½œçš„æµç¨‹æ­¥éª¤å¤šä¸è¯´, è¿˜å®¹æ˜“å‡ºç°æ•°æ®å®‰å…¨æ€§çš„é—®é¢˜, æ¯”å¦‚å¤šè¿›ç¨‹/å¤šçº¿ç¨‹çš„å¹¶å‘æƒ…å†µ, æœ‰å¯èƒ½å‡ºç°Aè¿›ç¨‹è¯»å–çš„è®¡æ•°å™¨ä¸º5, åœ¨æœ¬åœ°æ‰§è¡Œ+1, æ“ä½œçš„æ—¶å€™, æ­¤æ—¶Bè¿›ç¨‹ä¹Ÿå»æ‰§è¡Œè®¡æ•°å™¨+1æ“ä½œ, Bè¯»å–çš„æ•°å€¼ä¹Ÿæ˜¯5, ç„¶åAå°†+1ä¹‹åçš„æ•°å­—6å­˜å…¥æ•°æ®åº“, ä¹‹åBå¤„ç†å®Œåä¹Ÿå°†+1ä¹‹åçš„6å­˜å…¥æ•°æ®åº“, è¿™æ ·å°±å¯¼è‡´äº†åœ¨å¹¶å‘çš„æƒ…å†µä¸‹, è®¡æ•°å™¨çš„æ•°æ®ä¸å‡†çš„æƒ…å†µ.</p>
</blockquote>
<p>Redisçš„å¾ˆå¤šæ“ä½œæœ¬èº«éƒ½æ˜¯åŸå­æ€§çš„, ä¾‹å¦‚ä¸Šé¢æ¡ˆä¾‹ä¸­, è®¡æ•°å™¨+1çš„é—®é¢˜, ä¼šæœ‰ä¸‰ä¸ªæ­¥éª¤</p>
<ul>
<li>è¯»å–æ•°å€¼</li>
<li>è‡ªå¢æ“ä½œ</li>
<li>å†™å…¥æ•°å€¼</li>
</ul>
<p>åœ¨ä¼ ç»Ÿæ•°æ®åº“ä¸­, ä¸ºäº†ä¿è¯æ•°æ®çš„å®‰å…¨æ€§, è¿™ä¸‰ä¸ªæ­¥éª¤é€šå¸¸æ˜¯è¦åŠ é”çš„, ä¹Ÿå°±æ˜¯åœ¨æ­¥éª¤å·²ç»å¾ˆå¤šçš„æƒ…å†µä¸‹, è¿˜éœ€è¦è€ƒè™‘é”çš„é—®é¢˜. ä½†æ˜¯Rediså°±ä¸åŒäº†, RedisåŸå­æ€§çš„æ„æ€å°±æ˜¯è¯´, å¯ä»¥ä¿è¯ä¸Šé¢çš„ä¸‰ä¸ªæ­¥éª¤æ˜¯ä¸€ä¸ªæ“ä½œ, åœ¨è¿™ä¸ªæ“ä½œå®Œæˆä¹‹åæ‰å…è®¸æˆ‘ä»¬å¯¹å…¶è¿›è¡Œå…¶ä»–æ“ä½œ, è¿™å°±åŸç”Ÿçš„ä¿è¯äº†æ•°æ®å®‰å…¨æ€§</p>
<h1 id="redisä¸­çš„è‡ªå¢"><a href="#redisä¸­çš„è‡ªå¢" class="headerlink" title="redisä¸­çš„è‡ªå¢"></a>redisä¸­çš„è‡ªå¢</h1><p>åœ¨redisä¸­, å¦‚æœä¸€ä¸ªkeyçš„valueæ˜¯æ•°å€¼ç±»å‹, æˆ‘ä»¬å°±å¯ä»¥å¯¹è¿™ä¸ªå€¼è¿›è¡Œincræ“ä½œ, å¦‚æœæ•°å€¼æ˜¯æ•´å½¢int, ä½¿ç”¨incrè¿›è¡Œè‡ªå¢æ“ä½œ, å¦‚æœæ•°å€¼æ˜¯æµ®ç‚¹å‹float, åˆ™éœ€è¦ä½¿ç”¨incrbyfloatè¿›è¡Œæ“ä½œ, è¿˜æœ‰ä¸€ç§æƒ…å†µ, å°±æ˜¯å¯¹intä½¿ç”¨äº†incrbyfloatæ“ä½œ, åˆ™è¿™ä¸ªæ•°å€¼å°±ä¼šå˜æˆfloatç±»å‹, ä¹Ÿå°±æ— æ³•å†å¯¹å…¶æ‰§è¡Œincræ“ä½œäº†</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">1</span>]: <span class="keyword">import</span> redis</span><br><span class="line"></span><br><span class="line">In [<span class="number">2</span>]: pool=redis.ConnectionPool(host=<span class="string">'127.0.0.1'</span>,port=<span class="number">6379</span>,db=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">3</span>]: r = redis.StrictRedis(connection_pool=pool)</span><br><span class="line"></span><br><span class="line">In [<span class="number">4</span>]: r.keys()</span><br><span class="line">Out[<span class="number">4</span>]: []</span><br><span class="line"></span><br><span class="line">In [<span class="number">5</span>]: r.incr(<span class="string">'counter'</span>)</span><br><span class="line">Out[<span class="number">5</span>]: <span class="number">1</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">6</span>]: r.incr(<span class="string">'counter'</span>)</span><br><span class="line">Out[<span class="number">6</span>]: <span class="number">2</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">7</span>]: r.incr(<span class="string">'counter'</span>)</span><br><span class="line">Out[<span class="number">7</span>]: <span class="number">3</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">8</span>]: r.incr(<span class="string">'counter'</span>, <span class="number">2</span>)</span><br><span class="line">Out[<span class="number">8</span>]: <span class="number">5</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">9</span>]: r.keys()</span><br><span class="line">Out[<span class="number">9</span>]: [<span class="string">b'counter'</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">10</span>]: r.get(<span class="string">'counter'</span>)</span><br><span class="line">Out[<span class="number">10</span>]: <span class="string">b'5'</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">11</span>]: r.incrbyfloat(<span class="string">'counter'</span>)</span><br><span class="line">Out[<span class="number">11</span>]: <span class="number">6.0</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">12</span>]: r.incrbyfloat(<span class="string">'counter'</span>)</span><br><span class="line">Out[<span class="number">12</span>]: <span class="number">7.0</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">13</span>]: r.incrbyfloat(<span class="string">'counter'</span>, <span class="number">0.1</span>)</span><br><span class="line">Out[<span class="number">13</span>]: <span class="number">7.1</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">14</span>]: r.incrbyfloat(<span class="string">'counter'</span>, <span class="number">0.1</span>)</span><br><span class="line">Out[<span class="number">14</span>]: <span class="number">7.2</span></span><br></pre></td></tr></table></figure>

<h1 id="redisä¸­çš„è‡ªå‡"><a href="#redisä¸­çš„è‡ªå‡" class="headerlink" title="redisä¸­çš„è‡ªå‡"></a>redisä¸­çš„è‡ªå‡</h1><p>redisä¸­ä½¿ç”¨decrå‡½æ•°è¿›è¡Œè‡ªå‡æ“ä½œ, ä½†æ˜¯è‡ªå‡ä¸­, æ²¡æœ‰æä¾›ç±»ä¼¼incrbyfloatçš„æ“ä½œ, å¦‚æœåœ¨è‡ªå‡ä¸­æƒ³å®ç°æµ®ç‚¹æ•°çš„æ•ˆæœ, å¯ä»¥é€šè¿‡åœ¨incrbyfloatå‡½æ•°ä¸­ä½¿ç”¨è´Ÿæ•°çš„æ–¹å¼å®ç°</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">19</span>]: r.keys()</span><br><span class="line">Out[<span class="number">19</span>]: []</span><br><span class="line"></span><br><span class="line">In [<span class="number">20</span>]: r.incr(<span class="string">'counter'</span>)</span><br><span class="line">Out[<span class="number">20</span>]: <span class="number">1</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">21</span>]: r.decr(<span class="string">'counter'</span>)</span><br><span class="line">Out[<span class="number">21</span>]: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">22</span>]: r.incrbyfloat(<span class="string">'counter'</span>, <span class="number">-1.1</span>)</span><br><span class="line">Out[<span class="number">22</span>]: <span class="number">-1.1</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">23</span>]: r.incrbyfloat(<span class="string">'counter'</span>, <span class="number">-1.1</span>)</span><br><span class="line">Out[<span class="number">23</span>]: <span class="number">-2.2</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>redis</tag>
      </tags>
  </entry>
  <entry>
    <title>nginxåˆ‡å‰²æ—¥å¿—æ–‡ä»¶</title>
    <url>/2018/01/26/inx%E5%88%87%E5%89%B2%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6/</url>
    <content><![CDATA[<p>ä¸çŸ¥é“è¿™ä¹ˆåŸºç¡€çš„åŠŸèƒ½, ä¸ºä»€ä¹ˆNginxå®˜æ–¹æ²¡æœ‰æä¾›é…ç½®~</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#è®¾ç½®æ—¥å¿—æ–‡ä»¶å­˜æ”¾ç›®å½•</span></span><br><span class="line">logs_path=<span class="string">"/data/logs/nginx/"</span></span><br><span class="line"><span class="comment">#è®¾ç½®pidæ–‡ä»¶</span></span><br><span class="line">pid_path=<span class="string">"/usr/local/openresty/nginx/logs/nginx.pid"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#é‡å‘½åæ—¥å¿—æ–‡ä»¶</span></span><br><span class="line">mv <span class="variable">$&#123;logs_path&#125;</span>access.log <span class="variable">$&#123;logs_path&#125;</span>access_$(date -d <span class="string">"yesterday"</span> +<span class="string">"%Y%m%d"</span>).<span class="built_in">log</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å‘nginxä¸»è¿›ç¨‹å‘ä¿¡å·é‡æ–°æ‰“å¼€æ—¥å¿—</span></span><br><span class="line"><span class="built_in">kill</span> -USR1 `cat <span class="variable">$&#123;pid_path&#125;</span>`</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šæ–‡ä»¶åä¸ºå¹´æœˆæ—¥å½¢å¼, å†™æˆè„šæœ¬ä¿å­˜, ç„¶ååŠ å…¥åˆ°è®¡åˆ’ä»»åŠ¡é‡Œæ¯å¤©æ‰§è¡Œå°±å¯ä»¥äº†</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt; crontab -l</span><br><span class="line">0 0  *  *  * &#x2F;bin&#x2F;bash &#x2F;data&#x2F;scripts&#x2F;nginx_log_cut.sh &gt;&#x2F;dev&#x2F;null 2&gt;&amp;1</span><br></pre></td></tr></table></figure>]]></content>
      <tags>
        <tag>nginx</tag>
      </tags>
  </entry>
  <entry>
    <title>json.dumpsä¸­çš„ensure_asciiå‚æ•°</title>
    <url>/2018/01/25/json-dumps%E4%B8%AD%E7%9A%84ensure-ascii%E5%8F%82%E6%95%B0/</url>
    <content><![CDATA[<blockquote>
<p>json dump ä¸­æ–‡æ—¶é‡åˆ°çš„é—®é¢˜å¦‚ä¸‹</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> json</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">"Chinese"</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> json.dumps(s)</span><br><span class="line"><span class="string">"Chinese"</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> json</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">"ä¸­æ–‡"</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> json.dumps(s)</span><br><span class="line"><span class="string">"\u4e2d\u6587"</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°, jsonåœ¨dumpä¸­æ–‡çš„æ—¶å€™, è¾“å‡ºçš„æ˜¯â€ä¸­æ–‡â€å¯¹åº”çš„asciiç , è¿™æ˜¯å› ä¸ºjson.dumps åºåˆ—åŒ–æ—¶å¯¹ä¸­æ–‡é»˜è®¤ä½¿ç”¨çš„asciiç¼–ç </p>
<p>å¦‚æœéœ€è¦è¾“å‡ºçœŸæ­£çš„ä¸­æ–‡å­—ç¬¦, éœ€è¦åœ¨dumpçš„æ—¶å€™åŠ å…¥<code>ensure_ascii=False</code>å‚æ•°</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> json</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">"ä¸­æ–‡"</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> json.dumps(s, ensure_ascii=<span class="literal">False</span>)</span><br><span class="line"><span class="string">"ä¸­æ–‡"</span></span><br></pre></td></tr></table></figure>

<p>å®é™…ä½¿ç”¨ä¸­, åœ¨ä¸å¾®ä¿¡ä¼ä¸šä¼ä¸šå·çš„ä¸»åŠ¨å‘é€æ¶ˆæ¯æ¥å£äº¤äº’æ—¶, éœ€è¦ä½¿ç”¨utf8å­—ç¬¦ç¼–ç encode</p>
<p>æ‰€ä»¥åœ¨è¿™ä¸ªåœºæ™¯ä¸‹, å†™æ³•å¯èƒ½ä¼šæ˜¯ä¸‹é¢è¿™ç§æƒ…å†µ</p>
<p><code>json.dumps(s, ensure_ascii=False).encode(&#39;utf-8&#39;)</code></p>
<p>Python3: æ³¨æ„ä»¥ä¸‹æ“ä½œåªåœ¨Python3ç¯å¢ƒä¸‹æ˜¯æ­£ç¡®çš„, Python2çš„ç¯å¢ƒä¸‹.encodeä¼šæŠ¥é”™</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">âœ  ~ python3</span><br><span class="line">Python <span class="number">3.6</span><span class="number">.3</span> (v3<span class="number">.6</span><span class="number">.3</span>:<span class="number">2</span>c5fed86e0, Oct  <span class="number">3</span> <span class="number">2017</span>, <span class="number">00</span>:<span class="number">32</span>:<span class="number">08</span>)</span><br><span class="line">[GCC <span class="number">4.2</span><span class="number">.1</span> (Apple Inc. build <span class="number">5666</span>) (dot <span class="number">3</span>)] on darwin</span><br><span class="line">Type <span class="string">"help"</span>, <span class="string">"copyright"</span>, <span class="string">"credits"</span> <span class="keyword">or</span> <span class="string">"license"</span> <span class="keyword">for</span> more information.</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> json</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">"ä¸­æ–‡"</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>json.dumps(s, ensure_ascii=<span class="literal">False</span>)</span><br><span class="line"><span class="string">'"ä¸­æ–‡"'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>json.dumps(s, ensure_ascii=<span class="literal">False</span>).encode(<span class="string">'utf8'</span>)</span><br><span class="line"><span class="string">b'"\xe4\xb8\xad\xe6\x96\x87"'</span></span><br></pre></td></tr></table></figure>


]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>å­—ç¬¦ç¼–ç </tag>
        <tag>json</tag>
      </tags>
  </entry>
  <entry>
    <title>Input strings must be a multiple of 16 in length</title>
    <url>/2018/01/25/nput-strings-must-be-a-multiple-of-16-in-length/</url>
    <content><![CDATA[<p>åœ¨å®ç°å¾®ä¿¡ä¼ä¸šå·è‡ªå»ºåº”ç”¨ä¸è‡ªç”±æœåŠ¡å™¨ä¿¡æ¯äº¤äº’çš„æ—¶å€™, æŠ¥äº† <code>Input strings must be a multiple of 16 in length</code> è¿™ä¸ªé”™è¯¯, å›å¤å…¨éƒ¨è‹±æ–‡å†…å®¹ç»™å¾®ä¿¡çš„æ—¶å€™æ˜¯æ­£å¸¸çš„.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">sRespData = <span class="string">"""&lt;xml&gt;</span></span><br><span class="line"><span class="string">                &lt;ToUserName&gt;&lt;![CDATA["""</span>+user_id+<span class="string">"""]]&gt;&lt;/ToUserName&gt;</span></span><br><span class="line"><span class="string">                &lt;FromUserName&gt;&lt;![CDATA["""</span>+corp_id+<span class="string">"""]]&gt;&lt;/FromUserName&gt;</span></span><br><span class="line"><span class="string">                &lt;CreateTime&gt;"""</span>+create_time+<span class="string">"""&lt;/CreateTime&gt;</span></span><br><span class="line"><span class="string">                &lt;MsgType&gt;&lt;![CDATA[text]]&gt;&lt;/MsgType&gt;</span></span><br><span class="line"><span class="string">                &lt;Content&gt;&lt;![CDATA["""</span>+content+<span class="string">"""]]&gt;&lt;/Content&gt;</span></span><br><span class="line"><span class="string">                &lt;/xml&gt;"""</span></span><br></pre></td></tr></table></figure>

<p>å¦‚ä»¥ä¸Šå³å°†å›å¤ç»™å¾®ä¿¡çš„xmlä¿¡æ¯, contentå˜é‡å°±æ˜¯å®é™…çš„æ¶ˆæ¯å†…å®¹, å½“contentå†…å®¹å‡ºç°ä¸­æ–‡å­—ç¬¦æ—¶, å°±ä¼šæŠ¥ä»¥ä¸Šé”™è¯¯.</p>
<p>è§£å†³æ–¹æ³•:</p>
<p><code>content = content.encode(&#39;utf-8&#39;)</code></p>
<p>å°†contentçš„å†…å®¹ä»¥utf8å­—ç¬¦ç¼–ç è¿›è¡Œencodeå³å¯</p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>å­—ç¬¦ç¼–ç </tag>
        <tag>ä¼ä¸šå¾®ä¿¡</tag>
      </tags>
  </entry>
  <entry>
    <title>import httplib ImportError: No module named httplib</title>
    <url>/2018/01/25/import-httplib-ImportError-No-module-named-httplib/</url>
    <content><![CDATA[<p>åœ¨Python2çš„ä»£ç ä¸­<code>import httplib</code>æ˜¯æ²¡æœ‰é—®é¢˜çš„, åˆ°äº†Python3, è¿™ä¸ªæ¨¡å—çš„å¯¼å…¥åç§°å˜æˆäº†<code>http.client</code>, æ‰€ä»¥åœ¨å¦‚æœä½ ä½¿ç”¨çš„æ˜¯Python3, éœ€è¦å¯¼å…¥è¿™ä¸ªæ¨¡å—, <code>import http.client</code>å°±å¯ä»¥äº†</p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>module</tag>
      </tags>
  </entry>
  <entry>
    <title>Python2çš„ä¸­æ–‡å­—ç¬¦ç¼–ç æŠ¥é”™</title>
    <url>/2018/01/25/Python2%E7%9A%84%E4%B8%AD%E6%96%87%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81%E6%8A%A5%E9%94%99/</url>
    <content><![CDATA[<p>åœ¨Python2ä¸­, åœ¨é¦–è¡Œå£°æ˜äº†å­—ç¬¦ç¼–ç ä¸º<code>utf8</code>, ä½†æ˜¯ä¾ç„¶æŠ¥é”™</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">UnicodeDecodeError: &#39;ascii&#39; codec can&#39;t decode byte 0xe6 in position 0: ordinal not in range(128)</span><br></pre></td></tr></table></figure>

<p>è§£å†³æ–¹æ³•å¦‚ä¸‹:</p>
<p>åœ¨æŠ¥é”™çš„pythonæ–‡ä»¶ä¸­åŠ å…¥ä»¥ä¸‹å‡ è¡Œä»£ç </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">reload(sys)</span><br><span class="line">sys.setdefaultencoding(<span class="string">'utf8'</span>)</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>å­—ç¬¦ç¼–ç </tag>
      </tags>
  </entry>
  <entry>
    <title>apt-get installæŠ¥é”™</title>
    <url>/2018/01/25/apt-get-install%E6%8A%A5%E9%94%99/</url>
    <content><![CDATA[<blockquote>
<p>åœ¨ä¸€å°Ubuntuå®‰è£…è½¯ä»¶çš„æ—¶å€™å‘ç°, å®‰è£…ä»»ä½•è½¯ä»¶éƒ½ä¼šæŠ¥ä¸€ä¸ªç±»ä¼¼<code>Errors were encountered while processing</code> <code>Sub-process /usr/bin/dpkg returned an error code</code>çš„é”™è¯¯, å°è¯•è§£å†³æ–¹å¼å¦‚ä¸‹</p>
</blockquote>
<p>æ¸…ç©º/var/lib/dpkg/infoç›®å½•ä¸‹é¢çš„å†…å®¹å³å¯</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>apt</tag>
      </tags>
  </entry>
  <entry>
    <title>grep: warning: GREP_OPTIONS is deprecated</title>
    <url>/2018/01/25/grep-warning-GREP-OPTIONS-is-deprecated/</url>
    <content><![CDATA[<blockquote>
<p>åŸå› æ˜¯åœ¨ä½ çš„é…ç½®æ–‡ä»¶ä¸­(æˆ‘çš„æ˜¯CentOS7, /etc/profile)å‡ºç°äº†ä»¥ä¸‹é…ç½®å¯¼è‡´çš„: <code>export GREP_OPTIONS=--color=auto</code></p>
</blockquote>
<p>è§£å†³æ–¹æ³•ä¹Ÿå¾ˆç®€å•, é¦–å…ˆåœ¨<code>/etc/profile</code>ä¸­æ³¨é‡Šè¯¥è¡Œ</p>
<p><code># export GREP_OPTIONS=--color=auto</code></p>
<p>ç„¶ååœ¨terminalç•Œé¢æ‰§è¡Œ<code>unset GREP_OPTIONS</code></p>
<p>å†æ¬¡æ‰§è¡Œgrepæ“ä½œ, å°±ä¸ä¼šæœ‰æ¼äººçš„Warningå‡ºç°å•¦~</p>
<p>é™„å½•: æœ‰å¯èƒ½å½±å“åˆ°grepçš„è¿™ä¸€è¡Œexporté…ç½®å¹¶ä¸åœ¨ä½ çš„<code>/etc/profile</code>æ–‡ä»¶ä¸‹,ä½ å¯ä»¥å°è¯•å»<code>~/.bashrc</code> <code>~/.bashprofile</code> <code>~/.zshrc</code>ç­‰æ–‡ä»¶ä¸­æŸ¥æ‰¾</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>grep</tag>
      </tags>
  </entry>
  <entry>
    <title>Zabbix agent is unreachable for 5 minutes</title>
    <url>/2018/01/25/Zabbix-agent-is-unreachable-for-5-minutes/</url>
    <content><![CDATA[<blockquote>
<p>æœ€è¿‘å…¥åˆ°äº† <code>Zabbix agent on HOSTNAME is unreachable for 5 minutes</code> çš„é—®é¢˜, ä½†å®é™…serveråˆ°agentçš„ç½‘ç»œé€šä¿¡æ˜¯æ²¡æœ‰ä»»ä½•é—®é¢˜çš„, è¿™ç§æƒ…å†µä¸‹, æˆ‘ä»¬éœ€è¦ç™»å½•åˆ°agentè¿™å°ä¸»æœº, æŸ¥çœ‹<code>zabbix_agent</code>çš„æ—¥å¿—æ¥æ’æŸ¥é”™è¯¯</p>
</blockquote>
<h1 id="æŸ¥çœ‹zabbix-agentçš„å¯åŠ¨è¿›ç¨‹"><a href="#æŸ¥çœ‹zabbix-agentçš„å¯åŠ¨è¿›ç¨‹" class="headerlink" title="æŸ¥çœ‹zabbix_agentçš„å¯åŠ¨è¿›ç¨‹"></a>æŸ¥çœ‹zabbix_agentçš„å¯åŠ¨è¿›ç¨‹</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; ps aux | grep <span class="string">"zabbix"</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœæ˜¯ç¼–è¯‘å®‰è£…çš„agent, æ‰‹åŠ¨æŒ‡å®šé…ç½®æ–‡ä»¶å¯åŠ¨çš„è¿›ç¨‹, åœ¨è¿™é‡Œä½ å¯ä»¥çœ‹åˆ°ä½ å¼•ç”¨çš„é…ç½®æ–‡ä»¶çš„åœ°å€</p>
<h1 id="æŸ¥çœ‹é…ç½®æ–‡ä»¶"><a href="#æŸ¥çœ‹é…ç½®æ–‡ä»¶" class="headerlink" title="æŸ¥çœ‹é…ç½®æ–‡ä»¶"></a>æŸ¥çœ‹é…ç½®æ–‡ä»¶</h1><p>åœ¨é…ç½®æ–‡ä»¶ä¸­ä½ éœ€è¦æŸ¥çœ‹çš„æ˜¯è®°å½•æ—¥å¿—çš„ä½ç½®</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">LogFile=/var/<span class="built_in">log</span>/zabbix/zabbix_agentd.log</span><br></pre></td></tr></table></figure>

<h1 id="æŸ¥çœ‹æ—¥å¿—æŠ¥é”™"><a href="#æŸ¥çœ‹æ—¥å¿—æŠ¥é”™" class="headerlink" title="æŸ¥çœ‹æ—¥å¿—æŠ¥é”™"></a>æŸ¥çœ‹æ—¥å¿—æŠ¥é”™</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; tail -f /var/<span class="built_in">log</span>/zabbix/zabbix_agentd.log</span><br></pre></td></tr></table></figure>

<p>åœ¨æˆ‘è¿™é‡Œçš„å®é™…æƒ…å†µä¸­, å‡ºç°äº†ä»¥ä¸‹æŠ¥é”™ä¿¡æ¯:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">25863:20180116:103949.621 failed to accept an incoming connection: connection from &quot;192.168.10.85&quot; rejected, allowed hosts: &quot;zabbix_server.lvrui.io&quot;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å‡ ä¸ªå…³é”®å­—çœ¼</p>
<ul>
<li>reject: è¯´æ˜å®¢æˆ·ç«¯æ‹’ç»äº†æœåŠ¡ç«¯çš„è¯·æ±‚</li>
<li>allowed hosts: å…è®¸è®¿é—®å®¢æˆ·ç«¯çš„æœåŠ¡ç«¯åœ°å€</li>
</ul>
<p>é€šè¿‡ä»¥ä¸Šå…³é”®å­—å¯ä»¥åˆ¤æ–­å‡º, å®¢æˆ·ç«¯è®¤åˆ°çš„serverçš„å®é™…IPåœ°å€æ˜¯<code>192.168.10.85</code>, ä½†æ˜¯å®¢æˆ·ç«¯é…ç½®çš„serveråœ°å€å´æ˜¯<code>zabbix_server.lvrui.io</code>, å®¢æˆ·ç«¯ä¸èƒ½åè§£æå‡ºè¿™ä¸ªIPåœ°å€å¯¹åº”çš„åŸŸå, æ‰€ä»¥æ‹’ç»äº†serverçš„è¯·æ±‚</p>
<p>æœ€ç®€å•çš„è§£å†³æ–¹æ³•å°±æ˜¯å°†zabbix_agenté…ç½®æ–‡ä»¶ä¸­çš„<code>Server</code> <code>ServerActive</code>çš„é…ç½®éƒ½æ”¹æˆ <code>192.168.10.85</code> å³å¯</p>
<p>ç¬¬äºŒä¸ªåŠæ³•, ä½ è¦æ˜¯éè¦ç”¨åŸŸåçš„è¯, ä½ å¯ä»¥å°†ç›‘æ§æ¨¡å¼æ”¹ä¸ºä¸»åŠ¨æ¨¡å¼, ä¸»åŠ¨å»æœåŠ¡ç«¯æ¨é€æ•°æ®</p>
<p>ç¬¬ä¸‰ä¸ªåŠæ³•, æ˜¯ä½ éœ€è¦åœ¨ä½ çš„ç½‘ç»œç¯å¢ƒä¸­, é…ç½®å¯¹åº”zabbix_serverçš„åå‘è§£æ</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>zabbix</tag>
      </tags>
  </entry>
  <entry>
    <title>2017å¹´ç»ˆæ€»ç»“:äº”å­è¿ç </title>
    <url>/2017/12/29/2017%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93-%E4%BA%94%E5%AD%90%E8%BF%9E%E7%8F%A0/</url>
    <content><![CDATA[<p>â€‹        å¾ˆå¤šå¹´å‰çš„ä¸€ä¸ªâ€ä¹ æƒ¯â€, åˆ°äº†å¹´æœ«çš„æ—¶å€™, å–œæ¬¢æ„Ÿæ…¨ä¸€ç•ª, å›é¡¾è¿™ä¸€å¹´çš„é£é£é›¨é›¨, å±•æœ›ä¸€ä¸‹ç¾å¥½çš„æ˜å¹´~ æ­£å¦‚å¼€é¢˜æ‰€è¯´, è¿™æ˜¯å¾ˆå¤šå¹´å‰çš„ä¸€ä¸ªä¹ æƒ¯äº†, æˆ‘å·²ç»å¾ˆå¤šå¹´, éƒ½ä¸è®°å¾—æœ‰å¤šå°‘å¹´æ²¡æœ‰å†™è¿‡â€å¹´ç»ˆæ€»ç»“â€äº†, ä»Šå¤©, ç°åœ¨, æ˜¯2017å¹´çš„æœ€åä¸€ä¸ªå·¥ä½œæ—¥(2017å¹´12æœˆ29å·)çš„å‡Œæ™¨0ç‚¹è¿‡5åˆ†, æˆ‘å†™ä¸‹è¿™ç¯‡2017çš„å¹´ç»ˆæ€»ç»“, å¸Œæœ›è¿™æ˜¯ä¸ªç¾å¥½çš„å¼€ç«¯, å°†ä¹…è¿çš„ä¹ æƒ¯, å†æ‰¾å›æ¥.</p>
<p>â€‹        2017å¹´çš„å¹´ç»ˆæ€»ç»“ä¸ºä»€ä¹ˆæ˜¯<code>äº”å­è¿ç </code>å‘¢? ä¸‹è¿‡äº”å­æ£‹çš„ç­’å­ä»¬è‚¯å®šçŸ¥é“, äº”å­è¿ç æ˜¯äº”å­æ£‹çš„èµ¢æ³•, ä»Šå¹´çš„æ€»ç»“æµ“ç¼©ä¸º<code>äº”å­è¿ç </code>å†åˆé€‚ä¸è¿‡äº†. ä¸ä»…ä»…æ„å‘³ç€ä»Šå¹´å¯¹è‡ªå·±æ¥è¯´æ˜¯ä¸ªâ€èƒœåˆ©â€ä¹‹å¹´, è€Œä¸”çœŸçš„æœ‰<code>äº”å­</code>å–œäº‹, ä¸”å¬æˆ‘ä¸€ä¸€é“æ¥~</p>
<p>â€‹        <code>ä¸€å­:ç¥¨å­</code> å¾ˆä¹…ä»¥å‰, åœ¨ç¤¾äº¤å¹³å°æˆ‘å†™è¿‡ä¸€ä¸ªä¸ªäººè‡ªè¯„: â€œæ²¡é’±æ²¡æˆ¿æ²¡è‚¡ä»½â€çš„ä¸‰æ— äººå‘˜â€¦. æœ‰é’±! æ˜¯ä¸ªå¾ˆæ¨¡ç³Šçš„å®šä¹‰, å¯¹äºé£Ÿä¸æœè…¹çš„äººæ¥è¯´, æ¸©é¥±å°±æ˜¯æœ‰é’±. è€Œæˆ‘ä»Šå¤©è¯´çš„â€ç¥¨å­â€, æ˜¯æˆ‘å·¥ä½œä»¥æ¥çš„ç¬¬ä¸€ä»½å…¼èŒæ”¶å…¥! ä»Šå¹´å¹´åˆçš„æ—¶å€™, éš‹å“¥æ‰¾åˆ°æˆ‘, ç»™æˆ‘æä¾›äº†ä¸€ä»½å…¼èŒå·¥ä½œ, æ˜¯æˆ‘ä¹‹å‰æ•¢æƒ³è€Œä¸æ•¢å¹²çš„ä¸€ä¸ªèŒä¸š:<code>è®²å¸ˆ</code>. è®²ä»€ä¹ˆå‘¢? è®²å½“ä¸‹æœ€æµè¡Œçš„è¿›ç¨‹è™šæ‹ŸåŒ–æŠ€æœ¯<code>Docker</code> Docker è¿™é¡¹æŠ€æœ¯å½“æ—¶åœ¨å…¬å¸ç¡®å®æœ‰è½åœ°, ç”Ÿäº§ç¯å¢ƒå°±åœ¨è·‘, è€Œä¸”æœŸé—´ä¹Ÿè¶Ÿäº†ä¸å°‘é›·, å¯¹äºè¿™é¡¹æŠ€æœ¯åœ¨ç”Ÿäº§ç¯å¢ƒçš„è½åœ°, å…¶å®æˆ‘è¿˜æ˜¯æœ‰æ•…äº‹è®²çš„. ä½†æ˜¯æˆ‘é¢å¯¹çš„å¯¹è±¡ä¸æ˜¯ Docker æŠ€æœ¯çš„ä½¿ç”¨è€…, ç­‰å¾… Docker æŠ€æœ¯è½åœ°çš„æŠ€æœ¯äººå‘˜, è€Œæ˜¯åˆšåˆšæ¥è§¦ Linux è¿ç»´é¢†åŸŸçš„åˆå­¦è€…. å¯¹äºåˆå­¦è€…æ¥è¯´, æ¥å—ä¸€ä¸ªè¿›ç¨‹è™šæ‹ŸåŒ–æŠ€æœ¯å…¶å®å¹¶ä¸å®¹æ˜“. å› ä¸ºåœ¨ Linux åŸ¹è®­ä¸­, éƒ½æ˜¯ä»¥ç‰©ç†æœºçš„è§’åº¦å»æ€è€ƒé—®é¢˜çš„, è€Œåˆ°äº†è¿›ç¨‹è™šæ‹ŸåŒ–é˜¶æ®µ, å¾ˆå¤šæ€æƒ³å’Œç†å¿µå’Œç‰©ç†æœºçš„ç”¨æ³•æ˜¯èƒŒé“è€Œé©°çš„, æ‰€ä»¥è¿™ä¸ªè®²å¸ˆçš„å…¼èŒå¯¹æˆ‘æ¥è¯´æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„æŒ‘æˆ˜.</p>
<p>â€‹        æ¥åˆ°ä»»åŠ¡å, ç¡®å®šå¤§çº²è‚¯å®šæ˜¯é¦–å½“å…¶å†², æœŸé—´å’Œå®«è€å¸ˆåå¤è®¨è®ºå¤§çº²çŸ¥è¯†ç‚¹çš„é¡ºåº. ä¸ºä»€ä¹ˆé¡ºåºéœ€è¦è®¨è®ºå‘¢, è¿™ä¹ˆè¯´å§, æˆ‘å½“æ—¶å·²ç»çœ‹è¿‡ä¸ä¸‹äº”æœ¬ Docker ç›¸å…³çš„ä¹¦ç±, æ¯æœ¬ä¹¦ä»‹ç» Docker æŠ€æœ¯çš„é¡ºåºéƒ½ä¸ä¸€æ ·, è€Œå¯¹äºåˆå­¦è€…æ¥è¯´, é€‰å¯¹é¡ºåºéå¸¸é‡è¦! æœ€åç»“åˆè‡ªå·±å­¦ä¹  Docker çš„è¿‡ç¨‹, å®«è€å¸ˆç»™çš„å»ºè®®å’Œå‚è€ƒå®˜æ–¹æ–‡æ¡£, ç¡®å®šäº†ä¸€ä¸ªè®©è‡ªå·±æ»¡æ„çš„å¤§çº². ç¡®å®šå¤§çº²ä¹‹åå°±è¿›å…¥åˆ°ç´§å¼ çš„å¤‡è¯¾é˜¶æ®µ, è¿™æ—¶æˆ‘æ‰å‘ç°, è¦æŠŠä¸€ä¸ªä¸œè¥¿è®²æ˜ç™½æ˜¯å¤šä¹ˆä¸å®¹æ˜“, ä¸ä»…ä»…è¦äº†è§£å®ƒçš„æ‰€æœ‰ç‰¹æ€§, è¿˜å¾—æŠŠè¿™äº›ç‰¹æ€§ç»“åˆå®é™…æƒ…å†µè§£é‡Šæ¸…æ¥š, åœ¨ç”Ÿäº§ç¯å¢ƒä¸­, å¯èƒ½é‡åˆ°é—®é¢˜å, æ‰ä¼šå»æ‰¾è§£å†³æ–¹æ¡ˆ, ç”¨åˆ°ä»€ä¹ˆåŠŸèƒ½, å‘æ˜ä»€ä¹ˆåŠŸèƒ½, ä½†æ˜¯è®²è¯¾ä¸ä¸€æ ·, ä¸ç®¡å®é™…æƒ…å†µçš„ä½¿ç”¨é¢‘ç‡æ€æ ·, ä½ éƒ½å¾—ä¸€ä¸€çŸ¥æ™“ä»–ä»¬çš„ä½¿ç”¨æ–¹æ³•å’Œä½¿ç”¨åœºæ™¯, å¤‡è¯¾çš„è¿‡ç¨‹èŠ±äº†å¥½å‡ ä¸ªæ™šä¸Š, åå¤ç ”ç©¶, åå¤è¯•éªŒ, ç”Ÿæ€•è®²è¯¾çš„æ—¶å€™æ–­æ¡£. </p>
<p>â€‹        å½“æˆ‘ç¬¬ä¸€æ¬¡èµ°è¿›è®²å°çš„æ—¶å€™, æ˜¯å¾ˆç´§å¼ çš„, ä½†æ˜¯ä¸Šè¯¾ä¹‹å, ä» Docker çš„èµ·æº, å‘å±•è®²èµ·, æ…¢æ…¢çš„æ”¾æ¾ä¸‹æ¥, ä½†æ˜¯ç°åœ¨çœ‹æ¥, å½“æ—¶ç´§å¼ å¯¼è‡´è¯­é€Ÿå¿«, ä½“éªŒè¿˜æ˜¯éå¸¸ä¸å¥½çš„. æŒ‰ç…§å¤§çº², ç»™å­¦ç”Ÿä»¬åŸ¹è®­äº†4å¤©çš„è¯¾ç¨‹, æœ€åè®©æˆ‘å¾ˆæ„å¤–, åŸä»¥ä¸ºä¸‰å¤©å°±å¯ä»¥è®²å®Œçš„å†…å®¹, ç»“æœåˆ°äº†ç¬¬å››å¤©ä¸‹è¯¾, æ‹–å ‚äº†ä¸¤ä¸ªå°æ—¶æ‰è®²å®Œ. ä¸­é—´æ€è·¯å‘æ•£çš„è¿‡å¤šäº†, ä¸è¿‡ä¹Ÿéƒ½æ˜¯å¹²è´§~ å°±è¿™æ ·, æˆ‘å¸¦è¿‡äº†æˆ‘äººç”Ÿä¸­çš„ç¬¬ä¸€æ‰¹å­¦ç”Ÿ, å½“è€å¸ˆå¾ˆè¾›è‹¦,  é™¤äº†å¤‡è¯¾, æ¯å¤©ä¸åœçš„è¯´è¯å‡ ä¸ªå°æ—¶, çœŸçš„è„¸éƒ½è‚¿äº†~ </p>
<p>â€‹        å½“è®²å¸ˆ, æŠŠè‡ªå·±ä¼šçš„ä¸œè¥¿è®²ç»™åˆ«äººå¬, æ˜¯ä¸ªéå¸¸éå¸¸éš¾å¾—çš„æœºä¼š, ä¸€èˆ¬äººæƒ³æ‰¾è¿™ç§æœºä¼šéƒ½æ‰¾ä¸ç€, åœ¨éš‹è€å¤§çš„å¼•èä¸‹, ä¹Ÿç®—æ˜¯çªç ´äº†è‡ªå·±, å¤§èƒ†çš„èµ°ä¸Šå°å‰, å±•ç¤ºè‡ªå·±, éå¸¸éå¸¸éš¾å¾—çš„æœºä¼š. å½“ç„¶è¿™ä¹Ÿè®©æˆ‘æ”¶è·äº†å·¥ä½œä»¥æ¥, å…¼èŒçš„ç¬¬ä¸€æ¡¶é‡‘</p>
<p>â€‹        <code>äºŒå­:æˆ¿å­</code> æˆ¿å­æ˜¯æ‰€æœ‰ä¸­å›½çš„å¿ƒç—…, æˆä¹Ÿæˆ¿å­, è´¥ä¹Ÿæˆ¿å­. å¯¹äºæ™®é€šè€ç™¾å§“æ¥è¯´, åˆšéœ€ä½æˆ¿, èƒ½æœ‰ä¸€å¥—è‡ªå·±æˆ¿å­, ä¹Ÿç®—æ˜¯æ¯•ç”Ÿçš„ä¸€ä¸ªé‡å¤§ä»»åŠ¡. åœ¨2017å¹´5æœˆåº•, åœ¨çˆ¶æ¯çš„å€¾åŠ›å¸®åŠ©ä¸‹, æˆ‘æ”¶è·äº†äººç”Ÿä¸­çš„ç¬¬ä¸€å¥—æˆ¿äº§. ä¸­å›½æœ‰å¥å¤è¯, å«å®‰å±…ä¹ä¸š, åªæœ‰å®‰å±…æ‰èƒ½ä¹ä¸š, çœ¼ç…å³å°†æˆå®¶, è¿™å¥—æ¥ä¹‹ä¸æ˜“çš„æˆ¿äº§æ­£æ˜¯æœªæ¥ä¹ä¸šä¹‹æ ¹æœ¬. </p>
<p>â€‹        ç²¾è£…ä¿®çš„æˆ¿å­, è¿˜å¥½åœ¨è£…ä¿®è¿™å—ä¸ç”¨æ“å¿ƒ, æŒ‘æŒ‘å®¶å…·, æŠŠå±‹å­å¡«æ»¡å³å¯. åœ¨çœ‹è¿‡å¤šå®¶å…¨å±‹å®šåˆ¶ä¹‹å, é€‰å®šäº†å…¶ä¸­ä¸¤å®¶æ¥å®šåˆ¶å®¶å…·. å…¶ä¸­æœ‰ä¸€å®¶å› ä¸ºæ²™å‘çš„é—®é¢˜, æ¥å›è€½è¯¯äº†å¥½ä¹…, é—¹å¾—å¾ˆä¸æ„‰å¿«. ç”šè‡³é‚€è¯·åŒ—äº¬çš„åŒäº‹æ¥å®¶é‡Œåšå®¢çš„æ—¶å€™, åçš„éƒ½æ˜¯é€é”™çš„æ²™å‘.</p>
<p>â€‹        2017å¹´æ”¶è·äº†è‡ªå·±çš„æˆ¿äº§, ä¹Ÿæ­£æ˜¯å› ä¸ºæ”¶è·äº†æˆ¿äº§, æ‰æœ‰èµ„æ ¼å»æ—¥æœ¬åº¦èœœæœˆ, æƒ³æƒ³çœŸæ˜¯æ‚²å“€, å¦‚æœåä¸‹æ²¡æœ‰æˆ¿äº§, æ—¥æœ¬çš„ç­¾è¯éœ€è¦æ¯äººå†»ç»“10ä¸‡çš„å­˜æ¬¾, å·¥ä½œè¿™äº›å¹´, åˆ«è¯´10ä¸‡å­˜æ¬¾, 1ä¸‡å­˜æ¬¾éƒ½æ²¡æœ‰æ”’ä¸‹~ </p>
<p>â€‹        <code>ä¸‰å­:è½¦å­</code> æˆ‘ä¹‹å‰å¯¹è½¦æ²¡æœ‰ä»€ä¹ˆæ„Ÿè§‰, ä¹‹å‰éƒ½æ˜¯æ¯”è¾ƒå–œæ¬¢åè½¦, å¯èƒ½å¾ˆå¤šåŒé¾„äººéƒ½æƒ³ä¹°è½¦å¼€è½¦çš„æ—¶å€™, æˆ‘è¿˜åœ¨æƒ³åå“ªæ¡å…¬äº¤çº¿è·¯ä¼šæ¯”è¾ƒå¿«å‘¢, éª‘è‡ªè¡Œè½¦æ˜¯ä¸æ˜¯æ›´å¥½å‘¢, å¯¹è½¦ä¸€ç›´éƒ½æ²¡æœ‰æ„Ÿè§‰, ä¹Ÿæ²¡æœ‰å–œæ¬¢åˆ°éè¦ä¹°çš„æ¬²æœ›. ç›´åˆ°ä»Šå¹´, ä¹°è½¦çš„æƒ³æ³•æ„ˆåŠ å¼ºçƒˆ, ä»Šå¹´åœ¨å¹´åˆçš„æ—¶å€™å°±æ¸¸èµ°äºå„ä¸ªæ±½è½¦å±•é”€ä¼š, æ”¶äº†ä¸å°‘å¹¿å‘Šä¼ å•. å½“æ—¶ä¸€ç›´åœ¨çº ç»“ä¹° B çº§è½¦è¿˜æ˜¯ A çº§è½¦, éšç€æ—¶é—´çš„æ¨ç§», äº¤æˆ¿ä¹°å®¶å…·ä¹‹å, ç´§æ¥ç€å°±è¦æ“åŠå©šç¤¼, æœ€ç»ˆè¿˜æ˜¯å°†ç›®æ ‡å®šåœ¨äº† A çº§è½¦. åœ¨å®¶é‡Œçš„æ”¯æŒä¸‹, å¾ˆå¿«å°±æäº†è½¦. åˆ°ç°åœ¨å·²ç»å¼€äº†5000å¤šå…¬é‡Œ, é©¬ä¸Šå°±å¯ä»¥é¦–ä¿äº†. ç°åœ¨æƒ³æƒ³, ç”­ç®¡æ˜¯å¤šå°‘é’±çš„æˆ¿, ä¹Ÿç”­ç®¡æ˜¯å¤šä¾¿å®œçš„è½¦, ä¹Ÿç®—æ˜¯æœ‰æˆ¿æœ‰è½¦ä¸€æ—äº†, åœ¨è‡ªå·±ä¸å¦‚æ„çš„æ—¶å€™, æƒ³æƒ³æœ‰æˆ¿æœ‰è½¦, è¿˜æ˜¯èƒ½å®½å¿ƒä¸€äº›çš„~ </p>
<p>â€‹        <code>å››å­:å¦»å­</code> 2017å¹´9æœˆ16å·æ˜¯æˆ‘å¤§å©šçš„æ—¥å­, æœ‰æƒ…äººç»ˆæˆçœ·å±, 861å¤©, çˆ±æƒ…å¾—åˆ°äº†å‡å. äººç”Ÿçš„ç¬¬ä¸€ä»¶å¤§äº‹, å¨¶å¦»å¤§äº‹ç®—æ˜¯è½ä¸‹å¸·å¹•, æˆåŠŸè„±å•, æ™‹å‡åˆ°å·²å©šè´µæ—, æœ‰äº†è‡ªå·±çš„å°å®¶. è¿˜æ¸…æ¥šçš„è®°å¾—å©šç¤¼çš„å‰ä¸€å¤©, å¿™çš„çœŸæ˜¯ä¸å¯å¼€äº¤, ä¸­åˆé¥­éƒ½åˆ°äº†1ç‚¹å¤šæ‰å’Œè‡ªå·±çš„å°ä¼™ä¼´å»åƒ. æ™šä¸Šçš„æ—¶å€™, é‚€è¯·çš„åŒ—äº¬çš„æœ‹å‹é™†ç»­æŠµè¾¾å”å±±, å…ˆæ˜¯å»ç«è½¦ç«™æ¥æˆ‘çš„è¯å©šäºº, ä¹Ÿæ˜¯æˆ‘çš„æˆä¸šæ©å¸ˆ, éš‹è€å¤§. å“é—¨å„¿æ™šå®´åé€éš‹è€å¤§å¤«å¦‡å…¥ä½é…’åº—, æ­£å¥½åœ¨é…’åº—ç­‰å¾…å…¶ä»–è¿˜æ²¡æœ‰åˆ°çš„åŒ—äº¬ç­’å­ä»¬~ ç­‰äººéƒ½åˆ°é½å, çŸ­æš‚çš„å¯’æš„, å·²æ˜¯æ™šä¸Š11ç‚¹å¤š, é¡¾ä¸ä¸Šå’Œè¿œé“è€Œæ¥çš„ç­’å­ä»¬ä¸€èµ·åƒä¸ªå¤œå®µå°±èµ¶ç´§èµ¶å›æ–°æˆ¿äº†. åˆ°æ–°æˆ¿å, åºŠä¸Šéƒ½å¸ƒç½®å¥½äº†, æ€•æ—©ä¸Šèµ·æ¥æ— æ³•å¤åŸ, å°±åœ¨æ²™å‘ä¸Šå‡‘åˆäº†ä¸€å¤œ, å½“æ—¶æˆ‘è¿˜åœ¨æƒ³, ä¸‡ä¸€è¿™ä¸€æ™šç¡ä¸å¥½, ç¬¬äºŒå¤©çŠ¯äº†é¢ˆæ¤ç—…å¯å’‹åŠ~ </p>
<p>â€‹        éå¸¸å¹¸è¿çš„æ˜¯, æ—©ä¸Šå¹¶æ²¡æœ‰ä»»ä½•ä¸é€‚, è™½ç„¶åªè¿·è¿·ç³Šç³Šç¡äº†4ä¸ªå°æ—¶. åœ¨ä¸»æŒäººçš„å…¨ç¨‹å¼•å¯¼ä¸‹, é¡ºåˆ©çš„æŠŠåª³å¦‡å„¿å¨¶åˆ°äº†å®¶. ä¸ºäº†å©šç¤¼è¿™å¤©çš„6ä¸ªå°æ—¶, å¤ªå¤šå¤ªå¤šçš„äº²æœ‹å¥½å‹ç»™äºˆäº†å¤§åŠ›å¸®åŠ©. å½“åˆè¿˜è®¡åˆ’ç€, è°éƒ½ä¸è¦å¸®å¿™, éƒ½æ‰¾å¤–åŒ…å¹², éƒ½ä¸Šæ¡Œåƒé¥­~ çœŸåˆ°äº†è¿™å¤©æ‰çŸ¥é“, å®¶äººæœ‹å‹æ‰æ˜¯ä½ æœ€å¤§çš„é å±±, è¯·å“ªä¸ªå¤–åŒ…å›¢é˜Ÿå¹²ä¹Ÿæ²¡æœ‰å®¶äººæœ‹å‹æ”¾å¿ƒè¸å®, å†æ¬¡è¡·å¿ƒçš„æ„Ÿè°¢!</p>
<p>â€‹        åª³å¦‡å¨¶åˆ°å®¶çš„é‚£å¤©æ™šä¸Š, æˆ‘ç§°äº†ä¸€ä¸‹ä½“é‡, ä¸€å‘¨ä¹‹å‰çš„è¿™ä¸ªæ—¶å€™, ä½“é‡æ˜¯131æ–¤, ä»Šå¤©å†ç§°, é™åˆ°äº†125æ–¤, å©šç¤¼å‰è¿™ä¸€ä¸ªç¤¼æ‹œç«Ÿç„¶ç˜¦äº†6æ–¤! å³ä½¿æ˜¯åˆ°æˆ‘ç°åœ¨å†™è¿™ç¯‡æ€»ç»“, ä¹Ÿä¾ç„¶æ²¡æœ‰æ¢å¤åˆ°ä¹‹å‰çš„ä½“é‡, ä¸ç®¡æ€ä¹ˆæ ·, åª³å¦‡ç»ˆäºå¨¶åˆ°å®¶å•¦<del>~</del></p>
<p>â€‹        <code>äº”å­:å­©å­</code> è¿™ç®—æ˜¯2017å¹´æœ€å¤§çš„æƒŠå–œå§! 10æœˆ22æ—¥, æˆ‘å’Œåª³å¦‡å»æ—¥æœ¬åº¦èœœæœˆ, åˆšåˆ°æ—¥æœ¬ä¸ä¹…, åª³å¦‡å°±ä¸èˆ’æœ, æ¶å¿ƒ. ç›´åˆ°è¡Œç¨‹çš„å››å¤©, å¼€å§‹é¢‘ç¹çš„å‘•å. å› ä¸ºåª³å¦‡å„¿ä¹‹å‰è‚ èƒƒå°±ä¸å¥½, æ—¥æœ¬è¿˜éƒ½æ˜¯ç”Ÿå†·çš„é£Ÿç‰©, å½“æ—¶ä»¥ä¸ºæ˜¯è‚ èƒƒç‚çŠ¯äº†, è¿˜åƒäº†ä»å›½å†…å¸¦çš„è‚ èƒƒè¯. ä½†æ˜¯ä¸æ¯«æ²¡æœ‰ç®¡ç”¨, åè€Œè¶Šæ¥è¶Šä¸¥é‡. åæ¥ä»¥ä¸ºæ˜¯æ°´åœŸä¸æœ. ç›´åˆ°åˆ°äº†å›½å†…, åˆå¾…äº†ä¸€å¤©, è¿˜ä¸è§å¥½, è¿™æ‰å¾€æ€€å­•çš„æ–¹é¢è€ƒè™‘, æœ€ç»ˆ, åœ¨å›å›½çš„ç¬¬äºŒå¤©ç¡®å®šäº†è¿™æ¡å–œè®¯. åˆ°ç°åœ¨, å·²ç»å¿«15å‘¨å•¦. æƒ³æƒ³çœŸæ˜¯åæ€•, åœ¨æ€€å­•åˆæœŸ, åé£æœº, åƒè¯, åŠ³ç´¯è¿‡åº¦éƒ½æ˜¯å¤§å¿Œ, ä½†æ˜¯å®å®ä¾ç„¶æŒºäº†è¿‡æ¥, ç»™å®å®çš„åšå¼ºç‚¹èµ, ä½†å´æ˜¯è‹¦äº†å­©å­å¦ˆäº†, ä»æ—¥æœ¬å›æ¥å¦Šå¨ å‘•åååº”æå…¶ä¸¥é‡, æœŸé—´è¿˜å› ä¸ºè¿™ä½äº†é™¢, åˆ°ç°åœ¨ä¹Ÿæ²¡æœ‰å®Œå…¨å¥½, å”‰, çœŸæ˜¯å¿§å¿ƒå•Š, å®å®å•Š, å¸Œæœ›ä½ æ˜å¹´çš„é™ç”Ÿé¡ºé¡ºåˆ©åˆ©, å¥å¥åº·åº·~</p>
<p>â€‹        2017å¹´å¯¹æˆ‘æ¥è¯´ç»å¯¹æ˜¯ä¸ªä¸å¹³å‡¡çš„ä¸€å¹´, åœ¨è¿™ä¸€å¹´é‡Œå‘ç”Ÿäº†å¤ªå¤šå¤ªå¤šçš„äº‹æƒ…, ç¬¬ä¸€æ¬¡å‡ºå›½, ç¬¬ä¸€æ¬¡ç©å¯†å®¤é€ƒè„±, ç¬¬ä¸€æ¬¡æ­£å¼çš„æŠ•èµ„, ç¬¬ä¸€æ¬¡åŒæ—¶æ‹¿åˆ°5å®¶å…¬å¸çš„ offer, ç¬¬ä¸€æ¬¡æ‹¿åˆ°äº†æœ¬ç§‘æ¯•ä¸šè¯ä¹¦â€¦â€¦ </p>
<p>â€‹        è¿˜è®°å¾—2016å¹´çš„æ–°å¹´è®¡åˆ’, è®¡åˆ’2017å¹´è¦ç”¨ç™¾åº¦åœ°å›¾çš„è¶³è¿¹åŠŸèƒ½, æŠŠåŒ—äº¬çš„ä¸‰ç¯, å››ç¯è¶³è¿¹è¡¥é½, çœ‹æ¥ä»Šå¹´æ˜¯åšä¸åˆ°äº†, ä»Šå¹´å¤ªå¤šå¤ªå¤šé‡è¦çš„äº‹æƒ…å‘ç”Ÿäº†, 2017å¹´æ³¨å®šæ˜¯æˆ‘äººç”Ÿçš„é‡Œç¨‹ç¢‘ä¹‹ä¸€! è€Œä¸”æ˜¯æå…¶é‡è¦çš„é‡Œç¨‹ç¢‘ä¹‹ä¸€!</p>
<p>â€‹        æ€€ç€æ„Ÿæ©çš„å¿ƒæƒ…, é€åˆ«2017å¹´, ä¹Ÿå› ä¸º2017å¹´çš„ç§äº‹å¤ªå¤š, åè€Œåœ¨å·¥ä½œä¸­, æ²¡æœ‰è¿‡äºçªå‡ºçš„è´¡çŒ®, é‚£ä¹ˆæˆ‘å¸Œæœ›åœ¨å³å°†åˆ°æ¥çš„2018å¹´, åœ¨å·¥ä½œä¸Šæœ‰æ›´çªå‡ºçš„è¡¨ç°, å¸Œæœ›åœ¨2018å¹´èƒ½æ™‹å‡ä¸€ä¸ªèŒçº§, è¸è¸å®å®çš„ç­‰å¾…å®å®çš„é™ç”Ÿ, ä¸ºé©¬ä¸Šåˆ°æ¥çš„ä¸‰å£ä¹‹å®¶åšå¥½å……è¶³çš„å‡†å¤‡, çœŸæ­£æ˜¯ä¸ºäº†å®¶åœ¨å¥‹æ–—äº†! </p>
<p>â€‹        </p>
<p>â€‹        æœ€å, å­¦ä¹¦é‡Œå‰è¨€çš„è½æ¬¾é£æ ¼è½ä¸€ä¸‹ä»Šå¹´çš„æœ€åä¸€ä¸ªæ¬¾å„¿~</p>
<p>â€‹        </p>
<p>2017å¹´12æœˆ29æ—¥ æ˜ŸæœŸäº” äºåŒ—äº¬</p>
<p>å•ç‘</p>
]]></content>
      <categories>
        <category>Other</category>
      </categories>
      <tags>
        <tag>å¹´ç»ˆæ€»ç»“</tag>
      </tags>
  </entry>
  <entry>
    <title>tornadoå®ç°ä¸ä¼ä¸šå¾®ä¿¡æ¶ˆæ¯çš„äº¤äº’</title>
    <url>/2017/12/26/tornado%E5%AE%9E%E7%8E%B0%E4%B8%8E%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E6%B6%88%E6%81%AF%E7%9A%84%E4%BA%A4%E4%BA%92/</url>
    <content><![CDATA[<h1 id="tornadoå®ç°ä¸ä¼ä¸šå¾®ä¿¡æ¶ˆæ¯çš„äº¤äº’"><a href="#tornadoå®ç°ä¸ä¼ä¸šå¾®ä¿¡æ¶ˆæ¯çš„äº¤äº’" class="headerlink" title="tornadoå®ç°ä¸ä¼ä¸šå¾®ä¿¡æ¶ˆæ¯çš„äº¤äº’"></a>tornadoå®ç°ä¸ä¼ä¸šå¾®ä¿¡æ¶ˆæ¯çš„äº¤äº’</h1><blockquote>
<p>ç°åœ¨ä¼ä¸šå¾®ä¿¡å¼€æ”¾äº†æ™®é€šç”¨æˆ·æ³¨å†Œï¼Œå¤§å¤§æ–¹ä¾¿äº†æˆ‘ä»¬å®ç°ä¸€äº›â€œè„‘æ´å¤§å¼€â€çš„æƒ³æ³•ã€‚DevOpså–Šäº†å¥½å¤šå¹´äº†ï¼Œè¿‘æœŸå‡ºç°äº†ä¸¤ä¸ªDevOpsçš„åˆ†æ”¯ï¼Œä¸€ä¸ªæ˜¯ChatOpsï¼Œä¸€ä¸ªæ˜¯AIOpsã€‚ChatOpsæ˜¯æœ€è¿‘å‡ å¹´ç«èµ·æ¥çš„ï¼Œå…¶ä¸­æ¯”è¾ƒå‡ºåæ˜¯slack+hubotçš„åŒå‰‘åˆç’§ã€‚åœ¨slacké¢‘é“ä¸­ï¼Œå‘é€çš„ä¸€äº›ä¿¡æ¯ï¼Œæ ¹æ®hubotçš„é…ç½®è§„åˆ™ï¼Œæ˜¯å¯ä»¥å°†èŠå¤©ä¿¡æ¯è½¬åŒ–ä¸ºå…·ä½“å‘½ä»¤å»æœåŠ¡å™¨ä¸Šæ‰§è¡Œçš„ã€‚åŸºäºæ­¤ï¼Œå›½å†…ä½¿ç”¨ç‡æ¯”è¾ƒé«˜çš„ä¼ä¸šIMè½¯ä»¶å°±æ˜¯ä¼ä¸šå¾®ä¿¡äº†ã€‚åœ¨ä¼ä¸šä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºè‡ªå·±çš„åº”ç”¨æ¨¡å—ï¼Œåœ¨è¯¥æ¨¡å—ä¸­å®ç°ä¸ç”¨æˆ·çš„æ¶ˆæ¯è¿›è¡Œäº¤äº’ï¼Œæœ¬ç¯‡æ–‡ç« å°±æ¥å®ç°è¿™ä¸€ç›®æ ‡ï¼ˆæœ¬ç¯‡æ–‡ç« åªä»‹ç»åœ¨å·²åˆ›å»ºè‡ªå»ºåº”ç”¨çš„æƒ…å†µä¸‹ï¼Œä¸ç”¨æˆ·æ¶ˆæ¯äº¤äº’ï¼Œä¸å«æ³¨å†Œä¼ä¸šå¾®ä¿¡å·å’Œåˆ›å»ºä¼ä¸šå·è‡ªå»ºåº”ç”¨çš„æ•™ç¨‹ï¼Œè¿™ä¸ªè‡ªå·±å»ç™¾åº¦.comä¸€ä¸‹å°±å¯ä»¥äº†ï¼Œç‚¹ä¸€ç‚¹ï¼Œæ²¡ä»€ä¹ˆéš¾åº¦ï¼‰</p>
</blockquote>
<p><strong>æ³¨æ„ï¼šæœ¬ç¯‡æ–‡ç« ä¸è€ƒè™‘tornadoæ¡†æ¶çš„å®Œå–„æ€§ï¼Œåªä½œä¸ºä¸€ä¸ªrestfulå¼€å‘æ¡†æ¶æ¥åšåŸºæœ¬çš„æ¼”ç¤º</strong></p>
<h1 id="å‰æœŸå‡†å¤‡ï¼š"><a href="#å‰æœŸå‡†å¤‡ï¼š" class="headerlink" title="å‰æœŸå‡†å¤‡ï¼š"></a>å‰æœŸå‡†å¤‡ï¼š</h1><ul>
<li>ä¸€ä¸ªä¼ä¸šå¾®ä¿¡è´¦å·ï¼ˆè®¤ä¸è®¤è¯éƒ½å¯ä»¥ï¼‰</li>
<li>åœ¨ä¼ä¸šå¾®ä¿¡è´¦å·ç®¡ç†åå°ä¸­åˆ›å»ºä¸€ä¸ªè‡ªå»ºåº”ç”¨ï¼ˆä¼ä¸šåº”ç”¨â€“&gt;è‡ªå»ºåº”ç”¨ï¼‰</li>
<li>æ‹¿åˆ°ä¼ä¸šè´¦å·çš„CorpIDï¼ˆæˆ‘çš„ä¼ä¸šâ€“&gt;ä¼ä¸šä¿¡æ¯ï¼‰</li>
<li>åœ¨ä¼ä¸šå¾®ä¿¡å¹³å°è·å–ä¸€ä¸ªTokenï¼ˆè¿›å…¥è‡ªå»ºåº”ç”¨ä¸­â€“&gt;æ¥æ”¶æ¶ˆæ¯â€“&gt;å¯åŠ¨APIæ¥æ”¶â€“&gt;éšæœºè·å–Tokenï¼‰</li>
<li>åœ¨ä¼ä¸šå¾®ä¿¡å¹³å°è·å–ä¸€ä¸ªEncodingAESKeyï¼ˆè¿›å…¥è‡ªå»ºåº”ç”¨ä¸­â€“&gt;æ¥æ”¶æ¶ˆæ¯â€“&gt;å¯åŠ¨APIæ¥æ”¶â€“&gt;éšæœºè·å–EncodingAESKeyï¼‰</li>
<li>ä¸€ä¸ªæœ‰å…¬ç½‘IPçš„æœåŠ¡å™¨ï¼ˆå¯ä»¥åœ¨é˜¿é‡Œäº‘ç­‰å‚å•†è´­ä¹°ï¼‰</li>
<li>ä¸€ä¸ªPython2.7çš„ç¯å¢ƒ</li>
</ul>
<h1 id="ä¸‹è½½ä¼ä¸šå¾®ä¿¡æä¾›çš„åŠ è§£å¯†æ¨¡å—"><a href="#ä¸‹è½½ä¼ä¸šå¾®ä¿¡æä¾›çš„åŠ è§£å¯†æ¨¡å—" class="headerlink" title="ä¸‹è½½ä¼ä¸šå¾®ä¿¡æä¾›çš„åŠ è§£å¯†æ¨¡å—"></a>ä¸‹è½½ä¼ä¸šå¾®ä¿¡æä¾›çš„åŠ è§£å¯†æ¨¡å—</h1><p>ä¼ä¸šå¾®ä¿¡æä¾›äº†Pythonç‰ˆæœ¬çš„åŠ è§£å¯†æ¨¡å—ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä»ä¼ä¸šå¾®ä¿¡å®˜æ–¹ç½‘ç«™ä¸Šä¸‹è½½ä½¿ç”¨</p>
<ul>
<li>åœ°å€ï¼š<a href="https://work.weixin.qq.com/api/doc#10128" target="_blank" rel="noopener">https://work.weixin.qq.com/api/doc#10128</a></li>
<li>ä¸‹è½½é“¾æ¥ï¼š<a href="http://open.work.weixin.qq.com/wwopen/downloadfile/python.zip" target="_blank" rel="noopener">http://open.work.weixin.qq.com/wwopen/downloadfile/python.zip</a></li>
</ul>
<p>ä¸‹è½½å®Œæˆåï¼Œä½ å°†å¾—åˆ°ä»¥ä¸‹æ–‡ä»¶ï¼š</p>
<ul>
<li>ierror.py é”™è¯¯çŠ¶æ€ç </li>
<li>Sample.py ç¤ºä¾‹ä»£ç </li>
<li>WXBizMsgCrypt.py åŠ è§£å¯†æ ¸å¿ƒæ¨¡å—</li>
<li>Readme.txt</li>
</ul>
<p>ä¸ºäº†ä½¿ç”¨<code>WXBizMsgCrypt.py</code>è¿™ä¸ªæ¨¡å—ï¼Œéœ€è¦å…ˆåœ¨Pythonç¯å¢ƒä¸­å®‰è£…<code>pycrypto</code>æ¨¡å—ï¼Œæ‰§è¡Œä¸€ä¸‹å‘½ä»¤</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; pip install pycrypto</span><br></pre></td></tr></table></figure>

<h1 id="æ­å»ºtornadoè¿è¡Œæ¡†æ¶"><a href="#æ­å»ºtornadoè¿è¡Œæ¡†æ¶" class="headerlink" title="æ­å»ºtornadoè¿è¡Œæ¡†æ¶"></a>æ­å»ºtornadoè¿è¡Œæ¡†æ¶</h1><p>åœ¨ä¸å¾®ä¿¡æä¾›çš„æ¨¡å—çš„åŒçº§ç›®å½•ä¸­ï¼Œåˆ›å»ºtornadoæœåŠ¡åº”ç”¨<code>app.py</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> tornado.web</span><br><span class="line"><span class="keyword">import</span> tornado.ioloop</span><br><span class="line"><span class="keyword">from</span> WXBizMsgCrypt <span class="keyword">import</span> WXBizMsgCrypt</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> xml.etree.cElementTree <span class="keyword">as</span> ET</span><br><span class="line"><span class="keyword">import</span> xml.etree.ElementTree</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MainHandler</span><span class="params">(tornado.web.RequestHandler)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self)</span>:</span>  <span class="comment"># å»ºç«‹è¿æ¥ï¼Œè®¤è¯ä½¿ç”¨</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self)</span>:</span>  <span class="comment"># ä¿¡æ¯æ”¶å‘ï¼Œäº¤äº’ä½¿ç”¨</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">application = tornado.web.Application([</span><br><span class="line">    (<span class="string">r"/"</span>, MainHandler),</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        application.listen(<span class="number">8888</span>)</span><br><span class="line">        tornado.ioloop.IOLoop.instance().start()</span><br><span class="line">    <span class="keyword">except</span> KeyboardInterrupt <span class="keyword">as</span> e:</span><br><span class="line">        print(<span class="string">"exit"</span>)</span><br><span class="line">        exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<p><strong>æ­¤å¤„çš„tornadoæ¡†æ¶åªä¸ºæ¼”ç¤ºï¼Œæ¡†æ¶å…¶ä»–åŠŸèƒ½æœªå®Œå–„</strong></p>
<h1 id="ä¸ä¼ä¸šå¾®ä¿¡è®¤è¯æ¥å£å¹¶å»ºç«‹è¿æ¥"><a href="#ä¸ä¼ä¸šå¾®ä¿¡è®¤è¯æ¥å£å¹¶å»ºç«‹è¿æ¥" class="headerlink" title="ä¸ä¼ä¸šå¾®ä¿¡è®¤è¯æ¥å£å¹¶å»ºç«‹è¿æ¥"></a>ä¸ä¼ä¸šå¾®ä¿¡è®¤è¯æ¥å£å¹¶å»ºç«‹è¿æ¥</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="comment"># å£°æ˜å¹¶èµ‹å€¼ä¼ä¸šå¾®ä¿¡ä¸­çš„ä¿¡æ¯</span></span><br><span class="line">    sToken = <span class="string">"iXIPhJ35"</span></span><br><span class="line">    sEncodingAESKey = <span class="string">"LRB2JiYSMUsszYrcbTd9fWTLwlYEhrEjb7Z9coWRBoJ"</span></span><br><span class="line">    sCorpID = <span class="string">"yy4f13b9b0a629296d"</span></span><br><span class="line">    wxcpt=WXBizMsgCrypt(sToken,sEncodingAESKey,sCorpID)  <span class="comment"># ä½¿ç”¨ä¼ä¸šå¾®ä¿¡æä¾›çš„æ¨¡å—åˆ›å»ºåŠ å¯†è§£å¯†å¯¹è±¡</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># è·å–URLä¸­çš„å‚æ•°</span></span><br><span class="line">    sVerifyMsgSig=self.get_argument(<span class="string">'msg_signature'</span>)</span><br><span class="line">    sVerifyTimeStamp=self.get_argument(<span class="string">'timestamp'</span>)</span><br><span class="line">    sVerifyNonce=self.get_argument(<span class="string">'nonce'</span>)</span><br><span class="line">    sVerifyEchoStr=self.get_argument(<span class="string">'echostr'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ä½¿ç”¨è§£å¯†åŠ å¯†å¯¹è±¡è¿›è¡ŒURLè®¤è¯</span></span><br><span class="line">    ret,sEchoStr=wxcpt.VerifyURL(sVerifyMsgSig, sVerifyTimeStamp,sVerifyNonce,sVerifyEchoStr)</span><br><span class="line">    <span class="keyword">if</span> ret != <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"ERR: VerifyURL ret:"</span> + ret</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å°†è§£å¯†åçš„å­—ç¬¦ä¸²å‘å›ç»™ä¼ä¸šå¾®ä¿¡ç«¯</span></span><br><span class="line">    self.write(sEchoStr)</span><br></pre></td></tr></table></figure>

<p>è®¤è¯å»ºç«‹è¿æ¥çš„å¤§æ¦‚æµç¨‹å°±æ˜¯<code>ä¼ä¸šå¾®ä¿¡ç”¨è‡ªå·±çš„åŠ å¯†ç®—æ³•åŠ å¯†ä¸€ä¸ªå­—ç¬¦ä¸²é€šè¿‡getè¯·æ±‚çš„æ–¹å¼å‘é€ç»™ä½ </code> â€“&gt; <code>ä½ çš„æ¥å£æ‹¿åˆ°è¿™æ¬¡getè¯·æ±‚åï¼Œä¾æ®URLä¸­çš„å‚æ•°ï¼Œåè§£å‡ºä¼ä¸šå¾®ä¿¡å‘æ¥çš„åŠ å¯†å­—ç¬¦ä¸²</code> â€“&gt; <code>è§£å¯†åï¼Œå°†è¯¥å­—ç¬¦ä¸²è¿”å›ç»™ä¼ä¸šå¾®ä¿¡ç«¯</code> â€“&gt; <code>ä¼ä¸šå¾®ä¿¡æ”¶åˆ°æ˜æ–‡çš„å­—ç¬¦ä¸²åä¼šå¯¹æ¯”è‡ªå·±çš„åˆå§‹å‘é€çš„å­—ç¬¦ä¸²</code> â€“&gt; <code>å¯¹æ¯”æˆåŠŸå³éªŒè¯æˆåŠŸï¼Œå»ºç«‹è¿æ¥</code></p>
<h1 id="ä¸ä¼ä¸šå¾®ä¿¡è¿›è¡Œä¿¡æ¯äº¤äº’"><a href="#ä¸ä¼ä¸šå¾®ä¿¡è¿›è¡Œä¿¡æ¯äº¤äº’" class="headerlink" title="ä¸ä¼ä¸šå¾®ä¿¡è¿›è¡Œä¿¡æ¯äº¤äº’"></a>ä¸ä¼ä¸šå¾®ä¿¡è¿›è¡Œä¿¡æ¯äº¤äº’</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="comment"># å£°æ˜å¹¶èµ‹å€¼ä¼ä¸šå¾®ä¿¡ä¸­çš„ä¿¡æ¯ï¼Œè¿™ç‚¹ä¸ä¸Šé¢getè¯·æ±‚çš„è®¤è¯æ˜¯ä¸€æ ·çš„</span></span><br><span class="line">    sToken = <span class="string">"iXIPhJ35"</span></span><br><span class="line">    sEncodingAESKey = <span class="string">"LRB2JiYSMUsszYrcbTd9fWTLwlYEhrEjb7Z9coWRBoJ"</span></span><br><span class="line">    sCorpID = <span class="string">"yy4f13b9b0a629296d"</span></span><br><span class="line">    wxcpt = WXBizMsgCrypt(sToken, sEncodingAESKey, sCorpID)  <span class="comment"># ä½¿ç”¨ä¼ä¸šå¾®ä¿¡æä¾›çš„æ¨¡å—åˆ›å»ºåŠ å¯†è§£å¯†å¯¹è±¡</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># è·å–URLä¸­çš„å‚æ•°ï¼ˆæ³¨æ„ä¸Šé¢çš„getå‡½æ•°ä¸­çš„å¯†æ–‡æ˜¯é€šè¿‡getè¯·æ±‚ç›´æ¥åŠ åœ¨urlä¸­ä¼ é€’çš„ï¼Œè€Œäº¤äº’æ¨¡å¼ä¸­ï¼Œå¯†æ–‡æ˜¯å•ç‹¬postè¿‡æ¥çš„ï¼‰</span></span><br><span class="line">    sVerifyMsgSig = self.get_argument(<span class="string">'msg_signature'</span>)</span><br><span class="line">    sVerifyTimeStamp = self.get_argument(<span class="string">'timestamp'</span>)</span><br><span class="line">    sVerifyNonce = self.get_argument(<span class="string">'nonce'</span>)</span><br><span class="line">    sReqData = self.request.body</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å°†ä»¥ä¸Šä¿¡æ¯è¿›è¡Œè§£å¯†</span></span><br><span class="line">    ret, sMsg = wxcpt.DecryptMsg(sReqData, sVerifyMsgSig, sVerifyTimeStamp, sVerifyNonce)</span><br><span class="line">    <span class="keyword">if</span> (ret != <span class="number">0</span>):</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"ERR: VerifyURL ret:"</span></span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ ¹æ®æ¥æ”¶åˆ°çš„xmlæ¶ˆæ¯ï¼Œå®ä¾‹åŒ–æˆxmlå¯¹è±¡</span></span><br><span class="line">    xml_tree = ET.fromstring(sMsg)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># åˆ¤æ–­æ˜¯å¦æ˜¯å‘é€æ¶ˆæ¯çš„è¡Œä¸º</span></span><br><span class="line">    <span class="keyword">if</span> xml.etree.ElementTree.iselement(xml_tree.find(<span class="string">"Content"</span>)):</span><br><span class="line">        content = xml_tree.find(<span class="string">"Content"</span>).text  <span class="comment"># è·å–ç”¨æˆ·å‘é€çš„æ¶ˆæ¯</span></span><br><span class="line">    <span class="comment"># åˆ¤æ–­æ˜¯å¦æ˜¯ç‚¹å‡»èœå•æ çš„è¡Œä¸º</span></span><br><span class="line">    <span class="keyword">elif</span> xml.etree.ElementTree.iselement(xml_tree.find(<span class="string">"EventKey"</span>)):</span><br><span class="line">        content = xml_tree.find(<span class="string">"EventKey"</span>).text  <span class="comment"># è·å–ç”¨æˆ·ç‚¹å‡»èœå•çš„id</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        content = <span class="string">"other type"</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># å°†æˆ‘ä»¬æ”¶åˆ°çš„ä¿¡æ¯å†å‘å›ç»™ä¼ä¸šå¾®ä¿¡ï¼Œéœ€è¦ä»requestçš„xmlè·å–ä»¥ä¸‹ä¿¡æ¯</span></span><br><span class="line">    user_id = xml_tree.find(<span class="string">"FromUserName"</span>).text  <span class="comment"># ç”¨æˆ·id</span></span><br><span class="line">    corp_id = xml_tree.find(<span class="string">"ToUserName"</span>).text  <span class="comment"># ä¼ä¸šid</span></span><br><span class="line">    create_time = xml_tree.find(<span class="string">"CreateTime"</span>).text  <span class="comment"># æ—¶é—´æˆ³ï¼ˆç”¨requestçš„æ—¶é—´æˆ³å³å¯ï¼‰</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># ä»¥ä¸‹ä¸ºéœ€è¦å›å¤ç»™ä¼ä¸šå¾®ä¿¡ç”¨æˆ·çš„æ¶ˆæ¯çš„å…·ä½“å†…å®¹</span></span><br><span class="line">    content = <span class="string">"1.1.1.1\n2.2.2.2\n3.3.3.3"</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># ç”±äºä¸æ˜¯å¾ˆç†Ÿæ‚‰xmlçš„æ“ä½œï¼Œä¹Ÿä¸æ˜ç™½ä¸ºå•¥å¾®ä¿¡ä¸ç”¨jsonï¼Œéè¦ä»»æ€§çš„ç”¨xml</span></span><br><span class="line">    <span class="comment"># åœ¨è¿™é‡Œåªèƒ½ç”¨å­—ç¬¦ä¸²æ‹¼å‡ºä¸€ä¸ªxmlæ–‡ä»¶å‡ºæ¥äº† -_- ä¸è¦å–·</span></span><br><span class="line">    <span class="comment"># ä»¥ä¸‹xmlå³ä¸ºå‘é€å›ä¼ä¸šå¾®ä¿¡çš„å®Œæ•´æ¶ˆæ¯ä½“ï¼Œè¯¥æ¶ˆæ¯ä½“ä¸èƒ½ç›´æ¥æ˜æ–‡å‘é€ï¼Œéœ€è¦åŠ å¯†åå‘é€</span></span><br><span class="line">    sRespData = <span class="string">"""&lt;xml&gt;</span></span><br><span class="line"><span class="string">            &lt;ToUserName&gt;&lt;![CDATA["""</span>+user_id+<span class="string">"""]]&gt;&lt;/ToUserName&gt;</span></span><br><span class="line"><span class="string">            &lt;FromUserName&gt;&lt;![CDATA["""</span>+corp_id+<span class="string">"""]]&gt;&lt;/FromUserName&gt;</span></span><br><span class="line"><span class="string">            &lt;CreateTime&gt;"""</span>+create_time+<span class="string">"""&lt;/CreateTime&gt;</span></span><br><span class="line"><span class="string">            &lt;MsgType&gt;&lt;![CDATA[text]]&gt;&lt;/MsgType&gt;</span></span><br><span class="line"><span class="string">            &lt;Content&gt;&lt;![CDATA["""</span>+content+<span class="string">"""]]&gt;&lt;/Content&gt;</span></span><br><span class="line"><span class="string">            &lt;/xml&gt;"""</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># å°†ä¸Šé¢çš„æ˜æ–‡æ¶ˆæ¯ä½“ä½¿ç”¨ä¼ä¸šå¾®ä¿¡çš„åŠ å¯†æ¨¡å—è¿›è¡ŒåŠ å¯†æ“ä½œ</span></span><br><span class="line">    ret,sEncryptMsg = wxcpt.EncryptMsg(sRespData, sVerifyNonce, sVerifyTimeStamp)</span><br><span class="line">    <span class="keyword">if</span> ret!=<span class="number">0</span>:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"ERR: EncryptMsg ret: "</span> + str(ret)</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æœ€åå°†å¯†æ–‡å›å¤ç»™ä¼ä¸šå¾®ä¿¡ï¼Œå³å®Œæˆä¼ä¸šå¾®ä¿¡ç”¨æˆ·ä¸ä¼ä¸šè‡ªå·±æœåŠ¡å™¨ä¹‹é—´çš„ä¿¡æ¯äº¤äº’</span></span><br><span class="line">    self.write(sEncryptMsg)</span><br></pre></td></tr></table></figure>

<p>ä¿¡æ¯äº¤äº’çš„å¤§æ¦‚æµç¨‹æ˜¯<code>ä¼ä¸šå¾®ä¿¡ç”¨è‡ªå·±çš„åŠ å¯†ç®—æ³•åŠ å¯†ç”¨æˆ·å‘é€çš„æ¶ˆæ¯å­—ç¬¦ä¸²ï¼Œé€šè¿‡postè¯·æ±‚çš„æ–¹å¼å‘é€ç»™ä½ </code> â€“&gt; <code>ä½ çš„æ¥å£æ‹¿åˆ°postè¯·æ±‚åï¼Œä¾æ®URLä¸­çš„å‚æ•°ï¼Œå’Œpostè¿‡æ¥çš„å¯†æ–‡ï¼Œåè§£å‡ºä¼ä¸šå¾®ä¿¡å‘æ¥çš„åŠ å¯†æ¶ˆæ¯</code> â€“&gt; <code>è§£å¯†åï¼Œå°†å›å¤ç»™ç”¨æˆ·çš„æ¶ˆæ¯é‡æ–°åŒ…è¿›xmlæ¶ˆæ¯ä¸­</code> â€“&gt; <code>å°†å®Œæ•´çš„xmlè¿›è¡ŒåŠ å¯†</code> â€“&gt; <code>å°†å¯†æ–‡å›å¤ç»™ä¼ä¸šå¾®ä¿¡ç«¯</code></p>
<h1 id="æ²¡æœ‰ä¸‹ä¸€æ­¥äº†-å°±æ˜¯è¿™ä¹ˆç®€å•"><a href="#æ²¡æœ‰ä¸‹ä¸€æ­¥äº†-å°±æ˜¯è¿™ä¹ˆç®€å•" class="headerlink" title="æ²¡æœ‰ä¸‹ä¸€æ­¥äº† å°±æ˜¯è¿™ä¹ˆç®€å•"></a>æ²¡æœ‰ä¸‹ä¸€æ­¥äº† å°±æ˜¯è¿™ä¹ˆç®€å•</h1><p>ä»¥ä¸‹æ˜¯å®Œæ•´çš„ä»£ç </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> tornado.web</span><br><span class="line"><span class="keyword">import</span> tornado.ioloop</span><br><span class="line"><span class="keyword">from</span> WXBizMsgCrypt <span class="keyword">import</span> WXBizMsgCrypt</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> xml.etree.cElementTree <span class="keyword">as</span> ET</span><br><span class="line"><span class="keyword">import</span> xml.etree.ElementTree</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MainHandler</span><span class="params">(tornado.web.RequestHandler)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self)</span>:</span></span><br><span class="line">        sToken = <span class="string">"iXIPhJ35"</span></span><br><span class="line">        sEncodingAESKey = <span class="string">"LRB2JiYSMUsszYrcbTd9fWTLwlYEhrEjb7Z9coWRBoJ"</span></span><br><span class="line">        sCorpID = <span class="string">"yy4f13b9b0a629296d"</span></span><br><span class="line">        wxcpt=WXBizMsgCrypt(sToken,sEncodingAESKey,sCorpID)</span><br><span class="line"></span><br><span class="line">        sVerifyMsgSig=self.get_argument(<span class="string">'msg_signature'</span>)</span><br><span class="line">        sVerifyTimeStamp=self.get_argument(<span class="string">'timestamp'</span>)</span><br><span class="line">        sVerifyNonce=self.get_argument(<span class="string">'nonce'</span>)</span><br><span class="line">        sVerifyEchoStr=self.get_argument(<span class="string">'echostr'</span>)</span><br><span class="line"></span><br><span class="line">        ret,sEchoStr=wxcpt.VerifyURL(sVerifyMsgSig, sVerifyTimeStamp,sVerifyNonce,sVerifyEchoStr)</span><br><span class="line">        <span class="keyword">if</span> ret != <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">"ERR: VerifyURL ret:"</span> + ret</span><br><span class="line">            sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        self.write(sEchoStr)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self)</span>:</span></span><br><span class="line">        sToken = <span class="string">"iXIPhJ35"</span></span><br><span class="line">        sEncodingAESKey = <span class="string">"LRB2JiYSMUsszYrcbTd9fWTLwlYEhrEjb7Z9coWRBoJ"</span></span><br><span class="line">        sCorpID = <span class="string">"yy4f13b9b0a629296d"</span></span><br><span class="line">        wxcpt = WXBizMsgCrypt(sToken, sEncodingAESKey, sCorpID)</span><br><span class="line"></span><br><span class="line">        sVerifyMsgSig = self.get_argument(<span class="string">'msg_signature'</span>)</span><br><span class="line">        sVerifyTimeStamp = self.get_argument(<span class="string">'timestamp'</span>)</span><br><span class="line">        sVerifyNonce = self.get_argument(<span class="string">'nonce'</span>)</span><br><span class="line">        sReqData = self.request.body</span><br><span class="line"></span><br><span class="line">        ret, sMsg = wxcpt.DecryptMsg(sReqData, sVerifyMsgSig, sVerifyTimeStamp, sVerifyNonce)</span><br><span class="line">        <span class="keyword">if</span> (ret != <span class="number">0</span>):</span><br><span class="line">            <span class="keyword">print</span> <span class="string">"ERR: VerifyURL ret:"</span></span><br><span class="line">            sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        xml_tree = ET.fromstring(sMsg)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> xml.etree.ElementTree.iselement(xml_tree.find(<span class="string">"Content"</span>)):</span><br><span class="line">            content = xml_tree.find(<span class="string">"Content"</span>).text</span><br><span class="line">        <span class="keyword">elif</span> xml.etree.ElementTree.iselement(xml_tree.find(<span class="string">"EventKey"</span>)):</span><br><span class="line">            content = xml_tree.find(<span class="string">"EventKey"</span>).text</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            content = <span class="string">"other type"</span></span><br><span class="line"></span><br><span class="line">        user_id = xml_tree.find(<span class="string">"FromUserName"</span>).text</span><br><span class="line">        corp_id = xml_tree.find(<span class="string">"ToUserName"</span>).text</span><br><span class="line">        create_time = xml_tree.find(<span class="string">"CreateTime"</span>).text</span><br><span class="line"></span><br><span class="line">        content = <span class="string">"1.1.1.1\n2.2.2.2\n3.3.3.3"</span></span><br><span class="line"></span><br><span class="line">        sRespData = <span class="string">"""&lt;xml&gt;</span></span><br><span class="line"><span class="string">                &lt;ToUserName&gt;&lt;![CDATA["""</span>+user_id+<span class="string">"""]]&gt;&lt;/ToUserName&gt;</span></span><br><span class="line"><span class="string">                &lt;FromUserName&gt;&lt;![CDATA["""</span>+corp_id+<span class="string">"""]]&gt;&lt;/FromUserName&gt;</span></span><br><span class="line"><span class="string">                &lt;CreateTime&gt;"""</span>+create_time+<span class="string">"""&lt;/CreateTime&gt;</span></span><br><span class="line"><span class="string">                &lt;MsgType&gt;&lt;![CDATA[text]]&gt;&lt;/MsgType&gt;</span></span><br><span class="line"><span class="string">                &lt;Content&gt;&lt;![CDATA["""</span>+content+<span class="string">"""]]&gt;&lt;/Content&gt;</span></span><br><span class="line"><span class="string">                &lt;/xml&gt;"""</span></span><br><span class="line"></span><br><span class="line">        ret,sEncryptMsg = wxcpt.EncryptMsg(sRespData, sVerifyNonce, sVerifyTimeStamp)</span><br><span class="line">        <span class="keyword">if</span> ret!=<span class="number">0</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">"ERR: EncryptMsg ret: "</span> + str(ret)</span><br><span class="line">            sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        self.write(sEncryptMsg)</span><br><span class="line"></span><br><span class="line">application = tornado.web.Application([</span><br><span class="line">    (<span class="string">r"/"</span>, MainHandler),</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        application.listen(<span class="number">8888</span>)</span><br><span class="line">        tornado.ioloop.IOLoop.instance().start()</span><br><span class="line">    <span class="keyword">except</span> KeyboardInterrupt <span class="keyword">as</span> e:</span><br><span class="line">        print(<span class="string">"exit"</span>)</span><br><span class="line">        exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<hr>
<p><strong>ä»¥ä¸Šä»£ç åªæ˜¯ç¤ºä¾‹ä»£ç ï¼Œç»†å¿ƒçš„ç«¥é‹å¯èƒ½ä¼šå‘ç°getå’Œpostä¸­æœ‰éƒ¨åˆ†é‡å¤ä»£ç ï¼Œè€Œä¸”è¯¥tornadoæ¡†æ¶æœ¬èº«ä¹Ÿæ²¡æœ‰æä¾›log/å¼‚æ­¥éé˜»å¡ç­‰ç‰¹æ€§çš„æ”¯æŒï¼Œåªæ˜¯ä¸ºäº†æ¼”ç¤ºä¼ä¸šå¾®ä¿¡ä¸è‡ªç”±æœåŠ¡å™¨ä¿¡æ¯äº¤äº’çš„æµç¨‹ä¸ä½¿ç”¨æ–¹æ³•ï¼Œæ— è®ºä½ æ˜¯ä½¿ç”¨Falconè¿˜æ˜¯Flaskæ¡†æ¶ï¼Œé€»è¾‘éƒ½å·®ä¸å¤šï¼Œæ³¨æ„å„ä¸ªæ¡†æ¶çš„å›æ–‡å‡½æ•°å³å¯ï¼Œæ¯”å¦‚tornadoæ˜¯self.write(), Flaskæ˜¯ç›´æ¥return</strong></p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>tornado</tag>
        <tag>WeChat</tag>
        <tag>å¾®ä¿¡</tag>
      </tags>
  </entry>
  <entry>
    <title>Python3ç¼–è¯‘å®‰è£…åpip3å‘½ä»¤æŠ¥sslé”™è¯¯</title>
    <url>/2017/12/26/Python3%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85%E5%90%8Epip3%E5%91%BD%E4%BB%A4%E6%8A%A5ssl%E9%94%99%E8%AF%AF/</url>
    <content><![CDATA[<h1 id="Python3ç¼–è¯‘å®‰è£…åpip3å‘½ä»¤æŠ¥sslé”™è¯¯"><a href="#Python3ç¼–è¯‘å®‰è£…åpip3å‘½ä»¤æŠ¥sslé”™è¯¯" class="headerlink" title="Python3ç¼–è¯‘å®‰è£…åpip3å‘½ä»¤æŠ¥sslé”™è¯¯"></a>Python3ç¼–è¯‘å®‰è£…åpip3å‘½ä»¤æŠ¥sslé”™è¯¯</h1><p>é¦–å…ˆç¡®ä¿sslç›¸å…³çš„åº“æ–‡ä»¶å·²ç»å®‰è£…</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; yum install -y openssl openssl-devel</span><br></pre></td></tr></table></figure>

<p>åœ¨ç¼–è¯‘çš„æ—¶å€™åŠ ä¸Š<code>--with-ssl</code>å‚æ•°å³å¯</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> Python-3.6.2</span><br><span class="line">./configure --with-ssl</span><br><span class="line">make</span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>pip</tag>
        <tag>ssl</tag>
      </tags>
  </entry>
  <entry>
    <title>å¯¹Elementå¯¹è±¡çš„è‡ªçœ</title>
    <url>/2017/12/26/%E5%AF%B9Element%E5%AF%B9%E8%B1%A1%E7%9A%84%E8%87%AA%E7%9C%81/</url>
    <content><![CDATA[<h1 id="å¯¹Elementå¯¹è±¡çš„è‡ªçœ"><a href="#å¯¹Elementå¯¹è±¡çš„è‡ªçœ" class="headerlink" title="å¯¹Elementå¯¹è±¡çš„è‡ªçœ"></a>å¯¹Elementå¯¹è±¡çš„è‡ªçœ</h1><p>Pythonä¸­çš„è‡ªçœæœ‰ä¸¤ä¸ªæ ¸å¿ƒæ¨¡å—å®ç°</p>
<ul>
<li>isinstance(obj, cls)</li>
<li>issubclass(sub, super)</li>
</ul>
<p>å½“åˆ¤æ–­ä¸€ä¸ªåŸºç¡€æ•°æ®ç±»å‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥è¿™ä¹ˆåš</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">i = <span class="number">10</span></span><br><span class="line">print(isinstance(i, int))</span><br></pre></td></tr></table></figure>

<p>å½“åˆ¤æ–­ä¸€ä¸ªè‡ªæœ‰æ•°æ®ç±»å‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥è¿™ä¹ˆåš</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">a = A()</span><br><span class="line">print(isinstance(a, A))</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æˆ‘æœ‰ä¸€ä¸ªElementå¯¹è±¡ï¼Œå¦‚ä½•è®©ä»–è‡ªçœå‘¢ï¼Ÿ</p>
<p>åœ¨xmlæ¨¡å—ä¸­ï¼Œæœ¬èº«å°±æä¾›äº†ç”¨äºè‡ªçœçš„å‡½æ•°</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> xml.etree.cElementTree <span class="keyword">as</span> ET</span><br><span class="line"></span><br><span class="line">root = ET.fromstring(<span class="string">"""&lt;xml&gt;&lt;name&gt;polarsnow&lt;/name&gt;&lt;/xml&gt;"""</span>)</span><br><span class="line"><span class="keyword">print</span> type(root)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> ET.iselement(root)</span><br></pre></td></tr></table></figure>

<p>ç»“æœï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;type &#39;Element&#39;&gt;</span><br><span class="line">True</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>è‡ªçœ</tag>
        <tag>Element</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonä¸­__import__()çš„fromlistå‚æ•°ç”¨æ³•</title>
    <url>/2017/10/13/Python%E4%B8%AD-import-%E7%9A%84fromlist%E5%8F%82%E6%95%B0%E7%94%A8%E6%B3%95/</url>
    <content><![CDATA[<blockquote>
<p>Pythonä¸­çš„<code>__import__()</code>å‡½æ•°ç”¨æ¥åŠ¨æ€çš„åŠ è½½åŒ…æ–‡ä»¶, å…¶ä¸­<code>__import__()</code>æœ‰ä¸ª<code>fromlist</code>çš„å‚æ•°é€‰é¡¹, å¯¹äºåŠ¨æ€åŠ è½½æ¨¡å—æ¥è¯´, éå¸¸é‡è¦</p>
</blockquote>
<p>Python ä¸­çš„ import å¤§æ¦‚æœ‰ä»¥ä¸‹å‡ ç§ç”¨æ³•</p>
<ul>
<li>import pkg  è°ƒç”¨æ–¹æ³•: <code>pkg.mod.func()</code></li>
<li>import pkg.mod è°ƒç”¨æ–¹æ³•: <code>pkg.mod.func()</code></li>
<li>import mod è°ƒç”¨æ–¹æ³•: <code>mod.func()</code></li>
<li>from pkg import mod è°ƒç”¨æ–¹æ³•: <code>mod.func()</code></li>
<li>from pkg.mod import func è°ƒç”¨æ–¹æ³• : <code>func()</code></li>
<li>from mod import func è°ƒç”¨æ–¹æ³•: <code>func()</code></li>
</ul>
<p>ç¬¬ä¸€ç§å’Œç¬¬äºŒç§æƒ…å†µä¸‹, å½“ä½¿ç”¨<code>__import__</code>å¯¼å…¥æ¨¡å—æ—¶, å¾—åˆ°çš„å¯¹è±¡æ˜¯å®Œå…¨ä¸€æ ·çš„. é»˜è®¤æƒ…å†µä¸‹, <code>__import__</code> åªèƒ½å¯¼å…¥æœ€å·¦ä¾§çš„åŒ…æ–‡ä»¶, å³ä»¥ä¸‹ä¸¤ç§å†™æ³•, å¯¼å…¥çš„å¯¹è±¡éƒ½æ˜¯ä¸€æ ·çš„</p>
<ul>
<li><code>pkg2 = __import__(pkg)</code> è°ƒç”¨æ–¹æ³•: <code>pkg2.mod.func()</code></li>
<li><code>pkg3 = __import__(pkg.mod)</code> è°ƒç”¨æ–¹æ³•: <code>pkg3.mod.func()</code></li>
</ul>
<p>ç¬¬ä¸‰ç§æƒ…å†µä¸‹, å½“ä½¿ç”¨<code>__import__</code>å¯¼å…¥æ¨¡å—æ—¶, ä¸<code>import mod</code>çš„å¯¼å…¥æ•ˆæœæ˜¯ä¸€æ ·çš„</p>
<ul>
<li>mod2 = <code>__import__(mod)</code> è°ƒç”¨æ–¹æ³•: <code>mod2.func1(); mod2.func2()</code></li>
</ul>
<p>ç¬¬å››ç§æƒ…å†µä¸‹, å½“ä½¿ç”¨<code>__import__</code>å¯¼å…¥æ¨¡å—æ—¶çš„ç”¨æ³•</p>
<ul>
<li><code>pkg4 = __import__(pkg, fromlist=[mod1, mod2])</code></li>
</ul>
<p>è°ƒç”¨æ–¹æ³•:</p>
<ul>
<li><code>pkg4.mod1.func1()</code></li>
<li><code>pkg4.mod2.func2()</code></li>
</ul>
<p>ç¬¬äº”ç§æƒ…å†µä¸‹, ä¸æ”¯æŒä½¿ç”¨<code>__import__</code>ç›´æ¥å¯¼å…¥åŒ…å†…æ¨¡å—ä¸­çš„å‡½æ•°,  é»˜è®¤æƒ…å†µä¸‹, å³ä½¿ä½ æ˜¯å¦‚ä¸‹çš„å†™æ³•</p>
<ul>
<li><code>pkg5 = __import__(pkg.mod)</code></li>
</ul>
<p>æ•ˆæœä¾ç„¶æ˜¯åªå¯¼å…¥<code>pkg</code>åŒ…è€Œå·², <code>pkg.mod</code>è¿™ä¸ªæ¨¡å—å¹¶æ²¡æœ‰è¢«å¯¼å…¥</p>
<ul>
<li><code>pkg5 = __import__(pkg.mod, fromlist=[mod])</code></li>
</ul>
<p>å¦‚æœæ˜¯åŠ å…¥äº† <code>fromlist</code> å…³é”®å­—çš„è¯, é‚£ä¹ˆè¯¥ pkg5 ä¸º mod æ¨¡å—å¯¹è±¡</p>
<p><em>æ€»ç»“æ¥è¯´å°±æ˜¯å½“ <code>__import__(A.B)</code>æ—¶, å½“ fromlist ä¸ºç©º, åˆ™å¯¼å…¥çš„å¯¹è±¡æ—¶ A, å¦‚æœ fromlist ä¸ä¸ºç©º, å¯¼å…¥çš„å¯¹è±¡å°±æ˜¯ B</em></p>
<p>ç¬¬å…­ç§æƒ…å†µä¸‹, å½“ä½¿ç”¨<code>__import__</code>å¯¼å…¥æ¨¡å—æ—¶, ä¸<code>from mod import func</code>çš„æ•ˆæœæ˜¯ä¸€æ ·çš„, ä¸éœ€è¦ä½¿ç”¨fromlistå‚æ•°æ”¯æŒå°±å¯ä»¥å¯¼å…¥å…¨éƒ¨å‡½æ•°</p>
<ul>
<li><code>mod3 = __import__(mod)</code> è°ƒç”¨æ–¹æ³•: <code>mod3.func()</code></li>
<li><code>pkg5 = __import__(&#39;mod2&#39;, fromlist=[&#39;func2&#39;, &#39;func3&#39;])</code> è¿™ç§å†™æ³•éå¸¸å•°å—¦, ä¸Šé¢çš„å†™æ³•å·²ç»å¯ä»¥å¯¼å…¥å…¨éƒ¨å‡½æ•°äº†, ä¸éœ€è¦å†ä½¿ç”¨ fromlist å•ç‹¬æŒ‡å®š</li>
</ul>
]]></content>
      <tags>
        <tag>import</tag>
        <tag>fromlist</tag>
      </tags>
  </entry>
  <entry>
    <title>collectionsä¸­dequeçš„ç”¨æ³•</title>
    <url>/2017/07/26/collections%E4%B8%ADdeque%E7%9A%84%E7%94%A8%E6%B3%95/</url>
    <content><![CDATA[<blockquote>
<p>collections.deque æ˜¯ç”¨æ¥åˆ›å»ºä¸€ä¸ªæœ‰åºçš„é˜Ÿåˆ—, è€Œä¸”å¯ä»¥é™å®šå…¶é˜Ÿåˆ—çš„å¤§å°, å½“é˜Ÿåˆ—å·²ç»è£…æ»¡å, å†å¡«å…¥çš„å…ƒç´ å°†å®ç°å¤´éƒ¨å…ƒç´ è¢«æŠ›å¼ƒ, æ‰€æœ‰å…ƒç´ å‘å‰æŒªåŠ¨ä¸€ä½, æ–°å…ƒç´ è¿½åŠ åˆ°æœ€åçš„æ•ˆæœ</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> collections</span><br><span class="line"></span><br><span class="line">q = collections.deque([], <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">q.append(<span class="number">1</span>)</span><br><span class="line">print(q)</span><br><span class="line"></span><br><span class="line">q.append(<span class="number">2</span>)</span><br><span class="line">print(q)</span><br><span class="line"></span><br><span class="line">q.append(<span class="number">3</span>)</span><br><span class="line">print(q)</span><br><span class="line"></span><br><span class="line">q.append(<span class="number">4</span>)</span><br><span class="line">print(q)</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœä¸º:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">deque([<span class="number">1</span>], maxlen=<span class="number">3</span>)</span><br><span class="line">deque([<span class="number">1</span>, <span class="number">2</span>], maxlen=<span class="number">3</span>)</span><br><span class="line">deque([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], maxlen=<span class="number">3</span>)</span><br><span class="line">deque([<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>], maxlen=<span class="number">3</span>)</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>collections</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonä¸­çš„æœ‰åºå­—å…¸</title>
    <url>/2017/07/26/Python%E4%B8%AD%E7%9A%84%E6%9C%89%E5%BA%8F%E5%AD%97%E5%85%B8/</url>
    <content><![CDATA[<blockquote>
<p>åœ¨ Python 3.5ç‰ˆæœ¬(å«3.5)ä¹‹å‰, é»˜è®¤çš„å­—å…¸æ˜¯æ— åºçš„. åœ¨æœ€æ–°çš„3.6ç‰ˆæœ¬ä¸­, å­—å…¸å˜æˆäº†æœ‰åºå­—å…¸, æœ¬ç¯‡æ–‡ç« å°†ä»‹ç»3.5ç‰ˆæœ¬åŠä¹‹å‰ç‰ˆæœ¬ä¸­æœ‰åºå­—å…¸çš„ä½¿ç”¨å’Œ3.6ç‰ˆæœ¬åŸç”Ÿæœ‰åºå­—å…¸çš„ä½¿ç”¨</p>
</blockquote>
<h1 id="3-5"><a href="#3-5" class="headerlink" title="3.5-"></a>3.5-</h1><p>3.5ç‰ˆæœ¬åŠä¹‹å‰çš„ç‰ˆæœ¬ä¸­, éœ€è¦å€ŸåŠ©<code>collections</code>æ¨¡å—ä¸­çš„<code>OrderedDict</code>æ¥å®ç°æœ‰åºå­—å…¸çš„å£°æ˜å’Œä½¿ç”¨</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> OrderedDict</span><br><span class="line"></span><br><span class="line">od = OrderedDict()</span><br><span class="line">d = &#123;&#125;</span><br><span class="line"></span><br><span class="line">od[<span class="string">'name'</span>] = <span class="string">'lvrui'</span></span><br><span class="line">od[<span class="string">'age'</span>] = <span class="number">26</span></span><br><span class="line">od[<span class="string">'city'</span>] = <span class="string">'HeBei'</span></span><br><span class="line"></span><br><span class="line">d[<span class="string">'name'</span>] = <span class="string">'lvrui'</span></span><br><span class="line">d[<span class="string">'age'</span>] = <span class="number">26</span></span><br><span class="line">d[<span class="string">'city'</span>] = <span class="string">'HeBei'</span></span><br><span class="line"></span><br><span class="line">print(od)</span><br><span class="line">print(d)</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœä¸º:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">OrderedDict([(<span class="string">'name'</span>, <span class="string">'lvrui'</span>), (<span class="string">'age'</span>, <span class="number">26</span>), (<span class="string">'city'</span>, <span class="string">'HeBei'</span>)])</span><br><span class="line">&#123;<span class="string">'city'</span>: <span class="string">'HeBei'</span>, <span class="string">'name'</span>: <span class="string">'lvrui'</span>, <span class="string">'age'</span>: <span class="number">26</span>&#125;</span><br></pre></td></tr></table></figure>

<h1 id="3-6"><a href="#3-6" class="headerlink" title="3.6+"></a>3.6+</h1><p>åœ¨ Python3.6+ ç‰ˆæœ¬ä¸­, å†…ç½®å­—å…¸é»˜è®¤å°±æ˜¯æœ‰åºçš„ğŸ˜† çˆ½~</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">âœ  ~ python3<span class="number">.6</span></span><br><span class="line">Python <span class="number">3.6</span><span class="number">.2</span> (v3<span class="number">.6</span><span class="number">.2</span>:<span class="number">5</span>fd33b5926, Jul <span class="number">16</span> <span class="number">2017</span>, <span class="number">20</span>:<span class="number">11</span>:<span class="number">06</span>) </span><br><span class="line">[GCC <span class="number">4.2</span><span class="number">.1</span> (Apple Inc. build <span class="number">5666</span>) (dot <span class="number">3</span>)] on darwin</span><br><span class="line">Type <span class="string">"help"</span>, <span class="string">"copyright"</span>, <span class="string">"credits"</span> <span class="keyword">or</span> <span class="string">"license"</span> <span class="keyword">for</span> more information.</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d = &#123;&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d[<span class="string">'name'</span>] = <span class="string">'lvrui'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d[<span class="string">'age'</span>] = <span class="number">26</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d[<span class="string">'city'</span>] = <span class="string">'HeBei'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d</span><br><span class="line">&#123;<span class="string">'name'</span>: <span class="string">'lvrui'</span>, <span class="string">'age'</span>: <span class="number">26</span>, <span class="string">'city'</span>: <span class="string">'HeBei'</span>&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
  </entry>
  <entry>
    <title>Pythonä¸­ä¸ºå…ƒç»„çš„æ¯ä¸ªå…ƒç´ å‘½å</title>
    <url>/2017/07/26/Python%E4%B8%AD%E4%B8%BA%E5%85%83%E7%BB%84%E7%9A%84%E6%AF%8F%E4%B8%AA%E5%85%83%E7%B4%A0%E5%91%BD%E5%90%8D/</url>
    <content><![CDATA[<blockquote>
<p>å…ƒç»„æ˜¯ä¸€ç§é«˜æ•ˆçš„æ•°æ®ç±»å‹, åŒæ—¶æˆ‘ä»¬ä¸ºäº†æé«˜æå–å…ƒç»„å…ƒç´ çš„å¯è¯»æ€§,  åšå‡ºå¦‚ä¸‹ä¿®æ”¹æ¥ä¸ºå…ƒç»„çš„å…ƒç´ å‘½å</p>
</blockquote>
<p>æ¯”å¦‚æˆ‘ä»¬ç”¨ä¸€ä¸ªå…ƒç»„æ¥æè¿°ä¸€ä¸ªä½ç½®ä¿¡æ¯, æ¯”å¦‚ <code>(5,9)</code>æ¥æ ‡è¯†æ¨ªåæ ‡ä¿¡æ¯å’Œçºµåæ ‡ä¿¡æ¯</p>
<h1 id="ç¬¬ä¸€ç§æ–¹å¼-é€šè¿‡å˜é‡"><a href="#ç¬¬ä¸€ç§æ–¹å¼-é€šè¿‡å˜é‡" class="headerlink" title="ç¬¬ä¸€ç§æ–¹å¼: é€šè¿‡å˜é‡"></a>ç¬¬ä¸€ç§æ–¹å¼: é€šè¿‡å˜é‡</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">p = (<span class="number">5</span>, <span class="number">9</span>)</span><br><span class="line">x, y = range(<span class="number">2</span>)</span><br><span class="line">print(p[x])</span><br><span class="line">print(p[y])</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœä¸º:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">5</span></span><br><span class="line"><span class="number">9</span></span><br></pre></td></tr></table></figure>

<h1 id="ç¬¬äºŒç§æ–¹å¼-collections-å†…ç½®å‡½æ•°"><a href="#ç¬¬äºŒç§æ–¹å¼-collections-å†…ç½®å‡½æ•°" class="headerlink" title="ç¬¬äºŒç§æ–¹å¼: collections å†…ç½®å‡½æ•°"></a>ç¬¬äºŒç§æ–¹å¼: collections å†…ç½®å‡½æ•°</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> collections</span><br><span class="line">P = collections.namedtuple(<span class="string">'P'</span>, [<span class="string">'x'</span>, <span class="string">'y'</span>])</span><br><span class="line">p = P(<span class="number">5</span>, <span class="number">9</span>)</span><br><span class="line">print(p.x)</span><br><span class="line">print(p.y)</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœä¸º:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">5</span></span><br><span class="line"><span class="number">9</span></span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹<code>p</code>çš„æ•°æ®ç±»å‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(isinstance(p, P))</span><br><span class="line">print(isinstance(p, tuple))</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœä¸º:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
  </entry>
  <entry>
    <title>Pythonä¸­ä½¿ç”¨Counterå®ç°ç®€å•çš„è®¡æ•°å™¨</title>
    <url>/2017/07/26/Python%E4%B8%AD%E4%BD%BF%E7%94%A8Counter%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E8%AE%A1%E6%95%B0%E5%99%A8/</url>
    <content><![CDATA[<blockquote>
<p>åœ¨ Python ä¸­å¯ä»¥ä½¿ç”¨ collections å†…ç½®æ¨¡å—ä¸‹çš„ Counter æ¥å®ç°ç®€å•çš„ç»Ÿè®¡åŠŸèƒ½</p>
</blockquote>
<h1 id="ç»Ÿè®¡åˆ—è¡¨ä¸­çš„å…ƒç´ "><a href="#ç»Ÿè®¡åˆ—è¡¨ä¸­çš„å…ƒç´ " class="headerlink" title="ç»Ÿè®¡åˆ—è¡¨ä¸­çš„å…ƒç´ "></a>ç»Ÿè®¡åˆ—è¡¨ä¸­çš„å…ƒç´ </h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> collections</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">l = [chr(random.randint(<span class="number">97</span>, <span class="number">102</span>)) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">20</span>)]</span><br><span class="line">print(l)</span><br><span class="line"></span><br><span class="line">result = collections.Counter(l)</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœä¸º:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[<span class="string">'f'</span>, <span class="string">'f'</span>, <span class="string">'b'</span>, <span class="string">'e'</span>, <span class="string">'e'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'f'</span>, <span class="string">'b'</span>, <span class="string">'f'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'c'</span>, <span class="string">'f'</span>, <span class="string">'e'</span>, <span class="string">'c'</span>, <span class="string">'e'</span>, <span class="string">'f'</span>, <span class="string">'e'</span>, <span class="string">'e'</span>]</span><br><span class="line">Counter(&#123;<span class="string">'f'</span>: <span class="number">6</span>, <span class="string">'e'</span>: <span class="number">6</span>, <span class="string">'c'</span>: <span class="number">4</span>, <span class="string">'d'</span>: <span class="number">2</span>, <span class="string">'b'</span>: <span class="number">2</span>&#125;)</span><br></pre></td></tr></table></figure>

<h1 id="ç»Ÿè®¡æ–‡ä»¶ä¸­å•è¯å‡ºç°çš„é¢‘ç‡"><a href="#ç»Ÿè®¡æ–‡ä»¶ä¸­å•è¯å‡ºç°çš„é¢‘ç‡" class="headerlink" title="ç»Ÿè®¡æ–‡ä»¶ä¸­å•è¯å‡ºç°çš„é¢‘ç‡"></a>ç»Ÿè®¡æ–‡ä»¶ä¸­å•è¯å‡ºç°çš„é¢‘ç‡</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> collections</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line">f = open(<span class="string">'/etc/apache2/extra/httpd-ssl.conf'</span>, <span class="string">'r'</span>)</span><br><span class="line"></span><br><span class="line">txt = re.split(<span class="string">'\W+'</span>, f.read())</span><br><span class="line">s = collections.Counter(txt)</span><br><span class="line"></span><br><span class="line">print(s)</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœä¸º:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Counter(&#123;<span class="string">'the'</span>: <span class="number">93</span>, <span class="string">'to'</span>: <span class="number">39</span>, <span class="string">'and'</span>: <span class="number">32</span>, <span class="string">'for'</span>: <span class="number">31</span>, <span class="string">'SSL'</span>: <span class="number">29</span>, <span class="string">'is'</span>: <span class="number">26</span>, <span class="string">'a'</span>: <span class="number">21</span>, <span class="string">'of'</span>: <span class="number">21</span>, <span class="string">'private'</span>: <span class="number">20</span>, <span class="string">'in'</span>: <span class="number">18</span>, <span class="string">'you'</span>: <span class="number">17</span>, <span class="string">'server'</span>: <span class="number">17</span>, <span class="string">'file'</span>: <span class="number">16</span>, <span class="string">'apache2'</span>: <span class="number">16</span>, <span class="string">'be'</span>: <span class="number">16</span>, <span class="string">'1'</span>: <span class="number">16</span>, <span class="string">'etc'</span>: <span class="number">15</span>, <span class="string">'certificate'</span>: <span class="number">15</span>, <span class="string">'this'</span>: <span class="number">14</span>, <span class="string">'as'</span>: <span class="number">13</span>, <span class="string">'This'</span>: <span class="number">13</span>, <span class="string">'0'</span>: <span class="number">13</span>, <span class="string">'or'</span>: <span class="number">13</span>, <span class="string">'use'</span>: <span class="number">12</span>, <span class="string">'client'</span>: <span class="number">10</span>, <span class="string">'that'</span>: <span class="number">10</span>, <span class="string">'when'</span>: <span class="number">10</span>, <span class="string">'can'</span>: <span class="number">10</span>, <span class="string">'are'</span>: <span class="number">9</span>, <span class="string">'mod_ssl'</span>: <span class="number">9</span>, <span class="string">'ciphers'</span>: <span class="number">9</span>, <span class="string">'CA'</span>: <span class="number">8</span>, <span class="string">'on'</span>: <span class="number">8</span>, <span class="string">'one'</span>: <span class="number">8</span>, <span class="string">'2'</span>: <span class="number">8</span>, <span class="string">'an'</span>: <span class="number">7</span>, <span class="string">'crt'</span>: <span class="number">7</span>, <span class="string">'standard'</span>: <span class="number">7</span>, <span class="string">'TLS'</span>: <span class="number">7</span>, <span class="string">'The'</span>: <span class="number">7</span>, <span class="string">'directives'</span>: <span class="number">7</span>, <span class="string">'ssl'</span>: <span class="number">7</span>, <span class="string">'Use'</span>: <span class="number">7</span>, <span class="string">'only'</span>: <span class="number">7</span>, <span class="string">'o'</span>: <span class="number">7</span>, <span class="string">'shutdown'</span>: <span class="number">7</span>, <span class="string">'dev'</span>: <span class="number">7</span>, <span class="string">'all'</span>: <span class="number">6</span>, <span class="string">'more'</span>: <span class="number">6</span>, <span class="string">'close'</span>: <span class="number">6</span>, <span class="string">'used'</span>: <span class="number">6</span>, <span class="string">'not'</span>: <span class="number">6</span>, <span class="string">'which'</span>: <span class="number">6</span>, <span class="string">'notify'</span>: <span class="number">6</span>, <span class="string">'key'</span>: <span class="number">6</span>, <span class="string">'default'</span>: <span class="number">6</span>, <span class="string">'certificates'</span>: <span class="number">6</span>, <span class="string">'alert'</span>: <span class="number">6</span>, <span class="string">'var'</span>: <span class="number">6</span>, <span class="string">'also'</span>: <span class="number">6</span>, <span class="string">'should'</span>: <span class="number">5</span>, <span class="string">'OpenSSL'</span>: <span class="number">5</span>, <span class="string">'SSLv3'</span>: <span class="number">5</span>, <span class="string">'PEM'</span>: <span class="number">5</span>, <span class="string">'encoded'</span>: <span class="number">5</span>, <span class="string">'clients'</span>: <span class="number">5</span>, <span class="string">'random'</span>: <span class="number">5</span>, <span class="string">'OCSP'</span>: <span class="number">5</span>, <span class="string">'containing'</span>: <span class="number">5</span>, <span class="string">'with'</span>: <span class="number">5</span>, <span class="string">'connection'</span>: <span class="number">5</span>, <span class="string">'from'</span>: <span class="number">5</span>, <span class="string">'SSLCertificateFile'</span>: <span class="number">5</span>, <span class="string">'user'</span>: <span class="number">5</span>, <span class="string">'both'</span>: <span class="number">5</span>, <span class="string">'parallel'</span>: <span class="number">4</span>, <span class="string">'variables'</span>: <span class="number">4</span>, <span class="string">'usually'</span>: <span class="number">4</span>, <span class="string">'at'</span>: <span class="number">4</span>, <span class="string">'Note'</span>: <span class="number">4</span>, <span class="string">'HIGH'</span>: <span class="number">4</span>, <span class="string">'configured'</span>: <span class="number">4</span>, </span><br><span class="line">......</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šæ–¹æ³•åœ¨è¯»å–æ–‡ä»¶çš„æ—¶å€™, é‡‡ç”¨äº†è¯»å–å…¨éƒ¨å†…å®¹åˆ°å†…å­˜çš„æ–¹æ³•, å¦‚æœæ–‡ä»¶ä½“ç§¯è¾ƒå¤§, ä¼šå¯¹å†…å­˜é€ æˆè¾ƒå¤§å‹åŠ›, å¯ä»¥é€šè¿‡å¦‚ä¸‹è¿™ç§è¿­ä»£çš„ç”¨æ³•å®ç°ç›¸åŒçš„åŠŸèƒ½</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> collections</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line">f = open(<span class="string">'/etc/apache2/extra/httpd-ssl.conf'</span>, <span class="string">'r'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªç©ºé›†åˆå¯¹è±¡</span></span><br><span class="line">s = collections.Counter()</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿­ä»£æ–‡ä»¶ä¸­çš„æ¯ä¸€è¡Œ</span></span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line">    <span class="comment"># å°†æ¯è¡Œå†…å®¹è¿›è¡ŒæŒ‰å•è¯çš„åˆ‡å‰², åœ¨åˆ‡å‰²ä¹‹å‰å»æ‰æ¯è¡Œå­—ç¬¦ä¸²çš„é¦–ä½ç©ºæ ¼ä»¥åŠæ¢è¡Œ</span></span><br><span class="line">    res = re.split(<span class="string">'\W+'</span>, line.strip())</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å­—ç¬¦ä¸²åˆ‡å‰²å, æ‹¿åˆ° res åˆ—è¡¨, å¾ªç¯è¿­ä»£å®ƒ</span></span><br><span class="line">    <span class="keyword">for</span> word <span class="keyword">in</span> res:</span><br><span class="line">        <span class="comment"># å¦‚æœä¸æ˜¯ç©ºå­—ç¬¦çš„è¯å°±åœ¨é›†åˆä¸­å°†è¯¥é”®å‡ºç°çš„æ¬¡æ•°+1</span></span><br><span class="line">        <span class="keyword">if</span> word:</span><br><span class="line">            s[word] += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">print(s)</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœä¸ä¸Šé¢ç›¸åŒ</p>
<h1 id="ç»Ÿè®¡åæ‰¾å‡ºå‰ä¸‰ä¸ªå…ƒç´ "><a href="#ç»Ÿè®¡åæ‰¾å‡ºå‰ä¸‰ä¸ªå…ƒç´ " class="headerlink" title="ç»Ÿè®¡åæ‰¾å‡ºå‰ä¸‰ä¸ªå…ƒç´ "></a>ç»Ÿè®¡åæ‰¾å‡ºå‰ä¸‰ä¸ªå…ƒç´ </h1><p>åœ¨ counter å¯¹è±¡ä¸­, è¿˜æœ‰ä¸€ä¸ªåŠŸèƒ½å¯ä»¥å¸®æˆ‘ä»¬å–å‡ºæŒ‡å®šçš„å…ƒç´ </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> collections</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line">f = open(<span class="string">'/etc/apache2/extra/httpd-ssl.conf'</span>, <span class="string">'r'</span>)</span><br><span class="line"></span><br><span class="line">s = collections.Counter()</span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line">    res = re.split(<span class="string">'\W+'</span>, line.strip())</span><br><span class="line">    <span class="keyword">for</span> word <span class="keyword">in</span> res:</span><br><span class="line">        <span class="keyword">if</span> word:</span><br><span class="line">            s[word] += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">print(s.most_common(<span class="number">3</span>))</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœä¸º:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[(<span class="string">'the'</span>, <span class="number">93</span>), (<span class="string">'to'</span>, <span class="number">39</span>), (<span class="string">'and'</span>, <span class="number">32</span>)]</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>è®¡æ•°å™¨</tag>
        <tag>counter</tag>
        <tag>collections</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonä¸­å¯è¿­ä»£å¯¹è±¡çš„æ’åº</title>
    <url>/2017/07/26/Python%E4%B8%AD%E5%8F%AF%E8%BF%AD%E4%BB%A3%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%8E%92%E5%BA%8F/</url>
    <content><![CDATA[<blockquote>
<p>åœ¨ Python ä¸­, æä¾›ç»™æˆ‘ä»¬äº†ä¸¤ç§æ’åºçš„æ–¹å¼, ä¸€ç§æ˜¯åˆ—è¡¨å¯¹è±¡è‡ªå·±çš„<code>.sort</code>æ–¹æ³•, ä¸€ç§æ˜¯Python å†…ç½®çš„<code>sorted</code>å‡½æ•°</p>
</blockquote>
<h1 id="åˆ—è¡¨æ’åº"><a href="#åˆ—è¡¨æ’åº" class="headerlink" title="åˆ—è¡¨æ’åº"></a>åˆ—è¡¨æ’åº</h1><p>åˆ—è¡¨æ’åºæœ‰ä¸¤ç§æ–¹å¼å¯ä»¥å®ç°, åˆ†åˆ«æ˜¯è‡ªå¸¦çš„ <code>.sort</code>æ–¹æ³•, è¿˜æœ‰å†…ç½®çš„<code>sorted</code>å‡½æ•°</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">l = [random.randint(<span class="number">1</span>,<span class="number">100</span>) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>)]</span><br><span class="line">print(l)</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœä¸º:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[<span class="number">16</span>, <span class="number">42</span>, <span class="number">84</span>, <span class="number">78</span>, <span class="number">22</span>, <span class="number">50</span>, <span class="number">86</span>, <span class="number">14</span>, <span class="number">95</span>, <span class="number">75</span>]</span><br></pre></td></tr></table></figure>

<h2 id="sort-æ–¹æ³•"><a href="#sort-æ–¹æ³•" class="headerlink" title=".sort æ–¹æ³•"></a>.sort æ–¹æ³•</h2><p>åˆ—è¡¨å¯¹è±¡è‡ªèº«çš„<code>.sort</code>æ–¹æ³•æ‰§è¡Œå, ä¼šæ”¹å˜åŸåˆ—è¡¨å¯¹è±¡çš„é¡ºåº</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">l.sort()</span><br><span class="line">print(l)</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœä¸º:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[<span class="number">14</span>, <span class="number">16</span>, <span class="number">22</span>, <span class="number">42</span>, <span class="number">50</span>, <span class="number">75</span>, <span class="number">78</span>, <span class="number">84</span>, <span class="number">86</span>, <span class="number">95</span>]</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡ä¸Šé¢çš„ç»“æœå¯ä»¥çœ‹å‡º, åŸåˆ—è¡¨çš„æˆå‘˜ä½ç½®å·²ç»å‘ç”Ÿäº†å˜åŒ–</p>
<h2 id="sorted-å‡½æ•°"><a href="#sorted-å‡½æ•°" class="headerlink" title="sorted å‡½æ•°"></a>sorted å‡½æ•°</h2><p>ä½¿ç”¨<code>sorted</code>å‡½æ•°æ’åºåä¼šè¿”å›æ–°çš„å¯¹è±¡, ä¸ä¼šåœ¨åŸå¯¹è±¡ä¸­ä¿®æ”¹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">l2 = sorted(l)</span><br><span class="line">print(l2)</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœä¸º:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[<span class="number">14</span>, <span class="number">16</span>, <span class="number">22</span>, <span class="number">42</span>, <span class="number">50</span>, <span class="number">75</span>, <span class="number">78</span>, <span class="number">84</span>, <span class="number">86</span>, <span class="number">95</span>]</span><br></pre></td></tr></table></figure>

<h1 id="å…ƒç»„æ’åº"><a href="#å…ƒç»„æ’åº" class="headerlink" title="å…ƒç»„æ’åº"></a>å…ƒç»„æ’åº</h1><p>å…ƒç»„ä¸­çš„å…ƒç´ æ˜¯æœ‰åºçš„, ä½†æ˜¯æœ¬èº«çš„å…ƒç´ æ˜¯ä¸å¯ä¿®æ”¹çš„, æ‰€ä»¥å…ƒç»„è‡ªèº«æ²¡æœ‰<code>.sort</code>æ–¹æ³•å¯ä»¥ä½¿ç”¨. ä½†æ˜¯å¯ä»¥é€šè¿‡è½¬åŒ–ä¸ºåˆ—è¡¨çš„æ–¹å¼, é—´æ¥ä½¿ç”¨<code>.sort</code></p>
<h2 id="ä½¿ç”¨ç±»å‹è½¬æ¢å¾—åˆ°å…ƒç»„"><a href="#ä½¿ç”¨ç±»å‹è½¬æ¢å¾—åˆ°å…ƒç»„" class="headerlink" title="ä½¿ç”¨ç±»å‹è½¬æ¢å¾—åˆ°å…ƒç»„"></a>ä½¿ç”¨ç±»å‹è½¬æ¢å¾—åˆ°å…ƒç»„</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">l = [random.randint(<span class="number">1</span>,<span class="number">100</span>) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>)]</span><br><span class="line">t = tuple(l)</span><br><span class="line">print(t)</span><br><span class="line"></span><br><span class="line">t2 = sorted(t)</span><br><span class="line">print(t2)</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœä¸º:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">(<span class="number">10</span>, <span class="number">47</span>, <span class="number">33</span>, <span class="number">68</span>, <span class="number">5</span>, <span class="number">86</span>, <span class="number">95</span>, <span class="number">51</span>, <span class="number">12</span>, <span class="number">28</span>)</span><br><span class="line">[<span class="number">5</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">28</span>, <span class="number">33</span>, <span class="number">47</span>, <span class="number">51</span>, <span class="number">68</span>, <span class="number">86</span>, <span class="number">95</span>]</span><br></pre></td></tr></table></figure>

<h1 id="ä½¿ç”¨ç”Ÿæˆå™¨è¡¨è¾¾å¼å¾—åˆ°å…ƒç»„-è¿­ä»£å¯¹è±¡"><a href="#ä½¿ç”¨ç”Ÿæˆå™¨è¡¨è¾¾å¼å¾—åˆ°å…ƒç»„-è¿­ä»£å¯¹è±¡" class="headerlink" title="ä½¿ç”¨ç”Ÿæˆå™¨è¡¨è¾¾å¼å¾—åˆ°å…ƒç»„(è¿­ä»£å¯¹è±¡)"></a>ä½¿ç”¨ç”Ÿæˆå™¨è¡¨è¾¾å¼å¾—åˆ°å…ƒç»„(è¿­ä»£å¯¹è±¡)</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">t = (random.randint(<span class="number">1</span>,<span class="number">100</span>) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>))</span><br><span class="line">print(t)</span><br><span class="line"></span><br><span class="line">t2 = sorted(t)</span><br><span class="line">print(t2)</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœä¸º:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&lt;generator object &lt;genexpr&gt; at <span class="number">0x1019962b0</span>&gt;</span><br><span class="line">[<span class="number">6</span>, <span class="number">40</span>, <span class="number">46</span>, <span class="number">58</span>, <span class="number">68</span>, <span class="number">72</span>, <span class="number">88</span>, <span class="number">89</span>, <span class="number">93</span>, <span class="number">97</span>]</span><br></pre></td></tr></table></figure>

<h1 id="é›†åˆæ’åº"><a href="#é›†åˆæ’åº" class="headerlink" title="é›†åˆæ’åº"></a>é›†åˆæ’åº</h1><p> é›†åˆæœ¬èº«æ˜¯æ— åºçš„, æœ¬èº«ä¹Ÿæ²¡æœ‰<code>.sort</code>æ–¹æ³•. ä½†æ˜¯é›†åˆä¹Ÿå¯ä»¥é—´æ¥çš„é€šè¿‡å…ˆè½¬åŒ–ä¸ºåˆ—è¡¨çš„æ–¹å¼æ¥ä½¿ç”¨<code>.sort</code>æ–¹æ³•</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">s = &#123;random.randint(<span class="number">1</span>,<span class="number">100</span>) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>)&#125;</span><br><span class="line">print(s)</span><br><span class="line"></span><br><span class="line">s2 = sorted(s)</span><br><span class="line">print(s2)</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœä¸º:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;<span class="number">100</span>, <span class="number">6</span>, <span class="number">71</span>, <span class="number">11</span>, <span class="number">50</span>, <span class="number">21</span>, <span class="number">62</span>, <span class="number">89</span>, <span class="number">26</span>, <span class="number">94</span>&#125;</span><br><span class="line">[<span class="number">6</span>, <span class="number">11</span>, <span class="number">21</span>, <span class="number">26</span>, <span class="number">50</span>, <span class="number">62</span>, <span class="number">71</span>, <span class="number">89</span>, <span class="number">94</span>, <span class="number">100</span>]</span><br></pre></td></tr></table></figure>

<h1 id="å­—å…¸æ’åº"><a href="#å­—å…¸æ’åº" class="headerlink" title="å­—å…¸æ’åº"></a>å­—å…¸æ’åº</h1><h2 id="ä¾æ®-key-æ’åº"><a href="#ä¾æ®-key-æ’åº" class="headerlink" title="ä¾æ® key æ’åº"></a>ä¾æ® key æ’åº</h2><p>ä½¿ç”¨ sorted å¯¹ä¸€ä¸ªå­—å…¸è¿›è¡Œæ’åº, åªéœ€è¦æŠŠå¯¹è±¡ä¼ è¿›å»å³å¯</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">d = &#123;chr(random.randint(<span class="number">97</span>, <span class="number">122</span>)):random.randint(<span class="number">1</span>,<span class="number">20</span>) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">11</span>)&#125;</span><br><span class="line">print(d)</span><br><span class="line">d2 = sorted(d)</span><br><span class="line">print(d2)</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœä¸º:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;<span class="string">'m'</span>: <span class="number">11</span>, <span class="string">'s'</span>: <span class="number">18</span>, <span class="string">'e'</span>: <span class="number">1</span>, <span class="string">'n'</span>: <span class="number">15</span>, <span class="string">'v'</span>: <span class="number">17</span>, <span class="string">'a'</span>: <span class="number">4</span>, <span class="string">'h'</span>: <span class="number">6</span>, <span class="string">'i'</span>: <span class="number">20</span>, <span class="string">'l'</span>: <span class="number">10</span>&#125;</span><br><span class="line">[<span class="string">'a'</span>, <span class="string">'e'</span>, <span class="string">'h'</span>, <span class="string">'i'</span>, <span class="string">'l'</span>, <span class="string">'m'</span>, <span class="string">'n'</span>, <span class="string">'s'</span>, <span class="string">'v'</span>]</span><br></pre></td></tr></table></figure>

<p>å½“æˆ‘ä»¬æ‹¿åˆ°è¿™ä¸ªæ’åºè¿‡åçš„åˆ—è¡¨ä¹‹å, å°±å¯ä»¥ä¾æ®åˆ—è¡¨é‡Œçš„â€é”®â€çš„é¡ºåº, åˆ°å¯¹åº”çš„å­—å…¸ä¸­å–å€¼äº†</p>
<h2 id="ä¾æ®-value-æ’åº"><a href="#ä¾æ®-value-æ’åº" class="headerlink" title="ä¾æ® value æ’åº"></a>ä¾æ® value æ’åº</h2><p>ä¾æ® value æ’åºå°±éœ€è¦ç”¨åˆ° sorted å‡½æ•°ä¸­çš„<code>key</code>å‚æ•°äº†, <code>key</code>å‚æ•°æ¥æ”¶ä¸€ä¸ªå‡½æ•°, æ­¤å‡½æ•°å³ä¸ºå¤„ç†è¿­ä»£å¯¹è±¡æ¯ä¸€ä¸ªå…ƒç´ çš„å‡½æ•°</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">d = &#123;chr(random.randint(<span class="number">97</span>, <span class="number">122</span>)):random.randint(<span class="number">1</span>, <span class="number">20</span>) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">11</span>)&#125;</span><br><span class="line">print(d)</span><br><span class="line"><span class="comment"># å­—å…¸å¯¹è±¡.items() ä¼šæŠŠæ¯ä¸ªé”®å€¼å¯¹è½¬åŒ–æˆå…ƒç»„, å¹¶æŠŠå­—å…¸çš„æœ€å¤–å±‚è½¬åŒ–ä¸ºåˆ—è¡¨</span></span><br><span class="line">print(d.items())</span><br><span class="line">d2 = sorted(d.items(), key=<span class="keyword">lambda</span> x:x[<span class="number">1</span>])</span><br><span class="line">print(d2)</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœä¸º:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;<span class="string">'y'</span>: <span class="number">8</span>, <span class="string">'h'</span>: <span class="number">4</span>, <span class="string">'d'</span>: <span class="number">17</span>, <span class="string">'p'</span>: <span class="number">9</span>, <span class="string">'x'</span>: <span class="number">10</span>, <span class="string">'o'</span>: <span class="number">14</span>, <span class="string">'c'</span>: <span class="number">15</span>, <span class="string">'a'</span>: <span class="number">9</span>, <span class="string">'z'</span>: <span class="number">9</span>&#125;</span><br><span class="line">dict_items([(<span class="string">'y'</span>, <span class="number">8</span>), (<span class="string">'h'</span>, <span class="number">4</span>), (<span class="string">'d'</span>, <span class="number">17</span>), (<span class="string">'p'</span>, <span class="number">9</span>), (<span class="string">'x'</span>, <span class="number">10</span>), (<span class="string">'o'</span>, <span class="number">14</span>), (<span class="string">'c'</span>, <span class="number">15</span>), (<span class="string">'a'</span>, <span class="number">9</span>), (<span class="string">'z'</span>, <span class="number">9</span>)])</span><br><span class="line">[(<span class="string">'h'</span>, <span class="number">4</span>), (<span class="string">'y'</span>, <span class="number">8</span>), (<span class="string">'p'</span>, <span class="number">9</span>), (<span class="string">'a'</span>, <span class="number">9</span>), (<span class="string">'z'</span>, <span class="number">9</span>), (<span class="string">'x'</span>, <span class="number">10</span>), (<span class="string">'o'</span>, <span class="number">14</span>), (<span class="string">'c'</span>, <span class="number">15</span>), (<span class="string">'d'</span>, <span class="number">17</span>)]</span><br></pre></td></tr></table></figure>

<p>ä»ç»“æœçš„ç¬¬ä¸€è¡Œå’Œç¬¬äºŒè¡Œå¯ä»¥çœ‹å‡º<code>å­—å…¸. items()</code>çš„æ‰§è¡Œæ•ˆæœ.</p>
<p>key åé¢çš„ lambda å‡½æ•°, å°†å¾ªç¯æ¥æ”¶å‰é¢è¿­ä»£å…ƒç´ çš„æ¯ä¸€ä¸ªå€¼, ç¬¬ä¸€æ¬¡è¿­ä»£æ—¶, ç¬¬ä¸€ä¸ªå€¼ <code>(&#39;y&#39;, 8)</code>è¢«ä¼ é€’ç»™ lambda å‡½æ•°çš„å‚æ•°. lambda å‡½æ•°æ¥æ”¶è¿™ä¸ªå‚æ•°, å¹¶å–è¿™ä¸ªå‚æ•°å€¼çš„ç¬¬äºŒä½å€¼, ä¹Ÿå°±æ˜¯å–å¾— <code>(&#39;y&#39;, 8)</code>çš„ç¬¬äºŒä¸ªå€¼, å¹¶ä¾æ®æ­¤å€¼è¿›è¡Œæ’åº</p>
<h1 id="åˆ—è¡¨åµŒå¥—å­—å…¸æ··åˆæ’åº"><a href="#åˆ—è¡¨åµŒå¥—å­—å…¸æ··åˆæ’åº" class="headerlink" title="åˆ—è¡¨åµŒå¥—å­—å…¸æ··åˆæ’åº"></a>åˆ—è¡¨åµŒå¥—å­—å…¸æ··åˆæ’åº</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">dd = [</span><br><span class="line">    &#123;<span class="string">'name'</span>: <span class="string">'lvrui'</span>, <span class="string">'age'</span>: <span class="number">27</span>&#125;,</span><br><span class="line">    &#123;<span class="string">'name'</span>: <span class="string">'yyy'</span>, <span class="string">'age'</span>: <span class="number">26</span>&#125;,</span><br><span class="line">    &#123;<span class="string">'name'</span>: <span class="string">'ps'</span>, <span class="string">'age'</span>:<span class="number">28</span>&#125;</span><br><span class="line">]</span><br><span class="line">print(dd)</span><br><span class="line">dd.sort(key=<span class="keyword">lambda</span> x: x[<span class="string">'age'</span>])</span><br><span class="line">print(dd)</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šçš„æ–¹å¼æ˜¯é€šè¿‡åˆ—è¡¨è‡ªèº«çš„<code>.sort</code>æ–¹æ³•å®ç°çš„, ä¿®æ”¹äº†å…ƒåˆ—è¡¨å†…éƒ¨å…ƒç´ çš„ä½ç½®</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">dd = [</span><br><span class="line">    &#123;<span class="string">'name'</span>: <span class="string">'lvrui'</span>, <span class="string">'age'</span>: <span class="number">27</span>&#125;,</span><br><span class="line">    &#123;<span class="string">'name'</span>: <span class="string">'yyy'</span>, <span class="string">'age'</span>: <span class="number">26</span>&#125;,</span><br><span class="line">    &#123;<span class="string">'name'</span>: <span class="string">'ps'</span>, <span class="string">'age'</span>:<span class="number">28</span>&#125;</span><br><span class="line">]</span><br><span class="line">print(dd)</span><br><span class="line"></span><br><span class="line">dd2 = sorted(dd, key=<span class="keyword">lambda</span> x: x[<span class="string">'age'</span>])</span><br><span class="line">print(dd2)</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šåˆ™æ˜¯é€šè¿‡<code>sorted</code>å‡½æ•°å®ç°.</p>
<p>åˆ—ä¸¾è¿™ç§ç”¨æ³•ä¸»è¦æ˜¯ä¸ºäº†ä½“ç° sorted å‡½æ•°ä¸­, key å‚æ•°çš„ä½¿ç”¨æ–¹æ³•, å‰é¢çš„è¿­ä»£å¯¹è±¡çš„ä¸­æ¯ä¸ªå€¼, éƒ½ä¼šä¾æ¬¡ä¼ é€’ç»™ key ä¸­çš„å‡½æ•°, key ä¸­çš„å‡½æ•°éœ€è¦æ¥æ”¶ä¸€ä¸ªå‚æ•°, å¹¶å¯¹è¿™ä¸ªå‚æ•°çš„å€¼è¿›è¡Œå¤„ç†, è¿”å›éœ€è¦æ’åºçš„å¯¹è±¡</p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>æ’åº</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonåœ¨é›†åˆä¸­æ ¹æ®æ¡ä»¶ç­›é€‰æ•°æ®</title>
    <url>/2017/07/25/Python%E5%9C%A8%E9%9B%86%E5%90%88%E4%B8%AD%E6%A0%B9%E6%8D%AE%E6%9D%A1%E4%BB%B6%E7%AD%9B%E9%80%89%E6%95%B0%E6%8D%AE/</url>
    <content><![CDATA[<p>é¦–é€‰åˆ›å»ºä¸€ä¸ªé›†åˆ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">l = [random.randint(<span class="number">-10</span>, <span class="number">10</span>) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">20</span>)]</span><br><span class="line">s = set(l)</span><br><span class="line">print(s)</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœä¸º:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">-1</span>, <span class="number">-9</span>, <span class="number">-6</span>, <span class="number">-5</span>, <span class="number">-4</span>, <span class="number">-2</span>&#125;</span><br></pre></td></tr></table></figure>

<p>ç°æœ‰ä¸€ä¸ªéœ€æ±‚, éœ€è¦æ­¤é›†åˆä¸­ç­›é€‰å‡ºå¯ä»¥è¢«3æ•´é™¤çš„æ•°å­—éƒ½æœ‰å“ªäº›, ä»¥ä¸‹ç»™å‡ºå››ç§å®ç°æ–¹å¼</p>
<h2 id="ç¬¬ä¸€ç§æ–¹å¼-å¾ªç¯è¿­ä»£"><a href="#ç¬¬ä¸€ç§æ–¹å¼-å¾ªç¯è¿­ä»£" class="headerlink" title="ç¬¬ä¸€ç§æ–¹å¼: å¾ªç¯è¿­ä»£"></a>ç¬¬ä¸€ç§æ–¹å¼: å¾ªç¯è¿­ä»£</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(time.time())</span><br><span class="line">s1 = set()</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> s:</span><br><span class="line">    <span class="keyword">if</span> item % <span class="number">3</span> == <span class="number">0</span>:</span><br><span class="line">        s1.add(item)</span><br><span class="line">print(time.time())</span><br><span class="line">print(s1)</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœä¸º:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">1500954512.77478</span></span><br><span class="line"><span class="number">1500954512.774822</span></span><br><span class="line">&#123;<span class="number">-6</span>, <span class="number">3</span>, <span class="number">-9</span>&#125;</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°ç»“æœéœ€è¦çš„æ—¶é—´ä¸º: <code>0.000042</code></p>
<h2 id="ç¬¬äºŒç§æ–¹å¼-filter-å‡½æ•°"><a href="#ç¬¬äºŒç§æ–¹å¼-filter-å‡½æ•°" class="headerlink" title="ç¬¬äºŒç§æ–¹å¼: filter å‡½æ•°"></a>ç¬¬äºŒç§æ–¹å¼: filter å‡½æ•°</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(<span class="string">'---'</span>)</span><br><span class="line">print(time.time())</span><br><span class="line">s2 = list(filter(<span class="keyword">lambda</span> x: x % <span class="number">3</span> == <span class="number">0</span>, s))</span><br><span class="line">print(time.time())</span><br><span class="line">print(s2)</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœä¸º:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">1500954512.774839</span></span><br><span class="line"><span class="number">1500954512.774854</span></span><br><span class="line">[<span class="number">3</span>, <span class="number">-9</span>, <span class="number">-6</span>]</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°ç»“æœéœ€è¦çš„æ—¶é—´ä¸º: <code>0.000015</code></p>
<h2 id="ç¬¬ä¸‰ç§æ–¹å¼-é›†åˆè§£æå¼"><a href="#ç¬¬ä¸‰ç§æ–¹å¼-é›†åˆè§£æå¼" class="headerlink" title="ç¬¬ä¸‰ç§æ–¹å¼: é›†åˆè§£æå¼"></a>ç¬¬ä¸‰ç§æ–¹å¼: é›†åˆè§£æå¼</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(time.time())</span><br><span class="line">s3 = &#123;i <span class="keyword">for</span> i <span class="keyword">in</span> s <span class="keyword">if</span> i % <span class="number">3</span> == <span class="number">0</span>&#125;</span><br><span class="line">print(time.time())</span><br><span class="line">print(s3)</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœä¸º: </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">1500954512.774865</span></span><br><span class="line"><span class="number">1500954512.774885</span></span><br><span class="line">&#123;<span class="number">-6</span>, <span class="number">3</span>, <span class="number">-9</span>&#125;</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°ç»“æœéœ€è¦çš„æ—¶é—´ä¸º: <code>0.000020</code></p>
<h2 id="ç¬¬å››ç§æ–¹å¼-ç”Ÿæˆå™¨è¡¨è¾¾å¼"><a href="#ç¬¬å››ç§æ–¹å¼-ç”Ÿæˆå™¨è¡¨è¾¾å¼" class="headerlink" title="ç¬¬å››ç§æ–¹å¼: ç”Ÿæˆå™¨è¡¨è¾¾å¼"></a>ç¬¬å››ç§æ–¹å¼: ç”Ÿæˆå™¨è¡¨è¾¾å¼</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(time.time())</span><br><span class="line">s4 = (i <span class="keyword">for</span> i <span class="keyword">in</span> s <span class="keyword">if</span> i % <span class="number">3</span> == <span class="number">0</span>)</span><br><span class="line">print(time.time())</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> s4:</span><br><span class="line">    print(i)</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœä¸º: </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">1500954512.774917</span></span><br><span class="line"><span class="number">1500954512.774934</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">-9</span></span><br><span class="line"><span class="number">-6</span></span><br></pre></td></tr></table></figure>

<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“:"></a>æ€»ç»“:</h2><p>é›†åˆä¸ä¹‹å‰çš„å­—å…¸,åˆ—è¡¨ä¸€æ ·, è¦å®ç°æ•°æ®çš„ç­›é€‰ä¾ç„¶æœ‰å››ç§é€‰æ‹©, å°æ•°æ®é‡ä¸‹ä¾ç„¶æ¨èä½¿ç”¨<code>é›†åˆè§£æå¼</code>, å¤§æ•°æ®é‡çš„æƒ…å†µä¸‹æ¨èä½¿ç”¨<code>ç”Ÿæˆå™¨è¡¨è¾¾å¼</code>æˆ– <code>filter å‡½æ•°</code>(ç›´æ¥è¿”å› filter è¿­ä»£å¯¹è±¡, è€Œä¸ç›´æ¥ä½¿ç”¨ list è½¬æ¢)</p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>é›†åˆè§£æå¼</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonåœ¨å­—å…¸ä¸­æ ¹æ®æ¡ä»¶ç­›é€‰æ•°æ®</title>
    <url>/2017/07/25/Python%E5%9C%A8%E5%AD%97%E5%85%B8%E4%B8%AD%E6%A0%B9%E6%8D%AE%E6%9D%A1%E4%BB%B6%E7%AD%9B%E9%80%89%E6%95%B0%E6%8D%AE/</url>
    <content><![CDATA[<p>é¦–å…ˆåˆ›å»ºä¸€ä¸ªå­—å…¸</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">d = &#123;str(x): random.randint(<span class="number">60</span>, <span class="number">100</span>) <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">21</span>)&#125;</span><br><span class="line">print(d)</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœä¸º:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;<span class="string">'16'</span>: <span class="number">61</span>, <span class="string">'3'</span>: <span class="number">66</span>, <span class="string">'17'</span>: <span class="number">70</span>, <span class="string">'10'</span>: <span class="number">82</span>, <span class="string">'1'</span>: <span class="number">71</span>, <span class="string">'18'</span>: <span class="number">89</span>, <span class="string">'5'</span>: <span class="number">83</span>, <span class="string">'4'</span>: <span class="number">97</span>, <span class="string">'19'</span>: <span class="number">77</span>, <span class="string">'12'</span>: <span class="number">92</span>, <span class="string">'8'</span>: <span class="number">73</span>, <span class="string">'11'</span>: <span class="number">74</span>, <span class="string">'15'</span>: <span class="number">60</span>, <span class="string">'13'</span>: <span class="number">68</span>, <span class="string">'20'</span>: <span class="number">80</span>, <span class="string">'7'</span>: <span class="number">62</span>, <span class="string">'2'</span>: <span class="number">99</span>, <span class="string">'6'</span>: <span class="number">85</span>, <span class="string">'14'</span>: <span class="number">83</span>, <span class="string">'9'</span>: <span class="number">87</span>&#125;</span><br></pre></td></tr></table></figure>

<p>ç°æœ‰ä¸€ä¸ªéœ€æ±‚, éœ€è¦æ­¤åˆ—è¡¨ä¸­ç­›é€‰å‡ºå€¼å¤§äº90çš„ id(key) éƒ½æœ‰å“ªäº›, ä»¥ä¸‹ç»™å‡ºå››ç§å®ç°æ–¹å¼</p>
<h2 id="ç¬¬ä¸€ç§æ–¹æ³•-å¾ªç¯è¿­ä»£"><a href="#ç¬¬ä¸€ç§æ–¹æ³•-å¾ªç¯è¿­ä»£" class="headerlink" title="ç¬¬ä¸€ç§æ–¹æ³•: å¾ªç¯è¿­ä»£"></a>ç¬¬ä¸€ç§æ–¹æ³•: å¾ªç¯è¿­ä»£</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(time.time())</span><br><span class="line">d2 = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> d:</span><br><span class="line">    <span class="keyword">if</span> d[k] &gt; <span class="number">90</span>:</span><br><span class="line">        d2[k] = d[k]</span><br><span class="line">print(time.time())</span><br><span class="line">print(d2)</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœä¸º:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">1500951937.126503</span></span><br><span class="line"><span class="number">1500951937.126532</span></span><br><span class="line">&#123;<span class="string">'12'</span>: <span class="number">92</span>, <span class="string">'2'</span>: <span class="number">99</span>, <span class="string">'4'</span>: <span class="number">97</span>&#125;</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°ç»“æœéœ€è¦çš„æ—¶é—´ä¸º: <code>0.000029</code></p>
<h2 id="ç¬¬äºŒç§æ–¹æ³•-filter-å‡½æ•°"><a href="#ç¬¬äºŒç§æ–¹æ³•-filter-å‡½æ•°" class="headerlink" title="ç¬¬äºŒç§æ–¹æ³•: filter å‡½æ•°"></a>ç¬¬äºŒç§æ–¹æ³•: filter å‡½æ•°</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(time.time())</span><br><span class="line">d5 = list(filter(<span class="keyword">lambda</span> x: d[x] &gt; <span class="number">90</span>, d))</span><br><span class="line">print(time.time())</span><br><span class="line">print(d5)</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœä¸º:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">1500951937.126604</span></span><br><span class="line"><span class="number">1500951937.126618</span></span><br><span class="line">[<span class="string">'4'</span>, <span class="string">'12'</span>, <span class="string">'2'</span>]</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°ç»“æœéœ€è¦çš„æ—¶é—´ä¸º: <code>0.000014</code></p>
<h2 id="ç¬¬ä¸‰ç§æ–¹æ³•-å­—å…¸è§£æå¼"><a href="#ç¬¬ä¸‰ç§æ–¹æ³•-å­—å…¸è§£æå¼" class="headerlink" title="ç¬¬ä¸‰ç§æ–¹æ³•: å­—å…¸è§£æå¼"></a>ç¬¬ä¸‰ç§æ–¹æ³•: å­—å…¸è§£æå¼</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(time.time())</span><br><span class="line">d3 = &#123;k:v <span class="keyword">for</span> k,v <span class="keyword">in</span> d.items() <span class="keyword">if</span> v &gt; <span class="number">90</span>&#125;</span><br><span class="line">print(time.time())</span><br><span class="line">print(d3)</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœä¸º:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">1500951937.126555</span></span><br><span class="line"><span class="number">1500951937.126564</span></span><br><span class="line">&#123;<span class="string">'12'</span>: <span class="number">92</span>, <span class="string">'2'</span>: <span class="number">99</span>, <span class="string">'4'</span>: <span class="number">97</span>&#125;</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°ç»“æœéœ€è¦çš„æ—¶é—´ä¸º: <code>0.000009</code></p>
<h2 id="ç¬¬å››ç§æ–¹æ³•-ç”Ÿæˆå™¨è¡¨è¾¾å¼"><a href="#ç¬¬å››ç§æ–¹æ³•-ç”Ÿæˆå™¨è¡¨è¾¾å¼" class="headerlink" title="ç¬¬å››ç§æ–¹æ³•: ç”Ÿæˆå™¨è¡¨è¾¾å¼"></a>ç¬¬å››ç§æ–¹æ³•: ç”Ÿæˆå™¨è¡¨è¾¾å¼</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(time.time())</span><br><span class="line">d4 = (&#123;k: v&#125; <span class="keyword">for</span> k, v <span class="keyword">in</span> d.items() <span class="keyword">if</span> v &gt; <span class="number">90</span>)</span><br><span class="line">print(time.time())</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> d4:</span><br><span class="line">    print(i)</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœä¸º:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">1500951937.126576</span></span><br><span class="line"><span class="number">1500951937.126581</span></span><br><span class="line">&#123;<span class="string">'4'</span>: <span class="number">97</span>&#125;</span><br><span class="line">&#123;<span class="string">'12'</span>: <span class="number">92</span>&#125;</span><br><span class="line">&#123;<span class="string">'2'</span>: <span class="number">99</span>&#125;</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°ç»“æœéœ€è¦çš„æ—¶é—´ä¸º: <code>0.000005</code></p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“:"></a>æ€»ç»“:</h2><p>åœ¨å­—å…¸æ•°æ®é‡è¾ƒå°æ—¶, ä¾ç„¶æ¨èä½¿ç”¨<code>å­—å…¸è§£æå¼</code>å»ç­›é€‰æ•°æ®, åœ¨æ•°æ®é‡è¾ƒå¤§ä¸”æ•°æ®éœ€è¦ä¸€æ¡ä¸€æ¡å¤„ç†æ—¶, ç”Ÿæˆå™¨ä¾ç„¶æ˜¯æœ€ä½³çš„é€‰æ‹©</p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>å­—å…¸è§£æå¼</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonåœ¨åˆ—è¡¨ä¸­æ ¹æ®æ¡ä»¶ç­›é€‰æ•°æ®</title>
    <url>/2017/07/25/Python%E5%9C%A8%E5%88%97%E8%A1%A8%E4%B8%AD%E6%A0%B9%E6%8D%AE%E6%9D%A1%E4%BB%B6%E7%AD%9B%E9%80%89%E6%95%B0%E6%8D%AE/</url>
    <content><![CDATA[<p>é¦–å…ˆæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåˆ—è¡¨</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">l = [random.randint(<span class="number">-10</span>, <span class="number">10</span>) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>)]</span><br><span class="line">print(l)</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœä¸º:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[-1, 0, 8, 3, 5, 0, 4, 0, -2, 5]</span><br></pre></td></tr></table></figure>

<p>ç°æœ‰ä¸€ä¸ªéœ€æ±‚, éœ€è¦åœ¨è¿™ä¸ªåˆ—è¡¨ä¸­ç­›é€‰å‡ºå¤§äº0çš„æ•°å­—, ä»¥ä¸‹ç»™å‡ºå››ç§å®ç°æ–¹å¼</p>
<h2 id="ç¬¬ä¸€ç§æ–¹æ³•-å¾ªç¯è¿­ä»£"><a href="#ç¬¬ä¸€ç§æ–¹æ³•-å¾ªç¯è¿­ä»£" class="headerlink" title="ç¬¬ä¸€ç§æ–¹æ³•: å¾ªç¯è¿­ä»£"></a>ç¬¬ä¸€ç§æ–¹æ³•: å¾ªç¯è¿­ä»£</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">l2 = []</span><br><span class="line">print(time.time())</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> l:</span><br><span class="line">    <span class="keyword">if</span> item &gt; <span class="number">0</span>:</span><br><span class="line">        l2.append(item)</span><br><span class="line">print(time.time())</span><br><span class="line">print(l2)</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœä¸º:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1500915233.146998</span><br><span class="line">1500915233.147016</span><br><span class="line">[8, 3, 5, 4, 5]</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°ç»“æœéœ€è¦çš„æ—¶é—´ä¸º<code>0.000018</code></p>
<h2 id="ç¬¬äºŒç§æ–¹æ³•-filterå‡½æ•°"><a href="#ç¬¬äºŒç§æ–¹æ³•-filterå‡½æ•°" class="headerlink" title="ç¬¬äºŒç§æ–¹æ³•: filterå‡½æ•°"></a>ç¬¬äºŒç§æ–¹æ³•: filterå‡½æ•°</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(time.time())</span><br><span class="line">l3 = list(filter(<span class="keyword">lambda</span> x: x&gt;<span class="number">0</span>, l))</span><br><span class="line">print(time.time())</span><br><span class="line">print(l3)</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœä¸º:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1500915233.147029</span><br><span class="line">1500915233.147039</span><br><span class="line">[8, 3, 5, 4, 5]</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°ç»“æœéœ€è¦çš„æ—¶é—´ä¸º<code>0.000010</code></p>
<h2 id="ç¬¬ä¸‰ç§æ–¹æ³•-åˆ—è¡¨è§£æå¼"><a href="#ç¬¬ä¸‰ç§æ–¹æ³•-åˆ—è¡¨è§£æå¼" class="headerlink" title="ç¬¬ä¸‰ç§æ–¹æ³•: åˆ—è¡¨è§£æå¼"></a>ç¬¬ä¸‰ç§æ–¹æ³•: åˆ—è¡¨è§£æå¼</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(time.time())</span><br><span class="line">l4 = [item <span class="keyword">for</span> item <span class="keyword">in</span> l <span class="keyword">if</span> item &gt; <span class="number">0</span>]</span><br><span class="line">print(time.time())</span><br><span class="line">print(l4)</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœä¸º:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1500915233.14705</span><br><span class="line">1500915233.147056</span><br><span class="line">[8, 3, 5, 4, 5]</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°ç»“æœéœ€è¦çš„æ—¶é—´ä¸º<code>0.000006</code></p>
<h2 id="ç¬¬å››ç§æ–¹æ³•-ç”Ÿæˆå™¨è¡¨è¾¾å¼"><a href="#ç¬¬å››ç§æ–¹æ³•-ç”Ÿæˆå™¨è¡¨è¾¾å¼" class="headerlink" title="ç¬¬å››ç§æ–¹æ³•: ç”Ÿæˆå™¨è¡¨è¾¾å¼"></a>ç¬¬å››ç§æ–¹æ³•: ç”Ÿæˆå™¨è¡¨è¾¾å¼</h2><p>å¦‚æœåˆ—è¡¨æ•°æ®é‡å·¨å¤§, åº”è¯¥è€ƒè™‘çš„ä¸æ˜¯ä½¿ç”¨åˆ—è¡¨è§£æå™¨, è€Œæ˜¯ç”Ÿæˆå™¨è¡¨è¾¾å¼</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(time.time())</span><br><span class="line">l5 = (item <span class="keyword">for</span> item <span class="keyword">in</span> l <span class="keyword">if</span> item &gt; <span class="number">0</span>)</span><br><span class="line">print(time.time())</span><br><span class="line">print(type(l5))</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœä¸º:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1500916299.74144</span><br><span class="line">1500916299.741445</span><br><span class="line">&lt;class &#39;generator&#39;&gt;</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°ç»“æœéœ€è¦çš„æ—¶é—´ä¸º<code>0.000005</code></p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“:"></a>æ€»ç»“:</h2><p>é€šè¿‡ä»¥ä¸Šçš„å››ç§å®è·µæ–¹å¼å¾—å‡º, ä½¿ç”¨å¾ªç¯è¿­ä»£çš„æ–¹å¼æ€§èƒ½æœ€ä½, å°æ•°æ®é‡æ—¶, ä½¿ç”¨åˆ—è¡¨è§£æå¼æ˜¯æœ€å¥½çš„é€‰æ‹©; å¦‚æœæ•°æ®é‡å·¨å¤§, åº”è¯¥ä½¿ç”¨ç”Ÿæˆå™¨è¡¨è¾¾å¼ç”Ÿæˆä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡æä¾›ä½¿ç”¨</p>
<h2 id="å¤‡æ³¨"><a href="#å¤‡æ³¨" class="headerlink" title="å¤‡æ³¨:"></a>å¤‡æ³¨:</h2><ul>
<li><p>åˆ—è¡¨è§£æ <code>[expr for iter_var in iterable if cond_expr]</code></p>
</li>
<li><p>ç”Ÿæˆå™¨è¡¨è¾¾å¼ <code>(expr for iter_var in iterable if cond_expr)</code></p>
</li>
</ul>
<p>ä¸¤è€…çš„è¯­æ³•éå¸¸ç›¸ä¼¼, ä½†ç”Ÿæˆå™¨è¡¨è¾¾å¼è¿”å›çš„ä¸æ˜¯ä¸€ä¸ªåˆ—è¡¨ç±»å‹å¯¹è±¡, è€Œæ˜¯ä¸€ä¸ªç”Ÿæˆå™¨å¯¹è±¡, ç”Ÿæˆå™¨æ˜¯ä¸€ä¸ªå†…å­˜ä½¿ç”¨å‹å¥½çš„ç»“æ„</p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>ç”Ÿæˆå™¨</tag>
        <tag>åˆ—è¡¨è§£æå™¨</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonç±»ä¸­èµ„æºçš„è®¿é—®</title>
    <url>/2017/07/20/Python%E7%B1%BB%E4%B8%AD%E8%B5%84%E6%BA%90%E7%9A%84%E8%AE%BF%E9%97%AE/</url>
    <content><![CDATA[<blockquote>
<p>Python çš„ç±»ä¸­æœ‰ä¸‰ç§èµ„æºç±»å‹, åˆ†åˆ«ä¸ºå­—æ®µ, æ–¹æ³•å’Œå±æ€§. </p>
<p>å­—æ®µåˆåˆ†ä¸ºé™æ€å­—æ®µå’Œæ™®é€šå­—æ®µ</p>
<p>æ–¹æ³•åˆ†ä¸ºé™æ€æ–¹æ³•,  æ™®é€šæ–¹æ³•å’Œç±»æ–¹æ³•</p>
<p>è€Œå­—æ®µå’Œæ–¹æ³•åˆèƒ½æœ‰ç§æœ‰å­—æ®µå’Œç§æœ‰æ–¹æ³•çš„å½¢æ€</p>
<p>æœ¬ç¯‡æ–‡ç« å°±æ¥ä»‹ç» Python ç±»ä¸­å„ä¸ªèµ„æºçš„è®¿é—®è§„åˆ™</p>
</blockquote>
<h1 id="å­—æ®µ"><a href="#å­—æ®µ" class="headerlink" title="å­—æ®µ"></a>å­—æ®µ</h1><h2 id="å…¬æœ‰é™æ€å­—æ®µ"><a href="#å…¬æœ‰é™æ€å­—æ®µ" class="headerlink" title="å…¬æœ‰é™æ€å­—æ®µ"></a>å…¬æœ‰é™æ€å­—æ®µ</h2><ul>
<li>åœ¨ç±»çš„å¤–éƒ¨ä½¿ç”¨å¯¹è±¡åè®¿é—®</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">    name = <span class="string">'polarsnow'</span></span><br><span class="line"></span><br><span class="line">a = A()</span><br><span class="line">print(a.name)</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœä¸º:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">polarsnow</span><br></pre></td></tr></table></figure>

<p>æ­¤ç§å½¢æ€æ˜¯ä½¿ç”¨å®ä¾‹åŒ–åçš„å¯¹è±¡å»è®¿é—®çš„é™æ€å­—æ®µ, ä¸€èˆ¬æƒ…å†µä¸‹, æœ€å¥½ç”¨å¯¹è±¡å»è®¿é—®å¯¹è±¡è‡ªå·±çš„æ™®é€šå­—æ®µ, ä¸è¦ç”¨å¯¹è±¡æ¥è®¿é—®é™æ€å­—æ®µ</p>
<ul>
<li>åœ¨ç±»çš„å¤–éƒ¨ä½¿ç”¨ç±»åè®¿é—®</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">    name = <span class="string">'polarsnow'</span></span><br><span class="line"></span><br><span class="line">print(A.name)</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœä¸º:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">polarsnow</span><br></pre></td></tr></table></figure>

<p>æ­¤ç§å½¢æ€æ˜¯ä¸€èˆ¬æƒ…å†µä¸‹, æ­£ç¡®è®¿é—®ç±»ä¸­é™æ€å­—æ®µçš„æ–¹å¼, å³ä½¿ç”¨ç±»åè®¿é—®</p>
<ul>
<li>åœ¨ç±»çš„å†…éƒ¨ä½¿ç”¨å¯¹è±¡è®¿é—®</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">    name = <span class="string">'polarsnow'</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.name</span><br><span class="line"></span><br><span class="line">a = A()</span><br><span class="line">print(a.f())</span><br></pre></td></tr></table></figure>

<p>æ­¤ç§æƒ…å†µæ˜¯åœ¨ç±»çš„å†…éƒ¨, é€šè¿‡ä¸€ä¸ªæ–¹æ³•æ¥è·å–ç±»ä¸­é™æ€å­—æ®µçš„å€¼, åœ¨æ–¹æ³•ä¸­, ä½¿ç”¨äº†å¯¹è±¡çš„åå­—å»è°ƒç”¨è·å–äº†ç±»ä¸­é™æ€å­—æ®µçš„å€¼, ä¸€èˆ¬æƒ…å†µä¸‹, ä¸Šé¢ä¹Ÿè¯´äº†, å¯¹äºç±»ä¸­å¯¹é™æ€å­—æ®µçš„è®¿é—®, éœ€è¦ä½¿ç”¨ç±»åå»å®ç°, ä¸æ¨èä½¿ç”¨å¯¹è±¡åå»è°ƒç”¨</p>
<ul>
<li>åœ¨ç±»çš„å†…éƒ¨ä½¿ç”¨ç±»åè®¿é—®</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">    name = <span class="string">'polarsnow'</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> A.name</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f2</span><span class="params">(cls)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> cls.name</span><br><span class="line"></span><br><span class="line">a = A()</span><br><span class="line">print(a.f())</span><br><span class="line">print(a.f2())</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœä¸º:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">polarsnow</span><br><span class="line">polarsnow</span><br></pre></td></tr></table></figure>



<p>æ­¤ç§æƒ…å†µä¸‹, æˆ‘é€šè¿‡ä¸¤ç§æ–¹å¼, ç”¨ç±»åè·å–äº†é™æ€å­—æ®µçš„å€¼. å¦‚æœä½¿ç”¨æ™®é€šæ–¹æ³•çš„è¯, é»˜è®¤æ–¹æ³•å†…çš„å½¢å‚åªä¼ é€’äº†å¯¹è±¡çš„åå­—, å¦‚æœæƒ³æ˜¾ç¤ºåœ°è°ƒç”¨ç±»ä¸­çš„é™æ€å­—æ®µçš„è¯, éœ€è¦æ˜ç¡®åœ°æŒ‡å®šç±»å; ä½†æ˜¯å¦‚æœæ˜¯ç”¨å¯¹è±¡æ–¹æ³•çš„è¯, å¯¹è±¡æ–¹æ³•é»˜è®¤å¸®æˆ‘ä»¬ä¼ é€’äº†å¯¹è±¡çš„åå­—, æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>cls</code>å˜é‡ç›´æ¥è°ƒç”¨é™æ€å­—æ®µ</p>
<h2 id="ç§æœ‰é™æ€å­—æ®µ"><a href="#ç§æœ‰é™æ€å­—æ®µ" class="headerlink" title="ç§æœ‰é™æ€å­—æ®µ"></a>ç§æœ‰é™æ€å­—æ®µ</h2><ul>
<li>åœ¨ç±»çš„å†…éƒ¨ä½¿ç”¨ç±»æ–¹æ³•è®¿é—®</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">    __name = <span class="string">'polarsnow'</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> A.__name</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f2</span><span class="params">(cls)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> cls.__name</span><br><span class="line"></span><br><span class="line">a = A()</span><br><span class="line">print(a.f())</span><br><span class="line">print(a.f2())</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœä¸º:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">polarsnow</span><br><span class="line">polarsnow</span><br></pre></td></tr></table></figure>

<p>ç§æœ‰çš„é™æ€å­—æ®µ, ä¸èƒ½åœ¨å¤–éƒ¨ä½¿ç”¨å¯¹è±¡æˆ–ç±»åè°ƒç”¨, åªèƒ½é€šè¿‡åœ¨ç±»çš„å†…éƒ¨è®¿é—®. ä¸Šé¢çš„ä¾‹å­æä¾›äº†ä¸¤ç§æ–¹å¼æ¥è®¿é—®ç§æœ‰çš„é™æ€å­—æ®µ. ä¸€ç§æ˜¯åœ¨æ™®é€šæ–¹æ³•å†…é€šè¿‡æ˜¾ç¤ºæŒ‡å®šæ¥è®¿é—®, ä¸€ç§æ˜¯åœ¨ç±»æ–¹æ³•ä¸­, é€šè¿‡å½¢å‚, éšå¼åœ°é€šè¿‡<code>cls</code>ç±»åæ¥è®¿é—®</p>
<h1 id="æ–¹æ³•"><a href="#æ–¹æ³•" class="headerlink" title="æ–¹æ³•"></a>æ–¹æ³•</h1><h2 id="å…¬æœ‰æ–¹æ³•"><a href="#å…¬æœ‰æ–¹æ³•" class="headerlink" title="å…¬æœ‰æ–¹æ³•"></a>å…¬æœ‰æ–¹æ³•</h2><ul>
<li>é™æ€æ–¹æ³•</li>
<li>æ™®é€šæ–¹æ³•</li>
<li>ç±»æ–¹æ³•</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">    name = <span class="string">'polarsnow'</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.name</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f2</span><span class="params">(cls)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> cls.name</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f3</span><span class="params">()</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'123'</span></span><br><span class="line"></span><br><span class="line">a = A(<span class="string">'lvrui'</span>)</span><br><span class="line">print(a.f())</span><br><span class="line">print(a.f2())</span><br><span class="line">print(a.f3())</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœä¸º:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">lvrui</span><br><span class="line">polarsnow</span><br><span class="line">123</span><br></pre></td></tr></table></figure>

<p>åœ¨æ™®é€šæ–¹æ³•ä¸­, python éšå¼ä¼ é€’äº†å¯¹è±¡å; åœ¨ç±»æ–¹æ³•æ€», python éšå¼ä¼ é€’äº†ç±»å; è€Œé™æ€æ–¹æ³•çš„æœ¬è´¨æ—¢æ²¡æœ‰ç”¨åˆ°å¯¹è±¡ä¹Ÿæ²¡æœ‰ç”¨åˆ°ç±», å¦‚æœé™æ€æ–¹æ³•æ‹¿åˆ°å¤–é¢æ¥, å°±æ˜¯ python ä¸­æ™®é€šçš„å‡½æ•°è€Œå·², ä¹‹æ‰€ä»¥æŠŠè¿™ç§å‡½æ•°ä¹Ÿæ”¾åˆ°ç±»ä¸­,  æ˜¯ä¸ºäº†æ–¹ä¾¿ç±»ä¸­ç›¸å…³æ“ä½œçš„èšåˆ, åŒä¸€ç±»çš„æ“ä½œæ”¾åˆ°åŒä¸€ä¸ªç±»ä¸‹</p>
<h2 id="ç§æœ‰æ–¹æ³•"><a href="#ç§æœ‰æ–¹æ³•" class="headerlink" title="ç§æœ‰æ–¹æ³•"></a>ç§æœ‰æ–¹æ³•</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">    name = <span class="string">'polarsnow'</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__f</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">ff</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.__f()</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__f2</span><span class="params">(cls)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> cls.name</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">ff2</span><span class="params">(cls)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> cls.__f2()</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__f3</span><span class="params">()</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'123'</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">ff3</span><span class="params">()</span>:</span></span><br><span class="line">        <span class="keyword">return</span> A.__f3()</span><br><span class="line"></span><br><span class="line">a = A(<span class="string">'lvrui'</span>)</span><br><span class="line">print(a.ff())</span><br><span class="line">print(a.ff2())</span><br><span class="line">print(a.ff3())</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœä¸º:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">lvrui</span><br><span class="line">polarsnow</span><br><span class="line">123</span><br></pre></td></tr></table></figure>

<p>æ¯ç§ç±»å‹çš„æ–¹æ³•è®¿é—®å‡å¯ä»¥è®¿é—®è‡ªå·±çš„ç§æœ‰æ–¹æ³•. åœ¨å…±æœ‰é™æ€æ–¹æ³•è°ƒç”¨ç§æœ‰é™æ€æ–¹æ³•æ—¶éœ€è¦æ³¨æ„, åªèƒ½ä½¿ç”¨ç±»åå»è®¿é—®ç§æœ‰é™æ€æ–¹æ³•</p>
<p>åœ¨å®é™…ä½¿ç”¨ä¸­, å¯¹äºç§æœ‰æ–¹æ³•çš„è®¿é—®, ä¹Ÿå¯ä»¥è·¨ç±»å‹è®¿é—®, æ¯”å¦‚æˆ‘å¯ä»¥ç”¨ä¸€ä¸ªæ™®é€šæ–¹æ³•å»è°ƒç”¨ä¸€ä¸ªç§æœ‰çš„ç±»æ–¹æ³•</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">    name = <span class="string">'polarsnow'</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.__f2()</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__f2</span><span class="params">(cls)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> cls.name</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">a = A(<span class="string">'lvrui'</span>)</span><br><span class="line">print(a.f())</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœä¸º:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">polarsnow</span><br></pre></td></tr></table></figure>

<h1 id="å±æ€§"><a href="#å±æ€§" class="headerlink" title="å±æ€§"></a>å±æ€§</h1><h2 id="ç§æœ‰å±æ€§"><a href="#ç§æœ‰å±æ€§" class="headerlink" title="ç§æœ‰å±æ€§"></a>ç§æœ‰å±æ€§</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__name</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'polarsnow'</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">n</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.__name</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">a = A()</span><br><span class="line">print(a.n)</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç»“æœä¸º:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">polarsnow</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>æ–¹æ³•</tag>
        <tag>å­—æ®µ</tag>
        <tag>å±æ€§</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¿®æ”¹gitlabç®¡ç†å‘˜è´¦æˆ·å¯†ç </title>
    <url>/2017/07/11/%E4%BF%AE%E6%94%B9gitlab%E7%AE%A1%E7%90%86%E5%91%98%E8%B4%A6%E6%88%B7%E5%AF%86%E7%A0%81/</url>
    <content><![CDATA[<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@cord-gitlab-128-92 ~]<span class="comment"># gitlab-rails console production</span></span><br><span class="line">Loading production environment (Rails 4.2.7.1)</span><br><span class="line">irb(main):001:0&gt; u = User.where(id: 1).first</span><br><span class="line">=&gt; <span class="comment">#&lt;User id: 1, email: "admin@example.com", created_at: "2016-11-03 10:17:48", updated_at: "2017-07-11 03:21:27", name: "Administrator", admin: true, projects_limit: 10, skype: "", linkedin: "", twitter: "", authentication_token: "eTsFFy-5tb7qXAKLS1jf", theme_id: 2, bio: nil, username: "root", can_create_group: true, can_create_team: false, state: "active", color_scheme_id: 1, password_expires_at: nil, created_by_id: nil, last_credential_check_at: nil, avatar: nil, hide_no_ssh_key: false, website_url: "", notification_email: "admin@example.com", hide_no_password: false, password_automatically_set: false, location: nil, encrypted_otp_secret: nil, encrypted_otp_secret_iv: nil, encrypted_otp_secret_salt: nil, otp_required_for_login: false, otp_backup_codes: nil, public_email: "", dashboard: 0, project_view: 0, consumed_timestep: nil, layout: 0, hide_project_limit: false, otp_grace_period_started_at: nil, ldap_email: false, external: false, organization: nil&gt;</span></span><br><span class="line">irb(main):002:0&gt; u.password = <span class="string">'NewPassword2017'</span></span><br><span class="line">=&gt; <span class="string">"NewPassword2017"</span></span><br><span class="line">irb(main):003:0&gt; u.save!</span><br><span class="line">Enqueued ActionMailer::DeliveryJob (Job ID: 6b4cf332-80c1-4b3e-a158-efb04e66940c) to Sidekiq(mailers) with arguments: <span class="string">"DeviseMailer"</span>, <span class="string">"password_change"</span>, <span class="string">"deliver_now"</span>, gid://gitlab/User/1</span><br><span class="line">=&gt; <span class="literal">true</span></span><br><span class="line">irb(main):004:0&gt;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>gitlab</tag>
      </tags>
  </entry>
  <entry>
    <title>ç¼–å†™ docker-entrypoint.sh å…¥å£æ–‡ä»¶</title>
    <url>/2017/06/09/%E7%BC%96%E5%86%99docker-entrypoint-sh%E5%85%A5%E5%8F%A3%E6%96%87%E4%BB%B6/</url>
    <content><![CDATA[<blockquote>
<p>åœ¨ docker çš„å®˜æ–¹ Registry ä¸­(store.docker.com) æµè¡Œçš„ç¬¬ä¸‰æ–¹åº”ç”¨åœ¨è‡ªå·±çš„é¡µé¢ä¸­éƒ½æä¾›äº† dockerfile çš„é“¾æ¥. è€Œå¾ˆå¤š dockerfile çš„ ENTRYPOINT å‘½ä»¤éƒ½æ˜¯è¿™ä¹ˆå†™çš„ <code>[&quot;docker-entrypoint.sh&quot;]</code> æœ¬ç¯‡æ–‡ç« å°±æ‰«ç›²ä¸‹ docker-entrypoint.sh çš„ç‰¹æ®Šç”¨æ³•å’Œè®¾è®¡é€»è¾‘</p>
</blockquote>
<h2 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h2><h2 id="set-e"><a href="#set-e" class="headerlink" title="set -e"></a>set -e</h2><p>ä½ å†™çš„æ¯ä¸ªè„šæœ¬éƒ½åº”è¯¥åœ¨æ–‡ä»¶å¼€å¤´åŠ ä¸Š<code>set -e</code>, è¿™å¥è¯­å¥å‘Šè¯‰bashå¦‚æœä»»ä½•è¯­å¥çš„æ‰§è¡Œç»“æœä¸æ˜¯<code>true</code>åˆ™åº”è¯¥é€€å‡º. è¿™æ ·çš„å¥½å¤„æ˜¯é˜²æ­¢é”™è¯¯åƒæ»šé›ªçƒèˆ¬å˜å¤§å¯¼è‡´ä¸€ä¸ªè‡´å‘½çš„é”™è¯¯, è€Œè¿™äº›é”™è¯¯æœ¬åº”è¯¥åœ¨ä¹‹å‰å°±è¢«å¤„ç†æ‰. å¦‚æœè¦å¢åŠ å¯è¯»æ€§, å¯ä»¥ä½¿ç”¨<code>set -o errexit</code>, å®ƒçš„ä½œç”¨ä¸<code>set -e</code>ç›¸åŒ</p>
<h2 id="set-o-pipefail"><a href="#set-o-pipefail" class="headerlink" title="set -o pipefail"></a>set -o pipefail</h2><p>è®¾è®¡ç”¨é€”åŒä¸Š, å°±æ˜¯å¸Œæœ›åœ¨æ‰§è¡Œé”™è¯¯ä¹‹åç«‹å³é€€å‡º, ä¸è¦å†å‘ä¸‹æ‰§è¡Œäº†. è€Œ <code>-o pipefail</code> çš„ä½œç”¨åŸŸæ˜¯ç®¡é“, ä¹Ÿå°±æ˜¯è¯´åœ¨ Linux è„šæœ¬ä¸­çš„ç®¡é“, å¦‚æœå‰é¢çš„å‘½ä»¤æ‰§è¡Œå‡ºäº†é—®é¢˜, åº”è¯¥ç«‹å³é€€å‡º</p>
<h2 id="shopt-s-nullglob"><a href="#shopt-s-nullglob" class="headerlink" title="shopt -s nullglob"></a>shopt -s nullglob</h2><p>åœ¨ä½¿ç”¨ Linux ä¸­çš„é€šé…ç¬¦æ—¶ <code>* ?ç­‰</code> å¦‚æœæ²¡æœ‰åŒ¹é…åˆ°ä»»ä½•æ–‡ä»¶, ä¸ä¼šæŠ¥ <code>No such file or directory</code> è€Œæ˜¯å°†å‘½ä»¤åé¢çš„å‚æ•°å»æ‰æ‰§è¡Œ</p>
<h2 id="if-â€œ-1-0-1-â€-â€˜-â€˜-thenâ€¦"><a href="#if-â€œ-1-0-1-â€-â€˜-â€˜-thenâ€¦" class="headerlink" title="if [ â€œ${1:0:1}â€ = â€˜-â€˜ ]; thenâ€¦"></a>if [ â€œ${1:0:1}â€ = â€˜-â€˜ ]; thenâ€¦</h2><p>è¿™æ˜¯ä¸€ä¸ªåˆ¤æ–­è¯­å¥, åœ¨å®˜æ–¹æ–‡ä»¶ä¸­, ä¸Šä¸€è¡Œå·²ç»ç»™å‡ºäº†æ³¨é‡Š: <code>if command starts with an option, prepend mysqld</code></p>
<p>è¿™ä¸ªåˆ¤æ–­è¯­å¥æ˜¯ <code>${1:0:1}</code> æ„æ€æ˜¯åˆ¤æ–­ $1(è°ƒç”¨è¯¥è„šæœ¬çš„ç¬¬ä¸€ä¸ªå‚æ•°), åç§»é‡0(ä¸åç§»), å–ä¸€ä¸ªå­—ç¬¦(å–å­—ç¬¦ä¸²çš„é•¿åº¦)</p>
<p>å¦‚æœåˆ¤æ–­å‡ºæ¥è°ƒç”¨è¿™ä¸ªè„šæœ¬åé¢æ‰€è·Ÿçš„å‚æ•°ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯<code>-</code>ä¸­æ¨ªçº¿çš„è¯, å°±è®¤ä¸ºåé¢çš„æ‰€æœ‰å­—ç¬¦ä¸²éƒ½æ˜¯ mysqld çš„å¯åŠ¨å‚æ•°</p>
<p>ä¸Šé¢çš„è¿™ä¸ªæ“ä½œç±»ä¼¼äº Python çš„å­—ç¬¦ä¸²åˆ‡ç‰‡</p>
<h2 id="set-â€“-mysqld-â€œ-â€"><a href="#set-â€“-mysqld-â€œ-â€" class="headerlink" title="set â€“ mysqld â€œ$@â€"></a>set â€“ mysqld â€œ$@â€</h2><p>åœ¨ä¸Šé¢åˆ¤æ–­å®Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯<code>-</code>å¼€å¤´ä¹‹å,  ç´§æ¥ç€å°±æ‰§è¡Œäº† <code>set -- mysqld &quot;$@&quot;</code> è¿™ä¸ªå‘½ä»¤. ä½¿ç”¨äº† <code>set --</code> çš„ç”¨æ³•. <code>set â€”</code>ä¼šå°†ä»–åé¢æ‰€æœ‰ä»¥ç©ºæ ¼åŒºåˆ†çš„å­—ç¬¦ä¸², æŒ‰é¡ºåºåˆ†åˆ«å­˜å‚¨åˆ°$1, $2, $3 å˜é‡ä¸­, å…¶ä¸­æ–°çš„<code>$@</code> ä¸º <code>set â€”</code> åé¢çš„å…¨éƒ¨å†…å®¹</p>
<p>ä¸¾ä¾‹æ¥è¯´: <code>bash docker-entrypoint.sh -f xxx.conf</code></p>
<p>åœ¨è¿™ç§æƒ…å†µä¸‹, <code>set -- mysqld &quot;$@&quot;</code> ä¸­çš„ <code>$@</code> çš„å€¼ä¸º <code>-f xxx.conf</code></p>
<p>å½“æ‰§è¡Œå®Œ <code>set -- mysqld &quot;$@&quot;</code> è¿™æ¡å‘½ä»¤å:</p>
<ul>
<li><code>$1=mysqld</code></li>
<li><code>$2=-f</code></li>
<li><code>$3=xxx.conf</code></li>
<li><code>$@=mysqld -f xxx.conf</code></li>
</ul>
<p>å¯ä»¥çœ‹åˆ°, å½“æ‰§è¡Œ <code>docker-entrypoint.sh</code>è„šæœ¬çš„æ—¶å€™åé¢åŠ äº† <code>-x</code>å½¢å¼çš„å‚æ•°ä¹‹å, $@çš„å€¼å‘ç”Ÿçš„æ”¹å˜, åœ¨åŸæœ‰$@å€¼çš„åŸºç¡€ä¹‹ä¸Š, åœ¨å‰é¢åˆé¢„æ·»åŠ äº† mysqld å‘½ä»¤</p>
<h2 id="exec-â€œ-â€"><a href="#exec-â€œ-â€" class="headerlink" title="exec â€œ$@â€"></a>exec â€œ$@â€</h2><p>å‡ ä¹åœ¨æ¯ä¸ª <code>docker-entrypoint.sh</code> è„šæœ¬çš„æœ€åä¸€è¡Œ, æ‰§è¡Œçš„éƒ½æ˜¯ <code>exec &quot;$@&quot;</code>å‘½ä»¤</p>
<p>è¿™ä¸ªå‘½ä»¤çš„æ„ä¹‰åœ¨äºä½ å·²ç»ä¸ºä½ çš„é•œåƒé¢„æƒ³åˆ°äº†åº”è¯¥æœ‰çš„è°ƒç”¨æƒ…å†µ, å½“å®é™…ä½¿ç”¨é•œåƒçš„äººæ‰§è¡Œäº†ä½ æ²¡æœ‰é¢„æ–™åˆ°çš„å¯æ‰§è¡Œå‘½ä»¤æ—¶, å°†ä¼šèµ°åˆ°è„šæœ¬çš„è¿™æœ€åä¸€è¡Œ, å»æ‰§è¡Œç”¨æˆ·æ–°çš„å¯æ‰§è¡Œå‘½ä»¤</p>
<h2 id="æƒ…å†µåˆ¤æ–­"><a href="#æƒ…å†µåˆ¤æ–­" class="headerlink" title="æƒ…å†µåˆ¤æ–­"></a>æƒ…å†µåˆ¤æ–­</h2><p>ä¸Šé¢ç›´æ¥è¯´äº†è„šæœ¬çš„æœ€åä¸€è¡Œ, åœ¨ä¹‹å‰çš„è„šæœ¬ä¸­, éœ€è¦å……åˆ†çš„å»è€ƒè™‘ä½ è‡ªå·±çš„è„šæœ¬å¯èƒ½ä¼šè¢«è°ƒç”¨çš„æƒ…å†µ. è¿˜æ˜¯æ‹¿ MySQL å®˜æ–¹çš„ dockerfile æ¥è¯´, ä»–åˆ¤æ–­ä»¥ä¸‹æƒ…å†µ:</p>
<ul>
<li>å¼€å¤´æ˜¯ <code>-</code> , è®¤ä¸ºæ˜¯å‚æ•°çš„æƒ…å†µ</li>
<li>å¼€å¤´æ˜¯ <code>mysqld</code>, ä¸”ç”¨æˆ· id ä¸º0 (root ç”¨æˆ·) çš„æƒ…å†µ</li>
<li>å¼€å¤´æ˜¯ <code>mysqld</code> çš„æƒ…å†µ</li>
</ul>
<p>åˆ¤æ–­å®Œè‡ªå·±åº”ç”¨çš„æ‰€æœ‰è°ƒç”¨å½¢æ€ä¹‹å, æœ€ååº”è¯¥åŠ ä¸Š<code>exec &quot;$@&quot;</code> å‘½ä»¤å…œåº•</p>
<h2 id="mysql"><a href="#mysql" class="headerlink" title="${mysql[@]}"></a>${mysql[@]}</h2><p>Shell ä¸­çš„æ•°ç»„, ç›´æ¥æ‰§è¡Œ <code>${mysql[@]}</code> ä¼šæŠŠè¿™ä¸ªæ•°ç»„å½“åšå¯æ‰§è¡Œç¨‹åºæ¥æ‰§è¡Œ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">âœ  /tmp mysql=( mysql --protocol=socket -uroot -hlocalhost --socket=<span class="string">"<span class="variable">$&#123;SOCKET&#125;</span>"</span> )</span><br><span class="line">âœ  /tmp <span class="built_in">echo</span> <span class="variable">$&#123;mysql[1]&#125;</span></span><br><span class="line">mysql</span><br><span class="line">âœ  /tmp <span class="built_in">echo</span> <span class="variable">$&#123;mysql[2]&#125;</span></span><br><span class="line">--protocol=socket</span><br><span class="line">âœ  /tmp <span class="built_in">echo</span> <span class="variable">$&#123;mysql[3]&#125;</span></span><br><span class="line">-uroot</span><br><span class="line">âœ  /tmp <span class="built_in">echo</span> <span class="variable">$&#123;mysql[4]&#125;</span></span><br><span class="line">-hlocalhost</span><br><span class="line">âœ  /tmp <span class="built_in">echo</span> <span class="variable">$&#123;mysql[@]&#125;</span></span><br><span class="line">mysql --protocol=socket -uroot -hlocalhost --socket=</span><br></pre></td></tr></table></figure>



<h2 id="exec-gosu-mysql-â€œ-BASH-SOURCEâ€-â€œ-â€"><a href="#exec-gosu-mysql-â€œ-BASH-SOURCEâ€-â€œ-â€" class="headerlink" title="exec gosu mysql â€œ$BASH_SOURCEâ€ â€œ$@â€"></a>exec gosu mysql â€œ$BASH_SOURCEâ€ â€œ$@â€</h2><p>è¿™é‡Œçš„ gosu å‘½ä»¤, æ˜¯ Linux ä¸­ sudo å‘½ä»¤çš„è½»é‡çº§â€æ›¿ä»£å“â€</p>
<p>gosu æ˜¯ä¸€ä¸ª golang è¯­è¨€å¼€å‘çš„å·¥å…·, ç”¨æ¥å–ä»£ shell ä¸­çš„ sudo å‘½ä»¤. su å’Œ sudo å‘½ä»¤æœ‰ä¸€äº›ç¼ºé™·, ä¸»è¦æ˜¯ä¼šå¼•èµ·ä¸ç¡®å®šçš„ TTY, å¯¹ä¿¡å·é‡çš„è½¬å‘ä¹Ÿå­˜åœ¨é—®é¢˜. å¦‚æœä»…ä»…ä¸ºäº†ä½¿ç”¨ç‰¹å®šçš„ç”¨æˆ·è¿è¡Œç¨‹åº, ä½¿ç”¨ su æˆ– sudo æ˜¾å¾—å¤ªé‡äº†, ä¸ºæ­¤ gosu åº”è¿è€Œç”Ÿ.</p>
<p>gosu ç›´æ¥å€Ÿç”¨äº† libcontainer åœ¨å®¹å™¨ä¸­å¯åŠ¨åº”ç”¨ç¨‹åºçš„åŸç†, ä½¿ç”¨ <code>/etc/passwd</code> å¤„ç†åº”ç”¨ç¨‹åº. gosu é¦–å…ˆæ‰¾å‡ºæŒ‡å®šçš„ç”¨æˆ·æˆ–ç”¨æˆ·ç»„, ç„¶ååˆ‡æ¢åˆ°è¯¥ç”¨æˆ·æˆ–ç”¨æˆ·ç»„. æ¥ä¸‹æ¥, ä½¿ç”¨ exec å¯åŠ¨åº”ç”¨ç¨‹åº. åˆ°æ­¤ä¸ºæ­¢, gosu å®Œæˆäº†å®ƒçš„å·¥ä½œ, ä¸ä¼šå‚ä¸åˆ°åº”ç”¨ç¨‹åºåé¢çš„å£°æ˜å‘¨æœŸä¸­. ä½¿ç”¨è¿™ç§æ–¹å¼é¿å…äº† gosu å¤„ç† TTY å’Œè½¬å‘ä¿¡å·é‡çš„é—®é¢˜, æŠŠè¿™ä¸¤ä¸ªå·¥ä½œç›´æ¥äº¤ç»™äº†åº”ç”¨ç¨‹åºå»å®Œæˆ</p>
<hr>
<p>å‚è€ƒæ–‡æ¡£:</p>
<ul>
<li>set -e: <a href="http://blog.csdn.net/todd911/article/details/9954961" target="_blank" rel="noopener">http://blog.csdn.net/todd911/article/details/9954961</a></li>
<li>set -o pipefail: <a href="http://blog.sina.com.cn/s/blog_8bb0a3bd010171cp.html" target="_blank" rel="noopener">http://blog.sina.com.cn/s/blog_8bb0a3bd010171cp.html</a></li>
<li>shopt -s nullglob: <a href="http://mywiki.wooledge.org/glob#nullglob" target="_blank" rel="noopener">http://mywiki.wooledge.org/glob#nullglob</a></li>
</ul>
]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>Shell</tag>
        <tag>entrypoint</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL5.7 å­—ç¬¦é›†è®¾ç½®</title>
    <url>/2017/06/07/MySQL57%E5%AD%97%E7%AC%A6%E9%9B%86%E8%AE%BE%E7%BD%AE/</url>
    <content><![CDATA[<h1 id="MySQL5-7-å­—ç¬¦é›†è®¾ç½®"><a href="#MySQL5-7-å­—ç¬¦é›†è®¾ç½®" class="headerlink" title="MySQL5.7 å­—ç¬¦é›†è®¾ç½®"></a>MySQL5.7 å­—ç¬¦é›†è®¾ç½®</h1><blockquote>
<ul>
<li>character-set-client-handshake = FALSE</li>
<li>character-set-server = utf8mb4</li>
<li>collation-server = utf8mb4_unicode_ci</li>
<li>init_connect=â€™SET NAMES utf8mb4â€™</li>
</ul>
</blockquote>
<h1 id="character-set-client-handshake"><a href="#character-set-client-handshake" class="headerlink" title="character-set-client-handshake"></a>character-set-client-handshake</h1><p>ç”¨æ¥æ§åˆ¶å®¢æˆ·ç«¯å£°æ˜ä½¿ç”¨å­—ç¬¦é›†å’ŒæœåŠ¡ç«¯å£°æ˜ä½¿ç”¨çš„å­—ç¬¦é›†åœ¨ä¸ä¸€è‡´çš„æƒ…å†µä¸‹çš„å…¼å®¹æ€§.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">character-set-client-handshake = <span class="literal">false</span></span><br><span class="line"><span class="comment"># è®¾ç½®ä¸º False, åœ¨å®¢æˆ·ç«¯å­—ç¬¦é›†å’ŒæœåŠ¡ç«¯å­—ç¬¦é›†ä¸åŒçš„æ—¶å€™å°†æ‹’ç»è¿æ¥åˆ°æœåŠ¡ç«¯æ‰§è¡Œä»»ä½•æ“ä½œ</span></span><br></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é»˜è®¤ä¸º true</span></span><br><span class="line">character-set-client-handshake = <span class="literal">true</span></span><br><span class="line"><span class="comment"># è®¾ç½®ä¸º True, å³ä½¿å®¢æˆ·ç«¯å­—ç¬¦é›†å’ŒæœåŠ¡ç«¯å­—ç¬¦é›†ä¸åŒ, ä¹Ÿå…è®¸å®¢æˆ·ç«¯è¿æ¥</span></span><br></pre></td></tr></table></figure>



<h1 id="character-set-server"><a href="#character-set-server" class="headerlink" title="character-set-server"></a>character-set-server</h1><p>å£°æ˜æœåŠ¡ç«¯çš„å­—ç¬¦ç¼–ç , æ¨èä½¿ç”¨<code>utf8mb4</code> , è¯¥å­—ç¬¦è™½ç„¶å ç”¨ç©ºé—´ä¼šæ¯”è¾ƒå¤§, ä½†æ˜¯å¯ä»¥å…¼å®¹ emoji ğŸ˜ˆ è¡¨æƒ…çš„å­˜å‚¨</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">character-set-server = utf8mb4</span><br></pre></td></tr></table></figure>



<h1 id="collation-server"><a href="#collation-server" class="headerlink" title="collation-server"></a>collation-server</h1><p>å£°æ˜æœåŠ¡ç«¯çš„å­—ç¬¦é›†, å­—ç¬¦ç¼–ç å’Œå­—ç¬¦é›†ä¸€ä¸€å¯¹åº”, æ—¢ç„¶ä½¿ç”¨äº†<code>utf8mb4</code>çš„å­—ç¬¦é›†, å°±è¦å£°æ˜ä½¿ç”¨å¯¹åº”çš„å­—ç¬¦ç¼–ç </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">collation-server = utf8mb4_unicode_ci</span><br></pre></td></tr></table></figure>



<h1 id="init-connect"><a href="#init-connect" class="headerlink" title="init_connect"></a>init_connect</h1><p><code>init_connect</code> æ˜¯ç”¨æˆ·ç™»å½•åˆ°æ•°æ®åº“ä¸Šä¹‹å, åœ¨æ‰§è¡Œç¬¬ä¸€æ¬¡æŸ¥è¯¢ä¹‹å‰æ‰§è¡Œé‡Œé¢çš„å†…å®¹. å¦‚æœ <code>init_connect</code> çš„å†…å®¹æœ‰è¯­æ³•é”™è¯¯, å¯¼è‡´æ‰§è¡Œå¤±è´¥, ä¼šå¯¼è‡´ç”¨æˆ·æ— æ³•æ‰§è¡ŒæŸ¥è¯¢, ä»mysql é€€å‡º</p>
<p>ä½¿ç”¨ <code>init_connect</code> æ‰§è¡Œ <code>SET NAMES utf8mb4</code> æ„ä¸º:</p>
<ul>
<li>å£°æ˜è‡ªå·±(å®¢æˆ·ç«¯)ä½¿ç”¨çš„æ˜¯ <code>utf8mb4</code> çš„å­—ç¬¦ç¼–ç </li>
<li>å¸Œæœ›æœåŠ¡å™¨è¿”å›ç»™è‡ªå·± <code>utf8mb4</code> çš„æŸ¥è¯¢ç»“æœ</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">init_connect = <span class="string">'SET NAMES utf8mb4'</span></span><br></pre></td></tr></table></figure>



<h1 id="å®Œæ•´é…ç½®"><a href="#å®Œæ•´é…ç½®" class="headerlink" title="å®Œæ•´é…ç½®"></a>å®Œæ•´é…ç½®</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">character-set-client-handshake = FALSE</span><br><span class="line">character-set-server = utf8mb4</span><br><span class="line">collation-server = utf8mb4_unicode_ci</span><br><span class="line">init_connect = <span class="string">'SET NAMES utf8mb4'</span></span><br></pre></td></tr></table></figure>

<hr>
<p>å‚è€ƒæ–‡ç« :</p>
<ul>
<li><a href="http://www.jb51.net/article/29576.htm" target="_blank" rel="noopener">http://www.jb51.net/article/29576.htm</a></li>
<li><a href="http://www.jb51.net/article/52511.htm" target="_blank" rel="noopener">http://www.jb51.net/article/52511.htm</a></li>
<li><a href="http://www.tuicool.com/articles/2IRVV3" target="_blank" rel="noopener">http://www.tuicool.com/articles/2IRVV3</a></li>
<li><a href="http://jbisbee.blogspot.com/2013/07/set-utf-8-as-default-mysql-encoding.html" target="_blank" rel="noopener">http://jbisbee.blogspot.com/2013/07/set-utf-8-as-default-mysql-encoding.html</a></li>
</ul>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>å­—ç¬¦é›†</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL5.7 é«˜å¯ç”¨é«˜æ€§èƒ½é…ç½®è°ƒä¼˜</title>
    <url>/2017/06/07/MySQL57%E9%AB%98%E5%8F%AF%E7%94%A8%E9%AB%98%E6%80%A7%E8%83%BD%E6%9E%B6%E6%9E%84%E6%8C%81%E7%BB%AD%E8%B0%83%E4%BC%98/</url>
    <content><![CDATA[<blockquote>
<p>MySQL5.7 åœ¨ 5.6 ç‰ˆæœ¬çš„åŸºç¡€ä¹‹ä¸Šåšäº†å¤§é‡çš„ä¼˜åŒ–, æœ¬ç¯‡æ–‡ç« å¼€ç¯‡å°†é‡ç‚¹å›´ç»•ç»è¿‡ä¼˜åŒ–çš„åŸºäº GTID çš„å¤šçº¿ç¨‹å¤åˆ¶å’ŒåŠåŒæ­¥å¤åˆ¶çš„ç‰¹æ€§ä»‹ç», åç»­ä¼šæŒç»­å¢åŠ  MySQL5.7 çš„è°ƒä¼˜å‚æ•°</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[client]</span><br><span class="line">default-character-set &#x3D; utf8mb4</span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line"></span><br><span class="line">### åŸºæœ¬å±æ€§é…ç½®</span><br><span class="line">port &#x3D; 3306</span><br><span class="line">datadir&#x3D;&#x2F;data&#x2F;mysql</span><br><span class="line"># ç¦ç”¨ä¸»æœºåè§£æ</span><br><span class="line">skip-name-resolve</span><br><span class="line"># é»˜è®¤çš„æ•°æ®åº“å¼•æ“</span><br><span class="line">default-storage-engine &#x3D; InnoDB</span><br><span class="line"></span><br><span class="line">### å­—ç¬¦é›†é…ç½®</span><br><span class="line">character-set-client-handshake &#x3D; FALSE</span><br><span class="line">character-set-server &#x3D; utf8mb4</span><br><span class="line">collation-server &#x3D; utf8mb4_unicode_ci</span><br><span class="line">init_connect&#x3D;&#39;SET NAMES utf8mb4&#39;</span><br><span class="line"></span><br><span class="line">### GTID</span><br><span class="line">server_id &#x3D; 59</span><br><span class="line"># ä¸ºä¿è¯ GTID å¤åˆ¶çš„ç¨³å®š, è¡Œçº§æ—¥å¿—</span><br><span class="line">binlog_format &#x3D; row</span><br><span class="line"># å¼€å¯ gtid åŠŸèƒ½</span><br><span class="line">gtid_mode &#x3D; on</span><br><span class="line"># ä¿éšœ GTID äº‹åŠ¡å®‰å…¨</span><br><span class="line"># å½“å¯ç”¨enforce_gtid_consistencyåŠŸèƒ½çš„æ—¶å€™,</span><br><span class="line"># MySQLåªå…è®¸èƒ½å¤Ÿä¿éšœäº‹åŠ¡å®‰å…¨, å¹¶ä¸”èƒ½å¤Ÿè¢«æ—¥å¿—è®°å½•çš„SQLè¯­å¥è¢«æ‰§è¡Œ,</span><br><span class="line"># åƒcreate table ... select å’Œ create temporarytableè¯­å¥, </span><br><span class="line"># ä»¥åŠåŒæ—¶æ›´æ–°äº‹åŠ¡è¡¨å’Œéäº‹åŠ¡è¡¨çš„SQLè¯­å¥æˆ–äº‹åŠ¡éƒ½ä¸å…è®¸æ‰§è¡Œ</span><br><span class="line">enforce-gtid-consistency &#x3D; true</span><br><span class="line"># ä»¥ä¸‹ä¸¤æ¡é…ç½®ä¸ºä¸»ä»åˆ‡æ¢, æ•°æ®åº“é«˜å¯ç”¨çš„å¿…é¡»é…ç½®</span><br><span class="line"># å¼€å¯ binlog æ—¥å¿—åŠŸèƒ½</span><br><span class="line">log_bin &#x3D; on</span><br><span class="line"># å¼€å¯ä»åº“æ›´æ–° binlog æ—¥å¿—</span><br><span class="line">log-slave-updates &#x3D; on</span><br><span class="line"></span><br><span class="line">### æ…¢æŸ¥è¯¢æ—¥å¿—</span><br><span class="line"># æ‰“å¼€æ…¢æŸ¥è¯¢æ—¥å¿—åŠŸèƒ½</span><br><span class="line">slow_query_log &#x3D; 1</span><br><span class="line"># è¶…è¿‡2ç§’çš„æŸ¥è¯¢è®°å½•ä¸‹æ¥</span><br><span class="line">long_query_time &#x3D; 2</span><br><span class="line"># è®°å½•ä¸‹æ²¡æœ‰ä½¿ç”¨ç´¢å¼•çš„æŸ¥è¯¢</span><br><span class="line">log_queries_not_using_indexes &#x3D; 1</span><br><span class="line"></span><br><span class="line">### è‡ªåŠ¨ä¿®å¤</span><br><span class="line"># è®°å½• relay.info åˆ°æ•°æ®è¡¨ä¸­</span><br><span class="line">relay_log_info_repository &#x3D; TABLE</span><br><span class="line"># è®°å½• master.info åˆ°æ•°æ®è¡¨ä¸­ </span><br><span class="line">master_info_repository &#x3D; TABLE</span><br><span class="line"># å¯ç”¨ relaylog çš„è‡ªåŠ¨ä¿®å¤åŠŸèƒ½</span><br><span class="line">relay_log_recovery &#x3D; on</span><br><span class="line"># åœ¨ SQL çº¿ç¨‹æ‰§è¡Œå®Œä¸€ä¸ª relaylog åè‡ªåŠ¨åˆ é™¤</span><br><span class="line">relay_log_purge &#x3D; 1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### æ•°æ®å®‰å…¨æ€§é…ç½®</span><br><span class="line"># å…³é—­ master åˆ›å»º function çš„åŠŸèƒ½</span><br><span class="line">log_bin_trust_function_creators &#x3D; off</span><br><span class="line"># æ¯æ‰§è¡Œä¸€ä¸ªäº‹åŠ¡éƒ½å¼ºåˆ¶å†™å…¥ç£ç›˜</span><br><span class="line">sync_binlog &#x3D; 1</span><br><span class="line"># timestamp åˆ—å¦‚æœæ²¡æœ‰æ˜¾å¼å®šä¹‰ä¸º not null, åˆ™æ”¯æŒnullå±æ€§</span><br><span class="line"># è®¾ç½® timestamp çš„åˆ—å€¼ä¸º null, ä¸ä¼šè¢«è®¾ç½®ä¸º current timestamp</span><br><span class="line">explicit_defaults_for_timestamp&#x3D;true</span><br><span class="line"></span><br><span class="line">### ä¼˜åŒ–é…ç½®</span><br><span class="line"># ä¼˜åŒ–ä¸­æ–‡å…¨æ–‡æ¨¡ç³Šç´¢å¼•</span><br><span class="line">ft_min_word_len &#x3D; 1</span><br><span class="line"># é»˜è®¤åº“åè¡¨åä¿å­˜ä¸ºå°å†™, ä¸åŒºåˆ†å¤§å°å†™</span><br><span class="line">lower_case_table_names &#x3D; 1</span><br><span class="line"># å•æ¡è®°å½•å†™å…¥æœ€å¤§çš„å¤§å°é™åˆ¶</span><br><span class="line"># è¿‡å°å¯èƒ½ä¼šå¯¼è‡´å†™å…¥(å¯¼å…¥)æ•°æ®å¤±è´¥</span><br><span class="line">max_allowed_packet &#x3D; 256M</span><br><span class="line"># åŠåŒæ­¥å¤åˆ¶å¼€å¯</span><br><span class="line">rpl_semi_sync_master_enabled &#x3D; 1</span><br><span class="line">rpl_semi_sync_slave_enabled &#x3D; 1</span><br><span class="line"># åŠåŒæ­¥å¤åˆ¶è¶…æ—¶æ—¶é—´è®¾ç½®</span><br><span class="line">rpl_semi_sync_master_timeout &#x3D; 1000</span><br><span class="line"># å¤åˆ¶æ¨¡å¼(ä¿æŒç³»ç»Ÿé»˜è®¤)</span><br><span class="line">rpl_semi_sync_master_wait_point &#x3D; AFTER_SYNC</span><br><span class="line"># åç«¯åªè¦æœ‰ä¸€å°æ”¶åˆ°æ—¥å¿—å¹¶å†™å…¥ relaylog å°±ç®—æˆåŠŸ</span><br><span class="line">rpl_semi_sync_master_wait_slave_count &#x3D; 1</span><br><span class="line"># å¤šçº¿ç¨‹å¤åˆ¶</span><br><span class="line">slave_parallel_type &#x3D; logical_clock</span><br><span class="line">slave_parallel_workers &#x3D; 4</span><br><span class="line"></span><br><span class="line">### è¿æ¥æ•°é™åˆ¶</span><br><span class="line">max_connections &#x3D; 1500</span><br><span class="line"># éªŒè¯å¯†ç è¶…è¿‡20æ¬¡æ‹’ç»è¿æ¥</span><br><span class="line">max_connect_errors &#x3D; 20</span><br><span class="line"># back_logå€¼æŒ‡å‡ºåœ¨mysqlæš‚æ—¶åœæ­¢å›ç­”æ–°è¯·æ±‚ä¹‹å‰çš„çŸ­æ—¶é—´å†…å¤šå°‘ä¸ªè¯·æ±‚å¯ä»¥è¢«å­˜åœ¨å †æ ˆä¸­</span><br><span class="line"># ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœMySqlçš„è¿æ¥æ•°è¾¾åˆ°max_connectionsæ—¶ï¼Œæ–°æ¥çš„è¯·æ±‚å°†ä¼šè¢«å­˜åœ¨å †æ ˆä¸­</span><br><span class="line"># ä»¥ç­‰å¾…æŸä¸€è¿æ¥é‡Šæ”¾èµ„æºï¼Œè¯¥å †æ ˆçš„æ•°é‡å³back_logï¼Œå¦‚æœç­‰å¾…è¿æ¥çš„æ•°é‡è¶…è¿‡back_log</span><br><span class="line"># å°†ä¸è¢«æˆäºˆè¿æ¥èµ„æº</span><br><span class="line">back_log &#x3D; 500</span><br><span class="line">open_files_limit &#x3D; 65535</span><br><span class="line"># æœåŠ¡å™¨å…³é—­äº¤äº’å¼è¿æ¥å‰ç­‰å¾…æ´»åŠ¨çš„ç§’æ•°</span><br><span class="line">interactive_timeout &#x3D; 3600</span><br><span class="line"># æœåŠ¡å™¨å…³é—­éäº¤äº’è¿æ¥ä¹‹å‰ç­‰å¾…æ´»åŠ¨çš„ç§’æ•°</span><br><span class="line">wait_timeout &#x3D; 3600</span><br><span class="line"></span><br><span class="line">### å†…å­˜åˆ†é…</span><br><span class="line"># æŒ‡å®šè¡¨é«˜é€Ÿç¼“å­˜çš„å¤§å°ã€‚æ¯å½“MySQLè®¿é—®ä¸€ä¸ªè¡¨æ—¶ï¼Œå¦‚æœåœ¨è¡¨ç¼“å†²åŒºä¸­è¿˜æœ‰ç©ºé—´</span><br><span class="line"># è¯¥è¡¨å°±è¢«æ‰“å¼€å¹¶æ”¾å…¥å…¶ä¸­ï¼Œè¿™æ ·å¯ä»¥æ›´å¿«åœ°è®¿é—®è¡¨å†…å®¹</span><br><span class="line">table_open_cache &#x3D; 1024</span><br><span class="line"># ä¸ºæ¯ä¸ªsession åˆ†é…çš„å†…å­˜, åœ¨äº‹åŠ¡è¿‡ç¨‹ä¸­ç”¨æ¥å­˜å‚¨äºŒè¿›åˆ¶æ—¥å¿—çš„ç¼“å­˜</span><br><span class="line">binlog_cache_size &#x3D; 2M</span><br><span class="line"># åœ¨å†…å­˜çš„ä¸´æ—¶è¡¨æœ€å¤§å¤§å°</span><br><span class="line">tmp_table_size &#x3D; 128M</span><br><span class="line"># åˆ›å»ºå†…å­˜è¡¨çš„æœ€å¤§å¤§å°(ä¿æŒç³»ç»Ÿé»˜è®¤, ä¸å…è®¸åˆ›å»ºè¿‡å¤§çš„å†…å­˜è¡¨)</span><br><span class="line"># å¦‚æœæœ‰éœ€æ±‚å½“åšç¼“å­˜æ¥ç”¨, å¯ä»¥é€‚å½“è°ƒå¤§æ­¤å€¼</span><br><span class="line">max_heap_table_size &#x3D; 16M</span><br><span class="line"># é¡ºåºè¯», è¯»å…¥ç¼“å†²åŒºå¤§å°è®¾ç½®</span><br><span class="line"># å…¨è¡¨æ‰«ææ¬¡æ•°å¤šçš„è¯, å¯ä»¥è°ƒå¤§æ­¤å€¼</span><br><span class="line">read_buffer_size &#x3D; 1M</span><br><span class="line"># éšæœºè¯», è¯»å…¥ç¼“å†²åŒºå¤§å°è®¾ç½®</span><br><span class="line">read_rnd_buffer_size &#x3D; 8M</span><br><span class="line"># é«˜å¹¶å‘çš„æƒ…å†µä¸‹, éœ€è¦å‡å°æ­¤å€¼åˆ°64K-128K</span><br><span class="line">sort_buffer_size &#x3D; 1M</span><br><span class="line"># æ¯ä¸ªæŸ¥è¯¢æœ€å¤§çš„ç¼“å­˜å¤§å°æ˜¯1M, æœ€å¤§ç¼“å­˜64M æ•°æ®</span><br><span class="line">query_cache_size &#x3D; 64M</span><br><span class="line">query_cache_limit &#x3D; 1M</span><br><span class="line"># æåˆ° join çš„æ•ˆç‡</span><br><span class="line">join_buffer_size &#x3D; 16M</span><br><span class="line"># çº¿ç¨‹è¿æ¥é‡å¤åˆ©ç”¨</span><br><span class="line">thread_cache_size &#x3D; 64</span><br><span class="line"></span><br><span class="line">### InnoDB ä¼˜åŒ–</span><br><span class="line">## å†…å­˜åˆ©ç”¨æ–¹é¢çš„è®¾ç½®</span><br><span class="line"># æ•°æ®ç¼“å†²åŒº</span><br><span class="line">innodb_buffer_pool_size&#x3D;2G</span><br><span class="line">## æ—¥å¿—æ–¹é¢è®¾ç½®</span><br><span class="line"># äº‹åŠ¡æ—¥å¿—å¤§å°</span><br><span class="line">innodb_log_file_size &#x3D; 256M</span><br><span class="line"># æ—¥å¿—ç¼“å†²åŒºå¤§å°</span><br><span class="line">innodb_log_buffer_size &#x3D; 4M</span><br><span class="line"># äº‹åŠ¡åœ¨å†…å­˜ä¸­çš„ç¼“å†²</span><br><span class="line">innodb_log_buffer_size &#x3D; 3M</span><br><span class="line"># ä¸»åº“ä¿æŒç³»ç»Ÿé»˜è®¤, äº‹åŠ¡ç«‹å³å†™å…¥ç£ç›˜, ä¸ä¼šä¸¢å¤±ä»»ä½•ä¸€ä¸ªäº‹åŠ¡</span><br><span class="line">innodb_flush_log_at_trx_commit &#x3D; 1</span><br><span class="line"># mysql çš„æ•°æ®æ–‡ä»¶è®¾ç½®, åˆå§‹100, ä»¥10M è‡ªåŠ¨æ‰©å±•</span><br><span class="line">innodb_data_file_path &#x3D; ibdata1:100M:autoextend</span><br><span class="line"># ä¸ºæé«˜æ€§èƒ½, MySQLå¯ä»¥ä»¥å¾ªç¯æ–¹å¼å°†æ—¥å¿—æ–‡ä»¶å†™åˆ°å¤šä¸ªæ–‡ä»¶</span><br><span class="line">innodb_log_files_in_group &#x3D; 3</span><br><span class="line">##å…¶ä»–è®¾ç½®</span><br><span class="line"># å¦‚æœåº“é‡Œçš„è¡¨ç‰¹åˆ«å¤šçš„æƒ…å†µï¼Œè¯·å¢åŠ æ­¤å€¼</span><br><span class="line">innodb_open_files &#x3D; 800</span><br><span class="line"># ä¸ºæ¯ä¸ª InnoDB è¡¨åˆ†é…å•ç‹¬çš„è¡¨ç©ºé—´</span><br><span class="line">innodb_file_per_table &#x3D; 1</span><br><span class="line"># InnoDB ä½¿ç”¨åå°çº¿ç¨‹å¤„ç†æ•°æ®é¡µä¸Šå†™ I&#x2F;Oï¼ˆè¾“å…¥ï¼‰è¯·æ±‚çš„æ•°é‡</span><br><span class="line">innodb_write_io_threads &#x3D; 8</span><br><span class="line"># InnoDB ä½¿ç”¨åå°çº¿ç¨‹å¤„ç†æ•°æ®é¡µä¸Šè¯» I&#x2F;Oï¼ˆè¾“å‡ºï¼‰è¯·æ±‚çš„æ•°é‡</span><br><span class="line">innodb_read_io_threads &#x3D; 8</span><br><span class="line"># å¯ç”¨å•ç‹¬çš„çº¿ç¨‹æ¥å›æ”¶æ— ç”¨çš„æ•°æ®</span><br><span class="line">innodb_purge_threads &#x3D; 1</span><br><span class="line"># è„æ•°æ®åˆ·å…¥ç£ç›˜(å…ˆä¿æŒç³»ç»Ÿé»˜è®¤, swap è¿‡å¤šä½¿ç”¨æ—¶, è°ƒå°æ­¤å€¼, è°ƒå°å, ä¸ç£ç›˜äº¤äº’å¢å¤š, æ€§èƒ½é™ä½)</span><br><span class="line"># innodb_max_dirty_pages_pct &#x3D; 90</span><br><span class="line"># äº‹åŠ¡ç­‰å¾…è·å–èµ„æºç­‰å¾…çš„æœ€é•¿æ—¶é—´</span><br><span class="line">innodb_lock_wait_timeout &#x3D; 120</span><br><span class="line"># å¼€å¯ InnoDB ä¸¥æ ¼æ£€æŸ¥æ¨¡å¼, ä¸è­¦å‘Š, ç›´æ¥æŠ¥é”™</span><br><span class="line">innodb_strict_mode&#x3D;1</span><br><span class="line"># å…è®¸åˆ—ç´¢å¼•æœ€å¤§è¾¾åˆ°3072</span><br><span class="line"> innodb_large_prefix &#x3D; on</span><br><span class="line"></span><br><span class="line">[mysqldump]</span><br><span class="line"># å¼€å¯å¿«é€Ÿå¯¼å‡º</span><br><span class="line">quick</span><br><span class="line">default-character-set &#x3D; utf8mb4</span><br><span class="line">max_allowed_packet &#x3D; 256M</span><br><span class="line"></span><br><span class="line">[mysql]</span><br><span class="line"># å¼€å¯ tab è¡¥å…¨</span><br><span class="line">auto-rehash</span><br><span class="line">default-character-set &#x3D; utf8mb4</span><br></pre></td></tr></table></figure>


]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>é«˜å¯ç”¨</tag>
        <tag>é«˜æ€§èƒ½</tag>
      </tags>
  </entry>
  <entry>
    <title>Dockerå®¹å™¨çš„æ—¶åŒºè®¾ç½®</title>
    <url>/2017/06/05/Docker%E5%AE%B9%E5%99%A8%E7%9A%84%E6%97%B6%E5%8C%BA%E8%AE%BE%E7%BD%AE/</url>
    <content><![CDATA[<blockquote>
<p>åœ¨ docker çš„ä½¿ç”¨æ—¶, ç»å¸¸ä¼š pull ä¸‹æ¥ä¸€äº›å®˜æ–¹é•œåƒæˆ–ç¬¬ä¸‰æ–¹çš„é•œåƒ,  æ¯•ç«Ÿç»å¤§éƒ¨åˆ†è‡ªå·±åšçš„é•œåƒä¹Ÿæ˜¯åŸºäºå®˜æ–¹é•œåƒè€Œæ¥çš„, å…¶ä¸­ä¸€äº›å¯¹æ—¶é—´æ¯”è¾ƒæ•æ„Ÿçš„åº”ç”¨å¯èƒ½ä¼šå› ä¸ºæ—¶åŒºçš„é—®é¢˜è€Œå¯¼è‡´å¼‚å¸¸, æœ¬ç¯‡æ–‡ç« ä»‹ç»ä¸¤ç±»ç³»ç»Ÿä¸‹æ—¶åŒºçš„ä¿®æ”¹</p>
</blockquote>
<h1 id="CentOS-RedHat-Fedora"><a href="#CentOS-RedHat-Fedora" class="headerlink" title="CentOS/RedHat/Fedora"></a>CentOS/RedHat/Fedora</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">âœ  ~ cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span><br></pre></td></tr></table></figure>
<p><strong>æ‰§è¡Œå‘½ä»¤åç«‹å³ç”Ÿæ•ˆ</strong></p>
<h1 id="Ubuntu"><a href="#Ubuntu" class="headerlink" title="Ubuntu"></a>Ubuntu</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">âœ  ~ <span class="built_in">echo</span> <span class="string">"Asia/shanghai"</span> &gt; /etc/timezone</span><br></pre></td></tr></table></figure>

<p><strong>æ‰§è¡Œå‘½ä»¤åç«‹å³ç”Ÿæ•ˆ</strong></p>
<p>#ç‰¹åˆ«è¯´æ˜</p>
<p>åœ¨æµ‹è¯•ä¸­å‘ç°, Debian ç³»ç»Ÿè™½ç„¶åº”è¯¥å’Œ Ubuntu åˆ’åˆ†ä¸ºä¸€ç±», ä½†æ˜¯å´éœ€è¦ä½¿ç”¨ CentOS çš„åšæ³•æ¥ä¿®æ”¹æ—¶åŒº</p>
<p>åˆ°åº•éœ€è¦ä½¿ç”¨å“ªç§æ–¹å¼æ¥ä¿®æ”¹æ—¶åŒºå¯ä»¥ä½¿ç”¨ä»¥ä¸‹çš„å°æŠ€å·§</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é¦–å…ˆè¿›å…¥åˆ°å®¹å™¨ä¸­</span></span><br><span class="line">docker <span class="built_in">exec</span> -it 6170cc378e95 /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸ç®¡æ˜¯å“ªä¸ªç³»ç»Ÿç‰ˆæœ¬, å…ˆæŸ¥çœ‹å½“å‰çš„æ—¶åŒºé…ç½®æ–‡ä»¶</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœæ˜¯å‡ºç°ä¸€å †"ä¹±ç " æœ€åè¿˜å¸¦æœ‰æ—¶åŒºæ ‡è¯†çš„å°±ä½¿ç”¨ä¸Šé¢ CentOS çš„æ–¹å¼ä¿®æ”¹æ—¶åŒº</span></span><br><span class="line">cat /etc/localtime                                    </span><br><span class="line">xxxxxxxxxxxxxx</span><br><span class="line">UTC0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœæ˜¯ç›´æ¥å‡ºç° xxx/yyy è¿™ç§åœ°åŒºå­—ç¬¦çš„ç»“æœ, é‚£ä¹ˆå°±ä½¿ç”¨ä¸Šé¢ Ubuntu çš„æ–¹å¼ä¿®æ”¹æ—¶åŒº</span></span><br><span class="line">cat /etc/timezone </span><br><span class="line">Asia/Shanghai</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>æ—¶åŒº</tag>
      </tags>
  </entry>
  <entry>
    <title>docker image é•œåƒç®¡ç†</title>
    <url>/2017/06/05/docker-image-%E9%95%9C%E5%83%8F%E7%AE%A1%E7%90%86/</url>
    <content><![CDATA[<blockquote>
<ul>
<li>Docker ç®¡ç†å‘½ä»¤<ul>
<li>å®¹å™¨ç®¡ç†</li>
<li><strong>é•œåƒç®¡ç†</strong></li>
<li>ç½‘ç»œç®¡ç†</li>
<li>ç³»ç»Ÿç®¡ç†</li>
<li>æ•°æ®å·ç®¡ç†</li>
<li>å¿«ç…§ç®¡ç†</li>
<li>æ’ä»¶ç®¡ç†</li>
<li>å…¶ä»–</li>
<li>swarmkit ç®¡ç†<ul>
<li>æ¨¡å¼ç®¡ç†</li>
<li>èŠ‚ç‚¹ç®¡ç†</li>
<li>ç§˜é’¥ç®¡ç†</li>
<li>æœåŠ¡ç®¡ç†</li>
<li>æœåŠ¡æ ˆç®¡ç†</li>
</ul>
</li>
</ul>
</li>
</ul>
</blockquote>
<h1 id="é•œåƒç®¡ç†-image"><a href="#é•œåƒç®¡ç†-image" class="headerlink" title="é•œåƒç®¡ç† image"></a>é•œåƒç®¡ç† image</h1><h2 id="build"><a href="#build" class="headerlink" title="build"></a>build</h2><p>æ ¹æ® dockerfile æ„å»ºé•œåƒ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker image build -t centos2 .</span></span><br><span class="line">Sending build context to Docker daemon  19.46kB</span><br><span class="line">Step 1/2 : FROM centos</span><br><span class="line"> ---&gt; a8493f5f50ff</span><br><span class="line">Step 2/2 : LABEL author <span class="string">"lvrui"</span></span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> 9a996772de96</span><br><span class="line"> ---&gt; 61b7efba9133</span><br><span class="line">Removing intermediate container 9a996772de96</span><br><span class="line">Successfully built 61b7efba9133</span><br><span class="line">root@ubuntu:~<span class="comment"># cat dockerfile </span></span><br><span class="line">FROM centos</span><br><span class="line">LABEL author=<span class="string">"lvrui"</span></span><br><span class="line">root@ubuntu:~<span class="comment"># docker image ls</span></span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED              SIZE</span><br><span class="line">centos2             latest              61b7efba9133        About a minute ago   192MB</span><br><span class="line">nginx2              0.1                 7cb5220c81d5        2 hours ago          204MB</span><br><span class="line">centos              latest              a8493f5f50ff        37 hours ago         192MB</span><br><span class="line">nginx               latest              5766334bdaa0        41 hours ago         183MB</span><br><span class="line">hello-world         latest              48b5124b2768        2 months ago         1.84kB</span><br></pre></td></tr></table></figure>

<p>-t çš„ä½œç”¨æ˜¯æ‰“æ ‡ç­¾, å¯ä»¥ç›´æ¥æ‰“æˆ Registry çš„å½¢å¼, æ–¹ä¾¿ç›´æ¥ push åˆ° Registry</p>
<p>å¦‚æœæ²¡æœ‰æ‰“èµ Registry åœ°å€ä¹Ÿæ²¡æœ‰å…³ç³»,åæœŸå¯ä»¥é€šè¿‡ tag å‘½ä»¤ä¿®æ”¹</p>
<h2 id="history"><a href="#history" class="headerlink" title="history"></a>history</h2><p>æ˜¾ç¤ºé•œåƒçš„å†å²æ„å»ºä¿¡æ¯</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker image ls</span></span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">centos2             latest              61b7efba9133        2 minutes ago       192MB</span><br><span class="line">nginx2              0.1                 7cb5220c81d5        2 hours ago         204MB</span><br><span class="line">centos              latest              a8493f5f50ff        37 hours ago        192MB</span><br><span class="line">nginx               latest              5766334bdaa0        41 hours ago        183MB</span><br><span class="line">hello-world         latest              48b5124b2768        2 months ago        1.84kB</span><br><span class="line">root@ubuntu:~<span class="comment"># docker image history centos2</span></span><br><span class="line">IMAGE               CREATED             CREATED BY                                      SIZE                COMMENT</span><br><span class="line">61b7efba9133        2 minutes ago       /bin/sh -c <span class="comment">#(nop)  LABEL author=lvrui           0B                  </span></span><br><span class="line">a8493f5f50ff        37 hours ago        /bin/sh -c <span class="comment">#(nop)  CMD ["/bin/bash"]            0B                  </span></span><br><span class="line">&lt;missing&gt;           37 hours ago        /bin/sh -c <span class="comment">#(nop)  LABEL name=CentOS Base ...   0B                  </span></span><br><span class="line">&lt;missing&gt;           37 hours ago        /bin/sh -c <span class="comment">#(nop) ADD file:807143da05d7013...   192MB</span></span><br></pre></td></tr></table></figure>

<h2 id="import-save-load"><a href="#import-save-load" class="headerlink" title="import/save/load"></a>import/save/load</h2><ul>
<li>import å¯¼å…¥é•œåƒ, å¯¼å…¥ export å‡ºæ¥çš„é•œåƒ</li>
<li>save å¯¼å‡ºé•œåƒ</li>
<li>load å¯¼å…¥é•œåƒ, å¯¼å…¥ save å‡ºæ¥çš„é•œåƒ</li>
</ul>
<h2 id="inspect"><a href="#inspect" class="headerlink" title="inspect"></a>inspect</h2><p>æŸ¥çœ‹é•œåƒè¯¦ç»†ä¿¡æ¯</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker image inspect centos2</span></span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">"Id"</span>: <span class="string">"sha256:61b7efba9133e4ceaf4046e76a2f455a1204a8a794f16920c7543010e2759323"</span>,</span><br><span class="line">        <span class="string">"RepoTags"</span>: [</span><br><span class="line">            <span class="string">"centos2:latest"</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="string">"RepoDigests"</span>: [],</span><br><span class="line">        <span class="string">"Parent"</span>: <span class="string">"sha256:a8493f5f50ffda70c2eeb2d09090debf7d39c8ffcd63b43ff81b111ece6f28bf"</span>,</span><br><span class="line">        <span class="string">"Comment"</span>: <span class="string">""</span>,</span><br><span class="line">        <span class="string">"Created"</span>: <span class="string">"2017-04-08T09:12:50.750877048Z"</span>,</span><br><span class="line">        <span class="string">"Container"</span>: <span class="string">"9a996772de96183b48460aa1f02b907d1e8d97f8d322cc41aff909d2a8a74b61"</span>,</span><br><span class="line">        <span class="string">"ContainerConfig"</span>: &#123;</span><br><span class="line">            <span class="string">"Hostname"</span>: <span class="string">"f85c553c1496"</span>,</span><br><span class="line">            <span class="string">"Domainname"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"User"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"AttachStdin"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"AttachStdout"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"AttachStderr"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"Tty"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"OpenStdin"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"StdinOnce"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"Env"</span>: [</span><br><span class="line">                <span class="string">"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="string">"Cmd"</span>: [</span><br><span class="line">                <span class="string">"/bin/sh"</span>,</span><br><span class="line">                <span class="string">"-c"</span>,</span><br><span class="line">                <span class="string">"#(nop) "</span>,</span><br><span class="line">                <span class="string">"LABEL author=lvrui"</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="string">"Image"</span>: <span class="string">"sha256:a8493f5f50ffda70c2eeb2d09090debf7d39c8ffcd63b43ff81b111ece6f28bf"</span>,</span><br><span class="line">            <span class="string">"Volumes"</span>: null,</span><br><span class="line">            <span class="string">"WorkingDir"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"Entrypoint"</span>: null,</span><br><span class="line">            <span class="string">"OnBuild"</span>: [],</span><br><span class="line">            <span class="string">"Labels"</span>: &#123;</span><br><span class="line">                <span class="string">"author"</span>: <span class="string">"lvrui"</span>,</span><br><span class="line">                <span class="string">"build-date"</span>: <span class="string">"20170406"</span>,</span><br><span class="line">                <span class="string">"license"</span>: <span class="string">"GPLv2"</span>,</span><br><span class="line">                <span class="string">"name"</span>: <span class="string">"CentOS Base Image"</span>,</span><br><span class="line">                <span class="string">"vendor"</span>: <span class="string">"CentOS"</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"DockerVersion"</span>: <span class="string">"17.04.0-ce"</span>,</span><br><span class="line">        <span class="string">"Author"</span>: <span class="string">""</span>,</span><br><span class="line">        <span class="string">"Config"</span>: &#123;</span><br><span class="line">            <span class="string">"Hostname"</span>: <span class="string">"f85c553c1496"</span>,</span><br><span class="line">            <span class="string">"Domainname"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"User"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"AttachStdin"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"AttachStdout"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"AttachStderr"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"Tty"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"OpenStdin"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"StdinOnce"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"Env"</span>: [</span><br><span class="line">                <span class="string">"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="string">"Cmd"</span>: [</span><br><span class="line">                <span class="string">"/bin/bash"</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="string">"Image"</span>: <span class="string">"sha256:a8493f5f50ffda70c2eeb2d09090debf7d39c8ffcd63b43ff81b111ece6f28bf"</span>,</span><br><span class="line">            <span class="string">"Volumes"</span>: null,</span><br><span class="line">            <span class="string">"WorkingDir"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"Entrypoint"</span>: null,</span><br><span class="line">            <span class="string">"OnBuild"</span>: [],</span><br><span class="line">            <span class="string">"Labels"</span>: &#123;</span><br><span class="line">                <span class="string">"author"</span>: <span class="string">"lvrui"</span>,</span><br><span class="line">                <span class="string">"build-date"</span>: <span class="string">"20170406"</span>,</span><br><span class="line">                <span class="string">"license"</span>: <span class="string">"GPLv2"</span>,</span><br><span class="line">                <span class="string">"name"</span>: <span class="string">"CentOS Base Image"</span>,</span><br><span class="line">                <span class="string">"vendor"</span>: <span class="string">"CentOS"</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"Architecture"</span>: <span class="string">"amd64"</span>,</span><br><span class="line">        <span class="string">"Os"</span>: <span class="string">"linux"</span>,</span><br><span class="line">        <span class="string">"Size"</span>: 192481139,</span><br><span class="line">        <span class="string">"VirtualSize"</span>: 192481139,</span><br><span class="line">        <span class="string">"GraphDriver"</span>: &#123;</span><br><span class="line">            <span class="string">"Data"</span>: null,</span><br><span class="line">            <span class="string">"Name"</span>: <span class="string">"aufs"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"RootFS"</span>: &#123;</span><br><span class="line">            <span class="string">"Type"</span>: <span class="string">"layers"</span>,</span><br><span class="line">            <span class="string">"Layers"</span>: [</span><br><span class="line">                <span class="string">"sha256:36018b5e978717a047892794aebab513ba6856dbe1bdfeb478ca1219df2c7e9c"</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h2 id="ls"><a href="#ls" class="headerlink" title="ls"></a>ls</h2><p>ä½œç”¨ç­‰åŒäº <code>docker images</code> æŸ¥çœ‹é•œåƒåˆ—è¡¨</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker image ls</span></span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">centos2             latest              61b7efba9133        3 hours ago         192MB</span><br><span class="line">nginx2              0.1                 7cb5220c81d5        5 hours ago         204MB</span><br><span class="line">centos              latest              a8493f5f50ff        40 hours ago        192MB</span><br><span class="line">nginx               latest              5766334bdaa0        44 hours ago        183MB</span><br><span class="line">hello-world         latest              48b5124b2768        2 months ago        1.84kB</span><br></pre></td></tr></table></figure>

<h2 id="prune"><a href="#prune" class="headerlink" title="prune"></a>prune</h2><p>åˆ é™¤æ²¡æœ‰è¢«å¼•ç”¨çš„é•œåƒ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker image prune</span></span><br></pre></td></tr></table></figure>

<h2 id="tag-pull-push"><a href="#tag-pull-push" class="headerlink" title="tag/pull/push"></a>tag/pull/push</h2><ul>
<li>tag: æ‰“æ ‡ç­¾</li>
<li>pull: ä»è¿œç¨‹ä»“åº“ Registry æ‹‰å–é•œåƒ</li>
<li>push: ä»æœ¬åœ°ä¸Šä¼ é•œåƒ</li>
</ul>
<h4 id="ä»registryä¸­æ‹‰å–é•œåƒï¼š"><a href="#ä»registryä¸­æ‹‰å–é•œåƒï¼š" class="headerlink" title="ä»registryä¸­æ‹‰å–é•œåƒï¼š"></a>ä»registryä¸­æ‹‰å–é•œåƒï¼š</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo docker pull registry.cn-beijing.aliyuncs.com/lvreg/webconsole:[é•œåƒç‰ˆæœ¬å·]</span><br></pre></td></tr></table></figure>

<h4 id="å°†é•œåƒæ¨é€åˆ°registryï¼š"><a href="#å°†é•œåƒæ¨é€åˆ°registryï¼š" class="headerlink" title="å°†é•œåƒæ¨é€åˆ°registryï¼š"></a>å°†é•œåƒæ¨é€åˆ°registryï¼š</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo docker login --username=lvrui03@126.com registry.cn-beijing.aliyuncs.com</span><br><span class="line">$ sudo docker tag [ImageId] registry.cn-beijing.aliyuncs.com/lvreg/webconsole:[é•œåƒç‰ˆæœ¬å·]</span><br><span class="line">$ sudo docker push registry.cn-beijing.aliyuncs.com/lvreg/webconsole:[é•œåƒç‰ˆæœ¬å·]</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„: å¦‚æœ Registry æœ‰å¯†ç , è¿˜éœ€è¦å…ˆ login åˆ°é•œåƒä»“åº“æ‰å¯ä»¥ä¸Šä¼ é•œåƒ</p>
<h2 id="rm"><a href="#rm" class="headerlink" title="rm"></a>rm</h2><p>åˆ é™¤æŒ‡å®šçš„é•œåƒ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker image rm centos2:latest</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>image</tag>
      </tags>
  </entry>
  <entry>
    <title>RabbitMQ3.3.1ç‰ˆæœ¬ä¹‹åé»˜è®¤ä¸å…è®¸guestç™»å½•</title>
    <url>/2017/06/02/Rabbitmq3-3-1%E7%89%88%E6%9C%AC%E4%B9%8B%E5%90%8E%E9%BB%98%E8%AE%A4%E4%B8%8D%E5%85%81%E8%AE%B8guest%E7%99%BB%E5%BD%95-0/</url>
    <content><![CDATA[<blockquote>
<p>åœ¨ rabbitmq 3.3.1 ç‰ˆæœ¬ä¹‹å, å–æ¶ˆäº† guest ç™»å½•çš„æƒé™, å¦‚æœéœ€è¦å¼ºåˆ¶å¼€å¯éœ€è¦ä»¥ä¸‹æ“ä½œ</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">âœ  ~ <span class="built_in">echo</span> <span class="string">"[&#123;rabbit, [&#123;loopback_users, []&#125;]&#125;]."</span> &gt; /etc/rabbitmq/rabbitmq.config </span><br><span class="line">âœ  ~ systemctl restart rabbitmq-server</span><br></pre></td></tr></table></figure>

<p>å°è¯•ç™»é™†è®¿é—®: <code>http://rabbitmq-server-IP:15672</code></p>
<ul>
<li>username: <code>guest</code></li>
<li>password: <code>guest</code></li>
</ul>
<p><strong>æ³¨æ„</strong>:</p>
<ul>
<li>åœ¨æ‰§è¡Œä¸Šé¢çš„é‡å®šå‘ä¹‹å‰, æœ€å¥½å…ˆæ£€æŸ¥ä½ ç³»ç»Ÿä¸­æœ‰æ²¡æœ‰è¿™ä¸ªæ–‡ä»¶, å¦‚æœæ˜¯æ–°è£…çš„ rabbitmq, é»˜è®¤æ˜¯æ²¡æœ‰çš„, å¯ä»¥ç›´æ¥æ‰§è¡Œä¸Šé¢çš„å‘½ä»¤åˆ›å»ºå¹¶å†™å…¥å†…å®¹</li>
<li>ä¸Šé¢å†™å…¥çš„å†…å®¹ä¸­ä¸€å®šä¸è¦å¿˜è®°æœ€åçš„ <code>.</code> æ²¡æœ‰è¿™ä¸ª <code>.</code> é‡å¯ rabbitmq ä¼šæŠ¥é”™çš„</li>
</ul>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>rabbitmq</tag>
      </tags>
  </entry>
  <entry>
    <title>å¼ºåˆ¶å¸è½½æ— å“åº”çš„nfsæŒ‚è½½ç›®å½•</title>
    <url>/2017/06/02/%E5%BC%BA%E5%88%B6%E5%8D%B8%E8%BD%BD%E6%97%A0%E5%93%8D%E5%BA%94%E7%9A%84nfs%E6%8C%82%E8%BD%BD%E7%9B%AE%E5%BD%95/</url>
    <content><![CDATA[<blockquote>
<p>åœ¨æ—¥å¸¸çš„è¿ç»´ä¸­, ç»å¸¸æœ‰éœ€è¦ä½¿ç”¨ nfs æŒ‚è½½è¿œç¨‹æœåŠ¡å™¨ç›®å½•çš„éœ€æ±‚, ä½†æ˜¯ç…§æˆ‘ä¸ªäººå®é™…ä½¿ç”¨çš„ç»éªŒæ¥çœ‹, nfs å¹¶ä¸æ˜¯â€ä¸€åŠ³æ°¸é€¸â€, æ•…éšœç‡è¿˜æ˜¯è›®é«˜çš„, å…¶ä¸­æœ€é•¿é‡åˆ°çš„å°±æ˜¯ç”±äºç½‘ç»œåŸå› /è¿œç¨‹ nfs æœåŠ¡å™¨åŸå› æˆ–å…¶ä»–åŸå› å¯¼è‡´çš„ nfs å®¢æˆ·ç«¯ä¸ nfs æœåŠ¡å™¨å¤±è”. å¤±è”å¹¶ä¸å¯æ€•, å¯æ€•çš„æ˜¯å®ƒå¹¶ä¸ä¼šè‡ªåŠ¨é‡è¿. è¿™ä¸ªæ—¶å€™éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨ä»‹å…¥åˆ°é‡è¿çš„æ“ä½œä¸­</p>
</blockquote>
<p>nfs å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯å¤±å»è¿æ¥, æœ€ç›´è§‚çš„ç°è±¡å°±æ˜¯åœ¨ Linux å‘½ä»¤è¡Œä¸­,æ‰§è¡Œ <code>df -h</code> å‘½ä»¤, æ•´ä¸ª terminal ç»ˆç«¯å°±ä¼šå¡åœ¨é‚£é‡Œä¸€åŠ¨ä¸åŠ¨(æŒ‚èµ·), ä½ å¯ä»¥å‚è€ƒä»¥ä¸‹æ–¹æ¡ˆè§£å†³è¯¥é—®é¢˜</p>
<h1 id="æ–°å¼€ä¸€ä¸ª-session"><a href="#æ–°å¼€ä¸€ä¸ª-session" class="headerlink" title="æ–°å¼€ä¸€ä¸ª session"></a>æ–°å¼€ä¸€ä¸ª session</h1><p>ä¹Ÿè®¸ä½ å½“å‰çš„ session å·²ç»è¢«å¡ä½äº†, è¿™æ—¶éœ€è¦æ‰“å¼€ä¸€ä¸ªæ–°çš„ session, å¦‚æœä½ æ˜¯ç›´æ¥ç™»å½•åˆ° linux ç³»ç»Ÿç•Œé¢çš„, å¯ä»¥åŒæ—¶æŒ‰ä¸‹ â€œCtrl+Alt+F2â€ åˆ‡æ¢åˆ°ç¬¬äºŒä¸ª terminal</p>
<h1 id="æŸ¥è¯¢ä¹‹å‰æŒ‚è½½çš„è·¯å¾„"><a href="#æŸ¥è¯¢ä¹‹å‰æŒ‚è½½çš„è·¯å¾„" class="headerlink" title="æŸ¥è¯¢ä¹‹å‰æŒ‚è½½çš„è·¯å¾„"></a>æŸ¥è¯¢ä¹‹å‰æŒ‚è½½çš„è·¯å¾„</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">âœ  ~ nfsstat -m</span><br><span class="line">nfsstat -m</span><br><span class="line">/webserver/page from 192.168.1.112:/webserver/page</span><br><span class="line"> Flags: rw,relatime,vers=4.0,rsize=524288,wsize=524288,namlen=255,hard,proto=tcp,port=0,timeo=600,retrans=2,sec=sys,clientaddr=192.168.1.4,local_lock=none,addr=192.168.1.112</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šå‘½ä»¤ä¸ä»…ä»…ä¼šæ˜¾ç¤ºå‡ºå½“å‰çš„æŒ‚è½½ç‚¹ä¿¡æ¯, è¿˜ä¼šæ˜¾ç¤ºå‡ºè¯¦ç»†çš„ nfs å±æ€§ä¿¡æ¯</p>
<p>å½“ç„¶, ä½ ä¹Ÿå¯ä»¥é€šè¿‡ <code>mount</code> å‘½ä»¤æ¥æŸ¥è¯¢ nfs çš„æŒ‚è½½ç‚¹, å‰é¢å†™ç€ IP çš„å°±æ˜¯ nfs çš„æŒ‚è½½ä¿¡æ¯</p>
<h1 id="ä½¿ç”¨-umount-f-PATH-å¸è½½"><a href="#ä½¿ç”¨-umount-f-PATH-å¸è½½" class="headerlink" title="ä½¿ç”¨ umount -f PATH å¸è½½"></a>ä½¿ç”¨ umount -f PATH å¸è½½</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">âœ  ~ <span class="built_in">cd</span></span><br><span class="line">âœ  ~ umount -f /webserver/page</span><br></pre></td></tr></table></figure>

<p>å…ˆ cd åˆ°å®¶ç›®å½•, å†å¼ºåˆ¶å¸è½½, å¦‚æœæ‰§è¡Œæ­¤å‘½ä»¤å, è¿˜æ˜¯æç¤ºç£ç›˜â€busilyâ€ å°±ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¸è½½</p>
<h1 id="ä½¿ç”¨-umount-l-PATH-å¸è½½"><a href="#ä½¿ç”¨-umount-l-PATH-å¸è½½" class="headerlink" title="ä½¿ç”¨ umount -l PATH å¸è½½"></a>ä½¿ç”¨ umount -l PATH å¸è½½</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">âœ  ~ <span class="built_in">cd</span></span><br><span class="line">âœ  ~ umount -l /webserver/page</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„: è¿™é‡Œæ˜¯ä½¿ç”¨çš„å°å†™çš„<code>L</code></p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>nfs</tag>
      </tags>
  </entry>
  <entry>
    <title>iptablesæµé‡è½¬å‘(ç½‘å…³)</title>
    <url>/2017/06/02/iptables%E6%B5%81%E9%87%8F%E8%BD%AC%E5%8F%91/</url>
    <content><![CDATA[<blockquote>
<p>åœ¨ A å±€åŸŸç½‘ç¯å¢ƒä¸­, ä¸€å°æœåŠ¡å™¨ä½¿ç”¨ VPN æŠ€æœ¯æ‹¨é€šäº† B å±€åŸŸç½‘çš„ä¸€å°æœåŠ¡å™¨. å¦‚æœéœ€è¦å®ç° A å±€åŸŸç½‘çš„æ‰€æœ‰æœåŠ¡å™¨åˆ° B å±€åŸŸç½‘é€šä¿¡, é‚£ä¹ˆé¦–å…ˆéœ€è¦å®ç° A å±€åŸŸç½‘ä¸­ VPN(éš§é“) æœåŠ¡å™¨çš„æµé‡è½¬å‘</p>
</blockquote>
<h1 id="é˜²ç«å¢™æ“ä½œ"><a href="#é˜²ç«å¢™æ“ä½œ" class="headerlink" title="é˜²ç«å¢™æ“ä½œ"></a>é˜²ç«å¢™æ“ä½œ</h1><ul>
<li>ä¿å­˜è§„åˆ™</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ iptables-save &gt; /etc/iptables-script</span><br></pre></td></tr></table></figure>

<ul>
<li>æ¢å¤è§„åˆ™</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ iptables-restore &lt; &#x2F;etc&#x2F;iptables-script</span><br></pre></td></tr></table></figure>

<h1 id="è½¬å‘æµé‡çš„é˜²ç«å¢™è§„åˆ™"><a href="#è½¬å‘æµé‡çš„é˜²ç«å¢™è§„åˆ™" class="headerlink" title="è½¬å‘æµé‡çš„é˜²ç«å¢™è§„åˆ™"></a>è½¬å‘æµé‡çš„é˜²ç«å¢™è§„åˆ™</h1><ul>
<li>æŸ¥çœ‹è§„åˆ™</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ cat iptables.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># Generated by iptables-save v1.4.21 on Mon Nov 21 14:49:30 2016</span></span><br><span class="line">*nat</span><br><span class="line">:PREROUTING ACCEPT [75958158:4710517785]</span><br><span class="line">:INPUT ACCEPT [11156433:697999260]</span><br><span class="line">:OUTPUT ACCEPT [11270560:679018758]</span><br><span class="line">:POSTROUTING ACCEPT [0:0]</span><br><span class="line">-A POSTROUTING -j MASQUERADE</span><br><span class="line">COMMIT</span><br><span class="line"><span class="comment"># Completed on Mon Nov 21 14:49:30 2016</span></span><br><span class="line"><span class="comment"># Generated by iptables-save v1.4.21 on Mon Nov 21 14:49:30 2016</span></span><br><span class="line">*filter</span><br><span class="line">:INPUT ACCEPT [1937717187:1020106795408]</span><br><span class="line">:FORWARD ACCEPT [2772458722:1915560771769]</span><br><span class="line">:OUTPUT ACCEPT [2100892309:1998825790936]</span><br><span class="line">COMMIT</span><br><span class="line"><span class="comment"># Completed on Mon Nov 21 14:49:30 2016</span></span><br></pre></td></tr></table></figure>

<ul>
<li>å¯¼å…¥è§„åˆ™</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ iptables-restore &lt; iptables.conf</span><br></pre></td></tr></table></figure>

<h1 id="å¼€å¯ç½‘å¡è½¬å‘"><a href="#å¼€å¯ç½‘å¡è½¬å‘" class="headerlink" title="å¼€å¯ç½‘å¡è½¬å‘"></a>å¼€å¯ç½‘å¡è½¬å‘</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> 1 &gt; /proc/sys/net/ipv4/ip_forward</span><br></pre></td></tr></table></figure>


]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>iptables</tag>
        <tag>ç½‘å¡è½¬å‘</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQLä¸­çš„å˜é‡</title>
    <url>/2017/06/02/MySQL%E4%B8%AD%E7%9A%84%E5%8F%98%E9%87%8F/</url>
    <content><![CDATA[<h1 id="ç”¨æˆ·å˜é‡"><a href="#ç”¨æˆ·å˜é‡" class="headerlink" title="ç”¨æˆ·å˜é‡"></a>ç”¨æˆ·å˜é‡</h1><p>ç”¨æˆ·å˜é‡ä¸æ•°æ®åº“è¿æ¥æœ‰å…³, è¿™æŸä¸ªè¿æ¥ä¸­å£°æ˜å˜é‡, åœ¨æ–­å¼€è¿æ¥æ—¶è¿™ä¸ªå˜é‡å°±ä¼šæ¶ˆå¤±, ä¸”åœ¨è¿™ä¸ªè¿æ¥ä¸­å£°æ˜çš„å˜é‡æ— æ³•åœ¨å¦ä¸€ä¸ªè¿æ¥ä¸­ä½¿ç”¨.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># ç”¨æˆ·å˜é‡è¯­æ³•</span><br><span class="line"></span><br><span class="line">set @varName&#x3D;value</span><br></pre></td></tr></table></figure>

<p>å£°æ˜ä¸€ä¸ªå˜é‡ <code>varName</code>, å¹¶å°†å®ƒèµ‹å€¼ä¸º <code>value</code></p>
<p><em>mysql ä¸­çš„å˜é‡æ˜¯åŠ¨æ€æ•°æ®ç±»å‹, å®ƒçš„æ•°æ®ç±»å‹ä¼šæ ¹æ®å®ƒçš„å€¼çš„ç±»å‹è€Œå˜åŒ–</em></p>
<h1 id="ç³»ç»Ÿå˜é‡"><a href="#ç³»ç»Ÿå˜é‡" class="headerlink" title="ç³»ç»Ÿå˜é‡"></a>ç³»ç»Ÿå˜é‡</h1><p>ç³»ç»Ÿå˜é‡ä¸­, åˆåˆ†ä¸º <code>å…¨å±€å˜é‡</code> å’Œ <code>ä¼šè¯å˜é‡</code></p>
<p>å…¨å±€å˜é‡ä¸ä¼šè¯å˜é‡çš„åŒºåˆ«åœ¨äº, å¯¹å…¨å±€å˜é‡çš„ä¿®æ”¹ä¼šå½±å“åˆ°æ•´ä¸ªMySQLæœåŠ¡ (æ‰€æœ‰ä¼šè¯) è€Œå¯¹å±€éƒ¨å˜é‡çš„ä¿®æ”¹åªä¼šå½±å“åˆ°å½“å‰ä¼šè¯çš„è¿æ¥</p>
<p>åˆ©ç”¨selectè¯­å¥æˆ‘ä»¬å¯ä»¥æŸ¥è¯¢å•ä¸ªä¼šè¯å˜é‡æˆ–è€…å…¨å±€å˜é‡çš„å€¼ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> @@session.sort_buffer_size</span><br><span class="line"><span class="keyword">select</span> @@global.sort_buffer_size</span><br><span class="line"><span class="keyword">select</span> @@global.tmpdir</span><br></pre></td></tr></table></figure>

<p>å‡¡æ˜¯ä¸Šé¢æåˆ°çš„sessionï¼Œéƒ½å¯ä»¥ç”¨localè¿™ä¸ªå…³é”®å­—æ¥ä»£æ›¿ã€‚</p>
<p>æ¯”å¦‚ï¼š <code>select @@local.sort_buffer_size</code></p>
<p><em>local æ˜¯ sessionçš„è¿‘ä¹‰è¯</em></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æ— è®ºæ˜¯åœ¨è®¾ç½®ç³»ç»Ÿå˜é‡è¿˜æ˜¯æŸ¥è¯¢ç³»ç»Ÿå˜é‡å€¼çš„æ—¶å€™ï¼Œåªè¦æ²¡æœ‰æŒ‡å®šåˆ°åº•æ˜¯å…¨å±€å˜é‡è¿˜æ˜¯ä¼šè¯å˜é‡, éƒ½å½“åšä¼šè¯å˜é‡æ¥å¤„ç†ã€‚</span><br><span class="line"></span><br><span class="line">æ¯”å¦‚ï¼š</span><br><span class="line">set @@sort_buffer_size &#x3D; 50000;</span><br><span class="line">select @@sort_buffer_size;</span><br><span class="line"></span><br><span class="line">ä¸Šé¢éƒ½æ²¡æœ‰æŒ‡å®šæ˜¯GLOBALè¿˜æ˜¯SESSIONï¼Œæ‰€ä»¥å…¨éƒ¨å½“åšSESSIONå¤„ç†ã€‚</span><br></pre></td></tr></table></figure>

<h2 id="å…¨å±€å˜é‡"><a href="#å…¨å±€å˜é‡" class="headerlink" title="å…¨å±€å˜é‡"></a>å…¨å±€å˜é‡</h2><p>å…¨å±€å˜é‡åœ¨ MySQL å¯åŠ¨çš„æ—¶å€™ç”±æœåŠ¡å™¨è‡ªåŠ¨åˆå§‹åŒ–ä»–ä»¬çš„å€¼, è¿™äº›é»˜è®¤çš„å€¼å¯ä»¥åœ¨ <code>/etc/my.cnf</code> ä¸­ä¿®æ”¹</p>
<h3 id="æŸ¥çœ‹å…¨å±€å˜é‡"><a href="#æŸ¥çœ‹å…¨å±€å˜é‡" class="headerlink" title="æŸ¥çœ‹å…¨å±€å˜é‡"></a>æŸ¥çœ‹å…¨å±€å˜é‡</h3><p><code>show global variables;</code></p>
<h3 id="ä¿®æ”¹å…¨å±€å˜é‡"><a href="#ä¿®æ”¹å…¨å±€å˜é‡" class="headerlink" title="ä¿®æ”¹å…¨å±€å˜é‡"></a>ä¿®æ”¹å…¨å±€å˜é‡</h3><p><code>set global varname = value;</code> æˆ– <code>set @@global.varname = value;</code></p>
<h2 id="ä¼šè¯å˜é‡"><a href="#ä¼šè¯å˜é‡" class="headerlink" title="ä¼šè¯å˜é‡"></a>ä¼šè¯å˜é‡</h2><p>ä¼šè¯å˜é‡åœ¨æ¯ä¸€ä¸ªæ•°æ®åº“è¿æ¥å»ºç«‹å, ç”± MySQL æ¥åˆå§‹åŒ–. MySQL ä¼šå°†å½“å‰æ‰€æœ‰çš„å…¨å±€å˜é‡éƒ½å¤åˆ¶ä¸€ä»½ä½œä¸ºä¼šè¯å˜é‡</p>
<h3 id="æŸ¥çœ‹ä¼šè¯å˜é‡"><a href="#æŸ¥çœ‹ä¼šè¯å˜é‡" class="headerlink" title="æŸ¥çœ‹ä¼šè¯å˜é‡"></a>æŸ¥çœ‹ä¼šè¯å˜é‡</h3><p><code>show session variables;</code>  æˆ– <code>show variables;</code></p>
<h3 id="ä¿®æ”¹ä¼šè¯å˜é‡"><a href="#ä¿®æ”¹ä¼šè¯å˜é‡" class="headerlink" title="ä¿®æ”¹ä¼šè¯å˜é‡"></a>ä¿®æ”¹ä¼šè¯å˜é‡</h3><p><code>set session varname = value;</code> æˆ– <code>set @@session.varname = value;</code></p>
<h1 id="åªè¯»å˜é‡"><a href="#åªè¯»å˜é‡" class="headerlink" title="åªè¯»å˜é‡"></a>åªè¯»å˜é‡</h1><p>æœ‰äº›ç³»ç»Ÿå˜é‡çš„å€¼æ˜¯å¯ä»¥åˆ©ç”¨è¯­å¥æ¥åŠ¨æ€è¿›è¡Œæ›´æ”¹çš„ï¼Œä½†æ˜¯æœ‰äº›ç³»ç»Ÿå˜é‡çš„å€¼å´æ˜¯åªè¯»çš„</p>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>å˜é‡</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS7å®‰è£…killallå‘½ä»¤</title>
    <url>/2017/06/02/CentOS7%E5%AE%89%E8%A3%85killall%E5%91%BD%E4%BB%A4/</url>
    <content><![CDATA[<p><code>yum install psmisc -y</code></p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>killall</tag>
      </tags>
  </entry>
  <entry>
    <title>Dockeré›†ç¾¤æ¨¡å¼çš„è½åœ°æ–¹æ¡ˆå°è¯•</title>
    <url>/2017/06/02/Docker%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8F%E7%9A%84%E8%90%BD%E5%9C%B0%E6%96%B9%E6%A1%88%E5%B0%9D%E8%AF%95/</url>
    <content><![CDATA[<h1 id="docker-é›†ç¾¤æ¨¡å¼çš„è½åœ°æ–¹æ¡ˆå°è¯•"><a href="#docker-é›†ç¾¤æ¨¡å¼çš„è½åœ°æ–¹æ¡ˆå°è¯•" class="headerlink" title="docker é›†ç¾¤æ¨¡å¼çš„è½åœ°æ–¹æ¡ˆå°è¯•"></a>docker é›†ç¾¤æ¨¡å¼çš„è½åœ°æ–¹æ¡ˆå°è¯•</h1><p>æœ€è¿‘ä¸€ç›´åœ¨æ¢ç´¢ docker çš„é›†ç¾¤æ¨¡å¼åœ¨å…¬å¸å®é™…ç¯å¢ƒä¸­çš„è½åœ°æ–¹æ¡ˆ. å…¬å¸ç°æœ‰docker çš„ä½¿ç”¨æ–¹å¼ä¸ºå•æœº, ä¸”åœ¨æ—¥å¿—æ”¶é›†, ç½‘ç»œæ¨¡å¼, å­˜å‚¨å¼•æ“ç­‰æ–¹é¢çš„é…ç½®å’Œç”¨æ³•æ¯”è¾ƒåˆ†æ•£, å°¤å…¶æ˜¯ç°æœ‰ä½¿ç”¨çš„ devicemapper å­˜å‚¨å¼•æ“æ¨¡å¼, å®˜æ–¹æ˜ç¡®è¡¨ç¤ºä¸é€‚åˆç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨. </p>
<p>docker çš„é›†ç¾¤æ–¹æ¡ˆç›®å‰æ¯”è¾ƒç«çƒ­çš„æœ‰ä¸‰ç§, ä¸€ç§æ˜¯ docker åœ¨1.12ç‰ˆæœ¬ä¸­é›†æˆçš„ swarmkit, ä¸€ç§æ˜¯ Google å¼€æºçš„ kubernetes, è¿˜æœ‰ä¸€ç§æ˜¯ Apache å¼€æºçš„ mesos. è™½ç„¶ kubernetes æ˜¯è¢«è®¤ä¸ºæ˜¯è½»é‡çº§çš„ PaaS å¹³å°, ä½†å¦‚æœè€ƒè™‘åœ¨å…¬å¸è½åœ°, kubernetes å¯¹æˆ‘ä»¬æ¥è¯´ä»ç„¶æ˜¯â€é‡é‡çº§â€çš„äº§å“, è€ƒè™‘åˆ°å…¬å¸ç°æœ‰åŸºäºçš„æ¶æ„(IaaS), æœ€ç»ˆè¿˜æ˜¯é€‰æ‹©äº† docker è‡ªå®¶çš„ swarmkit é›†ç¾¤å¹³å°è¿›è¡Œ PaaS å¹³å°çš„åˆæ­¥å°è¯•.</p>
<p>swarmkit çš„ä¸€å¤§å¥½å¤„æ˜¯å®‰è£…å¥½ docker å¼•æ“å, ä¸éœ€è¦å®‰è£…ä»»ä½•å…¶ä»–ç»„ä»¶, åªéœ€è¦å¼€å¯ docker çš„ swarm æ¨¡å¼å³å¯. dev ç¯å¢ƒç°æœ‰çš„ swarmkit å¹³å°ç”± 3 å°å…¥å£æœåŠ¡å™¨å’Œ6å°åç«¯åº”ç”¨æœåŠ¡å™¨ç»„æˆ, å…¶ä¸­å…¥å£çš„3å°æœåŠ¡å™¨ä¹Ÿå¯ä»¥å½“åšåº”ç”¨æœåŠ¡å™¨æ¥éƒ¨ç½² docker åº”ç”¨, åŠ èµ·æ¥æ•´ä¸ªå¹³å°æœ‰9ä¸ªèŠ‚ç‚¹å¯ä»¥åˆ†å¸ƒå¼çš„éƒ¨ç½² docker åº”ç”¨.</p>
<p>å¹³å°æ­å»ºå¥½å, æˆ‘é¦–å…ˆæ‹¿ Apache æœåŠ¡åšæµ‹è¯•, ä½¿ç”¨ Apache é•œåƒè¿è¡Œäº†ä¸€ä¸ªé™æ€é¡µé¢, æŒ‡å®šåç«¯å¯åŠ¨6ä¸ªå®¹å™¨æä¾›æœåŠ¡, æœåŠ¡å¯åŠ¨å, å¯ä»¥é€šè¿‡3å°å…¥å£æœåŠ¡å™¨çš„ä»»ä½•ä¸€ä¸ªå…¥å£è¿›è¡Œè®¿é—®, è¯·æ±‚ä¼šè¢«æ‰“åˆ°åç«¯çš„ Apache å®¹å™¨ä¸­. åœ¨è¿™ä¸ªæ¨¡å¼ä¸‹, æˆ‘ä»¬è€é›ªè¿›è¡Œå‹åŠ›æµ‹è¯•, æœ€ç»ˆåœ¨å¹¶å‘1000, å¾ªç¯100æ¬¡çš„é‡çº§ä¸‹, é”™è¯¯ç‡è¾¾åˆ°å°†è¿‘50%çš„æƒ…å†µä¸‹ç»“æŸæµ‹è¯•, å¯»æ‰¾ç“¶é¢ˆ. ç»è¿‡æ’æŸ¥, ç“¶é¢ˆä¸æ˜¯å¹³å°çš„ååé‡åˆ°è¾¾ä¸Šçº¿, ä¹Ÿä¸æ˜¯å®¹å™¨å¤„ç†çš„è¯·æ±‚åˆ°è¾¾ä¸Šé™, è€Œæ˜¯å®¿ä¸»æœºçš„æ—¥å¿—æ”¶é›†å¯¼è‡´å®¿ä¸»æœºçš„ IO wait é£™å‡, åœ¨ä¸¥è‹›çš„æµ‹è¯•è¦æ±‚ä¸‹(500msçš„å“åº”æ—¶é—´), å¯¼è‡´å¤§é‡çš„è¯·æ±‚ç”±äºå®¿ä¸»æœºçš„ IO wait è€Œå¯¼è‡´å“åº”è¶…æ—¶. æˆ‘ä»¬å½“åˆå·²è¿™æ ·çš„æ¨¡å¼è¿›è¡Œæµ‹è¯•çš„ç›®çš„å…¶å®æ˜¯æµ‹è¯•å¹³å°çš„ååé‡, ä»¥åŠå¹³å°ç½‘ç»œçš„ç¨³å®šæ€§, æ²¡æƒ³åˆ°è¿™æ ·çš„é‡çº§ä¸‹,è¿™ä¸¤ç‚¹éƒ½æ²¡æœ‰ä»»ä½•é—®é¢˜, åè€Œæ˜¯ IO æ‹–äº†åè…¿. </p>
<p>åœ¨åŒ—äº¬ä¸‰åŒºç”Ÿäº§ç¯å¢ƒä¸­, æ¯å° Nginx ç½‘ç»œçš„ç¬æ—¶æœ€å¤§ååé‡ä¸º30MBå·¦å³, åœ¨ swarmkit å¹³å°æµ‹è¯•çš„ä¸€ä¸ªå…¥å£çš„ç½‘ç»œç¬æ—¶ååé‡ä¹Ÿè¾¾åˆ°äº†å°†è¿‘20MB, ç”±äºå¤§é‡çš„ IO wait, å¯¼è‡´æ²¡æœ‰æµ‹è¯•åˆ°å…¥å£çš„å®é™…æœ€å¤§æ‰¿è½½é‡. ä½†æ˜¯æŒ‰ç…§ç°æœ‰ä¸‰ä¸ªå…¥å£çš„æ¶æ„æ¥çœ‹, æ¯ä¸ªå…¥å£20MB çš„æµé‡, åŠ èµ·æ¥ä¹Ÿå¯ä»¥æ‰¿å—60MBçš„ååèƒ½åŠ›, ç›¸å½“äºå°†è¿‘500Mb å¸¦å®½çš„æ°´å¹³, è€Œä¸‰åŒºç”Ÿäº§ç¯å¢ƒçš„å…¬ç½‘ IP ä¹Ÿåªæœ‰300Mb çš„å¸¦å®½, åœ¨å¹³å°ç¨³å®šæ€§, ä»¥åŠè™šæ‹Ÿç½‘ç»œç¨³å®šæ€§åŠååé‡ä¸Šæ¥çœ‹, swarmkit å°±å·²ç»å®Œå…¨ç¬¦åˆæˆ‘ä»¬ç”Ÿäº§ç¯å¢ƒå…¥å£é‡çº§çš„ååèƒ½åŠ›.</p>
<p>æ¥ä¸‹æ¥çš„æµ‹è¯•ä¸­, ä¸Šçº¿äº†ç”¨æˆ·ä½“ç³»çš„ä¸€ä¸ªæœåŠ¡, åç«¯ä»æ—§ä¸º6ä¸ªèŠ‚ç‚¹æä¾›æœåŠ¡, åœ¨å‹åŠ›æµ‹è¯•ä¸­, åŸºæœ¬ä¸Šæ‰€æœ‰çš„é”™è¯¯éƒ½æ¥è‡ªæ•°æ®åº“è¿æ¥çš„é”™è¯¯</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬æ‰“ç®—ä¸Šçº¿ç”¨æˆ·ä½“ç³»ç¬¬äºŒä¸ªæœåŠ¡çš„æ—¶å€™é‡åˆ°äº†é—®é¢˜, è¯¥æœåŠ¡éœ€è¦å‘ Zookeeper æ³¨å†Œä¿¡æ¯, è€Œåœ¨é›†ç¾¤ä¸­, æ•´ä¸ªé›†ç¾¤æ˜¯ä¸€ä¸ªå¤§å‹çš„ VLAN ç½‘ç»œ, æ¯ä¸ªå®¹å™¨æ‹¥æœ‰ä¸‰ä¸ª IP, ä¸€ä¸ªæ˜¯ docker æ¡¥æ¥ç»™æ¯ä¸ªå®¹å™¨çš„ IP, ä¸€ä¸ªæ˜¯ VLAN ç½‘ç»œçš„ IP, ä¸€ä¸ªæ˜¯å‰ç«¯ç”¨äºè´Ÿè½½å‡è¡¡ç”¨çš„ VIP(è™š IP), å½“å®¹å™¨å†…çš„æœåŠ¡å‘Zookeeper æ³¨å†Œæ—¶, é»˜è®¤æ‹¿çš„æ˜¯è‡ªå·±ä¸»æœºä¸Š hosts ä¸­ localhost å¯¹åº”çš„ IP åœ°å€, è€Œä¸”æœ€é‡è¦çš„æ˜¯, ä¸ç®¡è¿™ä¸‰ä¸ªæ‹¿å“ªä¸ª IP åœ°å€, éƒ½åªèƒ½ä»å†…å¾€å¤–è¿é€š, å¤–éƒ¨ä¸»æœºä¸å¯èƒ½ä¸»åŠ¨è¿æ¥è¿›æ¥. è¿™ä¹Ÿå°±å¯¼è‡´äº†å®¹å™¨å†…çš„æœåŠ¡å‘ Zookeeper æ³¨å†Œæ—¶çš„ IP, åœ¨å…¶ä»–æ¶ˆè´¹è€…æ‹¿åˆ°æ­¤ IP çš„æ—¶å€™, å‘ç°è¿™ä¸ª IP æ ¹æœ¬å°±è¿ä¸ä¸Š.</p>
<p>å¯¹äºä¸Šé¢çš„é—®é¢˜, æˆ‘ä»¬æƒ³äº†å¾ˆå¤šè§£å†³åŠæ³•, æˆ‘ä»¬æƒ³è¿‡é€šè¿‡è·¯ç”±çš„æ–¹å¼, è®©é›†ç¾¤å¤–éƒ¨ä¸»æœºè¿é€šé›†ç¾¤å†…éƒ¨çš„ç½‘ç»œ, ä½†æ˜¯è¿™æ ·åšçš„åæœæ˜¯åˆå¤šå¢åŠ äº†ä¸€ä¸ªä¸ç¨³å®šå› ç´ , é›†ç¾¤å¤–æ‰€æœ‰éœ€è¦è¿è¿›æ¥çš„æµé‡éƒ½ä¼šé€šè¿‡æˆ‘ä»¬è‡ªå·±çš„ä¸€å°ç½‘å…³æœåŠ¡å™¨åšè½¬å‘, è¿™ç›¸å½“äºæˆ‘ä»¬è‡ªå·±ç»´æŠ¤äº†ä¸€ä¸ªè™šæ‹Ÿäº¤æ¢æœº, å¢åŠ äº†ä¸¤ä¸ªç¯å¢ƒä¹‹é—´äº¤äº’çš„ç¨³å®šæ€§çš„é£é™©.</p>
<p>è¿˜æœ‰ä¸€ä¸ªåŠæ³•æ˜¯æŠŠ docker é›†ç¾¤æ¨¡å¼å…³é—­, å½“åšå•æœºæ¥ä½¿ç”¨, ä½†æ˜¯åˆå‘ç°ä¸€ä¸ªé—®é¢˜, æˆ‘ä»¬æµ‹è¯•çš„è¿™ä¸ªæœåŠ¡, åœ¨dubbo å‘ Zookeeper æ³¨å†Œæ—¶, é»˜è®¤ç›‘å¬äº†è‡ªå·±çš„20880ç«¯å£(è®°ä¸æ¸…äº†, å¥½åƒæ˜¯è¿™ä¸ª) ä¸ç®¡æ˜¯ä½¿ç”¨ç½‘æ¡¥æ¨¡å¼æ˜ å°„å‡ºå», è¿˜æ˜¯ä½¿ç”¨<br>host æ¨¡å¼è®©ä»–ç›‘å¬å®¿ä¸»æœºçš„ç«¯å£, é—®é¢˜éƒ½æ˜¯ä¸€ä¸ª: è¿™ä¸€å° docker å®¿ä¸»æœºä¸Š, åªèƒ½å¯åŠ¨ä¸€ä¸ªç›‘å¬20880çš„æœåŠ¡, ä¹Ÿå°±æ˜¯è¯´, åœ¨å‘å¸ƒåº”ç”¨å®¹å™¨çš„æ—¶å€™, æˆ‘ä»¬éœ€è¦äººä¸ºçš„å»åˆ¤æ–­, æˆ–æ˜¯ç”¨å…¶ä»–æ–¹å¼å»åˆ¤æ–­ç›®æ ‡ docker ä¸»æœºä¸Šæ˜¯å¦å·²ç»å­˜åœ¨ä¸è‡ªå·±ç«¯å£å†²çªçš„æœåŠ¡, è¿™æ— ç–‘ä¹Ÿæ˜¯åŠ å¤§äº† docker ä½¿ç”¨éš¾åº¦, è€Œä¸”è¿™ç§æ¨¡å¼æ˜æ˜¾æ˜¯æŠŠ docker å½“åšè™šæ‹Ÿæœºæ¥ä½¿ç”¨, ä»ç„¶æ˜¯ IaaS å¹³å°çš„è€æ€è·¯, è¿èƒŒäº† docker å€¡å¯¼çš„ä½¿ç”¨è§„åˆ™.</p>
<p>ç”±äºZookeeper çš„åŸå› , åˆ°ç›®å‰ä¸ºæ­¢, å¯¹ docker é›†ç¾¤å¹³å°(PaaS) å¹³å°çš„æ¢ç´¢å°†æ”¾æ…¢è„šæ­¥, ä¹Ÿå¸Œæœ›åœ¨ä»¥åçš„ä¸€æ®µæ—¶é—´èƒ½æ‰¾åˆ°è¡Œä¹‹æœ‰æ•ˆçš„å®Œç¾è§£å†³æ–¹æ¡ˆ, å¦‚æœå¤§å®¶æœ‰ä»€ä¹ˆæƒ³æ³•, å¯ä»¥æ²Ÿé€šä¸€ä¸‹, è®©æˆ‘å¼€é˜”ä¸€ä¸‹çœ¼ç•Œ.</p>
]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>docker</tag>
        <tag>é›†ç¾¤</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS7ä¸‹å‡çº§å†…æ ¸ç‰ˆæœ¬</title>
    <url>/2017/06/02/CentOS%E4%B8%8B%E5%8D%87%E7%BA%A7%E5%86%85%E6%A0%B8%E7%89%88%E6%9C%AC/</url>
    <content><![CDATA[<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org</span><br><span class="line"></span><br><span class="line">rpm -Uvh https://www.elrepo.org/elrepo-release-7.0-3.el7.elrepo.noarch.rpm</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å¯ä»¥å®‰è£…çš„å†…æ ¸ç‰ˆæœ¬</span></span><br><span class="line">yum --disablerepo=<span class="string">"*"</span> --enablerepo=<span class="string">"elrepo-kernel"</span> list available</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£… LTS ç‰ˆæœ¬çš„å†…æ ¸</span></span><br><span class="line">yum --enablerepo=elrepo-kernel  install  kernel<span class="_">-lt</span> -y</span><br><span class="line"></span><br><span class="line"><span class="comment"># æˆ–è€…å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„å†…æ ¸</span></span><br><span class="line">yum --enablerepo=elrepo-kernel install  kernel-ml-devel kernel-ml</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å†…æ ¸åˆ—è¡¨</span></span><br><span class="line">awk -F\<span class="string">' '</span><span class="variable">$1</span>==<span class="string">"menuentry "</span> &#123;<span class="built_in">print</span> i++ <span class="string">" : "</span> <span class="variable">$2</span>&#125;<span class="string">' /etc/grub2.cfg</span></span><br><span class="line"><span class="string"># æ–°å®‰è£…çš„å†…æ ¸ä¼šæ’å…¥åœ¨å½“å‰ä½¿ç”¨å†…æ ¸çš„å‰é¢</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># æŸ¥çœ‹å½“å‰ä½¿ç”¨çš„å†…æ ¸</span></span><br><span class="line"><span class="string">grub2-editenv list</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#ä¿®æ”¹å†…æ ¸å¯åŠ¨é¡ºåºï¼ŒæŒ‰ç…§ä¸Šé¢å‘½ä»¤çš„å›æ˜¾, æŒ‡å®šå¯åŠ¨ä½¿ç”¨ç¬¬0å·å†…æ ¸ç‰ˆæœ¬</span></span><br><span class="line"><span class="string">grub2-set-default 0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">reboot</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">uname -a</span></span><br></pre></td></tr></table></figure>

<p>å‚è€ƒæ–‡æ¡£</p>
<ul>
<li><a href="http://elrepo.org/tiki/tiki-index.php" target="_blank" rel="noopener">http://elrepo.org/tiki/tiki-index.php</a></li>
<li>æ‰‹åŠ¨ä¸‹è½½ RPM åŒ…: <a href="http://elrepo.org/tiki/Download" target="_blank" rel="noopener">http://elrepo.org/tiki/Download</a></li>
<li><a href="https://blog.csdn.net/kikajack/article/details/79396793" target="_blank" rel="noopener">https://blog.csdn.net/kikajack/article/details/79396793</a></li>
<li><a href="https://wiki.centos.org/zh/HowTos/Grub2" target="_blank" rel="noopener">https://wiki.centos.org/zh/HowTos/Grub2</a></li>
</ul>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>å†…æ ¸</tag>
        <tag>kernel</tag>
      </tags>
  </entry>
  <entry>
    <title>Linuxç³»ç»Ÿå¼€æœºæ—¶åŠ è½½æŒ‡å®šæ¨¡å—</title>
    <url>/2017/06/02/Linux%E7%B3%BB%E7%BB%9F%E5%BC%80%E6%9C%BA%E6%97%B6%E5%8A%A0%E8%BD%BD%E6%8C%87%E5%AE%9A%E6%A8%A1%E5%9D%97/</url>
    <content><![CDATA[<h1 id="ç¬¬ä¸€ç§æ–¹å¼"><a href="#ç¬¬ä¸€ç§æ–¹å¼" class="headerlink" title="ç¬¬ä¸€ç§æ–¹å¼"></a>ç¬¬ä¸€ç§æ–¹å¼</h1><p>åœ¨ <code>/etc/sysconfig/modules/</code> ä¸‹åˆ›å»º <code>*.modules</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; vim /etc/sysconfig/modules/my.modules</span><br><span class="line"></span><br><span class="line">modprobe overlay</span><br><span class="line"></span><br><span class="line">&gt; chmod 755 /etc/sysconfig/modules/my.modules</span><br></pre></td></tr></table></figure>

<h1 id="ç¬¬äºŒç§æ–¹å¼"><a href="#ç¬¬äºŒç§æ–¹å¼" class="headerlink" title="ç¬¬äºŒç§æ–¹å¼"></a>ç¬¬äºŒç§æ–¹å¼</h1><p>åœ¨ <code>/etc/rc.modules</code> é‡Œé¢åŠ ä¸Š <code>modprobe fuse</code>, æ²¡æœ‰çš„è¯åˆ›å»ºè¯¥æ–‡ä»¶</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; vim /etc/rc.modules</span><br><span class="line"></span><br><span class="line">modprobe overlay</span><br></pre></td></tr></table></figure>

<hr>
<p><strong>reboot</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">âœ  ~ lsmod | grep over</span><br><span class="line">overlay                42451  0</span><br></pre></td></tr></table></figure>

<h1 id="ç¬¬ä¸‰ç§æ–¹å¼"><a href="#ç¬¬ä¸‰ç§æ–¹å¼" class="headerlink" title="ç¬¬ä¸‰ç§æ–¹å¼"></a>ç¬¬ä¸‰ç§æ–¹å¼</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"overlay"</span> &gt; /etc/modules-load.d/overlay.conf</span><br><span class="line"></span><br><span class="line">reboot</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>æ¨¡å—</tag>
      </tags>
  </entry>
  <entry>
    <title>Swapçš„ä½¿ç”¨é¢‘ç‡</title>
    <url>/2017/06/02/Swap%E7%9A%84%E4%BD%BF%E7%94%A8%E9%A2%91%E7%8E%87/</url>
    <content><![CDATA[<p>é€šè¿‡è°ƒæ•´<code>swappiness</code>çš„å€¼, å¯ä»¥è°ƒæ•´ç³»ç»Ÿä½¿ç”¨ swap çš„é¢‘ç‡</p>
<p>è¯¥å€¼è¶Šå°, è¡¨ç¤ºè¶Šå¤§é™åº¦çš„ä½¿ç”¨ç‰©ç†å†…å­˜, æœ€å°å€¼=0</p>
<p>è¯¥å€¼è¶Šå¤§, è¡¨ç¤ºè¶Šç§¯æçš„ä½¿ç”¨ swap äº¤æ¢åˆ†åŒº, æœ€å¤§å€¼=100</p>
<h1 id="æŸ¥çœ‹-swappiness-å€¼"><a href="#æŸ¥çœ‹-swappiness-å€¼" class="headerlink" title="æŸ¥çœ‹ swappiness å€¼"></a>æŸ¥çœ‹ swappiness å€¼</h1><p><code>cat /proc/sys/vm/swappiness</code></p>
<p>centos ä¸­é»˜è®¤ä¸º10, Ubuntu ä¸­é»˜è®¤ä¸º60</p>
<h1 id="ä¸´æ—¶ä¿®æ”¹-é‡å¯å¤±æ•ˆ"><a href="#ä¸´æ—¶ä¿®æ”¹-é‡å¯å¤±æ•ˆ" class="headerlink" title="ä¸´æ—¶ä¿®æ”¹ (é‡å¯å¤±æ•ˆ)"></a>ä¸´æ—¶ä¿®æ”¹ (é‡å¯å¤±æ•ˆ)</h1><p> sysctl vm.swappiness=59</p>
<h1 id="æ°¸ä¹…ä¿®æ”¹"><a href="#æ°¸ä¹…ä¿®æ”¹" class="headerlink" title="æ°¸ä¹…ä¿®æ”¹"></a>æ°¸ä¹…ä¿®æ”¹</h1><p><code>echo &quot;vm.swappiness=59&quot; &gt;&gt; /etc/sysctl.conf</code></p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>swap</tag>
      </tags>
  </entry>
  <entry>
    <title>docker network ç½‘ç»œç®¡ç†</title>
    <url>/2017/04/23/docker-network-%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86/</url>
    <content><![CDATA[<blockquote>
<ul>
<li>Docker ç®¡ç†å‘½ä»¤<ul>
<li>å®¹å™¨ç®¡ç†</li>
<li>é•œåƒç®¡ç†</li>
<li><strong>ç½‘ç»œç®¡ç†</strong></li>
<li>ç³»ç»Ÿç®¡ç†</li>
<li>æ•°æ®å·ç®¡ç†</li>
<li>å¿«ç…§ç®¡ç†</li>
<li>æ’ä»¶ç®¡ç†</li>
<li>å…¶ä»–</li>
<li>swarmkit ç®¡ç†<ul>
<li>æ¨¡å¼ç®¡ç†</li>
<li>èŠ‚ç‚¹ç®¡ç†</li>
<li>ç§˜é’¥ç®¡ç†</li>
<li>æœåŠ¡ç®¡ç†</li>
<li>æœåŠ¡æ ˆç®¡ç†</li>
</ul>
</li>
</ul>
</li>
</ul>
</blockquote>
<h1 id="ç½‘ç»œç®¡ç†-network"><a href="#ç½‘ç»œç®¡ç†-network" class="headerlink" title="ç½‘ç»œç®¡ç† network"></a>ç½‘ç»œç®¡ç† network</h1><p>Docker çš„ç½‘ç»œæ¨¡å¼ç¹å¤š, æˆªæ­¢è‡³å½“å‰ç‰ˆæœ¬(17.04.0-ce), Docker å†…ç½®äº†5ç§ç½‘ç»œå¼•æ“ä¾›å¤§å®¶ä½¿ç”¨</p>
<ul>
<li>bridge é»˜è®¤çš„ç½‘æ¡¥+NATæ¨¡å¼</li>
<li>host ä¸»æœºæ¨¡å¼(æ€§èƒ½æŸè€—æœ€å°‘, ä½†æ˜¯æœ‰å®‰å…¨æ€§é—®é¢˜, å› ä¸ºå®¹å™¨å†…éƒ¨å¯ä»¥ç›´æ¥ä¿®æ”¹å®¿ä¸»æœºç½‘å¡é…ç½®æ–‡ä»¶)</li>
<li>macvlan å¼•å…¥ä¹‹åˆåœ¨äºè§£å†³æœ¬å®¿ä¸»æœºçš„å®¹å™¨äº’è”é—®é¢˜(1.13ç‰ˆæœ¬ä¹‹åé»˜è®¤é›†æˆè¿›æ¥çš„ç½‘ç»œæ’ä»¶)</li>
<li>null ä¸è®¾ç½®ä»»ä½•ç½‘ç»œå¼•æ“</li>
<li>overlay è·¨ä¸»æœºäº’è”, é›†ç¾¤æ¨¡å¼ä¸‹ä½¿ç”¨è¾ƒå¤š</li>
</ul>
<h2 id="create"><a href="#create" class="headerlink" title="create"></a>create</h2><p>åˆ›å»ºç½‘ç»œä¸€èˆ¬ç”¨äºå¯¹å®¹å™¨å†…ç½‘ IP åœ°å€æ®µæœ‰è¦æ±‚çš„æƒ…å†µ, ä¸€èˆ¬åœ¨é›†ç¾¤æ¨¡å¼ä¸‹åˆ›å»ºè‡ªå®šä¹‰ overlay ç½‘ç»œçš„æƒ…å†µè¾ƒå¤š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker network create --driver overlay my-network</span></span><br></pre></td></tr></table></figure>

<p>åœ¨é›†ç¾¤æ¨¡å¼ä¸­åˆ›å»º overlay ç½‘ç»œå, åˆ›å»ºçš„æœåŠ¡å¯ä»¥æŒ‡å®šåŠ å…¥åˆ°æ–°çš„ç½‘ç»œä¸­</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker service ceate --replicas 3 --network my-network --name my-web nginx</span></span><br></pre></td></tr></table></figure>

<h2 id="connect-disconnect"><a href="#connect-disconnect" class="headerlink" title="connect/disconnect"></a>connect/disconnect</h2><p>å°†å®¹å™¨åŠ å…¥/ç¦»å¼€æŒ‡å®šçš„ç½‘ç»œ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker network connect [OPTIONS] NETWORK CONTAINER</span><br><span class="line">docker network disconnect [OPTIONS] NETWORK CONTAINER</span><br></pre></td></tr></table></figure>

<h2 id="ls-inspect"><a href="#ls-inspect" class="headerlink" title="ls/inspect"></a>ls/inspect</h2><p>æŸ¥çœ‹ç½‘ç»œé…ç½®åˆ—è¡¨/æŸ¥çœ‹ç½‘ç»œè¯¦ç»†ä¿¡æ¯</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker network ls</span><br><span class="line">docker network inspect [OPTIONS] NETWORK [NETWORK...]</span><br></pre></td></tr></table></figure>

<h2 id="rm-prune"><a href="#rm-prune" class="headerlink" title="rm/prune"></a>rm/prune</h2><p>åˆ é™¤æŒ‡å®šç½‘ç»œ/åˆ é™¤æ²¡æœ‰å¼•ç”¨çš„ç½‘ç»œ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">docker network rm NETWORK [NETWORK...]</span><br><span class="line">docker network prune [OPTIONS]</span><br></pre></td></tr></table></figure>





]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>network</tag>
      </tags>
  </entry>
  <entry>
    <title>docker image å®¹å™¨ç®¡ç†</title>
    <url>/2017/04/23/docker-image-%E5%AE%B9%E5%99%A8%E7%AE%A1%E7%90%86/</url>
    <content><![CDATA[<blockquote>
<ul>
<li>Docker ç®¡ç†å‘½ä»¤<ul>
<li>å®¹å™¨ç®¡ç†</li>
<li><strong>é•œåƒç®¡ç†</strong></li>
<li>ç½‘ç»œç®¡ç†</li>
<li>ç³»ç»Ÿç®¡ç†</li>
<li>æ•°æ®å·ç®¡ç†</li>
<li>å¿«ç…§ç®¡ç†</li>
<li>æ’ä»¶ç®¡ç†</li>
<li>å…¶ä»–</li>
<li>swarmkit ç®¡ç†<ul>
<li>æ¨¡å¼ç®¡ç†</li>
<li>èŠ‚ç‚¹ç®¡ç†</li>
<li>ç§˜é’¥ç®¡ç†</li>
<li>æœåŠ¡ç®¡ç†</li>
<li>æœåŠ¡æ ˆç®¡ç†</li>
</ul>
</li>
</ul>
</li>
</ul>
</blockquote>
<h1 id="é•œåƒç®¡ç†-image"><a href="#é•œåƒç®¡ç†-image" class="headerlink" title="é•œåƒç®¡ç† image"></a>é•œåƒç®¡ç† image</h1><h2 id="build"><a href="#build" class="headerlink" title="build"></a>build</h2><p>æ ¹æ® dockerfile æ„å»ºé•œåƒ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker image build -t centos2 .</span></span><br><span class="line">Sending build context to Docker daemon  19.46kB</span><br><span class="line">Step 1/2 : FROM centos</span><br><span class="line"> ---&gt; a8493f5f50ff</span><br><span class="line">Step 2/2 : LABEL author <span class="string">"lvrui"</span></span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> 9a996772de96</span><br><span class="line"> ---&gt; 61b7efba9133</span><br><span class="line">Removing intermediate container 9a996772de96</span><br><span class="line">Successfully built 61b7efba9133</span><br><span class="line">root@ubuntu:~<span class="comment"># cat dockerfile </span></span><br><span class="line">FROM centos</span><br><span class="line">LABEL author=<span class="string">"lvrui"</span></span><br><span class="line">root@ubuntu:~<span class="comment"># docker image ls</span></span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED              SIZE</span><br><span class="line">centos2             latest              61b7efba9133        About a minute ago   192MB</span><br><span class="line">nginx2              0.1                 7cb5220c81d5        2 hours ago          204MB</span><br><span class="line">centos              latest              a8493f5f50ff        37 hours ago         192MB</span><br><span class="line">nginx               latest              5766334bdaa0        41 hours ago         183MB</span><br><span class="line">hello-world         latest              48b5124b2768        2 months ago         1.84kB</span><br></pre></td></tr></table></figure>

<p>-t çš„ä½œç”¨æ˜¯æ‰“æ ‡ç­¾, å¯ä»¥ç›´æ¥æ‰“æˆ Registry çš„å½¢å¼, æ–¹ä¾¿ç›´æ¥ push åˆ° Registry</p>
<p>å¦‚æœæ²¡æœ‰æ‰“èµ Registry åœ°å€ä¹Ÿæ²¡æœ‰å…³ç³»,åæœŸå¯ä»¥é€šè¿‡ tag å‘½ä»¤ä¿®æ”¹</p>
<h2 id="history"><a href="#history" class="headerlink" title="history"></a>history</h2><p>æ˜¾ç¤ºé•œåƒçš„å†å²æ„å»ºä¿¡æ¯</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker image ls</span></span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">centos2             latest              61b7efba9133        2 minutes ago       192MB</span><br><span class="line">nginx2              0.1                 7cb5220c81d5        2 hours ago         204MB</span><br><span class="line">centos              latest              a8493f5f50ff        37 hours ago        192MB</span><br><span class="line">nginx               latest              5766334bdaa0        41 hours ago        183MB</span><br><span class="line">hello-world         latest              48b5124b2768        2 months ago        1.84kB</span><br><span class="line">root@ubuntu:~<span class="comment"># docker image history centos2</span></span><br><span class="line">IMAGE               CREATED             CREATED BY                                      SIZE                COMMENT</span><br><span class="line">61b7efba9133        2 minutes ago       /bin/sh -c <span class="comment">#(nop)  LABEL author=lvrui           0B                  </span></span><br><span class="line">a8493f5f50ff        37 hours ago        /bin/sh -c <span class="comment">#(nop)  CMD ["/bin/bash"]            0B                  </span></span><br><span class="line">&lt;missing&gt;           37 hours ago        /bin/sh -c <span class="comment">#(nop)  LABEL name=CentOS Base ...   0B                  </span></span><br><span class="line">&lt;missing&gt;           37 hours ago        /bin/sh -c <span class="comment">#(nop) ADD file:807143da05d7013...   192MB</span></span><br></pre></td></tr></table></figure>

<h2 id="import-save-load"><a href="#import-save-load" class="headerlink" title="import/save/load"></a>import/save/load</h2><ul>
<li>import å¯¼å…¥é•œåƒ, å¯¼å…¥ export å‡ºæ¥çš„é•œåƒ</li>
<li>save å¯¼å‡ºé•œåƒ</li>
<li>load å¯¼å…¥é•œåƒ, å¯¼å…¥ save å‡ºæ¥çš„é•œåƒ</li>
</ul>
<h2 id="inspect"><a href="#inspect" class="headerlink" title="inspect"></a>inspect</h2><p>æŸ¥çœ‹é•œåƒè¯¦ç»†ä¿¡æ¯</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker image inspect centos2</span></span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">"Id"</span>: <span class="string">"sha256:61b7efba9133e4ceaf4046e76a2f455a1204a8a794f16920c7543010e2759323"</span>,</span><br><span class="line">        <span class="string">"RepoTags"</span>: [</span><br><span class="line">            <span class="string">"centos2:latest"</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="string">"RepoDigests"</span>: [],</span><br><span class="line">        <span class="string">"Parent"</span>: <span class="string">"sha256:a8493f5f50ffda70c2eeb2d09090debf7d39c8ffcd63b43ff81b111ece6f28bf"</span>,</span><br><span class="line">        <span class="string">"Comment"</span>: <span class="string">""</span>,</span><br><span class="line">        <span class="string">"Created"</span>: <span class="string">"2017-04-08T09:12:50.750877048Z"</span>,</span><br><span class="line">        <span class="string">"Container"</span>: <span class="string">"9a996772de96183b48460aa1f02b907d1e8d97f8d322cc41aff909d2a8a74b61"</span>,</span><br><span class="line">        <span class="string">"ContainerConfig"</span>: &#123;</span><br><span class="line">            <span class="string">"Hostname"</span>: <span class="string">"f85c553c1496"</span>,</span><br><span class="line">            <span class="string">"Domainname"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"User"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"AttachStdin"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"AttachStdout"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"AttachStderr"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"Tty"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"OpenStdin"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"StdinOnce"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"Env"</span>: [</span><br><span class="line">                <span class="string">"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="string">"Cmd"</span>: [</span><br><span class="line">                <span class="string">"/bin/sh"</span>,</span><br><span class="line">                <span class="string">"-c"</span>,</span><br><span class="line">                <span class="string">"#(nop) "</span>,</span><br><span class="line">                <span class="string">"LABEL author=lvrui"</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="string">"Image"</span>: <span class="string">"sha256:a8493f5f50ffda70c2eeb2d09090debf7d39c8ffcd63b43ff81b111ece6f28bf"</span>,</span><br><span class="line">            <span class="string">"Volumes"</span>: null,</span><br><span class="line">            <span class="string">"WorkingDir"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"Entrypoint"</span>: null,</span><br><span class="line">            <span class="string">"OnBuild"</span>: [],</span><br><span class="line">            <span class="string">"Labels"</span>: &#123;</span><br><span class="line">                <span class="string">"author"</span>: <span class="string">"lvrui"</span>,</span><br><span class="line">                <span class="string">"build-date"</span>: <span class="string">"20170406"</span>,</span><br><span class="line">                <span class="string">"license"</span>: <span class="string">"GPLv2"</span>,</span><br><span class="line">                <span class="string">"name"</span>: <span class="string">"CentOS Base Image"</span>,</span><br><span class="line">                <span class="string">"vendor"</span>: <span class="string">"CentOS"</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"DockerVersion"</span>: <span class="string">"17.04.0-ce"</span>,</span><br><span class="line">        <span class="string">"Author"</span>: <span class="string">""</span>,</span><br><span class="line">        <span class="string">"Config"</span>: &#123;</span><br><span class="line">            <span class="string">"Hostname"</span>: <span class="string">"f85c553c1496"</span>,</span><br><span class="line">            <span class="string">"Domainname"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"User"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"AttachStdin"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"AttachStdout"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"AttachStderr"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"Tty"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"OpenStdin"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"StdinOnce"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"Env"</span>: [</span><br><span class="line">                <span class="string">"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="string">"Cmd"</span>: [</span><br><span class="line">                <span class="string">"/bin/bash"</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="string">"Image"</span>: <span class="string">"sha256:a8493f5f50ffda70c2eeb2d09090debf7d39c8ffcd63b43ff81b111ece6f28bf"</span>,</span><br><span class="line">            <span class="string">"Volumes"</span>: null,</span><br><span class="line">            <span class="string">"WorkingDir"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"Entrypoint"</span>: null,</span><br><span class="line">            <span class="string">"OnBuild"</span>: [],</span><br><span class="line">            <span class="string">"Labels"</span>: &#123;</span><br><span class="line">                <span class="string">"author"</span>: <span class="string">"lvrui"</span>,</span><br><span class="line">                <span class="string">"build-date"</span>: <span class="string">"20170406"</span>,</span><br><span class="line">                <span class="string">"license"</span>: <span class="string">"GPLv2"</span>,</span><br><span class="line">                <span class="string">"name"</span>: <span class="string">"CentOS Base Image"</span>,</span><br><span class="line">                <span class="string">"vendor"</span>: <span class="string">"CentOS"</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"Architecture"</span>: <span class="string">"amd64"</span>,</span><br><span class="line">        <span class="string">"Os"</span>: <span class="string">"linux"</span>,</span><br><span class="line">        <span class="string">"Size"</span>: 192481139,</span><br><span class="line">        <span class="string">"VirtualSize"</span>: 192481139,</span><br><span class="line">        <span class="string">"GraphDriver"</span>: &#123;</span><br><span class="line">            <span class="string">"Data"</span>: null,</span><br><span class="line">            <span class="string">"Name"</span>: <span class="string">"aufs"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"RootFS"</span>: &#123;</span><br><span class="line">            <span class="string">"Type"</span>: <span class="string">"layers"</span>,</span><br><span class="line">            <span class="string">"Layers"</span>: [</span><br><span class="line">                <span class="string">"sha256:36018b5e978717a047892794aebab513ba6856dbe1bdfeb478ca1219df2c7e9c"</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h2 id="ls"><a href="#ls" class="headerlink" title="ls"></a>ls</h2><p>ä½œç”¨ç­‰åŒäº <code>docker images</code> æŸ¥çœ‹é•œåƒåˆ—è¡¨</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker image ls</span></span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">centos2             latest              61b7efba9133        3 hours ago         192MB</span><br><span class="line">nginx2              0.1                 7cb5220c81d5        5 hours ago         204MB</span><br><span class="line">centos              latest              a8493f5f50ff        40 hours ago        192MB</span><br><span class="line">nginx               latest              5766334bdaa0        44 hours ago        183MB</span><br><span class="line">hello-world         latest              48b5124b2768        2 months ago        1.84kB</span><br></pre></td></tr></table></figure>

<h2 id="prune"><a href="#prune" class="headerlink" title="prune"></a>prune</h2><p>åˆ é™¤æ²¡æœ‰è¢«å¼•ç”¨çš„é•œåƒ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker image prune</span></span><br></pre></td></tr></table></figure>

<h2 id="tag-pull-push"><a href="#tag-pull-push" class="headerlink" title="tag/pull/push"></a>tag/pull/push</h2><ul>
<li>tag: æ‰“æ ‡ç­¾</li>
<li>pull: ä»è¿œç¨‹ä»“åº“ Registry æ‹‰å–é•œåƒ</li>
<li>push: ä»æœ¬åœ°ä¸Šä¼ é•œåƒ</li>
</ul>
<h4 id="ä»registryä¸­æ‹‰å–é•œåƒï¼š"><a href="#ä»registryä¸­æ‹‰å–é•œåƒï¼š" class="headerlink" title="ä»registryä¸­æ‹‰å–é•œåƒï¼š"></a>ä»registryä¸­æ‹‰å–é•œåƒï¼š</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo docker pull registry.cn-beijing.aliyuncs.com/lvreg/webconsole:[é•œåƒç‰ˆæœ¬å·]</span><br></pre></td></tr></table></figure>

<h4 id="å°†é•œåƒæ¨é€åˆ°registryï¼š"><a href="#å°†é•œåƒæ¨é€åˆ°registryï¼š" class="headerlink" title="å°†é•œåƒæ¨é€åˆ°registryï¼š"></a>å°†é•œåƒæ¨é€åˆ°registryï¼š</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo docker login --username=lvrui03@126.com registry.cn-beijing.aliyuncs.com</span><br><span class="line">$ sudo docker tag [ImageId] registry.cn-beijing.aliyuncs.com/lvreg/webconsole:[é•œåƒç‰ˆæœ¬å·]</span><br><span class="line">$ sudo docker push registry.cn-beijing.aliyuncs.com/lvreg/webconsole:[é•œåƒç‰ˆæœ¬å·]</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„: å¦‚æœ Registry æœ‰å¯†ç , è¿˜éœ€è¦å…ˆ login åˆ°é•œåƒä»“åº“æ‰å¯ä»¥ä¸Šä¼ é•œåƒ</p>
<h2 id="rm"><a href="#rm" class="headerlink" title="rm"></a>rm</h2><p>åˆ é™¤æŒ‡å®šçš„é•œåƒ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker image rm centos2:latest</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>image</tag>
      </tags>
  </entry>
  <entry>
    <title>dockerfileæœ€ä½³å®è·µ</title>
    <url>/2017/04/22/dockerfile%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/</url>
    <content><![CDATA[<blockquote>
<p>é€šè¿‡ dockerfile å¯ä»¥åˆ¶ä½œé•œåƒ, é€šè¿‡ä¼˜åŒ– dockerfile ä¸­çš„æŒ‡ä»¤, å¯ä»¥å‡å°‘é•œåƒçš„ä½“ç§¯. æŒ‰ç…§ä¸€äº›è§„èŒƒåˆ¶ä½œ dockerfile, å¯ä»¥å¢åŠ  dockerfile çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§</p>
</blockquote>
<h1 id="åŸºæœ¬åŸåˆ™"><a href="#åŸºæœ¬åŸåˆ™" class="headerlink" title="åŸºæœ¬åŸåˆ™"></a>åŸºæœ¬åŸåˆ™</h1><ul>
<li>å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸæ˜¯çŸ­æš‚çš„(æ— çŠ¶æ€å®¹å™¨)<br>é€šè¿‡ dockerfile åˆ¶ä½œå‡ºçš„é•œåƒ, ä»é•œåƒå¯åŠ¨å®¹å™¨, è¿™äº›å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸåº”å°½é‡çŸ­æš‚. è¿™é‡Œçš„çŸ­æš‚æ„å‘³ç€å®¹å™¨éšæ—¶å¯ä»¥è¢«åœæ­¢å’Œåˆ é™¤. é€šè¿‡ç®€å•çš„é…ç½®å¯ä»¥ç«‹å³å¯åŠ¨ä¸€ä¸ªæ–°çš„å®¹å™¨</li>
<li>å°½é‡ä½¿ç”¨å¹²å‡€çš„ç›®å½•å»åˆ¶ä½œé•œåƒ, é¿å…ä¸å¿…è¦çš„æ€§èƒ½æŸè€—, å¿…è¦æ—¶å¯ä»¥ä½¿ç”¨<code>.dockerignore</code>æ–‡ä»¶æ’é™¤ä¸éœ€è¦æ‰«æçš„ç›®å½•</li>
<li>åªå®‰è£…éœ€è¦çš„åŒ…<br>ä¸ºäº†å‡å°‘é•œåƒçš„ä½“ç§¯å’Œç¼–è¯‘æ—¶é—´, åº”è¯¥é¿å…å®‰è£…é¢å¤–çš„, ä¸éœ€è¦çš„åŒ…</li>
<li>æ¯ä¸ªå®¹å™¨åªè¿è¡Œä¸€ä¸ªè¿›ç¨‹</li>
<li>å‡å°‘é•œåƒå±‚<br>dockerfile ä¸­çš„æŒ‡ä»¤ä¼šç”Ÿæˆæ–°çš„é•œåƒå±‚, ä¸€ä¸ªé•œåƒæœ€å¤šæœ‰127å±‚</li>
<li>æŠŠå¤šä¸ªå‚æ•°æ’åœ¨ä¸åŒçš„è¡Œä¸­æé«˜å¯è¯»æ€§<code>\</code></li>
</ul>
<p><strong>æ³¨æ„: ç¼–è¯‘ç¼“å­˜çš„é—®é¢˜<br>é’ˆå¯¹ ADD å’Œ COPY å‘½ä»¤, docker ä¼šæ£€æŸ¥é•œåƒå±‚ä¸­æ‰€æœ‰æºæ–‡ä»¶çš„å…ƒæ•°æ®å’Œæ–‡ä»¶å†…å®¹. å…¶ä¸­æ£€æŸ¥å…ƒæ•°æ®çš„æ—¶å€™, ä¸ä¼šæ£€æŸ¥æœ€åä¿®æ”¹æ—¶é—´å’Œè®¿é—®æ—¶é—´.<br>docker åœ¨é•œåƒç¼“å­˜ä¸­å¯»æ‰¾é•œåƒå±‚æ—¶, ä¸ä¼šæ£€æŸ¥æ–‡ä»¶. ä¾‹å¦‚, åœ¨æ‰§è¡Œ RUN yum update æ—¶, docker ä»…ä»…ä¼šæ¯”è¾ƒ RUN å‘½ä»¤çš„æœ¬èº«.</strong></p>
<h1 id="FROM-æŒ‡ä»¤æœ€ä½³å®è·µ"><a href="#FROM-æŒ‡ä»¤æœ€ä½³å®è·µ" class="headerlink" title="FROM æŒ‡ä»¤æœ€ä½³å®è·µ"></a>FROM æŒ‡ä»¤æœ€ä½³å®è·µ</h1><p>å°½é‡ä½¿ç”¨å®˜æ–¹é•œåƒä½œä¸ºåŸºç¡€é•œåƒ. å¦‚æœè€ƒè™‘é•œåƒçš„å¤§å°, å¯ä»¥ä½¿ç”¨ Debian çš„å®˜æ–¹é•œåƒ, è¯¥é•œåƒä½“ç§¯å°è€Œä¸” Docker å¯¹ä»–è¿›è¡Œäº†ä¼˜åŒ–, store.docker.com ä¸­æœ‰å¾ˆå¤šå®˜æ–¹é•œåƒéƒ½æ˜¯åŸºäº Debian çš„é•œåƒæ‰“é€ </p>
<h1 id="RUN-æŒ‡ä»¤æœ€ä½³å®è·µ"><a href="#RUN-æŒ‡ä»¤æœ€ä½³å®è·µ" class="headerlink" title="RUN æŒ‡ä»¤æœ€ä½³å®è·µ"></a>RUN æŒ‡ä»¤æœ€ä½³å®è·µ</h1><ul>
<li>ä»å¯è¯»æ€§çš„è§’åº¦è€ƒè™‘, ä½¿ç”¨ RUN å‘½ä»¤æ—¶, åº”ä½¿ç”¨ <code>\</code> å°†æŒ‡ä»¤åˆ†æˆå¤šè¡Œ</li>
<li>é¿å…æ›´æ–°åŸºç¡€é•œåƒä¸­çš„åŸºç¡€è½¯ä»¶åŒ…, é¿å…æ‰§è¡Œç±»ä¼¼äº <code>yum update</code> æˆ– <code>apt upgrade</code>çš„å‘½ä»¤. åœ¨æ²¡æœ‰ä½¿ç”¨ <code>--privileged</code>çš„è¿è¡Œå®¹å™¨ä¸­, åŸºç¡€é•œåƒä¸­çš„å¾ˆå¤šåŸºç¡€åŒ…æ˜¯ä¸èƒ½å‡çº§çš„. </li>
<li>ç”±äºé•œåƒçš„ç¼“å­˜æœºåˆ¶, åœ¨å®‰è£…è½¯ä»¶åŒ…æ—¶, æ›´æ–°è½¯ä»¶ä»“åº“ç´¢å¼•å’Œå®‰è£…è½¯ä»¶åŒ…å¿…é¡»åœ¨åŒä¸€ä¸ª RUN é‡Œæ‰§è¡Œ, å¦åˆ™å¯èƒ½ä¼šå¯¼è‡´å®‰è£…å¤±è´¥</li>
</ul>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="comment"># âœ”ï¸æ­£ç¡®å†™æ³•</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> apt update &amp;&amp; apt install -y \</span></span><br><span class="line"><span class="bash">	dstat \</span></span><br><span class="line"><span class="bash">    htop \</span></span><br><span class="line"><span class="bash">    lsof</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># âŒé”™è¯¯å†™æ³•</span><br><span class="line">RUN apt update</span><br><span class="line">RUN apt install -y \</span><br><span class="line">	dstat \</span><br><span class="line">    htop \</span><br><span class="line">    lsof</span><br></pre></td></tr></table></figure>

<p>ç”±äºé•œåƒçš„ç¼“å­˜æœºåˆ¶, åªéªŒè¯çš„ RUN åé¢çš„å‘½ä»¤, ä¼šå¯¼è‡´æ‰§è¡Œè¿‡ä¸€æ¬¡ <code>apt update</code> ä¹‹å, å†æ¬¡é‡åˆ°æ›´æ–°æ—¶å°†ä¼šä½¿ç”¨ç¼“å­˜é•œåƒ, ä»è€Œå¯¼è‡´ä»¥åå®‰è£…ä¸åˆ°æœ€æ–°çš„è½¯ä»¶åŒ…</p>
<p>ä½¿ç”¨<code>RUN apt update &amp;&amp; apt install -y \</code>çš„æ–¹å¼å¯ä»¥ä¿è¯æ¯æ¬¡ç¼–è¯‘é•œåƒæ—¶, éƒ½æ˜¯å®‰è£…çš„æœ€æ–°çš„åŒ…. è¿™ç§æŠ€æœ¯å«åšâ€ç¼“å­˜å¤±æ•ˆâ€</p>
<ul>
<li>å°½é‡åœ¨ä¸€æ¡ RUN æŒ‡ä»¤ä¸­åŒ…å«æ‰€æœ‰éœ€è¦çš„å®‰è£…åŒ…. å¦‚æœå®‰è£…åŒ…å¾ˆå¤š, å»ºè®®ä»¥é¦–å­—æ¯è¿›è¡Œæ’åº,æ¯è¡Œåªåˆ—å‡ºä¸€ä¸ªå®‰è£…åŒ…, æ–¹ä¾¿åæœŸç»´æŠ¤.</li>
<li>åœ¨å®‰è£…å‘½ä»¤çš„æœ€å, åº”è¯¥æ¸…ç†å®‰è£…ç¼“å­˜, å‡å°‘é•œåƒä½“ç§¯. æ‰§è¡Œ <code>... &amp;&amp; yum clean all</code> æˆ– <code>... &amp;&amp; rm -fr /var/lib/apt/lists/*</code></li>
</ul>
<h1 id="CMD-amp-ENTRYPOINT-æŒ‡ä»¤æœ€ä½³å®è·µ"><a href="#CMD-amp-ENTRYPOINT-æŒ‡ä»¤æœ€ä½³å®è·µ" class="headerlink" title="CMD &amp; ENTRYPOINT æŒ‡ä»¤æœ€ä½³å®è·µ"></a>CMD &amp; ENTRYPOINT æŒ‡ä»¤æœ€ä½³å®è·µ</h1><h2 id="CMD"><a href="#CMD" class="headerlink" title="CMD"></a>CMD</h2><p>CMD æŒ‡ä»¤è®¾ç½®é•œåƒä¸­çš„é»˜è®¤å¯åŠ¨å‘½ä»¤å’Œå‚æ•°. å®¹å™¨å¯åŠ¨ä¹‹å, å¦‚æœæ²¡æœ‰åŠ å…¥ä»»ä½•å¯åŠ¨å‘½ä»¤(ä¹Ÿå°±æ˜¯åœ¨é•œåƒå‚æ•°ä¹‹åæ²¡æœ‰æ·»åŠ ä»»ä½•å†…å®¹) åˆ™é»˜è®¤æ‰§è¡Œé•œåƒä¸­ CMD è®¾ç½®çš„é»˜è®¤çš„å¯åŠ¨å‘½ä»¤</p>
<ul>
<li><p>è®¾ç½®å¯åŠ¨å‘½ä»¤æ—¶, åº”è¯¥å°½é‡ä½¿ç”¨ JSON æ ¼å¼ <code>CMD [&quot;command&quot;, &quot;arg1&quot;, &quot;arg2&quot;]</code><br>ä¾‹å¦‚ Apache çš„å¯åŠ¨æ–¹å¼: <code>CMD [&quot;apache2&quot;, &quot;-DFOREGROUND&quot;]</code></p>
</li>
<li><p>å¦‚æœå¼€å‘è€…å’Œä½¿ç”¨è€…éƒ½ä¸æ˜¯å¾ˆç†Ÿæ‚‰ CMD å’Œ ENTRYPOINT çš„å·¥ä½œåŸç†çš„æƒ…å†µä¸‹, å°½é‡é¿å…è¿™ä¸¤ä¸ªæŒ‡ä»¤é…åˆä½¿ç”¨<br>ä¾‹å¦‚ Django çš„å¯åŠ¨æ–¹å¼: <code>CMD [&quot;python&quot;, &quot;manage.py&quot;, &quot;runserver&quot;, &quot;0.0.0.0:8000&quot;]</code></p>
</li>
<li><p>ç›¸å, å¦‚æœå¼€å‘è€…å’Œä½¿ç”¨è€…éƒ½å¾ˆç†Ÿæ‚‰ CMD å’Œ ENTRYPOINT çš„å·¥ä½œåŸç†, æ¨è CMD ä½œä¸º ENTRYPOINT çš„å‚æ•°æ¥é…å¥—ä½¿ç”¨</p>
</li>
</ul>
<h2 id="ENTRYPOINT"><a href="#ENTRYPOINT" class="headerlink" title="ENTRYPOINT"></a>ENTRYPOINT</h2><p>å½“éœ€è¦æŠŠå®¹å™¨å½“åšä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ä½¿ç”¨æ—¶, æ¨èé€šè¿‡ ENTRYPOINT æŒ‡ä»¤è®¾ç½®é•œåƒçš„å…¥å£ç¨‹åº</p>
<ul>
<li>å½“å¯åŠ¨ä¸»ç¨‹åºä¹‹å‰è¿˜éœ€è¦æ‰§è¡Œå¤§é‡çš„å‰ç½®æ“ä½œæ—¶, å¯ä»¥å°† ENTRYPOINT çš„å…¥å£æŒ‡ä»¤è®¾ç½®ä¸ºä¸€ä¸ªè„šæœ¬ <code>entrypoint.sh</code></li>
</ul>
<p>ä¾‹å¦‚ postgres çš„å®˜æ–¹ç”¨æ³•:</p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> [<span class="string">"docker-entrypoint.sh"</span>]</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">"postgres"</span>]</span></span><br></pre></td></tr></table></figure>
<p>docker-entrypoint.sh â¬‡ï¸</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">set</span> -e</span><br><span class="line"></span><br><span class="line"><span class="comment"># usage: file_env VAR [DEFAULT]</span></span><br><span class="line"><span class="comment">#    ie: file_env 'XYZ_DB_PASSWORD' 'example'</span></span><br><span class="line"><span class="comment"># (will allow for "$XYZ_DB_PASSWORD_FILE" to fill in the value of</span></span><br><span class="line"><span class="comment">#  "$XYZ_DB_PASSWORD" from a file, especially for Docker's secrets feature)</span></span><br><span class="line"><span class="function"><span class="title">file_env</span></span>() &#123;</span><br><span class="line">	<span class="built_in">local</span> var=<span class="string">"<span class="variable">$1</span>"</span></span><br><span class="line">	<span class="built_in">local</span> fileVar=<span class="string">"<span class="variable">$&#123;var&#125;</span>_FILE"</span></span><br><span class="line">	<span class="built_in">local</span> def=<span class="string">"<span class="variable">$&#123;2:-&#125;</span>"</span></span><br><span class="line">	<span class="keyword">if</span> [ <span class="string">"<span class="variable">$&#123;!var:-&#125;</span>"</span> ] &amp;&amp; [ <span class="string">"<span class="variable">$&#123;!fileVar:-&#125;</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">		<span class="built_in">echo</span> &gt;&amp;2 <span class="string">"error: both <span class="variable">$var</span> and <span class="variable">$fileVar</span> are set (but are exclusive)"</span></span><br><span class="line">		<span class="built_in">exit</span> 1</span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line">	<span class="built_in">local</span> val=<span class="string">"<span class="variable">$def</span>"</span></span><br><span class="line">	<span class="keyword">if</span> [ <span class="string">"<span class="variable">$&#123;!var:-&#125;</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">		val=<span class="string">"<span class="variable">$&#123;!var&#125;</span>"</span></span><br><span class="line">	<span class="keyword">elif</span> [ <span class="string">"<span class="variable">$&#123;!fileVar:-&#125;</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">		val=<span class="string">"<span class="variable">$(&lt; "$&#123;!fileVar&#125;")</span>"</span></span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line">	<span class="built_in">export</span> <span class="string">"<span class="variable">$var</span>"</span>=<span class="string">"<span class="variable">$val</span>"</span></span><br><span class="line">	<span class="built_in">unset</span> <span class="string">"<span class="variable">$fileVar</span>"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">"<span class="variable">$&#123;1:0:1&#125;</span>"</span> = <span class="string">'-'</span> ]; <span class="keyword">then</span></span><br><span class="line">	<span class="built_in">set</span> -- postgres <span class="string">"<span class="variable">$@</span>"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># allow the container to be started with `--user`</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">"<span class="variable">$1</span>"</span> = <span class="string">'postgres'</span> ] &amp;&amp; [ <span class="string">"<span class="variable">$(id -u)</span>"</span> = <span class="string">'0'</span> ]; <span class="keyword">then</span></span><br><span class="line">	mkdir -p <span class="string">"<span class="variable">$PGDATA</span>"</span></span><br><span class="line">	chown -R postgres <span class="string">"<span class="variable">$PGDATA</span>"</span></span><br><span class="line">	chmod 700 <span class="string">"<span class="variable">$PGDATA</span>"</span></span><br><span class="line"></span><br><span class="line">	mkdir -p /var/run/postgresql</span><br><span class="line">	chown -R postgres /var/run/postgresql</span><br><span class="line">	chmod g+s /var/run/postgresql</span><br><span class="line"></span><br><span class="line">	<span class="comment"># Create the transaction log directory before initdb is run (below) so the directory is owned by the correct user</span></span><br><span class="line">	<span class="keyword">if</span> [ <span class="string">"<span class="variable">$POSTGRES_INITDB_XLOGDIR</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">		mkdir -p <span class="string">"<span class="variable">$POSTGRES_INITDB_XLOGDIR</span>"</span></span><br><span class="line">		chown -R postgres <span class="string">"<span class="variable">$POSTGRES_INITDB_XLOGDIR</span>"</span></span><br><span class="line">		chmod 700 <span class="string">"<span class="variable">$POSTGRES_INITDB_XLOGDIR</span>"</span></span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">	<span class="built_in">exec</span> gosu postgres <span class="string">"<span class="variable">$BASH_SOURCE</span>"</span> <span class="string">"<span class="variable">$@</span>"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">"<span class="variable">$1</span>"</span> = <span class="string">'postgres'</span> ]; <span class="keyword">then</span></span><br><span class="line">	mkdir -p <span class="string">"<span class="variable">$PGDATA</span>"</span></span><br><span class="line">	chown -R <span class="string">"<span class="variable">$(id -u)</span>"</span> <span class="string">"<span class="variable">$PGDATA</span>"</span> 2&gt;/dev/null || :</span><br><span class="line">	chmod 700 <span class="string">"<span class="variable">$PGDATA</span>"</span> 2&gt;/dev/null || :</span><br><span class="line"></span><br><span class="line">	<span class="comment"># look specifically for PG_VERSION, as it is expected in the DB dir</span></span><br><span class="line">	<span class="keyword">if</span> [ ! -s <span class="string">"<span class="variable">$PGDATA</span>/PG_VERSION"</span> ]; <span class="keyword">then</span></span><br><span class="line">		file_env <span class="string">'POSTGRES_INITDB_ARGS'</span></span><br><span class="line">		<span class="keyword">if</span> [ <span class="string">"<span class="variable">$POSTGRES_INITDB_XLOGDIR</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">			<span class="built_in">export</span> POSTGRES_INITDB_ARGS=<span class="string">"<span class="variable">$POSTGRES_INITDB_ARGS</span> --xlogdir <span class="variable">$POSTGRES_INITDB_XLOGDIR</span>"</span></span><br><span class="line">		<span class="keyword">fi</span></span><br><span class="line">		<span class="built_in">eval</span> <span class="string">"initdb --username=postgres <span class="variable">$POSTGRES_INITDB_ARGS</span>"</span></span><br><span class="line"></span><br><span class="line">		<span class="comment"># check password first so we can output the warning before postgres</span></span><br><span class="line">		<span class="comment"># messes it up</span></span><br><span class="line">		file_env <span class="string">'POSTGRES_PASSWORD'</span></span><br><span class="line">		<span class="keyword">if</span> [ <span class="string">"<span class="variable">$POSTGRES_PASSWORD</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">			pass=<span class="string">"PASSWORD '<span class="variable">$POSTGRES_PASSWORD</span>'"</span></span><br><span class="line">			authMethod=md5</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			<span class="comment"># The - option suppresses leading tabs but *not* spaces. :)</span></span><br><span class="line">			cat &gt;&amp;2 &lt;&lt;-<span class="string">'EOWARN'</span></span><br><span class="line">				****************************************************</span><br><span class="line">				WARNING: No password has been <span class="built_in">set</span> <span class="keyword">for</span> the database.</span><br><span class="line">				         This will allow anyone with access to the</span><br><span class="line">				         Postgres port to access your database. In</span><br><span class="line">				         Docker<span class="string">'s default configuration, this is</span></span><br><span class="line"><span class="string">				         effectively any other container on the same</span></span><br><span class="line"><span class="string">				         system.</span></span><br><span class="line"><span class="string">				         Use "-e POSTGRES_PASSWORD=password" to set</span></span><br><span class="line"><span class="string">				         it in "docker run".</span></span><br><span class="line"><span class="string">				****************************************************</span></span><br><span class="line"><span class="string">			EOWARN</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">			pass=</span></span><br><span class="line"><span class="string">			authMethod=trust</span></span><br><span class="line"><span class="string">		fi</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">		&#123;</span></span><br><span class="line"><span class="string">			echo</span></span><br><span class="line"><span class="string">			echo "host all all all $authMethod"</span></span><br><span class="line"><span class="string">		&#125; &gt;&gt; "$PGDATA/pg_hba.conf"</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">		# internal start of server in order to allow set-up using psql-client		</span></span><br><span class="line"><span class="string">		# does not listen on external TCP/IP and waits until start finishes</span></span><br><span class="line"><span class="string">		PGUSER="$&#123;PGUSER:-postgres&#125;" \</span></span><br><span class="line"><span class="string">		pg_ctl -D "$PGDATA" \</span></span><br><span class="line"><span class="string">			-o "-c listen_addresses='</span>localhost<span class="string">'" \</span></span><br><span class="line"><span class="string">			-w start</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">		file_env '</span>POSTGRES_USER<span class="string">' '</span>postgres<span class="string">'</span></span><br><span class="line"><span class="string">		file_env '</span>POSTGRES_DB<span class="string">' "$POSTGRES_USER"</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">		psql=( psql -v ON_ERROR_STOP=1 )</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">		if [ "$POSTGRES_DB" != '</span>postgres<span class="string">' ]; then</span></span><br><span class="line"><span class="string">			"$&#123;psql[@]&#125;" --username postgres &lt;&lt;-EOSQL</span></span><br><span class="line"><span class="string">				CREATE DATABASE "$POSTGRES_DB" ;</span></span><br><span class="line"><span class="string">			EOSQL</span></span><br><span class="line"><span class="string">			echo</span></span><br><span class="line"><span class="string">		fi</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">		if [ "$POSTGRES_USER" = '</span>postgres<span class="string">' ]; then</span></span><br><span class="line"><span class="string">			op='</span>ALTER<span class="string">'</span></span><br><span class="line"><span class="string">		else</span></span><br><span class="line"><span class="string">			op='</span>CREATE<span class="string">'</span></span><br><span class="line"><span class="string">		fi</span></span><br><span class="line"><span class="string">		"$&#123;psql[@]&#125;" --username postgres &lt;&lt;-EOSQL</span></span><br><span class="line"><span class="string">			$op USER "$POSTGRES_USER" WITH SUPERUSER $pass ;</span></span><br><span class="line"><span class="string">		EOSQL</span></span><br><span class="line"><span class="string">		echo</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">		psql+=( --username "$POSTGRES_USER" --dbname "$POSTGRES_DB" )</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">		echo</span></span><br><span class="line"><span class="string">		for f in /docker-entrypoint-initdb.d/*; do</span></span><br><span class="line"><span class="string">			case "$f" in</span></span><br><span class="line"><span class="string">				*.sh)     echo "$0: running $f"; . "$f" ;;</span></span><br><span class="line"><span class="string">				*.sql)    echo "$0: running $f"; "$&#123;psql[@]&#125;" -f "$f"; echo ;;</span></span><br><span class="line"><span class="string">				*.sql.gz) echo "$0: running $f"; gunzip -c "$f" | "$&#123;psql[@]&#125;"; echo ;;</span></span><br><span class="line"><span class="string">				*)        echo "$0: ignoring $f" ;;</span></span><br><span class="line"><span class="string">			esac</span></span><br><span class="line"><span class="string">			echo</span></span><br><span class="line"><span class="string">		done</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">		PGUSER="$&#123;PGUSER:-postgres&#125;" \</span></span><br><span class="line"><span class="string">		pg_ctl -D "$PGDATA" -m fast -w stop</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">		echo</span></span><br><span class="line"><span class="string">		echo '</span>PostgreSQL init process complete; ready <span class="keyword">for</span> start up.<span class="string">'</span></span><br><span class="line"><span class="string">		echo</span></span><br><span class="line"><span class="string">	fi</span></span><br><span class="line"><span class="string">fi</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">exec "$@"</span></span><br></pre></td></tr></table></figure>

<h2 id="CMD-å’Œ-ENTRYPOINTçš„åŒºåˆ«"><a href="#CMD-å’Œ-ENTRYPOINTçš„åŒºåˆ«" class="headerlink" title="CMD å’Œ ENTRYPOINTçš„åŒºåˆ«"></a>CMD å’Œ ENTRYPOINTçš„åŒºåˆ«</h2><ul>
<li>å½“ dockerfile ä¸­æŒ‡å®šäº† ENTRYPOINT çš„æ—¶å€™, docker run å¦‚æœåœ¨é•œåƒä¹‹åæ·»åŠ çš„æŒ‡ä»¤, é‚£ä¹ˆè¿™äº›æŒ‡ä»¤å°†è¢«å½“åš ENTRYPOINT çš„å‚æ•°æ‰§è¡Œ</li>
<li>å¦‚æœ dockerfile ä¸­åŒæ—¶æœ‰ CMD å’Œ ENTRYPOINT æŒ‡ä»¤, å½“ CMD æŒ‡ä»¤å¯æ‰§è¡Œæ—¶, å®ƒå°†åœ¨ ENTRYPOINT ä¹‹å‰è¿è¡Œ; å¦‚æœ CMD ä¸æ˜¯å¯æ‰§è¡Œçš„å‘½ä»¤, åˆ™å°†ä½œä¸º ENTRYPOINT çš„å‘½ä»¤å‚æ•°è¿½åŠ </li>
</ul>
<h1 id="EXPOSE-æœ€ä½³å®è·µ"><a href="#EXPOSE-æœ€ä½³å®è·µ" class="headerlink" title="EXPOSE æœ€ä½³å®è·µ"></a>EXPOSE æœ€ä½³å®è·µ</h1><ul>
<li><p>EXPOSE ç”¨æ¥å£°æ˜æœªæ¥å®¹å™¨å†…éœ€è¦ç›‘å¬çš„ç«¯å£, åœ¨ bridge æ¨¡å¼ä¸‹, è¿™äº›å®¹å™¨å†…éƒ¨çš„ç«¯å£ä¼šæ˜ å°„åˆ°å®¿ä¸»æœºçš„ç«¯å£ä¸Š, å»ºè®®åœ¨å®¹å™¨å†…éƒ¨ä¸è¦æ›´æ”¹åº”ç”¨åŸç”Ÿçš„ç«¯å£å·</p>
</li>
<li><p>EXPOSE ä¸­åªèƒ½æŒ‡å®šæœªæ¥å®¹å™¨å†…éƒ¨éœ€è¦æš´éœ²çš„ç«¯å£, ä¸èƒ½æŒ‡å®šæœªæ¥å®¹å™¨å¤–éƒ¨ä¸å†…éƒ¨ç«¯å£ä¹‹é—´çš„æ˜ å°„å…³ç³», æ¯”å¦‚è®¾ç½® <code>EXPOSE 8800:80</code> æ˜¯æ²¡æœ‰ä»»ä½•æ„ä¹‰çš„</p>
</li>
</ul>
<h1 id="ENV-æœ€ä½³å®è·µ"><a href="#ENV-æœ€ä½³å®è·µ" class="headerlink" title="ENV æœ€ä½³å®è·µ"></a>ENV æœ€ä½³å®è·µ</h1><ul>
<li>é€šè¿‡ç¯å¢ƒå˜é‡æ¥é…ç½®æœåŠ¡çš„ç›¸å…³è®¾ç½®, é€šè¿‡è¿™ç§æ–¹å¼å¯ä»¥æ–¹ä¾¿çš„åœ¨ä¸åŒç¯å¢ƒä¸­ä¿®æ”¹é…ç½®, å¿«é€Ÿå¯åŠ¨æœåŠ¡, åŠ å¿«å¼€å‘, æµ‹è¯•, éƒ¨ç½²çš„æµç¨‹</li>
<li>è®¾ç½®ç³»ç»Ÿç¯å¢ƒå˜é‡, æ¯”å¦‚äºŒè¿›åˆ¶åŒ…å®‰è£…çš„ nginx, åœ¨ ENV è®¾ç½® PATH</li>
<li>ä¹Ÿå¯ä»¥å€Ÿé‰´ LABEL çš„ä½¿ç”¨å“²å­¦, æ ‡è®°ä¸€äº›ç‰ˆæœ¬å·æˆ–ç‰ˆæœ¬ç¼–ç ä¿¡æ¯</li>
</ul>
<h1 id="ADD-ä¸-COPY-æœ€ä½³å®è·µ"><a href="#ADD-ä¸-COPY-æœ€ä½³å®è·µ" class="headerlink" title="ADD ä¸ COPY æœ€ä½³å®è·µ"></a>ADD ä¸ COPY æœ€ä½³å®è·µ</h1><p>ADD ä¸ COPY éƒ½æ˜¯å°†å¤–éƒ¨æ–‡ä»¶æ‹·è´åˆ°é•œåƒå†…éƒ¨çš„æŒ‡ä»¤, ç›¸æ¯”ä¹‹ä¸‹å¯èƒ½ ADD çš„åŠŸèƒ½æ›´åŠ å¼ºå¤§ä¸€ä¸‹, ä½†æ˜¯æˆ‘çš„å»ºè®®å¦‚ä¸‹:</p>
<ul>
<li>å°½é‡ä¸è¦æ‹·è´è¿œç¨‹æ–‡ä»¶, è¿™æ ·ä¹Ÿå°±ç”¨ä¸ç€ ADD çš„åŠŸèƒ½, ç”¨ COPY å°±å¯ä»¥äº†</li>
<li>å¦‚æœå‹ç¼©åŒ…æ‹·è´è¿›é•œåƒå, ä¸å¸Œæœ›è¿™ä¸ªå‹ç¼©åŒ…è¢«è‡ªåŠ¨è§£å‹ç¼©, ç”¨ COPY å°±å¯¹äº†. åä¹‹å¦‚æœå¸Œæœ›æ‹·è´è¿›é•œåƒä¹‹åå°±è‡ªåŠ¨è§£å‹åš, é‚£å°±ç”¨ ADD æ‹·è´è¿›å»</li>
</ul>
<p>å¦‚æœæ¶‰åŠåˆ°è¿œç¨‹æ–‡ä»¶, å»ºè®®ä½¿ç”¨ <code>RUN curl</code> æˆ– <code>RUN wget</code> å‘½ä»¤æ›¿ä»£ ADD</p>
<h1 id="VOLUME-æœ€ä½³å®è·µ"><a href="#VOLUME-æœ€ä½³å®è·µ" class="headerlink" title="VOLUME æœ€ä½³å®è·µ"></a>VOLUME æœ€ä½³å®è·µ</h1><p>VOLUME çš„ä½œç”¨æ˜¯æŒä¹…åŒ–å®¹å™¨å†…çš„æ–‡ä»¶, å£°æ˜æŸä¸ªç›®å½•éœ€è¦åœ¨å®¿ä¸»æœºæŒ‚è½½å, å½“ docker run èµ·é•œåƒæ—¶, docker ä¼šåœ¨å®¿ä¸»æœºé»˜è®¤ç›®å½•ä¸‹éšæœºç”Ÿæˆä¸€ä¸ªæ–‡ä»¶å¤¹æŒ‚è½½åˆ°å®¹å™¨å†…éƒ¨çš„æŒ‡å®šæ–‡ä»¶å¤¹.</p>
<p>å½“è¯¥å®¹å™¨è¢«åˆ é™¤æ—¶, å®¿ä¸»æœºä¸Šçš„è¿™ä¸ªæ–‡ä»¶å¤¹å¹¶ä¸ä¼šè¢«åˆ é™¤. å½“åˆ é™¤å®¹å™¨æ—¶åŠ å…¥äº†<code>-v</code> å‚æ•°, é‚£ä¹ˆå¯¹åº”çš„æ•°æ®å·å°±ä¼šè¢«åˆ é™¤</p>
<h1 id="USER-æœ€ä½³å®è·µ"><a href="#USER-æœ€ä½³å®è·µ" class="headerlink" title="USER æœ€ä½³å®è·µ"></a>USER æœ€ä½³å®è·µ</h1><p>å¦‚æœå®¹å™¨ä¸­çš„åº”ç”¨ç¨‹åºè¿è¡Œæ—¶ä¸éœ€è¦ç‰¹æ®Šçš„æƒé™, å¯ä»¥é€šè¿‡ USER æŒ‡ä»¤æŠŠåº”ç”¨ç¨‹åºçš„æ‰€æœ‰è€…è®¾ç½®ä¸ºé root ç”¨æˆ·. å¦‚æœè¯¥ç”¨æˆ·ä¸å­˜åœ¨, é¦–å…ˆéœ€è¦ä½¿ç”¨ RUN å‘½ä»¤åœ¨é•œåƒä¸­åˆ›å»ºç”¨æˆ·.</p>
<ul>
<li>å¦‚æœåœ¨æ¯æ¬¡ç¼–è¯‘é•œåƒæ—¶, å¯¹ç”¨æˆ·çš„ UID/GID æœ‰è¦æ±‚éœ€è¦ä¿æŒä¸€è‡´, åº”è¯¥åœ¨æ–°å»ºç”¨æˆ·å’Œç»„çš„æ—¶å€™æŒ‡å®š UIDå’Œ GID</li>
<li>åœ¨é•œåƒä¸­é¿å…ä½¿ç”¨sudo å‘½ä»¤. åº”ä¸ºè¯¥å‘½ä»¤ä½¿ç”¨çš„ TTY ä¸ç¡®å®š, å¯¹æ¥æ”¶ä¿¡å·é‡ä¹Ÿä¼šé€ æˆå½±å“. å¦‚æœç¡®å®éœ€è¦ä½¿ç”¨ sudo åŠŸèƒ½, åˆ™å¯æ˜¯ä½¿ç”¨ gosu å‘½ä»¤æ›¿ä»£</li>
<li>å¯ä»¥ç”¨ root ç”¨æˆ·åˆå§‹åŒ–ä¸€ä¸ª daemon, ç„¶åç”¨é root ç”¨æˆ·å¯åŠ¨è¿™ä¸ª daemon</li>
<li>ä¸ºäº†å‡å°‘é•œåƒä½“ç§¯, åº”è¯¥é¿å…ä¸å¿…è¦çš„ç”¨æˆ·åˆ‡æ¢</li>
</ul>
<h1 id="WORKDIR-æœ€ä½³å®è·µ"><a href="#WORKDIR-æœ€ä½³å®è·µ" class="headerlink" title="WORKDIR æœ€ä½³å®è·µ"></a>WORKDIR æœ€ä½³å®è·µ</h1><ul>
<li>å°½é‡ä½¿ç”¨ç»å¯¹è·¯å¾„</li>
<li>åˆ‡æ¢ç›®å½•çš„æ—¶å€™å°½é‡ä½¿ç”¨ WORKDIR, è€Œä¸æ˜¯ä½¿ç”¨ <code>RUN cd /dir</code></li>
</ul>
<h1 id="gosu-å·¥å…·"><a href="#gosu-å·¥å…·" class="headerlink" title="gosu å·¥å…·"></a>gosu å·¥å…·</h1><p>gosu æ˜¯ä¸€ä¸ª golang è¯­è¨€å¼€å‘çš„å·¥å…·, ç”¨æ¥å–ä»£ shell ä¸­çš„ sudo å‘½ä»¤. su å’Œ sudo å‘½ä»¤æœ‰ä¸€äº›ç¼ºé™·, ä¸»è¦æ˜¯ä¼šå¼•èµ·ä¸ç¡®å®šçš„ TTY, å¯¹ä¿¡å·é‡çš„è½¬å‘ä¹Ÿå­˜åœ¨é—®é¢˜. å¦‚æœä»…ä»…ä¸ºäº†ä½¿ç”¨ç‰¹å®šçš„ç”¨æˆ·è¿è¡Œç¨‹åº, ä½¿ç”¨ su æˆ– sudo æ˜¾å¾—å¤ªé‡äº†, ä¸ºæ­¤ gosu åº”è¿è€Œç”Ÿ.</p>
<p>gosu ç›´æ¥å€Ÿç”¨äº† libcontainer åœ¨å®¹å™¨ä¸­å¯åŠ¨åº”ç”¨ç¨‹åºçš„åŸç†, ä½¿ç”¨ <code>/etc/passwd</code> å¤„ç†åº”ç”¨ç¨‹åº. gosu é¦–å…ˆæ‰¾å‡ºæŒ‡å®šçš„ç”¨æˆ·æˆ–ç”¨æˆ·ç»„, ç„¶ååˆ‡æ¢åˆ°è¯¥ç”¨æˆ·æˆ–ç”¨æˆ·ç»„. æ¥ä¸‹æ¥, ä½¿ç”¨ exec å¯åŠ¨åº”ç”¨ç¨‹åº. åˆ°æ­¤ä¸ºæ­¢, gosu å®Œæˆäº†å®ƒçš„å·¥ä½œ, ä¸ä¼šå‚ä¸åˆ°åº”ç”¨ç¨‹åºåé¢çš„å£°æ˜å‘¨æœŸä¸­. ä½¿ç”¨è¿™ç§æ–¹å¼é¿å…äº† gosu å¤„ç† TTY å’Œè½¬å‘ä¿¡å·é‡çš„é—®é¢˜, æŠŠè¿™ä¸¤ä¸ªå·¥ä½œç›´æ¥äº¤ç»™äº†åº”ç”¨ç¨‹åºå»å®Œæˆ</p>
]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>dockerfile</tag>
      </tags>
  </entry>
  <entry>
    <title>dockerfileè¯¦è§£</title>
    <url>/2017/04/21/dockerfile%E8%AF%A6%E8%A7%A3/</url>
    <content><![CDATA[<blockquote>
<p>Dockerfileæ˜¯ç”±ä¸€ç³»åˆ—å‘½ä»¤å’Œå‚æ•°æ„æˆçš„è„šæœ¬ï¼Œä¸€ä¸ªDockerfileé‡Œé¢åŒ…å«äº†æ„å»ºæ•´ä¸ªimageçš„å®Œæ•´å‘½ä»¤ã€‚Dockeré€šè¿‡docker buildæ‰§è¡ŒDockerfileä¸­çš„ä¸€ç³»åˆ—å‘½ä»¤è‡ªåŠ¨æ„å»ºimage</p>
</blockquote>
<h1 id="ç”¨æ³•"><a href="#ç”¨æ³•" class="headerlink" title="ç”¨æ³•"></a>ç”¨æ³•</h1><p><code>dockerfile</code> ä½¿ç”¨ <code>docker build</code> å‘½ä»¤æ¥ç”Ÿæˆ <code>image</code> é•œåƒ, <code>docker build</code>çš„è¯­æ³•å¦‚ä¸‹:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Usage:	docker build [OPTIONS] PATH | URL | -</span><br></pre></td></tr></table></figure>

<ul>
<li>PATH æ˜¯æœ¬åœ°æ–‡ä»¶è·¯å¾„</li>
<li>URL æ˜¯ git repository çš„è·¯å¾„</li>
</ul>
<p>æ„å»ºé•œåƒæ—¶, docker å°†ä¼šé€’å½’åœ°è¯»å–è·¯å¾„ä¸‹çš„æ‰€æœ‰æ–‡ä»¶. å› æ­¤, PATHåŒ…æ‹¬ä»»ä½•å­ç›®å½•ï¼ŒURLåŒ…æ‹¬repositoryåŠsubmodules</p>
<p><strong>å®˜æ–¹æ¨è: åœ¨æ„å»ºé•œåƒçš„æ—¶å€™, æœ€å¥½ä½¿ç”¨å¹²å‡€çš„ç›®å½•è¿›è¡Œæ„å»º, å‡å°‘ä¸å¿…è¦çš„ç´¢å¼•æ€§èƒ½æŸè€—, æé«˜æ„å»ºæ•ˆç‡</strong></p>
<p>å¦‚æœåœ¨ç‰¹æ®Šç¯å¢ƒçš„é™åˆ¶ä¸‹, ä¸€å®šè¦åœ¨æœ‰ä¼—å¤šå¹²æ‰°æ–‡ä»¶çš„ç›®å½•ä¸‹æ„å»ºé•œåƒ, å¯ä»¥ä½¿ç”¨ <code>.dockerignore</code> æ–‡ä»¶æ¥å±è”½ç´¢å¼•è¿™äº›æ–‡ä»¶</p>
<p>ä½ å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼è¿›è¡Œæ„å»º</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æœ€ç®€å•çš„æ‰§è¡Œæ–¹å¼</span></span><br><span class="line">$ docker build .</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœæ–‡ä»¶åä¸æ˜¯dockerfile, é‚£ä¹ˆéœ€è¦æ˜¾ç¤ºçš„ç²¾ç¡®æŒ‡å®šæ–‡ä»¶</span></span><br><span class="line">$ docker build -f /path/to/a/Dockerfile .</span><br><span class="line"></span><br><span class="line"><span class="comment"># é¡ºä¾¿æ‰“ä¸ªæ ‡ç­¾ğŸ·</span></span><br><span class="line">$ docker build -t shykes/myapp .</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰“å¤šä¸ªæ ‡ç­¾</span></span><br><span class="line">$ docker build -t shykes/myapp:1.0.2 -t shykes/myapp:latest .</span><br></pre></td></tr></table></figure>

<p>åªè¦æœ‰å¯èƒ½ï¼ŒDockerå°†é‡æ–°ä½¿ç”¨ä¸­é—´imagesï¼ˆç¼“å­˜ï¼‰ï¼Œä»¥æ˜¾ç€åŠ é€Ÿdocker buildè¿‡ç¨‹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ docker build -t svendowideit/ambassador .</span><br><span class="line">Sending build context to Docker daemon 15.36 kB</span><br><span class="line">Step 1 : FROM alpine:3.2</span><br><span class="line"> ---&gt; 31f630c65071</span><br><span class="line">Step 2 : MAINTAINER SvenDowideit@home.org.au</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; 2a1c91448f5f</span><br><span class="line">Step 3 : RUN apk update &amp;&amp;      apk add socat &amp;&amp;        rm -r /var/cache/</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; 21ed6e7fbb73</span><br><span class="line">Step 4 : CMD env | grep _TCP= | (sed <span class="string">'s/.*_PORT_\([0-9]*\)_TCP=tcp:\/\/\(.*\):\(.*\)/socat -t 100000000 TCP4-LISTEN:\1,fork,reuseaddr TCP4:\2:\3 \&amp;/'</span> &amp;&amp; <span class="built_in">echo</span> <span class="built_in">wait</span>) | sh</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; 7ea8aef582cc</span><br><span class="line">Successfully built 7ea8aef582cc</span><br></pre></td></tr></table></figure>

<p>æ„å»ºæˆåŠŸåï¼Œå°±å¯ä»¥å‡†å¤‡Pushing a repository to its registry</p>
<h1 id="Format-è¯­æ³•æ ¼å¼"><a href="#Format-è¯­æ³•æ ¼å¼" class="headerlink" title="Format è¯­æ³•æ ¼å¼"></a>Format è¯­æ³•æ ¼å¼</h1><p>Dockerfileçš„æ ¼å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># Comment</span><br><span class="line">INSTRUCTION arguments</span><br></pre></td></tr></table></figure>

<ul>
<li>Line1 ç¬¬ä¸€è¡Œæ˜¯è§£æå™¨æŒ‡ä»¤</li>
<li>INSTRUCTION æ˜¯ä¸åŒºåˆ†å¤§å°å†™çš„ï¼Œä¸è¿‡å»ºè®®å¤§å†™. è¿™é‡Œå†™ dockerfile ä¸­æ”¯æŒçš„æŒ‡ä»¤é›†</li>
<li>arguments è¿™é‡Œå†™å¯¹åº”çš„å‘½ä»¤</li>
<li>dockerfile ä¸­çš„ç¬¬ä¸€ä¸ªæŒ‡ä»¤å¿…é¡»æ˜¯<code>FORM</code> æŒ‡å®šæ„å»ºé•œåƒçš„Base Image, è¿™ä¸ª Base Image åŸºç¡€é•œåƒå¯ä»¥æ˜¯ä¸€ä¸ªç³»ç»Ÿçš„é•œåƒæ¯”å¦‚<code>CentOS</code> <code>Ubuntu</code>ç­‰, ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªåº”ç”¨é•œåƒ, ç”¨æ¥åšäºŒæ¬¡å®šåˆ¶, æ¯”å¦‚ <code>nginx</code> <code>httpd</code> <code>mysql</code> ç­‰</li>
<li>dockerfileä¸­ä»¥<code>#</code>å¼€å¤´çš„è¡Œéƒ½å°†è§†ä¸ºæ³¨é‡Šï¼Œé™¤éæ˜¯ Parser directives è§£æå™¨æŒ‡ä»¤, è€Œä¸” dockerfile ä¸­ä¸æ”¯æŒè¿ç»­æ³¨é‡Š</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># Comment</span><br><span class="line">RUN echo &#39;we are running some # of cool things&#39;</span><br></pre></td></tr></table></figure>

<h1 id="ParserDirectives-è§£æå™¨æŒ‡ä»¤"><a href="#ParserDirectives-è§£æå™¨æŒ‡ä»¤" class="headerlink" title="ParserDirectives è§£æå™¨æŒ‡ä»¤"></a>ParserDirectives è§£æå™¨æŒ‡ä»¤</h1><p>è§£æå™¨æŒ‡ä»¤æ˜¯å¯é€‰çš„,  å¹¶ä¸”å½±å“å¤„ç† dockerfile ä¸­åç»­çš„æ‰§è¡Œæ–¹å¼. è§£æå™¨çš„æŒ‡ä»¤ä¸ä¼šå‘æ„å»ºä¸­æ·»åŠ å›¾å±‚, å¹¶ä¸”ä¸ä¼šæ˜¾ç¤ºåœ¨æ„å»ºçš„æ­¥éª¤å½“ä¸­. è§£æå™¨çš„æŒ‡ä»¤æ˜¯ä»¥ <code># directive = value</code> çš„å½¢å¼å†™æˆä¸€ç§ç‰¹æ®Šç±»å‹çš„æ³¨é‡Š, ä¸”å•ä¸ªæŒ‡ä»¤åªèƒ½ä½¿ç”¨ä¸€æ¬¡.(åˆ°ç›®å‰ä¸ºæ­¢ 2017/04/19 dockerfile åªæ”¯æŒä¸€ç§è§£æå™¨æŒ‡ä»¤)<br>å½“ docker é‡åˆ°æ™®é€šæ³¨é‡Šè¡Œæˆ–ç©ºè¡Œæˆ–æ˜¯å·²ç»è¢«æ‰§è¡Œè¿‡çš„è§£æå™¨æŒ‡ä»¤, docker éƒ½ä¸ä¼šå†å¯»æ‰¾ä»»ä½•è§£æå™¨çš„æŒ‡ä»¤. å› æ­¤, æ‰€æœ‰çš„è§£æå™¨æŒ‡ä»¤éƒ½å¿…é¡»ä½äº dockerfile çš„æœ€é¡¶ç«¯</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># escape&#x3D;&#96;</span><br><span class="line"></span><br><span class="line">FROM windowsservercore</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>ç›®å‰è§£æå™¨æŒ‡ä»¤åªæ”¯æŒ:</p>
<ul>
<li>escape</li>
</ul>
<h1 id="escape"><a href="#escape" class="headerlink" title="escape"></a>escape</h1><p>escape ä½œä¸º dockerfile è§£æå™¨ç›®å‰ä¸ºæ­¢å”¯ä¸€æ”¯æŒçš„æŒ‡ä»¤, ç›®å‰æœ‰ä»¥ä¸‹ä¸¤ç§ç”¨æ³•:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># escape&#x3D;\ (backslash)</span><br><span class="line">æˆ–è€…</span><br><span class="line"># escape&#x3D;&#96; (backtick)</span><br></pre></td></tr></table></figure>

<p>escape çš„ä½œç”¨æ˜¯å£°æ˜ dockerfile ä¸­çš„è½¬ä¹‰ç¬¦, åœ¨ä¸æŒ‡å®šçš„é»˜è®¤æƒ…å†µä¸‹,  è½¬ä¹‰ç¬¦æ˜¯åæ–œæ  <code>\</code> ä½†æ˜¯å¦‚æœæ˜¯åœ¨ Windows ä¸­, åæ–œæ æ˜¯æ­£å¸¸çš„è·¯å¾„åˆ†éš”ç¬¦, ä¸å±äºè½¬ä¹‰çš„èŒƒç•´, è¿™ç§æƒ…å†µä¸‹å°±éœ€è¦ä½¿ç”¨ä¸¤ä¸ªåæ–œæ  <code>\\</code> æ¥è¡¨ç¤ºä¸€ä¸ªè·¯å¾„ä¸­çš„åæ–œæ  <code>\</code></p>
<p>è½¬ä¹‰å­—ç¬¦æ—¢ç”¨äºè½¬ä¹‰è¡Œä¸­çš„å­—ç¬¦ï¼Œä¹Ÿç”¨äºè½¬ä¹‰æ¢è¡Œç¬¦. è¿™å…è®¸DockerfileæŒ‡ä»¤è·¨è¶Šå¤šè¡Œ. <strong>æ³¨æ„ï¼Œä¸ç®¡escapeè§£æå™¨æŒ‡ä»¤æ˜¯å¦åŒ…æ‹¬åœ¨Dockerfileä¸­ï¼Œåœ¨RUNå‘½ä»¤ä¸­ä¸æ‰§è¡Œè½¬ä¹‰ï¼Œé™¤éåœ¨è¡Œçš„æœ«å°¾, ç”¨æ¥è½¬ä¹‰æ¢è¡Œç¬¦</strong></p>
<p>è¯·è€ƒè™‘ä»¥ä¸‹ç¤ºä¾‹ï¼Œè¿™å°†åœ¨Windowsä¸Šä»¥éæ˜¾è€Œæ˜“è§çš„æ–¹å¼å¤±è´¥ã€‚ç¬¬äºŒè¡Œæœ«å°¾çš„ç¬¬äºŒä¸ª\å°†è¢«è§£é‡Šä¸ºæ¢è¡Œç¬¦ï¼Œè€Œä¸æ˜¯ä»ç¬¬ä¸€ä¸ª\è½¬ä¹‰çš„ç›®æ ‡ã€‚ç±»ä¼¼åœ°ï¼Œå‡è®¾ç¬¬ä¸‰è¡Œç»“å°¾å¤„çš„\å®é™…ä¸Šä½œä¸ºä¸€æ¡æŒ‡ä»¤å¤„ç†ï¼Œå®ƒå°†è¢«è§†ä¸ºè¡Œç»§ç»­ã€‚è¿™ä¸ªdockerfileçš„ç»“æœæ˜¯ç¬¬äºŒè¡Œå’Œç¬¬ä¸‰è¡Œè¢«è®¤ä¸ºæ˜¯å•ä¸ªæŒ‡ä»¤ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">FROM windowsservercore</span><br><span class="line">COPY testfile.txt c:\\</span><br><span class="line">RUN dir c:\</span><br><span class="line"></span><br><span class="line"># ç»“æœ:</span><br><span class="line">PS C:\John&gt; docker build -t cmd .</span><br><span class="line">Sending build context to Docker daemon 3.072 kB</span><br><span class="line">Step 1 : FROM windowsservercore</span><br><span class="line"> ---&gt; dbfee88ee9fd</span><br><span class="line">Step 2 : COPY testfile.txt c:RUN dir c:</span><br><span class="line">GetFileAttributesEx c:RUN: The system cannot find the file specified.</span><br><span class="line">PS C:\John&gt;</span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°çš„ä¸€ä¸ªè§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨<code>/</code>ä½œä¸º<code>COPY</code>æŒ‡ä»¤å’Œ<code>dir</code>çš„ç›®æ ‡. è¿™ç§è¯­æ³•, æœ€å¥½çš„æƒ…å†µæ˜¯æ··ä¹±, å› ä¸ºå®ƒåœ¨<code>Windows</code>ä¸Šæ˜¯ä¸å¹³å¸¸çš„è·¯å¾„, æœ€åçš„æƒ…å†µä¸‹, é”™è¯¯å€¾å‘, å› ä¸ºå¹¶ä¸æ˜¯<code>Windows</code>ä¸Šçš„æ‰€æœ‰å‘½ä»¤æ”¯æŒ<code>/</code>ä½œä¸ºè·¯å¾„åˆ†éš”ç¬¦.</p>
<p>é€šè¿‡æ·»åŠ è½¬ä¹‰è§£æå™¨æŒ‡ä»¤ï¼Œä¸‹é¢çš„Dockerfileåœ¨Windowsä¸Šä½¿ç”¨æ–‡ä»¶è·¯å¾„çš„è‡ªç„¶å¹³å°è¯­ä¹‰æˆåŠŸï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># escape&#x3D;&#96;</span><br><span class="line"></span><br><span class="line">FROM windowsservercore</span><br><span class="line">COPY testfile.txt c:\</span><br><span class="line">RUN dir c:\</span><br><span class="line"></span><br><span class="line"># ç»“æœ</span><br><span class="line">PS C:\John&gt; docker build -t succeeds --no-cache&#x3D;true .</span><br><span class="line">Sending build context to Docker daemon 3.072 kB</span><br><span class="line">Step 1 : FROM windowsservercore</span><br><span class="line"> ---&gt; dbfee88ee9fd</span><br><span class="line">Step 2 : COPY testfile.txt c:\</span><br><span class="line"> ---&gt; 99ceb62e90df</span><br><span class="line">Removing intermediate container 62afbe726221</span><br><span class="line">Step 3 : RUN dir c:\</span><br><span class="line"> ---&gt; Running in a5ff53ad6323</span><br><span class="line"> Volume in drive C has no label.</span><br><span class="line"> Volume Serial Number is 1440-27FA</span><br><span class="line"></span><br><span class="line"> Directory of c:\</span><br><span class="line"></span><br><span class="line">03&#x2F;25&#x2F;2016  05:28 AM    &lt;DIR&gt;          inetpub</span><br><span class="line">03&#x2F;25&#x2F;2016  04:22 AM    &lt;DIR&gt;          PerfLogs</span><br><span class="line">04&#x2F;22&#x2F;2016  10:59 PM    &lt;DIR&gt;          Program Files</span><br><span class="line">03&#x2F;25&#x2F;2016  04:22 AM    &lt;DIR&gt;          Program Files (x86)</span><br><span class="line">04&#x2F;18&#x2F;2016  09:26 AM                 4 testfile.txt</span><br><span class="line">04&#x2F;22&#x2F;2016  10:59 PM    &lt;DIR&gt;          Users</span><br><span class="line">04&#x2F;22&#x2F;2016  10:59 PM    &lt;DIR&gt;          Windows</span><br><span class="line">               1 File(s)              4 bytes</span><br><span class="line">               6 Dir(s)  21,252,689,920 bytes free</span><br><span class="line"> ---&gt; 2569aa19abef</span><br><span class="line">Removing intermediate container a5ff53ad6323</span><br><span class="line">Successfully built 2569aa19abef</span><br><span class="line">PS C:\John&gt;</span><br></pre></td></tr></table></figure>

<h1 id="ENV-ç¯å¢ƒå˜é‡æ›¿æ¢"><a href="#ENV-ç¯å¢ƒå˜é‡æ›¿æ¢" class="headerlink" title="ENV ç¯å¢ƒå˜é‡æ›¿æ¢"></a>ENV ç¯å¢ƒå˜é‡æ›¿æ¢</h1><p>ç¯å¢ƒå˜é‡ä½¿ç”¨<code>ENV</code>å‘½ä»¤å£°æ˜, ä½¿ç”¨<code>$variable_name</code>æˆ–<code>${variable_name}</code>æ¥è°ƒç”¨, å¸¦å¤§æ‹¬å·çš„è¯­æ³•æ˜¯è¢«ç”¨æ¥è§£å†³ä¸å¸¦ç©ºæ ¼çš„å˜é‡åå­—é—®é¢˜, ä¾‹å¦‚:<code>${foo}_bar</code></p>
<p><code>${variable_name}</code>è¯­æ³•è¿˜æ”¯æŒä»¥ä¸‹æŒ‡å®šçš„ä¸€äº›æ ‡å‡†bashä¿®é¥°ç¬¦ï¼š</p>
<ul>
<li><code>${variable:-word}</code>è¡¨ç¤ºå¦‚æœè®¾ç½®äº†<code>variable</code>, åˆ™ç»“æœå°†æ˜¯è¯¥å€¼; å¦‚æœ<code>variable</code>æœªè®¾ç½®, é‚£ä¹ˆwordå°†æ˜¯ç»“æœ</li>
<li><code>${variable:+word}</code>è¡¨ç¤ºå¦‚æœè®¾ç½®äº†<code>variable</code>, é‚£ä¹ˆ<code>word</code>å°†æ˜¯ç»“æœ, å¦åˆ™ç»“æœæ˜¯ç©ºå­—ç¬¦ä¸²</li>
</ul>
<p>åœ¨æ‰€æœ‰æƒ…å†µä¸‹, <code>word</code>å¯ä»¥æ˜¯ä»»ä½•å­—ç¬¦ä¸², åŒ…æ‹¬é¢å¤–çš„ç¯å¢ƒå˜é‡</p>
<p>å¯ä»¥é€šè¿‡åœ¨å˜é‡ä¹‹å‰æ·»åŠ <code>\</code>æ¥è½¬ä¹‰: <code>\$foo</code>æˆ–<code>\${foo}</code>, åˆ†åˆ«è½¬æ¢ä¸º<code>$foo</code>å’Œ<code>${foo}</code></p>
<p>ç¤ºä¾‹ï¼ˆè§£æçš„è¡¨ç¤ºæ˜¾ç¤ºåœ¨#åé¢ï¼‰ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">FROM busybox</span><br><span class="line">ENV foo &#x2F;bar</span><br><span class="line">WORKDIR $&#123;foo&#125;   # WORKDIR &#x2F;bar</span><br><span class="line">ADD . $foo       # ADD . &#x2F;bar</span><br><span class="line">COPY \$foo &#x2F;quux # COPY $foo &#x2F;quux</span><br></pre></td></tr></table></figure>

<p>Dockerfileä¸­çš„ä»¥ä¸‹æŒ‡ä»¤åˆ—è¡¨æ”¯æŒç¯å¢ƒå˜é‡ï¼š</p>
<ul>
<li>ADD</li>
<li>COPY</li>
<li>ENV</li>
<li>EXPOSE</li>
<li>LABEL</li>
<li>USER</li>
<li>WORKDIR</li>
<li>VOLUME</li>
<li>STOPSIGNAL</li>
</ul>
<p>ä»¥åŠï¼š</p>
<ul>
<li>ONBUILDï¼ˆå½“ä¸ä¸Šé¢æ”¯æŒçš„æŒ‡ä»¤ä¹‹ä¸€ç»„åˆæ—¶ï¼‰</li>
</ul>
<p><strong>æ³¨æ„: åœ¨1.4ä¹‹å‰, ONBUILDæŒ‡ä»¤ä¸æ”¯æŒç¯å¢ƒå˜é‡, å³ä½¿ä¸ä¸Šé¢åˆ—å‡ºçš„ä»»ä½•æŒ‡ä»¤ç›¸ç»“åˆ</strong></p>
<p>åœ¨<code>ENV</code>çš„ä½¿ç”¨ä¸­, è¦ç‰¹åˆ«æ³¨æ„ä»¥ä¸‹æƒ…å†µ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ENV abc&#x3D;hello</span><br><span class="line">ENV abc&#x3D;bye def&#x3D;$abc</span><br><span class="line">ENV ghi&#x3D;$abc</span><br></pre></td></tr></table></figure>

<p>æœ€ç»ˆçš„ç»“æœä¸º:</p>
<ul>
<li>def çš„å€¼ä¸º hello</li>
<li>ghi çš„å€¼ä¸º bye</li>
</ul>
<p>ä¸ºä»€ä¹ˆ<code>def</code>çš„å€¼ä¸æ˜¯<code>bye</code>å‘¢? å› ä¸ºç¬¬ä¸€è¡Œè®¾ç½®<code>abc</code>å˜é‡çš„å€¼ä¸º<code>hello</code>å, åˆ°ç¬¬äºŒè¡Œæ‰§è¡Œçš„æ—¶å€™, é¦–å…ˆè¿›è¡Œå˜é‡çš„æ¸²æŸ“(æ›¿æ¢), ç„¶åå†æ‰§è¡Œç¯å¢ƒå˜é‡çš„è®¾ç½®</p>
<h1 id="dockerignore"><a href="#dockerignore" class="headerlink" title=".dockerignore"></a>.dockerignore</h1><p>dockeræ‰§è¡Œæ„å»ºå, ä¼šé¦–å…ˆå»æ ¹ç›®å½•ä¸­æŸ¥æ‰¾<code>.dockerignore</code>æ–‡ä»¶, ç”±äºåœ¨æ„å»ºçš„æ—¶å€™, docker ä¼šé€’å½’ç´¢å¼•å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶, ä¸ºäº†é¿å…ç´¢å¼•ä¸å¿…è¦çš„ç›®å½•, å¯ä»¥ä½¿ç”¨<code>.dockerignore</code>æ–‡ä»¶å£°æ˜ä¸éœ€è¦ç´¢å¼•çš„ç›®å½•</p>
<ul>
<li><code>#</code> æ³¨é‡Š</li>
<li><code>*</code> ä»»æ„å¤šä¸ªå­—ç¬¦</li>
<li><code>?</code> ä»»æ„ä¸€ä¸ªå­—ç¬¦</li>
<li><code>!</code> å¼‚å¸¸æ¨¡å¼, ç”¨äºæ’é™¤ä¾‹å¤–</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># comment</span><br><span class="line">    *&#x2F;temp*</span><br><span class="line">    *&#x2F;*&#x2F;temp*</span><br><span class="line">    temp?</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">*.md</span><br><span class="line">!README.md</span><br></pre></td></tr></table></figure>

<h1 id="FORM"><a href="#FORM" class="headerlink" title="FORM"></a>FORM</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">FROM &lt;image&gt;</span><br><span class="line"># æˆ–åˆ™</span><br><span class="line">FROM &lt;image&gt;:&lt;tag&gt;</span><br><span class="line"># æˆ–åˆ™</span><br><span class="line">FROM &lt;image&gt;@&lt;digest&gt;</span><br></pre></td></tr></table></figure>

<p><code>FROM</code>æŒ‡ä»¤ä¸ºåç»­æŒ‡ä»¤è®¾ç½®Base Image. å› æ­¤, æœ‰æ•ˆçš„Dockerfileå¿…é¡»å…·æœ‰<code>FROM</code>ä½œä¸ºå…¶ç¬¬ä¸€æ¡æŒ‡ä»¤. imageå¯ä»¥æ˜¯ä»»ä½•æœ‰æ•ˆçš„image, å¯ä»¥ä»é•œåƒä»“åº“ä¸­æ‹‰å–é•œåƒ.</p>
<ul>
<li>FROMå¿…é¡»æ˜¯Dockerfileä¸­çš„ç¬¬ä¸€ä¸ªéæ³¨é‡ŠæŒ‡ä»¤</li>
<li>FROMå¯ä»¥åœ¨å•ä¸ªDockerfileä¸­å¤šæ¬¡å‡ºç°ï¼Œä»¥åˆ›å»ºå¤šä¸ªé•œåƒã€‚æ¯ä¸ªæ–°çš„FROMå‘½ä»¤ä¹‹å‰ä¼šè¾“å‡ºæœ€ä¸€ä¸ªimage ID</li>
<li>tagæˆ–digestæ˜¯å¯é€‰çš„. å¦‚æœçœç•¥å…¶ä¸­ä»»ä½•ä¸€ä¸ª, æ„å»ºå™¨å°†é»˜è®¤ä½¿ç”¨latest. å¦‚æœæ„å»ºå™¨ä¸tagå€¼ä¸åŒ¹é…, åˆ™æ„å»ºå™¨å°†è¿”å›é”™è¯¯</li>
</ul>
<h1 id="RUN"><a href="#RUN" class="headerlink" title="RUN"></a>RUN</h1><p>RUN æŒ‡ä»¤æœ‰ä¸¤ç§è¿è¡Œæ–¹å¼:</p>
<ul>
<li>RUN <command> (shell form, the command is run in a shell, which by default is /bin/sh -c on Linux or cmd /S /C on Windows)</li>
<li>RUN [â€œexecutableâ€, â€œparam1â€, â€œparam2â€] (exec form)</li>
</ul>
<p><code>RUN</code>æŒ‡ä»¤å°†åœ¨å½“å‰imageä¹‹ä¸Šçš„æ–°å±‚ä¸­æ‰§è¡Œä»»ä½•å‘½ä»¤, å¹¶æäº¤ç»“æœ. ç”Ÿæˆçš„å·²æäº¤imageå°†ç”¨äºDockerfileä¸­çš„ä¸‹ä¸€æ­¥</p>
<p>execå½¢å¼ä½¿å¾—å¯ä»¥é¿å…shellå­—ç¬¦ä¸²å˜åŒ–, ä»¥åŠä½¿ç”¨ä¸åŒ…å«æŒ‡å®šçš„shellå¯æ‰§è¡Œæ–‡ä»¶çš„åŸºæœ¬imageæ¥è¿è¡ŒRUNå‘½ä»¤</p>
<p>åœ¨shellå½¢å¼ä¸­ï¼Œå¯ä»¥ä½¿ç”¨\ï¼ˆåæ–œæ ï¼‰å°†å•ä¸ªRUNæŒ‡ä»¤ç»§ç»­åˆ°ä¸‹ä¸€è¡Œ, è¿™ä¹Ÿæ˜¯å¤§éƒ¨åˆ† dockerfile ä½¿ç”¨çš„å½¢å¼</p>
<p>åœ¨<code>RUN</code>å‘½ä»¤çš„ä½¿ç”¨ä¸­, éœ€è¦æ³¨æ„ä¸€ä¸‹å‡ ç‚¹:</p>
<ul>
<li>è¦ä½¿ç”¨ä¸åŒçš„shellï¼Œè€Œä¸æ˜¯â€™/bin/shâ€™ï¼Œè¯·ä½¿ç”¨åœ¨æ‰€éœ€shellä¸­ä¼ é€’çš„execå½¢å¼ã€‚ä¾‹å¦‚ï¼ŒRUN [â€œ/bin/bashâ€,â€œ-câ€,â€œecho helloâ€]</li>
<li>execå½¢å¼ä½œä¸ºJSONæ•°ç»„è§£æï¼Œè¿™æ„å‘³ç€ä½ å¿…é¡»åœ¨å•è¯ä¹‹å¤–å¿…é¡»è¦ä½¿ç”¨åŒå¼•å·<code>&quot;</code> è€Œä¸æ˜¯å•å¼•å·<code>&#39;</code></li>
<li>ä¸ shell æ‰§è¡Œçš„æ–¹å¼ä¸åŒ, exec æ‰§è¡Œæ–¹å¼ä¸è°ƒç”¨å‘½ä»¤ shell. è¿™æ„å‘³ç€æ­£å¸¸çš„ shell å¤„ç†ä¸ä¼šå‘ç”Ÿ. ä¾‹å¦‚, <code>RUN [&quot;echo&quot;,&quot;$HOME&quot;]</code>ä¸ä¼šåœ¨<code>$HOME</code>ä¸Šè¿›è¡Œå¯å˜æ›¿æ¢. å¦‚æœä½ æƒ³è¦shellå¤„ç†ï¼Œé‚£ä¹ˆä½¿ç”¨shellå½¢å¼æˆ–ç›´æ¥æ‰§è¡Œä¸€ä¸ªshellï¼Œä¾‹å¦‚, <code>RUN [&quot;sh&quot;,&quot;-c&quot;,&quot;echo $HOME&quot;]</code> </li>
<li>åœ¨JSONå½¢å¼ä¸­, æœ‰å¿…è¦è½¬ä¹‰åæ–œæ . è¿™åœ¨Windowsä¸Šç‰¹åˆ«ç›¸å…³, å…¶ä¸­åæ–œæ æ˜¯è·¯å¾„åˆ†éš”ç¬¦. å› ä¸ºä¸æ˜¯æœ‰æ•ˆçš„JSON, å¹¶ä¸”ä»¥æ„å¤–çš„æ–¹å¼å¤±è´¥, ä»¥ä¸‹è¡Œå°†è¢«è§†ä¸ºshellå½¢å¼: <code>RUN [&quot;c:\windows\system32\tasklist.exe&quot;]</code> æ­¤ç¤ºä¾‹çš„æ­£ç¡®è¯­æ³•ä¸º: <code>RUN [&quot;c:\\windows\\system32\\tasklist.exe&quot;]</code></li>
</ul>
<p>ç”¨äº<code>RUN</code>æŒ‡ä»¤çš„é«˜é€Ÿç¼“å­˜åœ¨ä¸‹ä¸€æ¬¡æ„å»ºæœŸé—´ä¸ä¼šè‡ªåŠ¨å¤±æ•ˆ. ç”¨äºè¯¸å¦‚<code>RUN apt-get dist-upgrade</code>ä¹‹ç±»çš„æŒ‡ä»¤çš„é«˜é€Ÿç¼“å­˜å°†åœ¨ä¸‹ä¸€æ¬¡æ„å»ºæœŸé—´è¢«é‡ç”¨. å¯ä»¥é€šè¿‡ä½¿ç”¨<code>--no-cache</code>æ ‡å¿—æ¥ä½¿ç”¨äº<code>RUN</code>æŒ‡ä»¤çš„é«˜é€Ÿç¼“å­˜æ— æ•ˆ, ä¾‹å¦‚ <code>docker build --no-cache</code></p>
<p><strong>Known issuesï¼ˆRUN</strong></p>
<p>Issue 783æ˜¯å…³äºåœ¨ä½¿ç”¨AUFSæ–‡ä»¶ç³»ç»Ÿæ—¶å¯èƒ½å‘ç”Ÿçš„æ–‡ä»¶æƒé™é—®é¢˜ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯èƒ½ä¼šåœ¨å°è¯•rmæ–‡ä»¶æ—¶æ³¨æ„åˆ°å®ƒã€‚å¯¹äºå…·æœ‰æœ€è¿‘aufsç‰ˆæœ¬çš„ç³»ç»Ÿï¼ˆå³ï¼Œå¯ä»¥è®¾ç½®dirperm1å®‰è£…é€‰é¡¹ï¼‰ï¼Œdockerå°†å°è¯•é€šè¿‡ä½¿ç”¨dirperm1é€‰é¡¹å®‰è£…imageæ¥è‡ªåŠ¨è§£å†³é—®é¢˜ã€‚</p>
<h1 id="MAINTAINER-ä½œè€…ä¿¡æ¯-å·²åºŸå¼ƒ"><a href="#MAINTAINER-ä½œè€…ä¿¡æ¯-å·²åºŸå¼ƒ" class="headerlink" title="MAINTAINER ä½œè€…ä¿¡æ¯(å·²åºŸå¼ƒ)"></a>MAINTAINER ä½œè€…ä¿¡æ¯(å·²åºŸå¼ƒ)</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">MAINTAINER &lt;name&gt;</span><br></pre></td></tr></table></figure>

<p>MAINTAINERæŒ‡ä»¤å…è®¸æ‚¨è®¾ç½®ç”Ÿæˆçš„imagesçš„ä½œè€…å­—æ®µ</p>
<p>åœ¨æ–°çš„ docker ç‰ˆæœ¬ä¸­, è¯¥æŒ‡ä»¤å°†è¢«<code>LABEL</code>æ›¿ä»£</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">LABEL maintainer &quot;SvenDowideit@home.org.au&quot;</span><br></pre></td></tr></table></figure>

<h1 id="CMD"><a href="#CMD" class="headerlink" title="CMD"></a>CMD</h1><p>CMDæŒ‡ä»¤ä¸‰ç§å½¢å¼ï¼š</p>
<ul>
<li>CMD [â€œexecutableâ€,â€param1â€,â€param2â€] (execæ ¼å¼, é¦–é€‰å½¢å¼)</li>
<li>CMD [â€œparam1â€,â€param2â€] (ä½œä¸º ENTRYPOINT æŒ‡ä»¤çš„é»˜è®¤å‚æ•°)</li>
<li>CMD command param1 param2 (shell æ ¼å¼)</li>
</ul>
<p>åœ¨Dockerfileä¸­åªèƒ½æœ‰ä¸€ä¸ª<code>CMD</code>æŒ‡ä»¤. å¦‚æœåˆ—å‡ºäº†å¤šä¸ª<code>CMD</code>, åˆ™åªæœ‰æœ€åä¸€ä¸ª<code>CMD</code>ç”Ÿæ•ˆ</p>
<p><code>CMD</code>çš„ä¸»è¦ç›®çš„æ˜¯ä¸ºæ‰§è¡Œå®¹å™¨æä¾›é»˜è®¤å€¼. è¿™äº›é»˜è®¤å€¼å¯ä»¥åŒ…æ‹¬å¯æ‰§è¡Œæ–‡ä»¶, æˆ–è€…å®ƒä»¬å¯ä»¥çœç•¥å¯æ‰§è¡Œæ–‡ä»¶, åœ¨è¿™ç§æƒ…å†µä¸‹, ä½ è¿˜å¿…é¡»æŒ‡å®š<code>ENTRYPOINT</code>æŒ‡ä»¤</p>
<p>å½“ä»¥shellæˆ–execæ ¼å¼ä½¿ç”¨æ—¶ï¼Œ<code>CMD</code>æŒ‡ä»¤è®¾ç½®è¿è¡Œimageæ—¶è¦æ‰§è¡Œçš„å‘½ä»¤</p>
<p>å¦‚æœä½¿ç”¨CMDçš„shellå½¢å¼ï¼Œé‚£ä¹ˆ<command>å°†åœ¨/bin/sh -cä¸­æ‰§è¡Œï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">FROM ubuntu</span><br><span class="line">CMD echo &quot;This is a test.&quot; | wc -</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½ æƒ³è¿è¡Œä½ çš„<command>æ²¡æœ‰shellï¼Œé‚£ä¹ˆä½ å¿…é¡»å°†è¯¥å‘½ä»¤è¡¨ç¤ºä¸ºä¸€ä¸ªJSONæ•°ç»„ï¼Œå¹¶ç»™å‡ºå¯æ‰§è¡Œæ–‡ä»¶çš„å®Œæ•´è·¯å¾„ã€‚æ­¤æ•°ç»„å½¢å¼æ˜¯CMDçš„é¦–é€‰æ ¼å¼ã€‚ä»»ä½•å…¶ä»–å‚æ•°å¿…é¡»å•ç‹¬è¡¨ç¤ºä¸ºæ•°ç»„ä¸­çš„å­—ç¬¦ä¸²(æ³¨æ„ä½¿ç”¨åŒå¼•å·)ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">FROM ubuntu</span><br><span class="line">CMD [&quot;&#x2F;usr&#x2F;bin&#x2F;wc&quot;,&quot;--help&quot;]</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½ å¸Œæœ›ä½ çš„å®¹å™¨æ¯æ¬¡è¿è¡Œç›¸åŒçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œé‚£ä¹ˆä½ åº”è¯¥è€ƒè™‘ä½¿ç”¨ENTRYPOINTç»“åˆCMD</p>
<p>å¦‚æœç”¨æˆ·æŒ‡å®šdocker runå‚æ•°ï¼Œé‚£ä¹ˆå®ƒä»¬å°†è¦†ç›–CMDä¸­æŒ‡å®šçš„é»˜è®¤å€¼</p>
<p><strong>æ³¨æ„:</strong></p>
<ul>
<li>ä¸è¦å°†RUNå’ŒCMDæ··æ·†. RUNå®é™…ä¸Šè¿è¡Œä¸€ä¸ªå‘½ä»¤å¹¶æäº¤ç»“æœ;CMDåœ¨æ„å»ºæ—¶ä¸æ‰§è¡Œä»»ä½•æ“ä½œ, ä½†æŒ‡å®šäº†imageçš„é¢„æœŸå‘½ä»¤</li>
<li>å¦‚æœä½¿ç”¨CMDä¸ºENTRYPOINTæŒ‡ä»¤æä¾›é»˜è®¤å‚æ•°, CMDå’ŒENTRYPOINTæŒ‡ä»¤éƒ½åº”ä»¥JSONæ•°ç»„æ ¼å¼æŒ‡å®š</li>
<li>execå½¢å¼ä½œä¸ºJSONæ•°ç»„è§£æ, è¿™æ„å‘³ç€æ‚¨å¿…é¡»åœ¨å•è¯ä¹‹å¤–ä½¿ç”¨åŒå¼•å·<code>&quot;</code>è€Œä¸æ˜¯å•å¼•å·<code>&#39;</code></li>
<li>ä¸shellè¡¨å•ä¸åŒ, execè¡¨å•ä¸è°ƒç”¨å‘½ä»¤shell. è¿™æ„å‘³ç€æ­£å¸¸çš„shellå¤„ç†ä¸ä¼šå‘ç”Ÿ. ä¾‹å¦‚, <code>CMD [&quot;echo&quot;ï¼Œ&quot;$HOME&quot;]</code> ä¸ä¼šåœ¨<code>$HOME</code>ä¸Šè¿›è¡Œå¯å˜æ›¿æ¢. å¦‚æœä½ æƒ³è¦shellå¤„ç†, é‚£ä¹ˆä½¿ç”¨shellå½¢å¼æˆ–ç›´æ¥æ‰§è¡Œä¸€ä¸ªshell, ä¾‹å¦‚: <code>CMD [&quot;sh&quot;,&quot;-c&quot;,&quot;echo $HOME&quot;]</code></li>
</ul>
<h1 id="LABEL"><a href="#LABEL" class="headerlink" title="LABEL"></a>LABEL</h1><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">LABEL</span><span class="bash"> &lt;key&gt;=&lt;value&gt; &lt;key&gt;=&lt;value&gt; &lt;key&gt;=&lt;value&gt; ...</span></span><br><span class="line">æˆ–</span><br><span class="line"><span class="keyword">LABEL</span><span class="bash"> &lt;key&gt;=&lt;value&gt;</span></span><br><span class="line"><span class="keyword">LABEL</span><span class="bash"> &lt;key&gt;=&lt;value&gt;</span></span><br><span class="line"><span class="keyword">LABEL</span><span class="bash"> &lt;key&gt;=&lt;value&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>LABEL</code> æŒ‡ä»¤å‘imageæ·»åŠ å…ƒæ•°æ®. LABELæ˜¯é”®å€¼å¯¹. è¦åœ¨LABELå€¼ä¸­åŒ…å«ç©ºæ ¼, éœ€è¦ä½¿ç”¨å¼•å·å’Œåæ–œæ , å°±åƒåœ¨å‘½ä»¤è¡Œè§£æä¸­ä¸€æ ·</p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">LABEL</span><span class="bash"> <span class="string">"com.example.vendor"</span>=<span class="string">"ACME Incorporated"</span></span></span><br><span class="line"><span class="keyword">LABEL</span><span class="bash"> com.example.label-with-value=<span class="string">"foo"</span></span></span><br><span class="line"><span class="keyword">LABEL</span><span class="bash"> version=<span class="string">"1.0"</span></span></span><br><span class="line"><span class="keyword">LABEL</span><span class="bash"> description=<span class="string">"This text illustrates \</span></span></span><br><span class="line"><span class="bash">that label-values can span multiple lines.<span class="string">"</span></span></span><br></pre></td></tr></table></figure>

<p>ä¸€ä¸ª<code>image</code>å¯ä»¥æœ‰å¤šä¸ª<code>label</code>. è¦æŒ‡å®šå¤šä¸ª<code>label</code>, Dockerå»ºè®®åœ¨å¯èƒ½çš„æƒ…å†µä¸‹å°†æ ‡ç­¾åˆå¹¶åˆ°å•ä¸ª<code>LABEL</code>æŒ‡ä»¤ä¸­. æ¯ä¸ª<code>LABEL</code>æŒ‡ä»¤äº§ç”Ÿä¸€ä¸ªæ–°å±‚, å¦‚æœä½¿ç”¨è®¸å¤šæ ‡ç­¾, å¯èƒ½ä¼šå¯¼è‡´é•œåƒçš„æ•ˆç‡ä½ä¸‹. è¯¥ç¤ºä¾‹äº§ç”Ÿå•ä¸ªé•œåƒå±‚</p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">LABEL</span><span class="bash"> multi.label1=<span class="string">"value1"</span> multi.label2=<span class="string">"value2"</span> other=<span class="string">"value3"</span></span></span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„ä¹Ÿå¯å†™ä¸ºï¼š</p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">LABEL</span><span class="bash"> multi.label1=<span class="string">"value1"</span> \</span></span><br><span class="line"><span class="bash">      multi.label2=<span class="string">"value2"</span> \</span></span><br><span class="line"><span class="bash">      other=<span class="string">"value3"</span></span></span><br></pre></td></tr></table></figure>

<p><strong>å¦‚æœDockeré‡åˆ°å·²ç»å­˜åœ¨çš„label/keyï¼Œåˆ™æ–°å€¼å°†è¦†ç›–å…·æœ‰ç›¸åŒé”®çš„ä»»ä½•å…ˆå‰æ ‡ç­¾</strong></p>
<h1 id="EXPOSE"><a href="#EXPOSE" class="headerlink" title="EXPOSE"></a>EXPOSE</h1><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">EXPOSE</span> &lt;port&gt; [&lt;port&gt;...]</span><br></pre></td></tr></table></figure>

<p><code>EXPOSE</code>æŒ‡ä»¤é€šçŸ¥Dockerå®¹å™¨åœ¨è¿è¡Œæ—¶ç›‘å¬æŒ‡å®šçš„ç½‘ç»œç«¯å£. <code>EXPOSE</code>ä¸ä½¿ä¸»æœºçš„å®¹å™¨çš„ç«¯å£å¯è®¿é—®, ä¸ºæ­¤, å¿…é¡»ä½¿ç”¨<code>-p</code>æ ‡å¿—å‘å¸ƒä¸€ç³»åˆ—ç«¯å£, æˆ–è€…ä½¿ç”¨<code>-P</code>æ ‡å¿—å‘å¸ƒæ‰€æœ‰æš´éœ²çš„ç«¯å£ã€‚å¯ä»¥å…¬å¼€ä¸€ä¸ªç«¯å£å·ï¼Œå¹¶ç”¨å¦ä¸€ä¸ªç«¯å£å·åœ¨å¤–éƒ¨å‘å¸ƒ</p>
<p>è¿™é‡ŒæŒ‡å®šçš„æ‰€æœ‰ç«¯å£éƒ½æ˜¯å®¹å™¨å†…éƒ¨å£°æ˜å®¹å™¨è¿è¡Œåè¦ç›‘å¬çš„ç«¯å£, ä¸èƒ½åœ¨è¿™é‡Œå®šä¹‰å®¿ä¸»æœºä¸å®¹å™¨ä¹‹é—´ç«¯å£çš„å¯¹åº”å…³ç³»! æ¯”å¦‚ä¸€ä¸ª nginx çš„é•œåƒ, å†…éƒ¨ç›‘å¬80ç«¯å£, åœ¨å®¹å™¨è¿è¡Œä¹‹å, ä½ æƒ³æ˜ å°„åˆ°8080ç«¯å£, æ­¤æ—¶åœ¨ dockerfile ä¸­å†™ 8080:80 æ˜¯æ²¡æœ‰ä»»ä½•æ„ä¹‰çš„, é•œåƒ(dockerfile)é‡Œçš„å£°æ˜çš„ç«¯å£ä¸å®¹å™¨è¿è¡ŒæŒ‡å®šçš„ç«¯å£æ˜¯åˆ†å¼€çš„, ä¸èƒ½åœ¨ dockerfile ä¸­æŒ‡å®šæœªæ¥å®¹å™¨è¿è¡Œæ—¶æ˜ å°„çš„ç«¯å£</p>
<h1 id="ENV"><a href="#ENV" class="headerlink" title="ENV"></a>ENV</h1><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ENV</span> &lt;key&gt; &lt;value&gt;</span><br><span class="line"><span class="keyword">ENV</span> &lt;key&gt;=&lt;value&gt; ... (é¦–é€‰å½¢å¼)</span><br></pre></td></tr></table></figure>

<ul>
<li>ç¬¬ä¸€ç§å½¢å¼åªèƒ½è®¾ç½®ä¸€ä¸ªç¯å¢ƒå˜é‡</li>
<li>ç¬¬äºŒç§å½¢å¼å¯ä»¥åœ¨ä¸€ä¸ªé«˜é€Ÿç¼“å­˜å±‚ä¸­è®¾ç½®å¤šä¸ªå˜é‡, å³ä½¿æ˜¯ä¸€ä¸ªå˜é‡è¦è®¾ç½®ä¹Ÿæ¨èä½¿ç”¨è¿™ç§æ¨¡å¼æ¥è®¾ç½®</li>
</ul>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ENV</span> myName=<span class="string">"John Doe"</span> myDog=Rex\ The\ Dog \</span><br><span class="line">    myCat=fluffy</span><br><span class="line"><span class="comment"># å’Œ</span></span><br><span class="line"><span class="keyword">ENV</span> myName John Doe</span><br><span class="line"><span class="keyword">ENV</span> myDog Rex The Dog</span><br><span class="line"><span class="keyword">ENV</span> myCat fluffy</span><br></pre></td></tr></table></figure>

<p>å°†åœ¨æœ€ç»ˆå®¹å™¨ä¸­äº§ç”Ÿç›¸åŒçš„ç»“æœï¼Œä½†ç¬¬ä¸€ç§å½¢å¼æ˜¯ä¼˜é€‰çš„ï¼Œå› ä¸ºå®ƒäº§ç”Ÿå•ä¸ªé«˜é€Ÿç¼“å­˜å±‚</p>
<h1 id="ADD"><a href="#ADD" class="headerlink" title="ADD"></a>ADD</h1><p>ä¸¤ç§å½¢å¼ï¼š</p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ADD</span><span class="bash"> &lt;src&gt;... &lt;dest&gt;</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> [<span class="string">"&lt;src&gt;"</span>,... <span class="string">"&lt;dest&gt;"</span>] (å¯¹äºåŒ…å«ç©ºæ ¼çš„è·¯å¾„ï¼Œæ­¤å½¢å¼æ˜¯å¿…éœ€çš„)</span></span><br></pre></td></tr></table></figure>

<p><code>ADD</code> æŒ‡ä»¤ä»<src>å¤åˆ¶æ–°æ–‡ä»¶, ç›®å½•æˆ–è¿œç¨‹æ–‡ä»¶<code>URL</code>, å¹¶å°†å®ƒä»¬æ·»åŠ åˆ°å®¹å™¨çš„æ–‡ä»¶ç³»ç»Ÿ, è·¯å¾„<dest></p>
<p>å¯ä»¥æŒ‡å®šå¤šä¸ª<src>èµ„æº, ä½†å¦‚æœå®ƒä»¬æ˜¯æ–‡ä»¶æˆ–ç›®å½•, é‚£ä¹ˆå®ƒä»¬å¿…é¡»æ˜¯ç›¸å¯¹äºæ­£åœ¨æ„å»ºçš„æºç›®å½•</p>
<p>æ¯ä¸ª<src>å¯èƒ½åŒ…å«é€šé…ç¬¦, åŒ¹é…å°†ä½¿ç”¨Goçš„filepath.Matchè§„åˆ™å®Œæˆ. ä¾‹å¦‚ï¼š</p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ADD</span><span class="bash"> hom* /mydir/        <span class="comment"># adds all files starting with "hom"</span></span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> hom?.txt /mydir/    <span class="comment"># ? is replaced with any single character, e.g., "home.txt"</span></span></span><br></pre></td></tr></table></figure>

<p><dest>æ˜¯ç»å¯¹è·¯å¾„æˆ–ç›¸å¯¹äº<code>WORKDIR</code>çš„è·¯å¾„, æºå°†åœ¨ç›®æ ‡å®¹å™¨ä¸­å¤åˆ¶åˆ°å…¶ä¸­</p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ADD</span><span class="bash"> <span class="built_in">test</span> relativeDir/          <span class="comment"># adds "test" to `WORKDIR`/relativeDir/</span></span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> <span class="built_in">test</span> /absoluteDir/         <span class="comment"># adds "test" to /absoluteDir/</span></span></span><br></pre></td></tr></table></figure>

<p>æ‰€æœ‰æ–°æ–‡ä»¶å’Œç›®å½•éƒ½ä½¿ç”¨UIDå’ŒGIDä¸º0åˆ›å»º</p>
<p><strong>ADDéµå®ˆä»¥ä¸‹è§„åˆ™ï¼š</strong></p>
<ul>
<li><p><src>è·¯å¾„å¿…é¡»åœ¨æ„å»ºçš„ä¸Šä¸‹æ–‡ä¸­, ä¸èƒ½<code>ADD ../something /something</code> å› ä¸ºdockeræ„å»ºçš„ç¬¬ä¸€æ­¥æ˜¯å‘é€ä¸Šä¸‹æ–‡ç›®å½•ï¼ˆå’Œå­ç›®å½•ï¼‰åˆ°dockerå®ˆæŠ¤è¿›ç¨‹. </p>
</li>
<li><p>å¦‚æœ<src>æ˜¯URLå¹¶ä¸”<dest>ä¸ä»¥å°¾éƒ¨æ–œæ ç»“å°¾ï¼Œåˆ™ä»URLä¸‹è½½æ–‡ä»¶å¹¶å°†å…¶å¤åˆ¶åˆ°<dest></p>
</li>
<li><p>å¦‚æœ<src>æ˜¯URLå¹¶ä¸”<dest>ä»¥å°¾éƒ¨æ–œæ ç»“å°¾ï¼Œåˆ™ä»URLä¸­æ¨æ–­æ–‡ä»¶åï¼Œå¹¶å°†æ–‡ä»¶ä¸‹è½½åˆ°<dest>/<filename> ä¾‹å¦‚, <code>ADD http://example.com/foobar /</code>ä¼šåˆ›å»ºæ–‡ä»¶<code>/foobar</code> ç½‘å€å¿…é¡»æœ‰ä¸€ä¸ªéæ™®é€šçš„è·¯å¾„, ä»¥ä¾¿åœ¨è¿™ç§æƒ…å†µä¸‹å¯ä»¥å‘ç°ä¸€ä¸ªé€‚å½“çš„æ–‡ä»¶å<code>http://example.comä¸ä¼šå·¥ä½œ</code></p>
</li>
<li><p>å¦‚æœ<src>æ˜¯ç›®å½•, åˆ™å¤åˆ¶ç›®å½•çš„æ•´ä¸ªå†…å®¹, åŒ…æ‹¬æ–‡ä»¶ç³»ç»Ÿå…ƒæ•°æ®<br><strong>æ³¨æ„ï¼šç›®å½•æœ¬èº«ä¸è¢«å¤åˆ¶ï¼Œåªæ˜¯å…¶å†…å®¹</strong></p>
</li>
<li><p>å¦‚æœ<src>æ˜¯è¯†åˆ«çš„å‹ç¼©æ ¼å¼ï¼ˆidentityï¼Œgzipï¼Œbzip2æˆ–xzï¼‰çš„æœ¬åœ°tarå­˜æ¡£ï¼Œåˆ™å°†å…¶è§£åŒ…ä¸ºç›®å½•. æ¥è‡ªè¿œç¨‹URLçš„èµ„æºä¸ä¼šè§£å‹ç¼©. å½“ç›®å½•è¢«å¤åˆ¶æˆ–è§£å‹ç¼©æ—¶, å®ƒå…·æœ‰ä¸tar -xç›¸åŒçš„è¡Œä¸º<br><strong>æ³¨æ„ï¼šæ–‡ä»¶æ˜¯å¦è¢«è¯†åˆ«ä¸ºè¯†åˆ«çš„å‹ç¼©æ ¼å¼, ä»…åŸºäºæ–‡ä»¶çš„å†…å®¹, è€Œä¸æ˜¯æ–‡ä»¶çš„åç§°. ä¾‹å¦‚, å¦‚æœä¸€ä¸ªç©ºæ–‡ä»¶ä»¥<code>.tar.gz</code>ç»“å°¾, åˆ™ä¸ä¼šè¢«è¯†åˆ«ä¸ºå‹ç¼©æ–‡ä»¶, å¹¶ä¸”ä¸ä¼šç”Ÿæˆä»»ä½•è§£å‹ç¼©é”™è¯¯æ¶ˆæ¯, è€Œæ˜¯å°†è¯¥æ–‡ä»¶ç®€å•åœ°å¤åˆ¶åˆ°ç›®çš„åœ°</strong></p>
</li>
<li><p>å¦‚æœ<src>æ˜¯ä»»ä½•å…¶ä»–ç±»å‹çš„æ–‡ä»¶, å®ƒä¼šä¸å…¶å…ƒæ•°æ®ä¸€èµ·å•ç‹¬å¤åˆ¶. åœ¨è¿™ç§æƒ…å†µä¸‹, å¦‚æœ<dest>ä»¥å°¾éƒ¨æ–œæ <code>/</code>ç»“å°¾ï¼Œå®ƒå°†è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªç›®å½•, å¹¶ä¸”<src>çš„å†…å®¹å°†è¢«å†™åœ¨<dest>/base(<src>)</p>
</li>
<li><p>å¦‚æœç›´æ¥æˆ–ç”±äºä½¿ç”¨é€šé…ç¬¦æŒ‡å®šäº†å¤šä¸ª<src>èµ„æº, åˆ™<dest>å¿…é¡»æ˜¯ç›®å½•, å¹¶ä¸”å¿…é¡»ä»¥æ–œæ <code>/</code>ç»“å°¾</p>
</li>
<li><p>å¦‚æœ<dest>ä¸ä»¥å°¾éƒ¨æ–œæ ç»“å°¾ï¼Œå®ƒå°†è¢«è§†ä¸ºå¸¸è§„æ–‡ä»¶ï¼Œ<src>çš„å†…å®¹å°†å†™åœ¨<dest></p>
</li>
<li><p>å¦‚æœ<dest>ä¸å­˜åœ¨, åˆ™ä¼šä¸å…¶è·¯å¾„ä¸­çš„æ‰€æœ‰ç¼ºå°‘çš„ç›®å½•ä¸€èµ·åˆ›å»º</p>
</li>
</ul>
<h1 id="COPY"><a href="#COPY" class="headerlink" title="COPY"></a>COPY</h1><p>ä¸¤ç§å½¢å¼ï¼š</p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">COPY</span><span class="bash"> &lt;src&gt;... &lt;dest&gt;</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> [<span class="string">"&lt;src&gt;"</span>,... <span class="string">"&lt;dest&gt;"</span>] (this form is required <span class="keyword">for</span> paths containing whitespace)</span></span><br></pre></td></tr></table></figure>

<p>åŸºæœ¬å’ŒADDç±»ä¼¼ï¼Œä¸è¿‡COPYçš„<src>ä¸èƒ½ä¸ºURL</p>
<p>ä¸ ADD ä¸åŒçš„ä¸€ç‚¹æ˜¯, é‡åˆ°å‹ç¼©æ–‡ä»¶, COPY ä¸ä¼šå»æ£€æµ‹æ–‡ä»¶çš„å‹ç¼©å±æ€§, ä¸ä¼šåšä»»ä½•çš„è§£å‹ç¼©æ“ä½œ, ä¼šç›´æ¥æŠŠæºæ–‡ä»¶åŸå°ä¸åŠ¨çš„æ‹·è´åˆ°ç›®æ ‡åœ°å€</p>
<h1 id="ENTRYPOINT"><a href="#ENTRYPOINT" class="headerlink" title="ENTRYPOINT"></a>ENTRYPOINT</h1><p>ä¸¤ç§å½¢å¼ï¼š</p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> [â€œexecutableâ€, â€œparam1â€, â€œparam2â€] ï¼ˆ<span class="built_in">exec</span> å½¢å¼, é¦–é€‰ï¼‰</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> <span class="built_in">command</span> param1 param2 (shell å½¢å¼)</span></span><br></pre></td></tr></table></figure>

<p><code>ENTRYPOINT</code>å…è®¸æ‚¨é…ç½®å®¹å™¨, è¿è¡Œæ‰§è¡Œçš„å¯æ‰§è¡Œæ–‡ä»¶</p>
<p>ä¾‹å¦‚, ä»¥ä¸‹å°†ä½¿ç”¨å…¶é»˜è®¤å†…å®¹å¯åŠ¨nginx, ç›‘å¬ç«¯å£80ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run -i -t --rm -p 80:80 nginx</span><br></pre></td></tr></table></figure>

<p><code>docker run &lt;image&gt;</code>çš„å‘½ä»¤è¡Œå‚æ•°å°†é™„è·Ÿåœ¨ exec å½¢å¼çš„<code>ENTRYPOINT</code>ä¸­çš„æ‰€æœ‰å…ƒç´ ä¹‹å, å¹¶å°†è¦†ç›–ä½¿ç”¨<code>CMD</code>æŒ‡å®šçš„æ‰€æœ‰å…ƒç´ . è¿™å…è®¸å°†å‚æ•°ä¼ é€’åˆ°å…¥å£ç‚¹, å³<code>docker run &lt;image&gt; -d</code>å°†æŠŠ<code>-d</code>å‚æ•°ä¼ é€’ç»™å…¥å£ç‚¹. æ‚¨å¯ä»¥ä½¿ç”¨<code>docker run --entrypoint</code>æ ‡å¿—è¦†ç›–<code>ENTRYPOINT</code>æŒ‡ä»¤</p>
<p>shell å½¢å¼é˜²æ­¢ä½¿ç”¨ä»»ä½•<code>CMD</code>æˆ–è¿è¡Œå‘½ä»¤è¡Œå‚æ•°, ä½†æ˜¯ç¼ºç‚¹æ˜¯<code>ENTRYPOINT</code>å°†ä½œ<code>/bin/sh -c</code>çš„å­å‘½ä»¤å¯åŠ¨, å®ƒä¸ä¼ é€’ä¿¡å·. è¿™æ„å‘³ç€å¯æ‰§è¡Œæ–‡ä»¶å°†ä¸æ˜¯å®¹å™¨çš„<code>PID 1</code>, å¹¶ä¸”ä¸ä¼šæ¥æ”¶<code>Unix</code>ä¿¡å·, å› æ­¤ä½ çš„å¯æ‰§è¡Œæ–‡ä»¶å°†ä¸ä¼šä»<code>docker stop &lt;container&gt;</code>æ¥æ”¶åˆ°<code>SIGTERM</code></p>
<p>åªæœ‰Dockerfileä¸­æœ€åä¸€ä¸ª<code>ENTRYPOINT</code>æŒ‡ä»¤ä¼šæœ‰æ•ˆæœ</p>
<h2 id="Exec-form-ENTRYPOINT-example"><a href="#Exec-form-ENTRYPOINT-example" class="headerlink" title="Exec form ENTRYPOINT example"></a>Exec form ENTRYPOINT example</h2><p>å¯ä»¥ä½¿ç”¨ENTRYPOINTçš„<code>exec</code>å½¢å¼è®¾ç½®ç›¸å½“ç¨³å®šçš„é»˜è®¤å‘½ä»¤å’Œå‚æ•°, ç„¶åä½¿ç”¨ä»»ä¸€å½¢å¼çš„<code>CMD</code>è®¾ç½®æ›´å¯èƒ½æ›´æ”¹çš„å…¶ä»–é»˜è®¤å€¼</p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">FROM</span> ubuntu</span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> [<span class="string">"top"</span>, <span class="string">"-b"</span>]</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">"-c"</span>]</span></span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸‹Dockerfileæ˜¾ç¤ºä½¿ç”¨ENTRYPOINTåœ¨å‰å°è¿è¡ŒApache, ä½œä¸ºPID 1</p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">FROM</span> debian:stable</span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> apt-get update &amp;&amp; apt-get install -y --force-yes apache2</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">80</span> <span class="number">443</span></span><br><span class="line"><span class="keyword">VOLUME</span><span class="bash"> [<span class="string">"/var/www"</span>, <span class="string">"/var/log/apache2"</span>, <span class="string">"/etc/apache2"</span>]</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> [<span class="string">"/usr/sbin/apache2ctl"</span>, <span class="string">"-D"</span>, <span class="string">"FOREGROUND"</span>]</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœéœ€è¦ä¸ºå•ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ç¼–å†™å¯åŠ¨è„šæœ¬ï¼Œå¯ä»¥ä½¿ç”¨execå’Œgosuå‘½ä»¤ç¡®ä¿æœ€ç»ˆå¯æ‰§è¡Œæ–‡ä»¶æ¥æ”¶åˆ°Unixä¿¡å·ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">set</span> -e</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">"<span class="variable">$1</span>"</span> = <span class="string">'postgres'</span> ]; <span class="keyword">then</span></span><br><span class="line">    chown -R postgres <span class="string">"<span class="variable">$PGDATA</span>"</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> [ -z <span class="string">"<span class="variable">$(ls -A "$PGDATA")</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">        gosu postgres initdb</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">exec</span> gosu postgres <span class="string">"<span class="variable">$@</span>"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exec</span> <span class="string">"<span class="variable">$@</span>"</span></span><br></pre></td></tr></table></figure>

<ul>
<li>set -e : åœ¨è„šæœ¬çš„æ‰§è¡Œä¸­ä»»ä½•ä¸€è¡Œå‡ºç°æ‰§è¡Œå¤±è´¥éƒ½ç«‹å³é€€å‡ºè„šæœ¬</li>
<li>set -eo pipefail : åœ¨ç®¡é“çš„ä½¿ç”¨ä¸­, ä»»æ„ä¸€ä¸ªç¯èŠ‚å‡ºç°é—®é¢˜éƒ½ç«‹å³é€€å‡º</li>
<li>set â€“ postgres â€œ$@â€ : å°†åé¢çš„æ¯ä¸€ä¸ªå€¼ä¾æ¬¡æ”¾å…¥ $1 $2 $3 â€¦</li>
<li>$@ : ä¼ ç»™è„šæœ¬çš„æ‰€æœ‰å‚æ•°çš„åˆ—è¡¨</li>
</ul>
<p>ä¸Šé¢è„šæœ¬çš„æ„æ€æ˜¯, é¦–å…ˆåˆ¤æ–­ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸æ˜¯é¢„æœŸä¸­çš„å¯æ‰§è¡Œå‘½ä»¤, å¦‚æœç¬¬ä¸€ä¸ªå‚æ•°æ˜¯é¢„æœŸä¸­çš„å¯æ‰§è¡Œå‘½ä»¤, é‚£ä¹ˆåé¢å‚æ•°é»˜è®¤å‡ä¸ºç¬¬ä¸€ä¸ª(å‚æ•°)å‘½ä»¤çš„å‚æ•°; å¦‚æœç¬¬ä¸€ä¸ªå‚æ•°ä¸æ˜¯é¢„æœŸä¸­çš„å¯è¡Œæ€§å‘½ä»¤, é‚£ä¹ˆå°±è®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªå…¨æ–°çš„å‘½ä»¤è¦æ‰§è¡Œ, æ‰€ä»¥ä½¿ç”¨<code>exec $@</code>å®Œæ•´åœ°æ‰§è¡Œå‘½ä»¤</p>
<p>å¦‚æœéœ€è¦åœ¨å…³é—­æ—¶è¿›è¡Œä¸€äº›é¢å¤–çš„æ¸…ç†ï¼ˆæˆ–ä¸å…¶ä»–å®¹å™¨é€šä¿¡ï¼‰æˆ–è€…åè°ƒå¤šä¸ªå¯æ‰§è¡Œæ–‡ä»¶, éœ€è¦ç¡®ä¿<code>ENTRYPOINT</code>è„šæœ¬æ¥æ”¶åˆ°Unixä¿¡å·, ä¼ é€’å®ƒä»¬, ç„¶ååšä¸€äº›æ›´å¤šçš„å–„åå·¥ä½œï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"><span class="comment"># Note: I've written this using sh so it works in the busybox container too</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># USE the trap if you need to also do manual cleanup after the service is stopped,</span></span><br><span class="line"><span class="comment">#     or need to start multiple services in the one container</span></span><br><span class="line"><span class="built_in">trap</span> <span class="string">"echo TRAPed signal"</span> HUP INT QUIT TERM</span><br><span class="line"></span><br><span class="line"><span class="comment"># start service in background here</span></span><br><span class="line">/usr/sbin/apachectl start</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"[hit enter key to exit] or run 'docker stop &lt;container&gt;'"</span></span><br><span class="line"><span class="built_in">read</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># stop service and clean up here</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"stopping apache"</span></span><br><span class="line">/usr/sbin/apachectl stop</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"exited <span class="variable">$0</span>"</span></span><br></pre></td></tr></table></figure>

<h2 id="Shell-form-ENTRYPOINT-example"><a href="#Shell-form-ENTRYPOINT-example" class="headerlink" title="Shell form ENTRYPOINT example"></a>Shell form ENTRYPOINT example</h2><p>ä½ å¯ä»¥ä¸º<code>ENTRYPOINT</code>æŒ‡å®šä¸€ä¸ªçº¯å­—ç¬¦ä¸²ï¼Œå®ƒå°†åœ¨<code>/bin/sh -c</code>ä¸­æ‰§è¡Œã€‚è¿™ç§å½¢å¼å°†ä½¿ç”¨shellå¤„ç†æ¥æ›¿æ¢shellç¯å¢ƒå˜é‡ï¼Œå¹¶ä¸”å°†å¿½ç•¥ä»»ä½•<code>CMD</code>æˆ–<code>docker run</code>å‘½ä»¤è¡Œå‚æ•°ã€‚è¦ç¡®ä¿<code>docker stop</code>å°†æ­£ç¡®åœ°æ§åˆ¶<code>ENTRYPOINT</code>å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¿…é¡»ç”¨<code>exec</code>å¯åŠ¨å®ƒï¼š</p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">FROM</span> ubuntu</span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> <span class="built_in">exec</span> top -b</span></span><br></pre></td></tr></table></figure>

<p>è¿è¡Œæ­¤imageæ—¶ï¼Œæ‚¨å°†çœ‹åˆ°å•ä¸ª<code>PID 1</code>è¿›ç¨‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ docker run -it --rm --name <span class="built_in">test</span> top</span><br><span class="line">Mem: 1704520K used, 352148K free, 0K shrd, 0K buff, 140368121167873K cached</span><br><span class="line">CPU:   5% usr   0% sys   0% nic  94% idle   0% io   0% irq   0% sirq</span><br><span class="line">Load average: 0.08 0.03 0.05 2/98 6</span><br><span class="line">  PID  PPID USER     STAT   VSZ %VSZ %CPU COMMAND</span><br><span class="line">    1     0 root     R     3164   0%   0% top -b</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨<code>docker stop</code>å¯ä»¥å¹²å‡€çš„é€€å‡ºï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ /usr/bin/time docker stop <span class="built_in">test</span></span><br><span class="line"><span class="built_in">test</span></span><br><span class="line">real    0m 0.20s</span><br><span class="line">user    0m 0.02s</span><br><span class="line">sys 0m 0.04s</span><br></pre></td></tr></table></figure>

<p>å¦‚æœå¿˜è®°å°†<code>exec</code>æ·»åŠ åˆ°æ‚¨çš„<code>ENTRYPOINT</code>çš„å¼€å¤´ï¼š</p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">FROM</span> ubuntu</span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> top -b</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> --ignored-param1</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åï¼Œä½ å¯ä»¥è¿è¡Œå®ƒï¼ˆç»™å®ƒä¸€ä¸ªåç§°ä¸ºä¸‹ä¸€æ­¥ï¼‰ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ docker run -it --name <span class="built_in">test</span> top --ignored-param2</span><br><span class="line">Mem: 1704184K used, 352484K free, 0K shrd, 0K buff, 140621524238337K cached</span><br><span class="line">CPU:   9% usr   2% sys   0% nic  88% idle   0% io   0% irq   0% sirq</span><br><span class="line">Load average: 0.01 0.02 0.05 2/101 7</span><br><span class="line">  PID  PPID USER     STAT   VSZ %VSZ %CPU COMMAND</span><br><span class="line">    1     0 root     S     3168   0%   0% /bin/sh -c top -b cmd cmd2</span><br><span class="line">    7     1 root     R     3164   0%   0% top -b</span><br></pre></td></tr></table></figure>

<p>æ‚¨å¯ä»¥ä»topçš„è¾“å‡ºä¸­çœ‹åˆ°æŒ‡å®šçš„ENTRYPOINTä¸æ˜¯PID 1ã€‚</p>
<p>å¦‚æœä½ è¿è¡Œdockeråœæ­¢æµ‹è¯•ï¼Œå®¹å™¨å°†ä¸ä¼šå®Œå…¨é€€å‡º, è¶…æ—¶ååœæ­¢å‘½ä»¤å°†å¼ºåˆ¶å‘é€SIGKILLï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ docker <span class="built_in">exec</span> -it <span class="built_in">test</span> ps aux</span><br><span class="line">PID   USER     COMMAND</span><br><span class="line">    1 root     /bin/sh -c top -b cmd cmd2</span><br><span class="line">    7 root     top -b</span><br><span class="line">    8 root     ps aux</span><br><span class="line">$ /usr/bin/time docker stop <span class="built_in">test</span></span><br><span class="line"><span class="built_in">test</span></span><br><span class="line">real    0m 10.19s</span><br><span class="line">user    0m 0.04s</span><br><span class="line">sys 0m 0.03s</span><br></pre></td></tr></table></figure>

<h2 id="Understand-how-CMD-and-ENTRYPOINT-interact"><a href="#Understand-how-CMD-and-ENTRYPOINT-interact" class="headerlink" title="Understand how CMD and ENTRYPOINT interact"></a>Understand how CMD and ENTRYPOINT interact</h2><p><code>CMD</code>å’Œ<code>ENTRYPOINT</code>æŒ‡ä»¤å®šä¹‰åœ¨è¿è¡Œå®¹å™¨æ—¶æ‰§è¡Œä»€ä¹ˆå‘½ä»¤, æœ‰å¦‚ä¸‹ä½¿ç”¨è§„åˆ™</p>
<ul>
<li><code>Dockerfile</code>åº”è¯¥è‡³å°‘æŒ‡å®šä¸€ä¸ª<code>CMD</code>æˆ–<code>ENTRYPOINT</code>å‘½ä»¤</li>
<li>å½“ä½¿ç”¨å®¹å™¨ä½œä¸ºå¯æ‰§è¡Œæ–‡ä»¶æ—¶ï¼Œåº”è¯¥å®šä¹‰<code>ENTRYPOINT</code></li>
<li><code>CMD</code>åº”è¯¥ç”¨ä½œå®šä¹‰<code>ENTRYPOINT</code>å‘½ä»¤çš„é»˜è®¤å‚æ•°æˆ–åœ¨å®¹å™¨ä¸­æ‰§è¡Œad-hocå‘½ä»¤çš„ä¸€ç§æ–¹æ³•</li>
<li>å½“è¿è¡Œå¸¦æœ‰æ›¿ä»£å‚æ•°çš„å®¹å™¨æ—¶ï¼Œ<code>CMD</code>å°†è¢«è¦†ç›–</li>
</ul>
<p>ä¸‹è¡¨æ˜¾ç¤ºäº†å¯¹ä¸åŒ<code>ENTRYPOINT</code>/<code>CMD</code>ç»„åˆæ‰§è¡Œçš„å‘½ä»¤ï¼š</p>
<table>
<thead>
<tr>
<th></th>
<th>no ENTRYPOINT</th>
<th>ENTRYPOINT exec_enty p1_entry</th>
<th>ENTRYPOINT [â€œexec_entryâ€,â€œp1_entryâ€]</th>
</tr>
</thead>
<tbody><tr>
<td>No CMD</td>
<td>error, not allowed</td>
<td>/bin/sh -c exec_entry p1_entry</td>
<td>exec_entry p1_entry</td>
</tr>
<tr>
<td>CMD [â€œexec_cmdâ€,â€œp1_cmdâ€]</td>
<td>exec_cmd p1_cmd</td>
<td>/bin/sh -c exec_entry p1_entry exec_cmd p1_cmd</td>
<td>exec_entry p1_entry exec_cmd p1_cmd</td>
</tr>
<tr>
<td>CMD [â€œp1_cmdâ€, â€œp2_cmdâ€]</td>
<td>p1_cmd p2_cmd</td>
<td>/bin/sh -c exec_entry p1_entry p1_cmd p2_cmd</td>
<td>exec_entry p1_entry p1_cmd p2_cmd</td>
</tr>
<tr>
<td>CMD exec_cmd p1_cmd</td>
<td>/bin/sh -c exec_cmd p1_cmd</td>
<td>/bin/sh -c exec_entry p1_entry /bin/sh -c exec_cmd p1_cmd</td>
<td>exec_entry p1_entry /bin/sh -c exec_cmd p1_cmd</td>
</tr>
</tbody></table>
<h1 id="VOLUME"><a href="#VOLUME" class="headerlink" title="VOLUME"></a>VOLUME</h1><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">VOLUME</span><span class="bash"> [<span class="string">"/data"</span>]</span></span><br></pre></td></tr></table></figure>

<p><code>VOLUME</code>æŒ‡ä»¤åˆ›å»ºå…·æœ‰æŒ‡å®šåç§°çš„æŒ‚è½½ç‚¹ï¼Œå¹¶å°†å…¶æ ‡è®°ä¸ºä»æœ¬æœºä¸»æœºæˆ–å…¶ä»–å®¹å™¨ä¿ç•™å¤–éƒ¨æŒ‚è½½çš„å·ã€‚è¯¥å€¼å¯ä»¥æ˜¯JSONæ•°ç»„<code>VOLUME [&quot;/var/log/&quot;]</code>æˆ–å…·æœ‰å¤šä¸ªå‚æ•°çš„çº¯å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚<code>VOLUME /var/log</code>æˆ–<code>VOLUME /var/log /var/db</code></p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">FROM</span> ubuntu</span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> mkdir /myvol</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">echo</span> <span class="string">"hello world"</span> &gt; /myvol/greeting</span></span><br><span class="line"><span class="keyword">VOLUME</span><span class="bash"> /myvol</span></span><br></pre></td></tr></table></figure>

<h1 id="USER"><a href="#USER" class="headerlink" title="USER"></a>USER</h1><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">USER</span> daemon</span><br></pre></td></tr></table></figure>

<p><code>USER</code>æŒ‡ä»¤è®¾ç½®è¿è¡Œimageæ—¶ä½¿ç”¨çš„ç”¨æˆ·åæˆ–UID, ä»¥åŠ<code>Dockerfile</code>ä¸­çš„ä»»ä½•RUNï¼Œ<code>CMD</code>å’Œ<code>ENTRYPOINT</code>æŒ‡ä»¤</p>
<h1 id="WORKDIR"><a href="#WORKDIR" class="headerlink" title="WORKDIR"></a>WORKDIR</h1><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> /path/to/workdir</span></span><br></pre></td></tr></table></figure>

<p><code>WORKDIR</code>æŒ‡ä»¤ä¸º<code>Dockerfile</code>ä¸­çš„ä»»ä½•<code>RUN</code>ï¼Œ<code>CMD</code>ï¼Œ<code>ENTRYPOINT</code>ï¼Œ<code>COPY</code>å’Œ<code>ADD</code>æŒ‡ä»¤è®¾ç½®å·¥ä½œç›®å½•ã€‚å¦‚æœ<code>WORKDIR</code>ä¸å­˜åœ¨ï¼Œå®ƒå°†è¢«åˆ›å»ºï¼Œå³ä½¿å®ƒæ²¡æœ‰åœ¨ä»»ä½•åç»­çš„<code>Dockerfile</code>æŒ‡ä»¤ä¸­ä½¿ç”¨</p>
<p>å®ƒå¯ä»¥åœ¨ä¸€ä¸ª<code>Dockerfile</code>ä¸­å¤šæ¬¡ä½¿ç”¨. å¦‚æœæä¾›äº†ç›¸å¯¹è·¯å¾„, å®ƒå°†ç›¸å¯¹äºå…ˆå‰WORKDIRæŒ‡ä»¤çš„è·¯å¾„.  ä¾‹å¦‚:</p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> /a</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> b</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> c</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">pwd</span></span></span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ä¸ª<code>Dockerfile</code>ä¸­çš„æœ€ç»ˆ<code>pwd</code>å‘½ä»¤çš„è¾“å‡ºæ˜¯<code>/a/b/c</code></p>
<p><code>WORKDIR</code>æŒ‡ä»¤å¯ä»¥è§£æå…ˆå‰ä½¿ç”¨<code>ENV</code>è®¾ç½®çš„ç¯å¢ƒå˜é‡ã€‚æ‚¨åªèƒ½ä½¿ç”¨åœ¨<code>Dockerfile</code>ä¸­æ˜¾å¼è®¾ç½®çš„ç¯å¢ƒå˜é‡.  ä¾‹å¦‚ï¼š</p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ENV</span> DIRPATH /path</span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> <span class="variable">$DIRPATH</span>/<span class="variable">$DIRNAME</span></span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">pwd</span></span></span><br></pre></td></tr></table></figure>

<p><code>pwd</code>å‘½ä»¤åœ¨è¯¥<code>Dockerfile</code>ä¸­è¾“å‡ºçš„æœ€åç»“æœæ˜¯<code>/path/$DIRNAME</code></p>
<h1 id="ARG"><a href="#ARG" class="headerlink" title="ARG"></a>ARG</h1><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ARG</span> &lt;name&gt;[=&lt;default value&gt;]</span><br></pre></td></tr></table></figure>

<p><code>ARG</code>æŒ‡ä»¤å®šä¹‰ä¸€ä¸ªå˜é‡, ç”¨æˆ·å¯ä»¥ä½¿ç”¨<code>docker build</code>å‘½ä»¤ä½¿ç”¨<code>--build-arg &lt;varname&gt; = &lt;value&gt;</code>æ ‡å¿—ï¼Œåœ¨æ„å»ºæ—¶å°†å…¶ä¼ é€’ç»™æ„å»ºå™¨. å¦‚æœç”¨æˆ·æŒ‡å®šäº†ä¸€ä¸ªæœªåœ¨<code>Dockerfile</code>ä¸­å®šä¹‰çš„æ„å»ºå‚æ•°, æ„å»ºå°†è¾“å‡ºé”™è¯¯</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">One or more build-args were not consumed, failing build.</span><br></pre></td></tr></table></figure>

<p>Dockerfileä½œè€…å¯ä»¥é€šè¿‡æŒ‡å®š<code>ARG</code>ä¸€ä¸ªæˆ–å¤šä¸ªå˜é‡, é€šè¿‡å¤šæ¬¡æŒ‡å®š<code>ARG</code>æ¥å®šä¹‰å•ä¸ªå˜é‡. ä¾‹å¦‚, ä¸€ä¸ªæœ‰æ•ˆçš„<code>Dockerfile</code>ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">FROM busybox</span><br><span class="line">ARG user1</span><br><span class="line">ARG buildno</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>Dockerfileä½œè€…å¯ä»¥å¯é€‰åœ°æŒ‡å®š<code>ARG</code>æŒ‡ä»¤çš„é»˜è®¤å€¼ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">FROM busybox</span><br><span class="line">ARG user1&#x3D;someuser</span><br><span class="line">ARG buildno&#x3D;1</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>å¦‚æœ<code>ARG</code>å€¼å…·æœ‰ç¼ºçœå€¼ï¼Œå¹¶ä¸”å¦‚æœåœ¨æ„å»ºæ—¶æ²¡æœ‰ä¼ é€’å€¼ï¼Œåˆ™æ„å»ºå™¨ä½¿ç”¨ç¼ºçœå€¼ã€‚</p>
<p><code>ARG</code>å˜é‡å®šä¹‰ä»åœ¨<code>Dockerfile</code>ä¸­å®šä¹‰çš„è¡Œå¼€å§‹ç”Ÿæ•ˆï¼Œè€Œä¸æ˜¯ä»å‘½ä»¤è¡Œæˆ–å…¶ä»–åœ°æ–¹çš„å‚æ•°ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œè€ƒè™‘è¿™ä¸ªDockerfileï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1 FROM busybox</span><br><span class="line">2 USER $&#123;user:-some_user&#125;</span><br><span class="line">3 ARG user</span><br><span class="line">4 USER $user</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>ç”¨æˆ·æ„å»ºæ­¤æ–‡ä»¶å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ docker build --build-arg user&#x3D;what_user Dockerfile</span><br></pre></td></tr></table></figure>

<p>ç¬¬2è¡Œçš„<code>USER</code>å°†è¯„ä¼°ä¸º<code>some_user</code>ï¼Œå› ä¸ºç”¨æˆ·å˜é‡åœ¨åç»­è¡Œ3ä¸Šå®šä¹‰ã€‚ç¬¬4è¡Œçš„<code>USER</code>åœ¨å®šä¹‰ç”¨æˆ·æ—¶ä¼°è®¡ä¸º<code>what_user</code>ï¼Œåœ¨å‘½ä»¤è¡Œä¸­ä¼ é€’<code>what_user</code>å€¼ã€‚åœ¨é€šè¿‡<code>ARG</code>æŒ‡ä»¤å®šä¹‰ä¹‹å‰ï¼Œå˜é‡çš„ä»»ä½•ä½¿ç”¨éƒ½å°†å¯¼è‡´ç©ºå­—ç¬¦ä¸²ã€‚</p>
<blockquote>
<p><code>è­¦å‘Š</code>ï¼šä¸å»ºè®®ä½¿ç”¨build-timeå˜é‡æ¥ä¼ é€’è¯¸å¦‚githubå¯†é’¥, ç”¨æˆ·å‡­è¯ç­‰å¯†ç . æ„å»ºæ—¶å˜é‡å€¼ä½¿ç”¨<code>docker history</code>å‘½ä»¤å¯¹é•œåƒçš„ä»»ä½•ç”¨æˆ·å¯è§</p>
</blockquote>
<p>å¯ä»¥ä½¿ç”¨<code>ARG</code>æˆ–<code>ENV</code>æŒ‡ä»¤æ¥æŒ‡å®š<code>RUN</code>æŒ‡ä»¤å¯ç”¨çš„å˜é‡ã€‚ä½¿ç”¨<code>ENV</code>æŒ‡ä»¤å®šä¹‰çš„ç¯å¢ƒå˜é‡æ€»æ˜¯è¦†ç›–åŒåçš„<code>ARG</code>æŒ‡ä»¤ã€‚æ€è€ƒè¿™ä¸ª<code>Dockerfile</code>å¸¦æœ‰<code>ENV</code>å’Œ<code>ARG</code>æŒ‡ä»¤ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1 FROM ubuntu</span><br><span class="line">2 ARG CONT_IMG_VER</span><br><span class="line">3 ENV CONT_IMG_VER v1.0.0</span><br><span class="line">4 RUN echo $CONT_IMG_VER</span><br></pre></td></tr></table></figure>

<p>ç„¶åï¼Œå‡è®¾æ­¤imageæ˜¯ä½¿ç”¨æ­¤å‘½ä»¤æ„å»ºçš„ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ docker build --build-arg CONT_IMG_VER&#x3D;v2.0.1 Dockerfile</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<code>RUN</code>æŒ‡ä»¤ä½¿ç”¨<code>v1.0.0</code>è€Œä¸æ˜¯ç”¨æˆ·ä¼ é€’çš„<code>ARG</code>è®¾ç½®ï¼š<code>v2.0.1</code>æ­¤è¡Œä¸ºç±»ä¼¼äºshellè„šæœ¬ï¼Œå…¶ä¸­æœ¬åœ°ä½œç”¨åŸŸå˜é‡è¦†ç›–ä½œä¸ºå‚æ•°ä¼ é€’æˆ–ä»ç¯å¢ƒç»§æ‰¿çš„å˜é‡ï¼Œä»å…¶å®šä¹‰ç‚¹ã€‚</p>
<p>ä½¿ç”¨ä¸Šè¿°ç¤ºä¾‹ï¼Œä½†ä½¿ç”¨ä¸åŒçš„<code>ENV</code>è§„èŒƒï¼Œæ‚¨å¯ä»¥åœ¨<code>ARG</code>å’Œ<code>ENV</code>æŒ‡ä»¤ä¹‹é—´åˆ›å»ºæ›´æœ‰ç”¨çš„äº¤äº’ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1 FROM ubuntu</span><br><span class="line">2 ARG CONT_IMG_VER</span><br><span class="line">3 ENV CONT_IMG_VER $&#123;CONT_IMG_VER:-v1.0.0&#125;</span><br><span class="line">4 RUN echo $CONT_IMG_VER</span><br></pre></td></tr></table></figure>

<p>ä¸<code>ARG</code>æŒ‡ä»¤ä¸åŒ, <code>ENV</code>å€¼å§‹ç»ˆä¿ç•™åœ¨imageä¸­. è€ƒè™‘ä¸€ä¸ªæ²¡æœ‰<code>-build-arg</code>æ ‡å¿—çš„dockeræ„å»ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ docker build Dockerfile</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨è¿™ä¸ªDockerfileç¤ºä¾‹ï¼Œ<code>CONT_IMG_VER</code>ä»ç„¶ä¿ç•™åœ¨æ˜ åƒä¸­ï¼Œä½†å®ƒçš„å€¼å°†æ˜¯<code>v1.0.0</code>ï¼Œå› ä¸ºå®ƒæ˜¯<code>ENV</code>æŒ‡ä»¤åœ¨ç¬¬3è¡Œä¸­çš„é»˜è®¤è®¾ç½®ã€‚</p>
<p>æ­¤ç¤ºä¾‹ä¸­çš„å˜é‡æ‰©å±•æŠ€æœ¯å…è®¸æ‚¨ä»å‘½ä»¤è¡Œä¼ é€’å‚æ•°ï¼Œå¹¶é€šè¿‡åˆ©ç”¨<code>ENV</code>æŒ‡ä»¤å°†å®ƒä»¬æŒä¹…ä¿å­˜åœ¨æœ€ç»ˆimageä¸­</p>
<p>Dockeræœ‰ä¸€ç»„é¢„å®šä¹‰çš„<code>ARG</code>å˜é‡ï¼Œæ‚¨å¯ä»¥åœ¨Dockerfileä¸­ä½¿ç”¨ç›¸åº”çš„ARGæŒ‡ä»¤ã€‚</p>
<ul>
<li>HTTP_PROXY</li>
<li>http_proxy</li>
<li>HTTPS_PROXY</li>
<li>https_proxy</li>
<li>FTP_PROXY</li>
<li>ftp_proxy</li>
<li>NO_PROXY</li>
<li>no_proxy</li>
</ul>
<p>è¦ä½¿ç”¨è¿™äº›ï¼Œåªéœ€åœ¨å‘½ä»¤è¡Œä½¿ç”¨æ ‡å¿—ä¼ é€’å®ƒä»¬ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">--build-arg &lt;varname&gt;&#x3D;&lt;value&gt;</span><br></pre></td></tr></table></figure>

<h2 id="Impact-on-build-caching"><a href="#Impact-on-build-caching" class="headerlink" title="Impact on build caching"></a>Impact on build caching</h2><p><code>ARG</code>å˜é‡ä¸ä¼šæŒä¹…åŒ–åˆ°æ„å»ºçš„imageä¸­ï¼Œå› ä¸º<code>ENV</code>å˜é‡æ˜¯ã€‚ä½†æ˜¯ï¼Œ<code>ARG</code>å˜é‡ä¼šä»¥ç±»ä¼¼çš„æ–¹å¼å½±å“æ„å»ºç¼“å­˜ã€‚å¦‚æœä¸€ä¸ª<code>Dockerfile</code>å®šä¹‰ä¸€ä¸ª<code>ARG</code>å˜é‡ï¼Œå®ƒçš„å€¼ä¸åŒäºä»¥å‰çš„ç‰ˆæœ¬ï¼Œé‚£ä¹ˆåœ¨å®ƒçš„ç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶ä¼šå‡ºç°ä¸€ä¸ªâ€œcache missâ€ï¼Œè€Œä¸æ˜¯å®ƒçš„å®šä¹‰ã€‚ç‰¹åˆ«åœ°ï¼Œåœ¨<code>ARG</code>æŒ‡ä»¤ä¹‹åçš„æ‰€æœ‰<code>RUN</code>æŒ‡ä»¤éƒ½éšå¼åœ°ä½¿ç”¨ARGå˜é‡ï¼ˆä½œä¸ºç¯å¢ƒå˜é‡ï¼‰ï¼Œå› æ­¤å¯èƒ½å¯¼è‡´é«˜é€Ÿç¼“å­˜æœªå‘½ä¸­ã€‚</p>
<p>ä¾‹å¦‚ï¼Œè€ƒè™‘è¿™ä¸¤ä¸ªDockerfileï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1 FROM ubuntu</span><br><span class="line">2 ARG CONT_IMG_VER</span><br><span class="line">3 RUN echo $CONT_IMG_VER</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1 FROM ubuntu</span><br><span class="line">2 ARG CONT_IMG_VER</span><br><span class="line">3 RUN echo hello</span><br></pre></td></tr></table></figure>

<p>å¦‚æœåœ¨å‘½ä»¤è¡Œä¸ŠæŒ‡å®š<code>--build-arg CONT_IMG_VER = &lt;value&gt;</code>ï¼Œåˆ™åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œç¬¬2è¡Œçš„è§„èŒƒä¸ä¼šå¯¼è‡´é«˜é€Ÿç¼“å­˜æœªå‘½ä¸­;è¡Œ3ç¡®å®å¯¼è‡´é«˜é€Ÿç¼“å­˜æœªå‘½ä¸­ã€‚<code>ARG CONT_IMG_VER</code>å¯¼è‡´<code>RUN</code>è¡Œè¢«æ ‡è¯†ä¸ºä¸è¿è¡Œ<code>CONT_IMG_VER = &lt;value&gt; echo hello</code>ç›¸åŒï¼Œå› æ­¤å¦‚æœ<code>&lt;value&gt;</code>æ›´æ”¹ï¼Œæˆ‘ä»¬å°†å¾—åˆ°é«˜é€Ÿç¼“å­˜æœªå‘½ä¸­ã€‚</p>
<p>è€ƒè™‘åœ¨åŒä¸€å‘½ä»¤è¡Œä¸‹çš„å¦ä¸€ä¸ªç¤ºä¾‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1 FROM ubuntu</span><br><span class="line">2 ARG CONT_IMG_VER</span><br><span class="line">3 ENV CONT_IMG_VER $CONT_IMG_VER</span><br><span class="line">4 RUN echo $CONT_IMG_VER</span><br></pre></td></tr></table></figure>

<p>åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œé«˜é€Ÿç¼“å­˜æœªå‘½ä¸­å‘ç”Ÿåœ¨ç¬¬3è¡Œã€‚ç”±äºå˜é‡åœ¨<code>ENV</code>ä¸­çš„å€¼å¼•ç”¨<code>ARG</code>å˜é‡å¹¶ä¸”è¯¥å˜é‡é€šè¿‡å‘½ä»¤è¡Œæ›´æ”¹ï¼Œå› æ­¤å‘ç”Ÿäº†æœªå‘½ä¸­ã€‚åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œ<code>ENV</code>å‘½ä»¤ä½¿imageåŒ…æ‹¬è¯¥å€¼ã€‚</p>
<p>å¦‚æœ<code>ENV</code>æŒ‡ä»¤è¦†ç›–åŒåçš„<code>ARG</code>æŒ‡ä»¤ï¼Œå°±åƒè¿™ä¸ªDockerfileï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1 FROM ubuntu</span><br><span class="line">2 ARG CONT_IMG_VER</span><br><span class="line">3 ENV CONT_IMG_VER hello</span><br><span class="line">4 RUN echo $CONT_IMG_VER</span><br></pre></td></tr></table></figure>

<p>ç¬¬3è¡Œä¸ä¼šå¯¼è‡´é«˜é€Ÿç¼“å­˜æœªå‘½ä¸­ï¼Œå› ä¸º<code>CONT_IMG_VER</code>çš„å€¼æ˜¯ä¸€ä¸ªå¸¸é‡ï¼ˆhelloï¼‰å› æ­¤ï¼Œ<code>RUN</code>ï¼ˆç¬¬4è¡Œï¼‰ä¸Šä½¿ç”¨çš„ç¯å¢ƒå˜é‡å’Œå€¼åœ¨æ„å»ºä¹‹é—´ä¸ä¼šæ›´æ”¹</p>
<h1 id="ONBUILD"><a href="#ONBUILD" class="headerlink" title="ONBUILD"></a>ONBUILD</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ONBUILD [INSTRUCTION]</span><br></pre></td></tr></table></figure>

<p><code>ONBUILD</code>æŒ‡ä»¤åœ¨imageè¢«ç”¨ä½œå¦ä¸€ä¸ªæ„å»ºçš„åŸºç¡€æ—¶ï¼Œå‘imageæ·»åŠ è¦åœ¨ä»¥åæ‰§è¡Œçš„<em>trigger</em>æŒ‡ä»¤ã€‚triggerå°†åœ¨ä¸‹æ¸¸æ„å»ºçš„ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œï¼Œå°±å¥½åƒå®ƒå·²ç»åœ¨ä¸‹æ¸¸Dockerfileä¸­çš„1FROM1æŒ‡ä»¤ä¹‹åç«‹å³æ’å…¥ã€‚</p>
<p>ä»»ä½•æ„å»ºæŒ‡ä»¤éƒ½å¯ä»¥æ³¨å†Œä¸ºtriggerã€‚</p>
<p>å¦‚æœæ‚¨æ­£åœ¨æ„å»ºå°†ç”¨ä½œæ„å»ºå…¶ä»–imageçš„åŸºç¡€çš„å›¾åƒï¼Œä¾‹å¦‚åº”ç”¨ç¨‹åºæ„å»ºç¯å¢ƒæˆ–å¯ä»¥ä½¿ç”¨ç”¨æˆ·ç‰¹å®šé…ç½®è‡ªå®šä¹‰çš„åå°é©»ç•™ç¨‹åºï¼Œè¿™å°†éå¸¸æœ‰ç”¨ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨çš„imageæ˜¯å¯é‡ç”¨çš„Pythonåº”ç”¨ç¨‹åºæ„å»ºå™¨ï¼Œåˆ™éœ€è¦å°†åº”ç”¨ç¨‹åºæºä»£ç æ·»åŠ åˆ°ç‰¹å®šç›®å½•ä¸­ï¼Œå¹¶ä¸”å¯èƒ½éœ€è¦åœ¨æ­¤ä¹‹åè°ƒç”¨æ„å»ºè„šæœ¬ã€‚ä½ ä¸èƒ½åªæ˜¯è°ƒç”¨<code>ADD</code>å’Œ<code>RUN</code>ç°åœ¨ï¼Œå› ä¸ºä½ è¿˜æ²¡æœ‰è®¿é—®åº”ç”¨ç¨‹åºæºä»£ç ï¼Œå®ƒå°†æ˜¯ä¸åŒçš„æ¯ä¸ªåº”ç”¨ç¨‹åºæ„å»ºã€‚æ‚¨å¯ä»¥ç®€å•åœ°ä¸ºåº”ç”¨ç¨‹åºå¼€å‘äººå‘˜æä¾›ä¸€ä¸ªæ ·æ¿Dockerfileä»¥å°†å…¶å¤åˆ¶ç²˜è´´åˆ°å…¶åº”ç”¨ç¨‹åºä¸­ï¼Œä½†è¿™æ˜¯ä½æ•ˆï¼Œå®¹æ˜“å‡ºé”™ï¼Œå¹¶ä¸”å¾ˆéš¾æ›´æ–°ï¼Œå› ä¸ºå®ƒä¸åº”ç”¨ç¨‹åºç‰¹å®šçš„ä»£ç æ··åˆã€‚</p>
<p>è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨<code>ONBUILD</code>æ¥æ³¨å†Œæå‰æŒ‡ä»¤ï¼Œä»¥ä¾¿ç¨ååœ¨ä¸‹ä¸€ä¸ªæ„å»ºé˜¶æ®µè¿è¡Œã€‚</p>
<p>ä»¥ä¸‹æ˜¯å®ƒçš„å·¥ä½œåŸç†ï¼š</p>
<ol>
<li>å½“é‡åˆ°<code>ONBUILD</code>æŒ‡ä»¤æ—¶ï¼Œæ„å»ºå™¨ä¼šå‘æ­£åœ¨æ„å»ºçš„imageçš„å…ƒæ•°æ®æ·»åŠ triggerã€‚è¯¥æŒ‡ä»¤ä¸ä¼šå¦å¤–å½±å“å½“å‰æ„å»ºã€‚</li>
<li>åœ¨æ„å»ºç»“æŸæ—¶ï¼Œæ‰€æœ‰triggerçš„åˆ—è¡¨å­˜å‚¨åœ¨imageæ¸…å•ä¸­çš„OnBuildé”®ä¸‹ã€‚å¯ä»¥ä½¿ç”¨<code>docker inspect</code>å‘½ä»¤æ£€æŸ¥å®ƒä»¬ã€‚</li>
<li>ç¨åï¼Œå¯ä»¥ä½¿ç”¨<code>FROM</code>æŒ‡ä»¤å°†imageç”¨ä½œæ–°æ„å»ºçš„åŸºç¡€ã€‚ä½œä¸ºå¤„ç†<code>FROM</code>æŒ‡ä»¤çš„ä¸€éƒ¨åˆ†ï¼Œä¸‹æ¸¸æ„å»ºå™¨ä¼šæŸ¥æ‰¾<code>ONBUILD</code>triggersï¼Œå¹¶æŒ‰ç…§å®ƒä»¬æ³¨å†Œçš„é¡ºåºæ‰§è¡Œå®ƒä»¬ã€‚å¦‚æœä»»ä½•è§¦å‘å™¨å¤±è´¥ï¼Œåˆ™<code>FROM</code>æŒ‡ä»¤ä¸­æ­¢ï¼Œè¿™åˆå¯¼è‡´æ„å»ºå¤±è´¥ã€‚å¦‚æœæ‰€æœ‰è§¦å‘å™¨éƒ½æˆåŠŸï¼Œåˆ™<code>FROM</code>æŒ‡ä»¤å®Œæˆå¹¶ä¸”æ„å»ºå¦‚å¸¸ç»§ç»­ã€‚è§¦å‘å™¨åœ¨æ‰§è¡Œåä»æœ€ç»ˆimageä¸­æ¸…é™¤ã€‚æ¢å¥è¯è¯´ï¼Œå®ƒä»¬ä¸ä¼šè¢«â€œgrand-childrenâ€æ„å»ºç»§æ‰¿ã€‚ ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥æ·»åŠ å¦‚ä¸‹ï¼š <code>[...] ONBUILD ADD . /app/src ONBUILD RUN /usr/local/bin/python-build --dir /app/src [...]</code>&gt; <code>è­¦å‘Š</code>ï¼šä¸å…è®¸ä½¿ç”¨<code>ONBUILD ONBUILD</code>é“¾æ¥<code>ONBUILD</code>æŒ‡ä»¤ã€‚ &gt; <code>è­¦å‘Š</code>ï¼š<code>ONBUILD</code>æŒ‡ä»¤å¯èƒ½ä¸ä¼šè§¦å‘<code>FROM</code>æˆ–<code>MAINTAINER</code>æŒ‡ä»¤ã€‚</li>
</ol>
<h1 id="STOPSIGNAL"><a href="#STOPSIGNAL" class="headerlink" title="STOPSIGNAL"></a>STOPSIGNAL</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">STOPSIGNAL signal</span><br></pre></td></tr></table></figure>

<p><code>STOPSIGNAL</code>æŒ‡ä»¤è®¾ç½®å°†å‘é€åˆ°å®¹å™¨ä»¥é€€å‡ºçš„ç³»ç»Ÿè°ƒç”¨ä¿¡å·ã€‚è¯¥ä¿¡å·å¯ä»¥æ˜¯ä¸å†…æ ¸ç³»ç»Ÿè°ƒç”¨è¡¨ä¸­çš„ä½ç½®åŒ¹é…çš„æœ‰æ•ˆæ— ç¬¦å·æ•°ï¼Œä¾‹å¦‚9ï¼Œæˆ–è€…æ˜¯SIGNAMEæ ¼å¼çš„ä¿¡å·åç§°ï¼Œä¾‹å¦‚SIGKILL</p>
<h1 id="HEALTHCHECK"><a href="#HEALTHCHECK" class="headerlink" title="HEALTHCHECK"></a>HEALTHCHECK</h1><p>ä¸¤ç§å½¢å¼ï¼š</p>
<ul>
<li>HEALTHCHECK [OPTIONS] CMD command (é€šè¿‡åœ¨å®¹å™¨ä¸­è¿è¡Œå‘½ä»¤æ¥æ£€æŸ¥å®¹å™¨è¿è¡ŒçŠ¶å†µ)</li>
<li>HEALTHCHECK NONE (ç¦ç”¨ä»åŸºæœ¬æ˜ åƒç»§æ‰¿çš„ä»»ä½•è¿è¡ŒçŠ¶å†µæ£€æŸ¥)</li>
</ul>
<p><code>HEALTHCHECK</code>æŒ‡ä»¤å‘Šè¯‰Dockerå¦‚ä½•æµ‹è¯•å®¹å™¨ä»¥æ£€æŸ¥å®ƒæ˜¯å¦ä»åœ¨å·¥ä½œã€‚è¿™å¯ä»¥æ£€æµ‹åˆ°è¯¸å¦‚WebæœåŠ¡å™¨è¢«å¡åœ¨æ— é™å¾ªç¯ä¸­å¹¶ä¸”æ— æ³•å¤„ç†æ–°è¿æ¥çš„æƒ…å†µï¼Œå³ä½¿æœåŠ¡å™¨è¿›ç¨‹ä»åœ¨è¿è¡Œã€‚</p>
<p>å½“å®¹å™¨æŒ‡å®šäº†healthcheckæ—¶ï¼Œé™¤äº†å…¶æ­£å¸¸çŠ¶æ€å¤–ï¼Œå®ƒè¿˜å…·æœ‰å¥åº·çŠ¶æ€ã€‚æ­¤çŠ¶æ€æœ€åˆå¼€å§‹ã€‚ æ¯å½“å¥åº·æ£€æŸ¥é€šè¿‡ï¼Œå®ƒå˜å¾—å¥åº·ï¼ˆæ— è®ºä¹‹å‰çš„çŠ¶æ€ï¼‰ã€‚åœ¨ä¸€å®šæ•°é‡çš„è¿ç»­æ•…éšœåï¼Œå®ƒå˜å¾—ä¸å¥åº·ã€‚</p>
<p>åœ¨CMDä¹‹å‰å¯ä»¥å‡ºç°çš„é€‰é¡¹æœ‰ï¼š</p>
<ul>
<li><code>--interval=DURATION</code> (default: 30s)</li>
<li><code>--timeout=DURATION</code> (default: 30s)</li>
<li><code>--retries=N</code> (default: 3)</li>
</ul>
<p>è¿è¡ŒçŠ¶å†µæ£€æŸ¥å°†é¦–å…ˆåœ¨å®¹å™¨å¯åŠ¨åè¿è¡Œ<strong>interval</strong>ç§’ï¼Œç„¶ååœ¨æ¯æ¬¡ä¸Šæ¬¡æ£€æŸ¥å®Œæˆåå†æ¬¡è¿è¡Œ<strong>interval</strong>ç§’ã€‚</p>
<p>å¦‚æœæ£€æŸ¥çš„å•æ¬¡è¿è¡Œæ‰€èŠ±è´¹çš„æ—¶é—´è¶…è¿‡<strong>timeout</strong>ç§’æ•°ï¼Œåˆ™è¯¥æ£€æŸ¥è¢«è®¤ä¸ºå·²å¤±è´¥ã€‚</p>
<p>å®ƒéœ€è¦<strong>retries</strong>è¿ç»­çš„å¥åº·æ£€æŸ¥çš„æ•…éšœï¼Œå®¹å™¨è¢«è®¤ä¸ºæ˜¯ä¸å¥åº·çš„ã€‚</p>
<p>åœ¨Dockerfileä¸­åªèƒ½æœ‰ä¸€ä¸ª<code>HEALTHCHECK</code>æŒ‡ä»¤ã€‚å¦‚æœæ‚¨åˆ—å‡ºå¤šä¸ªï¼Œåˆ™åªæœ‰æœ€åä¸€ä¸ª<code>HEALTHCHECK</code>å°†ç”Ÿæ•ˆã€‚</p>
<p><code>CMD</code>å…³é”®å­—ä¹‹åçš„å‘½ä»¤å¯ä»¥æ˜¯shellå‘½ä»¤ï¼ˆä¾‹å¦‚<code>HEALTHCHECK CMD /bin/check-running</code>ï¼‰æˆ–execæ•°ç»„ï¼ˆå¦‚åŒå…¶ä»–Dockerfileå‘½ä»¤ä¸€æ ·;è¯¦æƒ…å‚è§<code>ENTRYPOINT</code>ï¼‰ã€‚</p>
<p>å‘½ä»¤çš„é€€å‡ºçŠ¶æ€è¡¨ç¤ºå®¹å™¨çš„è¿è¡ŒçŠ¶å†µã€‚ å¯èƒ½çš„å€¼ä¸ºï¼š</p>
<ul>
<li>0: success - the container is healthy and ready for use</li>
<li>1: unhealthy - the container is not working correctly</li>
<li>2: reserved - do not use this exit code</li>
</ul>
<p>ä¾‹å¦‚ï¼Œè¦æ¯äº”åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡WebæœåŠ¡å™¨èƒ½å¤Ÿåœ¨ä¸‰ç§’é’Ÿå†…ä¸ºç½‘ç«™çš„ä¸»é¡µæä¾›æœåŠ¡ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">HEALTHCHECK --interval&#x3D;5m --timeout&#x3D;3s \</span><br><span class="line">  CMD curl -f http:&#x2F;&#x2F;localhost&#x2F; || exit 1</span><br></pre></td></tr></table></figure>

<p>ä¸ºäº†å¸®åŠ©è°ƒè¯•å¤±è´¥çš„æ¢æµ‹å™¨ï¼Œå‘½ä»¤åœ¨stdoutæˆ–stderrä¸Šå†™å…¥çš„ä»»ä½•è¾“å‡ºæ–‡æœ¬ï¼ˆUTF-8ç¼–ç ï¼‰å°†å­˜å‚¨åœ¨è¿è¡ŒçŠ¶å†µçŠ¶æ€ï¼Œå¹¶å¯ä»¥ä½¿ç”¨<code>docker inspect</code>æŸ¥è¯¢ã€‚è¿™æ ·çš„è¾“å‡ºåº”è¯¥ä¿æŒçŸ­è·¯ï¼ˆåªå­˜å‚¨å½“å‰çš„4096ä¸ªå­—èŠ‚ï¼‰ã€‚</p>
<p>å½“å®¹å™¨çš„è¿è¡ŒçŠ¶å†µå‘ç”Ÿæ›´æ”¹æ—¶ï¼Œå°†ç”Ÿæˆå…·æœ‰æ–°çŠ¶æ€çš„<code>health_status</code>äº‹ä»¶ã€‚</p>
<p><code>HEALTHCHECK</code>åŠŸèƒ½åœ¨Docker 1.12ä¸­æ·»åŠ ã€‚</p>
<h1 id="SHELL"><a href="#SHELL" class="headerlink" title="SHELL"></a>SHELL</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">SHELL [&quot;executable&quot;, &quot;parameters&quot;]</span><br></pre></td></tr></table></figure>

<p><code>SHELL</code>æŒ‡ä»¤å…è®¸ç”¨äºå‘½ä»¤çš„shellå½¢å¼çš„é»˜è®¤shellè¢«è¦†ç›–ã€‚ Linuxä¸Šçš„é»˜è®¤shellæ˜¯<code>[&quot;/bin/sh&quot;,&quot;-c&quot;]</code>ï¼Œåœ¨Windowsä¸Šæ˜¯<code>[&quot;cmd&quot;,&quot;/S&quot;,&quot;/C&quot;]</code>ã€‚<code>SHELL</code>æŒ‡ä»¤å¿…é¡»ä»¥JSONæ ¼å¼å†™åœ¨Dockerfileä¸­ã€‚</p>
<p><code>SHELL</code>æŒ‡ä»¤åœ¨Windowsä¸Šç‰¹åˆ«æœ‰ç”¨ï¼Œå…¶ä¸­æœ‰ä¸¤ä¸ªå¸¸ç”¨çš„å’Œå®Œå…¨ä¸åŒçš„æœ¬æœºshellï¼š<code>cmd</code>å’Œ<code>powershell</code>ï¼Œä»¥åŠåŒ…æ‹¬<code>sh</code>çš„å¤‡ç”¨Shellã€‚</p>
<p><code>SHELL</code>æŒ‡ä»¤å¯ä»¥å¤šæ¬¡å‡ºç°ã€‚æ¯ä¸ª<code>SHELL</code>æŒ‡ä»¤è¦†ç›–æ‰€æœ‰å…ˆå‰çš„<code>SHELL</code>æŒ‡ä»¤ï¼Œå¹¶å½±å“æ‰€æœ‰åç»­æŒ‡ä»¤ã€‚ ä¾‹å¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">FROM windowsservercore</span><br><span class="line"></span><br><span class="line"># Executed as cmd &#x2F;S &#x2F;C echo default</span><br><span class="line">RUN echo default</span><br><span class="line"></span><br><span class="line"># Executed as cmd &#x2F;S &#x2F;C powershell -command Write-Host default</span><br><span class="line">RUN powershell -command Write-Host default</span><br><span class="line"></span><br><span class="line"># Executed as powershell -command Write-Host hello</span><br><span class="line">SHELL [&quot;powershell&quot;, &quot;-command&quot;]</span><br><span class="line">RUN Write-Host hello</span><br><span class="line"></span><br><span class="line"># Executed as cmd &#x2F;S &#x2F;C echo hello</span><br><span class="line">SHELL [&quot;cmd&quot;, &quot;&#x2F;S&quot;&quot;, &quot;&#x2F;C&quot;]</span><br><span class="line">RUN echo hello</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸‹æŒ‡ä»¤å¯èƒ½å—<code>SHELL</code>æŒ‡ä»¤çš„å½±å“ï¼Œå½“å®ƒä»¬çš„shellå½¢å¼ç”¨äºDockerfileï¼š<code>RUN</code>ï¼Œ<code>CMD</code>å’Œ<code>ENTRYPOINT</code>ã€‚</p>
<p>ä»¥ä¸‹ç¤ºä¾‹æ˜¯Windowsä¸Šçš„å¸¸è§æ¨¡å¼ï¼Œå¯ä»¥ä½¿ç”¨SHELLæŒ‡ä»¤è¿›è¡Œç®€åŒ–ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line">RUN powershell -command Execute-MyCmdlet -param1 &quot;c:\foo.txt&quot;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>dockerè°ƒç”¨çš„å‘½ä»¤å°†æ˜¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cmd &#x2F;S &#x2F;C powershell -command Execute-MyCmdlet -param1 &quot;c:\foo.txt&quot;</span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯ä½æ•ˆçš„ï¼Œæœ‰ä¸¤ä¸ªåŸå› ã€‚é¦–å…ˆï¼Œæœ‰ä¸€ä¸ªä¸å¿…è¦çš„cmd.exeå‘½ä»¤å¤„ç†å™¨ï¼ˆä¹Ÿç§°ä¸ºshellï¼‰è¢«è°ƒç”¨ã€‚å…¶æ¬¡ï¼Œshellä¸­çš„æ¯ä¸ª<code>RUN</code>æŒ‡ä»¤éƒ½éœ€è¦ä¸€ä¸ªé¢å¤–çš„<code>powershell -command</code>ã€‚</p>
<p>ä¸ºäº†æ›´æœ‰æ•ˆç‡ï¼Œå¯ä»¥é‡‡ç”¨ä¸¤ç§æœºåˆ¶ä¹‹ä¸€ã€‚ ä¸€ç§æ˜¯ä½¿ç”¨JSONå½¢å¼çš„RUNå‘½ä»¤ï¼Œå¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line">RUN [&quot;powershell&quot;, &quot;-command&quot;, &quot;Execute-MyCmdlet&quot;, &quot;-param1 \&quot;c:\\foo.txt\&quot;&quot;]</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>è™½ç„¶JSONå½¢å¼æ˜¯æ˜ç¡®çš„ï¼Œå¹¶ä¸”ä¸ä½¿ç”¨ä¸å¿…è¦çš„cmd.exeï¼Œä½†å®ƒéœ€è¦é€šè¿‡åŒå¼•å·å’Œè½¬ä¹‰æ›´è¯¦ç»†ã€‚ å¤‡ç”¨æœºåˆ¶æ˜¯ä½¿ç”¨<code>SHELL</code>æŒ‡ä»¤å’Œshellå½¢å¼ï¼Œä¸ºWindowsç”¨æˆ·æä¾›æ›´è‡ªç„¶çš„è¯­æ³•ï¼Œç‰¹åˆ«æ˜¯ä¸<code>escape</code> è§£ææŒ‡ä»¤ç»“åˆä½¿ç”¨æ—¶ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># escape&#x3D;&#96;</span><br><span class="line"></span><br><span class="line">FROM windowsservercore</span><br><span class="line">SHELL [&quot;powershell&quot;,&quot;-command&quot;]</span><br><span class="line">RUN New-Item -ItemType Directory C:\Example</span><br><span class="line">ADD Execute-MyCmdlet.ps1 c:\example\</span><br><span class="line">RUN c:\example\Execute-MyCmdlet -sample &#39;hello world&#39;</span><br></pre></td></tr></table></figure>

<p>ç»“æœæ˜¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">PS E:\docker\build\shell&gt; docker build -t shell .</span><br><span class="line">Sending build context to Docker daemon 3.584 kB</span><br><span class="line">Step 1 : FROM windowsservercore</span><br><span class="line"> ---&gt; 5bc36a335344</span><br><span class="line">Step 2 : SHELL powershell -command</span><br><span class="line"> ---&gt; Running in 87d7a64c9751</span><br><span class="line"> ---&gt; 4327358436c1</span><br><span class="line">Removing intermediate container 87d7a64c9751</span><br><span class="line">Step 3 : RUN New-Item -ItemType Directory C:\Example</span><br><span class="line"> ---&gt; Running in 3e6ba16b8df9</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Directory: C:\</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                LastWriteTime         Length Name</span><br><span class="line">----                -------------         ------ ----</span><br><span class="line">d-----         6&#x2F;2&#x2F;2016   2:59 PM                Example</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> ---&gt; 1f1dfdcec085</span><br><span class="line">Removing intermediate container 3e6ba16b8df9</span><br><span class="line">Step 4 : ADD Execute-MyCmdlet.ps1 c:\example\</span><br><span class="line"> ---&gt; 6770b4c17f29</span><br><span class="line">Removing intermediate container b139e34291dc</span><br><span class="line">Step 5 : RUN c:\example\Execute-MyCmdlet -sample &#39;hello world&#39;</span><br><span class="line"> ---&gt; Running in abdcf50dfd1f</span><br><span class="line">Hello from Execute-MyCmdlet.ps1 - passed hello world</span><br><span class="line"> ---&gt; ba0e25255fda</span><br><span class="line">Removing intermediate container abdcf50dfd1f</span><br><span class="line">Successfully built ba0e25255fda</span><br><span class="line">PS E:\docker\build\shell&gt;</span><br></pre></td></tr></table></figure>

<p><code>SHELL</code>æŒ‡ä»¤è¿˜å¯ä»¥ç”¨äºä¿®æ”¹å¤–å£³æ“ä½œçš„æ–¹å¼ã€‚ä¾‹å¦‚ï¼Œåœ¨Windowsä¸Šä½¿ç”¨<code>SHELL cmd /S /C /V:ON|OFF</code>ï¼Œå¯ä»¥ä¿®æ”¹å»¶è¿Ÿçš„ç¯å¢ƒå˜é‡æ‰©å±•è¯­ä¹‰ã€‚</p>
<p><code>SHELL</code>æŒ‡ä»¤ä¹Ÿå¯ä»¥åœ¨Linuxä¸Šä½¿ç”¨ï¼Œå¦‚æœéœ€è¦ä¸€ä¸ªæ›¿ä»£shellï¼Œå¦‚<code>zsh</code>ï¼Œ<code>csh</code>ï¼Œ<code>tcsh</code>å’Œå…¶ä»–ã€‚</p>
<p><code>SHELL</code>åŠŸèƒ½åœ¨Docker 1.12ä¸­æ·»åŠ </p>
]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>dockerfile</tag>
      </tags>
  </entry>
  <entry>
    <title>docker container å®¹å™¨ç®¡ç†</title>
    <url>/2017/04/16/docker-container%E5%AE%B9%E5%99%A8%E7%AE%A1%E7%90%86/</url>
    <content><![CDATA[<blockquote>
<ul>
<li>Docker ç®¡ç†å‘½ä»¤<ul>
<li><strong>å®¹å™¨ç®¡ç†</strong></li>
<li>é•œåƒç®¡ç†</li>
<li>ç½‘ç»œç®¡ç†</li>
<li>ç³»ç»Ÿç®¡ç†</li>
<li>æ•°æ®å·ç®¡ç†</li>
<li>å¿«ç…§ç®¡ç†</li>
<li>æ’ä»¶ç®¡ç†</li>
<li>å…¶ä»–</li>
<li>swarmkit ç®¡ç†<ul>
<li>æ¨¡å¼ç®¡ç†</li>
<li>èŠ‚ç‚¹ç®¡ç†</li>
<li>ç§˜é’¥ç®¡ç†</li>
<li>æœåŠ¡ç®¡ç†</li>
<li>æœåŠ¡æ ˆç®¡ç†</li>
</ul>
</li>
</ul>
</li>
</ul>
</blockquote>
<p>Docker çš„æ¯ä¸€çº§å‘½ä»¤éƒ½å¯ä»¥ä½¿ç”¨<code>--help</code> çš„å‚æ•°æ¥æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯</p>
<h1 id="Docker-ä¸€çº§å‘½ä»¤"><a href="#Docker-ä¸€çº§å‘½ä»¤" class="headerlink" title="Docker ä¸€çº§å‘½ä»¤"></a>Docker ä¸€çº§å‘½ä»¤</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker --help</span></span><br><span class="line"></span><br><span class="line">Usage:	docker COMMAND</span><br><span class="line"></span><br><span class="line">A self-sufficient runtime <span class="keyword">for</span> containers</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">      --config string      Location of client config files (default <span class="string">"/root/.docker"</span>)</span><br><span class="line">  -D, --debug              Enable debug mode</span><br><span class="line">      --<span class="built_in">help</span>               Print usage</span><br><span class="line">  -H, --host list          Daemon socket(s) to connect to (default [])</span><br><span class="line">  -l, --<span class="built_in">log</span>-level string   Set the logging level (<span class="string">"debug"</span>|<span class="string">"info"</span>|<span class="string">"warn"</span>|<span class="string">"error"</span>|<span class="string">"fatal"</span>) (default <span class="string">"info"</span>)</span><br><span class="line">      --tls                Use TLS; implied by --tlsverify</span><br><span class="line">      --tlscacert string   Trust certs signed only by this CA (default <span class="string">"/root/.docker/ca.pem"</span>)</span><br><span class="line">      --tlscert string     Path to TLS certificate file (default <span class="string">"/root/.docker/cert.pem"</span>)</span><br><span class="line">      --tlskey string      Path to TLS key file (default <span class="string">"/root/.docker/key.pem"</span>)</span><br><span class="line">      --tlsverify          Use TLS and verify the remote</span><br><span class="line">  -v, --version            Print version information and quit</span><br><span class="line"></span><br><span class="line">Management Commands:</span><br><span class="line">  container   Manage containers</span><br><span class="line">  image       Manage images</span><br><span class="line">  network     Manage networks</span><br><span class="line">  node        Manage Swarm nodes</span><br><span class="line">  plugin      Manage plugins</span><br><span class="line">  secret      Manage Docker secrets</span><br><span class="line">  service     Manage services</span><br><span class="line">  stack       Manage Docker stacks</span><br><span class="line">  swarm       Manage Swarm</span><br><span class="line">  system      Manage Docker</span><br><span class="line">  volume      Manage volumes</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line">  attach      Attach to a running container</span><br><span class="line">  build       Build an image from a Dockerfile</span><br><span class="line">  commit      Create a new image from a container<span class="string">'s changes</span></span><br><span class="line"><span class="string">  cp          Copy files/folders between a container and the local filesystem</span></span><br><span class="line"><span class="string">  create      Create a new container</span></span><br><span class="line"><span class="string">  diff        Inspect changes to files or directories on a container'</span>s filesystem</span><br><span class="line">  events      Get real time events from the server</span><br><span class="line">  <span class="built_in">exec</span>        Run a <span class="built_in">command</span> <span class="keyword">in</span> a running container</span><br><span class="line">  <span class="built_in">export</span>      Export a container<span class="string">'s filesystem as a tar archive</span></span><br><span class="line"><span class="string">  history     Show the history of an image</span></span><br><span class="line"><span class="string">  images      List images</span></span><br><span class="line"><span class="string">  import      Import the contents from a tarball to create a filesystem image</span></span><br><span class="line"><span class="string">  info        Display system-wide information</span></span><br><span class="line"><span class="string">  inspect     Return low-level information on Docker objects</span></span><br><span class="line"><span class="string">  kill        Kill one or more running containers</span></span><br><span class="line"><span class="string">  load        Load an image from a tar archive or STDIN</span></span><br><span class="line"><span class="string">  login       Log in to a Docker registry</span></span><br><span class="line"><span class="string">  logout      Log out from a Docker registry</span></span><br><span class="line"><span class="string">  logs        Fetch the logs of a container</span></span><br><span class="line"><span class="string">  pause       Pause all processes within one or more containers</span></span><br><span class="line"><span class="string">  port        List port mappings or a specific mapping for the container</span></span><br><span class="line"><span class="string">  ps          List containers</span></span><br><span class="line"><span class="string">  pull        Pull an image or a repository from a registry</span></span><br><span class="line"><span class="string">  push        Push an image or a repository to a registry</span></span><br><span class="line"><span class="string">  rename      Rename a container</span></span><br><span class="line"><span class="string">  restart     Restart one or more containers</span></span><br><span class="line"><span class="string">  rm          Remove one or more containers</span></span><br><span class="line"><span class="string">  rmi         Remove one or more images</span></span><br><span class="line"><span class="string">  run         Run a command in a new container</span></span><br><span class="line"><span class="string">  save        Save one or more images to a tar archive (streamed to STDOUT by default)</span></span><br><span class="line"><span class="string">  search      Search the Docker Hub for images</span></span><br><span class="line"><span class="string">  start       Start one or more stopped containers</span></span><br><span class="line"><span class="string">  stats       Display a live stream of container(s) resource usage statistics</span></span><br><span class="line"><span class="string">  stop        Stop one or more running containers</span></span><br><span class="line"><span class="string">  tag         Create a tag TARGET_IMAGE that refers to SOURCE_IMAGE</span></span><br><span class="line"><span class="string">  top         Display the running processes of a container</span></span><br><span class="line"><span class="string">  unpause     Unpause all processes within one or more containers</span></span><br><span class="line"><span class="string">  update      Update configuration of one or more containers</span></span><br><span class="line"><span class="string">  version     Show the Docker version information</span></span><br><span class="line"><span class="string">  wait        Block until one or more containers stop, then print their exit codes</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Run '</span>docker COMMAND --<span class="built_in">help</span><span class="string">' for more information on a command.</span></span><br></pre></td></tr></table></figure>

<p>åœ¨ Docker1.13ç‰ˆæœ¬ä¹‹å‰, æ˜¯æ²¡æœ‰äºŒçº§ç®¡ç†å‘½ä»¤çš„, éšç€ Docker çš„åŠŸèƒ½è¶Šæ¥è¶Šå¤š, å‘½ä»¤å‚æ•°ä¹Ÿè¶Šæ¥è¶Šå¤š, åˆ°1.13ç‰ˆæœ¬å, Docker ç»ˆäºå¯¹ä»–ä»¬åšå‡ºäº†å½’ç±», ä¹‹å‰çš„è¯­æ³•ä¹Ÿå…¼å®¹, ä½†æ˜¯ Docker æ¨èä½¿ç”¨æœ€æ–°çš„è¯­æ³•æ ¼å¼.</p>
<p>1.13ç‰ˆæœ¬å, Docker å¯¹å‘½ä»¤åšå‡ºäº†å¦‚ä¸‹å½’ç±»:</p>
<ul>
<li>container   Manage containers</li>
<li>image       Manage images</li>
<li>network     Manage networks</li>
<li>node        Manage Swarm nodes</li>
<li>plugin      Manage plugins</li>
<li>secret      Manage Docker secrets</li>
<li>service     Manage services</li>
<li>stack       Manage Docker stacks</li>
<li>swarm       Manage Swarm</li>
<li>system      Manage Docker</li>
<li>volume      Manage volumes</li>
</ul>
<h1 id="å®¹å™¨ç®¡ç†-container"><a href="#å®¹å™¨ç®¡ç†-container" class="headerlink" title="å®¹å™¨ç®¡ç† container"></a>å®¹å™¨ç®¡ç† container</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker container --help</span></span><br><span class="line"></span><br><span class="line">Usage:	docker container COMMAND</span><br><span class="line"></span><br><span class="line">Manage containers</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">      --<span class="built_in">help</span>   Print usage</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line">  attach      Attach to a running container</span><br><span class="line">  commit      Create a new image from a container<span class="string">'s changes</span></span><br><span class="line"><span class="string">  cp          Copy files/folders between a container and the local filesystem</span></span><br><span class="line"><span class="string">  create      Create a new container</span></span><br><span class="line"><span class="string">  diff        Inspect changes to files or directories on a container'</span>s filesystem</span><br><span class="line">  <span class="built_in">exec</span>        Run a <span class="built_in">command</span> <span class="keyword">in</span> a running container</span><br><span class="line">  <span class="built_in">export</span>      Export a container<span class="string">'s filesystem as a tar archive</span></span><br><span class="line"><span class="string">  inspect     Display detailed information on one or more containers</span></span><br><span class="line"><span class="string">  kill        Kill one or more running containers</span></span><br><span class="line"><span class="string">  logs        Fetch the logs of a container</span></span><br><span class="line"><span class="string">  ls          List containers</span></span><br><span class="line"><span class="string">  pause       Pause all processes within one or more containers</span></span><br><span class="line"><span class="string">  port        List port mappings or a specific mapping for the container</span></span><br><span class="line"><span class="string">  prune       Remove all stopped containers</span></span><br><span class="line"><span class="string">  rename      Rename a container</span></span><br><span class="line"><span class="string">  restart     Restart one or more containers</span></span><br><span class="line"><span class="string">  rm          Remove one or more containers</span></span><br><span class="line"><span class="string">  run         Run a command in a new container</span></span><br><span class="line"><span class="string">  start       Start one or more stopped containers</span></span><br><span class="line"><span class="string">  stats       Display a live stream of container(s) resource usage statistics</span></span><br><span class="line"><span class="string">  stop        Stop one or more running containers</span></span><br><span class="line"><span class="string">  top         Display the running processes of a container</span></span><br><span class="line"><span class="string">  unpause     Unpause all processes within one or more containers</span></span><br><span class="line"><span class="string">  update      Update configuration of one or more containers</span></span><br><span class="line"><span class="string">  wait        Block until one or more containers stop, then print their exit codes</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Run '</span>docker container COMMAND --<span class="built_in">help</span><span class="string">' for more information on a command.</span></span><br></pre></td></tr></table></figure>



<h2 id="attach"><a href="#attach" class="headerlink" title="attach"></a>attach</h2><p>è¿›å…¥å®¹å™¨çš„æ–¹å¼ä¹‹ä¸€, ç¿»è¯‘è¿‡æ¥å«â€é™„ç€â€åˆ°è¿è¡Œçš„å®¹å™¨ä¸­. ä»–ä¸<code>exec</code> æœ‰æœ¬è´¨çš„åŒºåˆ«, exec è¿›å…¥å®¹å™¨æ˜¯åœ¨ä¸»è¿›ç¨‹çš„åŸºç¡€ä¹‹ä¸Š, å†å¼€é€šä¸€ä¸ªè¿›ç¨‹å®ç°çš„è¿›å…¥å®¹å™¨. è€Œ attach åˆ™æ„å‘³ç€è¿›å…¥åˆ°å®¹å™¨çš„ä¸»è¿›ç¨‹ä¸­. äº§ç”Ÿçš„åæœä¹Ÿä¸ä¸€æ ·, ç”±äº attach è¿›å…¥åˆ°äº†ä¸»è¿›ç¨‹, ä¸€æ—¦ Ctrl+C é€€å‡ºç»ˆç«¯, å°†å¯¼è‡´ä¸»è¿›ç¨‹é€€å‡º, ä»è€Œå®¹å™¨ä¹Ÿéšä¹‹é€€å‡º. è€Œ exec çš„æ–¹å¼è¿›å…¥å®¹å™¨æ˜¯å•ç‹¬å¼€å¯äº†ä¸€ä¸ªè¿›ç¨‹, è¯¥è¿›ç¨‹çš„äº§ç”Ÿäºé”€æ¯å¹¶ä¸å½±å“ä¸»è¿›ç¨‹, æ‰€ä»¥ä¸ä¼šå› ä¸ºç»ˆç«¯çš„é€€å‡ºè€Œå¯¼è‡´å®¹å™¨é€€å‡º.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker run -d centos ping 123.57.233.243</span></span><br><span class="line">2ad157c779469961faabec0e836f7d2ab03a7e6193d932647e83626231fa0560</span><br><span class="line">root@ubuntu:~<span class="comment"># </span></span><br><span class="line">root@ubuntu:~<span class="comment"># docker container attach 2ad</span></span><br><span class="line">64 bytes from 123.57.233.243: icmp_seq=40 ttl=127 time=8.05 ms</span><br><span class="line">64 bytes from 123.57.233.243: icmp_seq=41 ttl=127 time=7.46 ms</span><br><span class="line">64 bytes from 123.57.233.243: icmp_seq=42 ttl=127 time=8.86 ms</span><br><span class="line">64 bytes from 123.57.233.243: icmp_seq=43 ttl=127 time=9.80 ms</span><br><span class="line">64 bytes from 123.57.233.243: icmp_seq=44 ttl=127 time=6.24 ms</span><br><span class="line">64 bytes from 123.57.233.243: icmp_seq=45 ttl=127 time=6.01 ms</span><br><span class="line">^C</span><br><span class="line">--- 123.57.233.243 ping statistics ---</span><br><span class="line">62 packets transmitted, 62 received, 0% packet loss, time 61130ms</span><br><span class="line">rtt min/avg/max/mdev = 5.407/18.181/204.154/32.140 ms</span><br><span class="line">root@ubuntu:~<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<h2 id="exec"><a href="#exec" class="headerlink" title="exec"></a>exec</h2><p>åœ¨ä¸€ä¸ªè¿è¡Œä¸­çš„å®¹å™¨å†…æ‰§è¡Œå‘½ä»¤. å°±å¦‚ä¸Šé¢æ‰€è¯´, ä½¿ç”¨ exec æ‰§è¡Œå‘½ä»¤æ„å‘³ç€åœ¨ä¸»è¿›ç¨‹çš„åŸºç¡€ä¹‹ä¸Š, å†å¯åŠ¨å…¶ä»–çš„è¿›ç¨‹, å…¶ä»–è¿›ç¨‹çš„å¯åŠ¨ä¸é”€æ¯ä¸ä¼šç›´æ¥å½±å“å®¹å™¨çš„é€€å‡º.</p>
<p>exec çš„ç”¨æ³•å¾ˆå¤š, ä½¿ç”¨é¢‘ç‡æœ€é«˜çš„æ˜¯è¿›å…¥å®¹å™¨çš„æ“ä½œ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker container exec -it b9704931408c /bin/bash</span></span><br><span class="line">root@b9704931408c:/<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>ä¹Ÿå¯ä»¥è¿è¡Œä»»ä½•bashå‘½ä»¤</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker container exec 11610baab1ce echo "haha"</span></span><br><span class="line">haha</span><br><span class="line">root@ubuntu:~<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                        NAMES</span><br><span class="line">b9704931408c        nginx               <span class="string">"nginx -g 'daemon ..."</span>   About an hour ago   Up About an hour    0.0.0.0:443-&gt;443/tcp, 0.0.0.0:8080-&gt;80/tcp   my-third-nginx</span><br><span class="line">d0a4936e940e        nginx               <span class="string">"nginx -g 'daemon ..."</span>   About an hour ago   Up About an hour    443/tcp, 0.0.0.0:8800-&gt;80/tcp                my-second-nginx</span><br><span class="line">11610baab1ce        nginx               <span class="string">"nginx -g 'daemon ..."</span>   About an hour ago   Up 12 minutes       80/tcp, 443/tcp                              my-first-nginx</span><br></pre></td></tr></table></figure>

<h2 id="commit"><a href="#commit" class="headerlink" title="commit"></a>commit</h2><p>åŸºäºä¸€ä¸ªç°æœ‰çš„å®¹å™¨åˆ›å»ºæ–°çš„é•œåƒ. commit å¤šç”¨åœ¨åšå®¹å™¨è¿ç§»çš„æ—¶å€™, å½“å®¹å™¨ä¸ºç”±çŠ¶æ€æ—¶, æˆ‘ä»¬éœ€è¦ä¿å­˜ç°æœ‰å®¹å™¨çš„æ‰€æœ‰è¿è¡ŒçŠ¶æ€ä»¥ä¿è¯è¿ç§»åçš„ä¸€è‡´æ€§, è¿™æ—¶ commit å°±æ´¾ä¸Šäº†ç”¨åœº.</p>
<p>è¿è¡Œä¸€ä¸ªåˆå§‹çš„é•œåƒ, æˆ‘ä»¬é€šè¿‡ exec è¿›å…¥åˆ°å®¹å™¨, å¹¶åšäº†ä¸€äº›ä¿®æ”¹, å½“éœ€è¦è¿ç§»æ­¤å®¹å™¨æ—¶, å¯ä»¥æŠŠå½“å‰ä¿®æ”¹è¿‡åçš„å®¹å™¨ä¿å­˜ä¸ºä¸€ä¸ªæ–°çš„é•œåƒ. ç„¶åå°†é•œåƒè¿ç§»è‡³æ–°ä¸»æœº, å† run èµ·æ¥.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä¿®æ”¹å®¹å™¨å†…å®¹</span></span><br><span class="line">root@ubuntu:~<span class="comment"># docker exec -it my-first-nginx /bin/bash</span></span><br><span class="line">root@11610baab1ce:/<span class="comment"># cd /tmp/</span></span><br><span class="line">root@11610baab1ce:/tmp<span class="comment"># ls</span></span><br><span class="line">root@11610baab1ce:/tmp<span class="comment"># echo "commit test" &gt; /tmp/c.txt</span></span><br><span class="line">root@11610baab1ce:/tmp<span class="comment"># ls</span></span><br><span class="line">c.txt</span><br><span class="line">root@11610baab1ce:/tmp<span class="comment"># cat /tmp/c.txt </span></span><br><span class="line">commit <span class="built_in">test</span></span><br><span class="line">root@11610baab1ce:/tmp<span class="comment"># exit</span></span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line"><span class="comment"># commit é•œåƒ</span></span><br><span class="line">root@ubuntu:~<span class="comment"># docker commit my-first-nginx nginx2:0.1</span></span><br><span class="line">sha256:7cb5220c81d58a56471b6ce69e40bf4d15f89652b4b4bd78ec4579b6473bfc91</span><br><span class="line">root@ubuntu:~<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">nginx2              0.1                 7cb5220c81d5        4 seconds ago       204MB</span><br><span class="line">centos              latest              a8493f5f50ff        35 hours ago        192MB</span><br><span class="line">nginx               latest              5766334bdaa0        39 hours ago        183MB</span><br><span class="line">hello-world         latest              48b5124b2768        2 months ago        1.84kB</span><br><span class="line"><span class="comment"># åŸºäºæ–°é•œåƒè¿è¡Œæ–°å®¹å™¨</span></span><br><span class="line">root@ubuntu:~<span class="comment"># docker exec -it new-first-nginx /bin/bash</span></span><br><span class="line">root@b4e6f8620ba3:/<span class="comment"># cd /tmp/</span></span><br><span class="line">root@b4e6f8620ba3:/tmp<span class="comment"># ls</span></span><br><span class="line">c.txt</span><br><span class="line">root@b4e6f8620ba3:/tmp<span class="comment"># cat c.txt </span></span><br><span class="line">commit <span class="built_in">test</span></span><br><span class="line">root@b4e6f8620ba3:/tmp<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>æ³¨æ„: æŒ‚è½½çš„æ•°æ®æ˜¯ä¸ä¼šè¢« commit åˆ°é•œåƒä¸­çš„. è¿ç§»ä¹‹åéœ€è¦ç”¨ç›¸åŒçš„å‚æ•°å¯åŠ¨èµ·æ¥</p>
<p>è¿ç§»æœ‰ä¸¤ç§æ–¹å¼:</p>
<ul>
<li>ä¸€ç§æ˜¯å¯¼å…¥å¯¼å‡ºçš„æ–¹å¼(é€šè¿‡ tar.gz æ–‡ä»¶)</li>
<li>ä¸€ç§æ˜¯é€šè¿‡ Registry çš„æ–¹å¼ push å’Œ pull</li>
</ul>
<p>å¦‚æœæ˜¯é€šè¿‡ Registry çš„æ–¹å¼çš„è¯, éœ€è¦åœ¨ commit æ—¶, é•œåƒåå­—ä¸­åŠ å…¥ Registry åœ°å€</p>
<p><code>docker container commit [OPTIONS] CONTAINER [REPOSITORY[:TAG]]</code></p>
<p>æ³¨æ„: commit çš„è¿‡ç¨‹ä¸­, å®¹å™¨å¤„äº pause çš„çŠ¶æ€, ç±»ä¼¼äº MySQL çš„æ’å®ƒé”</p>
<h2 id="cp"><a href="#cp" class="headerlink" title="cp"></a>cp</h2><p>é€šè¿‡ cp å‘½ä»¤å¯ä»¥æŠŠå®¹å™¨ä¸­çš„æ–‡ä»¶æ‹·è´åˆ°å®¿ä¸»æœº(æŠŠæ–‡ä»¶æ‹¿å‡ºæ¥)</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker container cp --help</span></span><br><span class="line"></span><br><span class="line">Usage:	docker container cp [OPTIONS] CONTAINER:SRC_PATH DEST_PATH|-</span><br><span class="line">	docker cp [OPTIONS] SRC_PATH|- CONTAINER:DEST_PATH</span><br><span class="line"></span><br><span class="line">Copy files/folders between a container and the <span class="built_in">local</span> filesystem</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -L, --follow-link   Always follow symbol link <span class="keyword">in</span> SRC_PATH</span><br><span class="line">      --<span class="built_in">help</span>          Print usage</span><br><span class="line">root@ubuntu:~<span class="comment"># docker container cp my-first-nginx:/tmp/c.txt ./</span></span><br><span class="line">root@ubuntu:~<span class="comment"># ls</span></span><br><span class="line">c.txt  web</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„: ä¸¤ç§æ‰§è¡Œæ–¹å¼çš„è¯­æ³•ä¸åŒ</p>
<h2 id="diff"><a href="#diff" class="headerlink" title="diff"></a>diff</h2><p>åˆ—å‡ºä¸åŸå§‹é•œåƒç›¸æ¯”,å®¹å™¨ä¸­å˜åŒ–çš„å†…å®¹.</p>
<ul>
<li>A: å¢åŠ </li>
<li>D: åˆ é™¤</li>
<li>C: ä¿®æ”¹</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker container diff  --help</span></span><br><span class="line"></span><br><span class="line">Usage:	docker container diff CONTAINER</span><br><span class="line"></span><br><span class="line">Inspect changes to files or directories on a container<span class="string">'s filesystem</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Options:</span></span><br><span class="line"><span class="string">      --help   Print usage</span></span><br><span class="line"><span class="string">root@ubuntu:~# docker container diff  my-second-nginx</span></span><br><span class="line"><span class="string">C /run</span></span><br><span class="line"><span class="string">A /run/nginx.pid</span></span><br><span class="line"><span class="string">C /var</span></span><br><span class="line"><span class="string">C /var/cache</span></span><br><span class="line"><span class="string">C /var/cache/nginx</span></span><br><span class="line"><span class="string">A /var/cache/nginx/client_temp</span></span><br><span class="line"><span class="string">A /var/cache/nginx/fastcgi_temp</span></span><br><span class="line"><span class="string">A /var/cache/nginx/proxy_temp</span></span><br><span class="line"><span class="string">A /var/cache/nginx/scgi_temp</span></span><br><span class="line"><span class="string">A /var/cache/nginx/uwsgi_temp</span></span><br></pre></td></tr></table></figure>

<h2 id="export-amp-import-save-amp-load"><a href="#export-amp-import-save-amp-load" class="headerlink" title="export&amp;import/save&amp;load"></a>export&amp;import/save&amp;load</h2><p>Docker çš„å¯¼å…¥å¯¼å‡º</p>
<p><a href="https://docs.lvrui.io/2017/02/19/dockerçš„å¯¼å…¥å¯¼å‡º/">https://docs.lvrui.io/2017/02/19/dockerçš„å¯¼å…¥å¯¼å‡º/</a></p>
<p>export&amp;import æ“ä½œçš„å¯¹è±¡æ˜¯å®¹å™¨, å¯¼å‡ºåˆ°ä¸€ä¸ªæ–°çš„é•œåƒ, è¯¥é•œåƒåªæœ‰ä¸€å±‚</p>
<p>save&amp;load æ“ä½œå¯¹è±¡æ˜¯é•œåƒ, åŸé•œåƒå±‚æ•°ä¿ç•™</p>
<p>å¦‚æœå¯¼å‡ºå®¹å™¨è¿˜éœ€è¦ä¿ç•™å±‚æ•°, é‚£å°±éœ€è¦ä½¿ç”¨ commit+save+load é»„é‡‘ç»„åˆå•¦</p>
<h2 id="inspect"><a href="#inspect" class="headerlink" title="inspect"></a>inspect</h2><p>æŸ¥çœ‹å®¹å™¨è¯¦ç»†ä¿¡æ¯</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker container inspect my-third-nginx</span></span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">"Id"</span>: <span class="string">"b9704931408c6d054bc9c510878e10467a71d412bef065afa7414403982001b6"</span>,</span><br><span class="line">        <span class="string">"Created"</span>: <span class="string">"2017-04-08T06:22:29.186834559Z"</span>,</span><br><span class="line">        <span class="string">"Path"</span>: <span class="string">"nginx"</span>,</span><br><span class="line">        <span class="string">"Args"</span>: [</span><br><span class="line">            <span class="string">"-g"</span>,</span><br><span class="line">            <span class="string">"daemon off;"</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="string">"State"</span>: &#123;</span><br><span class="line">            <span class="string">"Status"</span>: <span class="string">"running"</span>,</span><br><span class="line">            <span class="string">"Running"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="string">"Paused"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"Restarting"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"OOMKilled"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"Dead"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"Pid"</span>: 2648,</span><br><span class="line">            <span class="string">"ExitCode"</span>: 0,</span><br><span class="line">            <span class="string">"Error"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"StartedAt"</span>: <span class="string">"2017-04-08T06:22:29.555131293Z"</span>,</span><br><span class="line">            <span class="string">"FinishedAt"</span>: <span class="string">"0001-01-01T00:00:00Z"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"Image"</span>: <span class="string">"sha256:5766334bdaa0bc37f1f0c02cb94c351f9b076bcffa042d6ce811b0fd9bc31f3b"</span>,</span><br><span class="line">        <span class="string">"ResolvConfPath"</span>: <span class="string">"/var/lib/docker/containers/b9704931408c6d054bc9c510878e10467a71d412bef065afa7414403982001b6/resolv.conf"</span>,</span><br><span class="line">        <span class="string">"HostnamePath"</span>: <span class="string">"/var/lib/docker/containers/b9704931408c6d054bc9c510878e10467a71d412bef065afa7414403982001b6/hostname"</span>,</span><br><span class="line">        <span class="string">"HostsPath"</span>: <span class="string">"/var/lib/docker/containers/b9704931408c6d054bc9c510878e10467a71d412bef065afa7414403982001b6/hosts"</span>,</span><br><span class="line">        <span class="string">"LogPath"</span>: <span class="string">"/var/lib/docker/containers/b9704931408c6d054bc9c510878e10467a71d412bef065afa7414403982001b6/b9704931408c6d054bc9c510878e10467a71d412bef065afa7414403982001b6-json.log"</span>,</span><br><span class="line">        <span class="string">"Name"</span>: <span class="string">"/my-third-nginx"</span>,</span><br><span class="line">        <span class="string">"RestartCount"</span>: 0,</span><br><span class="line">        <span class="string">"Driver"</span>: <span class="string">"aufs"</span>,</span><br><span class="line">        <span class="string">"MountLabel"</span>: <span class="string">""</span>,</span><br><span class="line">        <span class="string">"ProcessLabel"</span>: <span class="string">""</span>,</span><br><span class="line">        <span class="string">"AppArmorProfile"</span>: <span class="string">"docker-default"</span>,</span><br><span class="line">        <span class="string">"ExecIDs"</span>: null,</span><br><span class="line">        <span class="string">"HostConfig"</span>: &#123;</span><br><span class="line">            <span class="string">"Binds"</span>: [</span><br><span class="line">                <span class="string">"/root/web:/usr/share/nginx/html:ro"</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="string">"ContainerIDFile"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"LogConfig"</span>: &#123;</span><br><span class="line">                <span class="string">"Type"</span>: <span class="string">"json-file"</span>,</span><br><span class="line">                <span class="string">"Config"</span>: &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">"NetworkMode"</span>: <span class="string">"default"</span>,</span><br><span class="line">            <span class="string">"PortBindings"</span>: &#123;</span><br><span class="line">                <span class="string">"443/tcp"</span>: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="string">"HostIp"</span>: <span class="string">""</span>,</span><br><span class="line">                        <span class="string">"HostPort"</span>: <span class="string">"443"</span></span><br><span class="line">                    &#125;</span><br><span class="line">                ],</span><br><span class="line">                <span class="string">"80/tcp"</span>: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="string">"HostIp"</span>: <span class="string">""</span>,</span><br><span class="line">                        <span class="string">"HostPort"</span>: <span class="string">"8080"</span></span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">"RestartPolicy"</span>: &#123;</span><br><span class="line">                <span class="string">"Name"</span>: <span class="string">"no"</span>,</span><br><span class="line">                <span class="string">"MaximumRetryCount"</span>: 0</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">"AutoRemove"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"VolumeDriver"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"VolumesFrom"</span>: null,</span><br><span class="line">            <span class="string">"CapAdd"</span>: null,</span><br><span class="line">            <span class="string">"CapDrop"</span>: null,</span><br><span class="line">            <span class="string">"Dns"</span>: [],</span><br><span class="line">            <span class="string">"DnsOptions"</span>: [],</span><br><span class="line">            <span class="string">"DnsSearch"</span>: [],</span><br><span class="line">            <span class="string">"ExtraHosts"</span>: null,</span><br><span class="line">            <span class="string">"GroupAdd"</span>: null,</span><br><span class="line">            <span class="string">"IpcMode"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"Cgroup"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"Links"</span>: null,</span><br><span class="line">            <span class="string">"OomScoreAdj"</span>: 0,</span><br><span class="line">            <span class="string">"PidMode"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"Privileged"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"PublishAllPorts"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"ReadonlyRootfs"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"SecurityOpt"</span>: null,</span><br><span class="line">            <span class="string">"UTSMode"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"UsernsMode"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"ShmSize"</span>: 67108864,</span><br><span class="line">            <span class="string">"Runtime"</span>: <span class="string">"runc"</span>,</span><br><span class="line">            <span class="string">"ConsoleSize"</span>: [</span><br><span class="line">                0,</span><br><span class="line">                0</span><br><span class="line">            ],</span><br><span class="line">            <span class="string">"Isolation"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"CpuShares"</span>: 0,</span><br><span class="line">            <span class="string">"Memory"</span>: 0,</span><br><span class="line">            <span class="string">"NanoCpus"</span>: 0,</span><br><span class="line">            <span class="string">"CgroupParent"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"BlkioWeight"</span>: 0,</span><br><span class="line">            <span class="string">"BlkioWeightDevice"</span>: null,</span><br><span class="line">            <span class="string">"BlkioDeviceReadBps"</span>: null,</span><br><span class="line">            <span class="string">"BlkioDeviceWriteBps"</span>: null,</span><br><span class="line">            <span class="string">"BlkioDeviceReadIOps"</span>: null,</span><br><span class="line">            <span class="string">"BlkioDeviceWriteIOps"</span>: null,</span><br><span class="line">            <span class="string">"CpuPeriod"</span>: 0,</span><br><span class="line">            <span class="string">"CpuQuota"</span>: 0,</span><br><span class="line">            <span class="string">"CpuRealtimePeriod"</span>: 0,</span><br><span class="line">            <span class="string">"CpuRealtimeRuntime"</span>: 0,</span><br><span class="line">            <span class="string">"CpusetCpus"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"CpusetMems"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"Devices"</span>: [],</span><br><span class="line">            <span class="string">"DeviceCgroupRules"</span>: null,</span><br><span class="line">            <span class="string">"DiskQuota"</span>: 0,</span><br><span class="line">            <span class="string">"KernelMemory"</span>: 0,</span><br><span class="line">            <span class="string">"MemoryReservation"</span>: 0,</span><br><span class="line">            <span class="string">"MemorySwap"</span>: 0,</span><br><span class="line">            <span class="string">"MemorySwappiness"</span>: -1,</span><br><span class="line">            <span class="string">"OomKillDisable"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"PidsLimit"</span>: 0,</span><br><span class="line">            <span class="string">"Ulimits"</span>: null,</span><br><span class="line">            <span class="string">"CpuCount"</span>: 0,</span><br><span class="line">            <span class="string">"CpuPercent"</span>: 0,</span><br><span class="line">            <span class="string">"IOMaximumIOps"</span>: 0,</span><br><span class="line">            <span class="string">"IOMaximumBandwidth"</span>: 0</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"GraphDriver"</span>: &#123;</span><br><span class="line">            <span class="string">"Data"</span>: null,</span><br><span class="line">            <span class="string">"Name"</span>: <span class="string">"aufs"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"Mounts"</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">"Type"</span>: <span class="string">"bind"</span>,</span><br><span class="line">                <span class="string">"Source"</span>: <span class="string">"/root/web"</span>,</span><br><span class="line">                <span class="string">"Destination"</span>: <span class="string">"/usr/share/nginx/html"</span>,</span><br><span class="line">                <span class="string">"Mode"</span>: <span class="string">"ro"</span>,</span><br><span class="line">                <span class="string">"RW"</span>: <span class="literal">false</span>,</span><br><span class="line">                <span class="string">"Propagation"</span>: <span class="string">""</span></span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="string">"Config"</span>: &#123;</span><br><span class="line">            <span class="string">"Hostname"</span>: <span class="string">"b9704931408c"</span>,</span><br><span class="line">            <span class="string">"Domainname"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"User"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"AttachStdin"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"AttachStdout"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"AttachStderr"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"ExposedPorts"</span>: &#123;</span><br><span class="line">                <span class="string">"443/tcp"</span>: &#123;&#125;,</span><br><span class="line">                <span class="string">"80/tcp"</span>: &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">"Tty"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"OpenStdin"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"StdinOnce"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"Env"</span>: [</span><br><span class="line">                <span class="string">"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"</span>,</span><br><span class="line">                <span class="string">"NGINX_VERSION=1.11.13-1~jessie"</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="string">"Cmd"</span>: [</span><br><span class="line">                <span class="string">"nginx"</span>,</span><br><span class="line">                <span class="string">"-g"</span>,</span><br><span class="line">                <span class="string">"daemon off;"</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="string">"ArgsEscaped"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="string">"Image"</span>: <span class="string">"nginx"</span>,</span><br><span class="line">            <span class="string">"Volumes"</span>: null,</span><br><span class="line">            <span class="string">"WorkingDir"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"Entrypoint"</span>: null,</span><br><span class="line">            <span class="string">"OnBuild"</span>: null,</span><br><span class="line">            <span class="string">"Labels"</span>: &#123;&#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"NetworkSettings"</span>: &#123;</span><br><span class="line">            <span class="string">"Bridge"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"SandboxID"</span>: <span class="string">"916a8bef0178b4e8e2ff1c246a9e04c85686b8ddf8493946de7103577ff8158b"</span>,</span><br><span class="line">            <span class="string">"HairpinMode"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"LinkLocalIPv6Address"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"LinkLocalIPv6PrefixLen"</span>: 0,</span><br><span class="line">            <span class="string">"Ports"</span>: &#123;</span><br><span class="line">                <span class="string">"443/tcp"</span>: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="string">"HostIp"</span>: <span class="string">"0.0.0.0"</span>,</span><br><span class="line">                        <span class="string">"HostPort"</span>: <span class="string">"443"</span></span><br><span class="line">                    &#125;</span><br><span class="line">                ],</span><br><span class="line">                <span class="string">"80/tcp"</span>: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="string">"HostIp"</span>: <span class="string">"0.0.0.0"</span>,</span><br><span class="line">                        <span class="string">"HostPort"</span>: <span class="string">"8080"</span></span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">"SandboxKey"</span>: <span class="string">"/var/run/docker/netns/916a8bef0178"</span>,</span><br><span class="line">            <span class="string">"SecondaryIPAddresses"</span>: null,</span><br><span class="line">            <span class="string">"SecondaryIPv6Addresses"</span>: null,</span><br><span class="line">            <span class="string">"EndpointID"</span>: <span class="string">"7a9c71aae5980ccd513c1e7a4e8cefaf56a87e1d796669bbfb70ffc728d1e0bb"</span>,</span><br><span class="line">            <span class="string">"Gateway"</span>: <span class="string">"172.17.0.1"</span>,</span><br><span class="line">            <span class="string">"GlobalIPv6Address"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"GlobalIPv6PrefixLen"</span>: 0,</span><br><span class="line">            <span class="string">"IPAddress"</span>: <span class="string">"172.17.0.4"</span>,</span><br><span class="line">            <span class="string">"IPPrefixLen"</span>: 16,</span><br><span class="line">            <span class="string">"IPv6Gateway"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"MacAddress"</span>: <span class="string">"02:42:ac:11:00:04"</span>,</span><br><span class="line">            <span class="string">"Networks"</span>: &#123;</span><br><span class="line">                <span class="string">"bridge"</span>: &#123;</span><br><span class="line">                    <span class="string">"IPAMConfig"</span>: null,</span><br><span class="line">                    <span class="string">"Links"</span>: null,</span><br><span class="line">                    <span class="string">"Aliases"</span>: null,</span><br><span class="line">                    <span class="string">"NetworkID"</span>: <span class="string">"26d72edf89c3ae77e1de636d4357b819a12c24ae64ab0da4d9b2d43610c44f24"</span>,</span><br><span class="line">                    <span class="string">"EndpointID"</span>: <span class="string">"7a9c71aae5980ccd513c1e7a4e8cefaf56a87e1d796669bbfb70ffc728d1e0bb"</span>,</span><br><span class="line">                    <span class="string">"Gateway"</span>: <span class="string">"172.17.0.1"</span>,</span><br><span class="line">                    <span class="string">"IPAddress"</span>: <span class="string">"172.17.0.4"</span>,</span><br><span class="line">                    <span class="string">"IPPrefixLen"</span>: 16,</span><br><span class="line">                    <span class="string">"IPv6Gateway"</span>: <span class="string">""</span>,</span><br><span class="line">                    <span class="string">"GlobalIPv6Address"</span>: <span class="string">""</span>,</span><br><span class="line">                    <span class="string">"GlobalIPv6PrefixLen"</span>: 0,</span><br><span class="line">                    <span class="string">"MacAddress"</span>: <span class="string">"02:42:ac:11:00:04"</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h2 id="ls-ps-list"><a href="#ls-ps-list" class="headerlink" title="ls/ps/list"></a>ls/ps/list</h2><p>æŸ¥çœ‹ container åˆ—è¡¨</p>
<ul>
<li>docker ps</li>
<li>docker container ls</li>
<li>docker container list</li>
</ul>
<p>ä»¥ä¸Šä¸‰æ¡å‘½ä»¤çš„ç”¨æ³•å’Œä½œç”¨éƒ½æ˜¯ä¸€æ ·çš„, ä¹‹é—´åšäº†åˆ«å</p>
<p>æœ€å®ç”¨çš„å‚æ•°<code>-s</code> å¯ä»¥æ˜¾ç¤ºå‡ºå®¹å™¨å ç”¨ç©ºé—´å¤§å°, æ‹¬å·ä¸­çš„æ˜¯é•œåƒå¤§å°, å‰é¢æ˜¯å¯å†™å±‚(å®¹å™¨)å¤§å°</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker container list -s</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                        NAMES               SIZE</span><br><span class="line">b4e6f8620ba3        nginx2:0.1          <span class="string">"nginx -g 'daemon ..."</span>   29 minutes ago      Up 29 minutes       80/tcp, 443/tcp                              new-first-nginx     413B (virtual 204MB)</span><br><span class="line">b9704931408c        nginx               <span class="string">"nginx -g 'daemon ..."</span>   2 hours ago         Up 2 hours          0.0.0.0:443-&gt;443/tcp, 0.0.0.0:8080-&gt;80/tcp   my-third-nginx      7B (virtual 183MB)</span><br><span class="line">d0a4936e940e        nginx               <span class="string">"nginx -g 'daemon ..."</span>   2 hours ago         Up 2 hours          443/tcp, 0.0.0.0:8800-&gt;80/tcp                my-second-nginx     2B (virtual 183MB)</span><br><span class="line">11610baab1ce        nginx               <span class="string">"nginx -g 'daemon ..."</span>   2 hours ago         Up About an hour    80/tcp, 443/tcp                              my-first-nginx      21.3MB (virtual 204MB)</span><br><span class="line">root@ubuntu:~<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<h2 id="logs"><a href="#logs" class="headerlink" title="logs"></a>logs</h2><p>æŸ¥çœ‹å®¹å™¨çš„å‰å°å›æ˜¾æ—¥å¿—. ç”±äºå®¹å™¨å¿…é¡»ä»¥é˜»å¡å‰å°çš„æ–¹å¼è¿è¡Œ, é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ logs å‘½ä»¤æ¥æŸ¥çœ‹å®¹å™¨å‰å°çš„å›æ˜¾(åœ¨é»˜è®¤æ˜¯ json-file æ—¥å¿—å¼•æ“ä¸‹)</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker run -d centos ping 123.57.233.243</span></span><br><span class="line">791a4ad7ffa83f81a78e2bba1a5d5366a099be443beb19f66ee0d51e83cd020d</span><br><span class="line">root@ubuntu:~<span class="comment"># </span></span><br><span class="line">root@ubuntu:~<span class="comment"># </span></span><br><span class="line">root@ubuntu:~<span class="comment"># docker logs -f 791a4ad7ffa8</span></span><br><span class="line">PING 123.57.233.243 (123.57.233.243) 56(84) bytes of data.</span><br><span class="line">64 bytes from 123.57.233.243: icmp_seq=1 ttl=127 time=7.89 ms</span><br><span class="line">64 bytes from 123.57.233.243: icmp_seq=2 ttl=127 time=6.66 ms</span><br><span class="line">64 bytes from 123.57.233.243: icmp_seq=3 ttl=127 time=6.55 ms</span><br><span class="line">64 bytes from 123.57.233.243: icmp_seq=4 ttl=127 time=6.46 ms</span><br><span class="line">64 bytes from 123.57.233.243: icmp_seq=5 ttl=127 time=175 ms</span><br><span class="line">64 bytes from 123.57.233.243: icmp_seq=6 ttl=127 time=267 ms</span><br></pre></td></tr></table></figure>

<h2 id="kill-start-stop-restart-rm-pause-unpause-prune"><a href="#kill-start-stop-restart-rm-pause-unpause-prune" class="headerlink" title="kill/start/stop/restart/rm/pause/unpause/prune"></a>kill/start/stop/restart/rm/pause/unpause/prune</h2><ul>
<li>kill ç»™å®¹å™¨å‘é€ kill ä¿¡å·, éæ­£å¸¸é€€å‡ºå®¹å™¨</li>
<li>start å¯åŠ¨é€€å‡ºçŠ¶æ€çš„å®¹å™¨</li>
<li>stop é€€å‡ºè¿è¡ŒçŠ¶æ€çš„å®¹å™¨</li>
<li>restart é‡å¯å®¹å™¨</li>
<li>rm åˆ é™¤é€€å‡ºçŠ¶æ€çš„å®¹å™¨</li>
<li>pause æš‚åœè¿è¡Œä¸­çš„å®¹å™¨(å¤„äºé˜»å¡çŠ¶æ€)</li>
<li>unpause æ¢å¤æš‚åœçš„å®¹å™¨è‡³è¿è¡ŒçŠ¶æ€</li>
<li>prune åˆ é™¤æ‰€æœ‰ stopped çŠ¶æ€çš„å®¹å™¨(1.13çš„æ–°ç‰¹æ€§, æ•‘ä¸–ä¸»!)</li>
</ul>
<h2 id="port"><a href="#port" class="headerlink" title="port"></a>port</h2><p>æŸ¥çœ‹ç«¯å£çš„æ˜ å°„å…³ç³»</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker container port my-third-nginx</span></span><br><span class="line">443/tcp -&gt; 0.0.0.0:443</span><br><span class="line">80/tcp -&gt; 0.0.0.0:8080</span><br><span class="line">root@ubuntu:~<span class="comment"># docker container port my-second-nginx</span></span><br><span class="line">80/tcp -&gt; 0.0.0.0:8800</span><br><span class="line">root@ubuntu:~<span class="comment"># docker container port my-first-nginx</span></span><br><span class="line">root@ubuntu:~<span class="comment"># docker container port my-second-nginx 80/tcp</span></span><br><span class="line">0.0.0.0:8800</span><br></pre></td></tr></table></figure>

<h2 id="rename"><a href="#rename" class="headerlink" title="rename"></a>rename</h2><p>æ›´æ”¹å®¹å™¨åç§°</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                        NAMES</span><br><span class="line">b4e6f8620ba3        nginx2:0.1          <span class="string">"nginx -g 'daemon ..."</span>   About an hour ago   Up About an hour    80/tcp, 443/tcp                              new-first-nginx</span><br><span class="line">b9704931408c        nginx               <span class="string">"nginx -g 'daemon ..."</span>   2 hours ago         Up 2 hours          0.0.0.0:443-&gt;443/tcp, 0.0.0.0:8080-&gt;80/tcp   my-third-nginx</span><br><span class="line">d0a4936e940e        nginx               <span class="string">"nginx -g 'daemon ..."</span>   2 hours ago         Up 2 hours          443/tcp, 0.0.0.0:8800-&gt;80/tcp                my-second-nginx</span><br><span class="line">11610baab1ce        nginx               <span class="string">"nginx -g 'daemon ..."</span>   2 hours ago         Up About an hour    80/tcp, 443/tcp                              my-first-nginx</span><br><span class="line">root@ubuntu:~<span class="comment"># docker container rename --help</span></span><br><span class="line"></span><br><span class="line">Usage:	docker container rename CONTAINER NEW_NAME</span><br><span class="line"></span><br><span class="line">Rename a container</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">      --<span class="built_in">help</span>   Print usage</span><br><span class="line">root@ubuntu:~<span class="comment"># docker container rename new-first-nginx new-first-nginx2</span></span><br><span class="line">root@ubuntu:~<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                        NAMES</span><br><span class="line">b4e6f8620ba3        nginx2:0.1          <span class="string">"nginx -g 'daemon ..."</span>   About an hour ago   Up About an hour    80/tcp, 443/tcp                              new-first-nginx2</span><br><span class="line">b9704931408c        nginx               <span class="string">"nginx -g 'daemon ..."</span>   2 hours ago         Up 2 hours          0.0.0.0:443-&gt;443/tcp, 0.0.0.0:8080-&gt;80/tcp   my-third-nginx</span><br><span class="line">d0a4936e940e        nginx               <span class="string">"nginx -g 'daemon ..."</span>   2 hours ago         Up 2 hours          443/tcp, 0.0.0.0:8800-&gt;80/tcp                my-second-nginx</span><br><span class="line">11610baab1ce        nginx               <span class="string">"nginx -g 'daemon ..."</span>   2 hours ago         Up About an hour    80/tcp, 443/tcp                              my-first-nginx</span><br><span class="line">root@ubuntu:~<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<h2 id="stats"><a href="#stats" class="headerlink" title="stats"></a>stats</h2><p>å®æ—¶æŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨çŠ¶å†µ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker container stats </span></span><br><span class="line">CONTAINER           CPU %               MEM USAGE / LIMIT     MEM %               NET I/O             BLOCK I/O           PIDS</span><br><span class="line">b4e6f8620ba3        0.00%               1.457MiB / 975.1MiB   0.15%               690B / 0B           0B / 4.1kB          2</span><br><span class="line">b9704931408c        0.00%               1.449MiB / 975.1MiB   0.15%               732B / 0B           0B / 0B             2</span><br><span class="line">d0a4936e940e        0.00%               1.512MiB / 975.1MiB   0.16%               1.36kB / 671B       0B / 0B             2</span><br><span class="line">11610baab1ce        0.00%               1.465MiB / 975.1MiB   0.15%               732B / 0B           0B / 0B             2</span><br></pre></td></tr></table></figure>

<h2 id="top"><a href="#top" class="headerlink" title="top"></a>top</h2><p>æŸ¥çœ‹å®¹å™¨çš„è¿›ç¨‹ä¿¡æ¯</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker container top --help</span></span><br><span class="line"></span><br><span class="line">Usage:	docker container top CONTAINER [ps OPTIONS]</span><br><span class="line"></span><br><span class="line">Display the running processes of a container</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">      --<span class="built_in">help</span>   Print usage</span><br><span class="line">root@ubuntu:~<span class="comment"># docker container top my-third-nginx</span></span><br><span class="line">UID                 PID                 PPID                C                   STIME               TTY                 TIME                CMD</span><br><span class="line">root                2648                2631                0                   Apr07               ?                   00:00:00            nginx: master process nginx -g daemon off;</span><br><span class="line">syslog              2669                2648                0                   Apr07               ?                   00:00:00            nginx: worker process</span><br></pre></td></tr></table></figure>

<h2 id="update"><a href="#update" class="headerlink" title="update"></a>update</h2><p>è°ƒæ•´åˆ†é…ç»™å®¹å™¨çš„è®¡ç®—èµ„æº, å¯ä»¥æ›´æ”¹è¯¥å®¹å™¨å¯ä»¥ä½¿ç”¨çš„ CPU è®¡ç®—èµ„æºä¸å†…å­˜èµ„æºç­‰</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker container update --help</span></span><br><span class="line"></span><br><span class="line">Usage:	docker container update [OPTIONS] CONTAINER [CONTAINER...]</span><br><span class="line"></span><br><span class="line">Update configuration of one or more containers</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">      --blkio-weight uint16        Block IO (relative weight), between 10 and 1000, or 0 to <span class="built_in">disable</span> (default 0)</span><br><span class="line">      --cpu-period int             Limit CPU CFS (Completely Fair Scheduler) period</span><br><span class="line">      --cpu-quota int              Limit CPU CFS (Completely Fair Scheduler) quota</span><br><span class="line">      --cpu-rt-period int          Limit the CPU real-time period <span class="keyword">in</span> microseconds</span><br><span class="line">      --cpu-rt-runtime int         Limit the CPU real-time runtime <span class="keyword">in</span> microseconds</span><br><span class="line">  -c, --cpu-shares int             CPU shares (relative weight)</span><br><span class="line">      --cpuset-cpus string         CPUs <span class="keyword">in</span> <span class="built_in">which</span> to allow execution (0-3, 0,1)</span><br><span class="line">      --cpuset-mems string         MEMs <span class="keyword">in</span> <span class="built_in">which</span> to allow execution (0-3, 0,1)</span><br><span class="line">      --<span class="built_in">help</span>                       Print usage</span><br><span class="line">      --kernel-memory bytes        Kernel memory <span class="built_in">limit</span></span><br><span class="line">  -m, --memory bytes               Memory <span class="built_in">limit</span></span><br><span class="line">      --memory-reservation bytes   Memory soft <span class="built_in">limit</span></span><br><span class="line">      --memory-swap bytes          Swap <span class="built_in">limit</span> equal to memory plus swap: <span class="string">'-1'</span> to <span class="built_in">enable</span> unlimited swap</span><br><span class="line">      --restart string             Restart policy to apply when a container exits</span><br></pre></td></tr></table></figure>

<h2 id="wait"><a href="#wait" class="headerlink" title="wait"></a>wait</h2><p>é˜»å¡å®¹å™¨çš„è¿è¡Œç›´åˆ°åœæ­¢ä¸ºæ­¢, ç„¶åæ‰“å°è¯¥å®¹å™¨çš„é€€å‡ºçŠ¶æ€ç </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç»ˆç«¯1</span></span><br><span class="line">root@ubuntu:~<span class="comment"># docker container wait new-first-nginx2</span></span><br><span class="line"><span class="comment"># ç»ˆç«¯è¢«é˜»å¡</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»ˆç«¯2</span></span><br><span class="line">root@ubuntu:~<span class="comment"># docker container stop new-first-nginx2</span></span><br><span class="line">new-first-nginx2</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»ˆç«¯1</span></span><br><span class="line">root@ubuntu:~<span class="comment"># docker container wait new-first-nginx2</span></span><br><span class="line">0</span><br></pre></td></tr></table></figure>

<h2 id="run"><a href="#run" class="headerlink" title="run"></a>run</h2><p>è¿è¡Œä¸€ä¸ªå®¹å™¨, è¿™ä¸ªå‘½ä»¤çš„å‚æ•°éå¸¸å¤š, å¯ä»¥å®šåˆ¶çš„å±æ€§ä¹Ÿéå¸¸å¤š, å¸¸ç”¨å‚æ•°å¦‚ä¸‹</p>
<ul>
<li><code>-e</code>: è®¾ç½®ç¯å¢ƒå˜é‡</li>
<li><code>-h</code>: è®¾ç½® hostname</li>
<li><code>-i</code>: å¼€æ”¾æ ‡å‡†è¾“å…¥</li>
<li><code>-t</code>: åˆ†é…ä¼ªç»ˆç«¯</li>
<li><code>-l</code>: æ‰“æ ‡ç­¾</li>
<li><code>-p</code>: æŒ‡å®šæ˜ å°„å‡ºæ¥çš„ç«¯å£(å¯éšæœºåˆ†é…, å¯ä»¥æŒ‡å®š)</li>
<li><code>-P</code>: æ˜ å°„å®¹å™¨å†…æ‰€æœ‰å¼€æ”¾çš„ç«¯å£(ç«¯å£å·éšæœºåˆ†é…)</li>
<li><code>-v</code>: æ•°æ®å·çš„æŒ‚è½½</li>
<li><code>--volumes-driver</code>: æŒ‡å®šå­˜å‚¨å¼•æ“</li>
<li><code>-w</code>: å®¹å™¨è¿è¡Œçš„å·¥ä½œç›®å½•</li>
<li><code>--restart</code>: é»˜è®¤ä¸º no, å®¹å™¨å¼‚å¸¸é€€å‡ºåç¦æ­¢è‡ªåŠ¨é‡å¯<ul>
<li>è®¾ç½®ä¸º <code>--restart=on-failure:10</code> , æ„å‘³å¯¹è¯¥å®¹å™¨çš„é0é€€å‡ºçŠ¶æ€è¿›è¡Œé‡å¯, æœ€å¤šé‡å¯10æ¬¡</li>
<li>è®¾ç½®ä¸º <code>--restart=always</code> å§‹ç»ˆé‡å¯</li>
</ul>
</li>
<li><code>--network</code>: æŒ‡å®šç½‘ç»œç±»å‹</li>
<li><code>--name</code>: æŒ‡å®šå®¹å™¨åç§°</li>
<li><code>--log-driver</code>: æŒ‡å®šæ—¥å¿—å¼•æ“</li>
<li><code>--link</code>: ç½‘ç»œå±‚è¿é€šæŒ‡å®šå®¹å™¨</li>
<li><code>--dns</code>: æŒ‡å®šå®¹å™¨å†…ä½¿ç”¨çš„ DNS æœåŠ¡å™¨</li>
<li><code>--privileged</code>: ææƒ,åœ¨å®¹å™¨å†…è·å–æ‰©å±•çš„æ‰§è¡Œæƒé™</li>
<li><code>--add-host</code>: hosts é…ç½®. ä¾‹å¦‚: <code>--add-host polarsnow:123.57.233.243</code></li>
</ul>
]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>container</tag>
      </tags>
  </entry>
  <entry>
    <title>Dockeråˆä½“éªŒ</title>
    <url>/2017/04/15/Docker%E5%88%9D%E4%BD%93%E9%AA%8C/</url>
    <content><![CDATA[<blockquote>
<ul>
<li>bash å‰å°è¿è¡Œ</li>
<li>å®¹å™¨æŒä¹…è¿è¡Œçš„æ¡ä»¶</li>
<li>nginx åå°è¿è¡Œ</li>
<li>åå°è¿è¡Œçš„æ¡ä»¶</li>
<li>Dockeræ•°æ®å­˜å‚¨çš„å“²å­¦</li>
<li>Dockerä½¿ç”¨çš„å“²å­¦</li>
</ul>
</blockquote>
<h1 id="å‰å°è¿è¡Œå®¹å™¨"><a href="#å‰å°è¿è¡Œå®¹å™¨" class="headerlink" title="å‰å°è¿è¡Œå®¹å™¨"></a>å‰å°è¿è¡Œå®¹å™¨</h1><h2 id="æ‹‰å–-centos-é•œåƒ"><a href="#æ‹‰å–-centos-é•œåƒ" class="headerlink" title="æ‹‰å– centos é•œåƒ"></a>æ‹‰å– centos é•œåƒ</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker pull centos</span></span><br><span class="line">Using default tag: latest</span><br><span class="line">latest: Pulling from library/centos</span><br><span class="line">93857f76ae30: Pull complete </span><br><span class="line">Digest: sha256:4eda692c08e0a065ae91d74e82fff4af3da307b4341ad61fa61771cc4659af60</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> centos:latest</span><br></pre></td></tr></table></figure>

<h2 id="æŸ¥çœ‹é•œåƒåˆ—è¡¨"><a href="#æŸ¥çœ‹é•œåƒåˆ—è¡¨" class="headerlink" title="æŸ¥çœ‹é•œåƒåˆ—è¡¨"></a>æŸ¥çœ‹é•œåƒåˆ—è¡¨</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">centos              latest              a8493f5f50ff        33 hours ago        192MB</span><br><span class="line">nginx               latest              5766334bdaa0        37 hours ago        183MB</span><br><span class="line">hello-world         latest              48b5124b2768        2 months ago        1.84kB</span><br></pre></td></tr></table></figure>

<h2 id="ä»¥å‰å°è¿è¡Œæ–¹å¼è¿è¡Œå®¹å™¨"><a href="#ä»¥å‰å°è¿è¡Œæ–¹å¼è¿è¡Œå®¹å™¨" class="headerlink" title="ä»¥å‰å°è¿è¡Œæ–¹å¼è¿è¡Œå®¹å™¨"></a>ä»¥å‰å°è¿è¡Œæ–¹å¼è¿è¡Œå®¹å™¨</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker run --name "mycentos" -it centos /bin/bash</span></span><br><span class="line">[root@e4b1ccd2600b /]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<ul>
<li>run: è¿è¡Œä¸€ä¸ªå®¹å™¨</li>
<li>â€”name â€œmycentosâ€: ç»™å®¹å™¨å‘½å</li>
<li>-i: æ‰“å¼€å®¹å™¨çš„æ ‡å‡†è¾“å…¥</li>
<li>-t: åˆ†é…ä¸€ä¸ªä¼ªç»ˆç«¯ tty</li>
<li>centos: é•œåƒå</li>
<li>è¿è¡Œå®¹å™¨åæ‰§è¡Œçš„å‘½ä»¤</li>
</ul>
<p>è¯­æ³•:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker run --help</span></span><br><span class="line"></span><br><span class="line">Usage:  docker run [OPTIONS] IMAGE [COMMAND] [ARG...]</span><br><span class="line"></span><br><span class="line">Run a <span class="built_in">command</span> <span class="keyword">in</span> a new container</span><br></pre></td></tr></table></figure>

<h1 id="æ“ä½œå®¹å™¨"><a href="#æ“ä½œå®¹å™¨" class="headerlink" title="æ“ä½œå®¹å™¨"></a>æ“ä½œå®¹å™¨</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum install dstat htop lsof curl wget lrzsz</span><br></pre></td></tr></table></figure>



<h2 id="é€€å‡ºç»ˆç«¯-é€€å‡ºå®¹å™¨"><a href="#é€€å‡ºç»ˆç«¯-é€€å‡ºå®¹å™¨" class="headerlink" title="é€€å‡ºç»ˆç«¯/é€€å‡ºå®¹å™¨"></a>é€€å‡ºç»ˆç«¯/é€€å‡ºå®¹å™¨</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@e4b1ccd2600b /]<span class="comment"># </span></span><br><span class="line">[root@e4b1ccd2600b /]<span class="comment"># exit</span></span><br><span class="line">root@ubuntu:~<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>éšç€ç»ˆç«¯çš„é€€å‡º, å®¹å™¨ä¹Ÿéšä¹‹é€€å‡º</p>
<hr>
<h1 id="å®¹å™¨æŒä¹…è¿è¡Œçš„æ¡ä»¶"><a href="#å®¹å™¨æŒä¹…è¿è¡Œçš„æ¡ä»¶" class="headerlink" title="å®¹å™¨æŒä¹…è¿è¡Œçš„æ¡ä»¶"></a>å®¹å™¨æŒä¹…è¿è¡Œçš„æ¡ä»¶</h1><p><strong>é˜»å¡!!!</strong></p>
<p>Docker å®¹å™¨æŒä¹…è¿è¡Œçš„åŸºæœ¬æ¡ä»¶æ˜¯-è¿›ç¨‹çš„é˜»å¡!</p>
<p>Docker çš„å“²å­¦ä¸­, ä¸»å¼ ä¸€ä¸ªå®¹å™¨åªå¯åŠ¨â€ä¸€ä¸ªè¿›ç¨‹â€, è¿™é‡Œçš„ä¸€ä¸ªè¿›ç¨‹å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªç¨‹åº æˆ–æ˜¯ä¸€ä¸ªä¸»è¿›ç¨‹, æ¯”å¦‚ä¸€ä¸ª Apache, ä¸€ä¸ª Apache å¯ä»¥å¯åŠ¨ä¸€ä¸ªä¸»è¿›ç¨‹å’Œè‹¥å¹²ä¸ªå­è¿›ç¨‹.</p>
<p>å¦‚æœæƒ³è®© Docker æŒä¹…åŒ–è¿è¡Œ, é‚£ä¹ˆåœ¨å®¹å™¨å¯åŠ¨æ—¶, å¿…é¡»æœ‰ä¸€ä¸ªè¿›ç¨‹é˜»å¡ä½ç»ˆç«¯. Docker åˆ¤æ–­å®¹å™¨å†…æœåŠ¡æ˜¯å¦æ­£å¸¸çš„æ–¹å¼å¾ˆç®€å•, å°±æ˜¯åˆ¤æ–­æœ€åé˜»å¡çš„è¿›ç¨‹æ˜¯å¦æŒ‚æ‰, å¦‚æœæœ€åé˜»å¡çš„è¿›ç¨‹æŒ‚æ‰, é‚£ä¹ˆå®¹å™¨é€€å‡º. </p>
<p>Docker è®¤ä¸º, å®¹å™¨å³æœåŠ¡, å®¹å™¨å³ç¨‹åº, ä¸€ä¸ªå®¹å™¨å°±æ˜¯ä¸€ä¸ªç¨‹åº, å¦‚æœä¸€ä¸ªå®¹å™¨å†…å¯åŠ¨äº†å¤šä¸ªæœåŠ¡, æ¯”å¦‚ A, B å’Œ CæœåŠ¡, C ä½œä¸ºæœ€åä¸€ä¸ªç¨‹åºé˜»å¡ä½å®¹å™¨ä½¿å…¶è¿è¡Œèµ·æ¥, æ­¤æ—¶, å¦‚æœå®¹å™¨å†…éƒ¨çš„ A æˆ– B æœåŠ¡æŒ‚æ‰, å®¹å™¨ä»ç„¶è®¤ä¸ºè‡ªå·±æ˜¯æ­£å¸¸çš„, å› ä¸º Docker åªå…³å¿ƒæœ€åé˜»å¡çš„è¿›ç¨‹æ˜¯å¦é€€å‡º. åä¹‹, A å’Œ B æœåŠ¡æ­£å¸¸, å¦‚æœ C æœåŠ¡æŒ‚æ‰, é‚£ä¹ˆåˆ™æ•´ä¸ªå®¹å™¨é€€å‡º!</p>
<hr>
<h1 id="åå°è¿è¡Œå®¹å™¨"><a href="#åå°è¿è¡Œå®¹å™¨" class="headerlink" title="åå°è¿è¡Œå®¹å™¨"></a>åå°è¿è¡Œå®¹å™¨</h1><h2 id="è·å–-nginx-é•œåƒ"><a href="#è·å–-nginx-é•œåƒ" class="headerlink" title="è·å– nginx é•œåƒ"></a>è·å– nginx é•œåƒ</h2><p><a href="https://hub.docker.com" target="_blank" rel="noopener">https://hub.docker.com</a></p>
<p>å³è¾¹æ˜¯æ‹‰å– nginx latest ç‰ˆæœ¬é•œåƒçš„å‘½ä»¤</p>
<p>å·¦è¾¹ repo info æ ‡ç­¾å†…æ˜¯ nginx ç®€çŸ­è¯´æ˜/å®Œæ•´è¯´æ˜</p>
<p>å®Œæ•´è¯´æ˜ä¸­åŒ…æ‹¬:</p>
<ul>
<li>ç‰ˆæœ¬çš„ä»‹ç»</li>
<li>è½¯ä»¶çš„ä»‹ç»</li>
<li>ä½¿ç”¨æ–¹å¼çš„ä»‹ç»</li>
</ul>
<p>å·¦è¾¹ tag æ˜¯æ‰€æœ‰ç‰ˆæœ¬çš„åˆ—è¡¨</p>
<p><a href="https://store.docker.com" target="_blank" rel="noopener">https://store.docker.com</a></p>
<h2 id="ä¸‹è½½æœ€æ–°ç¨³å®šå‘è¡Œç‰ˆçš„-nginx-é•œåƒ"><a href="#ä¸‹è½½æœ€æ–°ç¨³å®šå‘è¡Œç‰ˆçš„-nginx-é•œåƒ" class="headerlink" title="ä¸‹è½½æœ€æ–°ç¨³å®šå‘è¡Œç‰ˆçš„ nginx é•œåƒ"></a>ä¸‹è½½æœ€æ–°ç¨³å®šå‘è¡Œç‰ˆçš„ nginx é•œåƒ</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker pull nginx</span></span><br><span class="line">Using default tag: latest</span><br><span class="line">latest: Pulling from library/nginx</span><br><span class="line">6d827a3ef358: Pull complete </span><br><span class="line">f8f2e0556751: Pull complete </span><br><span class="line">5c9972dca3fd: Pull complete </span><br><span class="line">451b9524cb06: Pull complete </span><br><span class="line">Digest: sha256:e6693c20186f837fc393390135d8a598a96a833917917789d63766cab6c59582</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> nginx:latest</span><br><span class="line">root@ubuntu:~<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<h2 id="è¿è¡Œ-nginx-é•œåƒ"><a href="#è¿è¡Œ-nginx-é•œåƒ" class="headerlink" title="è¿è¡Œ nginx é•œåƒ"></a>è¿è¡Œ nginx é•œåƒ</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é¦–å…ˆåˆ›å»ºä¸€ä¸ª web ç›®å½•</span></span><br><span class="line">root@ubuntu:~<span class="comment"># mkdir web</span></span><br><span class="line">root@ubuntu:~<span class="comment"># echo "Hello Docker" &gt; web/index.html</span></span><br><span class="line"><span class="comment"># è¿è¡Œ nginx é•œåƒ</span></span><br><span class="line">root@ubuntu:~<span class="comment"># docker run --name "my-first-nginx" -v /root/web:/usr/share/nginx/html:ro -d nginx</span></span><br><span class="line">11610baab1ce0b684367a44313fc0401489b115399f0a4469bec15bd4b8f6769</span><br><span class="line">root@ubuntu:~<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES</span><br><span class="line">11610baab1ce        nginx               <span class="string">"nginx -g 'daemon ..."</span>   6 seconds ago       Up 6 seconds        80/tcp, 443/tcp     my-first-nginx</span><br><span class="line">root@ubuntu:~<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<ul>
<li>-v: æŒ‚è½½å·  <code>å®¿ä¸»æœºç›®å½•:å®¹å™¨å†…ç›®å½•:æŒ‚è½½æ–¹å¼</code>  å…¶ä¸­æŒ‚è½½æ–¹å¼æ”¯æŒä»¥åªè¯»<code>ro</code>æˆ–è¯»å†™<code>rw</code>æ–¹å¼æŒ‚è½½, é»˜è®¤ä¸º<code>rw</code></li>
<li>-d: ä»¥å®ˆæŠ¤è¿›ç¨‹<code>daemon</code>æ–¹å¼æ”¾å…¥åˆ°åå°è¿è¡Œ</li>
</ul>
<p>æ­¤æ–¹å¼æ²¡æœ‰å¯¹å¤–æ˜ å°„ç«¯å£, æ‰€ä»¥åªèƒ½åœ¨å®¹å™¨å†…éƒ¨è®¿é—®</p>
<h3 id="åœ¨å®¹å™¨å†…éƒ¨è®¿é—®é¡µé¢"><a href="#åœ¨å®¹å™¨å†…éƒ¨è®¿é—®é¡µé¢" class="headerlink" title="åœ¨å®¹å™¨å†…éƒ¨è®¿é—®é¡µé¢"></a>åœ¨å®¹å™¨å†…éƒ¨è®¿é—®é¡µé¢</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥å®¹å™¨</span></span><br><span class="line">root@ubuntu:~<span class="comment"># docker exec -it 11610 /bin/bash</span></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å‘½ä»¤æ˜¯å¦å®‰è£…</span></span><br><span class="line">root@11610baab1ce:/<span class="comment"># curl</span></span><br><span class="line">bash: curl: <span class="built_in">command</span> not found</span><br><span class="line"><span class="comment"># æŸ¥çœ‹å‘è¡Œç‰ˆ</span></span><br><span class="line">root@11610baab1ce:/<span class="comment"># cat /etc/issue</span></span><br><span class="line">Debian GNU/Linux 8 \n \l</span><br><span class="line"><span class="comment"># å®‰è£…å‘½ä»¤</span></span><br><span class="line">root@11610baab1ce:/<span class="comment"># apt install curl</span></span><br><span class="line"><span class="comment"># æµ‹è¯•é¡µé¢</span></span><br><span class="line">root@11610baab1ce:/<span class="comment"># curl http://127.0.0.1</span></span><br><span class="line">Hello Docker</span><br></pre></td></tr></table></figure>



<h2 id="è¿è¡Œæš´éœ²ç«¯å£çš„-nginx-é•œåƒ"><a href="#è¿è¡Œæš´éœ²ç«¯å£çš„-nginx-é•œåƒ" class="headerlink" title="è¿è¡Œæš´éœ²ç«¯å£çš„ nginx é•œåƒ"></a>è¿è¡Œæš´éœ²ç«¯å£çš„ nginx é•œåƒ</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker run --name "my-second-nginx" -v /root/web:/usr/share/nginx/html:ro -d -p 8800:80 nginx</span></span><br><span class="line">d0a4936e940e5d3b9e2d96be3b08133ddb7f5d9f9a28a81e3b99dff03fb1d747</span><br><span class="line">root@ubuntu:~<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                           NAMES</span><br><span class="line">d0a4936e940e        nginx               <span class="string">"nginx -g 'daemon ..."</span>   3 seconds ago       Up 2 seconds        443/tcp, 0.0.0.0:8800-&gt;80/tcp   my-second-nginx</span><br><span class="line">11610baab1ce        nginx               <span class="string">"nginx -g 'daemon ..."</span>   12 minutes ago      Up 12 minutes       80/tcp, 443/tcp                 my-first-nginx</span><br><span class="line">root@ubuntu:~<span class="comment"># </span></span><br><span class="line">root@ubuntu:~<span class="comment"># curl http://127.0.0.1:8800</span></span><br><span class="line">Hello Docker</span><br></pre></td></tr></table></figure>

<ul>
<li>-p: å¯¹å¤–æ˜ å°„ç«¯å£ <code>å®¿ä¸»æœºç«¯å£:å®¹å™¨å†…ç«¯å£</code> </li>
</ul>
<h2 id="è¿è¡Œæš´éœ²å¤šä¸ªç«¯å£çš„-nginx-é•œåƒ"><a href="#è¿è¡Œæš´éœ²å¤šä¸ªç«¯å£çš„-nginx-é•œåƒ" class="headerlink" title="è¿è¡Œæš´éœ²å¤šä¸ªç«¯å£çš„ nginx é•œåƒ"></a>è¿è¡Œæš´éœ²å¤šä¸ªç«¯å£çš„ nginx é•œåƒ</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker run --name "my-third-nginx" -v /root/web:/usr/share/nginx/html:ro -d -p 8080:80 -p 443:443 nginx</span></span><br><span class="line">b9704931408c6d054bc9c510878e10467a71d412bef065afa7414403982001b6</span><br><span class="line">root@ubuntu:~<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                        NAMES</span><br><span class="line">b9704931408c        nginx               <span class="string">"nginx -g 'daemon ..."</span>   6 seconds ago       Up 6 seconds        0.0.0.0:443-&gt;443/tcp, 0.0.0.0:8080-&gt;80/tcp   my-third-nginx</span><br><span class="line">d0a4936e940e        nginx               <span class="string">"nginx -g 'daemon ..."</span>   3 minutes ago       Up 3 minutes        443/tcp, 0.0.0.0:8800-&gt;80/tcp                my-second-nginx</span><br><span class="line">11610baab1ce        nginx               <span class="string">"nginx -g 'daemon ..."</span>   15 minutes ago      Up 15 minutes       80/tcp, 443/tcp                              my-first-nginx</span><br><span class="line">root@ubuntu:~<span class="comment">#</span></span><br></pre></td></tr></table></figure>



<h1 id="Docker-æ•°æ®å­˜å‚¨çš„å“²å­¦"><a href="#Docker-æ•°æ®å­˜å‚¨çš„å“²å­¦" class="headerlink" title="Docker æ•°æ®å­˜å‚¨çš„å“²å­¦"></a>Docker æ•°æ®å­˜å‚¨çš„å“²å­¦</h1><p>Docker ä¸»å¼ è¿è¡Œæ— çŠ¶æ€çš„å®¹å™¨, ä»€ä¹ˆæ ·çš„å®¹å™¨æ˜¯æ— çŠ¶æ€çš„å®¹å™¨å‘¢?</p>
<p>æ‰“ä¸ªæ¯”æ–¹: ä»¥ä¸Šé¢çš„ nginx å®ä¾‹ä¸ºä¾‹</p>
<ul>
<li>ä»¥å¦‚ä¸Šæ–¹å¼<code>-v</code>æŒ‚è½½çš„æ–¹å¼å³ä¸ºæœ‰çŠ¶æ€</li>
<li>ä»¥ dockerfile çš„å½¢å¼å°†æ•°æ®ç›®å½•é¢„å…ˆæ‹·è´åˆ°é•œåƒçš„æ–¹å¼å³ä¸ºæ— çŠ¶æ€</li>
</ul>
<p>ä¹Ÿå¯ä»¥ç®€å•çš„ç†è§£ä¸º: </p>
<ul>
<li>é•œåƒå†…åŒ…å«æ•°æ®ä¸”æ•°æ®å¯éšæ—¶éšç€é•œåƒé”€æ¯çš„å®¹å™¨ä¸ºæ— çŠ¶æ€å®¹å™¨</li>
<li>é•œåƒå†…åªåŒ…å«è¿è¡Œç¯å¢ƒ, æ•°æ®éœ€è¦é æŒ‚è½½ç›®å½•çš„, æˆ–æ˜¯å®¹å™¨å†…æ•°æ®ä¸å¯éšæ„é”€æ¯çš„å®¹å™¨ä¸ºæœ‰çŠ¶æ€å®¹å™¨</li>
</ul>
<p>è¿™ä¸¤ç§ç”¨æ³•å„æœ‰åˆ©å¼Š, ç›´è‡³ç°åœ¨ä¹Ÿäº‰è®ºä¸ä¼‘, æ²¡æœ‰æœ€å¥½çš„ä½¿ç”¨æ–¹å¼, åªæœ‰æœ€åˆé€‚çš„ä½¿ç”¨æ–¹å¼(æ³¨æ„: åœ¨é›†ç¾¤ä¸­, æœ€å¥½ä½¿ç”¨æ— çŠ¶æ€çš„æ–¹å¼. ä½†æ˜¯æœ€æ–°ç‰ˆæœ¬çš„ k8s å·²ç»æ”¯æŒæœ‰çŠ¶æ€å®¹å™¨é›†ç¾¤)</p>
<h1 id="Docker-ä½¿ç”¨çš„å“²å­¦"><a href="#Docker-ä½¿ç”¨çš„å“²å­¦" class="headerlink" title="Docker ä½¿ç”¨çš„å“²å­¦"></a>Docker ä½¿ç”¨çš„å“²å­¦</h1><p>ç”±äº Docker å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸå®Œå…¨å–å†³äºæœ€åé˜»å¡å®¹å™¨å…¥å£çš„è¿›ç¨‹çš„å­˜æ´»çŠ¶æ€, æ‰€ä»¥åœ¨ä½¿ç”¨å®¹å™¨çš„æ—¶å€™, ä¸€å®šè¦å¤šåŠ æ³¨æ„é˜»å¡å…¥å£çš„è¿›ç¨‹å’Œä¸»è¿›ç¨‹çš„å…³ç³». æ¯”å¦‚ node.js å®¹å™¨, åœ¨é‡Œé¢ä½¿ç”¨pm2 ç®¡ç†çš„ node é¡¹ç›®, æœ€åé˜»å¡å…¥å£çš„è¿›ç¨‹æ˜¯ pm2, é‚£ä¹ˆé‡Œé¢ node é¡¹ç›®çš„ç®¡ç†å°±è„±ç¦»äº†å®¹å™¨çš„æ§åˆ¶, è€Œç”± pm2 å»æ¥ç®¡, åœ¨node è¿›ç¨‹å‡ºé—®é¢˜æ—¶ä¹Ÿæ˜¯ç”±pm2å»æ§åˆ¶é‡å¯çš„. åœ¨å®é™…ä½¿ç”¨æƒ…å†µä¸­, ä¸€å®šè¦æ³¨æ„è¿™æ ·çš„ä½¿ç”¨æ–¹å¼ä¼šä¸ä¼šå¯¹åç»­çš„ç»´æŠ¤é€ æˆä¸ä¾¿. æˆ‘æ¨èä½¿ç”¨åŸç”Ÿçš„å‘½ä»¤å¯åŠ¨ä¸»è¿›ç¨‹, ä¸è¦åœ¨ä¸»è¿›ç¨‹å¤–é¢å†å¥—ä¸€å±‚ç¨‹åºç®¡ç†å±‚.</p>
]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title>å¿«é€Ÿå®‰è£…Docker</title>
    <url>/2017/04/15/%E5%BF%AB%E9%80%9F%E5%AE%89%E8%A3%85Docker/</url>
    <content><![CDATA[<h1 id="å®‰è£…å‘½ä»¤"><a href="#å®‰è£…å‘½ä»¤" class="headerlink" title="å®‰è£…å‘½ä»¤"></a>å®‰è£…å‘½ä»¤</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># å…¬ç½‘é€šç”¨</span></span><br><span class="line">curl -sSL http://acs-public-mirror.oss-cn-hangzhou.aliyuncs.com/docker-engine/internet | sh -</span><br><span class="line"></span><br><span class="line"><span class="comment"># é˜¿é‡Œäº‘ä¸“ç”¨</span></span><br><span class="line">curl -sSL http://acs-public-mirror.oss-cn-hangzhou.aliyuncs.com/docker-engine/intranet | sh -</span><br></pre></td></tr></table></figure>



<h1 id="å®‰è£…å®Œæˆåçš„ç»“æŸä¿¡æ¯"><a href="#å®‰è£…å®Œæˆåçš„ç»“æŸä¿¡æ¯" class="headerlink" title="å®‰è£…å®Œæˆåçš„ç»“æŸä¿¡æ¯:"></a>å®‰è£…å®Œæˆåçš„ç»“æŸä¿¡æ¯:</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># curl -sSL http://acs-public-mirror.oss-cn-hangzhou.aliyuncs.com/docker-engine/internet | sh -</span></span><br><span class="line">......</span><br><span class="line">......</span><br><span class="line">+ sh -c docker version</span><br><span class="line">Client:</span><br><span class="line"> Version:      17.04.0-ce</span><br><span class="line"> API version:  1.28</span><br><span class="line"> Go version:   go1.7.5</span><br><span class="line"> Git commit:   4845c56</span><br><span class="line"> Built:        Mon Apr  3 18:07:42 2017</span><br><span class="line"> OS/Arch:      linux/amd64</span><br><span class="line"></span><br><span class="line">Server:</span><br><span class="line"> Version:      17.04.0-ce</span><br><span class="line"> API version:  1.28 (minimum version 1.12)</span><br><span class="line"> Go version:   go1.7.5</span><br><span class="line"> Git commit:   4845c56</span><br><span class="line"> Built:        Mon Apr  3 18:07:42 2017</span><br><span class="line"> OS/Arch:      linux/amd64</span><br><span class="line"> Experimental: <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">If you would like to use Docker as a non-root user, you should now consider</span><br><span class="line">adding your user to the <span class="string">"docker"</span> group with something like:</span><br><span class="line"></span><br><span class="line">  sudo usermod -aG docker your-user</span><br><span class="line"></span><br><span class="line">Remember that you will have to <span class="built_in">log</span> out and back <span class="keyword">in</span> <span class="keyword">for</span> this to take effect!</span><br></pre></td></tr></table></figure>

<p>é‡ç‚¹æ³¨æ„: <code>sudo usermod -aG docker your-user</code></p>
<p>åœ¨ Ubuntu ç³»ç»Ÿä¸­, ä½¿ç”¨æ™®é€šç”¨æˆ·ç™»å½•çš„æƒ…å†µå¾ˆå¤š, å¦‚æœæ™®é€šç”¨æˆ·éœ€è¦ç›´æ¥æœ‰æƒé™æ§åˆ¶ docker æ‰€æœ‰çš„æ“ä½œçš„è¯, éœ€è¦å°†è¯¥æ™®é€šç”¨æˆ·åŠ å…¥åˆ° docker ç»„ä¸­.</p>
<p>Docker æ˜¯ C/S æ¶æ„, ä¸€èˆ¬æƒ…å†µä¸‹, C å’Œ S æ˜¯åœ¨å®‰è£…åœ¨ä¸€å°ä¸»æœºä¸Šçš„, æœ¬åœ°çš„ C æ§åˆ¶æœ¬åœ°çš„ S, åæœŸæ§åˆ¶å¤§è§„æ¨¡ Docker çš„æ—¶å€™, éœ€è¦å¼€æ”¾Docker API æ¥è¿œç¨‹æ§åˆ¶ Docker Server ç«¯</p>
<h1 id="æ£€æŸ¥-Docker-è¿è¡ŒçŠ¶æ€"><a href="#æ£€æŸ¥-Docker-è¿è¡ŒçŠ¶æ€" class="headerlink" title="æ£€æŸ¥ Docker è¿è¡ŒçŠ¶æ€"></a>æ£€æŸ¥ Docker è¿è¡ŒçŠ¶æ€</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># systemctl status docker</span></span><br><span class="line">â— docker.service - Docker Application Container Engine</span><br><span class="line">   Loaded: loaded (/lib/systemd/system/docker.service; enabled; vendor preset: enabled)</span><br><span class="line">   Active: active (running) since Fri 2017-04-07 20:43:48 PDT; 9min ago</span><br><span class="line">     Docs: https://docs.docker.com</span><br><span class="line"> Main PID: 4082 (dockerd)</span><br><span class="line">   CGroup: /system.slice/docker.service</span><br><span class="line">           â”œâ”€4082 /usr/bin/dockerd -H fd://</span><br><span class="line">           â””â”€4095 docker-containerd -l unix:///var/run/docker/libcontainerd/docker-containerd.sock --metri</span><br><span class="line"></span><br><span class="line">Apr 07 20:43:48 ubuntu dockerd[4082]: time=<span class="string">"2017-04-07T20:43:48.175051418-07:00"</span> level=warning msg=<span class="string">"Your k</span></span><br><span class="line"><span class="string">Apr 07 20:43:48 ubuntu dockerd[4082]: time="</span>2017-04-07T20:43:48.175185511-07:00<span class="string">" level=warning msg="</span>Your k</span><br><span class="line">Apr 07 20:43:48 ubuntu dockerd[4082]: time=<span class="string">"2017-04-07T20:43:48.175683715-07:00"</span> level=info msg=<span class="string">"Loading c</span></span><br><span class="line"><span class="string">Apr 07 20:43:48 ubuntu dockerd[4082]: time="</span>2017-04-07T20:43:48.228757745-07:00<span class="string">" level=info msg="</span>Firewalld</span><br><span class="line">Apr 07 20:43:48 ubuntu dockerd[4082]: time=<span class="string">"2017-04-07T20:43:48.327388388-07:00"</span> level=info msg=<span class="string">"Default b</span></span><br><span class="line"><span class="string">Apr 07 20:43:48 ubuntu dockerd[4082]: time="</span>2017-04-07T20:43:48.383792709-07:00<span class="string">" level=info msg="</span>Loading c</span><br><span class="line">Apr 07 20:43:48 ubuntu dockerd[4082]: time=<span class="string">"2017-04-07T20:43:48.420530516-07:00"</span> level=info msg=<span class="string">"Daemon ha</span></span><br><span class="line"><span class="string">Apr 07 20:43:48 ubuntu dockerd[4082]: time="</span>2017-04-07T20:43:48.420807227-07:00<span class="string">" level=info msg="</span>Docker da</span><br><span class="line">Apr 07 20:43:48 ubuntu systemd[1]: Started Docker Application Container Engine.</span><br><span class="line">Apr 07 20:43:48 ubuntu dockerd[4082]: time=<span class="string">"2017-04-07T20:43:48.434958396-07:00"</span> level=info msg=<span class="string">"API liste</span></span><br><span class="line"><span class="string">lines 1-19/19 (END)</span></span><br></pre></td></tr></table></figure>



<h2 id="æ“ä½œ-Docker-è¿›ç¨‹"><a href="#æ“ä½œ-Docker-è¿›ç¨‹" class="headerlink" title="æ“ä½œ Docker è¿›ç¨‹"></a>æ“ä½œ Docker è¿›ç¨‹</h2><ul>
<li>å…³é—­ Docker æœåŠ¡ <code>systemctl stop docker</code></li>
<li>é‡å¯ Docker æœåŠ¡ <code>systemctl restart docker</code></li>
<li>å¼€å¯ Docker æœåŠ¡ <code>systemctl start docker</code></li>
<li>å¼€æœºå¯åŠ¨ Docker <code>systemctl enable docker</code></li>
</ul>
<h1 id="æ£€æŸ¥-Docker-æœåŠ¡"><a href="#æ£€æŸ¥-Docker-æœåŠ¡" class="headerlink" title="æ£€æŸ¥ Docker æœåŠ¡"></a>æ£€æŸ¥ Docker æœåŠ¡</h1><ul>
<li>Docker æœåŠ¡è¿è¡Œæ­£å¸¸çš„å›æ˜¾</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker info</span></span><br><span class="line">Containers: 0</span><br><span class="line"> Running: 0</span><br><span class="line"> Paused: 0</span><br><span class="line"> Stopped: 0</span><br><span class="line">Images: 0</span><br><span class="line">Server Version: 17.04.0-ce</span><br><span class="line">Storage Driver: aufs</span><br><span class="line"> Root Dir: /var/lib/docker/aufs</span><br><span class="line"> Backing Filesystem: extfs</span><br><span class="line"> Dirs: 0</span><br><span class="line"> Dirperm1 Supported: <span class="literal">true</span></span><br><span class="line">Logging Driver: json-file</span><br><span class="line">Cgroup Driver: cgroupfs</span><br><span class="line">Plugins: </span><br><span class="line"> Volume: <span class="built_in">local</span></span><br><span class="line"> Network: bridge host macvlan null overlay</span><br><span class="line">Swarm: inactive</span><br><span class="line">Runtimes: runc</span><br><span class="line">Default Runtime: runc</span><br><span class="line">Init Binary: </span><br><span class="line">containerd version: 422e31ce907fd9c3833a38d7b8fdd023e5a76e73</span><br><span class="line">runc version: 9c2d8d184e5da67c95d601382adf14862e4f2228</span><br><span class="line">init version: 949e6fa</span><br><span class="line">Security Options:</span><br><span class="line"> apparmor</span><br><span class="line"> seccomp</span><br><span class="line">  Profile: default</span><br><span class="line">Kernel Version: 4.4.0-21-generic</span><br><span class="line">Operating System: Ubuntu 16.04 LTS</span><br><span class="line">OSType: linux</span><br><span class="line">Architecture: x86_64</span><br><span class="line">CPUs: 1</span><br><span class="line">Total Memory: 975.1MiB</span><br><span class="line">Name: ubuntu</span><br><span class="line">ID: VK2Y:PFFS:OEDA:7RIL:PLF5:SA4F:RJNS:7VEF:ODLG:LX6M:OVY4:BECX</span><br><span class="line">Docker Root Dir: /var/lib/docker</span><br><span class="line">Debug Mode (client): <span class="literal">false</span></span><br><span class="line">Debug Mode (server): <span class="literal">false</span></span><br><span class="line">Registry: https://index.docker.io/v1/</span><br><span class="line">Experimental: <span class="literal">false</span></span><br><span class="line">Insecure Registries:</span><br><span class="line"> 127.0.0.0/8</span><br><span class="line">Live Restore Enabled: <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">WARNING: No swap <span class="built_in">limit</span> support</span><br></pre></td></tr></table></figure>

<ul>
<li>Docker æœåŠ¡è¿è¡Œå¼‚å¸¸çš„å›æ˜¾(æ™®é€šç”¨æˆ·å¦‚æœæ²¡æœ‰åŠ å…¥åˆ° docker ç»„ä¸­, æ‰§è¡Œ docker å‘½ä»¤ä¹Ÿä¼šå‡ºç°ä»¥ä¸‹çš„æŠ¥é”™)</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker info</span></span><br><span class="line">Cannot connect to the Docker daemon at unix:///var/run/docker.sock. Is the docker daemon running?</span><br></pre></td></tr></table></figure>

<ul>
<li>è¿˜æœ‰ä¸€ç§æƒ…å†µ, å¯èƒ½ç”±äºæŸäº›åŸå› å¯¼è‡´ç»ˆç«¯é˜»å¡, å¤§å¤šæ•°æƒ…å†µä¸‹, å³ä½¿ä½¿ç”¨ <code>systemctl</code> å…³é—­ Docker æœåŠ¡ä¹Ÿæ— æ³•æ­£å¸¸å…³é—­, åªèƒ½é‡å¯æœåŠ¡å™¨å®¿ä¸»æœº</li>
</ul>
<h1 id="Docker-ä¿¡æ¯è§£è¯»"><a href="#Docker-ä¿¡æ¯è§£è¯»" class="headerlink" title="Docker ä¿¡æ¯è§£è¯»"></a>Docker ä¿¡æ¯è§£è¯»</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker info</span></span><br><span class="line">Containers: 0   <span class="comment"># æ€»å®¹å™¨æ•°é‡</span></span><br><span class="line"> Running: 0     <span class="comment"># è¿è¡Œä¸­çš„å®¹å™¨æ•°é‡</span></span><br><span class="line"> Paused: 0      <span class="comment"># æš‚åœçš„å®¹å™¨æ•°é‡</span></span><br><span class="line"> Stopped: 0     <span class="comment"># åœæ­¢çš„å®¹å™¨æ•°é‡</span></span><br><span class="line">Images: 0       <span class="comment"># æ€»é•œåƒæ•°é‡</span></span><br><span class="line">Server Version: 17.04.0-ce      <span class="comment"># Docker Server ç‰ˆæœ¬</span></span><br><span class="line">Storage Driver: aufs            <span class="comment"># å­˜å‚¨å¼•æ“</span></span><br><span class="line"> Root Dir: /var/lib/docker/aufs <span class="comment"># å­˜å‚¨å¼•æ“æ ¹ç›®å½•</span></span><br><span class="line"> Backing Filesystem: extfs      <span class="comment"># åç«¯æ–‡ä»¶ç³»ç»Ÿç±»å‹</span></span><br><span class="line"> Dirs: 0                        <span class="comment"># aufs çš„å±æ€§</span></span><br><span class="line"> Dirperm1 Supported: <span class="literal">true</span>       <span class="comment"># aufs çš„å±æ€§</span></span><br><span class="line">Logging Driver: json-file       <span class="comment"># æ—¥å¿—å¼•æ“</span></span><br><span class="line">Cgroup Driver: cgroupfs         <span class="comment"># Cgroup å¼•æ“</span></span><br><span class="line">Plugins:        <span class="comment"># æ’ä»¶ä¿¡æ¯</span></span><br><span class="line"> Volume: <span class="built_in">local</span>  <span class="comment"># æ•°æ®å·æ’ä»¶</span></span><br><span class="line"> Network: bridge host macvlan null overlay <span class="comment"># ç½‘ç»œæ’ä»¶</span></span><br><span class="line">Swarm: inactive <span class="comment"># swarmkit æ¨¡å¼çŠ¶æ€</span></span><br><span class="line">Runtimes: runc  <span class="comment"># å®¹å™¨æ‰§è¡Œå¼•æ“</span></span><br><span class="line">Default Runtime: runc           <span class="comment"># é»˜è®¤å®¹å™¨æ‰§è¡Œå¼•æ“</span></span><br><span class="line">Init Binary: </span><br><span class="line">containerd version: 422e31ce907fd9c3833a38d7b8fdd023e5a76e73</span><br><span class="line">runc version: 9c2d8d184e5da67c95d601382adf14862e4f2228</span><br><span class="line">init version: 949e6fa</span><br><span class="line">Security Options:       <span class="comment"># å®‰å…¨é¡¹</span></span><br><span class="line"> apparmor       <span class="comment"># Linuxå†…æ ¸ä¸­çš„å¼ºåˆ¶è®¿é—®æ§åˆ¶ç³»ç»Ÿ</span></span><br><span class="line"> seccomp        <span class="comment"># Linux kernel(2.6.23ç‰ˆæœ¬ä¹‹å)æ‰€æ”¯æŒçš„ä¸€ç§ç®€æ´çš„æ²™ç®±æœºåˆ¶</span></span><br><span class="line">  Profile: default</span><br><span class="line">Kernel Version: 4.4.0-21-generic    <span class="comment"># å®¿ä¸»æœºå†…æ ¸ç‰ˆæœ¬</span></span><br><span class="line">Operating System: Ubuntu 16.04 LTS  <span class="comment"># å®¿ä¸»æœºç³»ç»Ÿå‘è¡Œç‰ˆ</span></span><br><span class="line">OSType: linux           <span class="comment"># å®¿ä¸»æœºç³»ç»Ÿç±»å‹</span></span><br><span class="line">Architecture: x86_64    <span class="comment"># å®¿ä¸»æœº CPU æ¶æ„</span></span><br><span class="line">CPUs: 1                 <span class="comment"># å®¿ä¸»æœºæ€» CPU å®¹é‡</span></span><br><span class="line">Total Memory: 975.1MiB  <span class="comment"># å®¿ä¸»æœºæ€»å†…å­˜å®¹é‡</span></span><br><span class="line">Name: ubuntu            <span class="comment"># å®¿ä¸»æœºç³»ç»Ÿåç§°</span></span><br><span class="line">ID: VK2Y:PFFS:OEDA:7RIL:PLF5:SA4F:RJNS:7VEF:ODLG:LX6M:OVY4:BECX</span><br><span class="line">Docker Root Dir: /var/lib/docker    <span class="comment"># Docker å®¶ç›®å½•</span></span><br><span class="line">Debug Mode (client): <span class="literal">false</span>          <span class="comment"># å®¢æˆ·ç«¯æ˜¯å¦å¼€å¯ debug æ¨¡å¼</span></span><br><span class="line">Debug Mode (server): <span class="literal">false</span>          <span class="comment"># æœåŠ¡ç«¯æ˜¯å¦å¼€å¯ debug æ¨¡å¼</span></span><br><span class="line">Registry: https://index.docker.io/v1/   <span class="comment"># é»˜è®¤ä»“åº“åœ°å€</span></span><br><span class="line">Experimental: <span class="literal">false</span>     <span class="comment"># æ˜¯å¦æ˜¯ä½“éªŒç‰ˆ Docker(edge)</span></span><br><span class="line">Insecure Registries:    <span class="comment"># ä¸å®‰å…¨çš„ä»“åº“</span></span><br><span class="line"> 127.0.0.0/8</span><br><span class="line">Live Restore Enabled: <span class="literal">false</span>  <span class="comment"># åœ¨çº¿æ¢å¤/çƒ­æ¢å¤</span></span><br><span class="line"></span><br><span class="line">WARNING: No swap <span class="built_in">limit</span> support  <span class="comment"># cgroupsä¸­çš„swap accountæ²¡æœ‰å¼€å¯</span></span><br></pre></td></tr></table></figure>

<p>æ³¨æ„: ç”Ÿäº§ç¯å¢ƒä¸­, ä¾æ®è‡ªå·±çš„éœ€è¦, å¯ä»¥é€‚å½“è°ƒæ•´<code>swap limit support</code>çš„æ”¯æŒæƒ…å†µ. </p>
<p>å®å®•å‹¿æ…¢, å®æ…¢å‹¿å®•, ä¸¤ä¸ªè€ƒé‡ç³»ç»Ÿå¥å£®æ€§çš„æ€è·¯, æ²¡æœ‰æœ€å¥½çš„æ–¹æ¡ˆ, å„æœ‰åˆ©å¼Š, éœ€è¦ç»¼åˆè‡ªå·±çš„å®é™…æƒ…å†µè€ƒé‡</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Edit the /etc/default/grub file.</span><br><span class="line">Set the GRUB_CMDLINE_LINUX value as follows:</span><br><span class="line"></span><br><span class="line">GRUB_CMDLINE_LINUX=<span class="string">"cgroup_enable=memory swapaccount=1"</span></span><br><span class="line">Save and close the file.</span><br><span class="line"></span><br><span class="line">Update GRUB.</span><br><span class="line"></span><br><span class="line">$ sudo update-grub</span><br><span class="line">Reboot your system.</span><br></pre></td></tr></table></figure>



<h1 id="è¿è¡Œ-hello-wordå®¹å™¨"><a href="#è¿è¡Œ-hello-wordå®¹å™¨" class="headerlink" title="è¿è¡Œ hello wordå®¹å™¨"></a>è¿è¡Œ hello wordå®¹å™¨</h1><h2 id="æ·»åŠ ä»£ç†ä»“åº“-daocloud"><a href="#æ·»åŠ ä»£ç†ä»“åº“-daocloud" class="headerlink" title="æ·»åŠ ä»£ç†ä»“åº“-daocloud"></a>æ·»åŠ ä»£ç†ä»“åº“-daocloud</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># curl -sSL https://get.daocloud.io/daotools/set_mirror.sh | sh -s http://172d594a.m.daocloud.io</span></span><br><span class="line">docker version &gt;= 1.12</span><br><span class="line">&#123;<span class="string">"registry-mirrors"</span>: [<span class="string">"http://172d594a.m.daocloud.io"</span>]&#125;</span><br><span class="line">Success.</span><br><span class="line">You need to restart docker to take effect: sudo systemctl restart docker.service</span><br><span class="line">root@ubuntu:~<span class="comment"># systemctl restart docker</span></span><br></pre></td></tr></table></figure>



<h2 id="æŸ¥çœ‹ä»£ç†ä¿¡æ¯"><a href="#æŸ¥çœ‹ä»£ç†ä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹ä»£ç†ä¿¡æ¯"></a>æŸ¥çœ‹ä»£ç†ä¿¡æ¯</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker info</span></span><br><span class="line">Containers: 0</span><br><span class="line"> Running: 0</span><br><span class="line"> Paused: 0</span><br><span class="line"> Stopped: 0</span><br><span class="line">Images: 0</span><br><span class="line">Server Version: 17.04.0-ce</span><br><span class="line">Storage Driver: aufs</span><br><span class="line"> Root Dir: /var/lib/docker/aufs</span><br><span class="line"> Backing Filesystem: extfs</span><br><span class="line"> Dirs: 0</span><br><span class="line"> Dirperm1 Supported: <span class="literal">true</span></span><br><span class="line">Logging Driver: json-file</span><br><span class="line">Cgroup Driver: cgroupfs</span><br><span class="line">Plugins: </span><br><span class="line"> Volume: <span class="built_in">local</span></span><br><span class="line"> Network: bridge host macvlan null overlay</span><br><span class="line">Swarm: inactive</span><br><span class="line">Runtimes: runc</span><br><span class="line">Default Runtime: runc</span><br><span class="line">Init Binary: </span><br><span class="line">containerd version: 422e31ce907fd9c3833a38d7b8fdd023e5a76e73</span><br><span class="line">runc version: 9c2d8d184e5da67c95d601382adf14862e4f2228</span><br><span class="line">init version: 949e6fa</span><br><span class="line">Security Options:</span><br><span class="line"> apparmor</span><br><span class="line"> seccomp</span><br><span class="line">  Profile: default</span><br><span class="line">Kernel Version: 4.4.0-21-generic</span><br><span class="line">Operating System: Ubuntu 16.04 LTS</span><br><span class="line">OSType: linux</span><br><span class="line">Architecture: x86_64</span><br><span class="line">CPUs: 1</span><br><span class="line">Total Memory: 975.1MiB</span><br><span class="line">Name: ubuntu</span><br><span class="line">ID: VK2Y:PFFS:OEDA:7RIL:PLF5:SA4F:RJNS:7VEF:ODLG:LX6M:OVY4:BECX</span><br><span class="line">Docker Root Dir: /var/lib/docker</span><br><span class="line">Debug Mode (client): <span class="literal">false</span></span><br><span class="line">Debug Mode (server): <span class="literal">false</span></span><br><span class="line">Registry: https://index.docker.io/v1/</span><br><span class="line">Experimental: <span class="literal">false</span></span><br><span class="line">Insecure Registries:</span><br><span class="line"> 127.0.0.0/8</span><br><span class="line">Registry Mirrors:       <span class="comment"># é•œåƒä»£ç†</span></span><br><span class="line"> http://172d594a.m.daocloud.io/</span><br><span class="line">Live Restore Enabled: <span class="literal">false</span></span><br></pre></td></tr></table></figure>



<h2 id="è¿è¡Œ-hello-world-å®¹å™¨"><a href="#è¿è¡Œ-hello-world-å®¹å™¨" class="headerlink" title="è¿è¡Œ hello-world å®¹å™¨"></a>è¿è¡Œ hello-world å®¹å™¨</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker run hello-world</span></span><br><span class="line">Unable to find image <span class="string">'hello-world:latest'</span> locally   <span class="comment"># åœ¨æœ¬åœ°æ²¡æœ‰æ‰¾åˆ°è¯¥é•œåƒ</span></span><br><span class="line">latest: Pulling from library/hello-world        <span class="comment"># åœ¨è¿œç¨‹ä»“åº“ä¸­æŸ¥æ‰¾é•œåƒ</span></span><br><span class="line">78445dd45222: Pull complete         <span class="comment"># æ‹‰å–é•œåƒ</span></span><br><span class="line">Digest: sha256:c5515758d4c5e1e838e9cd307f6c6a0d620b5e07e6f927b07d05f6d12a1ac8d7</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> hello-world:latest <span class="comment"># é•œåƒæ‹‰å–å®Œæ¯•</span></span><br><span class="line"><span class="comment">#  ------ä»¥ä¸‹å†…å®¹æ˜¯è¿è¡Œå®¹å™¨æ—¶æ‰“å°åˆ°å±å¹•çš„å†…å®¹------</span></span><br><span class="line">Hello from Docker!</span><br><span class="line">This message shows that your installation appears to be working correctly.</span><br><span class="line"></span><br><span class="line">To generate this message, Docker took the following steps:</span><br><span class="line"> 1. The Docker client contacted the Docker daemon.</span><br><span class="line"> 2. The Docker daemon pulled the <span class="string">"hello-world"</span> image from the Docker Hub.</span><br><span class="line"> 3. The Docker daemon created a new container from that image <span class="built_in">which</span> runs the</span><br><span class="line">    executable that produces the output you are currently reading.</span><br><span class="line"> 4. The Docker daemon streamed that output to the Docker client, <span class="built_in">which</span> sent it</span><br><span class="line">    to your terminal.</span><br><span class="line"></span><br><span class="line">To try something more ambitious, you can run an Ubuntu container with:</span><br><span class="line"> $ docker run -it ubuntu bash</span><br><span class="line"></span><br><span class="line">Share images, automate workflows, and more with a free Docker ID:</span><br><span class="line"> https://cloud.docker.com/</span><br><span class="line"></span><br><span class="line">For more examples and ideas, visit:</span><br><span class="line"> https://docs.docker.com/engine/userguide/</span><br></pre></td></tr></table></figure>



<h1 id="æŸ¥çœ‹å®¹å™¨çŠ¶æ€"><a href="#æŸ¥çœ‹å®¹å™¨çŠ¶æ€" class="headerlink" title="æŸ¥çœ‹å®¹å™¨çŠ¶æ€"></a>æŸ¥çœ‹å®¹å™¨çŠ¶æ€</h1><h2 id="æŸ¥çœ‹è¿è¡ŒçŠ¶æ€çš„å®¹å™¨"><a href="#æŸ¥çœ‹è¿è¡ŒçŠ¶æ€çš„å®¹å™¨" class="headerlink" title="æŸ¥çœ‹è¿è¡ŒçŠ¶æ€çš„å®¹å™¨"></a>æŸ¥çœ‹è¿è¡ŒçŠ¶æ€çš„å®¹å™¨</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">root@ubuntu:~<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class="line">root@ubuntu:~<span class="comment">#</span></span><br></pre></td></tr></table></figure>



<p>æŸ¥çœ‹æ‰€æœ‰çŠ¶æ€çš„å®¹å™¨</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker ps -a</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                     PORTS               NAMES</span><br><span class="line">9c6fd12bef22        hello-world         <span class="string">"/hello"</span>            4 minutes ago       Exited (0) 4 minutes ago                       wizardly_mccarthy</span><br><span class="line">root@ubuntu:~<span class="comment">#</span></span><br></pre></td></tr></table></figure>



<h1 id="æ›´æ”¹å®¹å™¨åç§°"><a href="#æ›´æ”¹å®¹å™¨åç§°" class="headerlink" title="æ›´æ”¹å®¹å™¨åç§°"></a>æ›´æ”¹å®¹å™¨åç§°</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># docker run --name "sayHi" hello-world</span></span><br><span class="line">root@ubuntu:~<span class="comment"># docker ps -a</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                     PORTS               NAMES</span><br><span class="line">a74123af6f47        hello-world         <span class="string">"/hello"</span>            5 seconds ago       Exited (0) 4 seconds ago                       sayHi</span><br><span class="line">9c6fd12bef22        hello-world         <span class="string">"/hello"</span>            7 minutes ago       Exited (0) 7 minutes ago                       wizardly_mccarthy</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title>nginxé…ç½®httpå¼ºåˆ¶è·³è½¬https</title>
    <url>/2017/04/01/nginx%E9%85%8D%E7%BD%AEhttp%E5%BC%BA%E5%88%B6%E8%B7%B3%E8%BD%AChttps/</url>
    <content><![CDATA[<blockquote>
<p>å¾ˆå¤šç½‘ç«™è™½ç„¶æ”¯æŒ https, ä½†æ˜¯ç›´æ¥åœ¨æµè§ˆå™¨åœ°å€æ è¾“å…¥ç½‘å€å, é»˜è®¤ä»æ˜¯ä»¥ http åè®®å»è®¿é—®çš„, http å¼ºåˆ¶è·³è½¬ https çš„éœ€æ±‚åº”è¿è€Œç”Ÿ, ä»¥ä¸‹ä»‹ç»ä¸‰ç§å®ç°çš„æ–¹å¼</p>
</blockquote>
<h1 id="rewrite-æ–¹æ³•"><a href="#rewrite-æ–¹æ³•" class="headerlink" title="rewrite æ–¹æ³•"></a>rewrite æ–¹æ³•</h1><p>è¿™æ˜¯æœ€å¸¸ç”¨çš„å®ç°æ–¹æ³•, å°†æ‰€æœ‰ http è¯·æ±‚é€šè¿‡ rewrite é‡å®šå‘åˆ° https å³å¯</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">server &#123;  </span><br><span class="line">    listen  80;</span><br><span class="line">    server_name docs.lvrui.io</span><br><span class="line">      </span><br><span class="line">    rewrite ^(.*)$  https:&#x2F;&#x2F;$host$1 permanent;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen 443 ssl;</span><br><span class="line">    server_name docs.lvrui.io;</span><br><span class="line">    index index.html index.htm;</span><br><span class="line">    access_log  &#x2F;var&#x2F;log&#x2F;nginx&#x2F;docs.log  main;</span><br><span class="line">    ssl on;</span><br><span class="line">    ssl_certificate &#x2F;etc&#x2F;ssl&#x2F;docs.20150509.cn.crt;</span><br><span class="line">    ssl_certificate_key  &#x2F;etc&#x2F;ssl&#x2F;docs.20150509.cn.key;</span><br><span class="line">    error_page 404 &#x2F;404.html;</span><br><span class="line">    location &#x2F; &#123;</span><br><span class="line">	    root &#x2F;var&#x2F;www&#x2F;html&#x2F;docs;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="497-çŠ¶æ€ç "><a href="#497-çŠ¶æ€ç " class="headerlink" title="497 çŠ¶æ€ç "></a>497 çŠ¶æ€ç </h1><p>error code 497: normal request was sent to HTTPS</p>
<p>åœ¨ä¸€ä¸ªç«™ç‚¹åªå…è®¸ https è®¿é—®æ—¶, å¦‚æœä½¿ç”¨ http è®¿é—®ä¼šæŠ¥å‡º497é”™è¯¯ç </p>
<p>åˆ©ç”¨497çŠ¶æ€ç é‡å®šå‘åˆ° https</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name docs.lvrui.io</span><br><span class="line">    </span><br><span class="line">    error_page 497  https:&#x2F;&#x2F;$host$uri?$args;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen 443 ssl;</span><br><span class="line">    server_name docs.lvrui.io;</span><br><span class="line">    index index.html index.htm;</span><br><span class="line">    access_log  &#x2F;var&#x2F;log&#x2F;nginx&#x2F;docs.log  main;</span><br><span class="line">    ssl on;</span><br><span class="line">    ssl_certificate &#x2F;etc&#x2F;ssl&#x2F;docs.20150509.cn.crt;</span><br><span class="line">    ssl_certificate_key  &#x2F;etc&#x2F;ssl&#x2F;docs.20150509.cn.key;</span><br><span class="line">    error_page 404 &#x2F;404.html;</span><br><span class="line">    location &#x2F; &#123;</span><br><span class="line">	    root &#x2F;var&#x2F;www&#x2F;html&#x2F;docs;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="index-html-åˆ·æ–°ç½‘é¡µ"><a href="#index-html-åˆ·æ–°ç½‘é¡µ" class="headerlink" title="index.html åˆ·æ–°ç½‘é¡µ"></a>index.html åˆ·æ–°ç½‘é¡µ</h1><p>ä¸Šé¢ä¸¤ç§æ–¹æ³•å‡ä¼šè€—è´¹æœåŠ¡å™¨èµ„æº, æˆ‘ä»¬ä½¿ç”¨ <code>curl</code> æ¥çœ‹ä¸‹ç™¾åº¦æ˜¯å¦‚ä½•å®ç°çš„ <code>baidu.com</code> å‘ <code>www.baidu.com</code> çš„è·³è½¬</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ curl baidu.com -vv </span><br><span class="line">* Rebuilt URL to: baidu.com/</span><br><span class="line">*   Trying 220.181.57.217...</span><br><span class="line">* TCP_NODELAY <span class="built_in">set</span></span><br><span class="line">* Connected to baidu.com (220.181.57.217) port 80 (<span class="comment">#0)</span></span><br><span class="line">&gt; GET / HTTP/1.1</span><br><span class="line">&gt; Host: baidu.com</span><br><span class="line">&gt; User-Agent: curl/7.51.0</span><br><span class="line">&gt; Accept: */*</span><br><span class="line">&gt; </span><br><span class="line">&lt; HTTP/1.1 200 OK</span><br><span class="line">&lt; Date: Sat, 01 Apr 2017 06:32:35 GMT</span><br><span class="line">&lt; Server: Apache</span><br><span class="line">&lt; Last-Modified: Tue, 12 Jan 2010 13:48:00 GMT</span><br><span class="line">&lt; ETag: <span class="string">"51-47cf7e6ee8400"</span></span><br><span class="line">&lt; Accept-Ranges: bytes</span><br><span class="line">&lt; Content-Length: 81</span><br><span class="line">&lt; Cache-Control: max-age=86400</span><br><span class="line">&lt; Expires: Sun, 02 Apr 2017 06:32:35 GMT</span><br><span class="line">&lt; Connection: Keep-Alive</span><br><span class="line">&lt; Content-Type: text/html</span><br><span class="line">&lt; </span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">"refresh"</span> content=<span class="string">"0;url=http://www.baidu.com/"</span>&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line">* Curl_http_done: called premature == 0</span><br><span class="line">* Connection <span class="comment">#0 to host baidu.com left intact</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ç™¾åº¦å¾ˆå·§å¦™çš„åˆ©ç”¨metaçš„åˆ·æ–°ä½œç”¨ï¼Œå°†baidu.comè·³è½¬åˆ°<a href="http://www.baidu.com" target="_blank" rel="noopener">www.baidu.com</a></p>
<p>åŒç†, æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨è¿™ä¸ªç‰¹æ€§æ¥å®ç° http å‘ https çš„è·³è½¬</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"># index.html</span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"refresh"</span> <span class="attr">content</span>=<span class="string">"0;url=https://docs.lvrui.io/"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name docs.lvrui.io;</span><br><span class="line">    </span><br><span class="line">    location &#x2F; &#123;</span><br><span class="line">        # å°† index.html æ–‡ä»¶æ”¾åˆ°ä¸‹é¢çš„ç›®å½•ä¸‹</span><br><span class="line">        root &#x2F;var&#x2F;www&#x2F;html&#x2F;refresh&#x2F;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen 443 ssl;</span><br><span class="line">    server_name docs.lvrui.io;</span><br><span class="line">    index index.html index.htm;</span><br><span class="line">    access_log  &#x2F;var&#x2F;log&#x2F;nginx&#x2F;docs.log  main;</span><br><span class="line">    ssl on;</span><br><span class="line">    ssl_certificate &#x2F;etc&#x2F;ssl&#x2F;docs.20150509.cn.crt;</span><br><span class="line">    ssl_certificate_key  &#x2F;etc&#x2F;ssl&#x2F;docs.20150509.cn.key;</span><br><span class="line">    error_page 404 &#x2F;404.html;</span><br><span class="line">    location &#x2F; &#123;</span><br><span class="line">	    root &#x2F;var&#x2F;www&#x2F;html&#x2F;docs;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Nginx</tag>
        <tag>https</tag>
        <tag>rewrite</tag>
      </tags>
  </entry>
  <entry>
    <title>æ‰¾å›Jenkinså¯†ç </title>
    <url>/2017/04/01/%E6%89%BE%E5%9B%9EJenkins%E5%AF%86%E7%A0%81/</url>
    <content><![CDATA[<blockquote>
<p>é€šè¿‡ä¿®æ”¹ Jenkins çš„é…ç½®æ–‡ä»¶, å°†ç™»å½•éœ€è¦å¯†ç éªŒè¯çš„åŠŸèƒ½ä¸´æ—¶å–æ¶ˆ, é‡å¯ Jenkins, æ— å¯†ç ç™»å½•åå†ä¿®æ”¹å¯¹åº”ç”¨æˆ·çš„å¯†ç , æœ€åå¯ä»¥æ”¹å›å¯†ç éªŒè¯æ¨¡å¼</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥ Jenkins å®¶ç›®å½•</span></span><br><span class="line">$ <span class="built_in">cd</span> /var/lib/jenkins/</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤‡ä»½é…ç½®æ–‡ä»¶</span></span><br><span class="line">$ cp config.xml config.xml.20170401</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹é…ç½®æ–‡ä»¶</span></span><br><span class="line">vim config.xml</span><br><span class="line"></span><br><span class="line">&lt;useSecurity&gt;<span class="literal">true</span>&lt;/useSecurity&gt;  </span><br><span class="line"><span class="comment"># ä¿®æ”¹æˆ  </span></span><br><span class="line">&lt;useSecurity&gt;<span class="literal">false</span>&lt;/useSecurity&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡å¯ Jenkins å³å¯æ— å¯†ç ç™»å½•</span></span><br><span class="line">systemctl restart jenkins</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Jenkins</tag>
      </tags>
  </entry>
  <entry>
    <title>åœ¨Linuxä¸­æ­å»ºç‚¹å¯¹ç‚¹IPsecéš§é“</title>
    <url>/2017/03/31/%E5%9C%A8Linux%E4%B8%AD%E6%90%AD%E5%BB%BA%E7%82%B9%E5%AF%B9%E7%82%B9IPsec%E9%9A%A7%E9%81%93/</url>
    <content><![CDATA[<blockquote>
<p>éš§é“æŠ€æœ¯è¿‘å¹´æ¥å¤šç”¨äºå®ç°æ··åˆäº‘çš„åœºæ™¯, å®ç°äº‘ç¯å¢ƒåˆ°è‡ªå·±çš„ IDC æœºæˆ¿, A äº‘åˆ° B äº‘ç­‰éœ€æ±‚.æœ¬ç¯‡æ–‡æ¡£ä¸»è¦ä»‹ç»ä¸¤ä¸ªäº‘ä¹‹é—´, ä½¿ç”¨ Linux æœåŠ¡å™¨åšå¯¹æ¥çš„æƒ…å†µ. </p>
</blockquote>
<p>å…·ä½“åŸç†è¿™é‡Œä¸è®², ä¸»è¦è®²å…·ä½“æ­å»ºæ­¥éª¤, è¿™é‡Œæˆ‘å‡†å¤‡äº†ä¸¤ä¸ªè„šæœ¬æ¥æ­å»ºéš§é“ç¯å¢ƒ</p>
<p><strong>configIPsec.sh</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…è½¯ä»¶</span></span><br><span class="line">yum install -y openswan lsof</span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®å†…æ ¸å‚æ•°</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">""</span><span class="string">"net.ipv4.tcp_syncookies = 1</span></span><br><span class="line"><span class="string">net.ipv4.tcp_tw_reuse = 1</span></span><br><span class="line"><span class="string">net.ipv4.tcp_tw_recycle = 1</span></span><br><span class="line"><span class="string">net.ipv4.tcp_fin_timeout = 30</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">net.ipv6.conf.all.disable_ipv6 = 1</span></span><br><span class="line"><span class="string">net.ipv6.conf.default.disable_ipv6 = 1</span></span><br><span class="line"><span class="string">net.ipv6.conf.lo.disable_ipv6 = 1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">vm.swappiness = 0</span></span><br><span class="line"><span class="string">net.ipv4.neigh.default.gc_stale_time = 120</span></span><br><span class="line"><span class="string">net.ipv4.conf.all.rp_filter = 0</span></span><br><span class="line"><span class="string">net.ipv4.conf.default.rp_filter = 0</span></span><br><span class="line"><span class="string">net.ipv4.conf.default.arp_announce = 2</span></span><br><span class="line"><span class="string">net.ipv4.conf.lo.arp_announce = 2</span></span><br><span class="line"><span class="string">net.ipv4.conf.all.arp_announce = 2</span></span><br><span class="line"><span class="string">net.ipv4.tcp_max_tw_buckets = 5000</span></span><br><span class="line"><span class="string">net.ipv4.tcp_syncookies = 1</span></span><br><span class="line"><span class="string">net.ipv4.tcp_max_syn_backlog = 1024</span></span><br><span class="line"><span class="string">net.ipv4.tcp_synack_retries = 2</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">net.ipv4.conf.all.accept_redirects = 0</span></span><br><span class="line"><span class="string">net.ipv4.conf.all.send_redirects = 0</span></span><br><span class="line"><span class="string">net.ipv4.conf.default.accept_redirects = 0</span></span><br><span class="line"><span class="string">net.ipv4.conf.default.send_redirects = 0</span></span><br><span class="line"><span class="string">net.ipv4.conf.eth0.accept_redirects = 0</span></span><br><span class="line"><span class="string">net.ipv4.conf.eth0.send_redirects = 0</span></span><br><span class="line"><span class="string">net.ipv4.conf.lo.accept_redirects = 0</span></span><br><span class="line"><span class="string">net.ipv4.conf.lo.send_redirects = 0</span></span><br><span class="line"><span class="string">net.ipv4.conf.default.rp_filter=0</span></span><br><span class="line"><span class="string">net.ipv4.conf.eth0.rp_filter=0</span></span><br><span class="line"><span class="string">#net.ipv4.conf.ip_vti0.rp_filter=0</span></span><br><span class="line"><span class="string">net.ipv4.ip_forward = 1"</span><span class="string">""</span> &gt;&gt; /etc/sysctl.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®©é…ç½®çš„å†…æ ¸å‚æ•°ç«‹å³ç”Ÿæ•ˆ</span></span><br><span class="line">sysctl -p</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡å¯ ipsec æœåŠ¡</span></span><br><span class="line">systemctl restart ipsec</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¼‘çœ 2ç§’æ˜¯ä¸ºäº†è®© udp 4500 å’Œ 500ç«¯å£æ­£å¸¸ç›‘å¬</span></span><br><span class="line">sleep 2</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æŸ¥ç¯å¢ƒæ˜¯å¦ç¬¦åˆè¦æ±‚</span></span><br><span class="line">ipsec verify</span><br></pre></td></tr></table></figure>

<p>åœ¨æ‰§è¡Œ <code>ipsec verify</code> å‘½ä»¤å, å¿…é¡»ä¿è¯å¦‚ä¸‹å›æ˜¾ä¸­æ‰€æœ‰çš„çŠ¶æ€å‡ä¸ºç»¿è‰² (Hardware random device å¯ä»¥ä¸º[N/A]; Opportunistic Encryption å¯ä»¥ä¸º [DISABLE]; å…¶ä»–å‡ä¸º ok)</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@99-5 ~]<span class="comment"># ipsec verify</span></span><br><span class="line">Verifying installed system and configuration files</span><br><span class="line"></span><br><span class="line">Version check and ipsec on-path                         [OK]</span><br><span class="line">Libreswan 3.15 (netkey) on 3.10.0-327.18.2.el7.x86_64</span><br><span class="line">Checking <span class="keyword">for</span> IPsec support <span class="keyword">in</span> kernel                    [OK]</span><br><span class="line"> NETKEY: Testing XFRM related proc values</span><br><span class="line">         ICMP default/send_redirects                    [OK]</span><br><span class="line">         ICMP default/accept_redirects                  [OK]</span><br><span class="line">         XFRM larval drop                               [OK]</span><br><span class="line">Pluto ipsec.conf syntax                                 [OK]</span><br><span class="line">Hardware random device                                  [N/A]</span><br><span class="line">Two or more interfaces found, checking IP forwarding    [OK]</span><br><span class="line">Checking rp_filter                                      [OK]</span><br><span class="line">Checking that pluto is running                          [OK]</span><br><span class="line"> Pluto listening <span class="keyword">for</span> IKE on udp 500                     [OK]</span><br><span class="line"> Pluto listening <span class="keyword">for</span> IKE/NAT-T on udp 4500              [OK]</span><br><span class="line"> Pluto ipsec.secret syntax                              [OK]</span><br><span class="line">Checking <span class="string">'ip'</span> <span class="built_in">command</span>                                   [OK]</span><br><span class="line">Checking <span class="string">'iptables'</span> <span class="built_in">command</span>                             [OK]</span><br><span class="line">Checking <span class="string">'prelink'</span> <span class="built_in">command</span> does not interfere with FIPSChecking <span class="keyword">for</span> obsolete ipsec.conf options                 [OK]</span><br><span class="line">Opportunistic Encryption                                [DISABLED]</span><br></pre></td></tr></table></figure>

<p>ä¿è¯ä¸Šé¢çš„ç¯å¢ƒæ£€æŸ¥é€šè¿‡å, æ‰§è¡Œå¦‚ä¸‹è„šæœ¬ <code>configTunnel.sh</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###### å¯¹ç«¯ç½‘ç»œé…ç½®</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¹ç«¯å…¬ç½‘ IP</span></span><br><span class="line">ip_remote=<span class="string">"59.110.174.253"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¹ç«¯å†…ç½‘ç½‘æ®µ</span></span><br><span class="line">ip_remote_vlan=<span class="string">"192.168.20.0/24"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">###### æœ¬ç«¯ç½‘ç»œé…ç½®</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å–å…¬ç½‘ IP</span></span><br><span class="line">ip_public=`curl http://members.3322.org/dyndns/getip`</span><br><span class="line"></span><br><span class="line"><span class="comment"># å–å†…ç½‘ IP</span></span><br><span class="line">ip_private=`ifconfig  | grep <span class="string">"inet"</span> | grep <span class="string">"192.168"</span> | awk <span class="string">'&#123;print $2&#125;'</span>`</span><br><span class="line"></span><br><span class="line"><span class="comment"># å–å†…ç½‘ IP çš„ç¬¬ä¸‰æ®µä½œä¸ºéš§é“åå’Œé…ç½®æ–‡ä»¶åå­—çš„ä¸€éƒ¨åˆ†</span></span><br><span class="line">net_vlan=`ifconfig  | grep <span class="string">"inet"</span> | grep <span class="string">"192.168"</span> | awk <span class="string">'&#123;print $2&#125;'</span> | awk -F <span class="string">"."</span> <span class="string">'&#123;print $3&#125;'</span>`</span><br><span class="line"></span><br><span class="line"><span class="comment"># æœ¬åœ°ç½‘æ®µ</span></span><br><span class="line">subnet=<span class="string">"192.168.59.0/24"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###### ç§˜é’¥</span></span><br><span class="line">token=<span class="string">"20150509"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###### é…ç½®æ–‡ä»¶</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ›´æ”¹ ipsec é…ç½®æ–‡ä»¶</span></span><br><span class="line">sed -i <span class="string">'s/#version 2/version 2/g'</span> /etc/ipsec.conf </span><br><span class="line">sed -i <span class="string">'/protostack=netkey/a\        nat_traversal=yes\n        oe=off'</span> /etc/ipsec.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºéš§é“é…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">""</span><span class="string">"conn tunnel<span class="variable">$net_vlan</span></span></span><br><span class="line"><span class="string">        ike=3des-sha</span></span><br><span class="line"><span class="string">        authby=secret</span></span><br><span class="line"><span class="string">        phase2=esp</span></span><br><span class="line"><span class="string">        phase2alg=3des-sha</span></span><br><span class="line"><span class="string">        compress=no</span></span><br><span class="line"><span class="string">        pfs=yes</span></span><br><span class="line"><span class="string">        type=tunnel</span></span><br><span class="line"><span class="string">        left=<span class="variable">$ip_private</span></span></span><br><span class="line"><span class="string">        leftid=<span class="variable">$ip_public</span></span></span><br><span class="line"><span class="string">        leftsubnet=<span class="variable">$subnet</span></span></span><br><span class="line"><span class="string">        leftnexthop=%defaultroute</span></span><br><span class="line"><span class="string">        right=<span class="variable">$ip_remote</span></span></span><br><span class="line"><span class="string">        rightid=<span class="variable">$ip_remote</span></span></span><br><span class="line"><span class="string">        rightsubnet=<span class="variable">$ip_remote_vlan</span></span></span><br><span class="line"><span class="string">        rightnexthop=%defaultroute</span></span><br><span class="line"><span class="string">        auto=start"</span><span class="string">""</span> &gt;&gt; /etc/ipsec.d/tunnel<span class="string">"<span class="variable">$net_vlan</span>"</span>.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®ç§˜é’¥è®¤è¯</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"0.0.0.0 <span class="variable">$ip_remote</span>: PSK \"<span class="variable">$token</span>\""</span> &gt;&gt; /etc/ipsec.secrets </span><br><span class="line"></span><br><span class="line">systemctl restart ipsec</span><br></pre></td></tr></table></figure>

<p>é…ç½®å®Œæ¯•å, å¯åŠ¨è¯¥æ¡éš§é“</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ipsec auto --up tunnelName</span><br></pre></td></tr></table></figure>

<p><em>æ³¨æ„: è¿™é‡Œçš„ tunnelName æ˜¯ä¸Šé¢çš„è„šæœ¬ä¸­æ ¹æ®ç½‘æ®µåºå·ç”Ÿæˆçš„, æ¢æˆä¸Šé¢ç”Ÿæˆçš„éš§é“åå³å¯</em></p>
<hr>
<p>å•è¾¹é…ç½®å¥½å, åœ¨å¯¹ç«¯ä»¥åŒæ ·çš„æ–¹å¼é…ç½®å¹¶å¯åŠ¨éš§é“å³å¯</p>
<hr>
<p>å‚è€ƒæ–‡æ¡£:</p>
<p><a href="http://blog.leanote.com/post/251689658@qq.com/é˜¿é‡Œäº‘openwanä¸ç½‘åº·å®ç°IPsecå¯¹æ¥" target="_blank" rel="noopener">http://blog.leanote.com/post/251689658@qq.com/é˜¿é‡Œäº‘openwanä¸ç½‘åº·å®ç°IPsecå¯¹æ¥</a></p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>IPsec</tag>
        <tag>éš§é“</tag>
      </tags>
  </entry>
  <entry>
    <title>Install Docker From Ali Mirror</title>
    <url>/2017/03/21/Install-Docker-From-Ali-Mirror/</url>
    <content><![CDATA[<blockquote>
<p>è™½ç„¶å‰é¢ä»‹ç»äº†å¤šç§ç³»ç»Ÿä¸Šçš„å®‰è£…æ–¹å¼, ä½†æ˜¯æœ‰ä¸€ç‚¹é¿ä¸å¼€çš„å°±æ˜¯ä¼Ÿå¤§çš„é•¿åŸé˜²ğŸ”¥å¢™, å³ä½¿æ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒ,  ä»å®˜æ–¹æºå®‰è£… Dockerä¹Ÿæ˜¯ä¸€ä»¶ç—›è‹¦çš„äº‹æƒ…, è§£å†³è¿™ä¸ªé—®é¢˜çš„æ€è·¯æ— éå°±ä¸¤ç§. ä¸€ç§æ˜¯æˆ‘ä»¬è‡ªå·±åœ¨å†…ç½‘ç»´æŠ¤ä¸€å¥— Docker çš„è½¯ä»¶æº. å¦ä¸€ç§å°±æ˜¯ç”¨å…¶ä»–äººåœ¨ğŸ‡¨ğŸ‡³æ­å»ºçš„ Docker æº. æœ¬ç¯‡æ–‡ä»¶å°±ä»‹ç»å¦‚æœé€šè¿‡é˜¿é‡Œçš„ Docker è½¯ä»¶æºæ¥è§£å†³å›½å†… Docker çš„å®‰è£…é—®é¢˜</p>
</blockquote>
<p>é˜¿é‡Œé•œåƒç½‘ç«™å®˜æ–¹åœ°å€: &lt; <a href="http://mirrors.aliyun.com/help/docker-engine" target="_blank" rel="noopener">docker-engine</a> &gt;</p>
<p>é˜¿é‡Œå¾ˆè´´å¿ƒçš„ä¸ä»…æä¾›äº†å›½å†…çš„é•œåƒæº, è€Œä¸”è¿˜æä¾›äº†ä¸€é”®å®‰è£…è„šæœ¬, è¯¥è„šæœ¬åœ¨æˆ‘çš„ Ubuntu16.04 å’Œ Fedora 25 ä¸Šé€šè¿‡äº†æµ‹è¯•. </p>
<p>é˜¿é‡Œå®˜æ–¹æä¾›ä»¥ä¸‹ç³»ç»Ÿå®‰è£… Docker çš„æ”¯æŒ</p>
<ul>
<li>Ubuntu 14.04 16.04</li>
</ul>
<ul>
<li>Debian 7.7 8.0</li>
<li>CentOS 7</li>
<li>Fedora 20 21 22</li>
<li>Oracle Linux 6 7</li>
</ul>
<p>å®‰è£…æ–¹å¼:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl -sSL http://acs-public-mirror.oss-cn-hangzhou.aliyuncs.com/docker-engine/internet | sh -</span><br></pre></td></tr></table></figure>

<p>é˜¿é‡Œäº‘ä¸»æœºå†…ç½‘å®‰è£…æ–¹å¼:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl -sSL http://acs-public-mirror.oss-cn-hangzhou.aliyuncs.com/docker-engine/intranet | sh -</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œå®Œä¸Šé¢çš„å‘½ä»¤åå³å®‰è£…å®Œæˆ, æœ€åæˆ‘ä»¬ çœ‹ä¸‹, ä¸Šé¢çš„è„šæœ¬æ˜¯æ€ä¹ˆå¸®æˆ‘ä»¬é…ç½® yum/dnf æºçš„</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@191 yum.repos.d]<span class="comment"># cat docker-main.repo </span></span><br><span class="line">[docker-main-repo]</span><br><span class="line">name=Docker main Repository</span><br><span class="line">baseurl=http://mirrors.aliyun.com/docker-engine/yum/repo/main/fedora/25</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=http://mirrors.aliyun.com/docker-engine/yum/gpg</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šæ˜¯æˆ‘åœ¨<code>Fedora 25</code>ä¸Šæ‰§è¡Œå®‰è£… Docker çš„è„šæœ¬åçš„è½¯ä»¶æºé…ç½®</p>
<hr>
<p><strong>æ›´æ–°</strong></p>
<p>åœ¨DockeråŒºåˆ†CEç‰ˆæœ¬å’ŒEEç‰ˆæœ¬ä¹‹å, é˜¿é‡ŒåŸæœ‰çš„å®‰è£…é•œåƒç½‘ç«™å·²ä¸å†æä¾›æ”¯æŒ, æœ€æ–°çš„åœ°å€å¦‚ä¸‹:</p>
<ul>
<li><a href="https://yq.aliyun.com/articles/110806" target="_blank" rel="noopener">https://yq.aliyun.com/articles/110806</a></li>
</ul>
<p>å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚å®‰è£…å¯¹åº”çš„ç‰ˆæœ¬</p>
]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>Mirror</tag>
      </tags>
  </entry>
  <entry>
    <title>Docker For Fedora</title>
    <url>/2017/03/21/Docker-For-Fedora/</url>
    <content><![CDATA[<blockquote>
<p>ç†Ÿæ‚‰ RHEL å’Œ CentOS çš„äº²ä¸€å®šä¹Ÿå¬è¯´è¿‡ Fedora å‘è¡Œç‰ˆ, ç›¸æ¯”äºâ€ç²¾ä»¿ç‰ˆâ€çš„ CentOS, Fedora æ›´åƒæ˜¯ RHEL çš„è¿‘äº², ç”šè‡³æ˜¯äº²å„¿å­çš„åœ°ä½. åœ¨ RHEL ä¸Šä¸æ”¯æŒ Docker CE ä¸è¯´, åœ¨ CentOS ä¸Šè¿˜ä¾æ—§ä½¿ç”¨äº† 3.10+è¿™æ ·å¤è€çº§çš„å†…æ ¸ç‰ˆæœ¬. ç›´æ¥å¯¼è‡´ Docker çš„ä¸€äº›æœ€æ–°ç‰¹æ€§æ— æ³•åœ¨è¯¥å†…æ ¸ç‰ˆæœ¬ä¸Šå®ç°. é¡ºç†æˆç« çš„ Fedora Server ç‰ˆæˆäº†å®Œç¾ä½“éªŒ Docker çš„æœ€ä½³â€RHELâ€ å¹³å°</p>
</blockquote>
<p>æœ¬ç¯‡æ–‡ç« åªä»‹ç» Docker CE ç‰ˆæœ¬åœ¨  Fedora ç³»ç»Ÿä¸­çš„éƒ¨ç½²</p>
<h2 id="ç³»ç»Ÿéœ€æ±‚"><a href="#ç³»ç»Ÿéœ€æ±‚" class="headerlink" title="ç³»ç»Ÿéœ€æ±‚"></a>ç³»ç»Ÿéœ€æ±‚</h2><ul>
<li>64bit Fedora 24 Server</li>
</ul>
<ul>
<li>64bit Fedora 25 Server</li>
</ul>
<h2 id="å¸è½½è€ç‰ˆæœ¬-Docker-Engine"><a href="#å¸è½½è€ç‰ˆæœ¬-Docker-Engine" class="headerlink" title="å¸è½½è€ç‰ˆæœ¬ Docker Engine"></a>å¸è½½è€ç‰ˆæœ¬ Docker Engine</h2><p>è€ç‰ˆæœ¬çš„ Docker è¢«å«åš <code>docker</code> æˆ– <code>docker-engine</code> å¦‚æœç³»ç»Ÿå½“å‰æœ‰è¿™äº›ç‰ˆæœ¬çš„ç³»ç»Ÿ, é‚£ä¹ˆä½ éœ€è¦å…ˆå¸è½½ä»–ä»¬ </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo dnf remove docker \</span><br><span class="line">                  docker-common \</span><br><span class="line">                  container-selinux \</span><br><span class="line">                  docker-selinux \</span><br><span class="line">                  docker-engine</span><br></pre></td></tr></table></figure>

<p>éœ€è¦ <code>dnf</code> å‘½ä»¤çš„å›æ˜¾æ˜¾ç¤ºæ²¡æœ‰ç›¸å…³çš„è½¯ä»¶åŒ…è¢«å®‰è£…</p>
<p>åœ¨ <code>/var/lib/docker</code> ç›®å½•ä¸‹, åŒ…å«äº†<code>é•œåƒ</code>, <code>å®¹å™¨</code>, <code>æ•°æ®å·</code>å’Œ <code>ç½‘ç»œé…ç½®</code></p>
<p><em>è¯´æ˜: åœ¨ Fedora ä¸­, è½¯ä»¶åŒ…ç®¡ç†å™¨æ—©å°±å·²ç»å˜æˆä½¿ç”¨ dnf ç®¡ç†äº†, ä½ ä»æ—§å¯ä»¥ä½¿ç”¨ yum å‘½ä»¤, ä½†æ˜¯æœ€ç»ˆè¿˜æ˜¯ä¼šè¢«é‡å®šå‘åˆ° dnf. å€¼å¾—æ¬£æ…°çš„æ˜¯ dnf çš„ç”¨æ³•å’Œ yum çš„ç”¨æ³•å‡ ä¹æ˜¯å®Œå…¨ä¸€æ ·çš„, å°±è¿è½¯ä»¶æºé…ç½®æ–‡ä»¶çš„ä½ç½®å’Œæ ¼å¼ä¹Ÿæ˜¯é€šç”¨çš„</em></p>
<h2 id="å®‰è£…-Docker"><a href="#å®‰è£…-Docker" class="headerlink" title="å®‰è£… Docker"></a>å®‰è£… Docker</h2><h3 id="ä»è½¯ä»¶æºä¸­å®‰è£…-Docker"><a href="#ä»è½¯ä»¶æºä¸­å®‰è£…-Docker" class="headerlink" title="ä»è½¯ä»¶æºä¸­å®‰è£… Docker"></a>ä»è½¯ä»¶æºä¸­å®‰è£… Docker</h3><h4 id="é…ç½®è½¯ä»¶ä»“åº“-Docker-CE"><a href="#é…ç½®è½¯ä»¶ä»“åº“-Docker-CE" class="headerlink" title="é…ç½®è½¯ä»¶ä»“åº“ Docker-CE"></a>é…ç½®è½¯ä»¶ä»“åº“ Docker-CE</h4><ul>
<li>å®‰è£… <code>dnf-plugins-core</code> å·¥å…·é›†, ä»¥æä¾› <code>dnf config-manager</code>å‘½ä»¤çš„æ”¯æŒ</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo dnf -y install dnf-plugins-core</span><br></pre></td></tr></table></figure>

<ul>
<li>é…ç½® Docker è½¯ä»¶æº (Stable)</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo dnf config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https://download.docker.com/linux/fedora/docker-ce.repo</span><br></pre></td></tr></table></figure>

<ul>
<li>å¼€å¯/å…³é—­ å¼€å‘ç‰ˆ(edge) Docker è½¯ä»¶æº</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo dnf config-manager --<span class="built_in">enable</span> docker-ce-edge</span><br><span class="line">$ sudo dnf config-manager --<span class="built_in">disable</span> docker-ce-edge</span><br></pre></td></tr></table></figure>

<h4 id="å®‰è£…-Docker-CE"><a href="#å®‰è£…-Docker-CE" class="headerlink" title="å®‰è£… Docker CE"></a>å®‰è£… Docker CE</h4><ul>
<li>æ›´æ–°è½¯ä»¶æºç´¢å¼•</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo dnf makecache fast</span><br></pre></td></tr></table></figure>

<p>æ¥å— GPG key</p>
<ul>
<li>å®‰è£… Docker</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo dnf install docker-ce  <span class="comment"># å®‰è£…æœ€æ–°ç‰ˆæœ¬</span></span><br><span class="line">$ sudo dnf -y install docker-ce-&lt;VERSION&gt;  <span class="comment"># å®‰è£…æŒ‡å®šç‰ˆæœ¬</span></span><br></pre></td></tr></table></figure>

<ul>
<li>å¯åŠ¨ Docker</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo systemctl start docker</span><br><span class="line">$ sudo systemctl <span class="built_in">enable</span> docker</span><br></pre></td></tr></table></figure>

<ul>
<li>éªŒè¯ Docker EE æ­£å¸¸è¿è¡Œ</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo docker run hello-world</span><br></pre></td></tr></table></figure>

<ul>
<li>å‡çº§ Docker</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo dnf makecache fast</span><br><span class="line">$ sudo dnf update docker-ce <span class="comment"># sudo dnf upgrade docker-ce ä¸¤è€…ç­‰ä»·</span></span><br></pre></td></tr></table></figure>


<h3 id="ä½¿ç”¨è½¯ä»¶åŒ…ç›´æ¥å®‰è£…"><a href="#ä½¿ç”¨è½¯ä»¶åŒ…ç›´æ¥å®‰è£…" class="headerlink" title="ä½¿ç”¨è½¯ä»¶åŒ…ç›´æ¥å®‰è£…"></a>ä½¿ç”¨è½¯ä»¶åŒ…ç›´æ¥å®‰è£…</h3><ul>
<li>ä¸‹è½½å¯¹åº”ç‰ˆæœ¬çš„ <code>.rpm</code> è½¯ä»¶åŒ…</li>
</ul>
<p>Docker CE: Go to <a href="https://download.docker.com/linux/fedora/7/x86_64/stable/" target="_blank" rel="noopener">https://download.docker.com/linux/fedora/7/x86_64/stable/</a>  and download the <code>.rpm</code></p>
<ul>
<li>å®‰è£…è½¯ä»¶åŒ…</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo dnf -y install /path/to/package.rpm</span><br></pre></td></tr></table></figure>

<ul>
<li>å¯åŠ¨ Docker æœåŠ¡</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo systemctl start docker</span><br><span class="line">$ sudo systemctl <span class="built_in">enable</span> docker</span><br></pre></td></tr></table></figure>

<ul>
<li>éªŒè¯ Docker æœåŠ¡æ­£å¸¸è¿è¡Œ</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo docker run hello-world</span><br></pre></td></tr></table></figure>

<h2 id="å¸è½½-Docker-CE"><a href="#å¸è½½-Docker-CE" class="headerlink" title="å¸è½½ Docker CE"></a>å¸è½½ Docker CE</h2><ul>
<li>å¸è½½ Docker CE</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo dnf remove docker-ce</span><br></pre></td></tr></table></figure>

<ul>
<li>é•œåƒ/å®¹å™¨/æ•°æ®å·å’Œè‡ªå®šä¹‰é…ç½®æ–‡ä»¶ä¸ä¼šéšç€å¸è½½è€Œè‡ªåŠ¨åˆ é™¤, ä½ éœ€è¦æ‰‹åŠ¨å»æ¸…é™¤ä»–ä»¬</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo rm -rf /var/lib/docker</span><br></pre></td></tr></table></figure>

<hr>
<p>å‚è€ƒå®˜æ–¹æ–‡æ¡£:</p>
<ul>
<li><a href="https://docs.docker.com/engine/installation/linux/fedora/" target="_blank" rel="noopener">Get Docker for Fedora - Docker Documentation</a></li>
</ul>
]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title>Docker For CentOS</title>
    <url>/2017/03/21/Docker-For-CentOS/</url>
    <content><![CDATA[<blockquote>
<p>CentOSæ˜¯ RHEL çš„è¿‘äº², åœ¨äºå¯¹ Docker çš„æ”¯æŒæ–¹é¢, CentOS è¦æ¯” RHEL å¥½ä¸€äº›, è‡³å°‘, CentOS æ”¯æŒ Docker CE ç‰ˆæœ¬çš„éƒ¨ç½². åœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­, CentOS æœåŠ¡å™¨å æœ‰å¾ˆå¤§çš„æ¯”é‡, ä½†æ˜¯å¦‚æœéœ€è¦åœ¨ CentOS ç³»ç»Ÿä¸­ä½¿ç”¨ Docker, æ¯”è¾ƒæ¨èå°†å†…æ ¸å‡çº§åˆ°4.0+</p>
</blockquote>
<p>æœ¬ç¯‡æ–‡ç« åªä»‹ç» Docker CE ç‰ˆæœ¬åœ¨ CentOS ç³»ç»Ÿä¸­çš„éƒ¨ç½²</p>
<h2 id="ç³»ç»Ÿéœ€æ±‚"><a href="#ç³»ç»Ÿéœ€æ±‚" class="headerlink" title="ç³»ç»Ÿéœ€æ±‚"></a>ç³»ç»Ÿéœ€æ±‚</h2><ul>
<li>64bit CentOS 7</li>
</ul>
<h2 id="å¸è½½è€ç‰ˆæœ¬-Docker-Engine"><a href="#å¸è½½è€ç‰ˆæœ¬-Docker-Engine" class="headerlink" title="å¸è½½è€ç‰ˆæœ¬ Docker Engine"></a>å¸è½½è€ç‰ˆæœ¬ Docker Engine</h2><p>è€ç‰ˆæœ¬çš„ Docker è¢«å«åš <code>docker</code> æˆ– <code>docker-engine</code> å¦‚æœç³»ç»Ÿå½“å‰æœ‰è¿™äº›ç‰ˆæœ¬çš„ç³»ç»Ÿ, é‚£ä¹ˆä½ éœ€è¦å…ˆå¸è½½ä»–ä»¬ </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo yum remove docker \</span><br><span class="line">                  docker-common \</span><br><span class="line">                  container-selinux \</span><br><span class="line">                  docker-selinux \</span><br><span class="line">                  docker-engine</span><br></pre></td></tr></table></figure>

<p>éœ€è¦ <code>yum</code> å‘½ä»¤çš„å›æ˜¾æ˜¾ç¤ºæ²¡æœ‰ç›¸å…³çš„è½¯ä»¶åŒ…è¢«å®‰è£…</p>
<p>åœ¨ <code>/var/lib/docker</code> ç›®å½•ä¸‹, åŒ…å«äº†<code>é•œåƒ</code>, <code>å®¹å™¨</code>, <code>æ•°æ®å·</code>å’Œ <code>ç½‘ç»œé…ç½®</code></p>
<h2 id="å®‰è£…-Docker"><a href="#å®‰è£…-Docker" class="headerlink" title="å®‰è£… Docker"></a>å®‰è£… Docker</h2><h3 id="ä»è½¯ä»¶æºä¸­å®‰è£…-Docker"><a href="#ä»è½¯ä»¶æºä¸­å®‰è£…-Docker" class="headerlink" title="ä»è½¯ä»¶æºä¸­å®‰è£… Docker"></a>ä»è½¯ä»¶æºä¸­å®‰è£… Docker</h3><h4 id="é…ç½®è½¯ä»¶ä»“åº“-Docker-CE"><a href="#é…ç½®è½¯ä»¶ä»“åº“-Docker-CE" class="headerlink" title="é…ç½®è½¯ä»¶ä»“åº“ Docker-CE"></a>é…ç½®è½¯ä»¶ä»“åº“ Docker-CE</h4><ul>
<li>å®‰è£… <code>yum-utils</code> å·¥å…·é›†, ä»¥æä¾› <code>yum-config-manager</code>å‘½ä»¤çš„æ”¯æŒ</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo yum install -y yum-utils</span><br></pre></td></tr></table></figure>

<ul>
<li>é…ç½® Docker è½¯ä»¶æº (Stable)</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https://download.docker.com/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure>

<ul>
<li>å¼€å¯/å…³é—­ å¼€å‘ç‰ˆ(edge) Docker è½¯ä»¶æº</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo yum-config-manager --<span class="built_in">enable</span> docker-ce-edge</span><br><span class="line">$ sudo yum-config-manager --<span class="built_in">disable</span> docker-ce-edge</span><br></pre></td></tr></table></figure>

<h4 id="å®‰è£…-Docker-CE"><a href="#å®‰è£…-Docker-CE" class="headerlink" title="å®‰è£… Docker CE"></a>å®‰è£… Docker CE</h4><ul>
<li>æ›´æ–°è½¯ä»¶æºç´¢å¼•</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo yum makecache fast</span><br></pre></td></tr></table></figure>

<p>æ¥å— GPG key</p>
<ul>
<li>å®‰è£… Docker</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo yum install docker-ce  <span class="comment"># å®‰è£…æœ€æ–°ç‰ˆæœ¬</span></span><br><span class="line">$ sudo yum install docker-ce-&lt;VERSION&gt;  <span class="comment"># å®‰è£…æŒ‡å®šç‰ˆæœ¬</span></span><br></pre></td></tr></table></figure>

<ul>
<li>å¯åŠ¨ Docker</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo systemctl start docker</span><br><span class="line">$ sudo systemctl <span class="built_in">enable</span> docker</span><br></pre></td></tr></table></figure>

<ul>
<li>éªŒè¯ Docker EE æ­£å¸¸è¿è¡Œ</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo docker run hello-world</span><br></pre></td></tr></table></figure>

<ul>
<li>å‡çº§ Docker</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo yum makecache fast</span><br><span class="line">$ sudo yum update docker-ce</span><br></pre></td></tr></table></figure>


<h3 id="ä½¿ç”¨è½¯ä»¶åŒ…ç›´æ¥å®‰è£…"><a href="#ä½¿ç”¨è½¯ä»¶åŒ…ç›´æ¥å®‰è£…" class="headerlink" title="ä½¿ç”¨è½¯ä»¶åŒ…ç›´æ¥å®‰è£…"></a>ä½¿ç”¨è½¯ä»¶åŒ…ç›´æ¥å®‰è£…</h3><ul>
<li>ä¸‹è½½å¯¹åº”ç‰ˆæœ¬çš„ <code>.rpm</code> è½¯ä»¶åŒ…</li>
</ul>
<p>Docker CE: Go to <a href="https://download.docker.com/linux/centos/7/x86_64/stable/Packages/" target="_blank" rel="noopener">https://download.docker.com/linux/centos/7/x86_64/stable/Packages/</a>  and download the <code>.rpm</code></p>
<ul>
<li>å®‰è£…è½¯ä»¶åŒ…</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo yum install /path/to/package.rpm</span><br></pre></td></tr></table></figure>

<ul>
<li>å¯åŠ¨ Docker æœåŠ¡</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo systemctl start docker</span><br><span class="line">$ sudo systemctl <span class="built_in">enable</span> docker</span><br></pre></td></tr></table></figure>

<ul>
<li>éªŒè¯ Docker æœåŠ¡æ­£å¸¸è¿è¡Œ</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo docker run hello-world</span><br></pre></td></tr></table></figure>

<h2 id="å¸è½½-Docker-CE"><a href="#å¸è½½-Docker-CE" class="headerlink" title="å¸è½½ Docker CE"></a>å¸è½½ Docker CE</h2><ul>
<li>å¸è½½ Docker CE</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo yum remove docker-ce</span><br></pre></td></tr></table></figure>

<ul>
<li>é•œåƒ/å®¹å™¨/æ•°æ®å·å’Œè‡ªå®šä¹‰é…ç½®æ–‡ä»¶ä¸ä¼šéšç€å¸è½½è€Œè‡ªåŠ¨åˆ é™¤, ä½ éœ€è¦æ‰‹åŠ¨å»æ¸…é™¤ä»–ä»¬</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo rm -rf /var/lib/docker</span><br></pre></td></tr></table></figure>

<hr>
<p>å‚è€ƒå®˜æ–¹æ–‡æ¡£:</p>
<ul>
<li><a href="https://docs.docker.com/engine/installation/linux/centos/#install-from-a-package" target="_blank" rel="noopener">Get Docker for CentOS - Docker Documentation</a></li>
</ul>
]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title>åŸºäºæ—¶é—´å’Œä½ç½®æŸ¥çœ‹MySQL binlog</title>
    <url>/2017/03/21/%E5%9F%BA%E4%BA%8E%E6%97%B6%E9%97%B4%E5%92%8C%E4%BD%8D%E7%BD%AE%E6%9F%A5%E7%9C%8BMySQL-binlog/</url>
    <content><![CDATA[<h2 id="åŸºäºæ—¶é—´æŸ¥çœ‹-binlog-æ—¥å¿—"><a href="#åŸºäºæ—¶é—´æŸ¥çœ‹-binlog-æ—¥å¿—" class="headerlink" title="åŸºäºæ—¶é—´æŸ¥çœ‹ binlog æ—¥å¿—"></a>åŸºäºæ—¶é—´æŸ¥çœ‹ binlog æ—¥å¿—</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mysqlbinlog  --no-defaults --start-datetime=<span class="string">"2016-10-31 23:08:03"</span> mysql-bin.000214 |more</span><br></pre></td></tr></table></figure>



<h2 id="åŸºäºä½ç½®æŸ¥çœ‹-binlog-æ—¥å¿—"><a href="#åŸºäºä½ç½®æŸ¥çœ‹-binlog-æ—¥å¿—" class="headerlink" title="åŸºäºä½ç½®æŸ¥çœ‹ binlog æ—¥å¿—"></a>åŸºäºä½ç½®æŸ¥çœ‹ binlog æ—¥å¿—</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mysqlbinlog --no-defaults --start-position=690271 mysql-bin.000214 |more</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>binlog</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQLä¸»ä»1061æŠ¥é”™</title>
    <url>/2017/03/21/MySQL%E4%B8%BB%E4%BB%8E1061%E6%8A%A5%E9%94%99/</url>
    <content><![CDATA[<blockquote>
<p>MySQLä¸»ä» 1061 æŠ¥é”™, é”®å†²çª, äº§ç”Ÿçš„åŸå› ä¸€èˆ¬ä¸ºç”¨æˆ·åœ¨ä¸»åº“ä¸Šå»ºç«‹ç´¢å¼•å¯¼è‡´, å¯ä»¥é€šè¿‡åœ¨ä»åº“æ‰‹åŠ¨åˆ é™¤å†²çªçš„ç´¢å¼•è§£å†³</p>
</blockquote>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å…ˆæš‚åœä¸»ä»åŒæ­¥</span></span><br><span class="line">mysql&gt; stop slave for channel "dbtest";  # MySQL5.7å¤šæºå¤åˆ¶è¯­æ³•</span><br><span class="line">mysql&gt; stop slave;  # å•ä¸»å¤åˆ¶è¯­æ³•</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤å†²çªçš„ç´¢å¼•</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="string">`tableNmae`</span> <span class="keyword">DROP</span> <span class="keyword">INDEX</span> <span class="string">`indexName`</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¼€å¯ä¸»ä»åŒæ­¥</span></span><br><span class="line">mysql&gt; start slave for channel "dbtest"; # MySQL5.7å¤šæºå¤åˆ¶è¯­æ³•</span><br><span class="line">mysql&gt; start slave;  # å•ä¸»å¤åˆ¶è¯­æ³•</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>ä¸»ä»æŠ¥é”™</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQLæƒé™ç®¡ç†</title>
    <url>/2017/03/21/MySQL%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86/</url>
    <content><![CDATA[<h1 id="è¯­æ³•"><a href="#è¯­æ³•" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h1><p><code>grant æƒé™ on æ•°æ®åº“.æ•°æ®è¡¨ to &#39;ç”¨æˆ·&#39;@&#39;ä¸»æœº&#39;;</code></p>
<h2 id="ä¸»æœºçš„è¡¨ç¤ºæ–¹å¼"><a href="#ä¸»æœºçš„è¡¨ç¤ºæ–¹å¼" class="headerlink" title="ä¸»æœºçš„è¡¨ç¤ºæ–¹å¼"></a>ä¸»æœºçš„è¡¨ç¤ºæ–¹å¼</h2><ul>
<li>192.168.10.85  å•ä¸»æœºæˆæƒæ–¹å¼</li>
<li>localhost æœ¬åœ°æˆæƒ æ–¹å¼</li>
<li>% ä¸é™åˆ¶è¿œç¨‹ä¸»æœºçš„ IP åœ°å€</li>
<li>192.168.10.% ç½‘æ®µæ‰¹é‡æˆæƒ</li>
</ul>
<h2 id="æƒé™åˆ—è¡¨"><a href="#æƒé™åˆ—è¡¨" class="headerlink" title="æƒé™åˆ—è¡¨"></a>æƒé™åˆ—è¡¨</h2><table>
<thead>
<tr>
<th>æƒé™</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>usage</td>
<td>è¿æ¥(ç™»å½•)MySQL çš„æƒé™, æ¯å»ºç«‹ä¸€ä¸ªç”¨æˆ·, å°±ä¼šè‡ªåŠ¨æˆäºˆ<code>usage</code>æƒé™. è¯¥æƒé™åªèƒ½ç”¨äºæ•°æ®åº“ç™»å½•, ä¸èƒ½æ‰§è¡Œä»»ä½•æ“ä½œ, ä¸” usage æƒé™ä¸èƒ½è¢«å›æ”¶â™»ï¸</td>
</tr>
<tr>
<td>file</td>
<td>æ‹¥æœ‰ file æƒé™æ‰å¯ä»¥æ‰§è¡Œ <code>select ... into outfile</code> å’Œ <code>load data infileâ€¦</code> æ“ä½œ, ä½†æ˜¯ä¸è¦æŠŠ <code>file</code>, <code>process</code>, <code>super</code> æƒé™æˆäºˆç®¡ç†å‘˜ä»¥å¤–çš„è´¦å·, å¦åˆ™å­˜åœ¨ä¸¥é‡çš„å®‰å…¨éšæ‚£</td>
</tr>
<tr>
<td>super</td>
<td>è¯¥æƒé™å…è®¸ç”¨æˆ·ç»ˆæ­¢ä»»ä½•æŸ¥è¯¢; ä¿®æ”¹å…¨å±€å˜é‡çš„ SET è¯­å¥; ä½¿ç”¨ <code>change master</code> <code>purge master logs</code></td>
</tr>
<tr>
<td>select</td>
<td>å¿…é¡»æ‹¥æœ‰ select æƒé™æ‰å¯ä»¥ä½¿ç”¨ <code>select</code>æŸ¥è¯¢æ•°æ®</td>
</tr>
<tr>
<td>insert</td>
<td>å¿…é¡»æ‹¥æœ‰ insert æƒé™æ‰å¯ä»¥ä½¿ç”¨<code>insert</code>å‘è¡¨ä¸­æ’å…¥æ•°æ®</td>
</tr>
<tr>
<td>update</td>
<td>å¿…é¡»æ‹¥æœ‰ update æƒé™æ‰å¯ä»¥ä½¿ç”¨<code>update</code>æ›´æ–°è¡¨ä¸­çš„è®°å½•ğŸ“</td>
</tr>
<tr>
<td>delete</td>
<td>å¿…é¡»æ‹¥æœ‰ delete æƒé™æ‰å¯ä»¥ä½¿ç”¨<code>delete</code>åˆ é™¤è¡¨ä¸­çš„æ•°æ®</td>
</tr>
<tr>
<td>alter</td>
<td>å¿…é¡»æ‹¥æœ‰ alter æƒé™æ‰å¯ä»¥ä½¿ç”¨<code>alter</code>å‘½ä»¤æ›´æ”¹è¡¨çš„å±æ€§</td>
</tr>
<tr>
<td>alter routine</td>
<td>å¿…é¡»æ‹¥æœ‰ alter routine æƒé™æ‰å¯ä»¥æ‰§è¡Œ <code>alter/drop procedure/function</code>å‘½ä»¤</td>
</tr>
<tr>
<td>create</td>
<td>å¿…é¡»æ‹¥æœ‰ create æƒé™æ‰å¯ä»¥ä½¿ç”¨<code>create</code>å‘½ä»¤å»ºè¡¨</td>
</tr>
<tr>
<td>create routine</td>
<td>å¿…é¡»æ‹¥æœ‰ create routine æƒé™æ‰å¯ä»¥æ‰§è¡Œ <code>create/alter/drop procedure/function</code></td>
</tr>
<tr>
<td>create temporary tables</td>
<td>å¿…é¡»æœ‰create  temporary tablesçš„æƒé™ï¼Œæ‰å¯ä»¥ä½¿ç”¨<code>create temporary tables</code></td>
</tr>
<tr>
<td>create view</td>
<td>æ‰§è¡Œ<code>create view</code>åˆ›å»ºè§†å›¾çš„æƒé™</td>
</tr>
<tr>
<td>create user</td>
<td>æ‰§è¡Œ<code>create user</code>åˆ›å»ºç”¨æˆ·çš„æƒé™(æ‹¥æœ‰ insert æƒé™ä¹Ÿå¯ä»¥é€šè¿‡ç›´æ¥å‘ mysql.user è¡¨ä¸­æ’å…¥æ•°æ®æ¥åˆ›å»ºç”¨æˆ·)</td>
</tr>
<tr>
<td>show database</td>
<td>é€šè¿‡ <code>show database</code> åªèƒ½çœ‹åˆ°ä½ æ‹¥æœ‰çš„æŸäº›æƒé™çš„æ•°æ®åº“, é™¤éä½ æ‹¥æœ‰å…¨å±€<code>show database</code>æƒé™</td>
</tr>
<tr>
<td>show view</td>
<td>å¿…é¡»æ‹¥æœ‰<code>show view</code>æƒé™æ‰å¯ä»¥æ‰§è¡Œ<code>show create view</code>æŸ¥è¯¢å·²ç»åˆ›å»ºçš„è§†å›¾</td>
</tr>
<tr>
<td>index</td>
<td>å¿…é¡»æ‹¥æœ‰ index æƒé™æ‰èƒ½åˆ›å»ºå’Œåˆ é™¤ç´¢å¼• <code>create/drop index</code></td>
</tr>
<tr>
<td>excute</td>
<td>å¿…é¡»æ‹¥æœ‰ excute æƒé™æ‰å¯ä»¥æ‰§è¡Œå­˜åœ¨çš„å‡½æ•°(Function)å’Œå­˜å‚¨è¿‡ç¨‹(Procedures)</td>
</tr>
<tr>
<td>event</td>
<td>å¦‚æœevent çš„ä½¿ç”¨é¢‘ç‡è¾ƒä½, å»ºè®®ä½¿ç”¨ root ç”¨æˆ·è¿›è¡Œç®¡ç†å’Œç»´æŠ¤. (è¦ä½¿event èµ·ä½œç”¨, MySQL çš„å¸¸é‡ <code>global event_scheduler</code>å¿…é¡»ä¸º<code>on</code>æˆ–è€…<code>1</code>)</td>
</tr>
<tr>
<td>lock tables</td>
<td>é”è¡¨ğŸ”æƒé™</td>
</tr>
<tr>
<td>references</td>
<td>åˆ›å»ºå¤–é”®çº¦æŸæƒé™</td>
</tr>
<tr>
<td>reload</td>
<td>flush talbes/logs/privileges æƒé™</td>
</tr>
<tr>
<td>replication client</td>
<td>æ‹¥æœ‰æ­¤æƒé™å¯ä»¥æŸ¥è¯¢<code>master</code> <code>slave</code>çŠ¶æ€</td>
</tr>
<tr>
<td>replication slave</td>
<td>æ‹¥æœ‰æ­¤æƒé™å¯ä»¥ä»ä¸»åº“è¯»å–äºŒè¿›åˆ¶æ—¥å¿—</td>
</tr>
<tr>
<td>shutdown</td>
<td>å…³é—­ mysql çš„æƒé™</td>
</tr>
<tr>
<td>grant option</td>
<td>å¯ä»¥å°†è‡ªå·±æ‹¥æœ‰çš„æƒé™æˆæƒç»™å…¶ä»–ç”¨æˆ·(ä»…é™äºè‡ªå·±æ‹¥æœ‰çš„æƒé™)</td>
</tr>
<tr>
<td>process</td>
<td>æ‹¥æœ‰æ­¤æƒé™å¯ä»¥æ‰§è¡Œ<code>show processlist</code>å’Œ<code>kill</code>å‘½ä»¤. é»˜è®¤æƒ…å†µä¸‹, æ¯ä¸ªç”¨æˆ·éƒ½å¯ä»¥æ‰§è¡Œè¯¥å‘½ä»¤, ä½†æ˜¯åªèƒ½æŸ¥çœ‹æœ¬ç”¨æˆ·çš„è¿›ç¨‹</td>
</tr>
<tr>
<td>all privileges</td>
<td>æ‰€æœ‰æƒé™. ä½¿ç”¨<code>with grant option</code>å¯ä»¥è¿å¸¦æˆæƒ <code>grant all privileges on *.* to &#39;polarsnow&#39;@&#39;%&#39; with grant option;</code></td>
</tr>
<tr>
<td>truncate</td>
<td>truncate æƒé™å…¶å®å°±æ˜¯ create+drop æƒé™çš„ç»„åˆ</td>
</tr>
<tr>
<td>drop</td>
<td>åˆ åº“åˆ è¡¨åˆ ç´¢å¼•åˆ è§†å›¾ç­‰æƒé™</td>
</tr>
</tbody></table>
<p><strong>æ³¨æ„:</strong> ç®¡ç†æƒé™(å¦‚ super, process, file ç­‰)  ä¸èƒ½æŒ‡å®šæŸä¸ªæ•°æ®åº“æˆæƒ, <code>on</code>å…³é”®å­—ä¹‹åå¿…é¡»è·Ÿ <code>*.*</code></p>
<h1 id="æŸ¥çœ‹ç”¨æˆ·æˆæƒ"><a href="#æŸ¥çœ‹ç”¨æˆ·æˆæƒ" class="headerlink" title="æŸ¥çœ‹ç”¨æˆ·æˆæƒ"></a>æŸ¥çœ‹ç”¨æˆ·æˆæƒ</h1><figure class="highlight"><table><tr><td class="code"><pre><span class="line">mysql&gt; show grants for username;</span><br></pre></td></tr></table></figure>



<h1 id="å›æ”¶æƒé™"><a href="#å›æ”¶æƒé™" class="headerlink" title="å›æ”¶æƒé™"></a>å›æ”¶æƒé™</h1><figure class="highlight"><table><tr><td class="code"><pre><span class="line">mysql&gt; revoke select,update,insert,delete on *.* from username;</span><br></pre></td></tr></table></figure>



<h1 id="åˆ·æ–°æƒé™"><a href="#åˆ·æ–°æƒé™" class="headerlink" title="åˆ·æ–°æƒé™"></a>åˆ·æ–°æƒé™</h1><figure class="highlight"><table><tr><td class="code"><pre><span class="line">mysql&gt; flush privileges;</span><br></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>æƒé™ç®¡ç†</tag>
      </tags>
  </entry>
  <entry>
    <title>Docker For RHEL</title>
    <url>/2017/03/21/Docker-For-RHEL/</url>
    <content><![CDATA[<blockquote>
<p>RHEL ä¹Ÿæ˜¯å¤§åŠ›æ”¯æŒ Docker çš„ç³»ç»Ÿå‘è¡Œç‰ˆ, ä½†æ˜¯ç”±äº Docker æœ€å¼€å§‹ä½¿ç”¨çš„ AUFS å­˜å‚¨å¼•æ“åœ¨ RHEL ä¸Šå¹¶ä¸æ”¯æŒ, æ‰€ä»¥ RHEL è‡ªä¸»ç ”å‘äº† <code>device mapper</code> å­˜å‚¨å¼•æ“ä¸“é—¨é€‚é…è‡ªå·±çš„ç³»ç»Ÿ. è¿™ä¸ªä¸œè¥¿ç¡®å®å¾ˆç‰› X, ä½†æ˜¯å®é™…ç”¨èµ·æ¥æœ‰å¤šä¸çˆ½ææ€•åªæœ‰ç”¨è¿‡æ‰ä¼šçŸ¥é“å§. </p>
</blockquote>
<p><strong>æœ€é‡è¦çš„æ˜¯: Docker å®˜æ–¹å£°æ˜, RHEL 7 ä¸æ”¯æŒ Docker CE, åœ¨ RHEL ç³»ç»Ÿä¸Š, åªèƒ½å®‰è£… Docker EE ç‰ˆæœ¬, æ‰€ä»¥æœ¬ç¯‡ä¸åšè¯¦ç»†ä»‹ç»</strong></p>
<h2 id="ç³»ç»Ÿéœ€æ±‚"><a href="#ç³»ç»Ÿéœ€æ±‚" class="headerlink" title="ç³»ç»Ÿéœ€æ±‚"></a>ç³»ç»Ÿéœ€æ±‚</h2><ul>
<li>64bit RHEL7</li>
</ul>
<h2 id="å¸è½½è€ç‰ˆæœ¬-Docker-Engine"><a href="#å¸è½½è€ç‰ˆæœ¬-Docker-Engine" class="headerlink" title="å¸è½½è€ç‰ˆæœ¬ Docker Engine"></a>å¸è½½è€ç‰ˆæœ¬ Docker Engine</h2><p>è€ç‰ˆæœ¬çš„ Docker è¢«å«åš <code>docker</code> æˆ– <code>docker-engine</code> å¦‚æœç³»ç»Ÿå½“å‰æœ‰è¿™äº›ç‰ˆæœ¬çš„ç³»ç»Ÿ, é‚£ä¹ˆä½ éœ€è¦å…ˆå¸è½½ä»–ä»¬ </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo yum remove docker \</span><br><span class="line">                  docker-common \</span><br><span class="line">                  container-selinux \</span><br><span class="line">                  docker-selinux \</span><br><span class="line">                  docker-engine</span><br></pre></td></tr></table></figure>

<p>éœ€è¦ <code>yum</code> å‘½ä»¤çš„å›æ˜¾æ˜¾ç¤ºæ²¡æœ‰ç›¸å…³çš„è½¯ä»¶åŒ…è¢«å®‰è£…</p>
<p>åœ¨ <code>/var/lib/docker</code> ç›®å½•ä¸‹, åŒ…å«äº†<code>é•œåƒ</code>, <code>å®¹å™¨</code>, <code>æ•°æ®å·</code>å’Œ <code>ç½‘ç»œé…ç½®</code></p>
<h2 id="å®‰è£…-Docker-EE"><a href="#å®‰è£…-Docker-EE" class="headerlink" title="å®‰è£… Docker EE"></a>å®‰è£… Docker EE</h2><h3 id="è®¾ç½®è½¯ä»¶æº"><a href="#è®¾ç½®è½¯ä»¶æº" class="headerlink" title="è®¾ç½®è½¯ä»¶æº"></a>è®¾ç½®è½¯ä»¶æº</h3><ul>
<li>åœ¨ <code>/etc/yum.repos.d/</code> ä¸‹æ¸…é™¤æ‰€æœ‰è·Ÿ docker ç›¸å…³çš„è½¯ä»¶ä»“åº“é…ç½®</li>
</ul>
<ul>
<li>åœ¨ <code>/etc/yum/vars/</code> ä¸‹åˆ›å»ºä¸¤ä¸ªå˜é‡<ul>
<li>Docker EE çš„ URL</li>
</ul>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo sh -c <span class="string">'echo "&lt;DOCKER-EE-URL&gt;" &gt; /etc/yum/vars/dockerurl'</span></span><br></pre></td></tr></table></figure>

<pre><code>- RHEL çš„ç‰ˆæœ¬ </code></pre><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo sh -c <span class="string">'echo "&lt;VERSION-STRING&gt;" &gt; /etc/yum/vars/dockerosversion'</span></span><br></pre></td></tr></table></figure>

<ul>
<li>å®‰è£… yum å·¥å…·é›†<code>yum-utils</code> ä»¥å¾—åˆ° <code>yum-config-manager</code>å‘½ä»¤</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo yum install -y yum-utils</span><br></pre></td></tr></table></figure>

<ul>
<li>é…ç½®è½¯ä»¶æº</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    &lt;DOCKER-EE-URL&gt;/docker-ee.repo</span><br></pre></td></tr></table></figure>

<h3 id="å®‰è£…-Docker-EE-1"><a href="#å®‰è£…-Docker-EE-1" class="headerlink" title="å®‰è£… Docker EE"></a>å®‰è£… Docker EE</h3><ul>
<li>æ›´æ–° yum è½¯ä»¶æºç´¢å¼•</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo yum makecache fast</span><br></pre></td></tr></table></figure>

<ul>
<li>å®‰è£… Docker EE</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo yum -y install docker-ee</span><br></pre></td></tr></table></figure>

<ul>
<li>å¯åŠ¨ Docker EE</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo systemctl start docker</span><br></pre></td></tr></table></figure>

<ul>
<li>éªŒè¯ Docker EE æ­£å¸¸è¿è¡Œ</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo docker run hello-world</span><br></pre></td></tr></table></figure>

<hr>
<p>å‚è€ƒå®˜æ–¹æ–‡æ¡£:</p>
<ul>
<li><a href="https://docs.docker.com/engine/installation/linux/rhel/#install-using-the-repository" target="_blank" rel="noopener">https://docs.docker.com/engine/installation/linux/rhel/#install-using-the-repository</a></li>
</ul>
]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title>Docker For Ubuntu</title>
    <url>/2017/03/20/Docker-For-Ubuntu/</url>
    <content><![CDATA[<blockquote>
<p>Ubuntu æ˜¯ docker ç¬¬ä¸€ä¸ªæ”¯æŒçš„ç³»ç»Ÿå‘è¡Œç‰ˆ, æˆªæ­¢åˆ°ç›®å‰, æˆ‘ä»¬ä¹Ÿä¾ç„¶æ¨èåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ Ubuntu ç³»ç»Ÿ. è™½ç„¶æˆ‘ä¹Ÿå¾ˆå–œæ¬¢ CentOS, ä½†æ˜¯åœ¨ docker è¿™ä»¶äº‹å„¿ä¸­, Ubuntu ç¡®å®æ˜¯æœ€åˆé€‚çš„ç³»ç»Ÿé€‰æ‹©</p>
</blockquote>
<h2 id="ç³»ç»Ÿéœ€æ±‚"><a href="#ç³»ç»Ÿéœ€æ±‚" class="headerlink" title="ç³»ç»Ÿéœ€æ±‚"></a>ç³»ç»Ÿéœ€æ±‚</h2><ul>
<li>64bit Yakkety 16.10</li>
</ul>
<ul>
<li>64bit Xenial 16.04 (LTS)    &lt;== ä¸ªäººæ¨èä½¿ç”¨æ­¤ç‰ˆæœ¬çš„ Ubuntu å‘è¡Œç‰ˆ</li>
<li>64bit Trusty 14.04 (LTS)</li>
</ul>
<h2 id="å¸è½½è€ç‰ˆæœ¬-Docker-Engine"><a href="#å¸è½½è€ç‰ˆæœ¬-Docker-Engine" class="headerlink" title="å¸è½½è€ç‰ˆæœ¬ Docker Engine"></a>å¸è½½è€ç‰ˆæœ¬ Docker Engine</h2><p>è€ç‰ˆæœ¬çš„ Docker è¢«å«åš <code>docker</code> æˆ– <code>docker-engine</code> å¦‚æœç³»ç»Ÿå½“å‰æœ‰è¿™äº›ç‰ˆæœ¬çš„ç³»ç»Ÿ, é‚£ä¹ˆä½ éœ€è¦å…ˆå¸è½½ä»–ä»¬ </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo apt-get remove docker docker-engine</span><br></pre></td></tr></table></figure>

<p>éœ€è¦ <code>apt-get</code> å‘½ä»¤çš„å›æ˜¾æ˜¾ç¤ºæ²¡æœ‰ç›¸å…³çš„è½¯ä»¶åŒ…è¢«å®‰è£…</p>
<p>åœ¨ <code>/var/lib/docker</code> ç›®å½•ä¸‹, åŒ…å«äº†<code>é•œåƒ</code>, <code>å®¹å™¨</code>, <code>æ•°æ®å·</code>å’Œ <code>ç½‘ç»œé…ç½®</code></p>
<h2 id="Ubuntu-Trusty-14-04-é¢å¤–å®‰è£…çš„è½¯ä»¶åŒ…"><a href="#Ubuntu-Trusty-14-04-é¢å¤–å®‰è£…çš„è½¯ä»¶åŒ…" class="headerlink" title="Ubuntu Trusty 14.04 é¢å¤–å®‰è£…çš„è½¯ä»¶åŒ…"></a>Ubuntu Trusty 14.04 é¢å¤–å®‰è£…çš„è½¯ä»¶åŒ…</h2><p>åœ¨å®˜æ–¹æ–‡æ¡£ä¸­, å¼ºçƒˆæ¨è Ubuntu14.04ç‰ˆæœ¬å¦‚æœä½¿ç”¨<code>aufs</code> å­˜å‚¨å¼•æ“, é‚£ä¹ˆä¸€å®šè¦å®‰è£…ä»¥ä¸‹è½¯ä»¶åŒ…</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo apt-get update</span><br><span class="line"></span><br><span class="line">$ sudo apt-get install \</span><br><span class="line">    linux-image-extra-$(uname -r) \</span><br><span class="line">    linux-image-extra-virtual</span><br></pre></td></tr></table></figure>

<h2 id="å®‰è£…-Docker"><a href="#å®‰è£…-Docker" class="headerlink" title="å®‰è£… Docker"></a>å®‰è£… Docker</h2><h3 id="ä»è½¯ä»¶æºä¸­å®‰è£…-Docker"><a href="#ä»è½¯ä»¶æºä¸­å®‰è£…-Docker" class="headerlink" title="ä»è½¯ä»¶æºä¸­å®‰è£… Docker"></a>ä»è½¯ä»¶æºä¸­å®‰è£… Docker</h3><h4 id="é…ç½®è½¯ä»¶ä»“åº“-Docker-CE"><a href="#é…ç½®è½¯ä»¶ä»“åº“-Docker-CE" class="headerlink" title="é…ç½®è½¯ä»¶ä»“åº“ Docker-CE"></a>é…ç½®è½¯ä»¶ä»“åº“ Docker-CE</h4><ul>
<li>å®‰è£…è½¯ä»¶åŒ…, ä»¥å…è®¸<code>apt</code>å‘½ä»¤å¯ä»¥é€šè¿‡ https åè®®ä½¿ç”¨è½¯ä»¶æº(repository)</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo apt-get install \</span><br><span class="line">    apt-transport-https \</span><br><span class="line">    ca-certificates \</span><br><span class="line">    curl \</span><br><span class="line">    software-properties-common</span><br></pre></td></tr></table></figure>

<ul>
<li>å®‰è£… Docker å®˜æ–¹ GPG key</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -</span><br></pre></td></tr></table></figure>

<ul>
<li>é…ç½® <code>stable</code> ç‰ˆæœ¬çš„è½¯ä»¶æº</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ sudo add-apt-repository \</span><br><span class="line">   &quot;deb [arch&#x3D;amd64] https:&#x2F;&#x2F;download.docker.com&#x2F;linux&#x2F;ubuntu \</span><br><span class="line">   $(lsb_release -cs) \</span><br><span class="line">   stable&quot;</span><br></pre></td></tr></table></figure>

<h4 id="å®‰è£…-Docker-CE"><a href="#å®‰è£…-Docker-CE" class="headerlink" title="å®‰è£… Docker CE"></a>å®‰è£… Docker CE</h4><ul>
<li>æ›´æ–°ç³»ç»Ÿè½¯ä»¶</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo apt-get update</span><br></pre></td></tr></table></figure>

<ul>
<li>å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„ Docker CE</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo apt-get install docker-ce</span><br></pre></td></tr></table></figure>

<ul>
<li>åœ¨ç”Ÿäº§ç¯å¢ƒ, ä½ å¯èƒ½éœ€è¦å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„ Docker,</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo apt-get install docker-ce=&lt;VERSION&gt;</span><br></pre></td></tr></table></figure>

<p><em>docker-ce åœ¨å®‰è£…å¥½åè‡ªåŠ¨å¯åŠ¨</em></p>
<ul>
<li>å¯åŠ¨ Docker CE</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo systemctl start docker</span><br><span class="line">$ sudo systemctl <span class="built_in">enable</span> docker</span><br></pre></td></tr></table></figure>

<ul>
<li>éªŒè¯ Docker æœåŠ¡æ­£å¸¸è¿è¡Œ</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo docker run hello-world</span><br></pre></td></tr></table></figure>

<ul>
<li>æ·»åŠ ç”¨æˆ·åˆ° Docker ç»„</li>
</ul>
<p>åœ¨ç”Ÿäº§ç¯å¢ƒä¸­, ä¸æ˜¯æ¯ä¸ªäººç™»å½•éƒ½æ˜¯ä½¿ç”¨ root ç”¨æˆ·, å¯èƒ½éœ€è¦ç»™æ™®é€šç”¨æˆ·æ“ä½œ docker çš„æƒé™, é‚£ä¹ˆå°†è¯¥ç”¨æˆ·æ·»åŠ åˆ° docker ç»„æ˜¯ç®€å•æ–¹ä¾¿çš„æ–¹å¼</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo usermod -aG docker your-user</span><br></pre></td></tr></table></figure>

<ul>
<li>å‡çº§ Docker CE</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo apt-get update</span><br></pre></td></tr></table></figure>


<h3 id="ä½¿ç”¨è½¯ä»¶åŒ…ç›´æ¥å®‰è£…"><a href="#ä½¿ç”¨è½¯ä»¶åŒ…ç›´æ¥å®‰è£…" class="headerlink" title="ä½¿ç”¨è½¯ä»¶åŒ…ç›´æ¥å®‰è£…"></a>ä½¿ç”¨è½¯ä»¶åŒ…ç›´æ¥å®‰è£…</h3><ul>
<li>ä¸‹è½½å¯¹åº”ç‰ˆæœ¬çš„ <code>.deb</code> è½¯ä»¶åŒ…</li>
</ul>
<p>Docker CE: Go to <a href="https://download.docker.com/linux/ubuntu/pool/stable-17.03/amd64/" target="_blank" rel="noopener">https://download.docker.com/linux/ubuntu/pool/stable-17.03/amd64/</a> and download the .deb </p>
<ul>
<li>å®‰è£…è½¯ä»¶åŒ…</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo dpkg -i /path/to/package.deb</span><br></pre></td></tr></table></figure>

<p>The Docker daemon starts automatically.</p>
<ul>
<li>éªŒè¯ Docker æœåŠ¡æ­£å¸¸è¿è¡Œ</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo docker run hello-world</span><br></pre></td></tr></table></figure>


<h2 id="å¸è½½-Docker-CE"><a href="#å¸è½½-Docker-CE" class="headerlink" title="å¸è½½ Docker CE"></a>å¸è½½ Docker CE</h2><ul>
<li>å¸è½½ Docker CE</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo apt-get purge docker-ce</span><br></pre></td></tr></table></figure>

<ul>
<li>é•œåƒ/å®¹å™¨/æ•°æ®å·å’Œè‡ªå®šä¹‰é…ç½®æ–‡ä»¶ä¸ä¼šéšç€å¸è½½è€Œè‡ªåŠ¨åˆ é™¤, ä½ éœ€è¦æ‰‹åŠ¨å»æ¸…é™¤ä»–ä»¬</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo rm -rf /var/lib/docker</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title>DockerForWindows</title>
    <url>/2017/03/20/DockerForWindows/</url>
    <content><![CDATA[<blockquote>
<p>Docker CE For Windows åŒæ ·åˆ†ä¸ºäº†ä¸¤ä¸ªç‰ˆæœ¬,  ä¸€ä¸ªæ˜¯ç¨³å®šç‰ˆ; ä¸€ä¸ªæ˜¯å¼€å‘ç‰ˆ</p>
</blockquote>
<p>ä¸‹è½½é“¾æ¥:</p>
<ul>
<li><a href="https://download.docker.com/win/stable/InstallDocker.msi" target="_blank" rel="noopener">Get Docker for Windows Stable</a></li>
</ul>
<ul>
<li><a href="https://download.docker.com/win/beta/InstallDocker.msi" target="_blank" rel="noopener">Get Docker for Windows Edge</a></li>
</ul>
<p>ç³»ç»Ÿè¦æ±‚:</p>
<ul>
<li>Windows 10 Pro Enterprise and Education (1511 November update, Build 10586 or later) 64bit</li>
</ul>
<ul>
<li>Microsoft Hyper-V</li>
</ul>
<p>åŒå‡»å®‰è£…æ–‡ä»¶: InstallDocker.msi æ‰“å¼€å®‰å…¨ç¨‹åºç•Œé¢.  æŒ‰ç…§æ­£å¸¸çš„ Windows è½¯ä»¶å®‰è£…æµç¨‹, æˆ‘æ¥å—, ä¸‹ä¸€æ­¥, ä¸‹ä¸€æ­¥å³å¯å®Œæˆ docker çš„å®‰è£…</p>
<p><em>æç¤º: mac ç‰ˆæœ¬å’Œ windows ç‰ˆæœ¬çš„ docker ä»…é™äºä½“éªŒ. ç”šè‡³è¿æµ‹è¯•ç¯å¢ƒéƒ½ä¸æ¨èä½¿ç”¨ mac ç‰ˆå’Œ windows ç‰ˆ, å› ä¸ºåœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­,  ä¾ç„¶è¿˜æ˜¯åœ¨ Linux ç³»ç»Ÿä¸‹ä½¿ç”¨ docker, è€Œä¸”ç›¸åŒçš„é•œåƒ, ç›¸åŒçš„å‚æ•°, åœ¨ Linux ç¯å¢ƒæ‰§è¡Œæ²¡æœ‰é—®é¢˜, è€Œåœ¨ mac ä¸Šæ‰§è¡Œå‡ºé—®é¢˜çš„äº‹æƒ…å·²ç»å‘ç”Ÿè¿‡å¾ˆå¤šæ¬¡äº†. å»ºè®®ä¸è¦ç»™è‡ªå·±é“ºå«è¿™äº›ä¸å¿…è¦çš„éº»çƒ¦!</em></p>
<hr>
<p>å®˜æ–¹æ–‡æ¡£: </p>
<ul>
<li><a href="https://docs.docker.com/docker-for-windows/install/" target="_blank" rel="noopener">Install Docker for Windows - Docker Documentation</a></li>
</ul>
]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title>DockerForMac</title>
    <url>/2017/03/20/DockerForMac/</url>
    <content><![CDATA[<blockquote>
<p>Docker CE For Mac åŒæ ·åˆ†ä¸ºäº†ä¸¤ä¸ªç‰ˆæœ¬,  ä¸€ä¸ªæ˜¯ç¨³å®šç‰ˆ; ä¸€ä¸ªæ˜¯å¼€å‘ç‰ˆ</p>
</blockquote>
<p>ä¸‹è½½é“¾æ¥:</p>
<ul>
<li><a href="https://download.docker.com/mac/stable/Docker.dmg" target="_blank" rel="noopener">Get Docker for Mac Stable</a></li>
</ul>
<ul>
<li><a href="https://download.docker.com/mac/beta/Docker.dmg" target="_blank" rel="noopener">Get Docker for Mac Edge</a></li>
</ul>
<p>åŒå‡»å®‰è£…æ–‡ä»¶: Docker.dmg æ‰“å¼€å®‰å…¨ç¨‹åºç•Œé¢. å°†å·¦è¾¹çš„å›¾æ ‡æ‹–æ‹½åˆ°å³è¾¹çš„æ–‡ä»¶å¤¹ä¸­.</p>
<p><img src="http://20150509.oss-cn-qingdao.aliyuncs.com/docker-app-drag.png" alt=""></p>
<p>åœ¨ launchpad ä¸­æ‰¾åˆ° docker å›¾æ ‡, å•æœºå¯åŠ¨</p>
<p><img src="http://20150509.oss-cn-qingdao.aliyuncs.com/docker-app-in-apps.png" alt=""></p>
<p>å¯åŠ¨åä¼šåœ¨ macOS çš„å¯¼èˆªæ ä¸­å‡ºç° docker çš„å›¾æ ‡</p>
<p><img src="http://20150509.oss-cn-qingdao.aliyuncs.com/whale-in-menu-bar.png" alt=""></p>
<p>ç‚¹å‡»å¯¼èˆªæ ä¸­çš„ docker å›¾æ ‡, å¯ä»¥æŸ¥çœ‹è¿è¡ŒçŠ¶æ€</p>
<p><img src="http://20150509.oss-cn-qingdao.aliyuncs.com/menu.png" alt=""></p>
<p><em>æç¤º: mac ç‰ˆæœ¬å’Œ windows ç‰ˆæœ¬çš„ docker ä»…é™äºä½“éªŒ. ç”šè‡³è¿æµ‹è¯•ç¯å¢ƒéƒ½ä¸æ¨èä½¿ç”¨ mac ç‰ˆå’Œ windows ç‰ˆ, å› ä¸ºåœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­,  ä¾ç„¶è¿˜æ˜¯åœ¨ Linux ç³»ç»Ÿä¸‹ä½¿ç”¨ docker, è€Œä¸”ç›¸åŒçš„é•œåƒ, ç›¸åŒçš„å‚æ•°, åœ¨ Linux ç¯å¢ƒæ‰§è¡Œæ²¡æœ‰é—®é¢˜, è€Œåœ¨ mac ä¸Šæ‰§è¡Œå‡ºé—®é¢˜çš„äº‹æƒ…å·²ç»å‘ç”Ÿè¿‡å¾ˆå¤šæ¬¡äº†. å»ºè®®ä¸è¦ç»™è‡ªå·±é“ºå«è¿™äº›ä¸å¿…è¦çš„éº»çƒ¦!</em></p>
<hr>
<p>å®˜æ–¹æ–‡æ¡£: </p>
<ul>
<li><a href="https://docs.docker.com/docker-for-mac/install/" target="_blank" rel="noopener">Install Docker for Mac - Docker Documentation</a> </li>
</ul>
]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title>å®‰è£…Docker</title>
    <url>/2017/03/18/%E5%AE%89%E8%A3%85Docker/</url>
    <content><![CDATA[<h1 id="å®‰è£…-Docker"><a href="#å®‰è£…-Docker" class="headerlink" title="å®‰è£… Docker"></a>å®‰è£… Docker</h1><p>åœ¨ Docker1.13.1ç‰ˆæœ¬ä¹‹å, çªç„¶æ”¹å˜äº† Docker ç‰ˆæœ¬çš„å‘½ä»¤æ–¹å¼, ä»¥<code>vå¹´.æœˆ</code>çš„æ–¹å¼å‘½ä»¤, å¹¶ä¸”é¦–æ¬¡æ˜ç¡®åŒºåˆ†äº†ç¤¾åŒºç‰ˆ<code>CE</code>å’Œä¼ä¸šç‰ˆ<code>EE</code></p>
<h2 id="Docker-çš„ç‰ˆæœ¬"><a href="#Docker-çš„ç‰ˆæœ¬" class="headerlink" title="Docker çš„ç‰ˆæœ¬"></a>Docker çš„ç‰ˆæœ¬</h2><ul>
<li>Docker Enterprise Edition (Docker EE)  Docker EE çš„æ˜æ˜¾ä¼˜åŠ¿ä¸åœ¨äº Docker Engine çš„æœ¬èº«, è€Œåœ¨äº Docker å‘¨è¾¹çš„ç”Ÿæ€é…ä»¶. Docker å®˜æ–¹ä¸º EE ç‰ˆæœ¬è®¾è®¡å¼€å‘äº†ä¸€å¥—ç›®å‰é›†æˆåº¦æé«˜çš„ Docker å®¹å™¨ç®¡ç†å¹³å°. é›†Docker ä¼ä¸šç‰ˆ Engine, Docker Registry UI,  CICD,  ç›‘æ§ç­‰åŠŸèƒ½äºä¸€èº«(Docker Datacenter)</li>
</ul>
<ul>
<li>Docker Community Edition (Docker CE)  Docker CE å°±æ˜¯æˆ‘ä»¬ä¹‹å‰ä¸€ç›´åœ¨ä½¿ç”¨çš„å¼€æºç‰ˆ Docker-engine. ä¹Ÿæ˜¯æˆ‘ä»¬å°†æ¥ä¸»è¦ä½¿ç”¨çš„ç‰ˆæœ¬. Docker CEçš„ç‰ˆæœ¬å‘å¸ƒè§„åˆ™å¦‚ä¸‹:<ul>
<li>Stable ç¨³å®šç‰ˆ. æ¯å­£åº¦å‘è¡Œä¸€ç‰ˆ</li>
<li>Edge å¼€å‘ç‰ˆ. æ¯æœˆå‘è¡Œä¸€ç‰ˆ</li>
</ul>
</li>
</ul>
<h2 id="å¹³å°æ”¯æŒä¸€è§ˆè¡¨"><a href="#å¹³å°æ”¯æŒä¸€è§ˆè¡¨" class="headerlink" title="å¹³å°æ”¯æŒä¸€è§ˆè¡¨"></a>å¹³å°æ”¯æŒä¸€è§ˆè¡¨</h2><table>
<thead>
<tr>
<th>å¹³å°</th>
<th>Docker EE</th>
<th>Docker</th>
</tr>
</thead>
<tbody><tr>
<td>Ubuntu</td>
<td>âœ…</td>
<td>âœ…</td>
</tr>
<tr>
<td>Debian</td>
<td>âŒ</td>
<td>âœ…</td>
</tr>
<tr>
<td>Red Hat Enterprise Linux</td>
<td>âœ…</td>
<td>âŒ</td>
</tr>
<tr>
<td>CentOS</td>
<td>âœ…</td>
<td>âœ…</td>
</tr>
<tr>
<td>Fedora</td>
<td>âŒ</td>
<td>âœ…</td>
</tr>
<tr>
<td>Oracle Linux</td>
<td>âœ…</td>
<td>âŒ</td>
</tr>
<tr>
<td>SUSE Linux Enterprise Server</td>
<td>âœ…</td>
<td>âŒ</td>
</tr>
<tr>
<td>Microsoft WinServer 2016</td>
<td>âœ…</td>
<td>âŒ</td>
</tr>
<tr>
<td>Microsoft Windows 10</td>
<td>âŒ</td>
<td>âœ…</td>
</tr>
<tr>
<td>macOS</td>
<td>âŒ</td>
<td>âœ…</td>
</tr>
</tbody></table>
<h2 id="æŸ¥çœ‹å®˜æ–¹å¸®åŠ©æ–‡æ¡£"><a href="#æŸ¥çœ‹å®˜æ–¹å¸®åŠ©æ–‡æ¡£" class="headerlink" title="æŸ¥çœ‹å®˜æ–¹å¸®åŠ©æ–‡æ¡£"></a>æŸ¥çœ‹å®˜æ–¹å¸®åŠ©æ–‡æ¡£</h2><p>æˆªæ­¢åˆ°ç›®å‰, æœ€æ–°ç‰ˆæœ¬ä¸º v17.03, ä½ å¯ä»¥é€šè¿‡<code>latest</code>æ ‡ç­¾ğŸ·è·å–æœ€æ–°æ–‡æ¡£</p>
<ul>
<li>v17.03 (current)<br>Docs for v17.03 (current) are accessible at <a href="https://docs.docker.com/" target="_blank" rel="noopener">https://docs.docker.com/</a>, or run:<br><code>docker run -ti -p 4000:4000 docs/docker.github.io:latest</code></li>
<li>v1.13<br>Docs for v1.13 are accessible at <a href="https://docs.docker.com/v1.13/" target="_blank" rel="noopener">https://docs.docker.com/v1.13/</a>, or run:<br><code>docker run -ti -p 4000:4000 docs/docker.github.io:v1.13</code></li>
<li>v1.12<br>Docs for v1.12 are accessible at <a href="https://docs.docker.com/v1.12/" target="_blank" rel="noopener">https://docs.docker.com/v1.12/</a>, or run:<br><code>docker run -ti -p 4000:4000 docs/docker.github.io:v1.12</code></li>
<li>v1.11<br>Docs for v1.11 are accessible at <a href="https://docs.docker.com/v1.11/" target="_blank" rel="noopener">https://docs.docker.com/v1.11/</a>, or run:<br><code>docker run -ti -p 4000:4000 docs/docker.github.io:v1.11</code></li>
<li>v1.10<br>Docs for v1.10 are accessible at <a href="https://docs.docker.com/v1.10/" target="_blank" rel="noopener">https://docs.docker.com/v1.10/</a>, or run:<br><code>docker run -ti -p 4000:4000 docs/docker.github.io:v1.10</code></li>
<li>v1.9<br>Docs for v1.9 are accessible at <a href="https://docs.docker.com/v1.9/" target="_blank" rel="noopener">https://docs.docker.com/v1.9/</a>, or run:<br><code>docker run -ti -p 4000:4000 docs/docker.github.io:v1.9</code></li>
<li>v1.8<br>Docs for v1.8 are accessible at <a href="https://docs.docker.com/v1.8/" target="_blank" rel="noopener">https://docs.docker.com/v1.8/</a>, or run:<br><code>docker run -ti -p 4000:4000 docs/docker.github.io:v1.8</code></li>
<li>v1.7<br>Docs for v1.7 are accessible at <a href="https://docs.docker.com/v1.7/" target="_blank" rel="noopener">https://docs.docker.com/v1.7/</a>, or run:<br><code>docker run -ti -p 4000:4000 docs/docker.github.io:v1.7</code></li>
<li>v1.6<br>Docs for v1.6 are accessible at <a href="https://docs.docker.com/v1.6/" target="_blank" rel="noopener">https://docs.docker.com/v1.6/</a>, or run:<br><code>docker run -ti -p 4000:4000 docs/docker.github.io:v1.6</code></li>
<li>v1.5<br>Docs for v1.5 are accessible at <a href="https://docs.docker.com/v1.5/" target="_blank" rel="noopener">https://docs.docker.com/v1.5/</a>, or run:<br><code>docker run -ti -p 4000:4000 docs/docker.github.io:v1.5</code></li>
<li>v1.4<br>Docs for v1.4 are accessible at <a href="https://docs.docker.com/v1.4/" target="_blank" rel="noopener">https://docs.docker.com/v1.4/</a>, or run:<br><code>docker run -ti -p 4000:4000 docs/docker.github.io:v1.4</code></li>
</ul>
]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨Docker</title>
    <url>/2017/03/18/%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E4%BD%BF%E7%94%A8Docker/</url>
    <content><![CDATA[<h1 id="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨-Docker"><a href="#ä¸ºä»€ä¹ˆè¦ä½¿ç”¨-Docker" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ Docker"></a>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ Docker</h1><h2 id="Docker-å®¹å™¨è™šæ‹ŸåŒ–å¸¦æ¥çš„å¥½å¤„"><a href="#Docker-å®¹å™¨è™šæ‹ŸåŒ–å¸¦æ¥çš„å¥½å¤„" class="headerlink" title="Docker å®¹å™¨è™šæ‹ŸåŒ–å¸¦æ¥çš„å¥½å¤„"></a>Docker å®¹å™¨è™šæ‹ŸåŒ–å¸¦æ¥çš„å¥½å¤„</h2><p>ä¼ ç»Ÿçš„ LAMP æ¶æ„, æ­å»ºèµ·æ¥è´¹æ—¶è´¹åŠ›, éœ€è¦è°ƒæ•´å¾ˆå¤šä¾èµ–ç¯å¢ƒ. æ›´å¯æ€•çš„æ˜¯ä¸€æ—¦éœ€è¦åšæœåŠ¡è¿ç§», ä¸€åˆ‡éƒ½è¦é‡æ¥.</p>
<p>Docker æä¾›äº†ä¸€ç§æ›´ä¸ºç®€å•çš„æ–¹å¼, é€šè¿‡å®¹å™¨æ¥æ‰“åŒ…åº”ç”¨, æ„å‘³ç€è¿ç§»æœåŠ¡åªéœ€è¦åœ¨æ–°çš„æœåŠ¡å™¨ä¸Šå¯åŠ¨ç›¸åº”çš„å®¹å™¨å³å¯. å¤§å¤§å‡å°‘è¿ç§»çš„æ—¶é—´å’Œæˆæœ¬, å¹¶å¤§å¹…é™ä½éƒ¨ç½²è¿‡ç¨‹ä¸­å¯èƒ½ä¼šå‡ºç°çš„é—®é¢˜å’Œé£é™©</p>
<h2 id="Docker-åœ¨å¼€å‘å’Œè¿ç»´ä¸­çš„ä¼˜åŠ¿"><a href="#Docker-åœ¨å¼€å‘å’Œè¿ç»´ä¸­çš„ä¼˜åŠ¿" class="headerlink" title="Docker åœ¨å¼€å‘å’Œè¿ç»´ä¸­çš„ä¼˜åŠ¿"></a>Docker åœ¨å¼€å‘å’Œè¿ç»´ä¸­çš„ä¼˜åŠ¿</h2><p>å¯¹äºå¼€å‘å’Œè¿ç»´æ¥è¯´, æœ€æ¢¦å¯ä»¥æ±‚çš„å°±æ˜¯ä¸€æ¬¡æ€§çš„åˆ›å»ºæˆ–é…ç½®, å¯ä»¥åœ¨ä»»æ„ç¯å¢ƒ, ä»»æ„æ—¶é—´è®©åº”ç”¨æ­£å¸¸çš„è¿è¡Œ. è€Œ Docker å°±æ˜¯å®ç°è¿™ä¸€ç›®æ ‡çš„åˆ©å™¨.</p>
<p>å…·ä½“æ¥è¯´, Docker åœ¨å¼€å‘å’Œè¿ç»´ä¸­å…·æœ‰å¦‚ä¸‹ä¼˜åŠ¿:</p>
<ul>
<li>æ›´å¿«çš„äº¤ä»˜å’Œéƒ¨ç½²</li>
</ul>
<ul>
<li>æ›´é«˜æ•ˆçš„èµ„æºåˆ©ç”¨</li>
<li>æ›´è½»æ¾çš„è¿ç§»æ‰©å±•</li>
<li>æ›´ç®€å•çš„æ›´æ–°ç®¡ç†</li>
</ul>
<h2 id="Docker-ä¸è™šæ‹Ÿæœºçš„æ¯”è¾ƒ"><a href="#Docker-ä¸è™šæ‹Ÿæœºçš„æ¯”è¾ƒ" class="headerlink" title="Docker ä¸è™šæ‹Ÿæœºçš„æ¯”è¾ƒ"></a>Docker ä¸è™šæ‹Ÿæœºçš„æ¯”è¾ƒ</h2><ul>
<li>Docker å¯åŠ¨å’Œå…³é—­å®¹å™¨çš„é€Ÿåº¦éå¸¸å¿«, å¯ä»¥åœ¨ç§’çº§å®ç°, ç›¸æ¯”ä¼ ç»Ÿçš„è™šæ‹Ÿæœºé€Ÿåº¦è¦å¿«å¾ˆå¤š</li>
</ul>
<ul>
<li>Docker å®¹å™¨å¯¹ç³»ç»Ÿèµ„æºéœ€æ±‚å¾ˆå°‘, ä¸€å°ä¸»æœºä¸Šå¯ä»¥åŒæ—¶è¿è¡Œæ•°åƒä¸ª Docker å®¹å™¨</li>
<li>Docker é€šè¿‡ç±»ä¼¼ Git çš„æ“ä½œæ¥æ–¹ä¾¿ç”¨æˆ·è·å–/åˆ†å‘å’Œæ›´æ–°åº”ç”¨é•œåƒ, æŒ‡ä»¤ç®€æ˜, å­¦ä¹ æˆæœ¬ä½</li>
<li>Docker å¯ä»¥é€šè¿‡ Dockerfile é…ç½®æ–‡ä»¶æ¥æ”¯æŒçµæ´»çš„è‡ªåŠ¨åŒ–åˆ›å»ºå’Œéƒ¨ç½²æœºåˆ¶, æé«˜å·¥ä½œæ•ˆç‡</li>
</ul>
<p>Docker å®¹å™¨é™¤äº†è¿è¡Œå…¶ä¸­çš„åº”ç”¨ä¹‹å¤–, åŸºæœ¬ä¸Šä¸æ¶ˆè€—é¢å¤–çš„ç³»ç»Ÿèµ„æº, ä¿è¯åº”ç”¨æ€§èƒ½çš„åŒæ—¶, å°½é‡å‡å°ç³»ç»Ÿå¼€é”€. ä¼ ç»Ÿçš„è™šæ‹Ÿæœºè¿è¡Œ N ä¸ªä¸åŒçš„åº”ç”¨å°±è¦å¯åŠ¨ N ä¸ªè™šæ‹Ÿæœº, æ¯ä¸ªè™šæ‹Ÿæœºéœ€è¦å•ç‹¬é…ç½®ç‹¬å çš„å†…å­˜,ç¡¬ç›˜ç­‰èµ„æº, è€Œ Docker åªéœ€è¦å¯åŠ¨ N ä¸ªéš”ç¦»çš„å®¹å™¨, å¹¶å°†åº”ç”¨æ”¾åˆ°å®¹å™¨å†…å³å¯</p>
<p>åœ¨éš”ç¦»æ€§æ–¹é¢, ä¼ ç»Ÿçš„è™šæ‹Ÿæœºæ–¹å¼å¤šäº†ä¸€å±‚é¢å¤–çš„éš”ç¦». ä½†è¿™å¹¶ä¸æ„å‘³è¿™ Docker ä¸å®‰å…¨. Docker åˆ©ç”¨ Linux ç³»ç»Ÿä¸Šçš„å¤šç§é˜²æŠ¤æœºåˆ¶å®ç°äº†ä¸¥æ ¼å¯é çš„éš”ç¦». ä»1.3ç‰ˆæœ¬å¼€å§‹, Docker å¼•å…¥äº†å®‰å…¨é€‰é¡¹å’Œé•œåƒç­¾åæœºåˆ¶, æå¤§åœ°æé«˜äº† Docker çš„å®‰å…¨æ€§.</p>
<table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>å®¹å™¨</th>
<th>è™šæ‹Ÿæœº</th>
</tr>
</thead>
<tbody><tr>
<td>å¯åŠ¨é€Ÿåº¦</td>
<td>ç§’çº§</td>
<td>åˆ†é’Ÿçº§</td>
</tr>
<tr>
<td>ç¡¬ç›˜ä½¿ç”¨</td>
<td>MB</td>
<td>GB</td>
</tr>
<tr>
<td>æ€§èƒ½</td>
<td>æ¥è¿‘åŸç”Ÿ</td>
<td>5%ä»¥ä¸Šçš„æ€§èƒ½æŸè€—</td>
</tr>
<tr>
<td>ç³»ç»Ÿæ”¯æŒé‡</td>
<td>å•æœºæ”¯æŒä¸Šåƒä¸ªå®¹å™¨</td>
<td>ä¸€èˆ¬å‡ åä¸ªå®¹å™¨</td>
</tr>
<tr>
<td>éš”ç¦»æ€§</td>
<td>å®‰å…¨éš”ç¦»</td>
<td>å®Œå…¨éš”ç¦»</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title>Docker åœ¨å›½å†…çš„å‘å±•ç°çŠ¶</title>
    <url>/2017/03/06/Docker-%E5%9C%A8%E5%9B%BD%E5%86%85%E7%9A%84%E5%8F%91%E5%B1%95%E7%8E%B0%E7%8A%B6/</url>
    <content><![CDATA[<p>Docker åœ¨å›½é™…ä¸Šè™½ç„¶ä¹Ÿå¯ä»¥ç§°å¾—ä¸Šæ˜¯æ–°å…´æŠ€æœ¯, ä½†æ˜¯åœ¨å›½å†…, ä¸æ¯«æ²¡æœ‰çœ‹å‡º Docker ä¸€ä¸ªèµ·æ­¥ä¸åˆ°4å¹´çš„å¹´è½»äº§å“. åœ¨å›½å†…, ä¼—å¤šå¤§å‚å¼€å§‹å¤§é‡ä½¿ç”¨ Docker åŸºç¡€. å…¶ä¸­ <code>æ»´æ»´</code> <code>äº¬ä¸œ</code> <code>è˜‘è‡è¡—</code> <code>çŸ¥ä¹</code> <code>è±†ç“£</code>ç­‰å¤§å‹äº’è”ç½‘å…¬å¸éƒ½åœ¨å¤§è§„æ¨¡çš„åœ¨çº¿ä¸Šç¯å¢ƒè½åœ° Docker æŠ€æœ¯.</p>
<p>åœ¨2016å¹´çš„åŒ11ä¹‹å, äº¬ä¸œæ›´æ˜¯é¦–å…ˆçˆ†å‡º15ä¸‡ Docker æœåŠ¡å™¨çš„è§„æ¨¡. å¯è§ Docker ç°åœ¨è™½ç„¶è¿˜æ˜¯ä¸€ä¸ªå¿«é€Ÿè¿­ä»£, å¿«é€Ÿå®Œå–„çš„ç³»ç»Ÿ, ä½†æ˜¯å·²ç»å¾—åˆ°äº†ä¸–ç•Œäº’è”ç½‘å¤§å‚çš„ä»»ä½•. Docker çš„æ—©æœŸçº¿ä¸Šè½åœ°çš„æ¨å¹¿, å¤§éƒ½æ˜¯ç”±è¿™äº›äº’è”ç½‘å¤§å‚å®æ–½çš„. ç»™åç»­çš„ä¸­å°ä¼ä¸šä¹Ÿå¸¦æ¥äº†æé«˜çš„å‚è€ƒä»·å€¼.</p>
<p>åœ¨5å¹´å‰, åƒ OpenStack ä»¥åŠ CloudStack è¿™ç±»äº‘æœåŠ¡åŸºç¡€æ¶æ„å‡ºç°æ—¶, åœ¨è¿ç»´é¢†åŸŸåˆ®èµ·äº†ä¸€é˜µé£“é£ğŸŒª çŸ­çŸ­å‡ å¹´é—´, IDC æœºæˆ¿ä¸å†æ˜¯æ‰€æœ‰äº’è”ç½‘å…¬å¸çš„æ ‡é…, ä¸ºäº†å‡å°‘è¿ç»´æˆæœ¬, æ›´å¤šçš„å»å…³æ³¨ä¸šåŠ¡çš„æœ¬èº«, è¶Šæ¥è¶Šå¤šçš„åˆ›ä¸šå…¬å¸é€‰æ‹©ä½¿ç”¨å…¬æœ‰äº‘æœåŠ¡. </p>
<p>5å¹´åçš„ä»Šå¤©, IaaS çš„å…¬æœ‰äº‘æœåŠ¡ä»ç„¶æ˜¯ä¸»æµ, åœ¨ IaaS ä¹‹ä¸Šåˆå‡ºç°äº† CaaS æœåŠ¡, å³ä»¥ Container ä¸ºä¸»å¯¼çš„åŸºç¡€æœåŠ¡æ¶æ„. å°† IaaS çš„èµ„æºåˆ©ç”¨åˆ°æè‡´. Docker ä¸æ˜¯ IaaS çš„æ›¿ä»£å“, ä½†å´æ˜¯ IaaS å¹³å°å¼ºæœ‰åŠ›çš„è¡¥å……, åœ¨ä¸ºä¼ä¸šæé«˜èµ„æºåˆ©ç”¨ç‡, å‡å°‘æˆæœ¬, æé«˜è‡ªåŠ¨åŒ–ç¨‹åº¦ç­‰æ–¹é¢æä¾›äº†å¼ºæœ‰åŠ›çš„æ”¯æŒ. </p>
<p>å³ä½¿ç›®å‰å¤§å¤šä¸­å°ä¼ä¸šä¾ç„¶åœ¨è‡ªå·±çš„å¼€å‘ç¯å¢ƒå’Œæµ‹è¯•ç¯å¢ƒè§‚æœ› Docker æŠ€æœ¯çš„å‘å±•, ä½†æ˜¯ä¸å¯å¦è®¤çš„æ˜¯ Docker ç›®å‰å·²ç»æœ‰èƒ½åŠ›èƒœä»»çº¿ä¸Šä¸šåŠ¡çš„é‡æ‹…. é€šè¿‡ç½‘ä¸Šå¤§å‚ä»¬æµä¼ å‡ºçš„â€æœ€ä½³å®è·µâ€, å®Œå…¨å¯ä»¥æŒ‡åˆ°æˆ‘ä»¬å°†æœåŠ¡å®¹å™¨åŒ–, å¹¶å¾ˆå¥½çš„è°ƒè¯•å’Œæ’é”™.</p>
]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title>Docker çš„ç‰ˆæœ¬æ¼”è¿›</title>
    <url>/2017/03/06/Docker-%E7%9A%84%E7%89%88%E6%9C%AC%E6%BC%94%E8%BF%9B/</url>
    <content><![CDATA[<p>Dockerä»2013å¹´å¼€æº. 2015å¹´æ˜¯ Docker å¼€æºé¡¹ç›®çªé£çŒ›è¿›çš„ä¸€å¹´ï¼Œè¿™æ®µæ—¶é—´Docker å®˜æ–¹å…ˆåå‘å¸ƒäº†V1.5ã€V1.6ã€V1.7ã€V1.8ã€V1.9ç­‰5ä¸ªå¤§ç‰ˆæœ¬ä»¥åŠ7ä¸ªä¿®è®¢ç‰ˆæœ¬</p>
<p>2016å¹´ Dockerå‘å±•åŒæ ·è¿…é€Ÿï¼Œæˆªæ­¢2016å¹´12æœˆ7æ—¥Dockerå®˜æ–¹å…±å‘å¸ƒäº†V1.10, V1.11, V1.12ç­‰3ä¸ªå¤§ç‰ˆæœ¬ä»¥åŠ8ä¸ªä¿®è®¢ç‰ˆæœ¬.</p>
<p>2017å¹´1æœˆ18æ—¥, Docker å‘å¸ƒäº†æœ€é‡å¤§çš„ä¸€æ¬¡ç‰ˆæœ¬æ›´æ–° V1.13,  2æœˆ8æ—¥å‘å¸ƒäº†V1.13.1, åœ¨3æœˆ1æ—¥, Docker å…¬å¸ƒäº†æ–°çš„å‘½åè§„åˆ™</p>
<p>V1.13.1ç‰ˆæœ¬ä¹‹å, æ‰€æœ‰çš„ç‰ˆæœ¬éƒ½ä¼šæŒ‰ç…§ VYY.MM çš„æ ¼å¼è¿›è¡Œæ‰“åŒ…. æ¯”å¦‚ Docker åœ¨2017å¹´3æœˆçš„è¿™æ¬¡æ›´æ–°, æ–°çš„ç‰ˆæœ¬å·å˜æˆäº† <code>V17.03.0-ce</code></p>
<p>å‰é¢æ˜¯æ—¥æœŸä¸ç”¨è§£é‡Š, åé¢çš„<code>CE</code>æš´éœ²äº† Docker å…¬å¸æ¸´æœ›å°†è¯¥å®¹å™¨æŠ€æœ¯å•†ä¸šåŒ–çš„å†³å¿ƒ. ä»æ­¤ä¹‹å Docker çš„ç‰ˆæœ¬åˆ’åˆ†ä¸ºå•†ä¸šç‰ˆæœ¬çš„ <code>EE</code>å’Œå¼€æºç¤¾åŒºç‰ˆæœ¬çš„ <code>CE</code> , å…¶ä¸­å¼€æºç¤¾åŒºç‰ˆæœ¬ä¹Ÿåˆ†æˆäº†ä¸¤ç±», åˆ†åˆ«ä¸º æ¯å­£åº¦æ›´æ–°çš„<code>Stable</code>ç¨³å®šç‰ˆå’Œæ¯æœˆæ›´æ–°çš„<code>Edge</code> å¼€å‘ç‰ˆ</p>
<ul>
<li>Docker EE</li>
<li>Docker CE<ul>
<li>Docker CE stable</li>
<li>Docker CE edge</li>
</ul>
</li>
</ul>
]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title>docker ç®€ä»‹</title>
    <url>/2017/03/06/docker-%E7%AE%80%E4%BB%8B/</url>
    <content><![CDATA[<h2 id="docker-æ—¶é—´è½´"><a href="#docker-æ—¶é—´è½´" class="headerlink" title="docker æ—¶é—´è½´"></a>docker æ—¶é—´è½´</h2><p>docker æ˜¯å®¹å™¨æŠ€æœ¯ä¸­çš„ä¸€ç§. æœ€æ—©æ˜¯ç”± dotcloud å…¬å¸å¼€æºçš„ä¸€æ¬¾äº§å“. dotcloud å…¬å¸æ˜¯2010å¹´æ–°æˆç«‹çš„ä¸€å®¶å…¬å¸, ä¸»è¦åŸºäº PaaS å¹³å°ä¸ºå¼€å‘è€…æä¾›æœåŠ¡. åœ¨ PaaS å¹³å°ä¸‹, æ‰€æœ‰çš„æœåŠ¡ç¯å¢ƒå·²ç»é¢„å…ˆé…ç½®å¥½äº†, å¼€å‘è€…åªéœ€è¦é€‰æ‹©æœåŠ¡ç±»å‹, ä¸Šä¼ ä»£ç åå³å¯å¯¹å¤–æä¾›æœåŠ¡, ä¸éœ€è¦èŠ±è´¹å¤§é‡çš„æ—¶é—´æ¥æ­å»ºæœåŠ¡å’Œé…ç½®ç¯å¢ƒ.</p>
<p>2013å¹´,  dotcloud çš„ CEO å†³å®šæŠŠ dotcloud å†…éƒ¨ä½¿ç”¨çš„ container å®¹å™¨æŠ€æœ¯å•ç‹¬æ‹¿å‡ºæ¥å¼€æº. 2013å¹´3æœˆå‘å¸ƒ docker çš„ V0.1ç‰ˆæœ¬, å¹¶ä¸”ä¿æŒæ¯æœˆä¸€ä¸ªç‰ˆæœ¬çš„è¿­ä»£é€Ÿåº¦. åˆ°åŒå¹´8æœˆ, docker æŠ€æœ¯å·²ç»è¶³å¤Ÿç«çˆ†. åŒå¹´10æœˆ, dotcloud å…¬å¸æ›´åä¸º Docker è‚¡ä»½æœ‰é™å…¬å¸.</p>
<p>2014å¹´6æœˆ9æ—¥, Docker å‘å¸ƒ V1.0ç‰ˆæœ¬, å¹¶ä¸¾åŠäº†é¦–å±Š DockerCon å¤§ä¼š, å¤§ä¼šä¸Šæ¥è‡ª Google, IBM, RedHat,  Rackspace ç­‰å…¬å¸çš„æ ¸å¿ƒäººç‰©å‡å‘è¡¨äº†ä¸»é¢˜æ¼”è®²ğŸ—£å¹¶çº·çº·åŠ å…¥ Docker çš„é˜µè¥.</p>
<p>2014å¹´12æœˆ, Docker å‘å¸ƒäº†é›†ç¾¤ç®¡ç†å·¥å…· Machine å’Œ Swarm.</p>
<p>2016å¹´1æœˆ, Docker å®˜æ–¹è®¡åˆ’å…¨é¢æ”¯æŒè‡ªèº«çš„ Alpine Linux, ä½¿ç”¨å®ƒæ„å»ºçš„åŸºç¡€é•œåƒæœ€å°åªæœ‰5M</p>
<h2 id="ä»€ä¹ˆæ˜¯-Docker"><a href="#ä»€ä¹ˆæ˜¯-Docker" class="headerlink" title="ä»€ä¹ˆæ˜¯ Docker"></a>ä»€ä¹ˆæ˜¯ Docker</h2><p>æŒ‰ç…§å®˜æ–¹çš„è¯´æ³•, Docker æ˜¯ä¸€ä¸ªå¼€æºçš„åº”ç”¨å®¹å™¨å¼•æ“.</p>
<p>æ‹¿ Java æ¥è¯´, åœ¨ Java ä¹‹å‰çš„ç¼–ç¨‹è¯­è¨€, åƒ C/C++, æ˜¯ä¸¥é‡ä¾èµ–å¹³å°çš„, åœ¨ä¸åŒçš„å¹³å°ä¸‹, éœ€è¦é‡æ–°ç¼–è¯‘æ‰èƒ½è¿è¡Œ. Java çš„ä¸€ä¸ªéå¸¸é‡è¦çš„ç‰¹æ€§å°±æ˜¯ä¸å¹³å°æ— å…³æ€§,  Java è™šæ‹Ÿæœº(JVM)æ˜¯å®ç°è¿™ä¸€ç‰¹æ€§çš„å…³é”®. Java è™šæ‹Ÿæœºå±è”½äº†ä¸å…·ä½“å¹³å°çš„ç›¸å…³æ€§, ä½¿å¾— Java è¯­è¨€ç¼–è¯‘ç¨‹åºåªéœ€ç”Ÿæˆå¯ä»¥åœ¨ Java è™šæ‹Ÿæœºä¸Šè¿è¡Œçš„ç›®æ ‡ä»£ç , å°±å¯ä»¥åœ¨å¤šç§å¹³å°ä¸Šä¸åŠ ä¿®æ”¹çš„è¿è¡Œ. Java è™šæ‹Ÿæœºåœ¨æ‰§è¡Œå­—èŠ‚ç çš„æ—¶å€™, æŠŠå­—èŠ‚ç è§£é‡Šæˆå…·ä½“å¹³å°ä¸Šçš„æœºå™¨æŒ‡ä»¤æ‰§è¡Œ.</p>
<p>Java çš„ç†å¿µæ˜¯ â€œWrite Once, Run Anywhereâ€, è€Œ Docker åˆ™æå‡ºäº†â€Build Once, Run Anywhere, Configure Once, Run Anythingâ€</p>
<p>åœ¨ Java çš„ JVM ä¸­, å±è”½äº†ç³»ç»Ÿå¹³å°çš„å¹²æ‰°; åœ¨ Docker ä½¿ç”¨çš„å®¹å™¨æŠ€æœ¯ä¸­, åˆ™å±è”½äº†é™¤å†…æ ¸å¤–çš„æ‰€æœ‰å¹²æ‰°. è¿è¡Œåœ¨Docker å†…çš„å®¹å™¨, åªå¯¹å†…æ ¸æ•æ„Ÿ. (ç›¸å¯¹äºå®¿ä¸»æœºè€Œè¨€)</p>
<p>å¦‚æœè¯´ Java æ˜¯å¸®åŠ©æˆ‘ä»¬æŠŠåº”ç”¨æ‰“åŒ…, å¯ä»¥è¿è¡Œåœ¨ä»»ä½•è£…æœ‰ JVM çš„æœåŠ¡å™¨ä¸Š; é‚£ä¹ˆä½¿ç”¨ Docker å°±æ˜¯å¸®æˆ‘ä»¬å®ç°åº”ç”¨ä¸ç¯å¢ƒçš„ç»Ÿä¸€æ‰“åŒ…, å¯ä»¥åœ¨ä»»ä½•è£…æœ‰ Docker çš„æœåŠ¡å™¨ä¸Šè¿è¡Œ. </p>
]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title>ubuntuä¸‹æ·»åŠ ç”¨æˆ·</title>
    <url>/2017/02/24/ubuntu%E4%B8%8B%E6%B7%BB%E5%8A%A0%E7%94%A8%E6%88%B7/</url>
    <content><![CDATA[<blockquote>
<p>åœ¨ Ubuntu ä¸‹ç›´æ¥ä½¿ç”¨<code>useradd username</code>æ·»åŠ ç”¨æˆ·å¯èƒ½ä¼šå¯¼è‡´ç”¨æˆ·æ²¡æœ‰å®¶ç›®å½•æˆ– tab æ— æ³•è‡ªåŠ¨è¡¥é½çš„é—®é¢˜, éœ€è¦å•ç‹¬åˆ¶å®šè¿™äº›è¿›è¡Œé…ç½®</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">useradd -r -m -s /bin/bash username</span><br></pre></td></tr></table></figure>



<p><code>-r</code>  åˆ›å»ºä¸€ä¸ªç³»ç»Ÿç”¨æˆ·<br><code>-m</code>  å£°æ˜ä¸ºè¯¥ç”¨æˆ·åˆ›å»ºé»˜è®¤çš„å®¶ç›®å½•(å¯ä»¥å•ç‹¬æŒ‡å®š)<br><code>-s</code>  æŒ‡å®šè¯¥ç”¨æˆ·ç™»å½•æ—¶ä½¿ç”¨çš„ç»ˆç«¯ç±»å‹</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>useradd</tag>
      </tags>
  </entry>
  <entry>
    <title>Linuxæ·»åŠ ç”¨æˆ·åˆ°ç»„</title>
    <url>/2017/02/24/Linux%E6%B7%BB%E5%8A%A0%E7%94%A8%E6%88%B7%E5%88%B0%E7%BB%84/</url>
    <content><![CDATA[<blockquote>
<p>åœ¨ docker çš„ä½¿ç”¨ä¸­, å¸¸å¸¸éœ€è¦ä½¿ç”¨æ™®é€šç”¨æˆ·å»æ“ä½œ docker å‘½ä»¤, ç®€å•çš„åŠæ³•å°±æ˜¯æŠŠéœ€è¦æ“ä½œ docker çš„æ™®é€šç”¨æˆ·åŠ å…¥åˆ° docker ç»„ä¸­å³å¯, ä½†æ˜¯éœ€è¦æ³¨æ„ä¸è¦è¦†ç›–æ‰ç”¨æˆ·åŸæ¥æ‰€å±çš„ç»„</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">usermod -a -G docker username</span><br></pre></td></tr></table></figure>

<ul>
<li>-a: append ä½¿ç”¨è¿½åŠ çš„æ–¹å¼æ·»åŠ åˆ°ç»„, ä¸å¿…ç¦»å¼€ç°æœ‰çš„ç”¨æˆ·ç»„</li>
</ul>
<ul>
<li>-G: éœ€è¦åŠ å…¥çš„ç›®æ ‡ç»„</li>
</ul>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>usermod</tag>
      </tags>
  </entry>
  <entry>
    <title> historyå‘½ä»¤æ˜¾ç¤ºæ—¶é—´</title>
    <url>/2017/02/24/history%E5%91%BD%E4%BB%A4%E6%98%BE%E7%A4%BA%E6%97%B6%E9%97%B4/</url>
    <content><![CDATA[<blockquote>
<p>é»˜è®¤æƒ…å†µä¸‹ä¸ç®¡æ˜¯ centos ç³»åˆ—è¿˜æ˜¯ ubuntu ç³»åˆ—, é»˜è®¤çš„ history å‘½ä»¤éƒ½åªæ˜¯æ˜¾ç¤ºäº†å‘½ä»¤ç¼–å·å’Œå…·ä½“å‘½ä»¤è¿™ä¸¤åˆ—ä¿¡æ¯, åœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­, æ·»åŠ æ—¶é—´çš„æ˜¾ç¤ºååˆ†å®ç”¨å’Œé‡è¦</p>
</blockquote>
<p>ç¼–è¾‘<code>/etc/profile</code>æ–‡ä»¶, æ·»åŠ å…¥ä¸‹ä¸€è¡Œå³å¯</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> HISTTIMEFORMAT=<span class="string">"`whoami` %F %T "</span></span><br></pre></td></tr></table></figure>

<ul>
<li>%F: æ—¥æœŸ</li>
</ul>
<ul>
<li>%T: æ—¶é—´</li>
</ul>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>history</tag>
      </tags>
  </entry>
  <entry>
    <title>mysqldump é”™è¯¯2013 Lost connection</title>
    <url>/2017/02/19/mysqldump-%E9%94%99%E8%AF%AF2013-Lost-connection/</url>
    <content><![CDATA[<blockquote>
<p>å¯¼å‡ºæ•°æ®åº“çš„æ—¶å€™æŠ¥å¦‚ä¸‹é”™è¯¯ <code>mysqldump: Error 2013: Lost connection to MySQL server during query when dumping table</code>mail<code>at row: 2637433</code></p>
</blockquote>
<p><strong>æŸ¥è¯¢èµ„æ–™</strong></p>
<p>å¤§æ¦‚è¯´æ˜¯å› ä¸ºmysqldumpæ¥ä¸åŠæ¥å—mysql serverç«¯å‘é€è¿‡æ¥çš„æ•°æ®ï¼ŒServerç«¯çš„æ•°æ®å°±ä¼šç§¯å‹åœ¨å†…å­˜ä¸­ç­‰å¾…å‘é€ï¼Œè¿™ä¸ªç­‰å¾…ä¸æ˜¯æ— é™æœŸçš„ï¼Œå½“Serverçš„ç­‰å¾…æ—¶é—´è¶…è¿‡net_write_timeoutï¼ˆé»˜è®¤æ˜¯60ç§’ï¼‰æ—¶å®ƒå°±å¤±å»äº†è€å¿ƒï¼Œmysqldumpçš„è¿æ¥ä¼šè¢«æ–­å¼€ï¼ŒåŒæ—¶æŠ›å‡ºé”™è¯¯Got error: 2013: Lost connectionã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆä¸€</strong></p>
<p>å¢åŠ net_write_timeoutå¯ä»¥è§£å†³ä¸Šè¿°çš„é—®é¢˜çš„ã€‚åœ¨å®è·µä¸­å‘ç°ï¼Œåœ¨å¢å¤§ net_write_timeoutåï¼ŒServerç«¯ä¼šæ¶ˆè€—æ›´å¤šçš„å†…å­˜ï¼Œæœ‰æ—¶ç”šè‡³ä¼šå¯¼è‡´swapçš„ä½¿ç”¨ï¼ˆå¹¶ä¸ç¡®å®šæ˜¯ä¸æ˜¯ä¿®æ”¹ net_write_timeoutæ‰€è‡³ï¼‰ã€‚å»ºè®®åœ¨mysqldumpä¹‹å‰ä¿®æ”¹net_write_timeoutä¸ºä¸€ä¸ªè¾ƒå¤§çš„å€¼ï¼ˆå¦‚1800ï¼‰ï¼Œåœ¨ mysqldumpç»“æŸåï¼Œåœ¨å°†è¿™ä¸ªå€¼ä¿®æ”¹åˆ°é»˜è®¤çš„60ã€‚</p>
<p>åœ¨sqlå‘½ä»¤è¡Œé‡Œé¢è®¾ç½®ä¸´æ—¶å…¨å±€ç”Ÿæ•ˆç”¨ç±»ä¼¼å¦‚ä¸‹å‘½ä»¤ï¼š<br>SET GLOBAL net_write_timeout=1800;</p>
<p>ä¿®æ”¹äº†è¿™ä¸ªå‚æ•°åå†å¤‡ä»½ï¼Œä¸å†æŠ¥é”™<br>æ³¨æ„ï¼Œè¿™ä¸ªå‚æ•°ä¸æ˜¯mysqldumpé€‰é¡¹ï¼Œè€Œæ˜¯mysqlçš„ä¸€ä¸ªé…ç½®å‚æ•°</p>
<p><strong>è§£å†³æ–¹æ¡ˆäºŒ</strong></p>
<p>åœ¨æ‰§è¡Œ mysqldump çš„æ—¶å€™å¯ä»¥é€šè¿‡æ·»åŠ  <code>--quick</code> çš„å‚æ•°æ¥é¿å…å‡ºç°è¿™æ ·çš„é—®é¢˜</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"> --quickï¼Œ-q</span><br><span class="line"></span><br><span class="line">è¯¥é€‰é¡¹ç”¨äºè½¬å‚¨å¤§çš„è¡¨ã€‚å®ƒå¼ºåˆ¶mysqldumpä»æœåŠ¡å™¨ä¸€æ¬¡ä¸€è¡Œåœ°æ£€ç´¢è¡¨ä¸­çš„è¡Œè€Œä¸æ˜¯æ£€ç´¢æ‰€æœ‰è¡Œå¹¶åœ¨è¾“å‡ºå‰å°†å®ƒç¼“å­˜åˆ°å†…å­˜ä¸­ã€‚</span><br></pre></td></tr></table></figure>

<hr>
<p><strong>å‚è€ƒæ–‡æ¡£</strong></p>
<p><a href="http://www.linuxyw.com/linux/yunweiguzhang/20130609/566.html" target="_blank" rel="noopener">http://www.linuxyw.com/linux/yunweiguzhang/20130609/566.html</a></p>
<p><a href="http://www.cnblogs.com/haven/archive/2012/10/27/2742141.html" target="_blank" rel="noopener">http://www.cnblogs.com/haven/archive/2012/10/27/2742141.html</a></p>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>mysqldump</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQLå¸¸ç”¨å‘½ä»¤</title>
    <url>/2017/02/19/MySQL%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/</url>
    <content><![CDATA[<p><strong>æŸ¥çœ‹å…¨å±€å˜é‡</strong></p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">mysql&gt; show global variables;</span><br><span class="line">mysql&gt; show global variables like '%timeout';</span><br></pre></td></tr></table></figure>

<p><strong>è®¾ç½®å…¨å±€å˜é‡</strong></p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">mysql&gt; set global innodb_ft_min_token_size=1;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>dockerä¸­çš„å¯¼å…¥å¯¼å‡º</title>
    <url>/2017/02/19/docker%E7%9A%84%E5%AF%BC%E5%85%A5%E5%AF%BC%E5%87%BA/</url>
    <content><![CDATA[<blockquote>
<p>åœ¨ docker çš„æ¦‚å¿µä¸­, æœ‰ä¸¤å¥—å¯¼å…¥å¯¼å‡ºçš„æ¦‚å¿µ. åˆ†åˆ«æ˜¯<code>export å’Œ import</code>è¿˜æœ‰<code>save å’Œ load</code> ç™¾åº¦æœç´¢ğŸ”å®ƒä»¬çš„åŒºåˆ«, æœ‰ä¸€ç¯‡è¢«å¼•ç”¨äº†å¾ˆå¤šæ¬¡çš„æ–‡ç« è™½ç„¶è®²çš„å¾ˆè¯¦ç»†, è¿˜åŠ å…¥äº†ä¸€äº›å®éªŒéªŒè¯, ä½†æ˜¯è¯•éªŒä¸­ä¸ºäº†å®ç°åŒä¸€ä¸ªæ•ˆæœè€Œä½¿ç”¨äº† commit å‘½ä»¤æ›´æ”¹äº†é•œåƒå†…å®¹. ç†è§£å’Œä½¿ç”¨èµ·æ¥å¯èƒ½ä¼šæœ‰äº›åå·®, æœ¬æ–‡å°†ä»¥æœ€ç®€å•æ˜äº†çš„æ–¹å¼ä»‹ç» docker ä¸­çš„ä¸¤å¥—å¯¼å…¥å¯¼å‡ºåŠŸèƒ½</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center"></th>
<th align="center">export&amp;import</th>
<th align="center">save&amp;load</th>
</tr>
</thead>
<tbody><tr>
<td align="center">æ“ä½œå¯¹è±¡</td>
<td align="center">å®¹å™¨</td>
<td align="center">é•œåƒ</td>
</tr>
<tr>
<td align="center">å¯¼å‡ºå¯¹è±¡</td>
<td align="center">tar æ–‡ä»¶</td>
<td align="center">tar æ–‡ä»¶</td>
</tr>
<tr>
<td align="center">å¯¼å…¥å¯¹è±¡</td>
<td align="center">é•œåƒ</td>
<td align="center">é•œåƒ</td>
</tr>
<tr>
<td align="center">é•œåƒå±‚æ•°</td>
<td align="center">ä¸€å±‚</td>
<td align="center">å¤šå±‚</td>
</tr>
</tbody></table>
<p><strong>ä¸‹é¢æˆ‘ä»¬æ¥ä¸€è¡Œä¸€è¡Œçš„è§£é‡Š</strong></p>
<h1 id="æ“ä½œå¯¹è±¡"><a href="#æ“ä½œå¯¹è±¡" class="headerlink" title="æ“ä½œå¯¹è±¡"></a>æ“ä½œå¯¹è±¡</h1><p>æ“ä½œçš„å¯¹è±¡ä¸åŒ, export å’Œ import æ˜¯ç”¨æ¥å¯¼å…¥å¯¼å‡ºå®¹å™¨ç”¨çš„, è€Œ save å’Œ load æ˜¯ç”¨æ¥å¯¼å…¥å¯¼å‡ºé•œåƒç”¨çš„.</p>
<p>ä¾‹å¦‚: ä½ éœ€è¦æŠŠ <code>A</code> æœºå™¨ä¸Šçš„ <code>ç”²</code> å®¹å™¨è¿ç§»åˆ° <code>B</code> æœºå™¨, ä¸” <code>ç”²</code> å®¹å™¨ä¸­æœ‰é‡è¦çš„æ•°æ®éœ€è¦éšä¹‹ä¸€èµ·è¿ç§»çš„, å°±å¯ä»¥ä½¿ç”¨ <code>export å’Œ import</code> å‚æ•°æ¥å¯¼å…¥å’Œå¯¼å‡º</p>
<p>ä¾‹å¦‚: ä½ çš„æœåŠ¡å™¨ä¸èƒ½ pull ä¸‹æ¥æŸä¸ªé•œåƒ, ä½†æ˜¯ä½ æœ‰ä¸€å°æµ·å¤–çš„æœºå™¨, ä½ å¯ä»¥åœ¨æµ·å¤–çš„é‚£å°æœºå™¨ä¸ŠæŠŠéœ€è¦çš„é•œåƒ pull ä¸‹æ¥, ç„¶åæŠŠè¯¥é•œåƒé€šè¿‡ <code>save</code> å‘½ä»¤å¯¼å‡ºä¸ºä¸€ä¸ª tar åŒ…, å†å°† tar åŒ…æ‹‰å›åˆ°æœ¬åœ°å¯¼å…¥</p>
<p>æ‰€ä»¥, ä»åŠŸèƒ½å®šä½ä¸Š, ä½ å°±è®°ä½ <code>save å’Œ load</code>å‚æ•°æ˜¯ç”¨æ¥è¿ç§»é•œåƒçš„è¿™ä¸ªåœºæ™¯å°±è¡Œäº†, å¦å¤–çš„ <code>export å’Œ import</code>å½“ç„¶å°±æ˜¯ç”¨æ¥è¿å®¹å™¨çš„</p>
<h1 id="å¯¼å‡ºå¯¹è±¡"><a href="#å¯¼å‡ºå¯¹è±¡" class="headerlink" title="å¯¼å‡ºå¯¹è±¡"></a>å¯¼å‡ºå¯¹è±¡</h1><p>åœ¨å¯¼å‡ºå¯¹è±¡è¿™ä¸€ç‚¹, <code>export</code> å’Œ <code>save</code> å¯¼å‡ºçš„æ–‡ä»¶å½¢å¼éƒ½æ˜¯ä¸€æ ·çš„, ä¸¤è€…éƒ½æ˜¯å¯¼å‡ºä¸ºä¸€ä¸ª tar åŒ…</p>
<h1 id="å¯¼å…¥å¯¹è±¡"><a href="#å¯¼å…¥å¯¹è±¡" class="headerlink" title="å¯¼å…¥å¯¹è±¡"></a>å¯¼å…¥å¯¹è±¡</h1><p>åœ¨å¯¼å…¥ä¸Š, <code>import</code> å’Œ <code>load</code> é€šè¿‡ tar åŒ…å¯¼å…¥çš„éƒ½æ˜¯ä¸€ä¸ªé•œåƒ</p>
<h1 id="å¯¼å…¥çš„é•œåƒå±‚æ•°"><a href="#å¯¼å…¥çš„é•œåƒå±‚æ•°" class="headerlink" title="å¯¼å…¥çš„é•œåƒå±‚æ•°"></a>å¯¼å…¥çš„é•œåƒå±‚æ•°</h1><p>æœ€å¤§çš„åŒºåˆ«å°±åœ¨è¿™é‡Œ, é€šè¿‡<code>export å’Œ import</code>å¯¼å‡ºçš„å®¹å™¨å½¢æˆé•œåƒæ—¶, è¯¥é•œåƒåªæœ‰ä¸€å±‚</p>
<p>é€šè¿‡<code>save</code> å’Œ <code>load</code> å¯¼å‡ºçš„é•œåƒä¿ç•™äº†åŸé•œåƒæ‰€æœ‰çš„å±‚æ¬¡ç»“æ„, å¯¼å‡ºæ—¶åŸé•œåƒæœ‰å‡ å±‚, å¯¼å…¥çš„æ—¶å€™å°±è¿˜æ˜¯æœ‰å‡ å±‚</p>
<h1 id="æƒ³å¯¼å‡ºå®¹å™¨-ä½†æ˜¯è¿˜æƒ³ä¿ç•™å±‚æ¬¡ç»“æ„æ€ä¹ˆåŠ"><a href="#æƒ³å¯¼å‡ºå®¹å™¨-ä½†æ˜¯è¿˜æƒ³ä¿ç•™å±‚æ¬¡ç»“æ„æ€ä¹ˆåŠ" class="headerlink" title="æƒ³å¯¼å‡ºå®¹å™¨, ä½†æ˜¯è¿˜æƒ³ä¿ç•™å±‚æ¬¡ç»“æ„æ€ä¹ˆåŠ?"></a>æƒ³å¯¼å‡ºå®¹å™¨, ä½†æ˜¯è¿˜æƒ³ä¿ç•™å±‚æ¬¡ç»“æ„æ€ä¹ˆåŠ?</h1><p>å¯¼å‡ºå®¹å™¨, å¾ˆå¿«å°±æƒ³åˆ°å”¯ä¸€ä¸€ä¸ªå¯ä»¥å¯¼å‡ºå®¹å™¨çš„å·¥å…· <code>export</code></p>
<p>ä½†æ˜¯åˆæƒ³ä¿ç•™åº•å±‚é•œåƒçš„å±‚æ¬¡ç»“æ„, é‚£ä¹ˆ <code>export</code> å°±ä¸ç¬¦åˆéœ€æ±‚äº†</p>
<p>æƒ³æƒ³å¯¼å‡ºå¸¦å±‚æ¬¡ç»“æ„çš„å·¥å…·å°±åªæœ‰é•œåƒå¯¼å‡ºå·¥å…· <code>save</code> äº†, ä½†æ˜¯å®¹å™¨åœ¨é•œåƒå±‚ä¹‹ä¸Šè¿˜æœ‰ä¸€å±‚æ–°çš„æ•°æ®æ€ä¹ˆä¸€èµ·å¯¼å‡ºå»å‘¢? </p>
<p>è¿™ä¸ªæ—¶å€™å°±éœ€è¦å¼•å…¥ä¸€ä¸ªæ–°çš„å‚æ•° <code>commit</code>, ç”¨æ¥ä¿å­˜å®¹å™¨ç°æœ‰çš„çŠ¶æ€ä¸ºä¸€ä¸ªæ–°çš„é•œåƒ </p>
<p>æ¯”å¦‚åœ¨ <code>A</code> æœºå™¨ä¸Šè¿è¡Œçš„ <code>ç”²</code> å®¹å™¨æ˜¯åŸºäº <code>ç”²æ–¹ä¹™æ–¹</code> è¿™ä¸ªé•œåƒè·‘èµ·æ¥çš„, é‚£ä¹ˆæˆ‘å°±å¯ä»¥é€šè¿‡ <code>commit</code> å‚æ•°, å°† <code>ç”²</code> å®¹å™¨çš„æ‰€æœ‰å†…å®¹ä¿å­˜ä¸ºä¸€ä¸ªæ–°çš„é•œåƒ, åå­—å« <code>ç§äººè®¢åˆ¶</code> (å†…å«ä¸€æ¢—å“¦ğŸ˜†) æœ€åæˆ‘å†é€šè¿‡é•œåƒå¯¼å‡ºå·¥å…· <code>save</code> å°±å¯ä»¥å®Œæ•´çš„å°† <code>ç§äººè®¢åˆ¶</code>é•œåƒ(ä¹Ÿå°±æ˜¯ <code>ç”²å®¹å™¨</code> )å¯¼å‡ºä¸ºä¸€ä¸ª tar åŒ…äº†</p>
<p>è€Œä¸”åŒ…å«äº† X+1 å±‚é•œåƒ, X å±‚æ˜¯åŸé•œåƒ <code>ç”²æ–¹ä¹™æ–¹</code> çš„æ‰€æœ‰é•œåƒå±‚æ•°, 1æ˜¯å®¹å™¨ <code>ç”²</code> å¤šçš„é‚£ä¸€å±‚å¯å†™å±‚çš„é•œåƒ</p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æ€»ç»“æ¥è¯´æˆ‘ä¹Ÿå¸Œæœ›å¤§å®¶ä½¿ç”¨ docker èƒ½éµå¾ª docker çš„è®¾è®¡åˆè¡·, è¿è¡Œä¸€ä¸ªæ— çŠ¶æ€çš„å®¹å™¨. å¦‚æœæ˜¯æ— çŠ¶æ€çš„å®¹å™¨, å°±ä¸ä¼šäº§ç”Ÿ <code>æƒ³å¯¼å‡ºå®¹å™¨, ä½†æ˜¯è¿˜æƒ³ä¿ç•™å±‚æ¬¡ç»“æ„æ€ä¹ˆåŠ?</code> è¿™æ ·çš„å¥‡è‘©é—®é¢˜äº†. </p>
<p>æ‰€ä»¥æœ€åè¿˜æ˜¯è¦å†æ¬¡å¼ºè°ƒ:</p>
<ul>
<li>export å’Œ import æ˜¯ç”¨æ¥å¯¼å‡ºå¯¼å…¥å®¹å™¨ç”¨çš„, å¯¼å‡ºçš„æ˜¯å®¹å™¨çš„æ–‡ä»¶ç³»ç»Ÿ, å¯¼å‡ºåçš„é•œåƒåªæœ‰ä¸€å±‚</li>
<li>save å’Œ load æ˜¯ç”¨æ¥å¯¼å‡ºå¯¼å…¥é•œåƒç”¨çš„, å¯¼å‡ºåä¿æŒç€åŸé•œåƒçš„å±‚æ¬¡ç»“æ„</li>
</ul>
<p>è¿™é‡Œæˆ‘æ²¡æœ‰è¯¦ç»†ä»‹ç»è¿™å››ä¸ªå‚æ•°çš„å…·ä½“ç”¨æ³•, å› ä¸ºç½‘ä¸Šå·²ç»æœ‰å¾ˆè¯¦ç»†çš„æ–‡ç« ä»‹ç»å•¦, ä¸€ä¸‹å°±æ˜¯ç™¾åº¦ç»å¸¸èƒ½æœåˆ°çš„å…³äº docker å¯¼å…¥å¯¼å‡ºçš„æ–‡ç« </p>
<p><a href="https://my.oschina.net/zjzhai/blog/225112" target="_blank" rel="noopener">https://my.oschina.net/zjzhai/blog/225112</a></p>
<p>å…·ä½“ç”¨æ³•å¯ä»¥å‚è€ƒä»¥ä¸Šæ–‡ç« , ä½†æ˜¯æ¦‚å¿µç†è§£, æˆ‘è¿˜æ˜¯è§‰å¾—è‡ªå·±å†™çš„æ¯”è¾ƒæ¸…æ¥šğŸ˜†, å› ä¸ºæˆ‘æ²¡æœ‰æ•…æ„æ„é€ å‡ºå¯¼å‡ºå®¹å™¨å’Œå¯¼å‡ºé•œåƒç»“æœç›¸åŒçš„åœºæ™¯</p>
<hr>
<p>å‚è€ƒæ–‡æ¡£</p>
<p>docker export å®˜æ–¹æ–‡æ¡£<a href="https://docs.docker.com/engine/reference/commandline/export/" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/commandline/export/</a></p>
<p>docker save å®˜æ–¹æ–‡æ¡£<a href="https://docs.docker.com/engine/reference/commandline/save/" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/commandline/save/</a></p>
<p>docker commit å®˜æ–¹æ–‡æ¡£<a href="https://docs.docker.com/engine/reference/commandline/commit/" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/commandline/commit/</a></p>
]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>import</tag>
        <tag>export</tag>
        <tag>save</tag>
        <tag>load</tag>
      </tags>
  </entry>
  <entry>
    <title>æ›´æ”¹dockerçš„æ—¥å¿—å¼•æ“ä¸º journald</title>
    <url>/2017/02/19/%E6%9B%B4%E6%94%B9docker%E7%9A%84%E6%97%A5%E5%BF%97%E5%BC%95%E6%93%8E%E4%B8%BA-journald/</url>
    <content><![CDATA[<blockquote>
<p>åœ¨ docker åŸç”Ÿæ”¯æŒçš„ä¼—å¤šæ—¥å¿—å¼•æ“ä¸­, ç»“åˆå®é™…ç”Ÿäº§ç¯å¢ƒçš„éœ€æ±‚, æœ€ç»ˆé€‰æ‹©äº†ä¼—å¤šlinux å‘è¡Œç‰ˆéƒ½é»˜è®¤æ”¯æŒçš„ journald æ—¥å¿—ç³»ç»Ÿ, journald æ—¥å¿—ç³»ç»Ÿæ˜¯ systemd è‡ªå¸¦çš„æœåŠ¡, åœ¨å®é™…ä½¿ç”¨è¿‡ç¨‹ä¸­, ä¸Šæ‰‹å¾ˆå¿«, è€Œä¸”å¾ˆç¬¦åˆçº¿ä¸ŠæŸ¥çœ‹ docker æ—¥å¿—çš„ä¹ æƒ¯ä¸éœ€æ±‚</p>
</blockquote>
<h1 id="dockeråŸç”Ÿæ”¯æŒçš„æ—¥å¿—å¼•æ“"><a href="#dockeråŸç”Ÿæ”¯æŒçš„æ—¥å¿—å¼•æ“" class="headerlink" title="dockeråŸç”Ÿæ”¯æŒçš„æ—¥å¿—å¼•æ“"></a>dockeråŸç”Ÿæ”¯æŒçš„æ—¥å¿—å¼•æ“</h1><ul>
<li>none <strong>å…³é—­ docker çš„å›æ˜¾æ—¥å¿—, docker logs çœ‹ä¸åˆ°ä»»ä½•è¾“å‡º</strong></li>
<li>json-file <strong>æŠŠæ¯ä¸ª container çš„å›æ˜¾æ—¥å¿—æ‰“åˆ°æ¯ä¸ª container çš„å†…éƒ¨, å½¢å¼ä¸ºjson æ–‡ä»¶</strong></li>
<li>syslog <strong>æŠŠæ‰€æœ‰ container çš„å›æ˜¾æ—¥å¿—æ‰“åˆ°ç³»ç»Ÿçš„ syslog ä¸­</strong></li>
<li>journald <strong>æŠŠæ‰€æœ‰ container çš„å›æ˜¾æ—¥å¿—æ‰“åˆ°ç³»ç»Ÿçš„ journald æœåŠ¡ä¸­</strong></li>
<li>fluentd <strong>æŠŠæ‰€æœ‰ container çš„å›æ˜¾æ—¥å¿—æ‰“åˆ° fluentd æœåŠ¡ä¸­</strong></li>
<li>gelf <strong>æŠŠæ‰€æœ‰ container çš„å›æ˜¾æ—¥å¿—æ‰“åˆ°æ”¯æŒ GELF(Graylog Extended Log Format) æ ¼å¼çš„æœåŠ¡ä¸­, æ¯”å¦‚ Graylog æˆ– Logstash</strong></li>
</ul>
<p>ä»¥ä¸ŠåŸç”Ÿçš„æ—¥å¿—å¼•æ“æ˜¯æœ€å¸¸ç”¨çš„6ç§,å…¶ä¸­ <code>json-file</code> æ˜¯ docker é»˜è®¤ä½¿ç”¨çš„æ—¥å¿—ç³»ç»Ÿ</p>
<h1 id="ä¸ºä»€ä¹ˆé€‰æ‹©äº†journald"><a href="#ä¸ºä»€ä¹ˆé€‰æ‹©äº†journald" class="headerlink" title="ä¸ºä»€ä¹ˆé€‰æ‹©äº†journald"></a>ä¸ºä»€ä¹ˆé€‰æ‹©äº†journald</h1><ul>
<li>é¦–å…ˆæ’é™¤äº† <code>none</code> çš„æ—¥å¿—å¼•æ“, å› ä¸ºå®ƒæŠ›å¼ƒäº†å®¿ä¸»æœºä¸­æ‰€æœ‰ container çš„å›æ˜¾æ—¥å¿—</li>
<li>ä¹‹æ‰€æœ‰æ’é™¤ <code>json-file</code> æ˜¯å› ä¸ºåœ¨å®é™…ä½¿ç”¨ä¸­, æœ‰çš„ container åœ¨å¯åŠ¨åæœ‰å¤§é‡çš„å›æ˜¾æ—¥å¿—, å°¤å…¶åœ¨ç¨‹åºå†…éƒ¨æŠ¥é”™æ—¶æ‰“å‡ºçš„æ—¥å¿—ä¿¡æ¯å°¤å…¶å·¨å¤§, è€Œè¯¥ json æ–‡ä»¶ä¼šæ”¾åˆ°ç£ç›˜å¯¹åº”è¯¥ container çš„æ–‡ä»¶å¤¹ä¸­è¶Šæ¥è¶Šå¤§, å¸¸å¸¸å› ä¸ºæŸå‡ ä¸ª container çš„ json æ—¥å¿—è€Œæ’‘çˆ†æ•´ä¸ªå®¿ä¸»æœºçš„ç£ç›˜</li>
<li>syslog æ—¥å¿—æ”¶é›†çš„æ–¹å¼æˆ‘åœ¨ä½¿ç”¨ harbor ç§æœ‰é•œåƒæœåŠ¡çš„æ—¶å€™è§è¿‡, harbor å®˜æ–¹æä¾›çš„éƒ¨ç½²æ–¹å¼ä¸­, æ‰€æœ‰çš„ container çš„æ—¥å¿—éƒ½é›†ä¸­æ”¶é›†åœ¨æŸä¸€ä¸ª container ä¸­, æ‰§è¡Œ docker logs çš„æ—¶å€™ä¼šæç¤ºä½  <code>&quot;logs&quot; command is supported only for &quot;json-file&quot; and &quot;journald&quot; logging drivers (got: syslog)</code></li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># syslog åœ¨ harbor ä¸­çš„åº”ç”¨è§£æ</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#harbor æœåŠ¡ç”±å¤šäº† container ç»„æˆ, å…¶ä¸­æœ‰ä¸€ä¸ª container çš„åå­—å« "harbor-log" è¿™ä¸ªå°±æ˜¯æ•´ä¸ª harbor æœåŠ¡æ—¥å¿—çš„å¤§æœ¬è¥</span></span><br><span class="line"></span><br><span class="line">CONTAINER ID        IMAGE                            COMMAND                  CREATED             STATUS              PORTS                                            NAMES</span><br><span class="line">55917fe77a5d        nginx:1.11.5                     <span class="string">"nginx -g 'daemon off"</span>   5 weeks ago         Up 5 weeks          0.0.0.0:80-&gt;80/tcp, 0.0.0.0:443-&gt;443/tcp         nginx</span><br><span class="line">66a5f3fd3c41        vmware/harbor-jobservice:0.5.0   <span class="string">"/harbor/harbor_jobse"</span>   5 weeks ago         Up 5 weeks                                                           harbor-jobservice</span><br><span class="line">732e69978f61        vmware/harbor-ui:0.5.0           <span class="string">"/harbor/harbor_ui"</span>      5 weeks ago         Up 5 weeks                                                           harbor-ui</span><br><span class="line">61678dddbc21        library/registry:2.5.0           <span class="string">"/entrypoint.sh serve"</span>   5 weeks ago         Up 5 weeks          5000/tcp                                         registry</span><br><span class="line">18a49a051913        vmware/harbor-db:0.5.0           <span class="string">"docker-entrypoint.sh"</span>   5 weeks ago         Up 5 weeks          3306/tcp                                         harbor-db</span><br><span class="line">aac08df72abb        vmware/harbor-log:0.5.0          <span class="string">"/bin/sh -c 'crond &amp;&amp;"</span>   5 weeks ago         Up 5 weeks          0.0.0.0:1514-&gt;514/tcp                            harbor-log</span><br><span class="line"></span><br><span class="line"><span class="comment"># é™¤äº† "harbor-log" è¿™ä¸ªå®¹å™¨ä¹‹å¤–, æ‰€æœ‰å®¹å™¨çš„æ—¥å¿—ç±»å‹éƒ½æ˜¯å¦‚ä¸‹æŒ‡å®šçš„</span></span><br><span class="line"></span><br><span class="line"><span class="string">"LogConfig"</span>: &#123;</span><br><span class="line">    <span class="string">"Type"</span>: <span class="string">"syslog"</span>,</span><br><span class="line">        <span class="string">"Config"</span>: &#123;</span><br><span class="line">            <span class="string">"syslog-address"</span>: <span class="string">"tcp://127.0.0.1:1514"</span>,</span><br><span class="line">            <span class="string">"tag"</span>: <span class="string">"proxy"</span></span><br><span class="line">        &#125;</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰€æœ‰å®¹å™¨çš„å›æ˜¾æ—¥å¿—éƒ½å‘é€åˆ°äº† "127.0.0.1:1514" è¿™ä¸ªåœ°å€, è€Œè¿™ä¸ªåœ°å€å°±æ˜¯ "harbor-log" å®¹å™¨å¯¹å¤–æ˜ å°„çš„ç«¯å£</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯ä»¥çœ‹å‡º harbor çš„ç”¨æ³•æ˜¯å•ç‹¬åˆ›å»ºä¸€ä¸ªå®¹å™¨ç”¨æ¥æ”¶é›†æ‰€æœ‰ç›¸å…³å®¹å™¨çš„æ—¥å¿—</span></span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªæ¨¡å¼åœ¨æˆ‘ä»¬ç”Ÿäº§ç¯å¢ƒä¸­å¹¶ä¸é€‚ç”¨, å› ä¸ºæ— æ³•é€šè¿‡ <code>docker logs</code> ç›´æ¥æŸ¥çœ‹æ—¥å¿—, è€Œæ˜¯éœ€è¦åˆ°æŒ‡å®šçš„å®¹å™¨ä¸­å»æ‰¾, è¿™å¯¹äºç ”å‘æŸ¥çœ‹æ—¥å¿—æ‹é”™æ¥è¯´æ— ç–‘æ˜¯ä¸ªå·¨å¤§çš„éº»çƒ¦.æ‰€ä»¥è¿™ä¸ªæ—¥å¿—å¼•æ“ä¹Ÿä¸é€‚ç”¨äºæˆ‘ä»¬çš„ç”Ÿäº§ç¯å¢ƒ</p>
<ul>
<li>fluentd å’Œ gelf è¿™ä¸¤ä¸ªæ—¥å¿—æœåŠ¡ç±»å‹ä¸€èˆ¬æ˜¯é…åˆ elasticsearch/kibana æ¥ä¸€èµ·ä½¿ç”¨, å› ä¸ºå›æ˜¾æ—¥å¿—æ˜¯ç¨‹åºå›æ˜¾, ä¸æ˜¯ä¸šåŠ¡æ—¥å¿—å›æ˜¾, æ‰€ä»¥æ²¡æœ‰è¿›å…¥åˆ° elasticsearch åˆ†æçš„éœ€æ±‚, ä¸šåŠ¡æ—¥å¿—ä¸€éƒ¨åˆ†åœ¨ nginx é‚£ä¸€å±‚å°±åˆ†æäº†, è¿˜æœ‰çš„æ˜¯é€šè¿‡æŠŠæ—¥å¿—ç›®å½•æŒ‚è½½å‡ºæ¥, è®©å®¿ä¸»æœºçš„ Log æœåŠ¡å»å¤„ç†çš„. å› ä¸ºè§„æ¨¡æ¯”è¾ƒå°, æ‰€ä»¥æš‚æ—¶ç”¨ä¸åˆ°è¿™ä¸ªé‡çš„æ—¥å¿—æœåŠ¡. å¦‚æœä½ éœ€è¦åˆ†æå¾ˆå¤š container çš„æ—¥å¿—, å¯ä»¥è€ƒè™‘ä½¿ç”¨ fluentd æˆ– logstash</li>
</ul>
<p><strong>å°ç»“:</strong> å› ä¸ºé‡çº§ä¸å¤Ÿå¤§, ç”¨ä¸åˆ° fluentd å’Œ logstash; å› ä¸ºç ”å‘æœ‰éœ€æ±‚é€šè¿‡ <code>docker logs</code> å¿«é€ŸæŸ¥çœ‹æ—¥å¿—, æ‰€ä»¥ä¸èƒ½ç”¨ syslog; å› ä¸º json-file æœ‰è®©æ—¥å¿—æ–‡ä»¶æ— æ­¢å¢ƒå˜å¤§çš„é—®é¢˜, è€Œæ¸…æ‰è¿™ä¸ªæ—¥å¿—åªèƒ½é€šè¿‡åœæ­¢â¹docker æœåŠ¡åæ‰èƒ½<code>echo &gt; filename</code>è¢«é‡å®šå‘æ‰, å¦åˆ™ä¼šå¼•èµ· docker æœåŠ¡çš„å´©æºƒ; æœ€ç»ˆé€‰æ‹©äº†ç°åœ¨å¤§å¤šæ•° Linux å‘è¡Œç‰ˆé»˜è®¤æ”¯æŒçš„ journald æ—¥å¿—æœåŠ¡.</p>
<h1 id="æ›´æ”¹-docker-çš„é»˜è®¤å­˜å‚¨å¼•æ“"><a href="#æ›´æ”¹-docker-çš„é»˜è®¤å­˜å‚¨å¼•æ“" class="headerlink" title="æ›´æ”¹ docker çš„é»˜è®¤å­˜å‚¨å¼•æ“"></a>æ›´æ”¹ docker çš„é»˜è®¤å­˜å‚¨å¼•æ“</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt; vim &#x2F;etc&#x2F;docker&#x2F;daemon.js</span><br><span class="line">&#123;</span><br><span class="line">    &quot;log-driver&quot;: &quot;journald&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åªéœ€åœ¨ json é…ç½®æ–‡ä»¶ä¸­åŠ å…¥ä¸€è¡Œæ—¥å¿—å¼•æ“çš„é…ç½®å³å¯, æœ€åé‡å¯ docker æœåŠ¡</p>
<p>å¯ä»¥é€šè¿‡ <code>docker info</code> æŸ¥çœ‹æ›´æ”¹åçš„æ—¥å¿—å¼•æ“</p>
<h1 id="æŒ‡å®š-container-å¯åŠ¨æ—¶çš„å­˜å‚¨å¼•æ“"><a href="#æŒ‡å®š-container-å¯åŠ¨æ—¶çš„å­˜å‚¨å¼•æ“" class="headerlink" title="æŒ‡å®š container å¯åŠ¨æ—¶çš„å­˜å‚¨å¼•æ“"></a>æŒ‡å®š container å¯åŠ¨æ—¶çš„å­˜å‚¨å¼•æ“</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run \</span><br><span class="line">         --<span class="built_in">log</span>-driver=journald \</span><br><span class="line">         alpine ash</span><br></pre></td></tr></table></figure>

<p>æ›´æ¢ä¸º journald æ—¥å¿—å¼•æ“å, æ‰€æœ‰ä½¿ç”¨ journald å¼•æ“çš„ container ä¾ç„¶å¯ä»¥é€šè¿‡ <code>docker logs containerName</code> çš„æ–¹å¼æŸ¥çœ‹å›æ˜¾æ—¥å¿—, ä¹Ÿå¯ä»¥åœ¨å®¿ä¸»æœºä¸­ä½¿ç”¨ <code>journalctl</code> å‘½ä»¤æ¥æŸ¥çœ‹æ—¥å¿—çš„é›†åˆ,ä»¥ä¸‹æ˜¯ journalctl çš„å¸¸ç”¨é…ç½®åŠç”¨æ³•ç®€ä»‹</p>
<h1 id="journald-é…ç½®æ–‡ä»¶"><a href="#journald-é…ç½®æ–‡ä»¶" class="headerlink" title="journald é…ç½®æ–‡ä»¶"></a>journald é…ç½®æ–‡ä»¶</h1><p>journald çš„é…ç½®æ–‡ä»¶å­˜æ”¾åœ¨ <code>/etc/systemd/journald.conf</code></p>
<p>é»˜è®¤çš„å†…å®¹å¦‚ä¸‹:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[Journal]</span><br><span class="line">#Storage&#x3D;auto  å­˜å‚¨ä¸ºè‡ªåŠ¨æ¨¡å¼, å…¶ä»–æ¨¡å¼æœ‰æ— æ—¥å¿—æ¨¡å¼, çº¯å†…å­˜æ¨¡å¼å’Œçº¯ç£ç›˜æ¨¡å¼</span><br><span class="line">#Compress&#x3D;yes  é»˜è®¤å¯åŠ¨å‹ç¼©åŠŸèƒ½</span><br><span class="line">#Seal&#x3D;yes   é»˜è®¤åŠ å¯†, æ—¥å¿—æ–‡ä»¶ä¸ºäºŒè¿›åˆ¶æ–‡ä»¶, æ— æ³• vimæˆ–tail æŸ¥çœ‹</span><br><span class="line">#SplitMode&#x3D;uid</span><br><span class="line">#SyncIntervalSec&#x3D;5m</span><br><span class="line">#RateLimitIntervalSec&#x3D;30s</span><br><span class="line">#RateLimitBurst&#x3D;1000</span><br><span class="line">#SystemMaxUse&#x3D;  ç²¾ç¡®è®¾ç½®æ—¥å¿—å¯ä»¥å ç”¨çš„æœ€å¤§ç£ç›˜ç©ºé—´</span><br><span class="line">#SystemKeepFree&#x3D;  ä¿è¯ç³»ç»Ÿå‰©ä½™çš„ç©ºé—´å¤§å°</span><br><span class="line">#SystemMaxFileSize&#x3D;</span><br><span class="line">#SystemMaxFiles&#x3D;100</span><br><span class="line">#RuntimeMaxUse&#x3D;</span><br><span class="line">#RuntimeKeepFree&#x3D;</span><br><span class="line">#RuntimeMaxFileSize&#x3D;</span><br><span class="line">#RuntimeMaxFiles&#x3D;100</span><br><span class="line">#MaxRetentionSec&#x3D;</span><br><span class="line">#MaxFileSec&#x3D;1month</span><br><span class="line">#ForwardToSyslog&#x3D;no</span><br><span class="line">#ForwardToKMsg&#x3D;no</span><br><span class="line">#ForwardToConsole&#x3D;no</span><br><span class="line">#ForwardToWall&#x3D;yes</span><br><span class="line">#TTYPath&#x3D;&#x2F;dev&#x2F;console</span><br><span class="line">#MaxLevelStore&#x3D;debug</span><br><span class="line">#MaxLevelSyslog&#x3D;debug</span><br><span class="line">#MaxLevelKMsg&#x3D;notice</span><br><span class="line">#MaxLevelConsole&#x3D;info</span><br><span class="line">#MaxLevelWall&#x3D;emerg</span><br></pre></td></tr></table></figure>

<p>journald é»˜è®¤é…ç½®ä¸‹, é»˜è®¤æ—¥å¿—æœ€å¤§é™åˆ¶ä¸ºæ‰€åœ¨æ–‡ä»¶ç³»ç»Ÿå®¹é‡çš„ 10%</p>
<p>é»˜è®¤é…ç½®ä¸‹, journald çš„æ—¥å¿—å­˜æ”¾åœ¨ <code>/var/log/journal</code> ä¸‹, å¦‚æœè¯¥ç›®å½•åœ¨æ ¹åˆ†åŒºä¸‹, ä¸”æ ¹åˆ†åŒºç©ºé—´å¤§å°ä¸º10G, é‚£ä¹ˆ journald å­˜æ”¾æ—¥å¿—æœ€å¤§çš„å¤§å°ä¸º1G, è¶…å‡º1G åå°†åˆ é™¤æœ€æ—©çš„æ—¥å¿—</p>
<p>ä¹Ÿå¯ä»¥ç²¾ç¡®æŒ‡å®šå ç”¨çš„ç©ºé—´å¤§å°</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">SystemMaxUse&#x3D;50M</span><br></pre></td></tr></table></figure>

<p>å…¶ä»– journald çš„é…ç½®ä¹Ÿæ²¡æœ‰ç»†ç ”ç©¶è¿‡, ä¸»è¦è¿˜æ˜¯æ²¡æœ‰éœ€æ±‚<del>~</del> ğŸ˜†</p>
<h1 id="journalctl-çš„ä½¿ç”¨"><a href="#journalctl-çš„ä½¿ç”¨" class="headerlink" title="journalctl çš„ä½¿ç”¨"></a>journalctl çš„ä½¿ç”¨</h1><ul>
<li><code>journalctl</code> ä»å¤´æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—</li>
<li><code>journalctl -b</code> æŸ¥çœ‹æœ¬æ¬¡å¼€æœºåçš„æ‰€æœ‰ç³»ç»Ÿå¼•å¯¼æ—¥å¿— <code>journalctl -b -1</code> æ˜¾ç¤ºä¸Šæ¬¡å¼€æœºåçš„ç³»ç»Ÿå¼•å¯¼æ—¥å¿—, ä»¥æ­¤ç±»æ¨</li>
<li><code>journalctl -f</code> ç±»ä¼¼äº <code>tail -f</code>æˆ–<code>tailf</code></li>
<li><code>journalctl /usr/bin/dockerd</code> ååŠ ç¨‹åºçš„ç»å¯¹è·¯å¾„,å¯ä»¥æ˜¾ç¤ºè¯¥ç¨‹åºçš„æ‰€æœ‰æ—¥å¿—ä¿¡æ¯</li>
<li><code>journalctl -xe</code> systemd å¯åŠ¨ç¨‹åºå¤±è´¥æ—¶ä¼šæç¤ºä½ ä½¿ç”¨è¿™ä¸ªå‘½ä»¤æŸ¥çœ‹é”™è¯¯ä¿¡æ¯, å…¶ä¸­<code>x</code> è¡¨ç¤ºåœ¨æ—¥å¿—è¾“å‡ºä¸­å¢åŠ ä¸€äº›è§£é‡Šæ€§çš„çŸ­æ–‡æœ¬, <code>e</code>è¡¨ç¤ºç«‹å³è·³è½¬è‡³æ—¥å¿—çš„å°¾éƒ¨</li>
</ul>
<h1 id="journald-ä½¿ç”¨æ³¨æ„äº‹é¡¹"><a href="#journald-ä½¿ç”¨æ³¨æ„äº‹é¡¹" class="headerlink" title="journald ä½¿ç”¨æ³¨æ„äº‹é¡¹"></a>journald ä½¿ç”¨æ³¨æ„äº‹é¡¹</h1><p>åœ¨ journald æ—¥å¿—å¼•æ“çš„å®é™…ä½¿ç”¨ä¸­, æˆ‘ä»¬å‘ç°äº†å¦ä¸€ä¸ªé—®é¢˜, å°±æ˜¯ journald çš„é»˜è®¤é…ç½®æ–‡ä»¶ä¸­çš„ä¸€ä¸ªé—®é¢˜. åœ¨ journald é»˜è®¤çš„é…ç½®æ–‡ä»¶ä¸­</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@larry-ali:~<span class="comment"># cat /etc/systemd/journald.conf</span></span><br><span class="line"><span class="comment">#  This file is part of systemd.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#  systemd is free software; you can redistribute it and/or modify it</span></span><br><span class="line"><span class="comment">#  under the terms of the GNU Lesser General Public License as published by</span></span><br><span class="line"><span class="comment">#  the Free Software Foundation; either version 2.1 of the License, or</span></span><br><span class="line"><span class="comment">#  (at your option) any later version.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Entries in this file show the compile time defaults.</span></span><br><span class="line"><span class="comment"># You can change settings by editing this file.</span></span><br><span class="line"><span class="comment"># Defaults can be restored by simply deleting this file.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># See journald.conf(5) for details.</span></span><br><span class="line"></span><br><span class="line">[Journal]</span><br><span class="line"><span class="comment">#Storage=auto</span></span><br><span class="line"><span class="comment">#Compress=yes</span></span><br><span class="line"><span class="comment">#Seal=yes</span></span><br><span class="line"><span class="comment">#SplitMode=uid</span></span><br><span class="line"><span class="comment">#SyncIntervalSec=5m</span></span><br><span class="line"><span class="comment">#RateLimitInterval=30s</span></span><br><span class="line"><span class="comment">#RateLimitBurst=1000</span></span><br><span class="line"><span class="comment">#SystemMaxUse=</span></span><br><span class="line"><span class="comment">#SystemKeepFree=</span></span><br><span class="line"><span class="comment">#SystemMaxFileSize=</span></span><br><span class="line"><span class="comment">#SystemMaxFiles=100</span></span><br><span class="line"><span class="comment">#RuntimeMaxUse=</span></span><br><span class="line"><span class="comment">#RuntimeKeepFree=</span></span><br><span class="line"><span class="comment">#RuntimeMaxFileSize=</span></span><br><span class="line"><span class="comment">#RuntimeMaxFiles=100</span></span><br><span class="line"><span class="comment">#MaxRetentionSec=</span></span><br><span class="line"><span class="comment">#MaxFileSec=1month</span></span><br><span class="line"><span class="comment">#ForwardToSyslog=yes</span></span><br><span class="line"><span class="comment">#ForwardToKMsg=no</span></span><br><span class="line"><span class="comment">#ForwardToConsole=no</span></span><br><span class="line"><span class="comment">#ForwardToWall=yes</span></span><br><span class="line"><span class="comment">#TTYPath=/dev/console</span></span><br><span class="line"><span class="comment">#MaxLevelStore=debug</span></span><br><span class="line"><span class="comment">#MaxLevelSyslog=debug</span></span><br><span class="line"><span class="comment">#MaxLevelKMsg=notice</span></span><br><span class="line"><span class="comment">#MaxLevelConsole=info</span></span><br><span class="line"><span class="comment">#MaxLevelWall=emerg</span></span><br></pre></td></tr></table></figure>

<p>æœ‰ä»¥ä¸‹å‡ ä¸ªéå¸¸é‡è¦çš„ä¼˜åŒ–é¡¹ç›®</p>
<ul>
<li><code>ForwardToSyslog=yes</code></li>
<li><code>ForwardToWall=yes</code></li>
</ul>
<p>ä»¥ä¸Šä¸¤ä¸ªå‚æ•°é»˜è®¤éƒ½æ˜¯ <code>yes</code> æ„å‘³ç€ journald æ”¶é›†æ—¥å¿—åè¿˜ä¼šè½¬å‘åˆ° syslog ä¸­</p>
<p>ç”±æ­¤é€ æˆçš„å½±å“æ˜¯: journald è™½ç„¶å¯ä»¥ä¹–ä¹–çš„æŒ‰ç…§ä¸Šé¢çš„é…ç½®è¿›è¡Œæ—¥å¿—çš„æ¸…ç†, ä½†æ˜¯ syslog å´ä¸åœ¨ journald çš„æ§åˆ¶èŒƒå›´ä¹‹å†…</p>
<p>åœ¨æ—¥å¿—é‡å¾ˆå¤§çš„æƒ…å†µä¸‹, æˆ‘ä»¬å‘ç° syslog ä¸­çš„æ—¥å¿—é‡ä¹Ÿå˜å¾—å·¨å¤§, è€Œä¸”é‡Œé¢éƒ½æ˜¯å®¹å™¨çš„æ—¥å¿—, æ‰€ä»¥æˆ‘ä»¬éœ€è¦æŠŠä¸Šé¢ä¸¤ä¸ªå‚æ•°çš„å€¼æ”¹ä¸º<code>no</code></p>
<p>ç¦æ­¢ğŸš«journald æ”¶åˆ°æ—¥å¿—åè½¬å‘ç»™ syslog</p>
<p>æ›´æ”¹å®Œé…ç½®æ–‡ä»¶å, é‡å¯ journald æœåŠ¡ <code>systemctl restart systemd-journald.service</code></p>
<hr>
<p><strong>å‚è€ƒæ–‡æ¡£</strong></p>
<p>docker æ—¥å¿—å¼•æ“å®˜æ–¹æ–‡æ¡£: <a href="https://docs.docker.com/engine/admin/logging/overview/" target="_blank" rel="noopener">https://docs.docker.com/engine/admin/logging/overview/</a></p>
<p>journald é…ç½®æ–‡ä»¶å®˜æ–¹æ–‡æ¡£: <a href="https://www.freedesktop.org/software/systemd/man/journald.conf.html#" target="_blank" rel="noopener">https://www.freedesktop.org/software/systemd/man/journald.conf.html#</a></p>
<p>journalctl å‘½ä»¤å®˜æ–¹æ–‡æ¡£: <a href="https://www.freedesktop.org/software/systemd/man/journalctl.html#" target="_blank" rel="noopener">https://www.freedesktop.org/software/systemd/man/journalctl.html#</a></p>
<p>journalctl ä¸­æ–‡manæ‰‹å†Œ:<a href="http://www.jinbuguo.com/systemd/journalctl.html" target="_blank" rel="noopener">http://www.jinbuguo.com/systemd/journalctl.html</a></p>
<p>journald.conf ä¸­æ–‡æ‰‹å†Œ:<a href="http://www.jinbuguo.com/systemd/journald.conf.html" target="_blank" rel="noopener">http://www.jinbuguo.com/systemd/journald.conf.html</a></p>
<p>journald åˆçº§æŒ‡å—:<a href="http://os.51cto.com/art/201405/440886.htm" target="_blank" rel="noopener">http://os.51cto.com/art/201405/440886.htm</a></p>
]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>journald</tag>
      </tags>
  </entry>
  <entry>
    <title>æ›´æ”¹dockerå­˜å‚¨å¼•æ“ä¸ºoverlayfs2</title>
    <url>/2017/02/19/%E6%9B%B4%E6%94%B9docker%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%E4%B8%BAoverlayfs2/</url>
    <content><![CDATA[<blockquote>
<p>åœ¨ docker 1.13ç‰ˆæœ¬å‘å¸ƒå, åœ¨ä¼—å¤šçš„å­˜å‚¨å¼•æ“ä¸­, overlayfs2 è„±é¢–è€Œå‡º, å³å°†ç”¨ä½œä¸ºæœªæ¥ä¸»è¦çš„å­˜å‚¨å¼•æ“. æœ¬ç¯‡æ–‡ç« ä»‹ç»å¦‚ä½•æ›´æ”¹ docker çš„å­˜å‚¨å¼•æ“ä¸º overlayfs2</p>
</blockquote>
<h1 id="require"><a href="#require" class="headerlink" title="require"></a>require</h1><ul>
<li>kernel 4.0+</li>
</ul>
<p>overlayfs çš„ä½¿ç”¨éœ€è¦ä¿è¯å†…æ ¸ç‰ˆæœ¬ä¸ä½äº3.8, ä½†æ˜¯å¦‚æœä½¿ç”¨ overlayfs2 åˆ™éœ€è¦ä¿è¯å†…æ ¸ç‰ˆæœ¬ä¸ä½äº 4.0 </p>
<p><strong>overlayfs2 ç›¸æ¯”è¾ƒäº overlayfs æœ‰å¤§é‡çš„æ€§èƒ½ä¼˜åŒ–å’Œæ–°çš„ç‰¹æ€§, å»ºè®®ä½¿ç”¨ overlayfs2</strong></p>
<ul>
<li>Ubuntu 16.04 LTS ä¸­çš„å†…æ ¸ç‰ˆæœ¬ä¸º 4.4+</li>
<li>Fedora 25 server ä¸­çš„å†…æ ¸ç‰ˆæœ¬ä¸º 4.8+</li>
<li>CentOS 7+ ä¸­çš„å†…æ ¸ç‰ˆæœ¬ä¸º 3.10+ å¯ä»¥ä½¿ç”¨ yum å®‰è£…é•¿æœŸæ”¯æŒç‰ˆçš„å†…æ ¸ 4.4+ (äº²æµ‹å¯ç”¨, ä½†æ˜¯çº¿ä¸Šç¯å¢ƒæ…ç”¨)</li>
</ul>
<h1 id="æŒ‡å®šå­˜å‚¨å¼•æ“"><a href="#æŒ‡å®šå­˜å‚¨å¼•æ“" class="headerlink" title="æŒ‡å®šå­˜å‚¨å¼•æ“"></a>æŒ‡å®šå­˜å‚¨å¼•æ“</h1><p>Ubuntu å®‰è£…å¥½ docker å, docker é»˜è®¤è¿˜æ˜¯ä½¿ç”¨äº† aufs å­˜å‚¨å¼•æ“.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; vim /etc/docker/daemon.js</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"storage-driver"</span>: <span class="string">"overlay2"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨ docker çš„ js é…ç½®æ–‡ä»¶ä¸­, æ·»åŠ ä»¥ä¸Šä¸€è¡Œé…ç½®å³å¯, å¦‚æœå·²ç»æœ‰å…¶ä»–é…ç½®é€‰é¡¹, è®°å¾—æ·»åŠ é€—å·<del>~</del></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"registry-mirrors"</span>: [</span><br><span class="line">        <span class="string">"http://172d594a.m.daocloud.io"</span></span><br><span class="line">    ],     <span class="comment"># &lt;--- ä¸€å®šè¦æ³¨æ„è¿™ä¸ªé€—å·, json çš„æ ¼å¼ä¸ç”¨å†å¤šè¯´äº†å§...</span></span><br><span class="line">    <span class="string">"storage-driver"</span>: <span class="string">"overlay2"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>overlayfs</tag>
        <tag>overlayfs2</tag>
      </tags>
  </entry>
  <entry>
    <title>docker socketè®¾ç½®</title>
    <url>/2017/02/19/docker-socket%E8%AE%BE%E7%BD%AE/</url>
    <content><![CDATA[<blockquote>
<p>åœ¨ docker çš„å®˜æ–¹æ–‡æ¡£ä¸­, ä»‹ç»äº†ä¸‰ç§è®¿é—® docker Remote API çš„æ–¹å¼, åˆ†åˆ«æ˜¯ unix å¥—æ¥å­—æ–‡ä»¶/ tcp ç›‘å¬ç«¯å£å’Œ fd æ–‡ä»¶æè¿°ç¬¦. ç”±äº docker é»˜è®¤ä¼šä¸ºæˆ‘ä»¬å¼€å¯æœ¬åœ° socket å¥—æ¥å­—(/var/run/docker.sock) æ‰€ä»¥æœ¬ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»å¦‚ä½•è®© docker ç›‘å¬ tcpç«¯å£</p>
</blockquote>
<h1 id="åœ¨-docker-é…ç½®æ–‡ä»¶ä¸­è®¾ç½®"><a href="#åœ¨-docker-é…ç½®æ–‡ä»¶ä¸­è®¾ç½®" class="headerlink" title="åœ¨ docker é…ç½®æ–‡ä»¶ä¸­è®¾ç½®"></a>åœ¨ docker é…ç½®æ–‡ä»¶ä¸­è®¾ç½®</h1><p>docker 1.12 ç‰ˆæœ¬ä¹‹å, å»ºè®®åœ¨ docker çš„ js é…ç½®æ–‡ä»¶ä¸­é…ç½®, è·¯å¾„ä¸º <code>/etc/docker/daemon.js</code> é»˜è®¤æ²¡æœ‰è¿™ä¸ªæ–‡ä»¶, å¯ä»¥æ‰‹åŠ¨åˆ›å»ºæ­¤æ–‡ä»¶, docker å¯åŠ¨æ—¶é»˜è®¤ä¼šè¯»å–æ­¤é…ç½®æ–‡ä»¶</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; vim /etc/docker/daemon.js</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"hosts"</span>: [</span><br><span class="line">        <span class="string">"tcp://0.0.0.0:2375"</span>,</span><br><span class="line">        <span class="string">"unix:///var/run/docker.sock"</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ä¸Šé¢ğŸ‘†ä¸€å®šè¦å†™ä¸Šæœ¬åœ°çš„ socket ä½ç½®, ä¸ç„¶æ— æ³•ä½¿ç”¨æœ¬åœ°çš„ CLI æ§åˆ¶ docker</p>
<p><code>unix:///var/run/docker.sock</code></p>
<p>ä¿®æ”¹å®Œjsé…ç½®æ–‡ä»¶å, é‡å¯ docker æœåŠ¡, å‡ºç°äº†å¦‚ä¸‹æŠ¥é”™</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; systemctl restart docker.service</span><br><span class="line">Job <span class="keyword">for</span> docker.service failed because the control process exited with error code. See <span class="string">"systemctl status docker.service"</span> and <span class="string">"journalctl -xe"</span> <span class="keyword">for</span> details.</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹æ—¥å¿—å‘ç°å…³é”®ä¿¡æ¯å¦‚ä¸‹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; systemctl status docker.service</span><br><span class="line">â— docker.service - Docker Application Container Engine</span><br><span class="line">   Loaded: loaded (/lib/systemd/system/docker.service; enabled; vendor preset: enabled)</span><br><span class="line">   Active: failed (Result: <span class="built_in">exit</span>-code) since Mon 2017-02-06 12:16:57 CST; 13s ago</span><br><span class="line">     Docs: https://docs.docker.com</span><br><span class="line">  Process: 21952 ExecStart=/usr/bin/dockerd -H fd:// (code=exited, status=1/FAILURE)</span><br><span class="line"> Main PID: 21952 (code=exited, status=1/FAILURE)</span><br><span class="line"></span><br><span class="line">Feb 06 12:16:57 xsl systemd[1]: Starting Docker Application Container Engine...</span><br><span class="line">Feb 06 12:16:57 xsl dockerd[21952]: unable to configure the Docker daemon with file /etc/docker/daemon.json: the following directives are specified both as a flag and <span class="keyword">in</span> the configuration file: hosts: (from flag: [fd://], from file: [tcp://0.0.0.0:2375, unix:///var/run/docker.socket])</span><br><span class="line">Feb 06 12:16:57 xsl systemd[1]: docker.service: Main process exited, code=exited, status=1/FAILURE</span><br><span class="line">Feb 06 12:16:57 xsl systemd[1]: Failed to start Docker Application Container Engine.</span><br><span class="line">Feb 06 12:16:57 xsl systemd[1]: docker.service: Unit entered failed state.</span><br><span class="line">Feb 06 12:16:57 xsl systemd[1]: docker.service: Failed with result <span class="string">'exit-code'</span>.</span><br></pre></td></tr></table></figure>

<p>ä»ä¸Šé¢ğŸ‘†çš„æŠ¥é”™ä¿¡æ¯ä¸­å¯ä»¥åˆ¤æ–­å‡º, æ˜¯å› ä¸º docker çš„ socket é…ç½®å‡ºç°äº†å†²çª, æ¥ä¸‹æ¥æŸ¥çœ‹ docker çš„å¯åŠ¨å…¥å£æ–‡ä»¶</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; vim /lib/systemd/system/docker.service <span class="comment"># Ubuntuçš„è·¯å¾„; CentOS çš„è·¯å¾„ä¸º: /usr/lib/systemd/system/docker.service</span></span><br><span class="line"><span class="comment"># ...çœç•¥</span></span><br><span class="line"><span class="comment"># å…³é”®è¡Œ</span></span><br><span class="line">ExecStart=/usr/bin/dockerd -H fd://</span><br><span class="line"><span class="comment"># ...çœç•¥</span></span><br></pre></td></tr></table></figure>

<p>ä»ä¸Šé¢å¯ä»¥çœ‹å‡º, åœ¨ docker çš„å¯åŠ¨å…¥å£æ–‡ä»¶ä¸­é…ç½®äº† host ç›¸å…³çš„ä¿¡æ¯, è€Œåœ¨ docker çš„é…ç½®æ–‡ä»¶ä¸­ä¹Ÿé…ç½®äº† host çš„ä¿¡æ¯, æ‰€ä»¥å‘ç”Ÿäº†å†²çª. è§£å†³åŠæ³•, å»ºè®®å°† docker å¯åŠ¨å…¥å£æ–‡ä»¶ä¸­çš„ <code>-H fd://</code> åˆ é™¤, å†é‡å¯ docker æœåŠ¡å³å¯</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ExecStart=/usr/bin/dockerd -H fd://</span></span><br><span class="line">ExecStart=/usr/bin/dockerd</span><br></pre></td></tr></table></figure>

<h1 id="åœ¨-docker-å¯åŠ¨å…¥å£ä¸­è®¾ç½®"><a href="#åœ¨-docker-å¯åŠ¨å…¥å£ä¸­è®¾ç½®" class="headerlink" title="åœ¨ docker å¯åŠ¨å…¥å£ä¸­è®¾ç½®"></a>åœ¨ docker å¯åŠ¨å…¥å£ä¸­è®¾ç½®</h1><p>å½“ç„¶ä½ ä¹Ÿå¯ä»¥åœ¨å¯åŠ¨å…¥å£é…ç½®ç›‘å¬çš„ç«¯å£å’Œæœ¬åœ° socket ä¿¡æ¯</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; vim /lib/systemd/system/docker.service <span class="comment"># Ubuntuçš„è·¯å¾„; CentOS çš„è·¯å¾„ä¸º: /usr/lib/systemd/system/docker.service</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ExecStart=/usr/bin/dockerd -H fd://</span></span><br><span class="line">ExecStart=/usr/bin/dockerd -H tcp://0.0.0.0:2375 -H unix:///var/run/docker.sock</span><br><span class="line"><span class="comment"># ExecStart=/usr/bin/dockerd -H tcp://0.0.0.0:2375</span></span><br></pre></td></tr></table></figure>

<p>æœ€ä¸‹é¢ä¸¤æ¡é…ç½®æ˜¯ç­‰ä»·çš„, docker é»˜è®¤çš„æœ¬åœ° socket æ–‡ä»¶å°±åœ¨ <code>/var/run/docker.sock</code> è¿™ä¸ªä½ç½®, å¦‚æœæ²¡æœ‰ç‰¹æ®Šéœ€æ±‚, ä¸éœ€è¦æ˜¾ç¤ºçš„è¿›è¡Œé…ç½®</p>
]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>socket</tag>
      </tags>
  </entry>
  <entry>
    <title>dockerçš„å¯åŠ¨æ–‡ä»¶å’Œé…ç½®æ–‡ä»¶</title>
    <url>/2017/02/19/docker%E7%9A%84%E5%90%AF%E5%8A%A8%E6%96%87%E4%BB%B6%E5%92%8C%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/</url>
    <content><![CDATA[<blockquote>
<p>æ¥è§¦ docker æ—¶é—´ä¹Ÿä¸çŸ­äº†, ä½†æ˜¯ docker çš„é…ç½®æ–‡ä»¶ä¸€ç›´æ˜¯ä¸ªâ€ç¥ç§˜â€çš„ä¸œè¥¿, æˆ‘åœ¨CentOS/Ubuntu/Fedora å¹³å°ä¸Šéƒ½ä½¿ç”¨è¿‡ docker, è€Œä¸” docker çš„ç‰ˆæœ¬ä»1.9åˆ°æœ€æ–°çš„1.13éƒ½ç”¨è¿‡, å¯ä»¥è¯´ docker çš„é…ç½®æ–‡ä»¶çœŸçš„æ˜¯ â€œä¹±èŠ±æ¸æ¬²è¿·äººçœ¼â€, å†™åœ¨å“ªå„¿çš„éƒ½æœ‰. è€Œä¸” docker çš„å¯åŠ¨æ–¹å¼ä¸åŒè¯»å–çš„é…ç½®æ–‡ä»¶ä½ç½®ä¹Ÿä¸åŒ, æœ‰çš„æ—¶å€™æ”¹äº†åŠå¤©é…ç½®æ–‡ä»¶å‘ç°ä¸ç”Ÿæ•ˆâ€¦ ä»Šå¤©æˆ‘ä»¬å°±æ¥æ‰¾æ‰¾ docker çš„é…ç½®æ–‡ä»¶!</p>
</blockquote>
<h1 id="1-12ç‰ˆæœ¬åçš„ä¸‡èƒ½é…ç½®æ–‡ä»¶"><a href="#1-12ç‰ˆæœ¬åçš„ä¸‡èƒ½é…ç½®æ–‡ä»¶" class="headerlink" title="1.12ç‰ˆæœ¬åçš„ä¸‡èƒ½é…ç½®æ–‡ä»¶"></a>1.12ç‰ˆæœ¬åçš„ä¸‡èƒ½é…ç½®æ–‡ä»¶</h1><p>1.12ç‰ˆæœ¬å, ç”¨æˆ·å¯ä»¥è‡ªè¡Œåˆ›å»º <code>/etc/docker/daemon.js</code> è¯¥æ–‡ä»¶, è¯¥æ–‡ä»¶æ˜¯ docker è¿›ç¨‹çš„é…ç½®ç®¡ç†æ–‡ä»¶, é‡Œé¢å‡ ä¹åŒ…å«äº†æ‰€æœ‰ docker å‘½ä»¤è¡Œå¯åŠ¨å¯ä»¥é…ç½®çš„å‚æ•°, ä¸ç®¡æ˜¯å“ªä¸ªå¹³å°, ä¸ç®¡æ˜¯ä»¥ä½•ç§æ–¹å¼å¯åŠ¨, é»˜è®¤éƒ½ä¼šæ¥è¿™é‡Œè¯»å–é…ç½®, æ‰€ä»¥å¦‚æœä½ ä¼šé…ç½®è¿™ä¸ªæ–‡ä»¶, å°±ä¸ä¼šå†è´¹åŠ›æ°”å»æ‰¾ docker çš„æ™®é€šé…ç½®æ–‡ä»¶æˆ–æ˜¯ docker çš„å¯åŠ¨å…¥å£äº†</p>
<p>è¿™ä¸ªæ–‡ä»¶åœ¨å‰é¢çš„æ–‡ç« é‡Œæœ‰ä»‹ç», å®˜æ–¹ä¹Ÿç»™å‡ºäº†ä½¿ç”¨æ¨¡æ¿, æœ‰éœ€è¦çš„è¯å¯ä»¥ç¿»çœ‹å‰é¢çš„æ–‡ç« æŸ¥çœ‹æˆ–æ˜¯åˆ° docker çš„å®˜æ–¹æ–‡æ¡£ä¸­æŸ¥çœ‹</p>
<h1 id="æŸ¥æ‰¾é…ç½®æ–‡ä»¶"><a href="#æŸ¥æ‰¾é…ç½®æ–‡ä»¶" class="headerlink" title="æŸ¥æ‰¾é…ç½®æ–‡ä»¶"></a>æŸ¥æ‰¾é…ç½®æ–‡ä»¶</h1><p>ä¸ç®¡æ˜¯ CentOS7+/Fedora24+ è¿˜æ˜¯ Ubuntu16+, ä»–ä»¬ç°åœ¨éƒ½ä½¿ç”¨ <code>systemctl</code> æ¥ç®¡ç†ç¨‹åº, æ‰€ä»¥åœ¨ä»¥ä¸Šå¹³å°ä¸Š, å¯åŠ¨ docker çš„æ—¶å€™éƒ½æ¨èä½¿ç”¨å¦‚ä¸‹å‘½ä»¤</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt; systemctl start docker.service</span><br></pre></td></tr></table></figure>

<p>å³ä½¿åœ¨ Ubuntu ä¸‹ä½¿ç”¨<code>/etc/init.d/docker start</code>çš„æ–¹å¼å¯åŠ¨, å›æ˜¾ä¹Ÿä¼šå‘Šè¯‰ä½ ä»–è¿˜æ˜¯ä½¿ç”¨äº† systemd å»ç®¡ç†çš„. service ä¹Ÿæ˜¯ä¸€æ ·, service æ‰¾çš„å°±æ˜¯<code>/etc/init.d/docker</code> æ‰€ä»¥ä½¿ç”¨ service å¯åŠ¨å…¶æœ¬è´¨ä¹Ÿè¿˜æ˜¯ä½¿ç”¨äº† systemctl çš„æ–¹å¼å¯åŠ¨çš„(Ubuntu16.04LTS)</p>
<p>dockerå¯åŠ¨æˆåŠŸå(å½“ç„¶å¯åŠ¨å¤±è´¥ä¹Ÿè¡Œ) æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹ docker çš„å¯åŠ¨çŠ¶æ€(æ—¥å¿—)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt; systemctl status docker.service</span><br><span class="line">â— docker.service - Docker Application Container Engine</span><br><span class="line">   Loaded: loaded (&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;docker.service; enabled; vendor preset: enabled)</span><br><span class="line">   Active: active (running) since Mon 2017-02-06 12:43:32 CST; 1s ago</span><br><span class="line">     Docs: https:&#x2F;&#x2F;docs.docker.com</span><br><span class="line"> Main PID: 22100 (dockerd)</span><br><span class="line">    Tasks: 18</span><br><span class="line">   Memory: 12.5M</span><br><span class="line">      CPU: 434ms</span><br><span class="line">   CGroup: &#x2F;system.slice&#x2F;docker.service</span><br><span class="line">           â”œâ”€22100 &#x2F;usr&#x2F;bin&#x2F;dockerd -H fd:&#x2F;&#x2F;</span><br><span class="line">           â””â”€22109 docker-containerd -l unix:&#x2F;&#x2F;&#x2F;var&#x2F;run&#x2F;docker&#x2F;libcontainerd&#x2F;docker-containerd.sock --metrics-interval&#x3D;0 --start-timeout 2m --state-dir &#x2F;var&#x2F;run&#x2F;docker&#x2F;libcontainerd&#x2F;containerd --shim docker-containerd-shim --runtime docker-runc</span><br><span class="line"></span><br><span class="line">Feb 06 12:43:31 xsl dockerd[22100]: time&#x3D;&quot;2017-02-06T12:43:31.890635900+08:00&quot; level&#x3D;warning msg&#x3D;&quot;Your kernel does not support cgroup rt period&quot;</span><br><span class="line">Feb 06 12:43:31 xsl dockerd[22100]: time&#x3D;&quot;2017-02-06T12:43:31.891099470+08:00&quot; level&#x3D;warning msg&#x3D;&quot;Your kernel does not support cgroup rt runtime&quot;</span><br><span class="line">Feb 06 12:43:31 xsl dockerd[22100]: time&#x3D;&quot;2017-02-06T12:43:31.892444087+08:00&quot; level&#x3D;info msg&#x3D;&quot;Loading containers: start.&quot;</span><br><span class="line">Feb 06 12:43:31 xsl dockerd[22100]: time&#x3D;&quot;2017-02-06T12:43:31.903230791+08:00&quot; level&#x3D;info msg&#x3D;&quot;Firewalld running: false&quot;</span><br><span class="line">Feb 06 12:43:32 xsl dockerd[22100]: time&#x3D;&quot;2017-02-06T12:43:32.205131505+08:00&quot; level&#x3D;info msg&#x3D;&quot;Default bridge (docker0) is assigned with an IP address 172.17.0.0&#x2F;16. Daemon option --bip can be used to set a preferred IP address&quot;</span><br><span class="line">Feb 06 12:43:32 xsl dockerd[22100]: time&#x3D;&quot;2017-02-06T12:43:32.346345114+08:00&quot; level&#x3D;info msg&#x3D;&quot;Loading containers: done.&quot;</span><br><span class="line">Feb 06 12:43:32 xsl dockerd[22100]: time&#x3D;&quot;2017-02-06T12:43:32.397174805+08:00&quot; level&#x3D;info msg&#x3D;&quot;Daemon has completed initialization&quot;</span><br><span class="line">Feb 06 12:43:32 xsl dockerd[22100]: time&#x3D;&quot;2017-02-06T12:43:32.397651049+08:00&quot; level&#x3D;info msg&#x3D;&quot;Docker daemon&quot; commit&#x3D;49bf474 graphdriver&#x3D;aufs version&#x3D;1.13.0</span><br><span class="line">Feb 06 12:43:32 xsl dockerd[22100]: time&#x3D;&quot;2017-02-06T12:43:32.419960532+08:00&quot; level&#x3D;info msg&#x3D;&quot;API listen on &#x2F;var&#x2F;run&#x2F;docker.sock&quot;</span><br><span class="line">Feb 06 12:43:32 xsl systemd[1]: Started Docker Application Container Engine.</span><br></pre></td></tr></table></figure>

<p>åœ¨å›æ˜¾çš„ç¬¬äºŒè¡Œå°±å¯ä»¥çœ‹åˆ°<code>Loaded</code>å­—æ ·, è¿™è¡Œå°±æç¤ºäº† docker å¯åŠ¨çš„å…¥å£æ–‡ä»¶, å¦‚æœæœ‰éœ€è¦æ·»åŠ çš„å¯åŠ¨é…ç½®, æ¥è¿™é‡Œæ‰¾å°±å¯¹äº†!</p>
<p>ä»¥ä¸ŠæŸ¥å‡ºæ¥çš„ docker æ–‡ä»¶æ˜¯ docker çš„å…¥å£æ–‡ä»¶, ä½ å¯ä»¥åœ¨å…¥å£æ–‡ä»¶çš„ docker å¯åŠ¨æ–¹å¼ä¸­, æ·»åŠ ä¸€äº›å‚æ•°, ä¹Ÿå¯ä»¥åƒä¸Šé¢å†™çš„, æŠŠé…ç½®å†™è¿›â€ä¸‡èƒ½é…ç½®æ–‡ä»¶ä¸­(js æ–‡ä»¶)â€</p>
<h1 id="å…¶ä»–é…ç½®æ–‡ä»¶"><a href="#å…¶ä»–é…ç½®æ–‡ä»¶" class="headerlink" title="å…¶ä»–é…ç½®æ–‡ä»¶"></a>å…¶ä»–é…ç½®æ–‡ä»¶</h1><p>è®©äººçœ¼èŠ±ç¼­ä¹±çš„é…ç½®æ–‡ä»¶</p>
<h2 id="etc-default-docker"><a href="#etc-default-docker" class="headerlink" title="/etc/default/docker"></a>/etc/default/docker</h2><p>è¿™ä¸ªæ–‡ä»¶åœ¨å¼€å¤´çš„æ³¨é‡Šä¸­å°±å†™åˆ°äº†</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># Docker Upstart and SysVinit configuration file</span><br><span class="line"></span><br><span class="line">#</span><br><span class="line"># THIS FILE DOES NOT APPLY TO SYSTEMD</span><br><span class="line">#</span><br><span class="line">#   Please see the documentation for &quot;systemd drop-ins&quot;:</span><br><span class="line">#   https:&#x2F;&#x2F;docs.docker.com&#x2F;engine&#x2F;articles&#x2F;systemd&#x2F;</span><br><span class="line">#</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªé…ç½®æ–‡ä»¶åªæœ‰åœ¨ Linux ä½¿ç”¨<code>Sysvinit</code>å’Œ<code>Upstart</code>ä½œä¸ºåˆå§‹åŒ– init ç³»ç»Ÿçš„æ—¶å€™æ‰ä¼šç”Ÿæ•ˆ, æ‰ä¼šè¯»å–è¿™ä¸ªé…ç½®æ–‡ä»¶, ç´§æ¥ç€ä¸‹é¢ä¸€è¡Œåˆè¯´äº† <code>systemd</code>ç³»ç»Ÿå¹¶ä¸é€‚ç”¨</p>
<p>è€Œåœ¨ Ubuntu16.04 LTSä¸­, ç³»ç»Ÿé»˜è®¤ä½¿ç”¨çš„æ˜¯ systemd æ¥ç®¡ç†çš„, å³ä½¿ä½ ä½¿ç”¨ service, æœ€åè¿˜æ˜¯é‡å®šå‘åˆ°äº† systemctl. æ‰€ä»¥ä¸Šé¢è¿™ä¸ªé…ç½®æ–‡ä»¶åœ¨é»˜è®¤ä½¿ç”¨ systemd çš„ CentOS7+/Fedora24+/Ubuntu16+ ç³»ç»Ÿä¸­éƒ½æ˜¯æ²¡æœ‰ä»»ä½•åµç”¨çš„é…ç½®æ–‡ä»¶!!!</p>
<p>å¦‚æœä½ æƒ³æ·±å…¥äº†è§£ä¸‰å¤§ init ç³»ç»Ÿçš„å†å²ä»¥åŠå‘å±•ç°çŠ¶, å¯ä»¥ç‚¹å¼€ä»¥ä¸‹å‚è€ƒæ–‡æ¡£ä¸­çš„é“¾æ¥æŸ¥çœ‹</p>
<ul>
<li><a href="http://www.ibm.com/developerworks/cn/linux/1407_liuming_init1/index.html" target="_blank" rel="noopener">sysvinit</a></li>
<li><a href="http://www.ibm.com/developerworks/cn/linux/1407_liuming_init2/index.html" target="_blank" rel="noopener">UpStart</a></li>
<li><a href="http://www.ibm.com/developerworks/cn/linux/1407_liuming_init3/index.html" target="_blank" rel="noopener">Systemd</a></li>
</ul>
<p><strong>ä¸‹é¢æˆ‘ç®€å•åŒºåˆ†ä¸€ä¸‹è¿™ä¸‰å¤§åˆå§‹åŒ–ç³»ç»Ÿ</strong></p>
<ol>
<li><p>Sysvinit: CentOS6æ—¶ä»£, æˆ‘ä»¬æœ€ç†Ÿæ‚‰çš„ <code>service docker restart</code> å‘½ä»¤å°±å‡ºè‡ªè¿™ä¸ªç³»ç»Ÿç®¡ç†; åœ¨ Ubuntu ä¸­çš„ <code>/etc/init.d/docker restart</code> ä¹Ÿæ˜¯è¿™ä¸ªç³»ç»Ÿæ¥ç®¡ç†çš„</p>
</li>
<li><p>Upstart: è¿™ä¸ªåˆå§‹åŒ–ç³»ç»Ÿæ¯”è¾ƒå°‘è§, åœ¨ Ubuntu ä¸Šæ¯”è¾ƒå¤šè§, å¯åŠ¨è½¯ä»¶çš„æ–¹å¼ä¸º <code>restart docker</code> åœ¨ docker çš„å®˜æ–¹ç½‘ç«™ä¸­, ä»‹ç»åŸºäº Ubuntu14å’Œ15ç‰ˆæœ¬ docker å¯åŠ¨æ–¹å¼æ—¶, å°±æ˜¯ä½¿ç”¨çš„è¿™ä¸ªåˆå§‹åŒ–ç³»ç»Ÿ<a href="https://docs.docker.com/engine/admin/" target="_blank" rel="noopener">https://docs.docker.com/engine/admin/</a></p>
</li>
<li><p>Systemd: systemd æ˜¯ç›®å‰å¤§å¤šæ•° Linux å‘è¡Œç‰ˆé»˜è®¤çš„åˆå§‹åŒ–ç®¡ç†ç³»ç»Ÿ, CentOS7+ å’Œ Ubuntu16+ éƒ½æ˜¯ä½¿ç”¨ Systemd è¿›è¡Œç®¡ç†, è½¯ä»¶å¯åŠ¨æ–¹å¼ä¸º <code>systemctl restart docker.service</code></p>
</li>
</ol>
<h2 id="etc-init-d-docker"><a href="#etc-init-d-docker" class="headerlink" title="/etc/init.d/docker"></a>/etc/init.d/docker</h2><p>è¿™ä¸ªæ–‡ä»¶åªæœ‰åœ¨ç³»ç»Ÿä½¿ç”¨ sysvinit æ¥ç®¡ç†æ—¶æ‰ä¼šç”¨åˆ°, å› ä¸ºæˆ‘çš„ç³»ç»Ÿé»˜è®¤éƒ½ä½¿ç”¨äº† systemd è¿›è¡Œç®¡ç†, æ‰€ä»¥è¿™ä¸ªæ–‡ä»¶å¯¹æˆ‘æ¥è¯´ä¹Ÿæ²¡æœ‰ä»»ä½•åµç”¨, å³ä½¿æˆ‘ç”¨äº† sysvinit ç®¡ç†ç¨‹åºçš„è¯­æ³•, ä¹Ÿä¼šè¢«é‡å®šå‘åˆ° systemd å»ç®¡ç†ç¨‹åº. è¿™ä¸ª docker å…¥å£è¯»å–çš„æ˜¯ <code>/etc/default/docker</code> è¿™ä¸ªé…ç½®æ–‡ä»¶</p>
<h2 id="etc-init-docker-conf"><a href="#etc-init-docker-conf" class="headerlink" title="/etc/init/docker.conf"></a>/etc/init/docker.conf</h2><p>è¿™ä¸ªæ–‡ä»¶åªæœ‰åœ¨ç³»ç»Ÿä½¿ç”¨ Upstart æ¥ç®¡ç†æ—¶æ‰ä¼šç”¨åˆ°, æ— ç”¨çš„é“ç†åŒä¸Š. è¿™ä¸ª docker å…¥å£è¯»å–çš„ä¹Ÿæ˜¯ <code>/etc/default/docker</code> è¿™ä¸ªé…ç½®æ–‡ä»¶</p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>å…¥å£æ–‡ä»¶</p>
<ul>
<li>/etc/init/docker.conf == service docker start çš„å…¥å£æ–‡ä»¶==</li>
<li>/etc/init.d/docker == start docker çš„å…¥å£æ–‡ä»¶ ==</li>
<li>/usr/lib/systemd/system/docker == RHEL ç³»åˆ—ä¸­ systemctl start docker.service çš„å…¥å£æ–‡ä»¶ ==</li>
<li>/lib/systemd/system/docker == Ubuntu ç³»åˆ—ä¸­ systemctl start docker.service çš„å…¥å£æ–‡ä»¶ ==</li>
</ul>
<p>é…ç½®æ–‡ä»¶</p>
<ul>
<li>/etc/default/docker == service å’Œ start çš„é…ç½®æ–‡ä»¶==</li>
<li>/etc/docker/daemon.js ==1.12ç‰ˆæœ¬åä¸‡èƒ½é…ç½®æ–‡ä»¶==</li>
</ul>
<p><em>å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ docker 1.11(å«)ä¹‹å‰çš„ç‰ˆæœ¬, å¦‚æœèƒ½å‡çº§çš„è¯è¿˜æ˜¯å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬å§. å¦‚æœä¸èƒ½å‡çº§, è¿˜æ‰¾ä¸åˆ°é…ç½®æ–‡ä»¶, å¯ä»¥åœ¨å¯¹åº”çš„å…¥å£æ–‡ä»¶ä¸­ç›´æ¥åœ¨å¯åŠ¨å‘½ä»¤åé¢æ·»åŠ å‚æ•°</em></p>
<p>ä¸çŸ¥é“çš„æ—¶å€™å¯¹ docker è¿™ä¹ˆå¤šçš„å…¥å£å’Œé…ç½®æ–‡ä»¶æ„Ÿè§‰çœŸçš„å¾ˆçƒ¦, æ˜ç™½äº†ä»–ä»¬çš„å¯¹åº”å…³ç³»ä¹‹åæ‰æç„¶å¤§æ‚Ÿ, åŸæ¥ docker ä¸ä»…ä»…ä¸ºè·¨å¹³å°ä»˜å‡ºäº†å¤§é‡çš„ç²¾åŠ›, è¿åˆå§‹åŒ–ç³»ç»Ÿä¹Ÿå…¨éƒ¨éƒ½é€‚é…åˆ°äº†, è®©ä½ ä¸ç®¡ä½¿ç”¨ä»€ä¹ˆç³»ç»Ÿ, ç³»ç»Ÿä½¿ç”¨ä»€ä¹ˆåˆå§‹åŒ–å·¥å…·éƒ½èƒ½è¿ç”¨è‡ªå¦‚, è¿™é‡Œç»™ docker ç‚¹ğŸ‘ (è™½ç„¶ç”¨ä¸åˆ°è¿™ä¹ˆå¤šæ–‡ä»¶, è€Œä¸”ç»™æˆ‘å¸¦æ¥äº†å¾ˆé•¿æ—¶é—´çš„å›°æ‰°)</p>
<hr>
<p><strong>å‚è€ƒæ–‡æ¡£</strong></p>
<p>Linuxæ–‡ä»¶ç›®å½•/etc/initå’Œ/etc/init.dçš„å‰ä¸–ä»Šç”Ÿ: <a href="https://my.oschina.net/lvyi/blog/183123" target="_blank" rel="noopener">https://my.oschina.net/lvyi/blog/183123</a></p>
]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸ºdockeré…ç½®é•œåƒä¸‹è½½åŠ é€Ÿ</title>
    <url>/2017/02/19/%E4%B8%BAdocker%E9%85%8D%E7%BD%AE%E9%95%9C%E5%83%8F%E4%B8%8B%E8%BD%BD%E5%8A%A0%E9%80%9F/</url>
    <content><![CDATA[<blockquote>
<p>å‰é¢çš„æ–‡ç« ä»‹ç»äº† docker é»˜è®¤çš„é…ç½®æ–‡ä»¶, æœ¬ç¯‡æ–‡ç« ä»‹ç»å¦‚ä½•åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½® docker çš„é•œåƒä¸‹è½½åŠ é€Ÿ</p>
</blockquote>
<h1 id="daocloud-æ–¹æ¡ˆ"><a href="#daocloud-æ–¹æ¡ˆ" class="headerlink" title="daocloud æ–¹æ¡ˆ"></a>daocloud æ–¹æ¡ˆ</h1><p>daocloud ä¸ä»…ä»…ä¸ºæˆ‘ä»¬æä¾›äº†é•œåƒåŠ é€Ÿçš„åœ°å€, è€Œä¸”ä¸ºæˆ‘ä»¬æä¾›äº†ä¾¿æ·çš„é…ç½®æ–¹å¼</p>
<p><code>curl -sSL https://get.daocloud.io/daotools/set_mirror.sh | sh -s http://172d594a.m.daocloud.io</code></p>
<p>æ‰§è¡Œå¦‚ä¸Šå‘½ä»¤ä¹‹åé‡å¯ docker æœåŠ¡å³å¯è®©é•œåƒåŠ é€Ÿçš„é…ç½®ç”Ÿæ•ˆ, ä½ å¯ä»¥æŸ¥çœ‹ <code>/etc/docker/daemon.js</code> æ–‡ä»¶é‡Œçš„å†…å®¹(å¦‚æœè¿™ä¸ªæ–‡ä»¶ä¸å­˜åœ¨, daocloud çš„è„šæœ¬ä¼šè‡ªåŠ¨åˆ›å»º)</p>
<h1 id="æ‰‹åŠ¨é…ç½®"><a href="#æ‰‹åŠ¨é…ç½®" class="headerlink" title="æ‰‹åŠ¨é…ç½®"></a>æ‰‹åŠ¨é…ç½®</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; vim /etc/docker/daemon.js</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"registry-mirrors"</span>: [<span class="string">"http://172d594a.m.daocloud.io"</span>],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åŠ å…¥ä»¥ä¸Šé…ç½®, é‡å¯ docker æœåŠ¡å³å¯ç”Ÿæ•ˆ, ç”Ÿæ•ˆå, å¯ä»¥é€šè¿‡ <code>docker info</code> å‘½ä»¤æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯</p>
]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>é•œåƒåŠ é€Ÿ</tag>
      </tags>
  </entry>
  <entry>
    <title>dockeré…ç½®æ–‡ä»¶</title>
    <url>/2017/02/19/docker-%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/</url>
    <content><![CDATA[<blockquote>
<p>docker çš„ç‰ˆæœ¬æ›´æ–°æ¯”è¾ƒå¿«, è€Œä¸”ç°åœ¨å‡ ä¹æ”¯æŒäº†åŒ…æ‹¬ windows å’Œ mac åœ¨å†…çš„æ‰€æœ‰ç³»ç»Ÿå¹³å°(ä¸çŸ¥é“å•¥æ—¶å€™å¯ä»¥åœ¨æ‰‹æœºä¸Šè¿è¡Œ dockerğŸ³ ğŸ˜†) æˆ‘åœ¨åˆšæ¥è§¦ docker çš„æ—¶å€™ä½¿ç”¨çš„æ˜¯1.9ç‰ˆæœ¬, ç°åœ¨å·²ç»æ›´æ–°åˆ°äº†1.13.1ç‰ˆæœ¬, å˜åŒ–å¾ˆå¤§, ç›¸ä¿¡æœ‰å¥½å¤šå‹å‹éƒ½æ‰¾ä¸åˆ°docker çš„é…ç½®æ–‡ä»¶åœ¨å“ªé‡Œ, éœ€è¦æŒ‡å®šä¸€äº›åŠŸèƒ½æ—¶, ä¸€èˆ¬ä¼šå» docker çš„å¯åŠ¨æ–‡ä»¶é‡Œé…ç½®. æœ¬ç¯‡æ–‡ç« å°±ä»‹ç» docker çš„é»˜è®¤é…ç½®æ–‡ä»¶åœ¨å“ªé‡Œ, æ€ä¹ˆç”¨</p>
</blockquote>
<p>docker 1.12 ç‰ˆæœ¬ä¹‹å, Linux ä¸‹(Ubuntu/RHEL/CentOS/Fedora/â€¦)docker çš„é»˜è®¤é…ç½®æ–‡ä»¶å­˜æ”¾åœ¨ <code>/etc/docker/daemon.js</code> </p>
<p><strong>å¦‚æœä½ çš„ docker æ˜¯æ–°è£…çš„, é‚£ä¹ˆè¿™ä¸ªæ–‡ä»¶é»˜è®¤ä¸å­˜åœ¨, éœ€è¦è‡ªå·±åˆ›å»º</strong></p>
<p>æ ¹æ®å®˜æ–¹æ–‡æ¡£ä»‹ç», <code>daemon.js</code>çš„é…ç½®æ¨¡æ¿å¦‚ä¸‹</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"api-cors-header"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"authorization-plugins"</span>: [],</span><br><span class="line">    <span class="attr">"bip"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"bridge"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"cgroup-parent"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"cluster-store"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"cluster-store-opts"</span>: &#123;&#125;,</span><br><span class="line">    <span class="attr">"cluster-advertise"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"debug"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"default-gateway"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"default-gateway-v6"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"default-runtime"</span>: <span class="string">"runc"</span>,</span><br><span class="line">    <span class="attr">"default-ulimits"</span>: &#123;&#125;,</span><br><span class="line">    <span class="attr">"disable-legacy-registry"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"dns"</span>: [],</span><br><span class="line">    <span class="attr">"dns-opts"</span>: [],</span><br><span class="line">    <span class="attr">"dns-search"</span>: [],</span><br><span class="line">    <span class="attr">"exec-opts"</span>: [],</span><br><span class="line">    <span class="attr">"exec-root"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"fixed-cidr"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"fixed-cidr-v6"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"graph"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"group"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"hosts"</span>: [],</span><br><span class="line">    <span class="attr">"icc"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"insecure-registries"</span>: [],</span><br><span class="line">    <span class="attr">"ip"</span>: <span class="string">"0.0.0.0"</span>,</span><br><span class="line">    <span class="attr">"iptables"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"ipv6"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"ip-forward"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"ip-masq"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"labels"</span>: [],</span><br><span class="line">    <span class="attr">"live-restore"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"log-driver"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"log-level"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"log-opts"</span>: &#123;&#125;,</span><br><span class="line">    <span class="attr">"max-concurrent-downloads"</span>: <span class="number">3</span>,</span><br><span class="line">    <span class="attr">"max-concurrent-uploads"</span>: <span class="number">5</span>,</span><br><span class="line">    <span class="attr">"mtu"</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">"oom-score-adjust"</span>: <span class="number">-500</span>,</span><br><span class="line">    <span class="attr">"pidfile"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"raw-logs"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"registry-mirrors"</span>: [],</span><br><span class="line">    <span class="attr">"runtimes"</span>: &#123;</span><br><span class="line">        <span class="attr">"runc"</span>: &#123;</span><br><span class="line">            <span class="attr">"path"</span>: <span class="string">"runc"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"custom"</span>: &#123;</span><br><span class="line">            <span class="attr">"path"</span>: <span class="string">"/usr/local/bin/my-runc-replacement"</span>,</span><br><span class="line">            <span class="attr">"runtimeArgs"</span>: [</span><br><span class="line">                <span class="string">"--debug"</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"selinux-enabled"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"storage-driver"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"storage-opts"</span>: [],</span><br><span class="line">    <span class="attr">"swarm-default-advertise-addr"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"tls"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"tlscacert"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"tlscert"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"tlskey"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"tlsverify"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"userland-proxy"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"userns-remap"</span>: <span class="string">""</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®˜æ–¹ç»™å‡ºçš„æ¨¡æ¿ä¸­, åŒ…å«äº†å¤§é‡çš„é…ç½®å‚æ•°, å…¶ä¸­å¤§å¤šæ•°å¦‚æœæ²¡æœ‰ç‰¹æ®Šéœ€æ±‚, æˆ‘ä»¬ä¸éœ€è¦ç‰¹æ®ŠæŒ‡å®š, ç¨åçš„æ–‡ç« ä¸­, æˆ‘ä¼šæ ¹æ®æ­¤æ¨¡æ¿æ–‡ä»¶, å®šåˆ¶è‡ªå·±å¯¹ docker çš„éœ€æ±‚</p>
<hr>
<p>å®˜æ–¹æ–‡æ¡£: <a href="https://docs.docker.com/engine/reference/commandline/dockerd/" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/commandline/dockerd/</a></p>
<p>å®˜æ–¹æ–‡æ¡£-å¯åŠ¨é¡¹åŠ è½½å‚æ•°v18.03: <a href="https://docs.docker.com/engine/reference/commandline/dockerd/" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/commandline/dockerd/</a><br>å®˜æ–¹æ–‡æ¡£-å¯åŠ¨é¡¹åŠ è½½å‚æ•°v17.03: <a href="https://docs.docker.com/v17.03/edge/engine/reference/commandline/dockerd/" target="_blank" rel="noopener">https://docs.docker.com/v17.03/edge/engine/reference/commandline/dockerd/</a></p>
]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>docker</tag>
        <tag>configfile</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux ç¨‹åºå‰å°åå°ä¹‹é—´çš„åˆ‡æ¢</title>
    <url>/2017/02/19/Linux-%E7%A8%8B%E5%BA%8F%E5%89%8D%E5%8F%B0%E5%90%8E%E5%8F%B0%E4%B9%8B%E9%97%B4%E7%9A%84%E5%88%87%E6%8D%A2/</url>
    <content><![CDATA[<blockquote>
<p>åœ¨ Linux ä¸­, æˆ‘ä»¬æ‰§è¡Œå‘½ä»¤çš„æ—¶å€™, æœ‰æ—¶ä¼šå¿˜è®°æ”¾åˆ°åå°æ‰§è¡Œ, è€Œé˜»å¡åœ¨ç»ˆç«¯å‰å°æ‰§è¡Œ, ä¸€èˆ¬æƒ…å†µä¸‹ä¼š control+c æ‰å†é‡æ–°æ‰§è¡Œ, åŠ å…¥æ”¾å…¥åˆ°åå°çš„å‘½ä»¤, æœ¬ç¯‡æ–‡ç« ä»‹ç»ä¸€ç§æ–¹æ³•, ä¸éœ€è¦ control+c æ‰å°±èƒ½ç›´æ¥æ”¾å…¥åˆ°åå°æ‰§è¡Œ, ä¸”æ”¯æŒå‰å°åå°çš„åˆ‡æ¢</p>
</blockquote>
<ul>
<li>åœ¨å‰å°å¯åŠ¨ç¨‹åº</li>
</ul>
<p>æˆ‘è¿™é‡Œæœ‰ä¸ª webtty çš„å°ç¨‹åº, ç°åœ¨æˆ‘åœ¨å‰å°æ‰§è¡Œå®ƒ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt; ttyd -p 8080 bash</span><br><span class="line">[2017&#x2F;01&#x2F;05 14:31:42:7759] INFO: ttyd 1.2.2 (libwebsockets 1.7.5)</span><br><span class="line">[2017&#x2F;01&#x2F;05 14:31:42:7759] INFO: tty configuration:</span><br><span class="line">[2017&#x2F;01&#x2F;05 14:31:42:7760] INFO:   start command: bash</span><br><span class="line">[2017&#x2F;01&#x2F;05 14:31:42:7760] INFO:   reconnect timeout: 10s</span><br><span class="line">[2017&#x2F;01&#x2F;05 14:31:42:7760] INFO:   close signal: SIGHUP (1)</span><br><span class="line">[2017&#x2F;01&#x2F;05 14:31:42:7799] INFO: listening on port 8080</span><br><span class="line">[2017&#x2F;01&#x2F;05 14:32:02:1003] INFO: HTTP &#x2F; - 10.1.100.239 (10.1.100.239)</span><br><span class="line">[2017&#x2F;01&#x2F;05 14:32:02:5699] INFO: HTTP &#x2F;auth_token.js - 10.1.100.239 (10.1.100.239)</span><br><span class="line">[2017&#x2F;01&#x2F;05 14:32:03:3588] INFO: WS   &#x2F;ws - 10.1.100.239 (10.1.100.239), clients: 1</span><br><span class="line">[2017&#x2F;01&#x2F;05 14:32:03:3600] INFO: started process, pid: 29018</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨è¿™ä¸ªç¨‹åºæŒ‚åœ¨äº†æˆ‘ç»ˆç«¯çš„å‰å°æ‰§è¡Œ, è¿è¡Œæ­£å¸¸</p>
<p><img src="http://20150509.oss-cn-qingdao.aliyuncs.com/QQ20170205-144740@2x.png" alt=""></p>
<ul>
<li>è¾“å…¥ control+z æš‚åœç¨‹åºçš„æ‰§è¡Œ</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; ttyd -p 8080 bash</span><br><span class="line">[2017/01/05 14:31:42:7759] INFO: ttyd 1.2.2 (libwebsockets 1.7.5)</span><br><span class="line">[2017/01/05 14:31:42:7759] INFO: tty configuration:</span><br><span class="line">[2017/01/05 14:31:42:7760] INFO:   start <span class="built_in">command</span>: bash</span><br><span class="line">[2017/01/05 14:31:42:7760] INFO:   reconnect timeout: 10s</span><br><span class="line">[2017/01/05 14:31:42:7760] INFO:   close signal: SIGHUP (1)</span><br><span class="line">[2017/01/05 14:31:42:7799] INFO: listening on port 8080</span><br><span class="line">[2017/01/05 14:32:02:1003] INFO: HTTP / - 10.1.100.239 (10.1.100.239)</span><br><span class="line">[2017/01/05 14:32:02:5699] INFO: HTTP /auth_token.js - 10.1.100.239 (10.1.100.239)</span><br><span class="line">[2017/01/05 14:32:03:3588] INFO: WS   /ws - 10.1.100.239 (10.1.100.239), clients: 1</span><br><span class="line">[2017/01/05 14:32:03:3600] INFO: started process, pid: 29018</span><br><span class="line">^Z</span><br><span class="line">[1]+  Stopped                 ttyd -p 8080 bash</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨å†æ¬¡è®¿é—® webtty å·²ç»æ²¡æœ‰å“åº”, ä½†æ˜¯æ²¡æœ‰æŠ¥é”™é€€å‡º, æ˜¾ç„¶ç¨‹åºæ˜¯è¢« â€œæš‚åœâ¸â€ äº†, è€Œä¸æ˜¯è¢«é€€å‡ºäº†, å†å¼€ä¸€ä¸ªç»ˆç«¯å¯ä»¥çœ‹è§, è¿›ç¨‹åœ¨, ç«¯å£ä¹Ÿåœ¨, è¿›ç¨‹çŠ¶æ€å¦‚ä¸‹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root     29016  0.0  0.1 142632  3504 pts&#x2F;0    Tl   14:31   0:00 ttyd -p 8080 bash</span><br></pre></td></tr></table></figure>

<p><img src="http://20150509.oss-cn-qingdao.aliyuncs.com/QQ20170205-144740@2x.png" alt=""></p>
<ul>
<li>ä½¿ç”¨ bg å‘½ä»¤å°†æš‚åœçš„ç¨‹åºæ”¾å…¥åˆ°åå°ç»§ç»­æ‰§è¡Œ</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; <span class="built_in">jobs</span> <span class="comment"># æŸ¥çœ‹åå°ä»»åŠ¡çŠ¶æ€</span></span><br><span class="line">[1]+  Stopped                 ttyd -p 8080 bash</span><br><span class="line">&gt; <span class="built_in">bg</span> %1 <span class="comment"># ä»ä¸Šé¢å¯ä»¥æŸ¥è¯¢åˆ°, æœ‰ä¸€ä¸ªä»»åŠ¡, ä»»åŠ¡ ID ä¸º 1,ç°åœ¨æ˜¯æš‚åœçš„çŠ¶æ€, ä½¿ç”¨ bg %ID çš„å‚æ•°å°†æ­¤ä»»åŠ¡æ”¾å…¥åˆ°åå°æ‰§è¡Œ</span></span><br><span class="line">[1]+ ttyd -p 8080 bash &amp;</span><br></pre></td></tr></table></figure>

<p>è¿™æ—¶, ç³»ç»Ÿä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬åœ¨å¯åŠ¨å‘½ä»¤çš„æœ€åé¢åŠ å…¥ä¸€ä¸ª <code>&amp;</code> åå°å‘½ä»¤å¯åŠ¨</p>
<p>æ­¤æ—¶ webtty çš„å·¥ä½œåˆæ¢å¤äº†æ­£å¸¸, è€Œä¸”ä¹‹å‰æš‚åœæ—¶åœ¨ webtty è¾“å…¥çš„å†…å®¹ä¹Ÿéƒ½æ˜¾ç¤ºäº†å‡ºæ¥, ç”±æ­¤å¯ä»¥çœ‹å‡º, control+z é˜»å¡äº†ç¨‹åºçš„å…¥å£</p>
<p><img src="http://20150509.oss-cn-qingdao.aliyuncs.com/QQ20170205-144725@2x.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># å†æ¬¡æŸ¥çœ‹åå°ä»»åŠ¡</span><br><span class="line">&gt; jobs</span><br><span class="line">[1]+  Running                 ttyd -p 8080 bash &amp;</span><br></pre></td></tr></table></figure>

<p>çŠ¶æ€æ˜¾ç¤ºå·²åœ¨è¿è¡Œ</p>
<ul>
<li>å°†å·²ç»åœ¨åå°è¿è¡Œçš„ç¨‹åºå†æ‹‰å›åˆ°å‰å°æ‰§è¡Œ</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt; jobs</span><br><span class="line">[1]+  Running                 ttyd -p 8080 bash &amp;</span><br><span class="line">&gt; fg %1 # ä½¿ç”¨ fg %ID çš„æ–¹å¼å¯ä»¥æŠŠåå°è¿è¡Œçš„ç¨‹åºæ‹‰å›åˆ°å‰å°æ‰§è¡Œ</span><br><span class="line">ttyd -p 8080 bash</span><br></pre></td></tr></table></figure>

<ul>
<li><p>å…³é—­ç¨‹åº</p>
</li>
<li><p>è¿è¡Œåœ¨å‰å°çš„ç¨‹åºéœ€è¦å…³é—­æ‰§è¡ŒæŒ‰ä¸‹ <code>control+c</code> ç»„åˆé”®å³å¯</p>
</li>
<li><p>è¿è¡Œåœ¨åå°çš„ç¨‹åºéœ€è¦å…³é—­æ‰§è¡Œ <code>kill %ID</code> å³å¯</p>
</li>
</ul>
<p><img src="http://20150509.oss-cn-qingdao.aliyuncs.com/QQ20170205-145217@2x.png" alt=""></p>
<p><strong>å‚è€ƒæ–‡ç« </strong></p>
<ul>
<li><a href="http://www.cnblogs.com/wangshuo/archive/2011/04/11/2012620.html" target="_blank" rel="noopener">http://www.cnblogs.com/wangshuo/archive/2011/04/11/2012620.html</a></li>
<li><a href="http://blog.csdn.net/zklth/article/details/8909350" target="_blank" rel="noopener">http://blog.csdn.net/zklth/article/details/8909350</a></li>
</ul>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>jobs</tag>
      </tags>
  </entry>
  <entry>
    <title>Tomcat æ—¶åŒºè®¾ç½®</title>
    <url>/2017/02/19/Tomcat-%E6%97%B6%E5%8C%BA%E8%AE%BE%E7%BD%AE/</url>
    <content><![CDATA[<blockquote>
<p>ä» tomcat å®˜ç½‘ä¸­ä¸‹è½½ä¸‹æ¥çš„è½¯ä»¶åŒ…, é»˜è®¤ä½¿ç”¨çš„æ˜¯æ ¼æ—å°¼æ²»æ ‡å‡†æ—¶é—´, ä¸ä¸­å›½çš„æ—¶é—´ç›¸å·®8ä¸ªå°æ—¶, æ­¤æ—¶æˆ‘ä»¬éœ€è¦ä¿®æ”¹ tomcat ä¸­çš„é…ç½®, è®©å…¶å˜ä¸ºä¸œå…«åŒºçš„æ—¶é—´</p>
</blockquote>
<p>æœ€è¿‘æ–°è£…çš„ tomcat å‘ç°ä¸åŒ—äº¬æ—¶é—´ç›¸å·®æ­£å¥½8å°æ—¶, æŸ¥çœ‹ç³»ç»Ÿæ—¶é—´æ²¡æœ‰é—®é¢˜, æ˜¯æ­£ç¡®çš„, é—®é¢˜å‡ºåœ¨ tomcat ä¸­, éœ€è¦å¯¹ tomcat åšå¦‚ä¸‹ä¿®æ”¹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; <span class="built_in">cd</span> apache-tomcat-8.0.39/bin</span><br><span class="line">&gt; vim catalina.sh</span><br><span class="line"><span class="comment"># åœ¨è¿™ä¸ªå¯åŠ¨è„šæœ¬ä¸­, æ‰¾åˆ°å¦‚ä¸‹è¡Œå¹¶æ›¿æ¢</span></span><br><span class="line"><span class="comment"># JAVA_OPTS="$JAVA_OPTS -Djava.protocol.handler.pkgs=org.apache.catalina.webresources"</span></span><br><span class="line"><span class="comment"># æ›¿æ¢ä¸º</span></span><br><span class="line">JAVA_OPTS=<span class="string">"<span class="variable">$JAVA_OPTS</span> -Djava.protocol.handler.pkgs=org.apache.catalina.webresources -Duser.timezone=GMT+08"</span></span><br></pre></td></tr></table></figure>

<p>æ‹·è´ä½ çš„ Java_OPTS åŸæœ‰çš„é…ç½®, æ³¨é‡Šå, åœ¨ä¸‹é¢ç²˜è´´, å¹¶åœ¨æœ«å°¾å¤„æ·»åŠ  <code>-Duser.timezone=GMT+08</code> ä¿å­˜é€€å‡º, é‡å¯ tomcat æœåŠ¡å™¨å³å¯</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>tomcat</tag>
      </tags>
  </entry>
  <entry>
    <title>è§£å†³dockerå®¹å™¨ä¸æ”¯æŒä¸­æ–‡çš„é—®é¢˜</title>
    <url>/2017/02/19/%E8%A7%A3%E5%86%B3docker%E5%AE%B9%E5%99%A8%E4%B8%8D%E6%94%AF%E6%8C%81%E4%B8%AD%E6%96%87%E7%9A%84%E9%97%AE%E9%A2%98/</url>
    <content><![CDATA[<blockquote>
<p>æˆ‘ä»¬ pull ä¸‹æ¥çš„å¤§å¤šé•œåƒæ—¶ä¸æ”¯æŒä¸­æ–‡çš„, ç½‘ä¸Šä¹Ÿæœ‰å¥½å¤šæ–‡ç« ä»‹ç»å¦‚ä½•è®© container æ”¯æŒä¸­æ–‡, æœ‰çš„å†™çš„æŒºå¤æ‚çš„, æŠŠè¿ç»´éƒ½çœ‹æ™•äº†, æœ‰çš„æŒ‰ç…§ä»–å†™çš„æ‰§è¡Œè¿‡åå‘ç°è¿˜æ˜¯ä¸èƒ½æ­£å¸¸æ˜¾ç¤ºä¸­æ–‡, æˆ–æ˜¯åˆå¼•å‘äº†å…¶ä»–é—®é¢˜â€¦ è¿™é‡Œç»™å¤§å®¶ä»‹ç»ä¸€ä¸ªç®€å•çš„æ–¹æ³•è®© docker å®¹å™¨æ”¯æŒä¸­æ–‡</p>
</blockquote>
<h1 id="å·²ç»å¯åŠ¨çš„å®¹å™¨"><a href="#å·²ç»å¯åŠ¨çš„å®¹å™¨" class="headerlink" title="å·²ç»å¯åŠ¨çš„å®¹å™¨"></a>å·²ç»å¯åŠ¨çš„å®¹å™¨</h1><p>ç”±äºå®¹å™¨æ˜¯æ ¹æ®é•œåƒè€Œæ¥, å·²ç»å¯åŠ¨çš„å®¹å™¨æˆ–å·²ç»å­˜åœ¨çš„é•œåƒä¸æ”¯æŒé…ç½®æ°¸ä¹…ç”Ÿæ•ˆ(å½“ç„¶ä½ ä¹Ÿå¯ä»¥åœ¨å®¹å™¨å†…é…ç½®ä¹‹å, å†å‡ºæ¥ä¿å­˜å®¹å™¨çš„çŠ¶æ€ä¸ºä¸€ä¸ªæ–°çš„é•œåƒ) æ‰€ä»¥ä¸‹é¢çš„é…ç½®æ“ä½œ, åªå¯¹å½“å‰å®¹å™¨çš„ç”Ÿå­˜å‘¨æœŸæœ‰æ•ˆ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; docker <span class="built_in">exec</span> -it containerID /bin/bash</span><br><span class="line">&gt;&gt; <span class="built_in">echo</span> <span class="string">'export LANG="en_US.UTF-8"'</span> &gt;&gt; /etc/profile</span><br><span class="line">&gt;&gt; <span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure>

<h1 id="é…ç½®é•œåƒæ”¯æŒä¸­æ–‡"><a href="#é…ç½®é•œåƒæ”¯æŒä¸­æ–‡" class="headerlink" title="é…ç½®é•œåƒæ”¯æŒä¸­æ–‡"></a>é…ç½®é•œåƒæ”¯æŒä¸­æ–‡</h1><p>åªéœ€è¦åœ¨ dockerfile ä¸­åŠ å…¥å¦‚ä¸‹ä¸€è¡Œé…ç½®å³å¯</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç¯å¢ƒå˜é‡</span></span><br><span class="line">ENV LANG=<span class="string">"en_US.UTF-8"</span></span><br></pre></td></tr></table></figure>

<p>æœ‰äººå¯èƒ½ä¼šé—®ä¸ºä»€ä¹ˆä¸æ˜¯ç”¨<code>zh_CN.UTF-8</code>è€Œæ˜¯ç”¨<code>en_US.UTF-8</code></p>
<p>è¿™ä¸ªé—®é¢˜å¾ˆæ£’ğŸ‘ æˆ‘ä¹Ÿä¸æ¸…æ¥š, ä½†æ˜¯æˆ‘æŸ¥é˜…äº†èµ„æ–™, æ•´ç†å¦‚ä¸‹:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">en_US.UTF-8ï¼šä½ è¯´è‹±è¯­ï¼Œä½ åœ¨ç¾å›½ï¼Œå­—ç¬¦é›†æ˜¯utf-8 </span><br><span class="line">zh_CN.UTF-8ï¼šä½ è¯´ä¸­æ–‡ï¼Œä½ åœ¨ä¸­å›½ï¼Œå­—ç¬¦é›†æ˜¯utf-8 </span><br><span class="line"></span><br><span class="line">å¦‚æœä½ çš„LANGç¯å¢ƒå˜é‡æ˜¯en_US.UTF-8ï¼Œé‚£ä¹ˆç³»ç»Ÿçš„èœå•ã€ç¨‹åºçš„å·¥å…·æ è¯­è¨€ã€è¾“å…¥æ³•é»˜è®¤è¯­è¨€å°±éƒ½æ˜¯è‹±æ–‡çš„</span><br><span class="line"></span><br><span class="line">å¦‚æœä½ çš„LANGç¯å¢ƒå˜é‡æ˜¯zh_CN.UTF-8ï¼Œé‚£ä¹ˆç³»ç»Ÿçš„èœå•ã€ç¨‹åºçš„å·¥å…·æ è¯­è¨€ã€è¾“å…¥æ³•é»˜è®¤è¯­è¨€å°±éƒ½æ˜¯ä¸­æ–‡çš„</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿ç»´çš„å®é™…åº”ç”¨ä¸­, ç³»ç»Ÿä¸€èˆ¬éƒ½æ˜¯ä½¿ç”¨è‹±æ–‡ç¯å¢ƒ, ä¸”æ”¯æŒä¸­æ–‡å­—ç¬¦çš„, å› ä¸ºåœ¨è‡ªåŠ¨åŒ–çš„è¿‡ç¨‹ä¸­, ç³»ç»Ÿçš„å›æ˜¾æ˜¯è‹±æ–‡ä¼šé¿å…å¾ˆå¤šä¸å¿…è¦çš„é—®é¢˜</p>
]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>ä¸­æ–‡</tag>
      </tags>
  </entry>
  <entry>
    <title>ä½¿ç”¨æ·˜å® npm é•œåƒæº</title>
    <url>/2017/02/19/%E4%BD%BF%E7%94%A8%E6%B7%98%E5%AE%9D-npm-%E9%95%9C%E5%83%8F%E6%BA%90/</url>
    <content><![CDATA[<p>é•œåƒä½¿ç”¨æ–¹æ³•ï¼ˆä¸‰ç§åŠæ³•ä»»æ„ä¸€ç§éƒ½èƒ½è§£å†³é—®é¢˜ï¼Œå»ºè®®ä½¿ç”¨ç¬¬ä¸‰ç§ï¼Œå°†é…ç½®å†™æ­»ï¼Œä¸‹æ¬¡ç”¨çš„æ—¶å€™é…ç½®è¿˜åœ¨ï¼‰:</p>
<ul>
<li>é€šè¿‡configå‘½ä»¤</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; npm config <span class="built_in">set</span> registry https://registry.npm.taobao.org </span><br><span class="line">&gt; npm info underscore <span class="comment">#å¦‚æœä¸Šé¢é…ç½®æ­£ç¡®è¿™ä¸ªå‘½ä»¤ä¼šæœ‰å­—ç¬¦ä¸²response</span></span><br></pre></td></tr></table></figure>

<ul>
<li>å‘½ä»¤è¡ŒæŒ‡å®š</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm --registry https://registry.npm.taobao.org info underscore</span><br></pre></td></tr></table></figure>

<ul>
<li>ç¼–è¾‘ ~/.npmrc åŠ å…¥ä¸‹é¢å†…å®¹</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">registry = https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure>

<p><strong>å‚è€ƒæ–‡ç« </strong></p>
<p><a href="http://www.cnblogs.com/trying/p/4064518.html" target="_blank" rel="noopener">http://www.cnblogs.com/trying/p/4064518.html</a></p>
<p><strong>å®˜ç½‘ç«™ç‚¹</strong></p>
<p><a href="https://npm.taobao.org" target="_blank" rel="noopener">https://npm.taobao.org</a></p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>npm</tag>
      </tags>
  </entry>
  <entry>
    <title>Failed to start LSB: Bring up/down networking</title>
    <url>/2017/02/19/Failed-to-start-LSB-Bring-up-down-networking/</url>
    <content><![CDATA[<blockquote>
<p>åœ¨æ‰§è¡Œ<code>systemctl restart network</code>çš„æ—¶å€™,å‡ºç°äº†<code>Failed to start LSB: Bring up/down networking</code>çš„æŠ¥é”™</p>
</blockquote>
<p>è§£å†³çš„åŠæ³•ï¼ˆç”±äºcentos7ä¸­æ²¡æœ‰70-persistent-net.rulesè¿™ä¸ªæ–‡ä»¶ï¼Œå¤åˆ¶å‡ºæ¥çš„è™šæ‹Ÿæœº(vmwareï¼‰éœ€è¦ä¿®æ”¹macåœ°å€ï¼‰ï¼Œå°±æ˜¯ä¿®æ”¹macåœ°å€</p>
<p>æŸ¥çœ‹ç½‘å¡é…ç½®æ–‡ä»¶ä¸­æ˜¯å¦å­˜åœ¨ mac åœ°å€çš„é…ç½®, å¦‚æœæœ‰, ç›´æ¥åˆ é™¤å†é‡å¯ç½‘å¡å³å¯</p>
<p><em>ä»¥ä¸Šé—®é¢˜åœ¨è™šæ‹Ÿæœºä¸­å‡ºç°çš„æ¯”è¾ƒå¤š, å¤§å¤šæ˜¯å› ä¸º mac åœ°å€é…ç½®çš„é—®é¢˜, åœ¨ centos6 ç³»åˆ—ä¸­, å¯ä»¥ç›´æ¥åˆ é™¤<code>70-persistent-net.rules</code>è¿™ä¸ªæ–‡ä»¶, é‡å¯æœåŠ¡å™¨å³å¯(å…·ä½“ä½ç½®å¯ä»¥é€šè¿‡ find /etc/ -name â€œ70-persistent-net.rulesâ€ çš„æ–¹å¼æ¥æŸ¥æ‰¾)</em></p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>network</tag>
      </tags>
  </entry>
  <entry>
    <title>åˆ›å»ºMySQLç”¨æˆ·å¹¶æˆæƒ</title>
    <url>/2017/02/19/%E5%88%9B%E5%BB%BAMySQL%E7%94%A8%E6%88%B7%E5%B9%B6%E6%8E%88%E6%9D%83-1/</url>
    <content><![CDATA[<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">[root@MasterDatabase ~]<span class="comment"># mysql</span></span><br><span class="line">Welcome to the MySQL monitor.  Commands <span class="keyword">end</span> <span class="keyword">with</span> ; or \g.</span><br><span class="line">Your MySQL connection id is 161391</span><br><span class="line">Server version: 5.1.73-log Source distribution</span><br><span class="line"> </span><br><span class="line">Copyright (c) 2000, 2013, Oracle and/or its affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type '<span class="keyword">help</span>;' or '\h' for help. <span class="keyword">Type</span> <span class="string">'\c'</span> <span class="keyword">to</span> <span class="keyword">clear</span> the <span class="keyword">current</span> <span class="keyword">input</span> statement.</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">show</span> <span class="keyword">databases</span>;</span><br><span class="line">+<span class="comment">--------------------+</span></span><br><span class="line">| Database           |</span><br><span class="line">+<span class="comment">--------------------+</span></span><br><span class="line">| information_schema |</span><br><span class="line">| mysql              |</span><br><span class="line">| test               |</span><br><span class="line">| zabbix             |</span><br><span class="line">+<span class="comment">--------------------+</span></span><br><span class="line">4 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">create</span> <span class="keyword">user</span> <span class="string">'wordpress'</span>@<span class="string">'%'</span> <span class="keyword">identified</span> <span class="keyword">by</span> <span class="string">'wordpress'</span>;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; create database wordpress;</span><br><span class="line">Query OK, 1 row affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; grant all privileges on wordpress.* to 'wordpress'@'%';</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">åˆ›å»ºç”¨æˆ·ï¼š</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">'username'</span>@<span class="string">'host'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'password'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">'username'</span>@<span class="string">'192.168.5.9'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'password'</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">'username'</span>@<span class="string">'localhost'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'password'</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">'username'</span>@<span class="string">'%'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">''</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">'username'</span>@<span class="string">'%'</span>;</span><br><span class="line"></span><br><span class="line">æˆæƒï¼š</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">privileges</span> <span class="keyword">ON</span> databasename.tablename <span class="keyword">TO</span> <span class="string">'username'</span>@<span class="string">'host'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span>,<span class="keyword">INSERT</span> <span class="keyword">ON</span> DBname.tablename <span class="keyword">TO</span> <span class="string">'username'</span>@<span class="string">'%'</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">ALL</span> <span class="keyword">ON</span> DBname.tablename <span class="keyword">TO</span> <span class="string">'username'</span>@<span class="string">'%'</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">ALL</span> <span class="keyword">ON</span> DBname.* <span class="keyword">TO</span> <span class="string">'username'</span>@<span class="string">'%'</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">ALL</span> <span class="keyword">ON</span> *.* <span class="keyword">TO</span> <span class="string">'username'</span>@<span class="string">'%'</span>;</span><br><span class="line">æ³¨æ„ï¼šä½¿ç”¨ä»¥ä¸Šå‘½ä»¤æˆæƒçš„ç”¨æˆ·ä¸èƒ½ç”¨æ¥å†ç»™å…¶ä»–ç”¨æˆ·æˆæƒ</span><br><span class="line">å¦‚æœæƒ³è®©è¯¥ç”¨æˆ·å¯ä»¥ä¸ºå…¶ä»–ç”¨æˆ·æˆæƒï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">privileges</span> <span class="keyword">ON</span> databasename.tablename <span class="keyword">TO</span> <span class="string">'username'</span>@<span class="string">'host'</span> <span class="keyword">WITH</span> <span class="keyword">GRANT</span> <span class="keyword">OPTION</span>;</span><br><span class="line"></span><br><span class="line">è®¾ç½®/æ›´æ”¹ç”¨æˆ·å¯†ç </span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">PASSWORD</span> <span class="keyword">FOR</span> <span class="string">'username'</span>@<span class="string">'host'</span>=<span class="keyword">PASSWORD</span>(<span class="string">'newpassword'</span>);</span><br><span class="line">å¦‚æœæ˜¯ä¿®æ”¹å½“å‰ç™»å½•çš„ç”¨æˆ·çš„å¯†ç ï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š</span><br><span class="line"><span class="keyword">SET</span> PASSWDORD=<span class="keyword">PASSWORD</span>(<span class="string">'newpassword'</span>)</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>å¿˜è®°MySQLå¯†ç </title>
    <url>/2017/02/19/%E5%BF%98%E8%AE%B0MySQL%E5%AF%86%E7%A0%81-1/</url>
    <content><![CDATA[<h1 id="Step1-ä¿®æ”¹é…ç½®æ–‡ä»¶"><a href="#Step1-ä¿®æ”¹é…ç½®æ–‡ä»¶" class="headerlink" title="Step1 ä¿®æ”¹é…ç½®æ–‡ä»¶"></a>Step1 ä¿®æ”¹é…ç½®æ–‡ä»¶</h1><p>ä¿®æ”¹MySQLçš„é…ç½®æ–‡ä»¶ï¼ˆé»˜è®¤ä¸º/etc/my.cnfï¼‰,åœ¨[mysqld]ä¸‹æ·»åŠ ä¸€è¡Œskip-grant-tables</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@PolarSnow hexo]# cat &#x2F;etc&#x2F;my.cnf </span><br><span class="line">[mysqld]</span><br><span class="line">datadir&#x3D;&#x2F;var&#x2F;lib&#x2F;mysql</span><br><span class="line">socket&#x3D;&#x2F;var&#x2F;lib&#x2F;mysql&#x2F;mysql.sock</span><br><span class="line">user&#x3D;mysql</span><br><span class="line"># Disabling symbolic-links is recommended to prevent assorted security risks</span><br><span class="line">symbolic-links&#x3D;0</span><br><span class="line">character-set-server&#x3D;utf8</span><br><span class="line">innodb_file_per_table&#x3D;1</span><br><span class="line">skip-grant-tables</span><br></pre></td></tr></table></figure>

<h1 id="Step2-é‡å¯MySQLæœåŠ¡"><a href="#Step2-é‡å¯MySQLæœåŠ¡" class="headerlink" title="Step2 é‡å¯MySQLæœåŠ¡"></a>Step2 é‡å¯MySQLæœåŠ¡</h1><p><code>service mysqld restart</code></p>
<h1 id="Step3-å†æ¬¡è¿›å…¥MySQLå‘½ä»¤è¡Œ"><a href="#Step3-å†æ¬¡è¿›å…¥MySQLå‘½ä»¤è¡Œ" class="headerlink" title="Step3 å†æ¬¡è¿›å…¥MySQLå‘½ä»¤è¡Œ"></a>Step3 å†æ¬¡è¿›å…¥MySQLå‘½ä»¤è¡Œ</h1><p><code>mysql -uroot -p</code> è¾“å…¥å¯†ç æ—¶ç›´æ¥å›è½¦ï¼Œå°±ä¼šè¿›å…¥MySQLæ•°æ®åº“äº†</p>
<p>æ¥ä¸‹æ¥æŒ‰ç…§å¸¸è§„æµç¨‹ä¿®æ”¹rootå¯†ç å³å¯</p>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¼˜ç§€çš„web consoleä¹‹codetainerçš„æ­å»ºä¸ä½¿ç”¨</title>
    <url>/2016/12/28/codetainer%E6%90%AD%E5%BB%BA/</url>
    <content><![CDATA[<blockquote>
<p>ä¼˜ç§€çš„ web console PasS æœåŠ¡å•† codepicnic <a href="https://codepicnic.com" target="_blank" rel="noopener">https://codepicnic.com</a> æœ‰äº†å¼€æºçš„å…‹éš†ç‰ˆ. æœç´¢äº†ä¸€äº›codetaineræ­å»ºçš„ç›¸å…³æ–‡æ¡£, éƒ½å¼•ç”¨äº† github çš„å®˜æ–¹ä»‹ç», ä½†æ˜¯å®˜æ–¹è¯´æ˜æ¯”è¾ƒç®€å•, å®‰è£…è¿‡ç¨‹ä¸­çš„ä¸€äº›æŠ¥é”™ä¸¥é‡å½±å“äº†ç”¨æˆ·å¯¹codetainerçš„ä½“éªŒ, æœ¬ç¯‡æ–‡ç« ä»‹ç» codetainer çš„éƒ¨ç½²ä¸ä½¿ç”¨</p>
</blockquote>
<h1 id="ç¯å¢ƒä¾èµ–"><a href="#ç¯å¢ƒä¾èµ–" class="headerlink" title="ç¯å¢ƒä¾èµ–"></a>ç¯å¢ƒä¾èµ–</h1><h2 id="å®‰è£…-docker-ç¯å¢ƒ"><a href="#å®‰è£…-docker-ç¯å¢ƒ" class="headerlink" title="å®‰è£… docker ç¯å¢ƒ"></a>å®‰è£… docker ç¯å¢ƒ</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tee /etc/yum.repos.d/docker.repo &lt;&lt;-<span class="string">'EOF'</span></span><br><span class="line">[dockerrepo]</span><br><span class="line">name=Docker Repository</span><br><span class="line">baseurl=https://yum.dockerproject.org/repo/main/centos/7/</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=https://yum.dockerproject.org/gpg</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum install docker-engine</span><br><span class="line">systemctl <span class="built_in">enable</span> docker.service</span><br><span class="line">systemctl start docker</span><br><span class="line">systemctl status docker</span><br></pre></td></tr></table></figure>


<h2 id="å®‰è£…-golang-ç¯å¢ƒ"><a href="#å®‰è£…-golang-ç¯å¢ƒ" class="headerlink" title="å®‰è£… golang ç¯å¢ƒ"></a>å®‰è£… golang ç¯å¢ƒ</h2><p>æ ¹æ®è‡ªå·±çš„å¹³å°é€‰æ‹©å¯¹åº”çš„å®‰è£…åŒ…, è¿™é‡Œæˆ‘ä½¿ç”¨çš„ç¯å¢ƒä¸º CentOS7.2 æ‰€ä»¥é€‰æ‹©äº†å¦‚ä¸‹å®‰è£…åŒ…ä¸‹è½½</p>
<p><code>go1.7.4.linux-amd64.tar.gz    Archive    Linux    64-bit    80MB    47fda42e46b4c3ec93fa5d4d4cc6a748aa3f9411a2a2b7e08e3a6d80d753ec8b</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/src</span><br><span class="line">wget https://storage.googleapis.com/golang/go1.7.4.linux-amd64.tar.gz</span><br><span class="line">tar -xvzf go1.7.4.linux-amd64.tar.gz</span><br><span class="line">mv go /usr/<span class="built_in">local</span>/</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"export GOROOT=/usr/local/go"</span> &gt;&gt; /etc/profile</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"export PATH=<span class="variable">$PATH</span>:<span class="variable">$GOROOT</span>/bin"</span> &gt;&gt; /etc/profile</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"export GOPATH=<span class="variable">$HOME</span>/work"</span> &gt;&gt; /etc/profile</span><br><span class="line">mkdir <span class="variable">$HOME</span>/work</span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure>

<h2 id="å®‰è£…-go-bindata"><a href="#å®‰è£…-go-bindata" class="headerlink" title="å®‰è£… go-bindata"></a>å®‰è£… go-bindata</h2><p><code>go get -u github.com/jteeuwen/go-bindata/...</code></p>
<p>å®‰è£…äº† <code>go-bindata</code> åå¦‚æœè¿˜æ˜¯æŠ¥: <code>go-bindata command not found</code> çš„è¯, å°±è¿›è¡Œå¦‚ä¸‹æ“ä½œ</p>
<p><code>ln -s $GOPATH/bin/go-bindata $GOROOT/bin</code></p>
<p>å¯ä»¥ç”¨ <code>cp</code> ä¹Ÿå¯ä»¥ç”¨ <code>ln</code>, å½“ç„¶ä¹Ÿå¯ä»¥æŠŠè¿™ä¸ªè·¯å¾„æ·»åŠ åˆ° <code>PATH</code>ä¸­, æ€»ä¹‹åªè¦ç¯å¢ƒå˜é‡ <code>PATH</code> èƒ½æ‰¾åˆ°å°±è¡Œ</p>
<h2 id="å®‰è£…-godep"><a href="#å®‰è£…-godep" class="headerlink" title="å®‰è£… godep"></a>å®‰è£… godep</h2><p><code>go get github.com/tools/godep</code></p>
<h1 id="å®‰è£…-codetainer"><a href="#å®‰è£…-codetainer" class="headerlink" title="å®‰è£… codetainer"></a>å®‰è£… codetainer</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">go get github.com/codetainerapp/codetainer</span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$GOPATH</span>/src/github.com/codetainerapp/codetainer</span><br><span class="line">make</span><br></pre></td></tr></table></figure>

<p>make æˆåŠŸåä¼šç”Ÿæˆè¿™ä¸ªæ–‡ä»¶ <code>$GOPATH/src/github.com/codetainerapp/codetainer/bin/codetainer</code></p>
<h2 id="docker-é…ç½®"><a href="#docker-é…ç½®" class="headerlink" title="docker é…ç½®"></a>docker é…ç½®</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vim /usr/lib/systemd/system/docker.service</span><br><span class="line"><span class="comment"># å°† ExecStart=/usr/bin/docker daemon -H fd:// è¿™è¡Œä¿®æ”¹ä¸ºä¸‹é¢è¿™è¡Œ</span></span><br><span class="line">ExecStart=/usr/bin/docker daemon -H fd:// -H tcp://127.0.0.1:4500 -H unix:///var/run/docker.sock</span><br><span class="line"><span class="comment"># ä¿®æ”¹å®Œæ¯•åä¿å­˜é€€å‡º</span></span><br></pre></td></tr></table></figure>

<h2 id="codetainer-é…ç½®"><a href="#codetainer-é…ç½®" class="headerlink" title="codetainer é…ç½®"></a>codetainer é…ç½®</h2><p>codetainer çš„é»˜è®¤é…ç½®æ–‡ä»¶åªæœ‰åœ¨ codetainerå‘½ä»¤ç¬¬ä¸€æ¬¡æ‰§è¡Œä¹‹åæ‰ä¼šè‡ªåŠ¨åˆ›å»º, è‡ªåŠ¨åˆ›å»ºçš„é…ç½®æ–‡ä»¶åœ¨ <code>$HOME/.codetainer/config.toml</code></p>
<p>é»˜è®¤åªæœ‰ä¸¤è¡Œ, å¦‚æœä¸Šé¢ä½ æ²¡æœ‰ä¿®æ”¹è¿‡ docker API ç›‘å¬çš„ç«¯å£, é‚£è¿™ä¸€æ­¥éª¤ä½ æ˜¯ä¸éœ€è¦å…³å¿ƒçš„</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">DockerServer &#x3D; &quot;localhost&quot;</span><br><span class="line">DockerPort &#x3D; 4500</span><br></pre></td></tr></table></figure>

<p>å®˜æ–¹ç»™å‡ºçš„é…ç½®è¯´æ˜å¦‚ä¸‹:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># Docker API server and port</span><br><span class="line">DockerServer &#x3D; &quot;localhost&quot;</span><br><span class="line">DockerPort &#x3D; 4500</span><br><span class="line"></span><br><span class="line"># Enable TLS support (optional, if you access to Docker API over HTTPS)</span><br><span class="line"># DockerServerUseHttps &#x3D; true</span><br><span class="line"># Certificate directory path (optional)</span><br><span class="line">#   e.g. if you use Docker Machine: &quot;~&#x2F;.docker&#x2F;machine&#x2F;certs&quot;</span><br><span class="line"># DockerCertPath &#x3D; &quot;&#x2F;path&#x2F;to&#x2F;certs&quot;</span><br><span class="line"></span><br><span class="line"># Database path (optional, default is ~&#x2F;.codetainer&#x2F;codetainer.db)</span><br><span class="line"># DatabasePath &#x3D; &quot;&#x2F;path&#x2F;to&#x2F;codetainer.db&quot;</span><br></pre></td></tr></table></figure>

<h2 id="å¯åŠ¨-codetainer"><a href="#å¯åŠ¨-codetainer" class="headerlink" title="å¯åŠ¨ codetainer"></a>å¯åŠ¨ codetainer</h2><p>ä»¥ä¸‹æ˜¯å®˜æ–¹æ¡ˆä¾‹, è¿™é‡Œæˆ‘ä¸åšä¿®æ”¹, åªè¯´æ˜ä¸€ä¸‹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> <span class="variable">$GOPATH</span>/src/github.com/codetainerapp/codetainer/bin/</span><br><span class="line">$ docker pull ubuntu:14.04  <span class="comment"># ä½ å¯ä»¥ä¸‹è½½ä»»æ„ä¸€ä¸ªä½ éœ€è¦çš„é•œåƒ</span></span><br><span class="line">$ ./codetainer image register ubuntu:14.04  <span class="comment"># æŠŠä½ éœ€è¦æ‰˜ç®¡åˆ°codetainerçš„é•œåƒæ³¨å†Œç»™codetainer</span></span><br><span class="line">$ ./codetainer create ubuntu:14.04 my-codetainer-name <span class="comment"># å¯åŠ¨ä½ æ‰˜ç®¡ç»™codetainerçš„é•œåƒ</span></span><br><span class="line">$ ./codetainer server  <span class="comment"># to start the API server on port 3000</span></span><br><span class="line"><span class="comment"># æœ€åä¸€æ­¥æ˜¯å¯åŠ¨ codetainer æœåŠ¡</span></span><br></pre></td></tr></table></figure>

<p>codetainer æœåŠ¡å¯åŠ¨åé»˜è®¤ä¼šå¡åœ¨å‰å°, æç¤ºä½ å·²ç»ç›‘å¬äº† 127.0.0.1:3000 è¿™ä¸ªåœ°å€</p>
<p>ä¸ç”¨ç®¡è¿™ä¸ªç›‘å¬äº†æœ¬åœ°3000ç«¯å£åœ°å€çš„æç¤º, ä½ å¯ä»¥æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹ç›‘å¬çš„ç«¯å£</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">netstat -antupl</span><br><span class="line">Active Internet connections (servers and established)</span><br><span class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    </span><br><span class="line">tcp6       0      0 :::3000                 :::*                    LISTEN      20597/./codetainer</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå¯ä»¥çœ‹åˆ° codetainer çš„æœåŠ¡ç›‘å¬äº†æ‰€æœ‰ IP çš„3000ç«¯å£</p>
<h2 id="ç™»å½•ä½ çš„-web-console"><a href="#ç™»å½•ä½ çš„-web-console" class="headerlink" title="ç™»å½•ä½ çš„ web console"></a>ç™»å½•ä½ çš„ web console</h2><p>æˆ‘è¯•äº†ä¸‹, ç›´æ¥æ‰“å¼€ <code>http://IP:3000</code> æ˜¯æœ‰é—®é¢˜çš„, å¦‚æœéœ€è¦ç™»å½•åˆ° console, éœ€è¦çŸ¥é“ä½ åˆšåˆšä½¿ç”¨ codetainer å¯åŠ¨çš„é•œåƒ id, å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æŸ¥çœ‹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> <span class="variable">$GOPATH</span>/src/github.com/codetainerapp/codetainer/bin/</span><br><span class="line"></span><br><span class="line">./codetainer list  </span><br><span class="line">Found 1 codetainers.</span><br><span class="line">-- [5ded5ca44ce1d9347a7d8556675b6a269b922660a27eef02df631bd323ed8057] mycode (Running)</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡ <code>./codetainer list</code> å¯ä»¥æŸ¥çœ‹å½“å‰ codetainer æ‰˜ç®¡çš„é•œåƒ id (è¿™é‡Œæˆ‘è¯´çš„é•œåƒ<br>id æŒ‡çš„æ˜¯åœ¨ codetainer é‡Œç®¡ç†çš„ id, è€Œä¸æ˜¯ docker ç®¡ç† container çš„ id )</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker images</span><br><span class="line">REPOSITORY              TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">ubuntu                  14.04               3f755ca42730        12 days ago         187.9 MB</span><br><span class="line"></span><br><span class="line"> docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class="line">5ded5ca44ce1        3f755ca42730        <span class="string">"/bin/bash"</span>         6 hours ago         Up 6 hours                              mycode</span><br><span class="line"></span><br><span class="line">./codetainer image list  </span><br><span class="line">Found 1 images:</span><br><span class="line">-- [sha256:3f755ca4273009a8b9d08aa156fbb5e601ed69dc698860938f36b2109c19cc39] [ubuntu:14.04]</span><br><span class="line"></span><br><span class="line">./codetainer list  </span><br><span class="line">Found 1 codetainers.</span><br><span class="line">-- [5ded5ca44ce1d9347a7d8556675b6a269b922660a27eef02df631bd323ed8057] mycode (Running)</span><br></pre></td></tr></table></figure>

<p>è‡ªè¡Œæ„Ÿå—ä»–ä»¬çš„åŒºåˆ«å§<del>~</del></p>
<p>æ‰¾åˆ° <code>./codetainer list</code>å›æ˜¾å‡ºæ¥çš„ id ä¹‹åå°±å¯ä»¥è®¿é—®æˆ‘ä»¬çš„ web console å•¦</p>
<p>è®¿é—®è¿™ä¸ªåœ°å€: http://<IP>:3000/api/v1/codetainer/<id>/view</p>
<p><img src="http://20150509.oss-cn-qingdao.aliyuncs.com/QQ20161228-0@2x.png" alt="codetainer"></p>
<p>åˆ°è¿™é‡Œå®ç°äº†åœ¨ä¸€å°å®¿ä¸»æœºä¸­å¯åŠ¨ä¸€ä¸ªå®¹å™¨æ¥æä¾› terminal </p>
<p>ä¸‹é¢æˆ‘æ¥ä»‹ç»ä¸‹å¦‚ä½•åœ¨ä¸€å°å®¿ä¸»æœºä¸Šå¯åŠ¨å¤šä¸ª container æ¥æä¾›è¿‡ä¸ª terminal</p>
<h1 id="å¤š-terminal"><a href="#å¤š-terminal" class="headerlink" title="å¤š terminal"></a>å¤š terminal</h1><p>ä¸éš¾å‘ç°, web console çš„æœåŠ¡æ˜¯ codetainer æ¥æä¾›çš„, ä»–æä¾›äº†å‰ç«¯é¡µé¢, æä¾›ä¸ docker API çš„äº¤äº’, æ‰€ä»¥, åªè¦æˆ‘ä»¬ä½¿ç”¨ <code>./codetainer create</code> å‘½ä»¤å¯åŠ¨å¤šä¸ªå®¹å™¨, å°±å¯ä»¥åœ¨ <code>./codetainer list</code> ä¸Šçœ‹åˆ°å¤šä¸ªâ€ä¸»æœºâ€, æŸ¥åˆ°ä»–ä»¬çš„ id, å°±å¯ä»¥åœ¨ url ä¸­é€šè¿‡æ›´æ¢ id çš„å€¼æ¥è®¿é—®ä¸é€šçš„ terminal</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">âœ  bin git:(master) âœ— ./codetainer list</span><br><span class="line">Found 1 codetainers.</span><br><span class="line">-- [5ded5ca44ce1d9347a7d8556675b6a269b922660a27eef02df631bd323ed8057] mycode (Running)</span><br><span class="line">âœ  bin git:(master) âœ— ./codetainer create ubuntu:14.04 mycode2</span><br><span class="line">Codetainer mycode2 creation succeeded!</span><br><span class="line">You can interact with it here: http://localhost:3000/api/v1/codetainer/c2d2fc896a60d37a7d1fd9d365850518d2ba7da853cc35563d68f4c32533912f/view</span><br><span class="line">âœ  bin git:(master) âœ— ./codetainer list                       </span><br><span class="line">Found 2 codetainers.</span><br><span class="line">-- [5ded5ca44ce1d9347a7d8556675b6a269b922660a27eef02df631bd323ed8057] mycode (Running)</span><br><span class="line">-- [c2d2fc896a60d37a7d1fd9d365850518d2ba7da853cc35563d68f4c32533912f] mycode2 (Running)</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬åœ¨ä½¿ç”¨ <code>ubuntu:14.04</code> é•œåƒåˆ›å»ºç¬¬äºŒä¸ªå®¹å™¨çš„æ—¶å€™, å›æ˜¾è‡ªåŠ¨ç»™å‡ºäº†è®¿é—®çš„åœ°å€, å› ä¸ºæˆ‘ç°åœ¨çš„ server å·²ç»å¯åŠ¨, åœ¨ server æ²¡æœ‰å¯åŠ¨çš„æ—¶å€™, åªèƒ½é€šè¿‡æ‰‹åŠ¨æŸ¥æ‰¾ id çš„æ–¹å¼æ¥è®¿é—®</p>
<p>ä»¥ä¸Šæˆ‘ä¾ç„¶ä½¿ç”¨äº† <code>ubuntu:14.04</code> é•œåƒ, ä½ å¯ä»¥åœ¨ pull ä¸‹æ¥æ–°çš„é•œåƒæ³¨å†Œåˆ° codetaineræœåŠ¡ä¸­. ä¾‹å¦‚:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker pull centos:latest</span><br><span class="line">codetainer image register centos:latest</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h1><p>docker å®˜æ–¹å®‰è£…æ–‡æ¡£: <a href="https://docs.docker.com/engine/installation/linux/centos/" target="_blank" rel="noopener">https://docs.docker.com/engine/installation/linux/centos/</a><br>codetainer é¡¹ç›® github åœ°å€: <a href="https://github.com/codetainerapp/codetainer" target="_blank" rel="noopener">https://github.com/codetainerapp/codetainer</a><br>go-bindata é¡¹ç›® github åœ°å€: <a href="https://github.com/jteeuwen/go-bindata" target="_blank" rel="noopener">https://github.com/jteeuwen/go-bindata</a><br>godep é¡¹ç›® github åœ°å€: <a href="https://github.com/tools/godep" target="_blank" rel="noopener">https://github.com/tools/godep</a><br>golang å®˜æ–¹ä¸‹è½½åœ°å€: <a href="https://golang.org/dl/" target="_blank" rel="noopener">https://golang.org/dl/</a><br>golang å®˜æ–¹å®‰è£…æ–‡æ¡£: <a href="https://golang.org/doc/install" target="_blank" rel="noopener">https://golang.org/doc/install</a><br>go-bindata æŠ¥é”™è§£å†³:  <a href="http://blog.csdn.net/lampqiu/article/details/48649881" target="_blank" rel="noopener">http://blog.csdn.net/lampqiu/article/details/48649881</a></p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>web console</tag>
        <tag>codetainer</tag>
        <tag>codepicnic</tag>
      </tags>
  </entry>
  <entry>
    <title>mysqldumpè¿ç§»æ–¹æ¡ˆ</title>
    <url>/2016/12/12/mysqldump%E8%BF%81%E7%A7%BB%E6%96%B9%E6%A1%88/</url>
    <content><![CDATA[<h1 id="mysqldumpè¿ç§»æ–¹æ¡ˆ"><a href="#mysqldumpè¿ç§»æ–¹æ¡ˆ" class="headerlink" title="mysqldumpè¿ç§»æ–¹æ¡ˆ"></a>mysqldumpè¿ç§»æ–¹æ¡ˆ</h1><blockquote>
<p>æ•°æ®åº“Dä»Aä¸»æœºè¿å¾€Bä¸»æœº</p>
</blockquote>
<h2 id="å‰æœŸå‡†å¤‡"><a href="#å‰æœŸå‡†å¤‡" class="headerlink" title="å‰æœŸå‡†å¤‡"></a>å‰æœŸå‡†å¤‡</h2><ul>
<li>å‰ç«¯åº”ç”¨æ“ä½œDåº“çš„ç”¨æˆ·åå’Œå¯†ç </li>
</ul>
<p>å‘ç ”å‘äººå‘˜æ”¶é›†ç”¨æˆ·åå’Œå¯†ç ï¼Œåœ¨Bä¸»æœºçš„æ•°æ®åº“å®ä¾‹ä¸­ï¼Œé¢„å…ˆå»ºç«‹ç”¨æˆ·</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">B: mysql&gt; create user 'username'@'%' identified by 'password';</span><br></pre></td></tr></table></figure>

<ul>
<li>åœ¨Aä¸»æœºä¸­æŸ¥è¯¢Dåº“ä¸­è¯¥ç”¨æˆ·çš„æƒé™</li>
</ul>
<p>æ‰¾åˆ°è¯¥ç”¨æˆ·å¯¹åº”çš„Dåº“çš„æƒé™SQLè¯­å¥ï¼Œä¿å­˜ä¸€ä¸‹ï¼Œç­‰åˆ°Bä¸»æœºå»ºåº“åï¼Œç»™è¯¥ç”¨æˆ·èµ‹äºˆæƒé™</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">A: mysql&gt; show grants for username;</span><br></pre></td></tr></table></figure>

<ul>
<li>æ”¶é›†éœ€è¦è¿ç§»çš„ç›®æ ‡æ•°æ®åº“çš„å»ºåº“å‚æ•°</li>
</ul>
<p><strong>ä¸€èˆ¬æƒ…å†µä¸‹åˆç‰¹æ®Šå»ºåº“å‚æ•°ï¼Œæ³¨æ„å­—ç¬¦é›†</strong></p>
<p><em>ç”¨æˆ·ä½“ç³»çš„my.cnfä¸­æŒ‡å®šå­—ç¬¦é›†é»˜è®¤ä¸º<code>character_set_server=utf8</code></em></p>
<p><em>ocrdbçš„my.cnfä¸­æŒ‡å®šå­—ç¬¦é›†é»˜è®¤ä¸º<code>character_set_server=utf8mb4</code></em></p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">A: mysql&gt; show create database dbname;</span><br></pre></td></tr></table></figure>

<ul>
<li>ä¸ºä¸Šé¢æŒ‡å®šçš„ç”¨æˆ·èµ‹äºˆBä¸»æœºä¸Šæ–°åº“çš„æƒé™</li>
</ul>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">B: mysql&gt; åœ¨Bä¸»æœºä¸Šæ‰§è¡Œç¬¬äºŒæ­¥ä¿å­˜çš„grantè¯­å¥</span><br></pre></td></tr></table></figure>

<h2 id="è¿ç§»å‰çš„æ“ä½œ"><a href="#è¿ç§»å‰çš„æ“ä½œ" class="headerlink" title="è¿ç§»å‰çš„æ“ä½œ"></a>è¿ç§»å‰çš„æ“ä½œ</h2><ul>
<li>å°†Aä¸»æœºä¸ŠDåº“ç”¨æˆ·çš„<code>insert</code> <code>update</code> <code>delete</code>æƒé™æ’¤é”€</li>
</ul>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">A: mysql&gt; revoke INSERT, UPDATE, DELETE ON databasename.* FROM username;</span><br></pre></td></tr></table></figure>

<ul>
<li>åœæ­¢è¿æ¥æ•°æ®åº“Açš„æ‰€æœ‰å‰ç«¯åº”ç”¨</li>
</ul>
<p>å°½å¯èƒ½åœæ­¢è¿æ¥<code>æ•°æ®åº“A</code>çš„æ‰€æœ‰å‰ç«¯åº”ç”¨ï¼Œä¸èƒ½åœæ­¢çš„ï¼Œå°†åœ¨æ•°æ®åº“ä¸­<code>kill</code>æ‰<code>ESTABLISHED</code>çš„è¿æ¥ï¼Œè®©å‰ç«¯åº”ç”¨çš„è¿æ¥æ± é‡æ–°è¿æ¥mysqlæ•°æ®åº“</p>
<p>æ£€æŸ¥è¯¥ç”¨æˆ·çš„è¿æ¥æƒ…å†µ</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">A: $&gt; mysql -uroot -p -e 'show processlist;' | grep username</span><br></pre></td></tr></table></figure>

<p>å¦‚æœå‰ç«¯åº”ç”¨åœæ­¢åï¼Œä»æœ‰å…¶ä»–æœåŠ¡å™¨çš„è¿æ¥ï¼Œåˆ™killæ‰è¿™äº›è¿æ¥ï¼Œè®©å…¶é‡è¿ï¼Œé‡æ–°è·å–è¯¥åº“æƒé™ï¼Œå¹¶è®°å½•è¿™äº›æœåŠ¡å™¨çš„IPåœ°å€ï¼Œå› ä¸ºè¯¥åº“è¿èµ°å¹¶å‰¥å¤ºå†™å…¥æƒé™åï¼Œè¿™äº›æœåŠ¡å™¨å¯èƒ½ä¼šæœ‰é—®é¢˜</p>
<h2 id="è¿ç§»"><a href="#è¿ç§»" class="headerlink" title="è¿ç§»"></a>è¿ç§»</h2><ul>
<li>mysqldump</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">A: $&gt; mysqldump -uusername -p databasename | gzip &gt; databasename.sql.gz</span><br></pre></td></tr></table></figure>

<ul>
<li>scp </li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">A: $&gt; scp databasename.sql.gz ps@IP:/tmp/</span><br></pre></td></tr></table></figure>

<ul>
<li>load</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">B: $&gt; gunzip &lt; databasename.sql.gz | mysql -uroot -p databasename</span><br></pre></td></tr></table></figure>

<h2 id="è¿ç§»å"><a href="#è¿ç§»å" class="headerlink" title="è¿ç§»å"></a>è¿ç§»å</h2><ul>
<li>åœ¨ä¸‰åŒºå¼€å¯åº”ç”¨æœåŠ¡å™¨ï¼Œè¿æ¥ä¸‰åŒºmysql</li>
</ul>
<h1 id="é™„"><a href="#é™„" class="headerlink" title="é™„"></a>é™„</h1><ul>
<li>åˆ é™¤æŸä¸€ç”¨æˆ·çš„æ‰€æœ‰æƒé™</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">revoke</span> <span class="keyword">all</span> <span class="keyword">on</span> *.* <span class="keyword">from</span> sss@localhost ;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>mysqldump</tag>
      </tags>
  </entry>
  <entry>
    <title>Jenkinsè¿ç§»</title>
    <url>/2016/12/12/Jenkins%E8%BF%81%E7%A7%BB/</url>
    <content><![CDATA[<p>ä¸‹è½½ jenkins å¯¹åº”ç‰ˆæœ¬çš„ rpm å®‰è£…åŒ…åˆ°<code>/usr/local/src/</code>ä¸‹</p>
<h1 id="æ–°-jenkins-æœåŠ¡å™¨çš„æ“ä½œ"><a href="#æ–°-jenkins-æœåŠ¡å™¨çš„æ“ä½œ" class="headerlink" title="æ–° jenkins æœåŠ¡å™¨çš„æ“ä½œ"></a>æ–° jenkins æœåŠ¡å™¨çš„æ“ä½œ</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum install java-1.8.0-openjdk  java-1.8.0-openjdk-devel</span><br><span class="line">yum install jenkins-1.596.1-1.1.noarch.rpm</span><br><span class="line">mkdir /var/jenkins_home</span><br><span class="line">chown jenkins:jenkins /var/jenkins_home -R</span><br><span class="line"><span class="built_in">export</span> JENKINS_HOME=/var/jenkins_home</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"export JENKINS_HOME=/var/jenkins_home"</span> &gt;&gt; /etc/profile</span><br><span class="line">systemctl stop jenkins</span><br><span class="line">mv /var/lib/jenkins /var/lib/jenkins.bak</span><br><span class="line">ln -s /var/jenkins_home /var/lib/jenkins</span><br><span class="line">vim /etc/rc.local </span><br><span class="line">route add -net 192.168.2.0/24 gw 192.168.10.85</span><br><span class="line">route add -net 192.168.8.0/24 gw 192.168.10.85</span><br><span class="line">...</span><br><span class="line">mkdir ~/.ssh</span><br><span class="line">chmod 700 ~/.ssh</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†è€ jenkins çš„ /etc/hosts ä¿¡æ¯æ‹·è´è¿‡æ¥</span></span><br><span class="line">vim /etc/hosts</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/src/</span><br><span class="line">wget http://mirrors.tuna.tsinghua.edu.cn/apache/maven/maven-3/3.3.9/binaries/apache-maven-3.3.9-bin.tar.gz</span><br><span class="line">tar -xvzf apache-maven-3.3.9-bin.tar.gz</span><br><span class="line">mv apache-maven-3.3.9 /usr/<span class="built_in">local</span>/apache-maven</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="string">"/usr/local/node/bin:/usr/local/apache-maven/bin:<span class="variable">$PATH</span>"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'export PATH="/usr/local/node/bin:/usr/local/apache-maven/bin:$PATH"'</span> &gt;&gt; /etc/profile</span><br><span class="line">mvn -v</span><br><span class="line">scp /usr/<span class="built_in">local</span>/apache-maven/conf/settings.xml root@192.168.10.170:/usr/<span class="built_in">local</span>/apache-maven/conf/settings.xml</span><br></pre></td></tr></table></figure>

<h1 id="è€-jenkins-æœåŠ¡å™¨çš„æ“ä½œ"><a href="#è€-jenkins-æœåŠ¡å™¨çš„æ“ä½œ" class="headerlink" title="è€ jenkins æœåŠ¡å™¨çš„æ“ä½œ"></a>è€ jenkins æœåŠ¡å™¨çš„æ“ä½œ</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">su - jenkins</span><br><span class="line"><span class="built_in">cd</span> .ssh</span><br><span class="line">scp id_rsa id_rsa.pub root@192.168.10.170:/root/.ssh/</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°† jenkins home scp æˆ– rsync åˆ°æ–° jenkins çš„ jenkins home</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Jenkins</tag>
      </tags>
  </entry>
  <entry>
    <title>å¯¼å…¥å¯¼å‡ºé˜²ç«å¢™è§„åˆ™</title>
    <url>/2016/12/12/%E5%AF%BC%E5%85%A5%E5%AF%BC%E5%87%BA%E9%98%B2%E7%81%AB%E5%A2%99%E8%A7%84%E5%88%99/</url>
    <content><![CDATA[<p>ä¿å­˜è§„åˆ™ï¼š<code>iptables-save &gt; /etc/iptables-script</code><br>æ¢å¤è§„åˆ™ï¼š<code>iptables-restore &lt; /etc/iptables-script</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; vim iptables.conf</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># Generated by iptables-save v1.4.21 on Mon Nov 21 14:49:30 2016</span><br><span class="line">*nat</span><br><span class="line">:PREROUTING ACCEPT [75958158:4710517785]</span><br><span class="line">:INPUT ACCEPT [11156433:697999260]</span><br><span class="line">:OUTPUT ACCEPT [11270560:679018758]</span><br><span class="line">:POSTROUTING ACCEPT [0:0]</span><br><span class="line">-A POSTROUTING -j MASQUERADE</span><br><span class="line">COMMIT</span><br><span class="line"># Completed on Mon Nov 21 14:49:30 2016</span><br><span class="line"># Generated by iptables-save v1.4.21 on Mon Nov 21 14:49:30 2016</span><br><span class="line">*filter</span><br><span class="line">:INPUT ACCEPT [1937717187:1020106795408]</span><br><span class="line">:FORWARD ACCEPT [2772458722:1915560771769]</span><br><span class="line">:OUTPUT ACCEPT [2100892309:1998825790936]</span><br><span class="line">COMMIT</span><br><span class="line"># Completed on Mon Nov 21 14:49:30 2016</span><br></pre></td></tr></table></figure>


<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; iptables-restore &lt; iptables.conf</span><br></pre></td></tr></table></figure>

<h1 id="é…ç½®ç½‘å¡è½¬å‘"><a href="#é…ç½®ç½‘å¡è½¬å‘" class="headerlink" title="é…ç½®ç½‘å¡è½¬å‘"></a>é…ç½®ç½‘å¡è½¬å‘</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> 1 &gt; /proc/sys/net/ipv4/ip_forward</span><br></pre></td></tr></table></figure>]]></content>
      <tags>
        <tag>iptables</tag>
      </tags>
  </entry>
  <entry>
    <title>TimeWaitçŠ¶æ€è¿æ¥å¿«é€Ÿå›æ”¶</title>
    <url>/2016/12/12/TimeWait%E7%8A%B6%E6%80%81%E8%BF%9E%E6%8E%A5%E5%BF%AB%E9%80%9F%E5%9B%9E%E6%94%B6/</url>
    <content><![CDATA[<p><code>vi /etc/sysctl.conf</code></p>
<p>ç¼–è¾‘æ–‡ä»¶ï¼ŒåŠ å…¥ä»¥ä¸‹å†…å®¹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">net.ipv4.tcp_syncookies = 1</span><br><span class="line"></span><br><span class="line">net.ipv4.tcp_tw_reuse = 1</span><br><span class="line"></span><br><span class="line">net.ipv4.tcp_tw_recycle = 1</span><br><span class="line"></span><br><span class="line">net.ipv4.tcp_fin_timeout = 30</span><br></pre></td></tr></table></figure>


<p>ç„¶åæ‰§è¡Œ<code>/sbin/sysctl -p</code>è®©å‚æ•°ç”Ÿæ•ˆã€‚</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>time wait</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS6.xä¸‹çš„gccå‡çº§</title>
    <url>/2016/12/12/CentOS6-x%E4%B8%8B%E7%9A%84gcc%E5%8D%87%E7%BA%A7/</url>
    <content><![CDATA[<blockquote>
<p>node.jsé¡¹ç›®åœ¨ä½¿ç”¨æŸäº›æ¨¡å—æ˜¯ï¼Œéœ€è¦æ›´é«˜ç‰ˆæœ¬çš„gccçš„æ”¯æŒï¼Œä½†æ˜¯CentOS6ç³»åˆ—çš„ç³»ç»Ÿï¼Œé»˜è®¤çš„gccä¸ç¬¦åˆè¦æ±‚ï¼Œæ‰€ä»¥éœ€è¦å¯¹å…¶å‡çº§</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; yum -y install make automaker gcc gcc-c++ -y</span><br><span class="line">&gt; gcc -v</span><br><span class="line">&gt; rpm -ivh https://www.softwarecollections.org/en/scls/rhscl/devtoolset-3/epel-6-x86_64/download/rhscl-devtoolset-3-epel-6-x86_64.noarch.rpm</span><br><span class="line">&gt; yum install devtoolset-3-gcc-c++</span><br><span class="line">&gt; <span class="built_in">echo</span> <span class="string">"source /opt/rh/devtoolset-3/enable"</span> &gt;&gt;/etc/profile</span><br><span class="line">&gt; <span class="built_in">source</span> /etc/profile</span><br><span class="line">&gt; gcc -v</span><br></pre></td></tr></table></figure>

<p>è‡³æ­¤ï¼Œå‡çº§æˆåŠŸã€‚</p>
<p>æ³¨ï¼šCentOS7ç³»ç»Ÿé»˜è®¤çš„gccç‰ˆæœ¬ç¬¦åˆè¦æ±‚</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>gcc</tag>
      </tags>
  </entry>
  <entry>
    <title>nvmå®‰è£…</title>
    <url>/2016/12/12/nvm%E5%AE%89%E8%A3%85/</url>
    <content><![CDATA[<h1 id="ä¸‹è½½"><a href="#ä¸‹è½½" class="headerlink" title="ä¸‹è½½"></a>ä¸‹è½½</h1><p>å¯ä»¥åˆ°<a href="https://github.com/creationix/nvm/releases" target="_blank" rel="noopener">https://github.com/creationix/nvm/releases</a>ä¸‹è½½</p>
<h1 id="å®‰è£…-amp-éªŒè¯"><a href="#å®‰è£…-amp-éªŒè¯" class="headerlink" title="å®‰è£…&amp;éªŒè¯"></a>å®‰è£…&amp;éªŒè¯</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[suoper@103-7 /usr/<span class="built_in">local</span>/src]<span class="comment"># tar -xvf nvm-0.31.4.tar</span></span><br><span class="line">[suoper@103-7 ~]$ <span class="built_in">cd</span> /usr/<span class="built_in">local</span>/src/nvm-0.31.4</span><br><span class="line">[suoper@103-7 /usr/<span class="built_in">local</span>/src/nvm-0.31.4]$ ./install.sh </span><br><span class="line">[suoper@103-7 /usr/<span class="built_in">local</span>/src/nvm-0.31.4]$ <span class="built_in">source</span>  /home/suoper/.bashrc</span><br><span class="line">[suoper@103-7 /usr/<span class="built_in">local</span>/src/nvm-0.31.4]$ nvm --version</span><br><span class="line">0.31.4</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>nvm</tag>
      </tags>
  </entry>
  <entry>
    <title>sshè¿æ¥ä¸å†æç¤ºæ˜¯å¦æ·»åŠ æŒ‡çº¹ä¿¡æ¯åˆ°known_hosts</title>
    <url>/2016/12/12/ssh%E8%BF%9E%E6%8E%A5%E4%B8%8D%E5%86%8D%E6%8F%90%E7%A4%BA%E6%98%AF%E5%90%A6%E6%B7%BB%E5%8A%A0%E6%8C%87%E7%BA%B9%E4%BF%A1%E6%81%AF%E5%88%B0known-hosts-1/</url>
    <content><![CDATA[<blockquote>
<p>åœ¨ä½¿ç”¨sshå®¢æˆ·ç«¯è¿æ¥è¿œç¨‹ä¸»æœºæ—¶ï¼Œå¦‚æœè¿œç¨‹ä¸»æœºæ˜¯é¦–æ¬¡è®¿é—®ï¼Œä¼šæç¤ºæ·»åŠ è¿œç¨‹ä¸»æœºçš„æŒ‡çº¹ä¿¡æ¯ï¼›å¦‚æœè¿œç¨‹ä¸»æœºçš„ä¿¡æ¯å‘ç”Ÿå˜æ›´ï¼Œåˆ™ä¸èƒ½è¿æ¥å»ºç«‹è¿æ¥ï¼ŒæŠ¥<code>REMOTE HOST IDENTIFICATION HAS CHANGED!</code>çš„é”™è¯¯ï¼Œæ­¤æ—¶éœ€è¦æ‰‹åŠ¨å»<code>~/.ssh/known_hosts</code>ä¸­åˆ é™¤ç›¸å…³ä¸»æœºçš„æŒ‡çº¹ä¿¡æ¯ï¼Œé‡æ–°ä¿å­˜æ‰å¯å»ºç«‹è¿æ¥</p>
</blockquote>
<p>è¿™é‡Œæä¾›ä¸¤ç§æ–¹å¼ï¼Œå¼ºåˆ¶sshä¿å­˜æ‰€æœ‰çš„ä¸»æœºæŒ‡çº¹ä¿¡æ¯ï¼Œå³ä½¿è¿œç¨‹ä¸»æœºä¿¡æ¯å‘ç”Ÿå˜æ›´ï¼Œåˆ™æ›¿æ¢<code>~/.ssh/known_hosts</code>æ–‡ä»¶ä¸­çš„ç›¸å…³æ¡ç›®</p>
<h1 id="å…¨å±€é…ç½®"><a href="#å…¨å±€é…ç½®" class="headerlink" title="å…¨å±€é…ç½®"></a>å…¨å±€é…ç½®</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; vim /etc/ssh/ssh_config</span><br><span class="line"><span class="comment">#   StrictHostKeyChecking ask</span></span><br><span class="line">    StrictHostKeyChecking no</span><br></pre></td></tr></table></figure>

<h1 id="ç”¨æˆ·é…ç½®"><a href="#ç”¨æˆ·é…ç½®" class="headerlink" title="ç”¨æˆ·é…ç½®"></a>ç”¨æˆ·é…ç½®</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; vim ~/.ssh/config</span><br><span class="line">StrictHostKeyChecking no</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>ssh</tag>
        <tag>know_hosts</tag>
      </tags>
  </entry>
  <entry>
    <title>æŒ‡å®štomcatä½¿ç”¨çš„jdkç‰ˆæœ¬</title>
    <url>/2016/12/12/%E6%8C%87%E5%AE%9Atomcat%E4%BD%BF%E7%94%A8%E7%9A%84jdk%E7%89%88%E6%9C%AC/</url>
    <content><![CDATA[<blockquote>
<p> æ“ä½œç›®æ ‡ï¼š 192.168.100.150 cloudfollowadmin é¡¹ç›®æŒ‡å®šjava 1.8</p>
</blockquote>
<p>192.168.100.150 ä¸Šæœ‰å¤šä¸ªtomcaté¡¹ç›®ï¼Œèµ·javaç‰ˆæœ¬ä½¿ç”¨äº†ç³»ç»Ÿé»˜è®¤çš„1.6ï¼Œç°åœ¨è¦ä¸ºcloudfollowadminé¡¹ç›®æŒ‡å®šä½¿ç”¨java1.8ç‰ˆæœ¬ï¼Œä»¥ä¸‹æ˜¯æ“ä½œæ­¥éª¤</p>
<h1 id="å®ç°æ€è·¯"><a href="#å®ç°æ€è·¯" class="headerlink" title="å®ç°æ€è·¯"></a>å®ç°æ€è·¯</h1><ul>
<li>æ‰¾åˆ°å¯åŠ¨åŠ è½½çš„é…ç½®æ–‡ä»¶</li>
<li>åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šjavahome</li>
</ul>
<p>ä»¥ä¸‹æ˜¯è¯¥é¡¹ç›®çš„å®Œæ•´è·¯å¾„<br><code>/webserver/tomcat/cloudfollowadmin/bin/</code></p>
<p>åœ¨è¯¥è·¯å¾„ä¸‹ï¼Œtomcatå¯åŠ¨æ—¶ä¼šåŠ è½½æ‰§è¡Œcatalina.shæ–‡ä»¶ï¼Œè¿™é‡Œè®¾ç½®äº†ä¸€äº›ç¯å¢ƒå˜é‡ï¼Œä½†æ˜¯åœ¨è„šæœ¬çš„ä¸­é—´éƒ¨åˆ†</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; vim catalina.sh</span><br><span class="line"></span><br><span class="line">......</span><br><span class="line"></span><br><span class="line"><span class="comment"># Get standard Java environment variables</span></span><br><span class="line"><span class="keyword">if</span> <span class="variable">$os400</span>; <span class="keyword">then</span></span><br><span class="line">  <span class="comment"># -r will Only work on the os400 if the files are:</span></span><br><span class="line">  <span class="comment"># 1. owned by the user</span></span><br><span class="line">  <span class="comment"># 2. owned by the PRIMARY group of the user</span></span><br><span class="line">  <span class="comment"># this will not work if the user belongs in secondary groups</span></span><br><span class="line">  BASEDIR=<span class="string">"<span class="variable">$CATALINA_HOME</span>"</span></span><br><span class="line">  . <span class="string">"<span class="variable">$CATALINA_HOME</span>"</span>/bin/setclasspath.sh</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="keyword">if</span> [ -r <span class="string">"<span class="variable">$CATALINA_HOME</span>"</span>/bin/setclasspath.sh ]; <span class="keyword">then</span></span><br><span class="line">    BASEDIR=<span class="string">"<span class="variable">$CATALINA_HOME</span>"</span></span><br><span class="line">    . <span class="string">"<span class="variable">$CATALINA_HOME</span>"</span>/bin/setclasspath.sh</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"Cannot find <span class="variable">$CATALINA_HOME</span>/bin/setclasspath.sh"</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"This file is needed to run this program"</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">......</span><br></pre></td></tr></table></figure>

<p>åœ¨è·å–javaç¯å¢ƒå˜é‡çš„æ—¶å€™ï¼Œå®é™…æ˜¯è¯»å–äº†è¯¥binç›®å½•ä¸‹ï¼Œsetclasspath.shè„šæœ¬çš„æ‰§è¡Œç»“æœï¼Œæ‰€ä»¥æœ‰æ­¤å¯ä»¥æ¨å¯¼å‡ºï¼Œåªè¦åœ¨setclasspath.shè„šæœ¬ä¸­ï¼ŒæŠŠjavaçš„é…ç½®å†™æ­»ï¼Œé‚£ä¹ˆtomcatå¯åŠ¨æ—¶ï¼Œå°±ä¼šå»æŒ‡å®šçš„è·¯å¾„ä¸‹å»æ‰¾javahomeäº†</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; vim setclasspath.sh</span><br><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line">JAVA_HOME=<span class="string">"/usr/local/src/jdk1.8.0_101/"</span></span><br><span class="line">JRE_HOME=<span class="string">"/usr/local/src/jdk1.8.0_101/jre"</span></span><br><span class="line"></span><br><span class="line">......</span><br></pre></td></tr></table></figure>

<p>åœ¨setclasspath.shè„šæœ¬çš„å¼€å¤´ï¼Œè®¾ç½®javaçš„ç¯å¢ƒå˜é‡ï¼Œå¦‚æœä½ æœ¬æœºçš„å…¶ä»–javaåº”ç”¨éœ€è¦ç»§ç»­ä½¿ç”¨tomcatè€ç‰ˆæœ¬ï¼Œé‚£ä¹ˆåœ¨è¿™ä¸ªè„šæœ¬ä¸­ï¼Œåƒä¸‡ä¸è¦åœ¨å‰é¢åŠ ä¸Šexportå…³é”®å­—ï¼Œè¿™æ ·ä¼šæŠŠè¿™ä¸ªå˜é‡çš„è®¾ç½®æå‡ä¸ºå…¨å±€å˜é‡ï¼Œä¼šå½±å“åˆ°å…¶ä»–åº”ç”¨é‡å¯æ—¶è·å–åˆ°çš„javaHomeè·¯å¾„</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>tomcat</tag>
        <tag>jdk</tag>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQLè¿ç§»æ–¹æ¡ˆ-å•å®ä¾‹å•åº“ä¸»ä»åŒæ­¥è¿ç§»</title>
    <url>/2016/12/12/MySQL%E8%BF%81%E7%A7%BB%E6%96%B9%E6%A1%88-%E5%8D%95%E5%AE%9E%E4%BE%8B%E5%8D%95%E5%BA%93%E4%B8%BB%E4%BB%8E%E5%90%8C%E6%AD%A5%E8%BF%81%E7%A7%BB/</url>
    <content><![CDATA[<h1 id="è¿åº“-amp-åŒæ­¥"><a href="#è¿åº“-amp-åŒæ­¥" class="headerlink" title="è¿åº“&amp;åŒæ­¥"></a>è¿åº“&amp;åŒæ­¥</h1><figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åœ¨ä¸»åº“é”åº“</span></span><br><span class="line">mysql&gt; flush tables with read lock;</span><br><span class="line"><span class="comment"># dumpä¸»åº“æ•°æ®åº“</span></span><br><span class="line">$ mysqldump -uroot -p OcrManagement &gt; OcrManagement.sql</span><br><span class="line"><span class="comment">#æŸ¥çœ‹ä¸»åº“ä½ç½®</span></span><br><span class="line">mysql&gt; show master status;</span><br><span class="line">+<span class="comment">------------------+------------+--------------+------------------+-------------------+</span></span><br><span class="line">| File             | Position   | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |</span><br><span class="line">+<span class="comment">------------------+------------+--------------+------------------+-------------------+</span></span><br><span class="line">| mysql-bin.000014 | 1058718197 |              | mysql            |                   |</span><br><span class="line">+<span class="comment">------------------+------------+--------------+------------------+-------------------+</span></span><br><span class="line"><span class="comment"># è§£é”ä¸»åº“</span></span><br><span class="line">mysql&gt; unlock tables;</span><br><span class="line"><span class="comment"># å°†dumpå‡ºæ¥çš„sqlæ–‡ä»¶ä¼ é€åˆ°ä»åº“</span></span><br><span class="line">$ tar -cvzf OcrManagement.sql.tar.gz OcrManagement.sql</span><br><span class="line">$ scp OcrManagement.sql ps@192.168.3.11:/data/</span><br><span class="line"><span class="comment"># æŸ¥çœ‹ä¸»åº“æ•°æ®åº“å»ºåº“å‚æ•°</span></span><br><span class="line">mysql&gt; show create database OcrManagement;</span><br><span class="line"></span><br><span class="line"><span class="comment">----------------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># æ ¹æ®ä¸»åº“å»ºåº“å‚æ•°ï¼Œåœ¨ä»åº“é¢„å…ˆå»ºç«‹æ•°æ®åº“</span></span><br><span class="line">mysql&gt; create database OcrManagement;</span><br><span class="line"><span class="comment"># åœ¨ä»åº“ä¸­è§£å‹æ–‡ä»¶</span></span><br><span class="line">$ tar -xvzf OcrManagement.sql.tar.gz</span><br><span class="line"><span class="comment"># å¯¼å…¥æ•°æ®</span></span><br><span class="line">$ mysql -uroot -p OcrManagement &lt; OcrManagement.sql</span><br><span class="line"><span class="comment"># è®¾ç½®ä¸»åº“ä¿¡æ¯</span></span><br><span class="line">mysql&gt; change master to MASTER_HOST='192.168.168.149',MASTER_PORT=33306,MASTER_USER='repl',MASTER_PASSWORD='xxxxxxxx',MASTER_LOG_FILE='mysql-bin.000014',MASTER_LOG_POS=1058718197;</span><br><span class="line"><span class="comment"># å¯åŠ¨ä»åº“çº¿ç¨‹</span></span><br><span class="line">mysql&gt; start slave;</span><br><span class="line"><span class="comment"># æ£€æŸ¥åŒæ­¥çŠ¶æ€</span></span><br><span class="line">mysql&gt; show slave status\G</span><br></pre></td></tr></table></figure>

<h1 id="åˆ‡æ¢ä¸»ä»"><a href="#åˆ‡æ¢ä¸»ä»" class="headerlink" title="åˆ‡æ¢ä¸»ä»"></a>åˆ‡æ¢ä¸»ä»</h1><p>[MySQLä¸»ä»åˆ‡æ¢]<a href="https://docs.20150509.cn/2016/12/12/MySQLçš„ä¸»ä»åˆ‡æ¢/" target="_blank" rel="noopener">https://docs.20150509.cn/2016/12/12/MySQLçš„ä¸»ä»åˆ‡æ¢/</a></p>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQLè¿ç§»</tag>
      </tags>
  </entry>
  <entry>
    <title>Dockerç›¸å…³ç»„ä»¶çš„éƒ¨ç½²</title>
    <url>/2016/12/12/Docker%E7%9B%B8%E5%85%B3%E7%BB%84%E4%BB%B6%E7%9A%84%E9%83%A8%E7%BD%B2/</url>
    <content><![CDATA[<h1 id="docker-engine"><a href="#docker-engine" class="headerlink" title="docker-engine"></a>docker-engine</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">âœ  ~  tee &#x2F;etc&#x2F;yum.repos.d&#x2F;docker.repo &lt;&lt;-&#39;EOF&#39;</span><br><span class="line">[dockerrepo]</span><br><span class="line">name&#x3D;Docker Repository</span><br><span class="line">baseurl&#x3D;https:&#x2F;&#x2F;yum.dockerproject.org&#x2F;repo&#x2F;main&#x2F;centos&#x2F;$releasever&#x2F;</span><br><span class="line">enabled&#x3D;1</span><br><span class="line">gpgcheck&#x3D;1</span><br><span class="line">gpgkey&#x3D;https:&#x2F;&#x2F;yum.dockerproject.org&#x2F;gpg</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<h1 id="docker-compose"><a href="#docker-compose" class="headerlink" title="docker-compose"></a>docker-compose</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">âœ  ~ yum install python-pip </span><br><span class="line">âœ  ~ pip install --upgrade pip</span><br><span class="line">âœ  ~ pip install docker-compose</span><br><span class="line"></span><br><span class="line"># å¦‚æœæ‰§è¡Œ docker-compose å‘½ä»¤æœ‰å¦‚ä¸‹æŠ¥é”™æ—¶, è¿˜éœ€è¦å®‰è£…ä»¥ä¸‹è½¯ä»¶åŒ…</span><br><span class="line"># pkg_resources.DistributionNotFound: backports.ssl-match-hostname&gt;&#x3D;3.5</span><br><span class="line"></span><br><span class="line">âœ  ~ pip install backports.ssl-match-hostname&#x3D;&#x3D;3.5.0.1</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>docker-engine</tag>
        <tag>docker-compose</tag>
      </tags>
  </entry>
  <entry>
    <title>Linuxä¸‹è·å–æœ¬åœ°å‡ºå£IP</title>
    <url>/2016/12/12/Linux%E4%B8%8B%E8%8E%B7%E5%8F%96%E6%9C%AC%E5%9C%B0%E5%87%BA%E5%8F%A3IP/</url>
    <content><![CDATA[<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; curl ifconfig.me</span><br><span class="line">æˆ–</span><br><span class="line">&gt; curl http://members.3322.org/dyndns/getip</span><br><span class="line">æˆ–</span><br><span class="line">&gt; curl ip.cn</span><br></pre></td></tr></table></figure>

<p><code>ifconfig.me</code> çš„åŸŸåå¾ˆå¥½è®°, ä½†æ˜¯åœ¨å›½å†…çš„è®¿é—®é€Ÿåº¦å¯èƒ½æå…¶ç¼“æ…¢</p>
<p><code>ip.cn</code> åŸŸåä¹Ÿå¾ˆå¥½è®°, åœ¨å›½å†…è¿”å›ç»“æœçš„é€Ÿåº¦ä¹Ÿå¾ˆå¿«, è€Œä¸”è¿˜èƒ½è¿”å›è¿è¥å•†çš„ä¿¡æ¯</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">âœ  ~ curl ip.cn</span><br><span class="line">å½“å‰ IPï¼š209.9.108.86 æ¥è‡ªï¼šé¦™æ¸¯ç‰¹åˆ«è¡Œæ”¿åŒº</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>å‡ºå£IP</tag>
      </tags>
  </entry>
  <entry>
    <title>è¶…çº¿ç¨‹æŠ€æœ¯çš„åº”ç”¨åœºæ™¯</title>
    <url>/2016/12/12/%E8%B6%85%E7%BA%BF%E7%A8%8B%E6%8A%80%E6%9C%AF%E7%9A%84%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/</url>
    <content><![CDATA[<blockquote>
<p>è¶…çº¿ç¨‹æŠ€æœ¯ä¸èƒ½åº”ç”¨åœ¨æ‰€æœ‰çš„åœºæ™¯ä¸­<br>å¯¹äºä¸åŒçš„æƒ…å†µæ¥è¯´ï¼Œå…¶æœ‰å¯èƒ½å¸®åŠ©æå‡è™šæ‹ŸæœåŠ¡å™¨çš„æ€§èƒ½è¡¨ç°<br>ä½†æ˜¯åè¿‡æ¥ä¹Ÿæœ‰å¯èƒ½é€ æˆè´Ÿé¢å½±å“<br>è€Œè·å¾—è‰¯å¥½æ€§èƒ½è¡¨ç°çš„å…³é”®å°±åœ¨äºåˆ¤æ–­åº”è¯¥ä½•æ—¶ä½¿ç”¨è¿™ç§æŠ€æœ¯</p>
</blockquote>
<h1 id="è¶…çº¿ç¨‹æŠ€æœ¯ä»‹ç»"><a href="#è¶…çº¿ç¨‹æŠ€æœ¯ä»‹ç»" class="headerlink" title="è¶…çº¿ç¨‹æŠ€æœ¯ä»‹ç»"></a>è¶…çº¿ç¨‹æŠ€æœ¯ä»‹ç»</h1><p>è¶…çº¿ç¨‹æ˜¯ä¸€ç§è®¡ç®—æœºå¤„ç†å™¨æŠ€æœ¯ï¼Œèƒ½å¤Ÿå°†ä¸€ä¸ªç‰©ç†å¤„ç†å™¨å˜æˆä¸¤ä¸ªè™šæ‹Ÿå¤„ç†å™¨ã€‚è¿™ç§æ–¹å¼èƒ½å¤Ÿæå‡å¤„ç†å™¨æ ¸å¿ƒçš„æŒ‡ä»¤é˜Ÿåˆ—å·¥ä½œæ•ˆç‡ï¼Œä»è€Œæé«˜å¤„ç†å™¨çš„æ•´ä½“æ€§èƒ½è¡¨ç°ï¼Œæ­¤å¤–è™šæ‹ŸåŒ–æŠ€æœ¯ä¹Ÿèƒ½å¤Ÿå—ç›Šäºè¿™ç§æŠ€æœ¯ã€‚è¿™ç§æŠ€æœ¯å…è®¸hypervisorä¸ºè™šæ‹Ÿæœºæä¾›ä¹‹å‰ä¸¤å€çš„è™šæ‹Ÿå¤„ç†å™¨æ•°é‡â€”â€”ä½†æ˜¯è¶…çº¿ç¨‹æŠ€æœ¯å¹¶ä¸æ˜¯å®Œç¾çš„ã€‚å¦‚æœä½¿ç”¨è¶…çº¿ç¨‹æŠ€æœ¯ï¼Œé‚£ä¹ˆæ•ˆç‡ä½ä¸‹ã€è´¨é‡ä¸ä½³çš„ä»£ç ç”šè‡³æ˜¯åˆ†é…ä¸å½“çš„è´Ÿè½½éƒ½æœ‰å¯èƒ½å¯¹ç³»ç»Ÿæ€§èƒ½é€ æˆè´Ÿé¢å½±å“ã€‚</p>
<p>è¶…çº¿ç¨‹æ˜¯è‹±ç‰¹å°”å…¬å¸çš„ç§æœ‰æŠ€æœ¯ï¼Œå…¶èƒ½å¤Ÿå¸®åŠ©æå‡ç‰©ç†å¤„ç†å™¨çš„èµ„æºä½¿ç”¨æ•ˆç‡ï¼Œä¿è¯å¤„ç†å™¨ä¸€ç›´å¤„äºç¹å¿™çŠ¶æ€ï¼Œä»¥ä¾¿å®Œæˆæ›´å¤šå·¥ä½œã€‚</p>
<p>è¶…çº¿ç¨‹æŠ€æœ¯â€”â€”ä¹Ÿè¢«ç§°ä¸º<code>HTT</code>æˆ–<code>HT</code>â€”â€”çš„å‡ºç°æ˜¯ç”±äºä¼ ç»Ÿç‰©ç†æœåŠ¡å™¨æ ¸å¿ƒåœ¨åŒä¸€æ—¶é—´åªèƒ½å¤„ç†ä¸€é¡¹ä»»åŠ¡ã€‚æ‰€æœ‰è´Ÿè½½éƒ½éœ€è¦ä½¿ç”¨å¤„ç†å™¨çš„æŒ‡ä»¤é€šé“ï¼Œä½†æ˜¯é€šå¸¸æŒ‡ä»¤é€šé“çš„ä½¿ç”¨ç‡å¹¶ä¸ä¼šè¾¾åˆ°100%æˆ–è€…ä¸€ç›´å¤„äºç¹å¿™çŠ¶æ€ã€‚é€ æˆè¿™ç§ç°è±¡çš„éƒ¨åˆ†åŸå› åœ¨äºåº”ç”¨ç¨‹åºçš„ç¼–ç å’Œè¿è¡Œæ–¹å¼ä¸åŒï¼Œæ­¤å¤–ï¼Œç”±äºç°ä»£å¤„ç†å™¨çš„è¿è¡Œé€Ÿåº¦è¶Šæ¥è¶Šå¿«ï¼Œå·²ç»å®Œå…¨è¶…å‡ºè®¸å¤šåº”ç”¨ç¨‹åºçš„éœ€æ±‚ï¼Œå› æ­¤è¢«æµªè´¹çš„å¤„ç†å™¨å‘¨æœŸè¶Šæ¥è¶Šå¤šã€‚</p>
<p>è¶…çº¿ç¨‹æŠ€æœ¯åœ¨å¤„ç†å™¨æ ¸å¿ƒä¸­æ·»åŠ äº†æ–°çš„ç”µè·¯ï¼Œèƒ½å¤Ÿæä¾›é¢å¤–çš„æŒ‡ä»¤é€šé“æ¥å…±äº«ç‰©ç†å¤„ç†å™¨çš„æ‰§è¡Œèµ„æºï¼Œæ¯”å¦‚å†…å­˜æ€»çº¿ã€å¤„ç†å™¨ç¼“å­˜ä»¥åŠå¤„ç†å™¨çš„æ‰§è¡Œå¼•æ“ã€‚å¢åŠ çš„è¶…çº¿ç¨‹ç”µè·¯èƒ½å¤Ÿå°†ç‰©ç†æ ¸å¿ƒåˆ†å‰²æˆä¸¤ä¸ªé€»è¾‘æ ¸å¿ƒã€‚åœ¨å¯ç”¨è¶…çº¿ç¨‹æŠ€æœ¯ä¹‹åï¼Œæ¯ä¸ªé€»è¾‘å¤„ç†å™¨éƒ½ç›¸äº’ç‹¬ç«‹ï¼Œä¸­æ–­ã€åœæ­¢å’Œæ“ä½œéƒ½ç‹¬ç«‹äºå¦å¤–ä¸€ä¸ªå…±äº«ç›¸åŒç‰©ç†æ ¸å¿ƒçš„è™šæ‹Ÿå¤„ç†å™¨ã€‚å½“æŸä¸ªé€»è¾‘æ ¸å¿ƒç©ºé—²æ—¶ï¼Œå¦å¤–ä¸€ä¸ªé€»è¾‘æ ¸å¿ƒå°†ä¼šå¾—åˆ°æ›´å¤šçš„æ‰§è¡Œèµ„æºã€‚</p>
<p>å…³äºè¶…çº¿ç¨‹æŠ€æœ¯éœ€è¦è®°ä½çš„é‡è¦ä¸€ç‚¹æ˜¯åœ¨ç›¸åŒç‰©ç†æ ¸å¿ƒä¸Šå¯ç”¨ç¬¬äºŒä¸ªé€»è¾‘å¤„ç†å™¨å¹¶ä¸ä¼šä½¿å¾—å¤„ç†å™¨çš„æ€§èƒ½æå‡ä¸€å€ã€‚è¿™æ˜¯å› ä¸ºå¤„ç†å™¨çš„æ‰§è¡Œèµ„æºæ˜¯å…±äº«çš„ï¼Œå¹¶æ²¡æœ‰ç¿»å€ã€‚HTTæŠ€æœ¯å…è®¸å¤„ç†å™¨åœ¨ç‰¹å®šæ—¶é—´å†…å¤„ç†æ›´å¤šçš„ä»»åŠ¡æˆ–è€…æŒ‡ä»¤çº¿ç¨‹ï¼Œä½†æ˜¯ä»ç„¶éœ€è¦ä½¿ç”¨åŸæœ‰çš„ç‰©ç†èµ„æºå®Œæˆè¿™äº›ä»»åŠ¡ã€‚è¿™æ˜¯è¶…çº¿ç¨‹æ¶æ„å’Œå¤šæ ¸å¤„ç†å™¨â€”â€”æ¯”å¦‚åŒæ ¸æˆ–è€…å››æ ¸â€”â€”çš„æœ€å¤§åŒºåˆ«ï¼Œå¤šæ ¸æŠ€æœ¯æ‹¥æœ‰å¤šä¸ªç‰©ç†å¤„ç†å™¨ã€‚</p>
<p>è€Œè™šæ‹Ÿå¤„ç†å™¨çš„æ€§èƒ½æå‡å¹…åº¦å–å†³äºè´Ÿè½½å¯¹äºå¤„ç†å™¨çš„èµ„æºéœ€æ±‚ä»¥åŠæ“ä½œç³»ç»Ÿç®¡ç†å’Œè§„åˆ’é€»è¾‘å¤„ç†å™¨çš„èƒ½åŠ›ã€‚å¦‚æœè¶…çº¿ç¨‹æŠ€æœ¯ä¸èƒ½è¯†åˆ«æ“ä½œç³»ç»Ÿï¼Œå°±ä¼šä½¿ç”¨åŒæ ·çš„æ–¹å¼ç®¡ç†æ‰€æœ‰é€»è¾‘å¤„ç†å™¨ï¼Œå¯èƒ½ä¼šå°†èµ„æºéœ€æ±‚å¾ˆå¤§çš„è´Ÿè½½æ”¾åœ¨ç›¸åŒæ ¸å¿ƒçš„é€»è¾‘å¤„ç†å™¨ä¸Šâ€”â€”è¿™æ ·ä¼šå¯¹åº”ç”¨ç¨‹åºçš„æ€§èƒ½è¡¨ç°é€ æˆè´Ÿé¢å½±å“â€”â€”è€ŒåŒæ—¶å…¶ä»–æ ¸å¿ƒå¹¶æ²¡æœ‰å¾—åˆ°å……åˆ†åˆ©ç”¨ã€‚ä¸æ­¤å½¢æˆå¯¹æ¯”çš„æ˜¯ï¼Œèƒ½å¤Ÿè¯†åˆ«æ“ä½œç³»ç»Ÿçš„è¶…çº¿ç¨‹æŠ€æœ¯å¯ä»¥å°†çº¿ç¨‹åˆ†é…åˆ°ä¸åŒçš„å¤„ç†å™¨ä¸Šï¼Œæœ€å¤§ç¨‹åº¦ä¸Šæå‡è´Ÿè½½çš„æ€§èƒ½è¡¨ç°ã€‚</p>
<p>æ¯”å¦‚ï¼Œå¦‚æœæŸä¸ªåº”ç”¨ç¨‹åºéœ€è¦ä½¿ç”¨å¤§é‡å¤„ç†å™¨èµ„æºï¼Œå°±ä¼šä¸€ç›´å ç”¨æŒ‡ä»¤é˜Ÿåˆ—ï¼Œé‚£ä¹ˆå³ä¾¿åŒä¸€ä¸ªç‰©ç†å¤„ç†å™¨æ ¸å¿ƒæä¾›é¢å¤–çš„é€»è¾‘å¤„ç†å™¨ä¹Ÿæ— æµäºäº‹â€”â€”å› ä¸ºç‰©ç†å¤„ç†å™¨å·²ç»æ²¡æœ‰é¢å¤–çš„èµ„æºå¯ä»¥å…±äº«ã€‚æ“ä½œç³»ç»Ÿå¯ä»¥å°†ç¬¬äºŒä¸ªçº¿ç¨‹åŠ å…¥åˆ°å¤„ç†é˜Ÿåˆ—ä¸­ï¼Œä½†æ˜¯é€šå¸¸å…¶æ€§èƒ½è¡¨ç°ä¼šéå¸¸å·®ï¼Œæ­¤å¤–ï¼Œç”±äºå…¶ä¼šå ç”¨å½“å‰è¿è¡Œçº¿ç¨‹çš„å¤„ç†å™¨å‘¨æœŸï¼Œå› æ­¤è¿˜ä¼šå¯¼è‡´ç°æœ‰åº”ç”¨ç¨‹åºæ€§èƒ½å—åˆ°å½±å“ã€‚Hypervisoræˆ–è€…æ“ä½œç³»ç»Ÿåº”è¯¥èƒ½å¤Ÿè¯†åˆ«HTTï¼Œå¹¶ä¸”æœ€å¤§ç¨‹åº¦ä¸Šæå‡è´Ÿè½½å¯¹äºç‰©ç†å¤„ç†å™¨çš„ä½¿ç”¨æ•ˆç‡ï¼Œè¿™äº›éƒ½æ˜¯åˆ†é…é€»è¾‘å¤„ç†å™¨çš„å‰æã€‚å¦‚æœè¿™ä¸ªå‰æä¸èƒ½å®ç°ï¼Œé‚£ä¹ˆè¶…çº¿ç¨‹ï¼ˆå¹¶éè™šæ‹ŸåŒ–ï¼‰åŠŸèƒ½åº”è¯¥è¢«ç¦ç”¨ã€‚</p>
<p>ä»hypervisorç³»ç»Ÿè§’åº¦æ¥çœ‹ï¼Œè¶…çº¿ç¨‹å¹¶ä¸æ˜¯è™šæ‹ŸåŒ–æŠ€æœ¯â€”â€”HTTåªæ˜¯ä¸€ç§ä½äºå¤„ç†å™¨ç¡¬ä»¶å±‚ã€ä»¥ç¡¬ä»¶ä¸ºåŸºç¡€çš„è™šæ‹ŸåŒ–æŠ€æœ¯ã€‚è€Œè™šæ‹ŸåŒ–å’Œhypervisorèƒ½å¤Ÿå¸¦æ¥å“ªäº›å¥½å¤„ï¼Ÿè¶…çº¿ç¨‹å’Œhypervisorä¹‹é—´å¹¶æ²¡æœ‰ç›´æ¥çš„å…³è”ã€‚Hypervisorèƒ½å¤Ÿå·¥ä½œåœ¨ä¸æ”¯æŒè¶…çº¿ç¨‹æŠ€æœ¯çš„ç‰©ç†å¤„ç†å™¨ä¸Šï¼Œè€Œæ”¯æŒè¶…çº¿ç¨‹çš„å¤„ç†å™¨ä¹Ÿå¯ä»¥ä½¿ç”¨éè™šæ‹ŸåŒ–ç³»ç»Ÿã€‚ä½†æ˜¯è¿™ä¸¤ç§æ–¹æ¡ˆå¯ä»¥ç›¸äº’è¡¥å……ï¼Œè€ŒåƒVMware vSphereè¿™æ ·çš„ç°ä»£hypervisoråœ¨åˆ›å»ºèµ„æºæ± å¹¶ä¸”å°†è™šæ‹ŸCPUåˆ†é…ç»™è™šæ‹Ÿæœºæ—¶å·²ç»èƒ½å¤Ÿè¯†åˆ«å¹¶ä¸”ä½¿ç”¨è¶…çº¿ç¨‹æŠ€æœ¯ã€‚è¿™ç§æ–¹å¼èƒ½å¤Ÿåœ¨ç»„ç»‡å’Œè®¡åˆ’ä»»åŠ¡æ–¹é¢ä¸ºhypervisoræä¾›æ›´å¤šçš„çµæ´»æ€§ï¼Œå› æ­¤èƒ½å¤Ÿæå‡è™šæ‹ŸæœåŠ¡å™¨çš„å·¥ä½œæ•ˆç‡ã€‚</p>
<p>å‚è€ƒæ–‡æ¡£: <a href="http://tech.idcquan.com/XuNi/101649.shtml" target="_blank" rel="noopener">è¶…çº¿ç¨‹æŠ€æœ¯ä¼˜ç¼ºç‚¹åˆ†æ</a></p>
<hr>
<h1 id="è¶…çº¿ç¨‹åœ¨ææ ‘æ—çš„åº”ç”¨"><a href="#è¶…çº¿ç¨‹åœ¨ææ ‘æ—çš„åº”ç”¨" class="headerlink" title="è¶…çº¿ç¨‹åœ¨ææ ‘æ—çš„åº”ç”¨"></a>è¶…çº¿ç¨‹åœ¨ææ ‘æ—çš„åº”ç”¨</h1><p>åœ¨ææ ‘æ—çš„è‡ªæœ‰æœºæˆ¿ä¸­, éƒ¨åˆ†æœåŠ¡å™¨å¼€å¯äº†è¶…çº¿ç¨‹åŠŸèƒ½, 2U6æ ¸å¿ƒçš„ R420æœåŠ¡å™¨å¼€å¯è¶…çº¿ç¨‹å, æ ¸å¿ƒæ•°é‡ç¿»äº†ä¸€ç•ªè¾¾åˆ°äº†24é¢—æ ¸å¿ƒ</p>
<p>è¯¥æœåŠ¡å™¨ç”¨åœ¨è™šæ‹ŸåŒ– hypervisor æŠ€æœ¯ä¹‹ä¸Š, ç”±äºç£ç›˜æ˜¯ SAS 7.2K çš„ä½æ€§èƒ½ç¡¬ç›˜, io å‡ ä¹æˆäº†è¯¥æœåŠ¡å™¨çš„ç»å¯¹ç“¶é¢ˆ, hypervisor ä¸­çš„å®¢æˆ·æœºåœ¨æ‰§è¡Œé¢‘ç¹çš„ IO æ“ä½œæ—¶, å¤§é‡çš„ IO wait äº§ç”Ÿ, æ‹–æ…¢äº†æ•´ä¸ªæœåŠ¡å™¨çš„æ€§èƒ½</p>
<p>è¶…çº¿ç¨‹åœ¨è¿™ç§ä½¿ç”¨åœºæ™¯ä¸‹æœ‰ç€å¾ˆå¤§çš„ä¼˜åŠ¿, å› ä¸º CPU çš„æ—¶é’Ÿå‘¨æœŸè¢«ä¸¥é‡æ‹–æ…¢, ç»å¤§éƒ¨åˆ†çš„ CPU åœ¨ç­‰å¾… IO æ“ä½œçš„å®Œæˆ, åœ¨ä½¿ç”¨äº†è¶…çº¿ç¨‹æŠ€æœ¯ä¹‹å, æ¯ä¸ª CPU æ ¸å¿ƒè¢«æ°æˆäº†ä¸¤åŠå„¿, ä¸€ä¸ªæ ¸å¿ƒå¯ä»¥å½“æˆä¸¤ä¸ªæ ¸å¿ƒæ¥ç”¨</p>
<p>ä¸Šå­¦çš„æ—¶å€™, è€å¸ˆåå¤å¼ºè°ƒ, å•é¢—æ ¸å¿ƒåœ¨åŒä¸€æ—¶é—´åªèƒ½å¤„ç†ä¸€ä¸ªä»»åŠ¡. å•æ ¸å¿ƒçš„ CPU ä¹‹æ‰€ä»¥æ”¯æŒå¤šä»»åŠ¡å¤„ç†, æ˜¯å› ä¸ºä¸€é¢—æ ¸å¿ƒåå¤çš„åœ¨å„ä¸ªè¿›ç¨‹ä¸­åˆ‡æ¢, ä¸ºæ¯ä¸ªè¿›ç¨‹åˆ†é…CPU çš„è®¡ç®—èµ„æº. ä¹‹æ‰€ä»¥æˆ‘ä»¬è®¤ä¸ºæ‰€æœ‰çš„è¿›ç¨‹åœ¨åŒæ—¶å·¥ä½œ, æ˜¯å› ä¸º CPU çš„åˆ‡æ¢é€Ÿåº¦æå¿«, å¿«åˆ°äººæ„Ÿè§‰ä¸åˆ°ä¸­é—´çš„æ–­ç‚¹. å¦‚æœæˆ‘ä»¬å¬ç€éŸ³ä¹æ‰“å¼€äº†ä¸€ä¸ªé‡ CPU è®¡ç®—å‹çš„åº”ç”¨, é‚£ä¹ˆéŸ³ä¹å°±å¯èƒ½äº§ç”Ÿå¡é¡¿çš„ç°è±¡.</p>
<p>ä¸Šé¢è¿™ä¸ªæ•…äº‹, å¦‚æœè¿˜æ˜¯ä¸€é¢—æ ¸å¿ƒ, å¦‚æœä»–å¼€å¯äº†è‹±ç‰¹å°”çš„è¶…çº¿ç¨‹æŠ€æœ¯çš„è¯, éŸ³ä¹å°±ä¸ä¼šè¢«å¡é¡¿, å› ä¸ºåœ¨ç¨‹åºçš„è§’åº¦æ¥çœ‹, çœ‹åˆ°çš„æ˜¯ä¸¤é¢—æ ¸å¿ƒ, åŒæ—¶å¼€å¯ä¸¤ä¸ªåº”ç”¨çš„è¯, æ¯ä¸ªè¿›ç¨‹éƒ½ä¼šè¢«åˆ†é…ä¸€é¢—æ ¸å¿ƒ, å½“é‡ CPU è®¡ç®—å‹çš„è¿›ç¨‹è¢«å¼€å¯å, ä»ç„¶å¯ä»¥ä¿è¯æœ‰ä¸€ä¸ªè™šæ‹Ÿçš„CPU åˆ†é…äº†ä¸€å®šçš„è®¡ç®—èµ„æºç»™éŸ³ä¹è¿›ç¨‹</p>
<p>ä»¥ä¸Šæ˜¯åœ¨é‡ CPU è®¡ç®—å‹çš„åœºæ™¯ä¸­,çªç ´äº†åŒä¸€é¢—æ ¸å¿ƒåœ¨åŒä¸€æ—¶é—´åªèƒ½å¤„ç†ä¸€ä¸ªä»»åŠ¡çš„é™åˆ¶</p>
<p>è¿˜æœ‰ä¸€ç§æ›´æœ‰ä»·å€¼çš„ç”¨æ³•å°±æ˜¯é‡ IO æ“ä½œçš„åœºæ™¯ä¸‹, æå¤§çš„å‘æŒ¥ CPU çš„æ€§èƒ½. æ‹¿å›æœ€å¼€å§‹æˆ‘ä»¬æœºæˆ¿è™šæ‹ŸåŒ–çš„ä¾‹å­, ç£ç›˜é¢‘ç¹çš„å‡ºç° IO ç­‰å¾…, æ¯é¢— CPU ç”±äºåŒä¸€æ—¶é—´åªèƒ½å¤„ç†ä¸€ä¸ªä»»åŠ¡, è€Œå¯¼è‡´æ¯ä¸ª CPU æ ¸å¿ƒçš„ä½¿ç”¨ç‡æå…¶ä½ä¸‹, ä½†æ˜¯ä¸€æ—¦å¼€å¯äº†è¶…çº¿ç¨‹æŠ€æœ¯, CPU çš„å¯åˆ©ç”¨èµ„æºç«‹åˆ»ç¿»äº†ä¸€ç•ª, å¯ä»¥æŠµæ¶ˆä¸€äº›ç”±äºé‡ IO æ“ä½œè€Œè¢«å½±å“äº†çš„å…¶ä»–åº”ç”¨æ€§èƒ½çš„å½±å“</p>
<p>æœ€åæˆ‘ä»¬ä¸¾ä¸ªåä¾‹:</p>
<p>å‡å¦‚æŸä¸ªåº”ç”¨æ˜¯è®¡ç®—å¯†é›†å‹åº”ç”¨, åªä¼šäº§ç”Ÿè¾ƒå°‘çš„ IO æ“ä½œ, ä¸”è¿™ç‚¹ IO æ“ä½œè¢«æ”¾åˆ°äº†å†…å­˜æ˜ å°„å‡ºæ¥çš„â€ç£ç›˜â€ä¸Š, å®ç°äº†é›¶ IO, è¿™ç§åº”ç”¨å¦‚æœå¼€å¯äº†è¶…çº¿ç¨‹åè€Œä¼šæå¤§çš„æ‹–æ…¢æ•´ä¸ªæœåŠ¡å™¨çš„æ€§èƒ½. å› ä¸ºè¿™ç§è®¡ç®—å¯†é›†å‹çš„åº”ç”¨, å³ä½¿ä¸å¼€å¯è¶…çº¿ç¨‹, å•é¢—æ ¸å¿ƒçš„åˆ©ç”¨ç‡ä¹Ÿèƒ½è¾¾åˆ°90%ä»¥ä¸Š, è€Œå¼€å¯äº†è¶…çº¿ç¨‹ä¹‹å, ç¨‹åºå®é™…æœ€å¤§åªèƒ½ç”¨åˆ°å•é¢—æ ¸å¿ƒçš„50%, æ­¤æ—¶æ‰€æœ‰çš„è™šæ‹Ÿæ ¸å¿ƒå…¨éƒ¨è¢«æ‰“æ»¡, è€Œä¸”äº’ç›¸å¾ç”¨èµ„æº, å¯¼è‡´ç¡¬ä»¶å’Œç³»ç»Ÿå»ç»´æŠ¤å’Œè°ƒå’Œè¿™äº›èµ„æºå¾ç”¨è€—è´¹äº†å¤§é‡çš„èµ„æº, åè€Œæ‹–æ…¢äº†æ•´ä½“æ€§èƒ½</p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>å¦‚æœä½ ä¸ç¡®å®šæ€ä¹ˆä½¿ç”¨è¶…çº¿ç¨‹æŠ€æœ¯, å¯ä»¥ç®€å•çš„ç”¨ä»¥ä¸‹æ–¹å¼åˆ¤æ–­</p>
<p><code>åœ¨ä¸å¼€å¯è¶…çº¿ç¨‹çš„æƒ…å†µä¸‹, å¦‚æœä½ çš„åº”ç”¨æ¯é¢— CPU æ ¸å¿ƒçš„ä½¿ç”¨ç‡éƒ½è¶…è¿‡äº†50% (æˆ–æ˜¯è¯´å°†è¿‘50%) é‚£å°±ä¸è¦å†å¼€å¯è¶…çº¿ç¨‹äº†</code></p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>è¶…çº¿ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title>æ›´æ”¹-è®¾ç½®MySQLç”¨æˆ·å¯†ç </title>
    <url>/2016/12/12/%E6%9B%B4%E6%94%B9-%E8%AE%BE%E7%BD%AEMySQL%E7%94%A8%E6%88%B7%E5%AF%86%E7%A0%81/</url>
    <content><![CDATA[<h1 id="ç®¡ç†ç»™è‡ªå·±è®¾ç½®å¯†ç "><a href="#ç®¡ç†ç»™è‡ªå·±è®¾ç½®å¯†ç " class="headerlink" title="ç®¡ç†ç»™è‡ªå·±è®¾ç½®å¯†ç "></a>ç®¡ç†ç»™è‡ªå·±è®¾ç½®å¯†ç </h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; mysql -u root</span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="code"><pre><span class="line">mysql&gt; SET PASSWORD = PASSWORD('123456');</span><br></pre></td></tr></table></figure>

<h1 id="ç®¡ç†å‘˜æˆ–è€…æœ‰å…¨å±€æƒé™çš„ç”¨æˆ·é‡è®¾å…¶å®ƒç”¨æˆ·çš„å¯†ç "><a href="#ç®¡ç†å‘˜æˆ–è€…æœ‰å…¨å±€æƒé™çš„ç”¨æˆ·é‡è®¾å…¶å®ƒç”¨æˆ·çš„å¯†ç " class="headerlink" title="ç®¡ç†å‘˜æˆ–è€…æœ‰å…¨å±€æƒé™çš„ç”¨æˆ·é‡è®¾å…¶å®ƒç”¨æˆ·çš„å¯†ç "></a>ç®¡ç†å‘˜æˆ–è€…æœ‰å…¨å±€æƒé™çš„ç”¨æˆ·é‡è®¾å…¶å®ƒç”¨æˆ·çš„å¯†ç </h1><h2 id="æ–¹æ³•ä¸€"><a href="#æ–¹æ³•ä¸€" class="headerlink" title="æ–¹æ³•ä¸€"></a>æ–¹æ³•ä¸€</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; mysql -u root -p</span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="code"><pre><span class="line">mysql&gt; use mysql;</span><br><span class="line">mysql&gt; UPDATE user SET password=PASSWORD("new password") WHERE user='username';</span><br><span class="line">mysql&gt; FLUSH PRIVILEGES;</span><br><span class="line">mysql&gt; exit</span><br></pre></td></tr></table></figure>

<h2 id="æ–¹æ³•äºŒ"><a href="#æ–¹æ³•äºŒ" class="headerlink" title="æ–¹æ³•äºŒ"></a>æ–¹æ³•äºŒ</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; mysql -u root -p</span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="code"><pre><span class="line">mysql&gt; use mysql; </span><br><span class="line">mysql&gt; SET PASSWORD FOR username=PASSWORD('new password');</span><br><span class="line">mysql&gt; exit</span><br></pre></td></tr></table></figure>

<h2 id="æ–¹æ³•ä¸‰"><a href="#æ–¹æ³•ä¸‰" class="headerlink" title="æ–¹æ³•ä¸‰"></a>æ–¹æ³•ä¸‰</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mysqladmin -u root <span class="string">"old password"</span> <span class="string">"new password"</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL5.6äºŒè¿›åˆ¶åŒ…éƒ¨ç½²</title>
    <url>/2016/12/12/MySQL5-6%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85%E9%83%A8%E7%BD%B2/</url>
    <content><![CDATA[<h1 id="ä¸‹è½½ç¼–è¯‘mysql"><a href="#ä¸‹è½½ç¼–è¯‘mysql" class="headerlink" title="ä¸‹è½½ç¼–è¯‘mysql"></a>ä¸‹è½½ç¼–è¯‘mysql</h1><p>ç•¥ (è¯·åœ¨ MySQL å®˜ç½‘ä¸‹è½½ tar.gz çš„ source æºç åŒ…)</p>
<p>å®˜ç½‘5.6 ä¸‹è½½åœ°å€: <a href="http://dev.mysql.com/downloads/mysql/5.6.html#downloads" target="_blank" rel="noopener">http://dev.mysql.com/downloads/mysql/5.6.html#downloads</a></p>
<p><em>ç¼–è¯‘å‚æ•°ä¼šåœ¨å…¶ä»–æ–‡ç« ä¸­è¯¦ç»†è®²è§£</em></p>
<h1 id="å¸è½½æ—§ç‰ˆæœ¬"><a href="#å¸è½½æ—§ç‰ˆæœ¬" class="headerlink" title="å¸è½½æ—§ç‰ˆæœ¬"></a>å¸è½½æ—§ç‰ˆæœ¬</h1><p>ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ£€æŸ¥æ˜¯å¦å®‰è£…æœ‰MySQL Server</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; rpm -qa | grep mysql</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; rpm -e mysql <span class="comment">#æ™®é€šåˆ é™¤æ¨¡å¼ </span></span><br><span class="line">&gt; rpm -e --nodeps mysql <span class="comment"># å¼ºåŠ›åˆ é™¤æ¨¡å¼ï¼Œå¦‚æœä½¿ç”¨ä¸Šé¢å‘½ä»¤åˆ é™¤æ—¶ï¼Œæç¤ºæœ‰ä¾èµ–çš„å…¶å®ƒæ–‡ä»¶ï¼Œåˆ™ç”¨è¯¥å‘½ä»¤å¯ä»¥å¯¹å…¶è¿›è¡Œå¼ºåŠ›åˆ é™¤</span></span><br><span class="line">&gt; yum remove mysql <span class="comment">#åˆ é™¤ä¾èµ–çš„æ–‡ä»¶</span></span><br></pre></td></tr></table></figure>

<h1 id="å®‰è£…mysqlå¹¶åˆå§‹åŒ–"><a href="#å®‰è£…mysqlå¹¶åˆå§‹åŒ–" class="headerlink" title="å®‰è£…mysqlå¹¶åˆå§‹åŒ–"></a>å®‰è£…mysqlå¹¶åˆå§‹åŒ–</h1><p>æŠŠä¸‹è½½å¥½çš„mysqläºŒè¿›åˆ¶åŒ…æ”¾åœ¨ <code>/usr/local/</code> ä¸‹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; useradd mysql</span><br><span class="line">&gt; mv /etc/my.cnf /etc/my.conf.d /tmp</span><br><span class="line">&gt; mkdir -p /data/mysql</span><br><span class="line">&gt; chown mysql:mysql /data/mysql</span><br><span class="line">&gt; <span class="built_in">cd</span> /usr/<span class="built_in">local</span>/</span><br><span class="line">&gt; tar -xvzf mysql.tar.gz</span><br><span class="line">&gt; chown -R mysql:mysql /usr/<span class="built_in">local</span>/mysql</span><br><span class="line">&gt; <span class="built_in">cd</span> /usr/<span class="built_in">local</span>/mysql</span><br><span class="line">&gt; scripts/mysql_install_db --basedir=/usr/<span class="built_in">local</span>/mysql --datadir=/data/mysql --user=mysql</span><br></pre></td></tr></table></figure>

<h1 id="å¯åŠ¨mysql"><a href="#å¯åŠ¨mysql" class="headerlink" title="å¯åŠ¨mysql"></a>å¯åŠ¨mysql</h1><h2 id="åˆ›å»ºmysqlé…ç½®æ–‡ä»¶"><a href="#åˆ›å»ºmysqlé…ç½®æ–‡ä»¶" class="headerlink" title="åˆ›å»ºmysqlé…ç½®æ–‡ä»¶"></a>åˆ›å»ºmysqlé…ç½®æ–‡ä»¶</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; vim /etc/my.cnf</span><br><span class="line">ç•¥</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; chown mysql:mysql /etc/my.cnf</span><br></pre></td></tr></table></figure>

<h2 id="æ‹·è´mysqlå¯åŠ¨å‘½ä»¤"><a href="#æ‹·è´mysqlå¯åŠ¨å‘½ä»¤" class="headerlink" title="æ‹·è´mysqlå¯åŠ¨å‘½ä»¤"></a>æ‹·è´mysqlå¯åŠ¨å‘½ä»¤</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; cp support-files/mysql.server /etc/init.d/mysqld</span><br><span class="line">&gt; vim /etc/init.d/mysqld</span><br><span class="line">basedir=/usr/<span class="built_in">local</span>/mysql</span><br><span class="line">datadir=/data/mysql</span><br><span class="line">&gt; chkconfig mysqld on </span><br><span class="line">&gt; service mysqld start</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œä¸€å®šè¦æ³¨æ„ï¼Œè™½ç„¶æ˜¯åœ¨CentOS7ç³»åˆ—ä¸Šå®‰è£…ï¼ŒCentOS7é»˜è®¤ä½¿ç”¨systemctlç®¡ç†ç¨‹åºçš„å¯åŠ¨ä¸å…³é—­ï¼Œä½†æ˜¯mysql5.6æä¾›çš„è„šæœ¬æ˜¯ä½¿ç”¨serviceæ§åˆ¶ç¨‹åºå¯åŠ¨ä¸å…³é—­çš„è„šæœ¬ï¼Œæ‰€ä»¥éœ€è¦æ”¾åœ¨<code>/etc/init.d/</code>ä¸‹ï¼Œä½¿ç”¨serviceçš„æ–¹å¼å¯åŠ¨</p>
<h1 id="è¿›å…¥mysql"><a href="#è¿›å…¥mysql" class="headerlink" title="è¿›å…¥mysql"></a>è¿›å…¥mysql</h1><p>è¿›å…¥mysqlä¼šç¢°åˆ°ç¯å¢ƒå˜é‡çš„é—®é¢˜ï¼Œæ‰¾ä¸åˆ°mysqlçš„æ‰§è¡Œæ–‡ä»¶</p>
<p>MySQLå¯åŠ¨æˆåŠŸåï¼Œrooté»˜è®¤æ²¡æœ‰å¯†ç ï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½®rootå¯†ç ã€‚<br>è®¾ç½®ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆè®¾ç½®PATHï¼Œè¦ä¸ä¸èƒ½ç›´æ¥è°ƒç”¨mysql<br>ä¿®æ”¹/etc/profileæ–‡ä»¶ï¼Œåœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt; vim &#x2F;etc&#x2F;profile</span><br><span class="line">PATH&#x3D;&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;bin:$PATH</span><br><span class="line">export PATH</span><br></pre></td></tr></table></figure>

<p>å…³é—­æ–‡ä»¶ï¼Œè¿è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œè®©é…ç½®ç«‹å³ç”Ÿæ•ˆ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">source &#x2F;etc&#x2F;profile</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç»ˆç«¯å†…ç›´æ¥è¾“å…¥mysqlè¿›å…¥ï¼Œmysqlçš„ç¯å¢ƒäº†<br>æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ä¿®æ”¹rootå¯†ç </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql -uroot </span><br><span class="line">mysql&gt; SET PASSWORD &#x3D; PASSWORD(&#39;123456&#39;);</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>Linuxä¸­ä½¿ç”¨ShadowSocks+Privoxyä»£ç†</title>
    <url>/2016/12/12/Linux%E4%B8%AD%E4%BD%BF%E7%94%A8ShadowSocks-Privoxy%E4%BB%A3%E7%90%86/</url>
    <content><![CDATA[<blockquote>
<p>ShadowSocks æœ€è¿‘å‡ å¹´å¤§ç«, å…¶ç®€å•çš„é…ç½®å’Œä¼˜ç§€çš„é€Ÿåº¦è®©å¤§é™†åœ°åŒºçš„å¢™å†…ç”¨æˆ·çˆ±ä¸é‡Šæ‰‹<br>æœ¬ç¯‡æ–‡ç« ä¸è®¨è®ºMac &amp; Windows ç­‰å›¾å½¢ç•Œé¢ä¸‹çš„åº”ç”¨, è€Œæ˜¯è®© linux åœ¨å‘½ä»¤è¡Œç•Œé¢ä¸‹, http/https è®¿é—®ä¹Ÿèƒ½ç™»ä¸Šæ¢¯å­, çœ‹ä¸€çœ‹å¤–é¢çš„å¤§åƒä¸–ç•Œ</p>
</blockquote>
<p>æœ€è¿‘å…¬å¸çš„æœåŠ¡å™¨è¿æ¥ docker hub <a href="http://hub.docker.com" target="_blank" rel="noopener">hub.docker.com</a> ä»“åº“å’Œ node.js <a href="http://nodejs.org" target="_blank" rel="noopener">nodejs.org</a> ä»“åº“æå…¶ç¼“æ…¢, ä½¿ç”¨äº†å„ç§å›½å†…çš„å„ç§åŠ é€ŸæœåŠ¡æ‰å‹‰å¼ºè§£å†³äº†ç‡ƒçœ‰ä¹‹æ€¥(åˆ†åˆ«ä½¿ç”¨äº† daocloud çš„é•œåƒåŠ é€Ÿå’Œæ·˜å®çš„åŠ é€ŸæœåŠ¡)</p>
<p>æœ¬ç¯‡æ–‡ç« å°±æ˜¯ä»‹ç»å¦‚ä½•å®ç° Linux ä¸­çš„ http/https è¯·æ±‚ç¿»å¢™çš„éœ€æ±‚</p>
<h1 id="å®‰è£…-ss-å®¢æˆ·ç«¯"><a href="#å®‰è£…-ss-å®¢æˆ·ç«¯" class="headerlink" title="å®‰è£… ss å®¢æˆ·ç«¯"></a>å®‰è£… ss å®¢æˆ·ç«¯</h1><p><em>shadowsockså®‰è£…æ—¶æ˜¯ä¸åˆ†å®¢æˆ·ç«¯è¿˜æ˜¯æœåŠ¡å™¨ç«¯çš„, åªä¸è¿‡å®‰è£…åæœ‰ä¸¤ä¸ªè„šæœ¬ä¸€ä¸ªæ˜¯sslocalä»£è¡¨ä»¥å®¢æˆ·ç«¯æ¨¡å¼å·¥ä½œï¼Œä¸€ä¸ªæ˜¯ssserverä»£è¡¨ä»¥æœåŠ¡å™¨ç«¯æ¨¡å¼å·¥ä½œ</em></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; yum install python-pip</span><br><span class="line">&gt; pip install shadowsocks</span><br></pre></td></tr></table></figure>

<h2 id="åœ¨åå°å¯åŠ¨-ss-å®¢æˆ·ç«¯"><a href="#åœ¨åå°å¯åŠ¨-ss-å®¢æˆ·ç«¯" class="headerlink" title="åœ¨åå°å¯åŠ¨ ss å®¢æˆ·ç«¯"></a>åœ¨åå°å¯åŠ¨ ss å®¢æˆ·ç«¯</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; nohup sslocal -s your_server_ip -p your_server_port -l 1080 -k your_server_passwd -t 600 -m rc4-md5 &gt; /dev/null 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure>

<p><strong>æ³¨æ„:</strong></p>
<ul>
<li>ä½¿ç”¨çš„æ˜¯ <code>sslocal</code> è¿™ä¸ªå‘½ä»¤ï¼Œè¡¨ç¤º <code>shadowsocks</code> ä»¥å®¢æˆ·ç«¯æ¨¡å¼å·¥ä½œ </li>
<li>å°†ä¸Šè¿°å‘½ä»¤é‡Œçš„ <code>your_server_ip</code>, <code>your_server_port</code>, <code>your_server_passwd</code> æ¢æˆè‡ªå·±çš„, è¿™ä¸‰ä¸ªåˆ†åˆ«ä»£è¡¨æœåŠ¡å™¨ip, æœåŠ¡å™¨ä¸Š <code>shadowsocks</code> çš„ç«¯å£ä»¥åŠå¯†ç .åé¢çš„ <code>rc4-md5</code> åŠ å¯†æ–¹å¼ä¹Ÿè¦æ¢æˆè·Ÿ <code>server</code> ç«¯ä¸€è‡´ã€‚ </li>
<li>å‰é¢çš„nohub å’Œæœ€åçš„ &amp; è¡¨ç¤ºåå°æ‰§è¡Œä¸”å…³é—­ session åä»ç„¶åœ¨åå°æ‰§è¡Œï¼Œå¦åˆ™å°†ä¼šé˜»å¡shellç«¯å£.<br>ä¸ºäº†æ›´æ–¹ä¾¿, å»ºè®®æ–°å»ºä¸€ä¸ª.jsonçš„æ–‡ä»¶, å°†ä¸Šè¿°ä¿¡æ¯æ”¾é‡Œé¢,å¦‚æ–°å»º/etc/shadowsocks.jsonæ–‡ä»¶, å†…å®¹ä¸ºï¼š</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;server&quot;:&quot;your_server_ip&quot;,      #ssæœåŠ¡å™¨IP</span><br><span class="line">    &quot;server_port&quot;:your_server_port, #ç«¯å£</span><br><span class="line">    &quot;local_address&quot;: &quot;127.0.0.1&quot;,   #æœ¬åœ°ip</span><br><span class="line">    &quot;local_port&quot;:1080,              #æœ¬åœ°ç«¯å£</span><br><span class="line">    &quot;password&quot;:&quot;your_server_passwd&quot;,#è¿æ¥sså¯†ç </span><br><span class="line">    &quot;timeout&quot;:300,                  #ç­‰å¾…è¶…æ—¶</span><br><span class="line">    &quot;method&quot;:&quot;rc4-md5&quot;,             #åŠ å¯†æ–¹å¼</span><br><span class="line">    &quot;fast_open&quot;: false,             # true æˆ– falseã€‚å¦‚æœä½ çš„æœåŠ¡å™¨ Linux å†…æ ¸åœ¨3.7+ï¼Œå¯ä»¥å¼€å¯ fast_open ä»¥é™ä½å»¶è¿Ÿã€‚å¼€å¯æ–¹æ³•ï¼š echo 3 &gt; &#x2F;proc&#x2F;sys&#x2F;net&#x2F;ipv4&#x2F;tcp_fastopen å¼€å¯ä¹‹åï¼Œå°† fast_open çš„é…ç½®è®¾ç½®ä¸º true å³å¯</span><br><span class="line">    &quot;workers&quot;: 1                    # å·¥ä½œçº¿ç¨‹æ•°</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶åè¿è¡Œä¸€ä¸‹å‘½ä»¤å¯åŠ¨shadowsocks </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; nohup sslocal -c /etc/shadowsocks.json /dev/null 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure>

<ul>
<li>å¦‚æœæƒ³å¢åŠ å¼€å¯è‡ªåŠ¨å¯åŠ¨ï¼Œæ‰§è¡Œï¼šecho â€œ nohup sslocal -c /etc/shadowsocks.json /dev/null 2&gt;&amp;1 &amp;â€ /etc/rc.local </li>
<li>æ‰§è¡Œps aux |grep sslocal |grep -v â€œgrepâ€æŸ¥çœ‹åå°sslocalæ˜¯å¦è¿è¡Œ</li>
</ul>
<h1 id="å®‰è£…Privoxy"><a href="#å®‰è£…Privoxy" class="headerlink" title="å®‰è£…Privoxy"></a>å®‰è£…Privoxy</h1><p>ä¸Šè¿°å®‰å¥½äº†<code>shadowsocks</code>ï¼Œä½†å®ƒæ˜¯ <code>socks5</code> ä»£ç†ï¼Œæˆ‘é—¨åœ¨ <code>shell</code> é‡Œæ‰§è¡Œçš„å‘½ä»¤ï¼Œå‘èµ·çš„ç½‘ç»œè¯·æ±‚ç°åœ¨è¿˜ä¸æ”¯æŒ <code>socks5</code> ä»£ç†ï¼Œåªæ”¯æŒ <code>http/https</code> ä»£ç†ã€‚ä¸ºäº†æˆ‘é—¨éœ€è¦å®‰è£… <code>privoxy</code> ä»£ç†ï¼Œå®ƒèƒ½æŠŠç”µè„‘ä¸Šæ‰€æœ‰httpè¯·æ±‚è½¬å‘ç»™ <code>shadowsocks</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; yum install privoxy -y</span><br></pre></td></tr></table></figure>

<ul>
<li>æŸ¥çœ‹ <code>vim /usr/local/etc/privoxy/config</code> æ–‡ä»¶ï¼Œ<br>å…ˆæœç´¢å…³é”®å­— <code>listen-address</code> æ‰¾åˆ° <code>listen-address 127.0.0.1:8118</code> è¿™ä¸€å¥ï¼Œä¿è¯è¿™ä¸€å¥æ²¡æœ‰æ³¨é‡Šï¼Œ8118å°±æ˜¯å°†æ¥httpä»£ç†è¦è¾“å…¥çš„ç«¯å£ã€‚<br>ç„¶åæœç´¢ <code>forward-socks5t</code>, å°† <code>#forward-socks5t / 127.0.0.1:1080 .</code> æ­¤å¥å‰é¢çš„æ³¨é‡Šå»æ‰, æ„æ€æ˜¯è½¬å‘æµé‡åˆ°æœ¬åœ°çš„1080ç«¯å£, è€Œ1080ç«¯å£æ­£æ˜¯ ss ç›‘å¬çš„ç«¯å£</li>
</ul>
<h2 id="å¯åŠ¨privoxy"><a href="#å¯åŠ¨privoxy" class="headerlink" title="å¯åŠ¨privoxy"></a>å¯åŠ¨privoxy</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; systemctl restart privoxy </span><br><span class="line">&gt; systemctl <span class="built_in">enable</span> privoxy</span><br></pre></td></tr></table></figure>

<h1 id="è½¬å‘é…ç½®"><a href="#è½¬å‘é…ç½®" class="headerlink" title="è½¬å‘é…ç½®"></a>è½¬å‘é…ç½®</h1><p>å†™åœ¨ profile ä¸­</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; vim /etc/profile</span><br><span class="line"><span class="built_in">export</span> http_proxy=http://127.0.0.1:8118</span><br><span class="line"><span class="built_in">export</span> https_proxy=http://127.0.0.1:8118</span><br><span class="line">&gt; <span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure>

<p>åœ¨å½“å‰ session æ‰§è¡Œ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> http_proxy=http://127.0.0.1:8118</span><br><span class="line"><span class="built_in">export</span> https_proxy=http://127.0.0.1:8118</span><br></pre></td></tr></table></figure>

<h1 id="æµ‹è¯•ç¿»å¢™"><a href="#æµ‹è¯•ç¿»å¢™" class="headerlink" title="æµ‹è¯•ç¿»å¢™"></a>æµ‹è¯•ç¿»å¢™</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl www.google.com</span><br></pre></td></tr></table></figure>

<h1 id="é—®é¢˜è§£å†³"><a href="#é—®é¢˜è§£å†³" class="headerlink" title="é—®é¢˜è§£å†³"></a>é—®é¢˜è§£å†³</h1><p>å¦‚æœä¸èƒ½è®¿é—®, è¯·é‡å¯æœºå™¨, ä¾æ¬¡æ‰“å¼€shadowsockså’Œprivoxyå†æµ‹è¯•</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; nohup sslocal -c /etc/shadowsocks.json /dev/null 2&gt;&amp;1 &amp;</span><br><span class="line">&gt; privoxy --user privoxy /usr/<span class="built_in">local</span>/etc/privoxy/config</span><br></pre></td></tr></table></figure>

<p><img src="http://20150509.oss-cn-qingdao.aliyuncs.com/QQ20161208-1@2x.png" alt=""></p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>ä»£ç†</tag>
        <tag>ShadowSocks</tag>
        <tag>Privoxy</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQLçš„ä¸»ä»åˆ‡æ¢</title>
    <url>/2016/12/12/MySQL%E7%9A%84%E4%B8%BB%E4%BB%8E%E5%88%87%E6%8D%A2/</url>
    <content><![CDATA[<blockquote>
<p>æœ¬ç¯‡æ–‡ç« ä¸å†èµ˜è¿° MySQL ä¸»ä»æ­å»ºçš„è¿‡ç¨‹, åªä»‹ç»ä¸»ä»åˆ‡æ¢çš„è¿‡ç¨‹</p>
</blockquote>
<p>MySQL çš„ä¸»ä»åˆ‡æ¢åˆ†æˆä¸¤ç§æƒ…å†µ</p>
<ul>
<li>ä¸€ç§æƒ…å†µæ˜¯ä¸»ä»é«˜å¯ç”¨, ä¸»ä»åˆ‡æ¢å, åŸä¸»åº“è¿˜è¦ç»§ç»­åŒæ­¥åŸä»åº“çš„æ•°æ®</li>
<li>å¦ä¸€ç§æƒ…å†µæ˜¯ä¸€ä¸»ä¸€ä», ä¸»ä»åˆ‡æ¢å, ä¸»åº“ä¸‹çº¿, ä¸éœ€è¦åŸä¸»åº“å†å»åŒæ­¥åŸä»åº“</li>
</ul>
<h1 id="ç¬¬ä¸€ç§æƒ…å†µçš„ä¸»ä»åˆ‡æ¢"><a href="#ç¬¬ä¸€ç§æƒ…å†µçš„ä¸»ä»åˆ‡æ¢" class="headerlink" title="ç¬¬ä¸€ç§æƒ…å†µçš„ä¸»ä»åˆ‡æ¢"></a>ç¬¬ä¸€ç§æƒ…å†µçš„ä¸»ä»åˆ‡æ¢</h1><h2 id="åˆ†åˆ«æŸ¥çœ‹ä¸»ä»çŠ¶æ€"><a href="#åˆ†åˆ«æŸ¥çœ‹ä¸»ä»çŠ¶æ€" class="headerlink" title="åˆ†åˆ«æŸ¥çœ‹ä¸»ä»çŠ¶æ€"></a>åˆ†åˆ«æŸ¥çœ‹ä¸»ä»çŠ¶æ€</h2><figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="comment"># slave ä¸­æŸ¥çœ‹ä»åº“çš„çŠ¶æ€</span></span><br><span class="line">mysql&gt; show slave status\G</span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="comment"># master ä¸­æŸ¥çœ‹ä¸»åº“çš„çŠ¶æ€</span></span><br><span class="line">mysql&gt; show slave hosts;</span><br></pre></td></tr></table></figure>

<h2 id="åœæ­¢ä»åº“çš„-IO-THREAD-çº¿ç¨‹"><a href="#åœæ­¢ä»åº“çš„-IO-THREAD-çº¿ç¨‹" class="headerlink" title="åœæ­¢ä»åº“çš„ IO_THREAD çº¿ç¨‹"></a>åœæ­¢ä»åº“çš„ IO_THREAD çº¿ç¨‹</h2><p>å…ˆåœæ­¢ IO_THREAD çº¿ç¨‹, å³æ–­å¼€äº†ä»ä¸»åº“çš„ sql æ¶ˆæ¯æ¥æ”¶, æœ‰åˆ©äºå½“å‰æ•°æ®åº“å®Œæˆå‰©ä½™çš„æ•°æ®åŒæ­¥</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="comment"># slave</span></span><br><span class="line">mysql&gt; stop slave IO_THREAD;</span><br><span class="line">mysql&gt; show slave status\G</span><br></pre></td></tr></table></figure>

<p>æ£€æŸ¥æ˜¯å¦æ˜¯å¦‚ä¸‹çŠ¶æ€;</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Slave_IO_Running: No</span><br><span class="line">Slave_SQL_Running: Yes</span><br></pre></td></tr></table></figure>

<h2 id="æ¿€æ´»ä»åº“"><a href="#æ¿€æ´»ä»åº“" class="headerlink" title="æ¿€æ´»ä»åº“"></a>æ¿€æ´»ä»åº“</h2><p>åœ¨åœæ­¢ IO_THREAD çº¿ç¨‹å, çœ‹åˆ° <code>Slave_SQL_Running_State: Slave has read all relay log; waiting for the slave I/O thread to update it</code>è¿™ä¸ªçŠ¶æ€å,  å°±å¯ä»¥æ“ä½œå®Œå…¨åœæ­¢ä»åº“,å¹¶æ¿€æ´»ä¸ºä¸»åº“å•¦</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; stop slave;  # å®Œå…¨åœæ­¢ slave å¤åˆ¶ </span><br><span class="line">mysql&gt; reset slave all; # å®Œå…¨æ¸…ç©º slave å¤åˆ¶ä¿¡æ¯</span><br><span class="line">msyql&gt; reset master; # æ¸…ç©ºæœ¬æœºä¸Š master çš„ä½ç½®ä¿¡æ¯(ç»™åŸä¸»åº“åŒæ­¥æ­¤åŸä»åº“åšå‡†å¤‡)</span><br><span class="line">mysql&gt; show binary logs; # æŸ¥çœ‹å½“å‰æ•°æ®åº“çš„ binlog ä¿¡æ¯</span><br><span class="line">+<span class="comment">----------------+-----------+</span></span><br><span class="line">| Log_name       | File_size |</span><br><span class="line">+<span class="comment">----------------+-----------+</span></span><br><span class="line">| bin-log.000001 |       120 |</span><br><span class="line">+<span class="comment">----------------+-----------+</span></span><br></pre></td></tr></table></figure>

<h1 id="å°†åŸä¸»åº“å˜ä¸ºä»åº“"><a href="#å°†åŸä¸»åº“å˜ä¸ºä»åº“" class="headerlink" title="å°†åŸä¸»åº“å˜ä¸ºä»åº“"></a>å°†åŸä¸»åº“å˜ä¸ºä»åº“</h1><figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="comment"># master</span></span><br><span class="line">mysql&gt; CHANGE MASTER TO</span><br><span class="line">   MASTER_HOST='192.168.10.59',</span><br><span class="line">   MASTER_PORT=3306,</span><br><span class="line">   MASTER_USER='repl',</span><br><span class="line">   MASTER_PASSWORD='12345678',</span><br><span class="line">   MASTER_LOG_FILE='bin-log.000001',</span><br><span class="line">   MASTER_LOG_POS=120;</span><br><span class="line">mysql&gt; start slave;</span><br><span class="line">mysql&gt; show slave status\G</span><br></pre></td></tr></table></figure>



<hr>
<h1 id="ç¬¬äºŒç§æƒ…å†µçš„ä¸»ä»åˆ‡æ¢"><a href="#ç¬¬äºŒç§æƒ…å†µçš„ä¸»ä»åˆ‡æ¢" class="headerlink" title="ç¬¬äºŒç§æƒ…å†µçš„ä¸»ä»åˆ‡æ¢"></a>ç¬¬äºŒç§æƒ…å†µçš„ä¸»ä»åˆ‡æ¢</h1><p>ç¬¬äºŒç§æƒ…å†µçš„ä¸»ä»åˆ‡æ¢, åˆ‡æ¢å, ä¸»åº“ä¸éœ€è¦å†å»åŒæ­¥ä¹‹å‰çš„ä»åº“(æ–°ä¸»åº“), æœ‰ä¸‹çº¿çš„éœ€æ±‚, è¿™ç§æƒ…å†µä¸‹, æ“ä½œæµç¨‹è·Ÿä»¥ä¸Šå·®ä¸å¤š, åªä¸è¿‡å¯ä»¥çœå»å¦‚ä¸‹æ­¥éª¤:</p>
<ul>
<li>ä»åº“ä¸­ä¸éœ€è¦æ‰§è¡Œ<code>reset master</code>äº†, å› ä¸ºåŸä¸»åº“(ç°ä»åº“)ä¸è¦å†æ‰¾ç‚¹å•¦(Position)</li>
<li>ä¸»åº“ç›´æ¥ä¸‹çº¿å°±è¡Œäº†, ä¸éœ€è¦æ‰§è¡Œæœ€åæŠŠä¸»åº“å˜ä¸ºä»åº“çš„æ“ä½œäº†</li>
</ul>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>ä¸»ä»åˆ‡æ¢</tag>
      </tags>
  </entry>
  <entry>
    <title>DockeråŠ¨æ€æ‰©å®¹Poolå¤§å°ä¸containerå¤§å°</title>
    <url>/2016/12/12/Docker%E5%8A%A8%E6%80%81%E6%89%A9%E5%AE%B9Pool%E5%A4%A7%E5%B0%8F%E4%B8%8Econtainer%E5%A4%A7%E5%B0%8F/</url>
    <content><![CDATA[<blockquote>
<p>dockerå®¹å™¨é»˜è®¤çš„ç©ºé—´æ˜¯10G, Pool å¤§å°é»˜è®¤æ˜¯100G. </p>
</blockquote>
<h1 id="æŸ¥çœ‹-docker-ä¿¡æ¯"><a href="#æŸ¥çœ‹-docker-ä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹ docker ä¿¡æ¯"></a>æŸ¥çœ‹ docker ä¿¡æ¯</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; docker info</span><br><span class="line">Containers: 3</span><br><span class="line"> Running: 3</span><br><span class="line"> Paused: 0</span><br><span class="line"> Stopped: 0</span><br><span class="line">Images: 2</span><br><span class="line">Server Version: 1.12.1</span><br><span class="line">Storage Driver: devicemapper</span><br><span class="line"> Pool Name: docker-253:0-117441065-pool</span><br><span class="line"> Pool Blocksize: 65.54 kB</span><br><span class="line"> Base Device Size: 107.4 GB</span><br><span class="line"> Backing Filesystem: xfs</span><br><span class="line"> Data file: /dev/loop0</span><br><span class="line"> Metadata file: /dev/loop1</span><br><span class="line"> Data Space Used: 18.32 GB</span><br><span class="line"> Data Space Total: 107.4 GB</span><br><span class="line"> Data Space Available: 89.05 GB</span><br><span class="line"> Metadata Space Used: 12.45 MB</span><br><span class="line"> Metadata Space Total: 2.147 GB</span><br><span class="line"> Metadata Space Available: 2.135 GB</span><br><span class="line"> Thin Pool Minimum Free Space: 10.74 GB</span><br><span class="line"> Udev Sync Supported: <span class="literal">true</span></span><br><span class="line"> Deferred Removal Enabled: <span class="literal">false</span></span><br><span class="line"> Deferred Deletion Enabled: <span class="literal">false</span></span><br><span class="line"> Deferred Deleted Device Count: 0</span><br><span class="line"> Data loop file: /var/lib/docker/devicemapper/devicemapper/data</span><br><span class="line"> WARNING: Usage of loopback devices is strongly discouraged <span class="keyword">for</span> production use. Use `--storage-opt dm.thinpooldev` to specify a custom block storage device.</span><br><span class="line"> Metadata loop file: /var/lib/docker/devicemapper/devicemapper/metadata</span><br><span class="line"> Library Version: 1.02.107-RHEL7 (2016-06-09)</span><br><span class="line">Logging Driver: json-file</span><br><span class="line">Cgroup Driver: cgroupfs</span><br><span class="line">Plugins:</span><br><span class="line"> Volume: <span class="built_in">local</span></span><br><span class="line"> Network: host bridge overlay null</span><br><span class="line">Swarm: inactive</span><br><span class="line">Runtimes: runc</span><br><span class="line">Default Runtime: runc</span><br><span class="line">Security Options: seccomp</span><br><span class="line">Kernel Version: 3.10.0-327.28.3.el7.x86_64</span><br><span class="line">Operating System: CentOS Linux 7 (Core)</span><br><span class="line">OSType: linux</span><br><span class="line">Architecture: x86_64</span><br><span class="line">CPUs: 6</span><br><span class="line">Total Memory: 7.624 GiB</span><br><span class="line">Name: mobile-quality</span><br><span class="line">ID: NG64:K27K:ASGU:MCBI:NPOZ:Y554:5HME:3INM:UAMI:IIWC:ZQT5:ZKO6</span><br><span class="line">Docker Root Dir: /var/lib/docker</span><br><span class="line">Debug Mode (client): <span class="literal">false</span></span><br><span class="line">Debug Mode (server): <span class="literal">false</span></span><br><span class="line">Registry: https://index.docker.io/v1/</span><br><span class="line">WARNING: bridge-nf-call-iptables is disabled</span><br><span class="line">WARNING: bridge-nf-call-ip6tables is disabled</span><br><span class="line">Labels:</span><br><span class="line"> provider=generic</span><br><span class="line">Insecure Registries:</span><br><span class="line"> 127.0.0.0/8</span><br></pre></td></tr></table></figure>
<p> <code>Data Space Total: 107.4 GB</code> è¿™ä¸ªå°±æ˜¯é»˜è®¤çš„ Pool å¤§å°</p>
<hr>
<h1 id="è°ƒæ•´-container-å¤§å°"><a href="#è°ƒæ•´-container-å¤§å°" class="headerlink" title="è°ƒæ•´ container å¤§å°"></a>è°ƒæ•´ container å¤§å°</h1><h2 id="æ–°-container-çš„è°ƒæ•´"><a href="#æ–°-container-çš„è°ƒæ•´" class="headerlink" title="æ–° container çš„è°ƒæ•´"></a>æ–° container çš„è°ƒæ•´</h2><p>å¦‚æœæƒ³æŒ‡å®šé»˜è®¤å®¹å™¨çš„å¤§å°ï¼ˆåœ¨å¯åŠ¨å®¹å™¨çš„æ—¶å€™æŒ‡å®šï¼‰ï¼Œå¯ä»¥åœ¨dockeré…ç½®æ–‡ä»¶é‡Œé€šè¿‡dm.basesizeå‚æ•°æŒ‡å®š</p>
<h3 id="ç›´æ¥ä½¿ç”¨-docker-å‘½ä»¤å¯åŠ¨æœåŠ¡"><a href="#ç›´æ¥ä½¿ç”¨-docker-å‘½ä»¤å¯åŠ¨æœåŠ¡" class="headerlink" title="ç›´æ¥ä½¿ç”¨ docker å‘½ä»¤å¯åŠ¨æœåŠ¡"></a>ç›´æ¥ä½¿ç”¨ docker å‘½ä»¤å¯åŠ¨æœåŠ¡</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker -d --storage-opt dm.basesize=20G</span><br></pre></td></tr></table></figure>
<h3 id="ä½¿ç”¨-systemctl-å‘½ä»¤å¯åŠ¨æœåŠ¡"><a href="#ä½¿ç”¨-systemctl-å‘½ä»¤å¯åŠ¨æœåŠ¡" class="headerlink" title="ä½¿ç”¨ systemctl å‘½ä»¤å¯åŠ¨æœåŠ¡"></a>ä½¿ç”¨ systemctl å‘½ä»¤å¯åŠ¨æœåŠ¡</h3><p>å¯¹äºä½¿ç”¨ <code>systemctl</code> ç®¡ç†çš„dockeræœåŠ¡, å¯ä»¥ç¼–è¾‘ systemctl çš„å¯åŠ¨è„šæœ¬</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; vim /etc/systemd/system/docker.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=Docker Application Container Engine</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=notify</span><br><span class="line">ExecStart=/usr/bin/docker daemon -H tcp://0.0.0.0:2376 -H unix:///var/run/docker.sock --registry-mirror=http://8843165a.m.daocloud.io --storage-driver devicemapper --tl</span><br><span class="line">sverify --tlscacert /etc/docker/ca.pem --tlscert /etc/docker/server.pem --tlskey /etc/docker/server-key.pem --label provider=generic --storage-opt dm.basesize=20G</span><br><span class="line">ExecReload=/bin/<span class="built_in">kill</span> -s HUP</span><br><span class="line">MountFlags=slave</span><br><span class="line">LimitNOFILE=infinity</span><br><span class="line">LimitNPROC=infinity</span><br><span class="line">LimitCORE=infinity</span><br><span class="line">TimeoutStartSec=0</span><br><span class="line">Delegate=yes</span><br><span class="line">KillMode=process</span><br><span class="line">Environment=</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šæ–¹å¼é€‚ç”¨äºæ–° run èµ·æ¥çš„ container, ä¼šè·å–åˆ°æ–°çš„ç©ºé—´</p>
<h2 id="å·²å­˜åœ¨çš„-container-çš„è°ƒæ•´"><a href="#å·²å­˜åœ¨çš„-container-çš„è°ƒæ•´" class="headerlink" title="å·²å­˜åœ¨çš„ container çš„è°ƒæ•´"></a>å·²å­˜åœ¨çš„ container çš„è°ƒæ•´</h2><h3 id="æŸ¥çœ‹æ‰€æœ‰çš„è™šæ‹Ÿç£ç›˜ä¿¡æ¯"><a href="#æŸ¥çœ‹æ‰€æœ‰çš„è™šæ‹Ÿç£ç›˜ä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹æ‰€æœ‰çš„è™šæ‹Ÿç£ç›˜ä¿¡æ¯"></a>æŸ¥çœ‹æ‰€æœ‰çš„è™šæ‹Ÿç£ç›˜ä¿¡æ¯</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; dmsetup status</span><br><span class="line">docker-253:0-117441065-pool: 0 209715200 thin-pool 39 3039/524288 279539/1638400 - rw discard_passdown queue_if_no_space - </span><br><span class="line">docker-253:0-117441065-bb21427f81836c96a53e7cf0ee97c9e907104ad1ce4d8f2bdade4bbfc0fdd5f5: 0 20971520 thin 17858688 209715199</span><br><span class="line">docker-253:0-117441065-17379f89f95efb5bafb234d95e0e0dfe549f7ba48fbed69c0111e2ea39c0106e: 0 20971520 thin 19820928 209715199</span><br><span class="line">docker-253:0-117441065-c57286b3ae5bc1bd675573902d043754aba23349306fd3a52bcd74eed5d144cb: 0 20971520 thin 2968320 209715199</span><br><span class="line">centos-swap: 0 3358720 linear </span><br><span class="line">centos-root: 0 29163520 linear </span><br><span class="line">centos-root: 29163520 71294976 linear </span><br><span class="line">centos-root: 100458496 104849408 linear </span><br><span class="line">centos-root: 205307904 209707008 linear</span><br></pre></td></tr></table></figure>

<p>æœ€ä¸Šé¢4æ¡å¼€å¤´å†™ç€ docker çš„è™šæ‹Ÿç£ç›˜å°±æ˜¯æˆ‘ä»¬å³å°†æ“ä½œçš„å¯¹è±¡</p>
<p>å…¶ä¸­å¯ä»¥æ˜æ˜¾çš„çœ‹å‡º, ç¬¬ä¸€æ¡ä¸­å¸¦æœ‰ <code>pool</code> çš„å­—æ ·, æ²¡é”™, è¿™ä¸ªå°±æ˜¯ docker é»˜è®¤çš„ pool å¤§å°,ç°åœ¨æˆ‘ä»¬è¦è°ƒæ•´ container çš„å¤§å°, æš‚æ—¶ä¸ç®¡ pool çš„é»˜è®¤é…ç½®</p>
<p>å…¶ä½™çš„ä¸‰æ¡ç£ç›˜ä¿¡æ¯å°±æ˜¯å½“å‰å®¿ä¸»æœºä¸­, èµ·æ¥çš„ container ä½¿ç”¨çš„è™šæ‹Ÿç£ç›˜, å¦‚æœä½ éœ€è¦æŒ‡å®šå…¶ä¸­ä¸€ä¸ªæ¥è°ƒæ•´, é‚£ä¹ˆä½ éœ€è¦æ‰¾åˆ°è™šæ‹Ÿç£ç›˜å’Œ container name æˆ– container id çš„å¯¹åº”å…³ç³», ä¸è¦æé”™!</p>
<p>å¯¹åº”å…³ç³»å¯ä»¥ä½¿ç”¨ <code>docker exec -it xxxx /bin/bash</code> è¿›å…¥åˆ° container ä¸­ä½¿ç”¨<code>df -h</code> å‘½ä»¤æŸ¥çœ‹æ ¹åˆ†åŒºçš„è™šæ‹Ÿç£ç›˜åç§°<br>ä¹Ÿå¯ä»¥åœ¨ linux ä¸­ä½¿ç”¨ <code>docker inspect xxx</code> æ¥æŸ¥çœ‹ xxx å®¹å™¨çš„è¯¦ç»†ä¿¡æ¯</p>
<p>æ‰¾åˆ°äº†å®ƒä»¬çš„å¯¹åº”å…³ç³»ä¹‹å, æ¥ä¸‹æ¥å°±å¯ä»¥å¯¹å…¶è°ƒæ•´å¤§å°äº†</p>
<h3 id="æ‰¾åˆ°æ˜ å°„çš„è™šæ‹Ÿç£ç›˜"><a href="#æ‰¾åˆ°æ˜ å°„çš„è™šæ‹Ÿç£ç›˜" class="headerlink" title="æ‰¾åˆ°æ˜ å°„çš„è™šæ‹Ÿç£ç›˜"></a>æ‰¾åˆ°æ˜ å°„çš„è™šæ‹Ÿç£ç›˜</h3><p>é»˜è®¤æƒ…å†µä¸‹, æ‰€æœ‰çš„è™šæ‹Ÿç£ç›˜çš„æ˜ å°„éƒ½åœ¨<code>/dev/mapper/</code> ä¸‹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; ls -l</span><br><span class="line">total 0</span><br><span class="line">lrwxrwxrwx 1 root root       7 Dec  7 01:45 centos-root -&gt; ../dm-0</span><br><span class="line">lrwxrwxrwx 1 root root       7 Dec  7 01:45 centos-swap -&gt; ../dm-1</span><br><span class="line">crw------- 1 root root 10, 236 Dec  7 01:45 control</span><br><span class="line">lrwxrwxrwx 1 root root       7 Dec  7 02:20 docker-253:0-117441065-17379f89f95efb5bafb234d95e0e0dfe549f7ba48fbed69c0111e2ea39c0106e -&gt; ../dm-3</span><br><span class="line">lrwxrwxrwx 1 root root       7 Dec  7 02:21 docker-253:0-117441065-bb21427f81836c96a53e7cf0ee97c9e907104ad1ce4d8f2bdade4bbfc0fdd5f5 -&gt; ../dm-4</span><br><span class="line">lrwxrwxrwx 1 root root       7 Dec  7 02:30 docker-253:0-117441065-c57286b3ae5bc1bd675573902d043754aba23349306fd3a52bcd74eed5d144cb -&gt; ../dm-5</span><br><span class="line">lrwxrwxrwx 1 root root       7 Dec  7 01:49 docker-253:0-117441065-pool -&gt; ../dm-2</span><br></pre></td></tr></table></figure>
<p>ä»ä¸Šé¢ğŸ‘†çš„å›æ˜¾ä¹Ÿå¯ä»¥çœ‹å‡ºå®é™…æŒ‡å‘çš„è™šæ‹Ÿç£ç›˜æ–‡ä»¶(æ˜¯ä¸æ˜¯æœ‰ç‚¹ç»•, è¿™ä¸ªæ–‡ä»¶åªä¸è¿‡æ˜¯è™šæ‹Ÿç£ç›˜çš„è½¯è¿æ¥è€Œå·²)</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦å¯¹å…¶è¿›è¡Œæ‰©å®¹æ“ä½œ</p>
<h3 id="ç¬¬ä¸€æ­¥-æŸ¥çœ‹æŒ‡å®šè™šæ‹Ÿç£ç›˜çš„å®¹é‡ä¿¡æ¯"><a href="#ç¬¬ä¸€æ­¥-æŸ¥çœ‹æŒ‡å®šè™šæ‹Ÿç£ç›˜çš„å®¹é‡ä¿¡æ¯" class="headerlink" title="ç¬¬ä¸€æ­¥: æŸ¥çœ‹æŒ‡å®šè™šæ‹Ÿç£ç›˜çš„å®¹é‡ä¿¡æ¯"></a>ç¬¬ä¸€æ­¥: æŸ¥çœ‹æŒ‡å®šè™šæ‹Ÿç£ç›˜çš„å®¹é‡ä¿¡æ¯</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; dmsetup table docker-253:0-117441065-17379f89f95efb5bafb234d95e0e0dfe549f7ba48fbed69c0111e2ea39c0106e</span><br><span class="line">0 20971520 thin 253:2 25</span><br></pre></td></tr></table></figure>

<h3 id="ç¬¬äºŒæ­¥-è®¡ç®—æ‰€éœ€çš„å®¹é‡-æ‰‡åŒºæ•°é‡"><a href="#ç¬¬äºŒæ­¥-è®¡ç®—æ‰€éœ€çš„å®¹é‡-æ‰‡åŒºæ•°é‡" class="headerlink" title="ç¬¬äºŒæ­¥: è®¡ç®—æ‰€éœ€çš„å®¹é‡(æ‰‡åŒºæ•°é‡)"></a>ç¬¬äºŒæ­¥: è®¡ç®—æ‰€éœ€çš„å®¹é‡(æ‰‡åŒºæ•°é‡)</h3><p>å‡è®¾ä½ æƒ³è¦çš„å®¹é‡ä¸º 20G</p>
<p>åˆ™è¯¥å€¼åº”è¯¥ä¸º: <code>20*1024*1024*1024/512</code> = 41943040</p>
<p>éªŒç®—: 20G çš„å€¼ 41943040 = é»˜è®¤10G çš„å€¼ 20971520 *2</p>
<p>å…¬å¼ä¸º: <code>x*1024*1024*1024/512</code></p>
<h3 id="ç¬¬ä¸‰æ­¥-æŒ‚èµ·è™šæ‹Ÿç£ç›˜"><a href="#ç¬¬ä¸‰æ­¥-æŒ‚èµ·è™šæ‹Ÿç£ç›˜" class="headerlink" title="ç¬¬ä¸‰æ­¥: æŒ‚èµ·è™šæ‹Ÿç£ç›˜"></a>ç¬¬ä¸‰æ­¥: æŒ‚èµ·è™šæ‹Ÿç£ç›˜</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; dmsetup <span class="built_in">suspend</span> docker-253:0-117441065-17379f89f95efb5bafb234d95e0e0dfe549f7ba48fbed69c0111e2ea39c0106e</span><br></pre></td></tr></table></figure>

<p>æ²¡æœ‰å›æ˜¾, æ²¡æœ‰æ¶ˆæ¯å°±æ˜¯å¥½æ¶ˆæ¯ğŸ˜†</p>
<h3 id="ç¬¬å››æ­¥-å†™å…¥æ–°å‚æ•°å¹¶é‡æ–°åŠ è½½è¿›å»"><a href="#ç¬¬å››æ­¥-å†™å…¥æ–°å‚æ•°å¹¶é‡æ–°åŠ è½½è¿›å»" class="headerlink" title="ç¬¬å››æ­¥: å†™å…¥æ–°å‚æ•°å¹¶é‡æ–°åŠ è½½è¿›å»"></a>ç¬¬å››æ­¥: å†™å…¥æ–°å‚æ•°å¹¶é‡æ–°åŠ è½½è¿›å»</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; dmsetup reload docker-253:0-117441065-17379f89f95efb5bafb234d95e0e0dfe549f7ba48fbed69c0111e2ea39c0106e --table <span class="string">'0 41943040 thin 253:2 25'</span></span><br></pre></td></tr></table></figure>

<p>æŠŠä¸Šä¸€æ­¥è®¡ç®—å‡ºæ¥çš„å€¼, è¦†ç›–åˆ°ç¬¬ä¸€æ­¥çš„å›æ˜¾å¯¹åº”çš„ä½ç½®ä¸­</p>
<h3 id="ç¬¬äº”æ­¥-æ¿€æ´»æŒ‚èµ·çš„è™šæ‹Ÿç£ç›˜"><a href="#ç¬¬äº”æ­¥-æ¿€æ´»æŒ‚èµ·çš„è™šæ‹Ÿç£ç›˜" class="headerlink" title="ç¬¬äº”æ­¥: æ¿€æ´»æŒ‚èµ·çš„è™šæ‹Ÿç£ç›˜"></a>ç¬¬äº”æ­¥: æ¿€æ´»æŒ‚èµ·çš„è™šæ‹Ÿç£ç›˜</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; dmsetup resume docker-253:0-117441065-17379f89f95efb5bafb234d95e0e0dfe549f7ba48fbed69c0111e2ea39c0106e</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæ‰§è¡Œåˆ°è¿™ä¸€æ­¥çš„æ—¶å€™æŠ¥é”™: </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">device-mapper: resume ioctl on docker-253:0-1700-pool failed: Invalid argument</span><br><span class="line">Command failed</span><br></pre></td></tr></table></figure>

<p>å…ˆä¸è¦æ…Œ, ç¨ç­‰ç‰‡åˆ», å†é‡æ–°æ‰§è¡Œ</p>
<h3 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„:"></a>æ³¨æ„:</h3><p>ç”±äºæŒ‚èµ·æ“ä½œä¼šé˜»å¡ä½æ‰€æœ‰çš„ IO, ä¸ºäº†å°½å¿«å®Œæˆæ‰©å®¹, æˆ‘ä»¬ä¸€èˆ¬æŠŠç¬¬ä¸‰å››äº”æ­¥éª¤ç”¨ä¸€è¡Œå‘½ä»¤å»æ‰§è¡Œ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; dmsetup <span class="built_in">suspend</span> docker-253:0-117441065-17379f89f95efb5bafb234d95e0e0dfe549f7ba48fbed69c0111e2ea39c0106e \</span><br><span class="line">    &amp;&amp; dmsetup reload docker-253:0-117441065-17379f89f95efb5bafb234d95e0e0dfe549f7ba48fbed69c0111e2ea39c0106e --table <span class="string">'0 41943040 thin 253:2 25'</span> \</span><br><span class="line">    &amp;&amp; dmsetup resume docker-253:0-117441065-17379f89f95efb5bafb234d95e0e0dfe549f7ba48fbed69c0111e2ea39c0106e</span><br></pre></td></tr></table></figure>

<h3 id="ç¬¬å…­æ­¥-ä¸ºç£ç›˜æ‰©å®¹"><a href="#ç¬¬å…­æ­¥-ä¸ºç£ç›˜æ‰©å®¹" class="headerlink" title="ç¬¬å…­æ­¥: ä¸ºç£ç›˜æ‰©å®¹"></a>ç¬¬å…­æ­¥: ä¸ºç£ç›˜æ‰©å®¹</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; mount /dev/dm-3 /mnt</span><br><span class="line">&gt; xfs_growfs /mnt</span><br><span class="line">&gt; umount /mnt</span><br></pre></td></tr></table></figure>

<p>éœ€è¦å…ˆæŒ‚è½½å†æ‰©å®¹</p>
<hr>
<h1 id="è°ƒæ•´-pool-å¤§å°"><a href="#è°ƒæ•´-pool-å¤§å°" class="headerlink" title="è°ƒæ•´ pool å¤§å°"></a>è°ƒæ•´ pool å¤§å°</h1><p>è°ƒæ•´ pool å¤§å°ä¸åŒäºè°ƒæ•´ container çš„å¤§å°, éœ€è¦å…ˆå¯¹å…¶è™šæ‹Ÿæ–‡ä»¶è¿›è¡Œæ‰©å®¹, å†å¯¹è™šæ‹Ÿç£ç›˜æ‰©å®¹</p>
<p>åˆ°è¿™é‡Œæ¶‰åŠåˆ°äº†ä¸‰ä¸ªæ¦‚å¿µ:</p>
<ul>
<li>è™šæ‹Ÿæ–‡ä»¶å¤§å° â€”&gt; ç¡¬ç›˜å¤§å°/PV/VG</li>
<li>è™šæ‹Ÿç¡¬ç›˜è®¾å¤‡ â€”&gt; LV/file system</li>
<li>è½¯è¿æ¥ â€”&gt; alias åˆ«å</li>
</ul>
<p>è™šæ‹Ÿç¡¬ç›˜è®¾å¤‡æ˜¯åŸºäºè™šæ‹Ÿæ–‡ä»¶çš„, å°±å¥½åƒæˆ‘ä»¬ä½¿ç”¨çš„ lvm å·, è™šæ‹Ÿç¡¬ç›˜è®¾å¤‡å°±ç›¸å½“äº lv æˆ–æ˜¯è¯´å°±ç›¸å½“äºæˆ‘ä»¬æ­£åœ¨ä½¿ç”¨çš„æ–‡ä»¶ç³»ç»Ÿ; è€Œ docker ä¸­çš„è™šæ‹Ÿæ–‡ä»¶å°±å¥½æ¯”æˆ‘ä»¬ç‰©ç†æœºçš„ç¡¬ç›˜, æˆ–æ˜¯è¯´ PV ä¸ VG çš„å¤§å°</p>
<ul>
<li>åœ¨ç‰©ç†æœåŠ¡å™¨ä¸­, ç£ç›˜ç©ºé—´ä¸è¶³çš„è¯, æˆ‘ä»¬å¯ä»¥å¢åŠ ç¡¬ç›˜, æ¡å¸¦åŒ–æˆ PV, å†å¡«å…¥åˆ° VG æ± ä¸­, ç„¶ååˆ†é…ç»™å¯¹åº”çš„ LV, å†å¯¹å…¶æ‰©å®¹</li>
<li>åœ¨ docker ä¸­, ç£ç›˜ç©ºé—´ä¸è¶³çš„è¯(pool ä¸è¶³çš„è¯), æˆ‘ä»¬å¯ä»¥æ‰©å……è™šæ‹Ÿæ–‡ä»¶, ç„¶åè®©è™šæ‹Ÿç¡¬ç›˜è®¾å¤‡æ‰©å®¹</li>
</ul>
<h2 id="æŸ¥çœ‹-pool-æ–‡ä»¶å¤§å°ä¿¡æ¯"><a href="#æŸ¥çœ‹-pool-æ–‡ä»¶å¤§å°ä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹ pool æ–‡ä»¶å¤§å°ä¿¡æ¯"></a>æŸ¥çœ‹ pool æ–‡ä»¶å¤§å°ä¿¡æ¯</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; ls -lh /var/lib/docker/devicemapper/devicemapper/</span><br><span class="line">total 244M</span><br><span class="line">-rw-------. 1 root root 100G Dec  8 18:27 data</span><br><span class="line">-rw-------. 1 root root 2.0G Dec  8 18:24 metadata</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ° data æ˜¯100G å¤§å°, ä¸è¦æ‹…å¿ƒä»–å®é™…å ç”¨äº†100G, è¿™ä¸ªæ˜¯ç²¾ç®€é…ç½®, å®é™…ç”¨å¤šå°‘å°±å å¤šå°‘ç©ºé—´, æœ€å¤§100G</p>
<h2 id="ç¬¬ä¸€æ­¥-ç»™æ–‡ä»¶æ‰©å®¹"><a href="#ç¬¬ä¸€æ­¥-ç»™æ–‡ä»¶æ‰©å®¹" class="headerlink" title="ç¬¬ä¸€æ­¥: ç»™æ–‡ä»¶æ‰©å®¹"></a>ç¬¬ä¸€æ­¥: ç»™æ–‡ä»¶æ‰©å®¹</h2><p>ä¸Šé¢çœ‹åˆ°çš„ data æ–‡ä»¶æœ‰100G çš„å¤§å°, ç°åœ¨æˆ‘éœ€è¦200G çš„ pool å¤§å°, æ‰€ä»¥éœ€è¦è°ƒæ•´ data æ–‡ä»¶çš„å±æ€§</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">truncate -s 214748364800 /var/lib/docker/devicemapper/devicemapper/data</span><br></pre></td></tr></table></figure>

<h2 id="ç¬¬äºŒæ­¥-æ£€æŸ¥å¤§å°"><a href="#ç¬¬äºŒæ­¥-æ£€æŸ¥å¤§å°" class="headerlink" title="ç¬¬äºŒæ­¥: æ£€æŸ¥å¤§å°"></a>ç¬¬äºŒæ­¥: æ£€æŸ¥å¤§å°</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; ls -lh /var/lib/docker/devicemapper/devicemapper/                      </span><br><span class="line">total 244M</span><br><span class="line">-rw-------. 1 root root 200G Dec  8 18:35 data</span><br><span class="line">-rw-------. 1 root root 2.0G Dec  8 18:24 metadata</span><br></pre></td></tr></table></figure>

<h2 id="ç¬¬ä¸‰æ­¥-Reload-data-loop-device"><a href="#ç¬¬ä¸‰æ­¥-Reload-data-loop-device" class="headerlink" title="ç¬¬ä¸‰æ­¥: Reload data loop device"></a>ç¬¬ä¸‰æ­¥: Reload data loop device</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; blockdev --getsize64 /dev/loop0</span><br><span class="line">107374182400</span><br><span class="line">&gt; losetup -c /dev/loop0</span><br><span class="line">&gt; blockdev --getsize64 /dev/loop0</span><br><span class="line">214748364800</span><br></pre></td></tr></table></figure>

<h2 id="ç¬¬å››æ­¥-Reload-devicemapper-thin-pool"><a href="#ç¬¬å››æ­¥-Reload-devicemapper-thin-pool" class="headerlink" title="ç¬¬å››æ­¥: Reload devicemapper thin pool"></a>ç¬¬å››æ­¥: Reload devicemapper thin pool</h2><p>ç¬¬å››æ­¥åŸºæœ¬å°±æ˜¯é‡å¤ä¸Šé¢æ‰©å®¹ container çš„æ­¥éª¤, è¿™é‡Œçœç•¥äº†å‰å‡ æ­¥çš„æŸ¥çœ‹å’Œè®¡ç®—</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; dmsetup <span class="built_in">suspend</span> docker-253:0-1700-pool \</span><br><span class="line">    &amp;&amp; dmsetup reload docker-253:0-1700-pool --table <span class="string">'0 419430400 thin-pool 7:1 7:0 128 32768 1 skip_block_zeroing'</span> \</span><br><span class="line">    &amp;&amp; dmsetup resume docker-253:0-1700-pool</span><br></pre></td></tr></table></figure>

<h2 id="æ³¨æ„-1"><a href="#æ³¨æ„-1" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h2><p>æ‰©å®¹ pool æ¶‰åŠåˆ°äº†ä¸¤ä¸ªè®¡ç®—</p>
<ul>
<li>data æ–‡ä»¶å¤§å°çš„è®¡ç®—</li>
<li>devicemapper æ‰‡åŒºæ•°é‡çš„è®¡ç®—</li>
</ul>
<p>ä¸Šé¢å·²ç»ç»™å‡ºäº†æ‰‡åŒºçš„è®¡ç®—å…¬å¼: <code>x*1024*1024*1024/512</code></p>
<p>data å¤§å°çš„è®¡ç®—å…¬å¼ä¸º: <code>x*1024*1024*1024</code></p>
<hr>
<p>å‚è€ƒæ–‡æ¡£:</p>
<p><a href="https://docs.docker.com/engine/userguide/storagedriver/device-mapper-driver/#/increase-capacity-on-a-running-device" target="_blank" rel="noopener">https://docs.docker.com/engine/userguide/storagedriver/device-mapper-driver/#/increase-capacity-on-a-running-device</a><br><a href="https://segmentfault.com/a/1190000002931564" target="_blank" rel="noopener">https://segmentfault.com/a/1190000002931564</a><br><a href="http://www.linuxidc.com/Linux/2015-01/112245.htm" target="_blank" rel="noopener">http://www.linuxidc.com/Linux/2015-01/112245.htm</a><br><a href="http://www.projectatomic.io/blog/2016/03/daemon_option_basedevicesize/" target="_blank" rel="noopener">http://www.projectatomic.io/blog/2016/03/daemon_option_basedevicesize/</a></p>
]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title>å¼€å¯GTIDçš„æƒ…å†µä¸‹å¯¼å‡ºå¯¼å…¥åº“çš„æ³¨æ„äº‹é¡¹</title>
    <url>/2016/10/28/%E5%BC%80%E5%90%AFGTID%E7%9A%84%E6%83%85%E5%86%B5%E4%B8%8B%E5%AF%BC%E5%87%BA%E5%AF%BC%E5%85%A5%E5%BA%93%E7%9A%84%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9/</url>
    <content><![CDATA[<blockquote>
<p>åœ¨å¼€å¯äº† GTID åŠŸèƒ½çš„ MySQL æ•°æ®åº“ä¸­, ä¸è®ºæ˜¯å¦ä½¿ç”¨äº† GTID çš„æ–¹å¼åšäº†ä¸»ä»åŒæ­¥, å¯¼å‡ºå¯¼å…¥æ—¶éƒ½éœ€è¦ç‰¹åˆ«æ³¨æ„æ•°æ®åº“ä¸­çš„ GTID ä¿¡æ¯. </p>
</blockquote>
<h1 id="å¯¼å‡º"><a href="#å¯¼å‡º" class="headerlink" title="å¯¼å‡º"></a>å¯¼å‡º</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">âœ  mysqldump -uroot -p userdb &gt; userdb.sql</span><br><span class="line">Warning: A partial dump from a server that has GTIDs will by default include the GTIDs of all transactions, even those that changed suppressed parts of the database. If you don<span class="string">'t want to restore GTIDs, pass --set-gtid-purged=OFF. To make a complete dump, pass --all-databases --triggers --routines --events</span></span><br></pre></td></tr></table></figure>

<p>mysqlæç¤º: å½“å‰æ•°æ®åº“å®ä¾‹ä¸­å¼€å¯äº† GTID åŠŸèƒ½, åœ¨å¼€å¯æœ‰ GTID åŠŸèƒ½çš„æ•°æ®åº“å®ä¾‹ä¸­, å¯¼å‡ºå…¶ä¸­ä»»ä½•ä¸€ä¸ªåº“, å¦‚æœæ²¡æœ‰æ˜¾ç¤ºåœ°æŒ‡å®š<code>--set-gtid-purged</code>å‚æ•°, éƒ½ä¼šæç¤ºè¿™ä¸€è¡Œä¿¡æ¯. æ„æ€æ˜¯é»˜è®¤æƒ…å†µä¸‹, å¯¼å‡ºçš„åº“ä¸­å«æœ‰ GTID ä¿¡æ¯, å¦‚æœä¸æƒ³å¯¼å‡ºåŒ…å«æœ‰ GTID ä¿¡æ¯çš„æ•°æ®åº“, éœ€è¦æ˜¾ç¤ºåœ°æ·»åŠ <code>--set-gtid-purged=OFF</code>å‚æ•°. äºæ˜¯ä¹, dump å˜æˆäº†å¦‚ä¸‹æ ·å­</p>
<p><code>âœ  mysqldump -uroot -p --set-gtid-purged=OFF userdb &gt; userdb.sql</code></p>
<p>ä½¿ç”¨ä»¥ä¸Šè¿™æ¡å‘½ä»¤ dump å‡ºæ¥çš„åº“æ˜¯ä¸åŒ…å« GTID ä¿¡æ¯çš„</p>
<h1 id="å¯¼å…¥"><a href="#å¯¼å…¥" class="headerlink" title="å¯¼å…¥"></a>å¯¼å…¥</h1><p>å¯¼å…¥çš„æ—¶å€™ä¹Ÿåˆ†ä¸¤ç§, ä¸€ç§æ˜¯å¯¼å…¥å¸¦æœ‰ GTID çš„ä¿¡æ¯çš„åº“, ä¸€ç§æ˜¯å¯¼å…¥ä¸å¸¦æœ‰ GTID ä¿¡æ¯çš„åº“</p>
<h2 id="ä¸å¸¦æœ‰-GTID-ä¿¡æ¯"><a href="#ä¸å¸¦æœ‰-GTID-ä¿¡æ¯" class="headerlink" title="ä¸å¸¦æœ‰ GTID ä¿¡æ¯"></a>ä¸å¸¦æœ‰ GTID ä¿¡æ¯</h2><p>ä¸å¸¦æœ‰ GTID ä¿¡æ¯çš„ dump æ–‡ä»¶, ä¸ç®¡ç›®æ ‡æ•°æ®åº“å®ä¾‹æ˜¯å¦å¼€å¯äº† GTID åŠŸèƒ½, ä¸”ä¸ç®¡æ•°æ®åº“å®ä¾‹æ˜¯å¦å·²æœ‰å…¶ä»– GTID ä¿¡æ¯, éƒ½å¯ä»¥é¡ºåˆ©å¯¼å…¥</p>
<h2 id="å¸¦æœ‰-GTID-ä¿¡æ¯"><a href="#å¸¦æœ‰-GTID-ä¿¡æ¯" class="headerlink" title="å¸¦æœ‰ GTID ä¿¡æ¯"></a>å¸¦æœ‰ GTID ä¿¡æ¯</h2><p>å¸¦æœ‰ GTID ä¿¡æ¯çš„ dump æ–‡ä»¶, è¦æ±‚ç›®æ ‡æ•°æ®åº“å®ä¾‹å¿…é¡»å¼€å¯ GTID åŠŸèƒ½, ä¸”å½“å‰æ•°æ®åº“ä¸­æ— å…¶ä»– GTID ä¿¡æ¯. å¦‚æœç›®æ ‡æ•°æ®åº“ä¸­å·²ç»è®°å½•äº†ä¸€æ¡æˆ–ä¸€æ¡ä»¥ä¸Šçš„ GTID ä¿¡æ¯, é‚£ä¹ˆåœ¨å¯¼å…¥æ•°æ®åº“æ—¶ä¼šæŠ¥å‡ºç±»ä¼¼å¦‚ä¸‹çš„é”™è¯¯âŒ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">âœ  mysql -uroot -p userdb &lt; userdb.sql</span><br><span class="line">Password:xxxxxxxx</span><br><span class="line">ERROR 1840 (HY000) at line 24: @@GLOBAL.GTID_PURGED can only be <span class="built_in">set</span> when @@GLOBAL.GTID_EXECUTED is empty.</span><br></pre></td></tr></table></figure>

<p>åœ¨ mysql5.7ç‰ˆæœ¬ä¸­åŠ å…¥äº†å¤š channel çš„ç‰¹æ€§, ä¸€å°æ•°æ®åº“å®ä¾‹å¯ä»¥åŒæ—¶ä¸å¤šä¸ªä¸»åº“åŒæ­¥, å®ç°å¤šä¸»ä¸€ä»æ¶æ„, ä½†æ˜¯å‡å¦‚ç°åœ¨æ•°æ®åº“å®ä¾‹ä¸­å¼€å¯äº† GTID, å¹¶ä»¥ GTID çš„æ–¹å¼ä¸ A ä¸»åº“å’Œ B ä¸»åº“åŒæ­¥,é‚£ä¹ˆç°åœ¨çš„ slave ä¸­å°±è®°å½•æœ‰ä¸¤æ¡ GTID ä¿¡æ¯. åœ¨å¯¼å…¥å¸¦æœ‰æ–° GTID ä¿¡æ¯çš„åº“æ—¶, ä¼šæŠ¥é”™, è¦æ±‚ä½ æ¸…é™¤æ‰ç›®æ ‡æ•°æ®åº“å®ä¾‹ä¸­æ‰€æœ‰çš„ GTID ä¿¡æ¯. åœ¨è¿™ç§æƒ…å†µä¸‹, é—®é¢˜å°±æ¯”è¾ƒä¸¥é‡äº†, å› ä¸ºæˆ‘çš„è¿™å°æ•°æ®åº“å·²ç»å’Œä¸¤å°ä¸»åº“å»ºç«‹ä¸»ä»å…³ç³», ç°åœ¨ä¸ºäº†å¯¼å…¥ä¸€ä¸ªæ–°åº“, éœ€è¦ reset æ‰æ‰€æœ‰åŒæ­¥ä¿¡æ¯(GTID ä¿¡æ¯)</p>
<p>è¿™ä¸ªæ—¶å€™ä½ æœ‰ä¸¤ä¸ªé€‰æ‹©:</p>
<ol>
<li>é‡æ–° dump æ•°æ®åº“, ä½¿ç”¨<code>--set-gtid-purged=OFF</code>çš„å‚æ•°ç¦æ­¢ğŸš«å¯¼å‡º GTID ä¿¡æ¯,å† load è¿›ç›®æ ‡æ•°æ®åº“</li>
<li>åœ¨ç›®æ ‡æ•°æ®åº“ä¸­æ‰§è¡Œ<code>mysql&gt; reset slave all;</code> <code>mysql&gt; reset master;</code> æ¸…ç©ºæ‰€æœ‰ GTID ä¿¡æ¯ä¹‹åå°±å¯ä»¥å¯¼å…¥äº†</li>
</ol>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>GTID</tag>
        <tag>mysqldump</tag>
        <tag>--set-gtid-purged</tag>
      </tags>
  </entry>
  <entry>
    <title>mysqlä¿®æ”¹sql_mode</title>
    <url>/2016/10/12/mysql%E4%BF%AE%E6%94%B9sql-mode/</url>
    <content><![CDATA[<h1 id="sql-mode"><a href="#sql-mode" class="headerlink" title="sql_mode"></a>sql_mode</h1><ul>
<li></li>
<li>ANSI</li>
<li>TRADITIONAL</li>
<li>STRICT_TRANS_TABLES</li>
</ul>
<h2 id="sql-modeä¸ºç©º"><a href="#sql-modeä¸ºç©º" class="headerlink" title="sql_modeä¸ºç©º"></a>sql_modeä¸ºç©º</h2><p>æœ€å®½æ¾çš„æ¨¡å¼, å³ä½¿æœ‰é”™è¯¯æ—¢ä¸ä¼šæŠ¥é”™ä¹Ÿä¸ä¼šæœ‰è­¦å‘Šâš ï¸</p>
<h2 id="ANSI"><a href="#ANSI" class="headerlink" title="ANSI"></a>ANSI</h2><p>å®½æ¾æ¨¡å¼ï¼Œå¯¹æ’å…¥æ•°æ®è¿›è¡Œæ ¡éªŒï¼Œå¦‚æœä¸ç¬¦åˆå®šä¹‰ç±»å‹æˆ–é•¿åº¦ï¼Œå¯¹æ•°æ®ç±»å‹è°ƒæ•´æˆ–æˆªæ–­ä¿å­˜ï¼ŒæŠ¥warningè­¦å‘Š</p>
<h2 id="TRADITIONAL"><a href="#TRADITIONAL" class="headerlink" title="TRADITIONAL"></a>TRADITIONAL</h2><p>ä¸¥æ ¼æ¨¡å¼ï¼Œå½“å‘mysqlæ•°æ®åº“æ’å…¥æ•°æ®æ—¶ï¼Œè¿›è¡Œæ•°æ®çš„ä¸¥æ ¼æ ¡éªŒï¼Œä¿è¯é”™è¯¯æ•°æ®ä¸èƒ½æ’å…¥ï¼ŒæŠ¥erroré”™è¯¯ã€‚ç”¨äºäº‹ç‰©æ—¶ï¼Œä¼šè¿›è¡Œäº‹ç‰©çš„å›æ»š</p>
<h2 id="STRICT-TRANS-TABLES"><a href="#STRICT-TRANS-TABLES" class="headerlink" title="STRICT_TRANS_TABLES"></a>STRICT_TRANS_TABLES</h2><p>ä¸¥æ ¼æ¨¡å¼ï¼Œè¿›è¡Œæ•°æ®çš„ä¸¥æ ¼æ ¡éªŒï¼Œé”™è¯¯æ•°æ®ä¸èƒ½æ’å…¥ï¼ŒæŠ¥erroré”™è¯¯</p>
<h2 id="NO-ENGINE-SUBSTITUTION"><a href="#NO-ENGINE-SUBSTITUTION" class="headerlink" title="NO_ENGINE_SUBSTITUTION"></a>NO_ENGINE_SUBSTITUTION</h2><p>no_engine_subtitutionçš„ä½œç”¨ï¼šmysql åœ¨create table æ—¶å¯ä»¥æŒ‡å®šengineå­å¥(æŒ‡å®šå­˜å‚¨å¼•æ“),å¦‚æœæŠŠå¼•æ“æŒ‡å®šæˆä¸€ä¸ªå¹¶ä¸å­˜åœ¨çš„å¼•æ“, è¿™ä¸ªæ—¶å€™mysqlå¯ä»¥æœ‰ä¸¤ç§è¡Œä¸ºä¾›é€‰æ‹©</p>
<ul>
<li>ç›´æ¥æŠ¥é”™</li>
<li>æŠŠè¡¨çš„å­˜å‚¨å¼•æ“æ›¿æ¢æˆinnodb</li>
</ul>
<p>å¦‚æœ sql_mode å­˜åœ¨ no_engine_subtitution çš„æ—¶å€™ ===&gt; ç›´æ¥æŠ¥é”™</p>
<p>å¦‚æœ sql_mode ä¸å­˜åœ¨ no_engine_subtitution çš„æ—¶å€™ ===&gt; æŠŠè¡¨çš„å­˜å‚¨å¼•æ“æ›¿æ¢æˆinnodb</p>
<h1 id="æŸ¥è¯¢-sql-mode"><a href="#æŸ¥è¯¢-sql-mode" class="headerlink" title="æŸ¥è¯¢ sql_mode"></a>æŸ¥è¯¢ sql_mode</h1><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt;  select @@sql_mode;</span><br><span class="line">+<span class="comment">------------------------+</span></span><br><span class="line">| @@sql_mode             |</span><br><span class="line">+<span class="comment">------------------------+</span></span><br><span class="line">| NO_ENGINE_SUBSTITUTION |</span><br><span class="line">+<span class="comment">------------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> @@global.sql_mode;</span><br><span class="line">+<span class="comment">------------------------+</span></span><br><span class="line">| @@global.sql_mode      |</span><br><span class="line">+<span class="comment">------------------------+</span></span><br><span class="line">| NO_ENGINE_SUBSTITUTION |</span><br><span class="line">+<span class="comment">------------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> @@session.sql_mode;</span><br><span class="line">+<span class="comment">------------------------+</span></span><br><span class="line">| @@session.sql_mode     |</span><br><span class="line">+<span class="comment">------------------------+</span></span><br><span class="line">| NO_ENGINE_SUBSTITUTION |</span><br><span class="line">+<span class="comment">------------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<h1 id="åœ¨çº¿ä¿®æ”¹-sql-mode"><a href="#åœ¨çº¿ä¿®æ”¹-sql-mode" class="headerlink" title="åœ¨çº¿ä¿®æ”¹ sql_mode"></a>åœ¨çº¿ä¿®æ”¹ sql_mode</h1><p><code>SET [GLOBAL|SESSION] sql_mode=&#39;modes&#39;</code></p>
<h2 id="å½“å‰-session-ç”Ÿæ•ˆ"><a href="#å½“å‰-session-ç”Ÿæ•ˆ" class="headerlink" title="å½“å‰ session ç”Ÿæ•ˆ"></a>å½“å‰ session ç”Ÿæ•ˆ</h2><figure class="highlight"><table><tr><td class="code"><pre><span class="line">mysql&gt; set sql_mode=`NO_FIELD_OPTIONS,HIGH_NOT_PRECEDENCE`;</span><br></pre></td></tr></table></figure>

<h2 id="å…¨å±€ç”Ÿæ•ˆ"><a href="#å…¨å±€ç”Ÿæ•ˆ" class="headerlink" title="å…¨å±€ç”Ÿæ•ˆ"></a>å…¨å±€ç”Ÿæ•ˆ</h2><figure class="highlight"><table><tr><td class="code"><pre><span class="line">mysql&gt; set global sql_mode=`NO_FIELD_OPTIONS,HIGH_NOT_PRECEDENCE`</span><br></pre></td></tr></table></figure>

<h1 id="ç¦»çº¿ä¿®æ”¹-sql-mode"><a href="#ç¦»çº¿ä¿®æ”¹-sql-mode" class="headerlink" title="ç¦»çº¿ä¿®æ”¹ sql_mode"></a>ç¦»çº¿ä¿®æ”¹ sql_mode</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">âœ  ~ vim /etc/my.cnf</span><br><span class="line"></span><br><span class="line">sql_mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES</span><br></pre></td></tr></table></figure>

<hr>
<p>å‚è€ƒæ–‡æ¡£: </p>
<ul>
<li>no_engine_subtitution: <a href="http://www.cnblogs.com/JiangLe/p/5621856.html" target="_blank" rel="noopener">http://www.cnblogs.com/JiangLe/p/5621856.html</a></li>
</ul>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>sql_mode</tag>
      </tags>
  </entry>
  <entry>
    <title>mysql5.7æ–°ç‰¹æ€§çš„å›°æ‰°ibtmp1æ–‡ä»¶è¿‡å¤§</title>
    <url>/2016/10/12/mysql5-7%E6%96%B0%E7%89%B9%E6%80%A7%E7%9A%84%E5%9B%B0%E6%89%B0ibtmp1%E6%96%87%E4%BB%B6%E8%BF%87%E5%A4%A7/</url>
    <content><![CDATA[<blockquote>
<p>åœ¨ä¸€å° MySQL5.7 çš„æœåŠ¡å™¨ä¸Šç£ç›˜ä½¿ç”¨ç©ºé—´çªç„¶çˆ†æ»¡, æŸ¥çœ‹ mysql æ•°æ®ç›®å½•ä¸‹çš„æ–‡ä»¶å‘ç°,æœ‰ä¸ªå«<code>ibtmp1</code>çš„æ–‡ä»¶å¤§å°è¾¾åˆ°äº†160GB. </p>
</blockquote>
<p>åç»è¿‡æŸ¥è¯¢å¾—çŸ¥, <code>ibtmp1</code>æ–‡ä»¶æ˜¯ MySQL5.7çš„æ–°ç‰¹æ€§,MySQL5.7ä½¿ç”¨äº†ç‹¬ç«‹çš„ä¸´æ—¶è¡¨ç©ºé—´æ¥å­˜å‚¨ä¸´æ—¶è¡¨æ•°æ®ï¼Œä½†ä¸èƒ½æ˜¯å‹ç¼©è¡¨ã€‚ä¸´æ—¶è¡¨ç©ºé—´åœ¨å®ä¾‹å¯åŠ¨çš„æ—¶å€™è¿›è¡Œåˆ›å»ºï¼Œshutdownçš„æ—¶å€™è¿›è¡Œåˆ é™¤ã€‚å³ä¸ºæ‰€æœ‰éå‹ç¼©çš„innodbä¸´æ—¶è¡¨æä¾›ä¸€ä¸ªç‹¬ç«‹çš„è¡¨ç©ºé—´ï¼Œé»˜è®¤çš„ä¸´æ—¶è¡¨ç©ºé—´æ–‡ä»¶ä¸ºibtmp1ï¼Œä½äºæ•°æ®ç›®å½•ã€‚æˆ‘ä»¬å¯é€šè¿‡innodb_temp_data_file_pathå‚æ•°æŒ‡å®šä¸´æ—¶è¡¨ç©ºé—´çš„è·¯å¾„å’Œå¤§å°ï¼Œé»˜è®¤12Mã€‚åªæœ‰é‡å¯å®ä¾‹æ‰èƒ½å›æ”¶ä¸´æ—¶è¡¨ç©ºé—´æ–‡ä»¶ibtmp1çš„å¤§å°ã€‚create temporary tableå’Œusing temporary tableå°†å…±ç”¨è¿™ä¸ªä¸´æ—¶è¡¨ç©ºé—´</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; show variables like 'innodb_temp_data_file_path';</span><br><span class="line">+<span class="comment">----------------------------+-----------------------+</span></span><br><span class="line">| Variable_name              | Value                 |</span><br><span class="line">+<span class="comment">----------------------------+-----------------------+</span></span><br><span class="line">| innodb_temp_data_file_path | ibtmp1:12M:autoextend |</span><br><span class="line">+<span class="comment">----------------------------+-----------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<p>ç‰©ç†æ–‡ä»¶</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">âœ  ~ du -sh ibtmp1 </span><br><span class="line">160G    ibtmp1</span><br></pre></td></tr></table></figure>

<p><strong>é‡Šæ”¾è¿™ä¸ªä¸´æ—¶è¡¨ç©ºé—´çš„å”¯ä¸€åŠæ³•æ˜¯é‡å¯æ•°æ®åº“</strong></p>
<hr>
<p>å®˜æ–¹æ–‡æ¡£: <a href="https://dev.mysql.com/doc/refman/5.7/en/innodb-parameters.html#sysvar_innodb_temp_data_file_path" target="_blank" rel="noopener">https://dev.mysql.com/doc/refman/5.7/en/innodb-parameters.html#sysvar_innodb_temp_data_file_path</a></p>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>ibtmp1</tag>
      </tags>
  </entry>
  <entry>
    <title>mysqlbinlogå‘½ä»¤æŸ¥çœ‹binglog_format=rowçš„æ—¥å¿—</title>
    <url>/2016/10/12/mysqlbinlog%E5%91%BD%E4%BB%A4%E6%9F%A5%E7%9C%8Bbinglog-format-row%E7%9A%84%E6%97%A5%E5%BF%97/</url>
    <content><![CDATA[<blockquote>
<p>åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®æœ‰<code>binglog_format=row</code>çš„æ•°æ®åº“äº§ç”Ÿçš„ binglog æ—¥å¿—æ˜¯ä¸èƒ½ä»¥æ­£å¸¸çš„<code>mysqlbinlog logfile</code>çš„æ–¹å¼æ‰“å¼€çš„, é»˜è®¤æƒ…å†µä¸‹åªèƒ½çœ‹åˆ°ä¸€äº›ç»è¿‡base-64ç¼–ç çš„ä¿¡æ¯</p>
</blockquote>
<ul>
<li>ä»MySQL 5.1.28å¼€å§‹ï¼Œmysqlbinlogå¤šäº†ä¸ªå‚æ•°â€“verbose(æˆ–-v)ï¼Œå°†æ”¹åŠ¨ç”Ÿæˆå¸¦æ³¨é‡Šçš„è¯­å¥ï¼Œå¦‚æœä½¿ç”¨ä¸¤æ¬¡è¿™ä¸ªå‚æ•°(å¦‚-v -v)ï¼Œä¼šç”Ÿæˆå­—æ®µçš„ç±»å‹ã€é•¿åº¦ã€æ˜¯å¦ä¸ºnullç­‰å±æ€§ä¿¡æ¯</li>
<li>åŠ â€“base64-output=DECODE-ROWSå‚æ•°è¿˜å¯ä»¥å»æ‰BINLOGå¼€å¤´çš„ä¿¡æ¯</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysqlbinlog -v -v <span class="comment">--base64-output=DECODE-ROWS mysql-bin.000003</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>binlog</tag>
        <tag>mysqlbinlog</tag>
      </tags>
  </entry>
  <entry>
    <title>mysqlbinlogæŠ¥é”™:unknown variable default-character-set=utf8mb4</title>
    <url>/2016/10/12/mysqlbinlog%E6%8A%A5%E9%94%99-unknown-variable-default-character-set-utf8mb4/</url>
    <content><![CDATA[<blockquote>
<p>ä½¿ç”¨ mysqlbinlog å‘½ä»¤æŸ¥çœ‹ binlog æ—¥å¿—æ—¶å‡ºç°<code>mysqlbinlog: unknown variable &#39;default-character-set=utf8mb4&#39;</code>çš„æŠ¥é”™, åŸå› æ˜¯åœ¨ mysql çš„é…ç½®æ–‡ä»¶ä¸­, æˆ‘è®¾ç½®é»˜è®¤å­—ç¬¦é›†ä¸º<code>utf8mb4</code>æ­¤å­—ç¬¦é›†ä¸º utf8 çš„æ‰©å±•å­—ç¬¦é›†,æ”¯æŒä¿å­˜ emojiğŸ˜ˆ è¡¨æƒ…, è§£å†³æ–¹æ¡ˆå¦‚ä¸‹</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">âœ  ~ mysqlbinlog mysql-bin.000256</span><br><span class="line">mysqlbinlog: unknown variable <span class="string">'default-character-set=utf8mb4'</span></span><br></pre></td></tr></table></figure>

<p><strong>åŸå› æ˜¯mysqlbinlogè¿™ä¸ªå·¥å…·æ— æ³•è¯†åˆ«binlogä¸­çš„é…ç½®ä¸­çš„default-character-set=utf8è¿™ä¸ªæŒ‡ä»¤</strong></p>
<p>è§£å†³çš„åŠæ³•æœ‰ä¸¤ä¸ª:</p>
<ol>
<li>å°†<code>/etc/my.cnf</code>ä¸­é…ç½®çš„<code>default-character-set = utf8mb4</code>ä¿®æ”¹ä¸º<code>character-set-server = utf8mb4</code> ä½†æ˜¯è¿™ç§ä¿®æ”¹æ–¹æ³•éœ€è¦é‡å¯æ•°æ®åº“, åœ¨çº¿ä¸Šä¸šåŠ¡åº“ä¸­ä½¿ç”¨è¿™ç§æ–¹æ³•æŸ¥çœ‹ binlog æ—¥å¿—å¹¶ä¸åˆ’ç®—~</li>
<li><code>mysqlbinlog --no-defaults mysql-bin.000256</code> å®Œç¾è§£å†³~</li>
</ol>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>binlog</tag>
        <tag>mysqlbinlog</tag>
      </tags>
  </entry>
  <entry>
    <title>å¼€å¯/å…³é—­SWAPåŠŸèƒ½+åˆ¶ä½œSWAPæ–‡ä»¶/åˆ†åŒº</title>
    <url>/2016/10/12/%E5%BC%80%E5%90%AF-%E5%85%B3%E9%97%ADSWAP%E5%8A%9F%E8%83%BD-%E5%88%B6%E4%BD%9CSWAP%E6%96%87%E4%BB%B6-%E5%88%86%E5%8C%BA/</url>
    <content><![CDATA[<blockquote>
<p>åœ¨ linux ä¸­å¯ä»¥ä½¿ç”¨<code>free -m</code>å‘½ä»¤æ¥æŸ¥çœ‹å†…å­˜çš„ä½¿ç”¨æƒ…å†µ(åŒ…æ‹¬ swap äº¤æ¢åˆ†åŒºçš„ä½¿ç”¨æƒ…å†µ)å…³äº swap å­˜åœ¨çš„æ„ä¹‰ä¸å†è®¨è®º, æœ‰çš„äººåœ¨æŸäº›æƒ…å†µä¸‹éœ€è¦å¼€å¯ swap åŠŸèƒ½ä»¥ä¿è¯ç¨‹åºä¸ä¼šå´©æºƒ; æœ‰çš„äººåœ¨æŸäº›æƒ…å†µä¸‹éœ€è¦å…³é—­ swap åŠŸèƒ½ä»¥ä¿è¯â€å®å®•æ¯‹æ…¢â€.</p>
</blockquote>
<h1 id="å¼€å¯-å…³é—­-swap-åŠŸèƒ½"><a href="#å¼€å¯-å…³é—­-swap-åŠŸèƒ½" class="headerlink" title="å¼€å¯/å…³é—­ swap åŠŸèƒ½"></a>å¼€å¯/å…³é—­ swap åŠŸèƒ½</h1><h2 id="å¼€å¯"><a href="#å¼€å¯" class="headerlink" title="å¼€å¯"></a>å¼€å¯</h2><ul>
<li>swap æ–‡ä»¶: <code>swapon /opt/swapfile</code></li>
<li>swap åˆ†åŒº: <code>swapon /dev/sdb1</code></li>
</ul>
<h2 id="å…³é—­"><a href="#å…³é—­" class="headerlink" title="å…³é—­"></a>å…³é—­</h2><ul>
<li>swap æ–‡ä»¶: <code>swapoff /opt/swapfile</code></li>
<li>swap åˆ†åŒº: <code>swapoff /dev/sdb1</code></li>
</ul>
<p>å¦‚æœæ˜¯ç³»ç»Ÿåœ¨å®‰è£…æ—¶è®¾ç½®äº† swap, åœ¨åæœŸæƒ³è¦å…³é—­ swap åŠŸèƒ½,å¯ä»¥å»ä¿®æ”¹<code>/etc/fstab</code>æ–‡ä»¶</p>
<p>å°†åŒ…å«æœ‰ swap ä¿¡æ¯çš„è¿™ä¸€è¡Œæ³¨é‡Šæ‰<code>/dev/mapper/centos-swap swap                    swap    defaults        0 0</code></p>
<h1 id="å¢åŠ -swap-ç©ºé—´"><a href="#å¢åŠ -swap-ç©ºé—´" class="headerlink" title="å¢åŠ  swap ç©ºé—´"></a>å¢åŠ  swap ç©ºé—´</h1><h2 id="åˆ¶ä½œ-swap-æ–‡ä»¶"><a href="#åˆ¶ä½œ-swap-æ–‡ä»¶" class="headerlink" title="åˆ¶ä½œ swap æ–‡ä»¶"></a>åˆ¶ä½œ swap æ–‡ä»¶</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ª1Gçš„æ–‡ä»¶ä½œä¸ºäº¤æ¢åˆ†åŒºä½¿ç”¨</span></span><br><span class="line">âœ  ~ dd <span class="keyword">if</span>=/dev/zero of=/opt/swapfile bs=1M count=1000</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ ¼å¼åŒ–æˆswapåˆ†åŒº</span></span><br><span class="line">âœ  ~ mkswap /opt/swapfile</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰“å¼€swapåˆ†åŒº</span></span><br><span class="line">âœ  ~ swapon /opt/swapfile</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨/etc/fstabä¸­å¢åŠ ä¸€æ¡è®°å½•å¦‚ä¸‹</span></span><br><span class="line">/opt/swapfile    swap   swap defaults 0 0</span><br></pre></td></tr></table></figure>

<h2 id="åˆ¶ä½œ-swap-åˆ†åŒº"><a href="#åˆ¶ä½œ-swap-åˆ†åŒº" class="headerlink" title="åˆ¶ä½œ swap åˆ†åŒº"></a>åˆ¶ä½œ swap åˆ†åŒº</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ª swap åˆ†åŒº</span></span><br><span class="line">âœ  ~ fdisk /dev/sdb</span><br><span class="line">		<span class="comment"># æ–°å»ºä¸€ä¸ªåˆ†åŒº</span></span><br><span class="line">		n</span><br><span class="line">		p</span><br><span class="line">		default</span><br><span class="line">		default</span><br><span class="line">		...</span><br><span class="line">		<span class="comment"># ä¿®æ”¹åˆ†åŒº id ä¸ºswap</span></span><br><span class="line">		t</span><br><span class="line">		82</span><br><span class="line">		<span class="comment"># å†™å…¥åˆ†åŒºè¡¨</span></span><br><span class="line">		w</span><br><span class="line">		</span><br><span class="line"><span class="comment"># åŒæ­¥å†…å­˜å’Œåˆ†åŒºè¡¨ä¿¡æ¯</span></span><br><span class="line">âœ  ~  partprobe</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ ¼å¼åŒ–æˆ swap åˆ†åŒº</span></span><br><span class="line">âœ  ~  mkswap /dev/sdb1</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰“å¼€ swap åˆ†åŒº</span></span><br><span class="line">âœ  ~  swapon /dev/sdb1</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨/etc/fstabä¸­å¢åŠ ä¸€æ¡è®°å½•å¦‚ä¸‹</span></span><br><span class="line">/opt/swapfile    swap   swap defaults 0 0</span><br></pre></td></tr></table></figure>

<p><em>Tips: å¦‚æœæœ¬æœºå·²æœ‰2G swap äº¤æ¢åˆ†åŒº,åˆåˆ¶ä½œäº†ä¸€ä¸ª8G çš„ swap åˆ†åŒºæ–‡ä»¶, é‚£ä¹ˆåœ¨æ‰§è¡Œ<code>swapon</code>å‘½ä»¤ä¹‹å, swap ç©ºé—´å°†ä¸º10G(swap ç©ºé—´ä¼šç´¯åŠ )</em></p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>swap</tag>
        <tag>swapoff</tag>
        <tag>swapon</tag>
      </tags>
  </entry>
  <entry>
    <title>æ£€æµ‹TCP/UDPç«¯å£æ˜¯å¦å¯ç”¨</title>
    <url>/2016/10/12/%E6%A3%80%E6%B5%8BTCP-UDP%E7%AB%AF%E5%8F%A3%E6%98%AF%E5%90%A6%E5%8F%AF%E7%94%A8/</url>
    <content><![CDATA[<blockquote>
<p>åœ¨æ—¥å¸¸è¿ç»´ä¸­,æˆ‘ä»¬å¸¸å¸¸éœ€è¦æ£€æŸ¥è¿œç¨‹æœåŠ¡å™¨çš„æŸä¸ªç«¯å£æ˜¯å¦å¯ç”¨,æ˜¯å¦å¯ä»¥è¿é€š. å¦‚æœè¿œç¨‹æœåŠ¡å™¨æ˜¯ä½¿ç”¨äº† TCP åè®®ç›‘å¬äº†ç«¯å£, æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ telnet å‘½ä»¤æ¥æµ‹è¯•ç«¯å£çš„è¿é€šæ€§; å¦‚æœè¿œç¨‹æœåŠ¡å™¨ä½¿ç”¨çš„äº† UDP åè®®ç›‘å¬äº†ç«¯å£, æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ nc å‘½ä»¤æ¥æµ‹è¯•ç«¯å£çš„è¿é€šæ€§. ä¸‹é¢å°±å¯¹è¿™ä¸¤ä¸ªå‘½ä»¤åšç®€å•çš„ä½¿ç”¨ä»‹ç»</p>
</blockquote>
<h1 id="telnet-gt-TCP"><a href="#telnet-gt-TCP" class="headerlink" title="telnet ===&gt; TCP"></a>telnet ===&gt; TCP</h1><p>telnet å‘½ä»¤çš„å¸¸ç”¨è¯­æ³•: <code>telnet IP port</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">âœ  ~ telnet 192.168.10.159 22</span><br><span class="line">Trying 192.168.10.159...</span><br><span class="line">Connected to localhost.</span><br><span class="line">Escape character is <span class="string">'^]'</span>.</span><br><span class="line">SSH-2.0-OpenSSH_6.6.1</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šæµ‹è¯•å³ä¸ºå¯ä»¥è¿é€š,è€Œä¸”æ˜¾ç¤ºå‡ºäº†åº”ç”¨çš„åç§°<code>SSH</code></p>
<p>é€€å‡º telnet å¯æ˜¯æŒ‰ <code>Ctrl+]</code> ç»„åˆé”®, å¾—åˆ° <code>&gt;</code> å‘½ä»¤ç»ˆç«¯å,å†è¾“å…¥ <code>quit</code> é€€å‡ºç»ˆç«¯</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">âœ  ~ telnet 192.168.10.159 22</span><br><span class="line">Trying 192.168.10.159...</span><br><span class="line">Connected to localhost.</span><br><span class="line">Escape character is <span class="string">'^]'</span>.</span><br><span class="line">SSH-2.0-OpenSSH_6.6.1</span><br><span class="line">^]</span><br><span class="line">telnet&gt; quit</span><br><span class="line">Connection closed.</span><br></pre></td></tr></table></figure>

<p><em>telnet çš„å…¶ä»–ç”¨æ³•è¯·è‡ªè¡Œç™¾åº¦ä¸€ä¸‹/è°·æ­Œä¸€ä¸‹</em>ğŸ˜†</p>
<h1 id="nc-gt-UDP"><a href="#nc-gt-UDP" class="headerlink" title="nc ===&gt; UDP"></a>nc ===&gt; UDP</h1><p>udp åè®®ç›‘å¬çš„ç«¯å£æ˜¯ä¸èƒ½ç”¨ telnet å‘½ä»¤æ¥æµ‹è¯•çš„,è¿™é‡Œç”¨åˆ°äº† nc å‘½ä»¤</p>
<p>nc å‘½ä»¤çš„å¸¸ç”¨è¯­æ³•: <code>nc -zuv IP port</code></p>
<ul>
<li>z å°†è¾“å…¥è¾“å‡ºå…³é—­</li>
<li>u å¼€å¯ UDP æ¨¡å¼</li>
<li>v å¾—åˆ°è¯¦ç»†è¾“å‡º</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">âœ  ~ nc -zuv 192.168.10.159 4500</span><br><span class="line">found 0 associations</span><br><span class="line">found 1 connections:</span><br><span class="line">     1:	flags=82&lt;CONNECTED,PREFERRED&gt;</span><br><span class="line">	outif (null)</span><br><span class="line">	src 10.1.100.12 port 53092</span><br><span class="line">	dst 192.168.10.159 port 4500</span><br><span class="line">	rank info not available</span><br><span class="line"></span><br><span class="line">Connection to 192.168.10.159 port 4500 [udp/ipsec-msft] succeeded!</span><br></pre></td></tr></table></figure>

<p>nc æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ç½‘ç»œå·¥å…·, åŠŸèƒ½ä¸ä»…é™äºæ­¤</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>TCP</tag>
        <tag>UDP</tag>
        <tag>nc</tag>
        <tag>telnet</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOSä¸‹æ·»åŠ é™æ€è·¯ç”±</title>
    <url>/2016/10/12/CentOS%E4%B8%8B%E6%B7%BB%E5%8A%A0%E9%9D%99%E6%80%81%E8%B7%AF%E7%94%B1/</url>
    <content><![CDATA[<h1 id="æŸ¥çœ‹å½“å‰è·¯ç”±è¡¨"><a href="#æŸ¥çœ‹å½“å‰è·¯ç”±è¡¨" class="headerlink" title="æŸ¥çœ‹å½“å‰è·¯ç”±è¡¨"></a>æŸ¥çœ‹å½“å‰è·¯ç”±è¡¨</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; route</span><br><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br><span class="line">default         localhost       0.0.0.0         UG    100    0        0 eno16780032</span><br><span class="line">172.17.0.0      0.0.0.0         255.255.0.0     U     0      0        0 docker0</span><br><span class="line">192.168.10.0    0.0.0.0         255.255.255.0   U     100    0        0 eno16780032</span><br></pre></td></tr></table></figure>

<p><em>macOS ä¸­ä½¿ç”¨ <code>netstat -nr</code> å‘½ä»¤æ¥æŸ¥çœ‹å½“å‰è·¯ç”±è¡¨</em></p>
<ul>
<li>Destination ç›®æ ‡ç½‘è·¯</li>
<li>Gateway ç½‘å…³</li>
<li>Genmask æ©ç </li>
<li>Flags æ ‡è¯†<ul>
<li>U è·¯ç”±å·²ç»å¯åŠ¨</li>
<li>H è·¯ç”±ç›®æ ‡ä¸ºä¸»æœº</li>
<li>G ä½¿ç”¨ç½‘å…³</li>
<li>R ä¸ºåŠ¨æ€è·¯ç”±å¤åŸè·¯ç”±è¡¨</li>
<li>D ç”±å®ˆæŠ¤è¿›ç¨‹æˆ–é—´æ¥åŠ¨æ€å®‰è£…</li>
<li>M è¢«è·¯ç”±å®ˆæŠ¤è¿›ç¨‹æˆ–é—´æ¥ä¿®æ”¹</li>
<li>A é€šè¿‡addrconfä¿®æ”¹</li>
<li>C ç¼“å­˜æ¡ç›®</li>
<li>! æ‹’ç»è·¯ç”±</li>
</ul>
</li>
<li>Metric è·¯ç”±å¼€é”€, åˆ°ç›®æ ‡çš„â€˜è·ç¦»â€™ï¼ˆé€šå¸¸åŸºäºè·³æ•°ç»Ÿè®¡ï¼‰</li>
<li>Ref å‚è€ƒæ­¤è·¯ç”±çš„æ•°é‡</li>
<li>Use è·¯ç”±æŸ¥æ‰¾è®¡æ•°ã€‚ä¾èµ–ä¸ä½¿ç”¨-F è¿˜æ˜¯-Cé€‰é¡¹ï¼Œè¿™ä¸ªå€¼è¦ä¹ˆæ˜¯è·¯ç”±ç¼“å­˜æœªå‘½ä¸­æ•°è¦ä¹ˆæ˜¯å‘½ä¸­æ•°</li>
<li>Iface æ­¤è·¯ç”±æ•°æ®åŒ…å‘é€åˆ°çš„ç½‘ç»œæ¥å£</li>
</ul>
<h1 id="æ·»åŠ è·¯ç”±"><a href="#æ·»åŠ è·¯ç”±" class="headerlink" title="æ·»åŠ è·¯ç”±"></a>æ·»åŠ è·¯ç”±</h1><h2 id="æ·»åŠ åˆ°ä¸»æœºçš„è·¯ç”±"><a href="#æ·»åŠ åˆ°ä¸»æœºçš„è·¯ç”±" class="headerlink" title="æ·»åŠ åˆ°ä¸»æœºçš„è·¯ç”±"></a>æ·»åŠ åˆ°ä¸»æœºçš„è·¯ç”±</h2><p><code>route add â€“host 192.168.59.2 dev eth1</code></p>
<p><code>route add â€“host 192.168.59.2 gw 192.168.10.85</code></p>
<h2 id="æ·»åŠ åˆ°ç½‘ç»œçš„è·¯ç”±"><a href="#æ·»åŠ åˆ°ç½‘ç»œçš„è·¯ç”±" class="headerlink" title="æ·»åŠ åˆ°ç½‘ç»œçš„è·¯ç”±"></a>æ·»åŠ åˆ°ç½‘ç»œçš„è·¯ç”±</h2><p><code>route add -net 192.168.248.0/24 gw 192.168.10.85</code></p>
<p><code>route add â€“net 192.168.248.0 netmask 255.255.255.0 gw 192.168.10.85</code></p>
<p><code>route add â€“net 192.168.248.0 netmask 255.255.255.0 dev eth1</code></p>
<h2 id="æ·»åŠ é»˜è®¤ç½‘å…³"><a href="#æ·»åŠ é»˜è®¤ç½‘å…³" class="headerlink" title="æ·»åŠ é»˜è®¤ç½‘å…³"></a>æ·»åŠ é»˜è®¤ç½‘å…³</h2><p><code>route add default gw 192.168.10.85</code></p>
<p><code>route add -net 0.0.0.0 gw 192.168.10.85</code></p>
<p><strong>ä½¿ç”¨route å‘½ä»¤æ·»åŠ çš„è·¯ç”±ï¼Œæœºå™¨é‡å¯æˆ–è€…ç½‘å¡é‡å¯åè·¯ç”±å°±å¤±æ•ˆäº†</strong></p>
<h1 id="åˆ é™¤è·¯ç”±"><a href="#åˆ é™¤è·¯ç”±" class="headerlink" title="åˆ é™¤è·¯ç”±"></a>åˆ é™¤è·¯ç”±</h1><p><code>route del â€“host 192.168.10.85 dev eth1</code></p>
<p><em>æ€ä¹ˆ add çš„å°±æ€ä¹ˆ del æ‰. ä½†æ˜¯ del çš„æ—¶å€™å¯ä»¥ä¸å†™ç½‘å…³</em></p>
<h1 id="æ°¸ä¹…æ·»åŠ è·¯ç”±"><a href="#æ°¸ä¹…æ·»åŠ è·¯ç”±" class="headerlink" title="æ°¸ä¹…æ·»åŠ è·¯ç”±"></a>æ°¸ä¹…æ·»åŠ è·¯ç”±</h1><ul>
<li>åœ¨<code>/etc/rc.local</code>é‡Œæ·»åŠ è·¯ç”±ä¿¡æ¯</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">route add -net 192.168.247.0&#x2F;24 dev eth1</span><br><span class="line">route add -net 192.168.110.0&#x2F;24 gw 192.168.10.85</span><br></pre></td></tr></table></figure>

<ul>
<li>åœ¨<code>/etc/sysconfig/network</code>é‡Œæ·»åŠ åˆ°æœ«å°¾<code>GATEWAY=gw-ip æˆ–è€… GATEWAY=gw-dev</code></li>
<li>åœ¨<code>/etc/sysconfig/static-router</code>æ·»åŠ <code>any net x.x.x.x/24 gw y.y.y.y</code></li>
</ul>
<h2 id="æ°¸ä¹…æ·»åŠ è·¯ç”±æ›´æ–°-2018-10-12"><a href="#æ°¸ä¹…æ·»åŠ è·¯ç”±æ›´æ–°-2018-10-12" class="headerlink" title="æ°¸ä¹…æ·»åŠ è·¯ç”±æ›´æ–° 2018-10-12"></a>æ°¸ä¹…æ·»åŠ è·¯ç”±æ›´æ–° 2018-10-12</h2><p><strong>CentOS7ä¸‹æ¨èä½¿ç”¨ä¸Šé¢ç¬¬ä¸‰ç§æ–¹æ³•æ·»åŠ æ°¸ä¹…é™æ€è·¯ç”±</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@centos7 ~]<span class="comment"># vi /etc/sysconfig/network-scripts/route-enp0s3</span></span><br><span class="line">10.15.150.0/24 via 192.168.150.253 dev enp0s3</span><br><span class="line">10.25.250.0/24 via 192.168.150.253 dev enp0s3</span><br></pre></td></tr></table></figure>

<p>å°†æ°¸ä¹…é™æ€è·¯ç”±éœ€è¦å†™åˆ° /etc/sysconfig/network-scripts/route-interface æ–‡ä»¶ä¸­</p>
<p>æ³¨æ„:</p>
<p><strong>ifcfg-enp0s3 æ–‡ä»¶æ”¹åä¸º ifcfg-eth0 åï¼Œroute-enp0s3 æ–‡ä»¶ä¹Ÿè¦æ”¹åä¸º route-eth0</strong></p>
<hr>
<p>å‚è€ƒæ–‡æ¡£:</p>
<ul>
<li><a href="https://www.cnblogs.com/panblack/p/Centos7_Static_Routes.html" target="_blank" rel="noopener">https://www.cnblogs.com/panblack/p/Centos7_Static_Routes.html</a></li>
</ul>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>route</tag>
        <tag>é™æ€è·¯ç”±</tag>
      </tags>
  </entry>
  <entry>
    <title>kvmè™šæ‹Ÿæœºè¿ç§»è‡³ESXi</title>
    <url>/2016/09/09/kvm%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%BF%81%E7%A7%BB%E8%87%B3ESXi/</url>
    <content><![CDATA[<h1 id="è½¬æ¢æ­¥éª¤"><a href="#è½¬æ¢æ­¥éª¤" class="headerlink" title="è½¬æ¢æ­¥éª¤"></a>è½¬æ¢æ­¥éª¤</h1><ul>
<li>å°†kvmä¸­è¦è¿ç§»çš„è™šæ‹Ÿæœºå…³æœº</li>
<li>æ‰¾åˆ°è¯¥è™šæ‹Ÿæœºå¯¹åº”çš„<code>.img</code>æ–‡ä»¶</li>
<li>ä½¿ç”¨<code>qemu-img convert</code>å‘½ä»¤å°†imgæ–‡ä»¶è½¬æ¢ä¸º<code>vmdk</code>æ–‡ä»¶</li>
<li>æŠŠ<code>vmdk</code>æ–‡ä»¶ä¼ é€åˆ°<code>ESXi</code>ä¸»æœºä¸Š</li>
<li>åœ¨<code>vCenter</code>ä¸­åˆ›å»ºä¸€ä¸ªé…ç½®ç›¸åŒçš„ä¸»æœºï¼ŒåŠ è½½å·²å­˜åœ¨çš„<code>vmdk</code>ç¡¬ç›˜æ–‡ä»¶</li>
<li>å¼€å¯è™šæ‹Ÿæœºå³å¯</li>
</ul>
<h1 id="qemu-imgå‘½ä»¤çš„æ—¶å€™ç”¨"><a href="#qemu-imgå‘½ä»¤çš„æ—¶å€™ç”¨" class="headerlink" title="qemu-imgå‘½ä»¤çš„æ—¶å€™ç”¨"></a>qemu-imgå‘½ä»¤çš„æ—¶å€™ç”¨</h1><p><code>qemu-img</code>å‘½â€‹ä»¤â€‹è¡Œâ€‹å·¥â€‹å…·â€‹æ˜¯â€‹<code>Xen</code>å’Œâ€‹<code>KVM</code>ç”¨â€‹æ¥â€‹æ ¼â€‹å¼â€‹åŒ–â€‹å„â€‹ç§â€‹æ–‡â€‹ä»¶â€‹ç³»â€‹ç»Ÿâ€‹çš„â€‹ï¼Œå¯â€‹ä½¿â€‹ç”¨â€‹<code>qemu-img</code>æ ¼â€‹å¼â€‹åŒ–â€‹è™šâ€‹æ‹Ÿâ€‹å®¢â€‹æˆ·â€‹ç«¯â€‹æ˜ â€‹åƒâ€‹ã€â€‹é™„â€‹åŠ â€‹å­˜â€‹å‚¨â€‹è®¾â€‹å¤‡â€‹ä»¥â€‹åŠâ€‹ç½‘â€‹ç»œâ€‹å­˜â€‹å‚¨â€‹ã€‚è¿˜å¯ä»¥ç”¨æ¥è½¬æ¢é•œåƒæ–‡ä»¶</p>
<h2 id="åˆ›å»ºç£ç›˜æ–‡ä»¶"><a href="#åˆ›å»ºç£ç›˜æ–‡ä»¶" class="headerlink" title="åˆ›å»ºç£ç›˜æ–‡ä»¶"></a>åˆ›å»ºç£ç›˜æ–‡ä»¶</h2><p><strong>åˆ›â€‹å»ºâ€‹æ–°â€‹ç£â€‹ç›˜â€‹æ˜ â€‹åƒâ€‹æ–‡â€‹ä»¶â€‹åâ€‹ä¸ºâ€‹ sina_kvmï¼Œæ ¼â€‹å¼â€‹ä¸ºâ€‹ format</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">qemu-img create [-6] [-e] [-b base_image] [-f format] filename [sina_kvm]</span><br></pre></td></tr></table></figure>

<p>ä¾‹å¦‚ï¼šåˆ›å»ºä¸€ä¸ª10Mçš„é•œåƒæ–‡ä»¶ï¼šps_kvm.imgï¼Œæ–‡ä»¶æ ¼å¼ä¸ºï¼šraw</p>
<h2 id="è½¬æ¢é•œåƒæ ¼å¼"><a href="#è½¬æ¢é•œåƒæ ¼å¼" class="headerlink" title="è½¬æ¢é•œåƒæ ¼å¼"></a>è½¬æ¢é•œåƒæ ¼å¼</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">qemu-img convert [-c] [-e] [-f format] filename [-O output_format] output_filename</span><br></pre></td></tr></table></figure>

<p>ä¾‹å¦‚ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">qemu-img convert 10-71-hadoop.shennong.ren.img -O vmdk /tmp/testhdp.vmdk</span><br></pre></td></tr></table></figure>

<h2 id="è·å–é•œåƒä¿¡æ¯"><a href="#è·å–é•œåƒä¿¡æ¯" class="headerlink" title="è·å–é•œåƒä¿¡æ¯"></a>è·å–é•œåƒä¿¡æ¯</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">qemu-img info [-f format] filename</span><br></pre></td></tr></table></figure>

<h2 id="æ”¯æŒçš„æ ¼å¼"><a href="#æ”¯æŒçš„æ ¼å¼" class="headerlink" title="æ”¯æŒçš„æ ¼å¼"></a>æ”¯æŒçš„æ ¼å¼</h2><p>æ˜ â€‹åƒâ€‹æ ¼â€‹å¼â€‹é€šâ€‹å¸¸â€‹æ˜¯â€‹è‡ªâ€‹åŠ¨â€‹è·â€‹å–â€‹çš„â€‹ã€‚â€‹æ”¯â€‹æŒâ€‹ä»¥â€‹ä¸‹â€‹æ ¼â€‹å¼â€‹ï¼š</p>
<ul>
<li>raw</li>
</ul>
<p>Raw ç£â€‹ç›˜â€‹æ˜ â€‹åƒâ€‹æ ¼â€‹å¼â€‹ï¼ˆé»˜â€‹è®¤â€‹ï¼‰ã€‚â€‹è¿™â€‹ä¸ªâ€‹æ ¼â€‹å¼â€‹çš„â€‹ä¼˜â€‹ç‚¹â€‹æ˜¯â€‹å¯â€‹ä»¥â€‹ç®€â€‹å•â€‹ã€â€‹å®¹â€‹æ˜“â€‹åœ°â€‹å¯¼â€‹å‡ºâ€‹åˆ°â€‹å…¶â€‹å®ƒâ€‹æ¨¡â€‹æ‹Ÿâ€‹å™¨â€‹ä¸­â€‹ã€‚â€‹å¦‚â€‹æœâ€‹æ‚¨â€‹çš„â€‹æ–‡â€‹ä»¶â€‹ç³»â€‹ç»Ÿâ€‹æ”¯â€‹æŒâ€‹ä¸­â€‹æ–­â€‹ï¼ˆä¾‹â€‹å¦‚â€‹åœ¨â€‹ Linux ä¸­â€‹çš„â€‹ ext2 æˆ–â€‹è€…â€‹ ext3 ä»¥â€‹åŠâ€‹ Windows ä¸­â€‹çš„â€‹ NTFSï¼‰ï¼Œé‚£â€‹ä¹ˆâ€‹åªâ€‹æœ‰â€‹å†™â€‹å…¥â€‹çš„â€‹å­—â€‹æ®µâ€‹ä¼šâ€‹å â€‹ç”¨â€‹ç©ºâ€‹é—´â€‹ã€‚â€‹ä½¿â€‹ç”¨â€‹ qemu-img info äº†â€‹è§£â€‹ Unix/Linux ä¸­â€‹æ˜ â€‹åƒâ€‹æˆ–â€‹è€…â€‹ ls -ls ä½¿â€‹ç”¨â€‹çš„â€‹å®â€‹é™…â€‹å¤§â€‹å°â€‹ã€‚â€‹</p>
<ul>
<li>qcow2</li>
</ul>
<p>QEMU æ˜ â€‹åƒâ€‹æ ¼â€‹å¼â€‹ï¼Œæœ€â€‹ä¸‡â€‹èƒ½â€‹çš„â€‹æ ¼â€‹å¼â€‹ã€‚â€‹ä½¿â€‹ç”¨â€‹å®ƒâ€‹å¯â€‹è·â€‹å¾—â€‹è¾ƒâ€‹å°â€‹æ˜ â€‹åƒâ€‹ï¼ˆå¦‚â€‹æœâ€‹æ‚¨â€‹çš„â€‹ç³»â€‹ç»Ÿâ€‹ä¸â€‹æ”¯â€‹æŒâ€‹ä¸­â€‹æ–­â€‹ï¼Œä¾‹â€‹å¦‚â€‹åœ¨â€‹ Windows ä¸­â€‹ï¼Œå®ƒâ€‹ä¼šâ€‹å¾ˆâ€‹æœ‰â€‹ç”¨â€‹ï¼‰ã€â€‹é¢â€‹å¤–â€‹çš„â€‹ AES åŠ â€‹å¯†â€‹æ³•â€‹ã€â€‹zlib å‹â€‹ç¼©â€‹ä»¥â€‹åŠâ€‹å¯¹â€‹å¤šâ€‹ VM å¿«â€‹ç…§â€‹çš„â€‹æ”¯â€‹æŒâ€‹ã€‚â€‹ç›®å‰ä¹Ÿæ˜¯è™šæ‹Ÿæ± ä¸€ç›´åœ¨ä½¿ç”¨çš„é•œåƒæ ¼å¼ã€‚<br>ä¾‹å¦‚ï¼š<br>è½¬æ¢ä¹‹å‰ï¼ŒåŸé•œåƒdisk sizeå¤§å°ä¸º8Gï¼Œè½¬æ¢åä»…ä»…åªæœ‰2.3Gã€‚</p>
<ul>
<li>qcow</li>
</ul>
<p>æ—§â€‹çš„â€‹ QEMU æ˜ â€‹åƒâ€‹æ ¼â€‹å¼â€‹ã€‚â€‹åªâ€‹ç”¨â€‹äºâ€‹ä¸â€‹æ—§â€‹ç‰ˆâ€‹æœ¬â€‹å…¼â€‹å®¹â€‹ï¼Œç›®å‰è™šæ‹Ÿæ± å·²æ— è¯¥æ ¼å¼é•œåƒæ–‡ä»¶ã€‚â€‹</p>
<ul>
<li>cow</li>
</ul>
<p>å†™â€‹å…¥â€‹æ˜ â€‹åƒâ€‹æ ¼â€‹å¼â€‹çš„â€‹ç”¨â€‹æˆ·â€‹æ¨¡â€‹å¼â€‹ Linux å‰¯â€‹æœ¬â€‹ã€‚â€‹åŒ…â€‹å«â€‹ cow æ ¼â€‹å¼â€‹çš„â€‹ç›®â€‹çš„â€‹åªâ€‹æ˜¯â€‹ä¸ºâ€‹äº†â€‹ä¸â€‹å‰â€‹é¢â€‹çš„â€‹ç‰ˆâ€‹æœ¬â€‹å…¼â€‹å®¹â€‹ã€‚â€‹å®ƒâ€‹æ— â€‹æ³•â€‹åœ¨â€‹ Windows ä¸­â€‹ä½¿â€‹ç”¨â€‹ï¼Œè™šæ‹Ÿæ± å·²æ— è¯¥æ ¼å¼é•œåƒæ–‡ä»¶ã€‚</p>
<ul>
<li>vmdk</li>
</ul>
<p>VMware 3 å’Œâ€‹ 4 å…¼â€‹å®¹â€‹æ˜ â€‹åƒâ€‹æ ¼â€‹å¼ï¼Œè™šæ‹Ÿæ± æ— è¯¥æ ¼å¼é•œåƒæ–‡ä»¶â€‹ã€‚â€‹</p>
<ul>
<li>cloop</li>
</ul>
<p>Linux å‹â€‹ç¼©â€‹å›â€‹é€â€‹æ˜ â€‹åƒâ€‹ï¼Œåªâ€‹æœ‰â€‹åœ¨â€‹é‡â€‹å¤â€‹ä½¿â€‹ç”¨â€‹ç›´â€‹æ¥â€‹å‹â€‹ç¼©â€‹çš„â€‹ CD-ROM æ˜ â€‹åƒâ€‹æ—¶â€‹æœ‰â€‹ç”¨â€‹ï¼Œæ¯”â€‹å¦‚â€‹åœ¨â€‹ Knoppix CD-ROM ä¸­â€‹ã€‚</p>
<hr>
<p><em>å‚è€ƒæ–‡ç« </em></p>
<ul>
<li><a href="http://blog.sina.com.cn/s/blog_502c8cc40101352g.html" target="_blank" rel="noopener">http://blog.sina.com.cn/s/blog_502c8cc40101352g.html</a></li>
</ul>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>ESXi</tag>
        <tag>kvm</tag>
        <tag>qemu-img</tag>
      </tags>
  </entry>
  <entry>
    <title>Linuxè¿æ¥PPTPåè®®çš„VPN</title>
    <url>/2016/09/09/Linux%E8%BF%9E%E6%8E%A5PPTP%E5%8D%8F%E8%AE%AE%E7%9A%84VPN/</url>
    <content><![CDATA[<h1 id="å®‰è£…è½¯ä»¶"><a href="#å®‰è£…è½¯ä»¶" class="headerlink" title="å®‰è£…è½¯ä»¶"></a>å®‰è£…è½¯ä»¶</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum install ppp pptp pptp-setup</span><br></pre></td></tr></table></figure>

<h1 id="åˆ›å»ºVPNè¿æ¥"><a href="#åˆ›å»ºVPNè¿æ¥" class="headerlink" title="åˆ›å»ºVPNè¿æ¥"></a>åˆ›å»ºVPNè¿æ¥</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pptpsetup  --create vpnname --server x.x.x.x  --username uaername --password XXXXXX --encrypt --start</span><br></pre></td></tr></table></figure>

<ul>
<li>createæ˜¯åˆ›å»ºçš„è¿æ¥åç§°</li>
<li>serveræ˜¯vpnçš„ipåœ°å€</li>
<li>usernameæ˜¯ç”¨æˆ·å</li>
<li>passwordæ˜¯å¯†ç ï¼Œä¹Ÿå¯ä»¥æ²¡è¿™ä¸ªå‚æ•°ï¼Œå‘½ä»¤ç¨åä¼šè‡ªåŠ¨è¯¢é—®ã€‚è¿™æ ·å¯ä»¥ä¿è¯è´¦å·å®‰å…¨</li>
<li>encrypt æ˜¯è¡¨ç¤ºéœ€è¦åŠ å¯†ï¼Œä¸å¿…æŒ‡å®šåŠ å¯†æ–¹å¼ï¼Œå‘½ä»¤ä¼šè¯»å–é…ç½®æ–‡ä»¶ä¸­çš„åŠ å¯†æ–¹å¼ï¼ˆé»˜è®¤ä½¿ç”¨require-mppe-128åŠ å¯†ï¼‰</li>
<li>startæ˜¯è¡¨ç¤ºåˆ›å»ºè¿æ¥å®Œåé©¬ä¸Šè¿æ¥</li>
</ul>
<h1 id="è¿æ¥å·²æœ‰çš„VPNé…ç½®"><a href="#è¿æ¥å·²æœ‰çš„VPNé…ç½®" class="headerlink" title="è¿æ¥å·²æœ‰çš„VPNé…ç½®"></a>è¿æ¥å·²æœ‰çš„VPNé…ç½®</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pon vpnname</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå‘½ä»¤åœ¨ç³»ç»Ÿä¸­binç›®å½•ä¸­æ‰¾ä¸åˆ°ï¼Œåœ¨pptdçš„å®‰è£…ç›®å½•ä¸‹çš„scriptç›®å½•ä¸‹ï¼Œå¦‚æœä¸æ¸…æ¥šè¿™ä¸ªå‘½ä»¤å…·ä½“åœ¨å“ªé‡Œçš„å¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æŸ¥æ‰¾</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">find / -name <span class="string">"poff"</span> -<span class="built_in">type</span> f</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä½¿ç”¨yumå®‰è£…çš„è½¯ä»¶ï¼Œå¯ä»¥å‚è€ƒå»ä»¥ä¸‹è·¯å¾„æŸ¥æ‰¾</p>
<p><code>/usr/share/doc/ppp-2.4.5/scripts/</code></p>
<h1 id="è·¯ç”±"><a href="#è·¯ç”±" class="headerlink" title="è·¯ç”±"></a>è·¯ç”±</h1><p>è¿æ¥æˆåŠŸåä¼šåœ¨æœ¬åœ°åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿç½‘å£<code>ppp0</code></p>
<p>ç›¸å…³çš„è·¯ç”±ä¹Ÿä¼šåŠ åœ¨è·¯ç”±è¡¨ä¸­ï¼Œå¯ä»¥é€šè¿‡<code>route -n</code>å’Œ<code>ifconfig</code>å‘½ä»¤æŸ¥çœ‹</p>
<p>VPNè¿é€šåï¼Œå¯ä»¥æŒ‡å®šæœ¬åœ°æ‰€æœ‰æµé‡éƒ½èµ°VPNï¼Œä¹Ÿå¯ä»¥æŒ‡å®šæŸå‡ ä¸ªç½‘æ®µçš„æµé‡èµ°VPN</p>
<ul>
<li>æ‰€æœ‰æµé‡éƒ½èµ°VPNï¼Œè®¾ç½®ä¸ºé»˜è®¤è·¯ç”±</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">route add -net 0.0.0.0 dev ppp0</span><br><span class="line">æˆ–</span><br><span class="line">route add default dev ppp0</span><br></pre></td></tr></table></figure>

<p>åˆ é™¤</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">route del -net 0.0.0.0 dev ppp0</span><br><span class="line">æˆ–</span><br><span class="line">route del default</span><br></pre></td></tr></table></figure>

<ul>
<li>æŒ‡å®šç½‘æ®µçš„æµé‡èµ°VPN</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">route add -net 192.168.168.0/24 dev ppp0</span><br></pre></td></tr></table></figure>

<p><strong>æ³¨æ„ï¼šé‡å¯ç½‘å¡ä¹Ÿä¼šæ¸…é™¤VPNé€šé“</strong></p>
<h1 id="å…³é—­VPNé€šé“"><a href="#å…³é—­VPNé€šé“" class="headerlink" title="å…³é—­VPNé€šé“"></a>å…³é—­VPNé€šé“</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">poff vpnname (å…¨éƒ¨ä¸‹çº¿poff -a)</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå‘½ä»¤åœ¨ç³»ç»Ÿä¸­binç›®å½•ä¸­æ‰¾ä¸åˆ°ï¼Œåœ¨pptdçš„å®‰è£…ç›®å½•ä¸‹çš„scriptç›®å½•ä¸‹ï¼Œå¦‚æœä¸æ¸…æ¥šè¿™ä¸ªå‘½ä»¤å…·ä½“åœ¨å“ªé‡Œçš„å¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æŸ¥æ‰¾</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">find / -name <span class="string">"poff"</span> -<span class="built_in">type</span> f</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä½¿ç”¨yumå®‰è£…çš„è½¯ä»¶ï¼Œå¯ä»¥å‚è€ƒå»ä»¥ä¸‹è·¯å¾„æŸ¥æ‰¾</p>
<p><code>/usr/share/doc/ppp-2.4.5/scripts/</code></p>
<h1 id="ç›¸å…³ç›®å½•"><a href="#ç›¸å…³ç›®å½•" class="headerlink" title="ç›¸å…³ç›®å½•"></a>ç›¸å…³ç›®å½•</h1><ul>
<li>/etc/ppp/peers/  å­˜æ”¾ç”¨æˆ·åˆ›å»ºçš„vpnnameé…ç½®æ–‡ä»¶çš„åœ°æ–¹</li>
<li>/etc/ppp/chap-secrets  ç”¨æˆ·åå¯†ç å­˜æ”¾çš„åœ°æ–¹ï¼ˆæ˜æ–‡çš„ï¼‰</li>
</ul>
<h1 id="æ³¨"><a href="#æ³¨" class="headerlink" title="æ³¨"></a>æ³¨</h1><ul>
<li>æ³¨1ï¼š pon å’Œ poffå‘½ä»¤å¯åœ¨pppæºç ç›®å½•ä¸‹çš„scriptsç›®å½•ä¸­æ‰¾åˆ°ã€‚</li>
<li>æ³¨2ï¼š è¦æƒ³ä½¿ç”¨vpné€šé“ï¼Œéœ€è¦æ ¹æ®éœ€è¦åœ¨æœ¬åœ°æ·»åŠ é™æ€è·¯ç”±</li>
</ul>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>vpn</tag>
        <tag>PPTP</tag>
      </tags>
  </entry>
  <entry>
    <title>æ·»åŠ /åˆ é™¤è·¯ç”±</title>
    <url>/2016/09/09/%E6%B7%BB%E5%8A%A0-%E5%88%A0%E9%99%A4%E8%B7%AF%E7%94%B1/</url>
    <content><![CDATA[<h1 id="æŸ¥çœ‹è·¯ç”±"><a href="#æŸ¥çœ‹è·¯ç”±" class="headerlink" title="æŸ¥çœ‹è·¯ç”±"></a>æŸ¥çœ‹è·¯ç”±</h1><h2 id="linux"><a href="#linux" class="headerlink" title="linux"></a>linux</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; route -n</span><br><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br><span class="line">0.0.0.0         192.168.3.1     0.0.0.0         UG    100    0        0 eth0</span><br><span class="line">192.168.3.0     0.0.0.0         255.255.255.0   U     100    0        0 eth0</span><br></pre></td></tr></table></figure>

<h2 id="mac"><a href="#mac" class="headerlink" title="mac"></a>mac</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; netstat -nr</span><br><span class="line">Routing tables</span><br><span class="line"></span><br><span class="line">Internet:</span><br><span class="line">Destination        Gateway            Flags        Refs      Use   Netif Expire</span><br><span class="line">default            10.1.101.254       UGSc          214      718     en0</span><br><span class="line">10.1.100/23        link<span class="comment">#4             UCS            11        0     en0</span></span><br><span class="line">10.1.100.22        link<span class="comment">#4             UHLWIi          1        1     en0</span></span><br><span class="line">10.1.100.65/32     link<span class="comment">#4             UCS             2        0     en0</span></span><br><span class="line">10.1.100.65        60:3:8:a5:3b:9e    UHLWIi          1        3     lo0</span><br><span class="line">10.1.100.88        link<span class="comment">#4             UHLWIi          1        3     en0</span></span><br><span class="line">10.1.100.94        link<span class="comment">#4             UHLWIi          1        2     en0</span></span><br><span class="line">10.1.100.99        link<span class="comment">#4             UHLWIi          1        3     en0</span></span><br><span class="line">10.1.100.100       link<span class="comment">#4             UHLWIi          1        3     en0</span></span><br><span class="line">10.1.100.121       link<span class="comment">#4             UHLWIi          1        3     en0</span></span><br><span class="line">10.1.100.146       90:b6:86:d8:d:24   UHLWIi          1        1     en0    867</span><br><span class="line">10.1.101.128       link<span class="comment">#4             UHLWIi          1        2     en0</span></span><br><span class="line">10.1.101.164       c8:25:e1:61:70:2e  UHLWIi          1        1     en0   1004</span><br><span class="line">10.1.101.254/32    link<span class="comment">#4             UCS             2        0     en0</span></span><br><span class="line">10.1.101.254       b0:aa:77:1a:b0:58  UHLWIir       215       16     en0    782</span><br><span class="line">10.1.101.255       link<span class="comment">#4             UHLWbI          1      142     en0</span></span><br><span class="line">10.255.1/24        10.255.1.65        UGSc            1        0   utun0</span><br><span class="line">10.255.1.65        10.255.1.66        UH              3        0   utun0</span><br><span class="line">10.255.99/24       10.255.99.49       UGSc            1        0   utun1</span><br><span class="line">10.255.99.49       10.255.99.50       UH             13        0   utun1</span><br><span class="line">10.255.100/24      10.255.100.41      UGSc            1        0   utun2</span><br><span class="line">10.255.100.41      10.255.100.42      UH             13        0   utun2</span><br><span class="line">111.202.124.222/32 192.168.1.1        UGSc            2        0     en0</span><br><span class="line">127                127.0.0.1          UCS             1        0     lo0</span><br><span class="line">127.0.0.1          127.0.0.1          UH             27    57535     lo0</span><br><span class="line">169.254            link<span class="comment">#4             UCS             1        0     en0</span></span><br><span class="line">192.168.2          10.255.99.49       UGSc            1        0   utun1</span><br><span class="line">192.168.3          10.255.99.49       UGSc            2        0   utun1</span><br><span class="line">192.168.4          10.255.99.49       UGSc            1        0   utun1</span><br><span class="line">192.168.7          10.255.99.49       UGSc            1        0   utun1</span><br><span class="line">192.168.8          10.255.99.49       UGSc            1        0   utun1</span><br><span class="line">192.168.89         10.255.99.49       UGSc            1        0   utun1</span><br><span class="line">192.168.90         10.255.99.49       UGSc            1        0   utun1</span><br><span class="line">192.168.91         10.255.99.49       UGSc            1        0   utun1</span><br><span class="line">192.168.95         10.255.99.49       UGSc            1        0   utun1</span><br><span class="line">192.168.99         10.255.99.49       UGSc            1        0   utun1</span><br><span class="line">192.168.101        10.255.100.41      UGSc            1        0   utun2</span><br><span class="line">192.168.103        10.255.100.41      UGSc            1        0   utun2</span><br><span class="line">192.168.105        10.255.100.41      UGSc            2        0   utun2</span><br><span class="line">192.168.110        10.255.100.41      UGSc            1        0   utun2</span><br><span class="line">192.168.111        10.255.100.41      UGSc            1        0   utun2</span><br><span class="line">192.168.168        10.255.1.65        UGSc            1        0   utun0</span><br><span class="line">192.168.247        10.255.100.41      UGSc            1        0   utun2</span><br><span class="line">192.168.248        10.255.100.41      UGSc            1        0   utun2</span><br><span class="line">192.168.251        10.255.100.41      UGSc            1        0   utun2</span><br><span class="line">192.168.252        10.255.100.41      UGSc            1        0   utun2</span><br><span class="line">192.168.253        10.255.100.41      UGSc            1        0   utun2</span><br><span class="line">224.0.0            link<span class="comment">#4             UmCS            2        0     en0</span></span><br><span class="line">224.0.0.251        1:0:5e:0:0:fb      UHmLWI          1        0     en0</span><br><span class="line">255.255.255.255/32 link<span class="comment">#4             UCS             2        0     en0</span></span><br><span class="line">255.255.255.255    link<span class="comment">#4             UHLWbI          1      133     en0</span></span><br></pre></td></tr></table></figure>

<h1 id="æ·»åŠ è·¯ç”±"><a href="#æ·»åŠ è·¯ç”±" class="headerlink" title="æ·»åŠ è·¯ç”±"></a>æ·»åŠ è·¯ç”±</h1><h2 id="é€šè¿‡å‡ºå£IPæ·»åŠ "><a href="#é€šè¿‡å‡ºå£IPæ·»åŠ " class="headerlink" title="é€šè¿‡å‡ºå£IPæ·»åŠ "></a>é€šè¿‡å‡ºå£IPæ·»åŠ </h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">route add -net 192.168.2.0/24 gw 192.168.10.85</span><br><span class="line">route add -net 192.168.8.0/24 gw 192.168.10.85</span><br><span class="line">route add -net 192.168.168.0/24 gw 192.168.10.85</span><br><span class="line">route add -net 192.168.100.0/24 gw 192.168.10.85</span><br></pre></td></tr></table></figure>

<h2 id="é€šè¿‡å‡ºå£è®¾å¤‡æ·»åŠ "><a href="#é€šè¿‡å‡ºå£è®¾å¤‡æ·»åŠ " class="headerlink" title="é€šè¿‡å‡ºå£è®¾å¤‡æ·»åŠ "></a>é€šè¿‡å‡ºå£è®¾å¤‡æ·»åŠ </h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">route add -net 0.0.0.0 dev ppp0 //æ·»åŠ é»˜è®¤è·¯ç”±</span><br></pre></td></tr></table></figure>

<h1 id="åˆ é™¤è·¯ç”±"><a href="#åˆ é™¤è·¯ç”±" class="headerlink" title="åˆ é™¤è·¯ç”±"></a>åˆ é™¤è·¯ç”±</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">route del -net 192.168.2.0&#x2F;24 gw 192.168.10.85</span><br><span class="line">route del -net 192.168.8.0&#x2F;24 gw 192.168.10.85</span><br><span class="line">route del -net 192.168.168.0&#x2F;24 gw 192.168.10.85</span><br><span class="line">route del -net 192.168.100.0&#x2F;24 gw 192.168.10.85</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>route</tag>
        <tag>netstat</tag>
      </tags>
  </entry>
  <entry>
    <title>ciscoè®¾å¤‡çš„pingå‘½ä»¤</title>
    <url>/2016/09/09/cisco%E8%AE%BE%E5%A4%87%E7%9A%84ping%E5%91%BD%E4%BB%A4/</url>
    <content><![CDATA[<p>ä½¿ç”¨<code>ping x.x.x.x</code>å‘½ä»¤é»˜è®¤å‘é€5ä¸ªåŒ…</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ciscoasa&gt; ping 111.202.124.217</span><br><span class="line">Type escape sequence to abort.</span><br><span class="line">Sending 5, 100-byte ICMP Echos to 111.202.124.217, timeout is 2 seconds:</span><br><span class="line">!!!!!</span><br><span class="line">Success rate is 100 percent (5&#x2F;5), round-trip min&#x2F;avg&#x2F;max &#x3D; 1&#x2F;2&#x2F;10 ms</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥æŒ‡å®šå‘åŒ…çš„ä¸ªæ•°<code>ping x.x.x.x repeat num</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ciscoasa&gt; ping 111.202.124.217 repeat 100</span><br><span class="line">Type escape sequence to abort.</span><br><span class="line">Sending 100, 100-byte ICMP Echos to 111.202.124.217, timeout is 2 seconds:</span><br><span class="line">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span><br><span class="line">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span><br><span class="line">Success rate is 100 percent (100&#x2F;100), round-trip min&#x2F;avg&#x2F;max &#x3D; 1&#x2F;3&#x2F;10 ms</span><br><span class="line">ciscoasa&gt; ping 111.202.124.217 repeat 1000</span><br><span class="line">Type escape sequence to abort.</span><br><span class="line">Sending 1000, 100-byte ICMP Echos to 111.202.124.217, timeout is 2 seconds:</span><br><span class="line">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span><br><span class="line">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!?!!!!!!</span><br><span class="line">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span><br><span class="line">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!?!!!!!!!!!!!!!!!</span><br><span class="line">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span><br><span class="line">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!?!?!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span><br><span class="line">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span><br><span class="line">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!?!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span><br><span class="line">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span><br><span class="line">!!!!!!!!!!!!!!!!!!!!!!!!!!!?!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span><br><span class="line">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span><br><span class="line">!!!!!!!!!!!?!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span><br><span class="line">!!!!!!!!!!!!!!!!!!!!!!!!!!!!?!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span><br><span class="line">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span><br><span class="line">!!!!!!!!!!!!!!!!!!!!</span><br><span class="line">Success rate is 99 percent (992&#x2F;1000), round-trip min&#x2F;avg&#x2F;max &#x3D; 1&#x2F;3&#x2F;30 ms</span><br></pre></td></tr></table></figure>

<p><strong>åé¢è¿˜å¯ç»™<code>size</code> æŒ‡å®šæ•°æ®åŒ…çš„å¤§å°ï¼›<code>timeout</code> è¡¨ç¤ºè¶…æ—¶çš„æ—¶é—´</strong></p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>ping</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQLåŒæ­¥æŠ¥é”™:Last_IO_Error: Got fatal error 1236 from master</title>
    <url>/2016/09/01/MySQL%E5%90%8C%E6%AD%A5%E6%8A%A5%E9%94%99-Last-IO-Error-Got-fatal-error-1236-from-master/</url>
    <content><![CDATA[<blockquote>
<p>é…ç½®MySQLä»åº“ï¼Œå¯åŠ¨slaveçº¿ç¨‹åâ€Last_IO_Error: Got fatal error 1236 from master when reading data from binary log: â€˜Could not find first log file name in binary log index fileâ€çš„é”™è¯¯âŒ </p>
</blockquote>
<ul>
<li>step 1</li>
</ul>
<p>å…ˆåˆ°slaveä¸­åœæ­¢åŒæ­¥çº¿ç¨‹</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">mysql&gt;  stop slave for channel "db136";  # mysql5.7å¤šæºå¤åˆ¶çš„è¯­æ³•</span><br></pre></td></tr></table></figure>

<ul>
<li>step 2</li>
</ul>
<p>å›åˆ°masterä¸­ï¼Œå…³é—­å½“å‰çš„äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶å¹¶åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ï¼Œæ–°çš„äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶çš„åå­—åœ¨å½“å‰çš„äºŒè¿›åˆ¶æ–‡ä»¶çš„ç¼–å·ä¸ŠåŠ 1</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; flush logs;</span><br><span class="line">mysql&gt; show master status;</span><br><span class="line">+<span class="comment">------------------+----------+--------------+------------------+-------------------+</span></span><br><span class="line">| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |</span><br><span class="line">+<span class="comment">------------------+----------+--------------+------------------+-------------------+</span></span><br><span class="line">| mysql-bin.000038 |      154 |              | mysql            |                   |</span><br><span class="line">+<span class="comment">------------------+----------+--------------+------------------+-------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<ul>
<li>step 3</li>
</ul>
<p>å†ä»slaveæ‰§è¡Œchange master</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">mysql&gt; change master to master_host="192.168.1.136", master_port=3306, master_user="repl",master_password="12345678",master_log_file="mysql-bin.000038",master_log_pos=154 for channel "db136";</span><br><span class="line">mysql&gt; start slave for channel "db136";</span><br><span class="line">mysql&gt; show slave status for channel "db136";</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>MySQL5.7å¢å¼ºç‰ˆçš„å¤šçº¿ç¨‹ä¸»ä»å¤åˆ¶</title>
    <url>/2016/08/21/MySQL5-7%E5%A2%9E%E5%BC%BA%E7%89%88%E7%9A%84%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/</url>
    <content><![CDATA[<blockquote>
<p>MySQLå¤šçº¿ç¨‹ä¸»ä»å¤åˆ¶ä¸æ˜¯5.7ç‰ˆæœ¬ä¸­çš„æ–°é²œäº§ç‰©ï¼Œè¿™ä¸ªç‰¹æ€§åœ¨5.6ç‰ˆæœ¬ä¸­å°±å·²ç»æä¾›ã€‚ä½†æ˜¯åœ¨5.7ç‰ˆæœ¬ä¸­ç»™å¤šçº¿ç¨‹ä¸»ä»å¤åˆ¶çš„ç‰¹æ€§åšäº†å¢å¼º</p>
</blockquote>
<ul>
<li>åœ¨MySQL5.6ç‰ˆæœ¬ä¸­çš„å¤šçº¿ç¨‹å¤åˆ¶ï¼Œå‰ææ˜¯ä¸€ä¸ªçº¿ç¨‹åªé’ˆå¯¹ä¸€ä¸ªåº“</li>
<li>åœ¨MySQL5.7ç‰ˆæœ¬ä¸­ï¼Œä¸€ä¸ªåº“å¯ä»¥ä½¿ç”¨å¤šä¸ªçº¿ç¨‹åŒæ­¥ï¼Œå¯ä»¥è®¤ä¸ºMySQL5.7çš„å¤šçº¿ç¨‹å¤åˆ¶æ˜¯åŸºäºè¡¨çš„</li>
</ul>
<h1 id="å¤šçº¿ç¨‹å¤åˆ¶çš„é…ç½®"><a href="#å¤šçº¿ç¨‹å¤åˆ¶çš„é…ç½®" class="headerlink" title="å¤šçº¿ç¨‹å¤åˆ¶çš„é…ç½®"></a>å¤šçº¿ç¨‹å¤åˆ¶çš„é…ç½®</h1><p>æ ¹æ®MySQLå¤åˆ¶åŸç†ï¼Œå¯ä»¥çŸ¥é“ï¼Œå¤šçº¿ç¨‹å¤åˆ¶åªéœ€è¦ä¿®æ”¹slaveç«¯å³å¯</p>
<h2 id="æ£€æŸ¥ç³»ç»Ÿå½“å‰å¤šçº¿ç¨‹å¤åˆ¶çš„å‚æ•°"><a href="#æ£€æŸ¥ç³»ç»Ÿå½“å‰å¤šçº¿ç¨‹å¤åˆ¶çš„å‚æ•°" class="headerlink" title="æ£€æŸ¥ç³»ç»Ÿå½“å‰å¤šçº¿ç¨‹å¤åˆ¶çš„å‚æ•°"></a>æ£€æŸ¥ç³»ç»Ÿå½“å‰å¤šçº¿ç¨‹å¤åˆ¶çš„å‚æ•°</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; show variables like 'slave_parallel%';</span><br><span class="line">+<span class="comment">------------------------+----------+</span></span><br><span class="line">| Variable_name          | Value    |</span><br><span class="line">+<span class="comment">------------------------+----------+</span></span><br><span class="line">| slave_parallel_type    | DATABASE |</span><br><span class="line">| slave_parallel_workers | 0        |</span><br><span class="line">+<span class="comment">------------------------+----------+</span></span><br><span class="line">2 rows in <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure>

<p>ä»ä¸Šé¢çš„æŸ¥è¯¢ç»“æœä¸Šæ¥çœ‹ï¼Œslaveé»˜è®¤çš„å¤šçº¿ç¨‹å¤åˆ¶ç±»å‹æ˜¯åŸºäºæ•°æ®åº“çš„ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªæ•°æ®åº“å¯¹åº”ä¸€ä¸ªçº¿ç¨‹ï¼›è€Œå¤šçº¿ç¨‹å¤åˆ¶çš„çº¿ç¨‹æ•°é‡ä¸º0ï¼Œæ„ä¸ºå•è¿›ç¨‹å¤åˆ¶</p>
<h2 id="è®¾ç½®å¤šçº¿ç¨‹å¤åˆ¶"><a href="#è®¾ç½®å¤šçº¿ç¨‹å¤åˆ¶" class="headerlink" title="è®¾ç½®å¤šçº¿ç¨‹å¤åˆ¶"></a>è®¾ç½®å¤šçº¿ç¨‹å¤åˆ¶</h2><figure class="highlight"><table><tr><td class="code"><pre><span class="line">mysql&gt; stop slave;</span><br><span class="line">Query OK, 0 rows affected (0.05 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; set global slave_parallel_type='logical_clock';</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; set global slave_parallel_workers=8;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; start slave;</span><br><span class="line">Query OK, 0 rows affected (0.18 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure>

<h2 id="æŸ¥çœ‹å¤åˆ¶çº¿ç¨‹"><a href="#æŸ¥çœ‹å¤åˆ¶çº¿ç¨‹" class="headerlink" title="æŸ¥çœ‹å¤åˆ¶çº¿ç¨‹"></a>æŸ¥çœ‹å¤åˆ¶çº¿ç¨‹</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; show processlist;</span><br><span class="line">+<span class="comment">----+-----------------+-----------+------+---------+--------+--------------------------------------------------------+------------------+</span></span><br><span class="line">| Id | User            | Host      | db   | Command | Time   | State                                                  | Info             |</span><br><span class="line">+<span class="comment">----+-----------------+-----------+------+---------+--------+--------------------------------------------------------+------------------+</span></span><br><span class="line">|  1 | event_scheduler | localhost | NULL | Daemon  | 141366 | Waiting on empty queue                                 | NULL             |</span><br><span class="line">| 13 | root            | localhost | NULL | Query   |      0 | starting                                               | <span class="keyword">show</span> <span class="keyword">processlist</span> |</span><br><span class="line">| <span class="number">14</span> | <span class="keyword">system</span> <span class="keyword">user</span>     |           | <span class="literal">NULL</span> | <span class="keyword">Connect</span> |     <span class="number">49</span> | Waiting <span class="keyword">for</span> <span class="keyword">master</span> <span class="keyword">to</span> send <span class="keyword">event</span>                       | <span class="literal">NULL</span>             |</span><br><span class="line">| <span class="number">15</span> | <span class="keyword">system</span> <span class="keyword">user</span>     |           | <span class="literal">NULL</span> | <span class="keyword">Connect</span> |     <span class="number">48</span> | <span class="keyword">Slave</span> has <span class="keyword">read</span> <span class="keyword">all</span> relay <span class="keyword">log</span>; waiting for more updates | NULL             |</span><br><span class="line">| 16 | system user     |           | NULL | Connect |     49 | Waiting for an event from Coordinator                  | NULL             |</span><br><span class="line">| 17 | system user     |           | NULL | Connect |     49 | Waiting for an event from Coordinator                  | NULL             |</span><br><span class="line">| 18 | system user     |           | NULL | Connect |     49 | Waiting for an event from Coordinator                  | NULL             |</span><br><span class="line">| 19 | system user     |           | NULL | Connect |     49 | Waiting for an event from Coordinator                  | NULL             |</span><br><span class="line">| 20 | system user     |           | NULL | Connect |     49 | Waiting for an event from Coordinator                  | NULL             |</span><br><span class="line">| 21 | system user     |           | NULL | Connect |     49 | Waiting for an event from Coordinator                  | NULL             |</span><br><span class="line">| 22 | system user     |           | NULL | Connect |     49 | Waiting for an event from Coordinator                  | NULL             |</span><br><span class="line">| 23 | system user     |           | NULL | Connect |     49 | Waiting for an event from Coordinator                  | NULL             |</span><br><span class="line">+<span class="comment">----+-----------------+-----------+------+---------+--------+--------------------------------------------------------+------------------+</span></span><br><span class="line">12 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">show</span> <span class="keyword">variables</span> <span class="keyword">like</span> <span class="string">'slave_parallel%'</span>;</span><br><span class="line">+<span class="comment">------------------------+---------------+</span></span><br><span class="line">| Variable_name          | Value         |</span><br><span class="line">+<span class="comment">------------------------+---------------+</span></span><br><span class="line">| slave_parallel_type    | LOGICAL_CLOCK |</span><br><span class="line">| slave_parallel_workers | 8             |</span><br><span class="line">+<span class="comment">------------------------+---------------+</span></span><br><span class="line">2 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure>

<p><em>æ³¨ï¼šMySQL5.7æ”¯æŒå¤šæºå¤åˆ¶ï¼Œè¿™é‡Œçš„å¤šçº¿ç¨‹å¤åˆ¶çš„æ„æ€æ˜¯ä¸ºæ¯ä¸€ä¸ªæºåˆ†é…çš„å¤šçº¿ç¨‹ã€‚ä¾‹å¦‚ä¸Šé¢æˆ‘è®¾ç½®äº†çº¿ç¨‹æ•°é‡ä¸º8ï¼Œé‚£æ„ä¸ºç€æ¯ä¸ªchannelå¤åˆ¶æºéƒ½ä¼šæä¾›8ä¸ªçº¿ç¨‹å»å¤åˆ¶ï¼Œå¦‚æœæœ‰ä¸¤ä¸ªchannelï¼Œé‚£ä¹ˆåœ¨processlistä¸­å°†çœ‹åˆ°16ä¸ªçº¿ç¨‹</em></p>
<h2 id="æŸ¥çœ‹å¤šçº¿ç¨‹å¤åˆ¶ç›¸å…³çš„è§†å›¾"><a href="#æŸ¥çœ‹å¤šçº¿ç¨‹å¤åˆ¶ç›¸å…³çš„è§†å›¾" class="headerlink" title="æŸ¥çœ‹å¤šçº¿ç¨‹å¤åˆ¶ç›¸å…³çš„è§†å›¾"></a>æŸ¥çœ‹å¤šçº¿ç¨‹å¤åˆ¶ç›¸å…³çš„è§†å›¾</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; show tables like 'replication%';</span><br><span class="line">+<span class="comment">---------------------------------------------+</span></span><br><span class="line">| Tables_in_performance_schema (replication%) |</span><br><span class="line">+<span class="comment">---------------------------------------------+</span></span><br><span class="line">| replication_applier_configuration           |</span><br><span class="line">| replication_applier_status                  |</span><br><span class="line">| replication_applier_status_by_coordinator   |</span><br><span class="line">| replication_applier_status_by_worker        |</span><br><span class="line">| replication_connection_configuration        |</span><br><span class="line">| replication_connection_status               |</span><br><span class="line">| replication_group_member_stats              |</span><br><span class="line">| replication_group_members                   |</span><br><span class="line">+<span class="comment">---------------------------------------------+</span></span><br><span class="line">8 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; select * from replication_applier_status_by_coordinator;</span><br><span class="line">+<span class="comment">--------------+-----------+---------------+-------------------+--------------------+----------------------+</span></span><br><span class="line">| CHANNEL_NAME | THREAD_ID | SERVICE_STATE | LAST_ERROR_NUMBER | LAST_ERROR_MESSAGE | LAST_ERROR_TIMESTAMP |</span><br><span class="line">+<span class="comment">--------------+-----------+---------------+-------------------+--------------------+----------------------+</span></span><br><span class="line">| db153        |        40 | ON            |                 0 |                    | 0000-00-00 00:00:00  |</span><br><span class="line">+<span class="comment">--------------+-----------+---------------+-------------------+--------------------+----------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure>

<p><em>æ³¨ï¼šç”±äºMySQL5.7æ”¯æŒå¤šæºå¤åˆ¶ï¼Œé‚£ä¹ˆè¿™ä¸ªå¤åˆ¶çš„åè°ƒè€…<code>replication_applier_status_by_coordinator</code>ä¼šå»åè°ƒæ¯ä¸€ä¸ªchannelçš„å¤åˆ¶çº¿ç¨‹</em></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; select * from replication_applier_status_by_worker;</span><br><span class="line">+<span class="comment">--------------+-----------+-----------+---------------+-----------------------+-------------------+--------------------+----------------------+</span></span><br><span class="line">| CHANNEL_NAME | WORKER_ID | THREAD_ID | SERVICE_STATE | LAST_SEEN_TRANSACTION | LAST_ERROR_NUMBER | LAST_ERROR_MESSAGE | LAST_ERROR_TIMESTAMP |</span><br><span class="line">+<span class="comment">--------------+-----------+-----------+---------------+-----------------------+-------------------+--------------------+----------------------+</span></span><br><span class="line">| db153        |         1 |        41 | ON            |                       |                 0 |                    | 0000-00-00 00:00:00  |</span><br><span class="line">| db153        |         2 |        42 | ON            |                       |                 0 |                    | 0000-00-00 00:00:00  |</span><br><span class="line">| db153        |         3 |        43 | ON            |                       |                 0 |                    | 0000-00-00 00:00:00  |</span><br><span class="line">| db153        |         4 |        44 | ON            |                       |                 0 |                    | 0000-00-00 00:00:00  |</span><br><span class="line">| db153        |         5 |        45 | ON            |                       |                 0 |                    | 0000-00-00 00:00:00  |</span><br><span class="line">| db153        |         6 |        46 | ON            |                       |                 0 |                    | 0000-00-00 00:00:00  |</span><br><span class="line">| db153        |         7 |        47 | ON            |                       |                 0 |                    | 0000-00-00 00:00:00  |</span><br><span class="line">| db153        |         8 |        48 | ON            |                       |                 0 |                    | 0000-00-00 00:00:00  |</span><br><span class="line">+<span class="comment">--------------+-----------+-----------+---------------+-----------------------+-------------------+--------------------+----------------------+</span></span><br><span class="line">8 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œå¯ä»¥æ¸…æ¥šçš„çœ‹åˆ°ï¼Œä¸º<code>db153</code>è¿™ä¸€ä¸ªchannelæä¾›äº†8ä¸ªå¤åˆ¶çº¿ç¨‹ï¼Œå¦‚æœæœ‰ä¸¤ä¸ªchannelçš„ï¼Œè¿™é‡Œå°†æ˜¾ç¤º16è¡Œ</p>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL5.7</tag>
        <tag>ä¸»ä»å¤åˆ¶</tag>
        <tag>å¤šçº¿ç¨‹ä¸»ä»å¤åˆ¶</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL5.7çš„æ–°ç‰¹æ€§(æŒç»­æ›´æ–°)</title>
    <url>/2016/08/21/MySQL5-7%E7%9A%84%E6%96%B0%E7%89%B9%E6%80%A7-%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0/</url>
    <content><![CDATA[<blockquote>
<p>MySQL5.7æ­£å¼ç‰ˆæœ¬å·²ç»å‘å¸ƒï¼Œåœ¨MySQL5.7ä¸­è¿æ¥äº†å¤§å¹…çš„æ€§èƒ½å‡çº§ä»¥åŠæ–°çš„ç‰¹æ€§ï¼Œæœ¬ç¯‡æ–‡ç« å°±æ¥è¯¦ç»†è®¨è®ºä¸‹MySQL5.7çš„æœ€æ–°ç‰¹æ€§</p>
</blockquote>
<h1 id="MySQLæœåŠ¡åŠŸèƒ½å¢å¼º"><a href="#MySQLæœåŠ¡åŠŸèƒ½å¢å¼º" class="headerlink" title="MySQLæœåŠ¡åŠŸèƒ½å¢å¼º"></a>MySQLæœåŠ¡åŠŸèƒ½å¢å¼º</h1><h2 id="æ•°æ®åº“åˆå§‹åŒ–çš„æ–¹å¼å˜æ›´"><a href="#æ•°æ®åº“åˆå§‹åŒ–çš„æ–¹å¼å˜æ›´" class="headerlink" title="æ•°æ®åº“åˆå§‹åŒ–çš„æ–¹å¼å˜æ›´"></a>æ•°æ®åº“åˆå§‹åŒ–çš„æ–¹å¼å˜æ›´</h2><ul>
<li>åœ¨MySQL5.7ç‰ˆæœ¬ä¹‹å‰ï¼Œä½¿ç”¨ç¼–è¯‘å®‰è£…æˆ–ä½¿ç”¨äºŒè¿›åˆ¶åŒ…éƒ¨ç½²MySQLï¼Œåˆå§‹åŒ–çš„æ—¶å€™æ˜¯ä½¿ç”¨äº†å¦‚ä¸‹è„šæœ¬æ¥å®ç°çš„</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; /<span class="variable">$path2mysql</span>/script/mysql_install_db \</span><br><span class="line">	--datadir=/data/mysql \</span><br><span class="line">	--user=mysql</span><br><span class="line">	--basedir=/<span class="variable">$path2mysql</span></span><br></pre></td></tr></table></figure>

<ul>
<li>åˆ°äº†MySQL5.7ï¼Œä¸å†æä¾›è„šæœ¬çš„æ–¹å¼åˆå§‹åŒ–æ•°æ®åº“ï¼Œè€Œæ˜¯æ”¹ç”¨mysqldç¨‹åºçš„å‘½ä»¤æ¥å®ç°</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; mysqld --initialize --user=mysql \</span><br><span class="line">	--basedir=/<span class="variable">$path2mysql</span></span><br><span class="line">	--datadir=/data/mysql</span><br></pre></td></tr></table></figure>

<p>å½“ç„¶å¦‚æœä½ ä½¿ç”¨äº†yumçš„æ–¹å¼å®‰è£…äº†MySQL5.7ï¼Œé‚£ä¹ˆåœ¨ç¬¬ä¸€æ¬¡å¯åŠ¨mysqlçš„æ—¶å€™<code>systemctl start mysqld</code>é»˜è®¤ä¼šè‡ªåŠ¨æ ¹æ®é…ç½®æ–‡ä»¶å»åˆå§‹åŒ–ä½ çš„æ•°æ®åº“</p>
<h2 id="æ”¯æŒä¸ºè¡¨å¢åŠ è®¡ç®—åˆ—"><a href="#æ”¯æŒä¸ºè¡¨å¢åŠ è®¡ç®—åˆ—" class="headerlink" title="æ”¯æŒä¸ºè¡¨å¢åŠ è®¡ç®—åˆ—"></a>æ”¯æŒä¸ºè¡¨å¢åŠ è®¡ç®—åˆ—</h2><p>ä»€ä¹ˆæ˜¯è®¡ç®—åˆ—ï¼Ÿ</p>
<p>å½“ä¸€å¼ è¡¨ä¸Šçš„æŸä¸€åˆ—çš„æ•°æ®æ˜¯ç”±å…¶ä»–åˆ—çš„å€¼è®¡ç®—å¾—åˆ°çš„åˆ—ï¼Œå°±ç§°ä¹‹ä¸ºè®¡ç®—åˆ—</p>
<p>ä¾‹å¦‚ï¼šä¸€å¼ è¡¨tï¼Œæœ‰c1ï¼Œc2å’Œc3åˆ—ï¼Œc3çš„å€¼=c1+c2</p>
<ul>
<li>åœ¨MySQL5.7ä¹‹å‰ï¼Œè®¡ç®—åˆ—åªèƒ½é€šè¿‡è§¦å‘å™¨çš„æ–¹å¼æ¥å®ç°</li>
</ul>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">mysql&gt; create table t(id int auto_increment not null, c1 int, c2 int, c3 int, primary key (id));</span><br><span class="line">Query OK, 0 rows affected (0.09 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure>

<p>è¿™å¼ è¡¨å»ºç«‹ä¹‹åï¼Œå‘tè¡¨ä¸­çš„c1å’Œc2æ’å…¥æ•°æ®ï¼Œc3æ˜¯ä¸å¯èƒ½è‡ªåŠ¨è®¡ç®—å‡ºæ¥çš„</p>
<p>åªèƒ½é€šè¿‡æ’å…¥è§¦å‘å™¨æ¥å®ç°</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; create trigger inst_t before insert on t for each row set new.c3=new.c1+new.c2; </span><br><span class="line">Query OK, 0 rows affected (0.07 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; show triggers;</span><br><span class="line">+<span class="comment">---------+--------+-------+--------------------------+--------+------------------------+-------------------------------------------------------------------------------------------------------------------------------------------+----------------+----------------------+----------------------+--------------------+</span></span><br><span class="line">| Trigger | Event  | Table | Statement                | Timing | Created                | sql_mode                                                                                                                                  | Definer        | character_set_client | collation_connection | Database Collation |</span><br><span class="line">+<span class="comment">---------+--------+-------+--------------------------+--------+------------------------+-------------------------------------------------------------------------------------------------------------------------------------------+----------------+----------------------+----------------------+--------------------+</span></span><br><span class="line">| inst_t  | <span class="keyword">INSERT</span> | t     | <span class="keyword">set</span> new.c3=new.c1+new.c2 | <span class="keyword">BEFORE</span> | <span class="number">2016</span><span class="number">-08</span><span class="number">-21</span> <span class="number">01</span>:<span class="number">52</span>:<span class="number">06.01</span> | ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION | root@localhost | utf8                 | utf8_general_ci      | utf8mb4_unicode_ci |</span><br><span class="line">+<span class="comment">---------+--------+-------+--------------------------+--------+------------------------+-------------------------------------------------------------------------------------------------------------------------------------------+----------------+----------------------+----------------------+--------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="keyword">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">insert</span> <span class="keyword">into</span> t(c1, c2) <span class="keyword">values</span>(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">Query OK, 1 row affected (0.11 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from t;</span><br><span class="line">+<span class="comment">----+------+------+------+</span></span><br><span class="line">| id | c1   | c2   | c3   |</span><br><span class="line">+<span class="comment">----+------+------+------+</span></span><br><span class="line">|  1 |    1 |    2 |    3 |</span><br><span class="line">+<span class="comment">----+------+------+------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢å®ç°äº†æ’å…¥è§¦å‘å™¨ï¼Œæµ‹è¯•æ­£å¸¸ï¼Œä½†æ˜¯ä¸€æ—¦æˆ‘å»æ›´æ”¹c1æˆ–c2çš„å€¼ï¼Œc3åˆ—æ˜¯ä¸ä¼šè·Ÿç€å˜æ›´çš„</p>
<p>å› æ­¤è¿˜éœ€è¦å»ºç«‹ä¸€ä¸ªæ›´æ–°è§¦å‘å™¨</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; create trigger upd_t before update on t for each row set new.c3=new.c1+new.c2;</span><br><span class="line">Query OK, 0 rows affected (0.08 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; show triggers;</span><br><span class="line">+<span class="comment">---------+--------+-------+--------------------------+--------+------------------------+-------------------------------------------------------------------------------------------------------------------------------------------+----------------+----------------------+----------------------+--------------------+</span></span><br><span class="line">| Trigger | Event  | Table | Statement                | Timing | Created                | sql_mode                                                                                                                                  | Definer        | character_set_client | collation_connection | Database Collation |</span><br><span class="line">+<span class="comment">---------+--------+-------+--------------------------+--------+------------------------+-------------------------------------------------------------------------------------------------------------------------------------------+----------------+----------------------+----------------------+--------------------+</span></span><br><span class="line">| inst_t  | <span class="keyword">INSERT</span> | t     | <span class="keyword">set</span> new.c3=new.c1+new.c2 | <span class="keyword">BEFORE</span> | <span class="number">2016</span><span class="number">-08</span><span class="number">-21</span> <span class="number">01</span>:<span class="number">52</span>:<span class="number">06.01</span> | ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION | root@localhost | utf8                 | utf8_general_ci      | utf8mb4_unicode_ci |</span><br><span class="line">| upd_t   | <span class="keyword">UPDATE</span> | t     | <span class="keyword">set</span> new.c3=new.c1+new.c2 | <span class="keyword">BEFORE</span> | <span class="number">2016</span><span class="number">-08</span><span class="number">-21</span> <span class="number">02</span>:<span class="number">01</span>:<span class="number">50.46</span> | ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION | root@localhost | utf8                 | utf8_general_ci      | utf8mb4_unicode_ci |</span><br><span class="line">+<span class="comment">---------+--------+-------+--------------------------+--------+------------------------+-------------------------------------------------------------------------------------------------------------------------------------------+----------------+----------------------+----------------------+--------------------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">update</span> t <span class="keyword">set</span> c1=<span class="number">5</span> <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">1</span>;</span><br><span class="line">Query OK, 1 row affected (0.04 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from t;</span><br><span class="line">+<span class="comment">----+------+------+------+</span></span><br><span class="line">| id | c1   | c2   | c3   |</span><br><span class="line">+<span class="comment">----+------+------+------+</span></span><br><span class="line">|  1 |    5 |    2 |    7 |</span><br><span class="line">+<span class="comment">----+------+------+------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure>

<p>ä»ä¸Šé¢çš„Demoå¯ä»¥çœ‹å‡ºï¼Œåœ¨MySQL5.7ä¹‹å‰ï¼Œå¦‚æœæƒ³å®ç°è®¡ç®—åˆ—ï¼Œåªå°‘è¦åˆ›å»ºæ’å…¥å’Œæ›´æ–°ä¸¤ä¸ªè§¦å‘å™¨</p>
<p>è€Œä½¿ç”¨è§†å›¾ä¹Ÿæ˜¯å¯ä»¥å®ç°è®¡ç®—åˆ—çš„ç›®çš„</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; create view vw_t as select id,c1,c2,c1+c2 as c3 from t;</span><br><span class="line">Query OK, 0 rows affected (0.11 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from vw_t;</span><br><span class="line">+<span class="comment">----+------+------+------+</span></span><br><span class="line">| id | c1   | c2   | c3   |</span><br><span class="line">+<span class="comment">----+------+------+------+</span></span><br><span class="line">|  1 |    5 |    2 |    7 |</span><br><span class="line">+<span class="comment">----+------+------+------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure>

<p>è€Œæ— è®ºæ˜¯ä½¿ç”¨è§¦å‘å™¨è¿˜æ˜¯è§†å›¾ï¼Œå¯¹mysqlçš„æ€§èƒ½éƒ½ä¼šäº§ç”Ÿæˆ–å¤šæˆ–å°‘çš„å½±å“ï¼Œæ‰€ä»¥ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå»ºè®®æ˜¯å°½å¯èƒ½å°‘çš„ä½¿ç”¨è§¦å‘å™¨å’Œè§†å›¾</p>
<ul>
<li>åœ¨MySQL5.7åŸç”Ÿæ”¯æŒè®¡ç®—åˆ—è¯­æ³•</li>
</ul>
<p>åœ¨<code>create table</code>ä»¥åŠ<code>alter table</code>è¯­å¥ä¸­æ”¯æŒå¢åŠ è®¡ç®—åˆ—</p>
<p><code>col_name data_type [GENERATED ALWAYS] AS (expression) [VIRTUAL|STORED] [UNIQUE [KEY]] [COMMENT comment] [[NOT] NULL] [[PRIMARY] KEY]</code></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; drop table t;</span><br><span class="line">Query OK, 0 rows affected (0.25 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; create table t (id int auto_increment not null, c1 int, c2 int, c3 int as (c1+c2), primary key(id));</span><br><span class="line">Query OK, 0 rows affected (0.22 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; show create table t;</span><br><span class="line">+<span class="comment">-------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line">| Table | <span class="keyword">Create</span> <span class="keyword">Table</span>                                                                                                                                                                                                                                                             |</span><br><span class="line">+<span class="comment">-------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line">| t     | <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`t`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`c1`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`c2`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`c3`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">GENERATED</span> <span class="keyword">ALWAYS</span> <span class="keyword">AS</span> ((<span class="string">`c1`</span> + <span class="string">`c2`</span>)) <span class="keyword">VIRTUAL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8mb4 <span class="keyword">COLLATE</span>=utf8mb4_unicode_ci |</span><br><span class="line">+<span class="comment">-------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="keyword">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">insert</span> <span class="keyword">into</span> t(c1, c2) <span class="keyword">values</span>(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">Query OK, 1 row affected (0.05 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from t;</span><br><span class="line">+<span class="comment">----+------+------+------+</span></span><br><span class="line">| id | c1   | c2   | c3   |</span><br><span class="line">+<span class="comment">----+------+------+------+</span></span><br><span class="line">|  1 |    1 |    2 |    3 |</span><br><span class="line">+<span class="comment">----+------+------+------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">update</span> t <span class="keyword">set</span> c1=<span class="number">9</span> <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">1</span>;</span><br><span class="line">Query OK, 1 row affected (0.05 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from t;</span><br><span class="line">+<span class="comment">----+------+------+------+</span></span><br><span class="line">| id | c1   | c2   | c3   |</span><br><span class="line">+<span class="comment">----+------+------+------+</span></span><br><span class="line">|  1 |    9 |    2 |   11 |</span><br><span class="line">+<span class="comment">----+------+------+------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure>

<p>MySQL5.7åŸç”Ÿæ”¯æŒçš„è®¡ç®—åˆ—æœ‰ä¸¤ç§æ¨¡å¼ï¼Œä¸€ç§æ˜¯è™šæ‹Ÿåˆ—ï¼Œä¸€ç§æ˜¯å­˜åœ¨ç£ç›˜ä¸­çš„åˆ—ã€‚è™šæ‹Ÿåˆ—ä¸å ç”¨ç£ç›˜ç©ºé—´</p>
<h2 id="å¼•å…¥äº†JSONåˆ—ç±»å‹åŠç›¸å…³çš„å‡½æ•°"><a href="#å¼•å…¥äº†JSONåˆ—ç±»å‹åŠç›¸å…³çš„å‡½æ•°" class="headerlink" title="å¼•å…¥äº†JSONåˆ—ç±»å‹åŠç›¸å…³çš„å‡½æ•°"></a>å¼•å…¥äº†JSONåˆ—ç±»å‹åŠç›¸å…³çš„å‡½æ•°</h2><ul>
<li>MySQL5.7ä¹‹å‰ï¼Œåªèƒ½åœ¨varcharæˆ–æ˜¯textç­‰å­—ç¬¦ç±»å‹çš„åˆ—ä¸­å­˜å‚¨jsonç±»å‹çš„å­—ç¬¦ä¸²ï¼Œå¹¶é€šè¿‡ç¨‹åºè§£ææ¥ä½¿ç”¨jsonå­—ç¬¦ä¸²</li>
<li>MySQL5.7ä¹‹åï¼Œå¢åŠ äº†jsonåˆ—ç±»å‹ä»¥åŠ<code>json_</code>å¼€å¤´çš„ç›¸å…³å¤„ç†å‡½æ•°ï¼Œå¦‚<code>json_type()``json_object()``json_merge()</code> ç­‰</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç”Ÿæˆä¸€ä¸ªjsonçš„æ•°ç»„</span></span><br><span class="line">mysql&gt; select json_array('a','b',now());</span><br><span class="line">+<span class="comment">------------------------------------------+</span></span><br><span class="line">| json_array('a','b',now())                |</span><br><span class="line">+<span class="comment">------------------------------------------+</span></span><br><span class="line">| ["a", "b", "2016-08-21 02:41:45.000000"] |</span><br><span class="line">+<span class="comment">------------------------------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”Ÿæˆä¸€ä¸ªjson KVå¯¹è±¡</span></span><br><span class="line">mysql&gt; <span class="keyword">select</span> json_object(<span class="string">'k1'</span>,<span class="number">1</span>,<span class="string">'k2'</span>,<span class="number">2</span>);</span><br><span class="line">+<span class="comment">----------------------------+</span></span><br><span class="line">| json_object('k1',1,'k2',2) |</span><br><span class="line">+<span class="comment">----------------------------+</span></span><br><span class="line">| &#123;"k1": 1, "k2": 2&#125;         |</span><br><span class="line">+<span class="comment">----------------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºä¸€ä¸ªå«æœ‰jsonç±»å‹å­—æ®µçš„è¡¨</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; create table t1(jdoc json);</span><br><span class="line">Query OK, 0 rows affected (0.32 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; show create table t1;</span><br><span class="line">+<span class="comment">-------+-------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line">| Table | <span class="keyword">Create</span> <span class="keyword">Table</span>                                                                                                      |</span><br><span class="line">+<span class="comment">-------+-------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line">| t1    | <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`t1`</span> (</span><br><span class="line">  <span class="string">`jdoc`</span> <span class="keyword">json</span> <span class="keyword">DEFAULT</span> <span class="literal">NULL</span></span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8mb4 <span class="keyword">COLLATE</span>=utf8mb4_unicode_ci |</span><br><span class="line">+<span class="comment">-------+-------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="keyword">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">insert</span> <span class="keyword">into</span> t1(jdoc) <span class="keyword">values</span>(json_array(<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="keyword">now</span>()));</span><br><span class="line">Query OK, 1 row affected (0.05 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into t1(jdoc) values(json_object('k1',1,'k2',2));</span><br><span class="line">Query OK, 1 row affected (0.06 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from t1;</span><br><span class="line">+<span class="comment">------------------------------------------+</span></span><br><span class="line">| jdoc                                     |</span><br><span class="line">+<span class="comment">------------------------------------------+</span></span><br><span class="line">| ["a", "b", "2016-08-21 02:47:50.000000"] |</span><br><span class="line">| &#123;"k1": 1, "k2": 2&#125;                       |</span><br><span class="line">+<span class="comment">------------------------------------------+</span></span><br><span class="line">2 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure>


<h1 id="REPLICATIONæ–¹é¢çš„å¢å¼º"><a href="#REPLICATIONæ–¹é¢çš„å¢å¼º" class="headerlink" title="REPLICATIONæ–¹é¢çš„å¢å¼º"></a>REPLICATIONæ–¹é¢çš„å¢å¼º</h1><h2 id="æ”¯æŒå¤šæºå¤åˆ¶"><a href="#æ”¯æŒå¤šæºå¤åˆ¶" class="headerlink" title="æ”¯æŒå¤šæºå¤åˆ¶"></a>æ”¯æŒå¤šæºå¤åˆ¶</h2><h2 id="åŸºäºåº“æˆ–æ˜¯é€»è¾‘é”çš„å¤šçº¿ç¨‹å¤åˆ¶"><a href="#åŸºäºåº“æˆ–æ˜¯é€»è¾‘é”çš„å¤šçº¿ç¨‹å¤åˆ¶" class="headerlink" title="åŸºäºåº“æˆ–æ˜¯é€»è¾‘é”çš„å¤šçº¿ç¨‹å¤åˆ¶"></a>åŸºäºåº“æˆ–æ˜¯é€»è¾‘é”çš„å¤šçº¿ç¨‹å¤åˆ¶</h2><h2 id="åœ¨çº¿å˜æ›´å¤åˆ¶æ–¹å¼"><a href="#åœ¨çº¿å˜æ›´å¤åˆ¶æ–¹å¼" class="headerlink" title="åœ¨çº¿å˜æ›´å¤åˆ¶æ–¹å¼"></a>åœ¨çº¿å˜æ›´å¤åˆ¶æ–¹å¼</h2><h1 id="InnoDBå­˜å‚¨å¼•æ“çš„å¢å¼º"><a href="#InnoDBå­˜å‚¨å¼•æ“çš„å¢å¼º" class="headerlink" title="InnoDBå­˜å‚¨å¼•æ“çš„å¢å¼º"></a>InnoDBå­˜å‚¨å¼•æ“çš„å¢å¼º</h1><h2 id="æ”¯æŒç¼“å†²æ± å¤§å°åœ¨çº¿å˜æ›´"><a href="#æ”¯æŒç¼“å†²æ± å¤§å°åœ¨çº¿å˜æ›´" class="headerlink" title="æ”¯æŒç¼“å†²æ± å¤§å°åœ¨çº¿å˜æ›´"></a>æ”¯æŒç¼“å†²æ± å¤§å°åœ¨çº¿å˜æ›´</h2><h2 id="å¢åŠ innodb-buffer-poolå¯¼å…¥å¯¼å‡ºåŠŸèƒ½"><a href="#å¢åŠ innodb-buffer-poolå¯¼å…¥å¯¼å‡ºåŠŸèƒ½" class="headerlink" title="å¢åŠ innodb_buffer_poolå¯¼å…¥å¯¼å‡ºåŠŸèƒ½"></a>å¢åŠ innodb_buffer_poolå¯¼å…¥å¯¼å‡ºåŠŸèƒ½</h2><h2 id="æ”¯æŒä¸ºinnodbè¡¨å»ºç«‹è¡¨ç©ºé—´"><a href="#æ”¯æŒä¸ºinnodbè¡¨å»ºç«‹è¡¨ç©ºé—´" class="headerlink" title="æ”¯æŒä¸ºinnodbè¡¨å»ºç«‹è¡¨ç©ºé—´"></a>æ”¯æŒä¸ºinnodbè¡¨å»ºç«‹è¡¨ç©ºé—´</h2><h1 id="MySQLå®‰å…¨æ–¹é¢çš„å¢å¼º"><a href="#MySQLå®‰å…¨æ–¹é¢çš„å¢å¼º" class="headerlink" title="MySQLå®‰å…¨æ–¹é¢çš„å¢å¼º"></a>MySQLå®‰å…¨æ–¹é¢çš„å¢å¼º</h1><h2 id="åˆå§‹åŒ–æ•°æ®åº“åçš„é»˜è®¤å¯†ç "><a href="#åˆå§‹åŒ–æ•°æ®åº“åçš„é»˜è®¤å¯†ç " class="headerlink" title="åˆå§‹åŒ–æ•°æ®åº“åçš„é»˜è®¤å¯†ç "></a>åˆå§‹åŒ–æ•°æ®åº“åçš„é»˜è®¤å¯†ç </h2><ul>
<li><p>åœ¨MySQL5.7ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œåˆå§‹åŒ–æ•°æ®åº“åï¼Œé»˜è®¤çš„rootå¯†ç ä¸ºç©ºï¼Œåœ¨localhostç›´æ¥ä½¿ç”¨mysqlå®¢æˆ·ç«¯ï¼Œå¯ä»¥ä»¥æ— å¯†ç çš„æ–¹å¼è¿›å…¥åˆ°æ•°æ®åº“ä¸­</p>
</li>
<li><p>åœ¨MySQL5.7ä¸­ï¼Œåœ¨åˆå§‹åŒ–æ•°æ®åº“ä¹‹åï¼Œä¼šä¸ºrootç”Ÿæˆä¸€ä¸ªå¼ºåº¦ä¸º<code>å¤§å†™å­—æ¯+å°å†™å­—æ¯+æ•°å­—+ç‰¹æ®Šç¬¦å·</code>çš„å¯†ç ï¼Œå¹¶ä¸”é¦–æ¬¡è¿›å…¥åˆ°mysqlæ—¶ï¼Œå¼ºåˆ¶è¦ä½ æ›´æ”¹å¯†ç ï¼Œä¸”å¼ºåº¦é»˜è®¤ä¾ç„¶ä¸º<code>å¤§å†™å­—æ¯+å°å†™å­—æ¯+æ•°å­—+ç‰¹æ®Šç¬¦å·</code></p>
</li>
</ul>
<p>å…³äºMySQL5.7çš„åˆå§‹åŒ–å¯†ç çš„æŸ¥æ‰¾ï¼Œå¯ä»¥å‚è€ƒæœ¬ç«™çš„æ–‡ç« </p>
<ul>
<li><a href="https://docs.20150509.cn/2016/07/28/MySQL5-7åˆå§‹å¯†ç /" target="_blank" rel="noopener">https://docs.20150509.cn/2016/07/28/MySQL5-7åˆå§‹å¯†ç /</a></li>
</ul>
<h2 id="é»˜è®¤çš„å¯†ç å¼ºåº¦"><a href="#é»˜è®¤çš„å¯†ç å¼ºåº¦" class="headerlink" title="é»˜è®¤çš„å¯†ç å¼ºåº¦"></a>é»˜è®¤çš„å¯†ç å¼ºåº¦</h2><p>mysqlå¯¹äºå¯†ç æœ‰3ç§æ£€éªŒç­–ç•¥ï¼Œé»˜è®¤validate_password_policyä¸ºMEDIUM</p>
<ul>
<li>LOW policy tests password length only. Passwords must be at least 8 characters long.</li>
<li>MEDIUM policy adds the conditions that passwords must contain at least 1 numeric character, 1 lowercase and uppercase character, and 1 special (nonalphanumeric) character.</li>
<li>STRONG policy adds the condition that password substrings of length 4 or longer must not match words</li>
</ul>
<p>å…³äºMySQL5.7å¯†ç å¼ºåº¦çš„æ›´æ”¹ï¼Œå¯ä»¥å‚è€ƒæœ¬ç«™çš„æ–‡ç« </p>
<ul>
<li><a href="https://docs.20150509.cn/2016/08/19/CentOS7å®‰è£…MySQL5-7/" target="_blank" rel="noopener">https://docs.20150509.cn/2016/08/19/CentOS7å®‰è£…MySQL5-7/</a></li>
</ul>
<h2 id="ä¸åœ¨æ”¯æŒold-passwordè®¤è¯"><a href="#ä¸åœ¨æ”¯æŒold-passwordè®¤è¯" class="headerlink" title="ä¸åœ¨æ”¯æŒold_passwordè®¤è¯"></a>ä¸åœ¨æ”¯æŒold_passwordè®¤è¯</h2><h2 id="å¢åŠ è´¦å·é»˜è®¤è¿‡æœŸæ—¶é—´"><a href="#å¢åŠ è´¦å·é»˜è®¤è¿‡æœŸæ—¶é—´" class="headerlink" title="å¢åŠ è´¦å·é»˜è®¤è¿‡æœŸæ—¶é—´"></a>å¢åŠ è´¦å·é»˜è®¤è¿‡æœŸæ—¶é—´</h2><h2 id="åŠ å¼ºäº†å¯¹è´¦å·çš„ç®¡ç†åŠŸèƒ½"><a href="#åŠ å¼ºäº†å¯¹è´¦å·çš„ç®¡ç†åŠŸèƒ½" class="headerlink" title="åŠ å¼ºäº†å¯¹è´¦å·çš„ç®¡ç†åŠŸèƒ½"></a>åŠ å¼ºäº†å¯¹è´¦å·çš„ç®¡ç†åŠŸèƒ½</h2><h2 id="å¢åŠ äº†sysç®¡ç†æ•°æ®åº“"><a href="#å¢åŠ äº†sysç®¡ç†æ•°æ®åº“" class="headerlink" title="å¢åŠ äº†sysç®¡ç†æ•°æ®åº“"></a>å¢åŠ äº†sysç®¡ç†æ•°æ®åº“</h2>]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL5.7</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¿®æ”¹MySQLçš„å­—ç¬¦é›†ä¸ºutf8mb4</title>
    <url>/2016/08/21/%E4%BF%AE%E6%94%B9MySQL%E7%9A%84%E5%AD%97%E7%AC%A6%E9%9B%86%E4%B8%BAutf8mb4/</url>
    <content><![CDATA[<blockquote>
<p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šè®¾ç½®MySQLé»˜è®¤çš„å­—ç¬¦ç¼–ç ä¸ºutf8ï¼Œä½†æ˜¯è¿‘äº›å¹´æ¥ï¼Œemojiè¡¨æƒ…çš„ç«çˆ†ä½¿ç”¨ï¼Œç»™æ•°æ®åº“å¸¦æ¥äº†æ„å¤–çš„é”™è¯¯ï¼Œå°±æ˜¯emojiçš„å­—ç¬¦é›†å·²ç»è¶…å‡ºäº†utf8çš„ç¼–ç èŒƒç•´ğŸ˜„</p>
</blockquote>
<h1 id="ä»¤äººæŠ“ç‹‚çš„å­—ç¬¦ç¼–ç é—®é¢˜"><a href="#ä»¤äººæŠ“ç‹‚çš„å­—ç¬¦ç¼–ç é—®é¢˜" class="headerlink" title="ä»¤äººæŠ“ç‹‚çš„å­—ç¬¦ç¼–ç é—®é¢˜"></a>ä»¤äººæŠ“ç‹‚çš„å­—ç¬¦ç¼–ç é—®é¢˜</h1><p>è°ˆåˆ°å­—ç¬¦ç¼–ç é—®é¢˜ï¼Œä¼šè®©å¾ˆå¤šäººæ„Ÿåˆ°å¤´ç–¼ï¼Œè¿™é‡Œä¸åœ¨æ·±ç©¶å„ä¸ªå­—ç¬¦ç¼–ç çš„ç‰¹ç‚¹å’Œç†è®ºï¼Œè¿™é‡Œåªè¯´ä¸‹Unicodeå’Œutf8å­—ç¬¦ç¼–ç çš„å…³ç³»</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Unicodeæ˜¯ç¼–ç å­—ç¬¦é›†ï¼Œè€ŒUTF-8å°±æ˜¯å­—ç¬¦ç¼–ç ï¼Œå³Unicodeè§„åˆ™å­—åº“çš„ä¸€ç§å®ç°å½¢å¼ã€‚</span><br><span class="line">éšç€äº’è”ç½‘çš„å‘å±•ï¼Œå¯¹åŒä¸€å­—åº“é›†çš„è¦æ±‚è¶Šæ¥è¶Šè¿«åˆ‡ï¼ŒUnicodeæ ‡å‡†ä¹Ÿå°±è‡ªç„¶è€Œç„¶çš„å‡ºç°ã€‚</span><br><span class="line">å®ƒå‡ ä¹æ¶µç›–äº†å„ä¸ªå›½å®¶è¯­è¨€å¯èƒ½å‡ºç°çš„ç¬¦å·å’Œæ–‡å­—ï¼Œå¹¶å°†ä¸ºä»–ä»¬ç¼–å·ã€‚</span><br><span class="line">è¯¦è§ï¼šUnicode on Wikipediaã€‚</span><br><span class="line">Unicodeçš„ç¼–å·ä»0000å¼€å§‹ä¸€ç›´åˆ°10FFFFå…±åˆ†ä¸º16ä¸ªPlaneï¼Œæ¯ä¸ªPlaneä¸­æœ‰65536ä¸ªå­—ç¬¦ã€‚</span><br><span class="line">è€ŒUTF-8åˆ™åªå®ç°äº†ç¬¬ä¸€ä¸ªPlaneï¼Œå¯è§UTF-8è™½ç„¶æ˜¯ä¸€ä¸ªå½“ä»Šæ¥å—åº¦æœ€å¹¿çš„å­—ç¬¦é›†ç¼–ç ï¼Œ</span><br><span class="line">ä½†æ˜¯å®ƒå¹¶æ²¡æœ‰æ¶µç›–æ•´ä¸ªUnicodeçš„å­—åº“ï¼Œè¿™ä¹Ÿé€ æˆäº†å®ƒåœ¨æŸäº›åœºæ™¯ä¸‹å¯¹äºç‰¹æ®Šå­—ç¬¦çš„å¤„ç†å›°éš¾</span><br></pre></td></tr></table></figure>

<p><strong>ç®€å•çš„è¯´åœ¨è®¡ç®—æœºå†…å­˜ä¸­ï¼Œç»Ÿä¸€ä½¿ç”¨Unicodeç¼–ç ï¼Œå½“éœ€è¦ä¿å­˜åˆ°ç¡¬ç›˜æˆ–è€…éœ€è¦ä¼ è¾“çš„æ—¶å€™ï¼Œå°±è½¬æ¢ä¸ºUTF-8ç¼–ç </strong></p>
<p>ç”¨è®°äº‹æœ¬ç¼–è¾‘çš„æ—¶å€™ï¼Œä»æ–‡ä»¶è¯»å–çš„UTF-8å­—ç¬¦è¢«è½¬æ¢ä¸ºUnicodeå­—ç¬¦åˆ°å†…å­˜é‡Œï¼Œç¼–è¾‘å®Œæˆåï¼Œä¿å­˜çš„æ—¶å€™å†æŠŠUnicodeè½¬æ¢ä¸ºUTF-8ä¿å­˜åˆ°æ–‡ä»¶</p>
<p><img src="http://oss.20150509.cn/QQ20160821-0@2x.png" alt=""></p>
<p>emojiæ˜¯Unicodeç¼–ç ï¼Œåœ¨MySQLä¸­ä½¿ç”¨utf8ç¼–ç æ— æ³•æ­£å¸¸æ˜¾ç¤ºemojiçš„è¡¨æƒ…ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒMySQLåœ¨5.5.3ç‰ˆæœ¬ä¹‹åï¼Œå¼•è¿›äº†æ–°çš„å­—ç¬¦ç¼–ç <code>utf8mb4</code>,æœ¬ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»å¦‚ä½•å°†å·²ç»æ˜¯utf8çš„databaseåˆ‡æ¢åˆ°utf8mb4å­—ç¬¦ç¼–ç </p>
<h1 id="ä»€ä¹ˆæ˜¯utf8mb4"><a href="#ä»€ä¹ˆæ˜¯utf8mb4" class="headerlink" title="ä»€ä¹ˆæ˜¯utf8mb4"></a>ä»€ä¹ˆæ˜¯utf8mb4</h1><p>utf8mb4æœ€æ˜æ˜¾çš„å¥½å¤„æ˜¯è§£å†³äº†è‹¹æœæŒ–çš„å‘-æ¨å¹¿äº†emojiè¡¨æƒ…ã€‚utf8mb4è§£å†³äº†MySQLæ•°æ®åº“å­˜å‚¨emojiè¡¨æƒ…çš„é—®é¢˜</p>
<p>utf8mb4æ˜¯utf8çš„è¶…é›†ï¼Œç†è®ºä¸Šç”±utf8å‡çº§åˆ°utf8mb4å­—ç¬¦ç¼–ç æ²¡æœ‰ä»»ä½•å…¼å®¹é—®é¢˜</p>
<h1 id="å‡çº§utf8åˆ°utf8mb4"><a href="#å‡çº§utf8åˆ°utf8mb4" class="headerlink" title="å‡çº§utf8åˆ°utf8mb4"></a>å‡çº§utf8åˆ°utf8mb4</h1><h2 id="1-å¤‡ä»½"><a href="#1-å¤‡ä»½" class="headerlink" title="1. å¤‡ä»½"></a>1. å¤‡ä»½</h2><p>å®‰å…¨ç¬¬ä¸€ï¼Œå¤‡ä»½æ‰€æœ‰éœ€è¦å‡çº§å­—ç¬¦ç¼–ç çš„æ•°æ®åº“</p>
<ul>
<li>å¯ä»¥å°†åº“dumpå‡ºæ¥</li>
<li>å¦‚æœæ˜¯è™šæ‹Ÿæœºï¼Œå¯ä»¥ç»™æ•´ä¸ªä¸»æœºåšå¿«ç…§</li>
</ul>
<h2 id="2-å‡çº§"><a href="#2-å‡çº§" class="headerlink" title="2. å‡çº§"></a>2. å‡çº§</h2><p>utf8mb4æ˜¯MySQL5.5.3ç‰ˆæœ¬ä¹‹åæ”¯æŒçš„å­—ç¬¦é›†ï¼Œsoï¼Œå¦‚æœä½ éœ€è¦ä½¿ç”¨è¿™ä¸ªå­—ç¬¦é›†ï¼Œå‰ææ¡ä»¶æ˜¯ä½ çš„MySQLç‰ˆæœ¬å¿…é¡» &gt;= 5.5.3</p>
<h2 id="3-ä¿®æ”¹"><a href="#3-ä¿®æ”¹" class="headerlink" title="3. ä¿®æ”¹"></a>3. ä¿®æ”¹</h2><p>åœ¨MySQLä¸­ï¼Œå¯ä»¥ä¸ºä¸€ä¸ªdatabaseè®¾ç½®å­—ç¬¦ç¼–ç ï¼Œå¯ä»¥ä¸ºä¸€å¼ è¡¨è®¾ç½®å­—ç¬¦ç¼–ç ï¼Œç”šè‡³å¯ä»¥ä¸ºæŸä¸€ä¸ªå­—æ®µè®¾ç½®å­—ç¬¦ç¼–ç </p>
<ul>
<li>æŸ¥çœ‹å½“å‰ç³»ç»Ÿé»˜è®¤çš„å­—ç¬¦é›†è®¾ç½®</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; SHOW VARIABLES WHERE Variable_name LIKE 'character\_set\_%' OR Variable_name LIKE 'collation%';</span><br><span class="line">+<span class="comment">--------------------------+-----------------+</span></span><br><span class="line">| Variable_name            | Value           |</span><br><span class="line">+<span class="comment">--------------------------+-----------------+</span></span><br><span class="line">| character_set_client     | utf8            |</span><br><span class="line">| character_set_connection | utf8            |</span><br><span class="line">| character_set_database   | utf8            |</span><br><span class="line">| character_set_filesystem | binary          |</span><br><span class="line">| character_set_results    | utf8            |</span><br><span class="line">| character_set_server     | utf8            |</span><br><span class="line">| character_set_system     | utf8            |</span><br><span class="line">| collation_connection     | utf8_general_ci |</span><br><span class="line">| collation_database       | utf8_general_ci |</span><br><span class="line">| collation_server         | utf8_general_ci |</span><br><span class="line">+<span class="comment">--------------------------+-----------------+</span></span><br><span class="line">10 rows in <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>æŸ¥çœ‹databaseçš„å­—ç¬¦ç¼–ç </li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; show create database polarsnow;</span><br><span class="line">+<span class="comment">-----------+--------------------------------------------------------------------+</span></span><br><span class="line">| Database  | <span class="keyword">Create</span> <span class="keyword">Database</span>                                                    |</span><br><span class="line">+<span class="comment">-----------+--------------------------------------------------------------------+</span></span><br><span class="line">| polarsnow | <span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> <span class="string">`polarsnow`</span> <span class="comment">/*!40100 DEFAULT CHARACTER SET utf8 */</span> |</span><br><span class="line">+<span class="comment">-----------+--------------------------------------------------------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="keyword">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>æŸ¥çœ‹tableçš„å­—ç¬¦ç¼–ç </li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; show create table ps;</span><br><span class="line">+-------+---------------------------------------------------------------------------------------------+</span><br><span class="line">| Table | Create Table                                                                                |</span><br><span class="line">+-------+---------------------------------------------------------------------------------------------+</span><br><span class="line">| ps    | CREATE TABLE &#96;ps&#96; (</span><br><span class="line">  &#96;name&#96; varchar(100) DEFAULT NULL</span><br><span class="line">) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8 |</span><br><span class="line">+-------+---------------------------------------------------------------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<ul>
<li>æŸ¥çœ‹columnçš„å­—ç¬¦ç¼–ç </li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; show full columns from ps;</span><br><span class="line">+<span class="comment">-------+--------------+-----------------+------+-----+---------+-------+---------------------------------+---------+</span></span><br><span class="line">| Field | Type         | Collation       | Null | Key | Default | Extra | Privileges                      | <span class="keyword">Comment</span> |</span><br><span class="line">+<span class="comment">-------+--------------+-----------------+------+-----+---------+-------+---------------------------------+---------+</span></span><br><span class="line">| <span class="keyword">name</span>  | <span class="built_in">varchar</span>(<span class="number">100</span>) | utf8_general_ci | YES  |     | <span class="literal">NULL</span>    |       | <span class="keyword">select</span>,<span class="keyword">insert</span>,<span class="keyword">update</span>,<span class="keyword">references</span> |         |</span><br><span class="line">+<span class="comment">-------+--------------+-----------------+------+-----+---------+-------+---------------------------------+---------+</span></span><br><span class="line"><span class="number">1</span> <span class="keyword">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<h3 id="ä¿®æ”¹databaseé»˜è®¤çš„å­—ç¬¦é›†"><a href="#ä¿®æ”¹databaseé»˜è®¤çš„å­—ç¬¦é›†" class="headerlink" title="ä¿®æ”¹databaseé»˜è®¤çš„å­—ç¬¦é›†"></a>ä¿®æ”¹databaseé»˜è®¤çš„å­—ç¬¦é›†</h3><p><code>ALTER DATABASE database_name CHARACTER SET = utf8mb4 COLLATE = utf8mb4_unicode_ci;</code></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; ALTER DATABASE polarsnow CHARACTER SET = utf8mb4 COLLATE = utf8mb4_unicode_ci;</span><br><span class="line">Query OK, 1 row affected (0.03 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; show create database polarsnow;</span><br><span class="line">+<span class="comment">-----------+--------------------------------------------------------------------------------------------------+</span></span><br><span class="line">| Database  | <span class="keyword">Create</span> <span class="keyword">Database</span>                                                                                  |</span><br><span class="line">+<span class="comment">-----------+--------------------------------------------------------------------------------------------------+</span></span><br><span class="line">| polarsnow | <span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> <span class="string">`polarsnow`</span> <span class="comment">/*!40100 DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci */</span> |</span><br><span class="line">+<span class="comment">-----------+--------------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="keyword">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">show</span> <span class="keyword">tables</span>;</span><br><span class="line">+<span class="comment">---------------------+</span></span><br><span class="line">| Tables_in_polarsnow |</span><br><span class="line">+<span class="comment">---------------------+</span></span><br><span class="line">| ps                  |</span><br><span class="line">+<span class="comment">---------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">table</span> ps;</span><br><span class="line">+<span class="comment">-------+---------------------------------------------------------------------------------------------+</span></span><br><span class="line">| Table | <span class="keyword">Create</span> <span class="keyword">Table</span>                                                                                |</span><br><span class="line">+<span class="comment">-------+---------------------------------------------------------------------------------------------+</span></span><br><span class="line">| ps    | <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`ps`</span> (</span><br><span class="line">  <span class="string">`name`</span> <span class="built_in">varchar</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span></span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8 |</span><br><span class="line">+<span class="comment">-------+---------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="keyword">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">show</span> <span class="keyword">full</span> <span class="keyword">columns</span> <span class="keyword">from</span> ps;</span><br><span class="line">+<span class="comment">-------+--------------+-----------------+------+-----+---------+-------+---------------------------------+---------+</span></span><br><span class="line">| Field | Type         | Collation       | Null | Key | Default | Extra | Privileges                      | <span class="keyword">Comment</span> |</span><br><span class="line">+<span class="comment">-------+--------------+-----------------+------+-----+---------+-------+---------------------------------+---------+</span></span><br><span class="line">| <span class="keyword">name</span>  | <span class="built_in">varchar</span>(<span class="number">100</span>) | utf8_general_ci | YES  |     | <span class="literal">NULL</span>    |       | <span class="keyword">select</span>,<span class="keyword">insert</span>,<span class="keyword">update</span>,<span class="keyword">references</span> |         |</span><br><span class="line">+<span class="comment">-------+--------------+-----------------+------+-----+---------+-------+---------------------------------+---------+</span></span><br><span class="line"><span class="number">1</span> <span class="keyword">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">create</span> <span class="keyword">table</span> test_tb2 (tb2 <span class="built_in">varchar</span>(<span class="number">100</span>) );</span><br><span class="line">Query OK, 0 rows affected (0.21 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; show tables;</span><br><span class="line">+<span class="comment">---------------------+</span></span><br><span class="line">| Tables_in_polarsnow |</span><br><span class="line">+<span class="comment">---------------------+</span></span><br><span class="line">| ps                  |</span><br><span class="line">| test_tb2            |</span><br><span class="line">+<span class="comment">---------------------+</span></span><br><span class="line">2 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">table</span> test_tb2;</span><br><span class="line">+<span class="comment">----------+-----------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line">| Table    | <span class="keyword">Create</span> <span class="keyword">Table</span>                                                                                                                                              |</span><br><span class="line">+<span class="comment">----------+-----------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line">| test_tb2 | <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`test_tb2`</span> (</span><br><span class="line">  <span class="string">`tb2`</span> <span class="built_in">varchar</span>(<span class="number">100</span>) <span class="keyword">COLLATE</span> utf8mb4_unicode_ci <span class="keyword">DEFAULT</span> <span class="literal">NULL</span></span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8mb4 <span class="keyword">COLLATE</span>=utf8mb4_unicode_ci |</span><br><span class="line">+<span class="comment">----------+-----------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="keyword">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼Œè™½ç„¶ä¿®æ”¹äº†databaseçš„å­—ç¬¦é›†ä¸ºutf8mb4ï¼Œä½†æ˜¯å®é™…åªæ˜¯ä¿®æ”¹äº†databaseæ–°åˆ›å»ºçš„è¡¨ï¼Œé»˜è®¤ä½¿ç”¨utf8mb4ï¼ŒåŸæ¥å·²ç»å­˜åœ¨çš„è¡¨ï¼Œå­—ç¬¦é›†å¹¶æ²¡æœ‰è·Ÿç€æ”¹å˜ï¼Œéœ€è¦æ‰‹åŠ¨ä¸ºæ¯å¼ è¡¨è®¾ç½®å­—ç¬¦é›†</p>
<h3 id="ä¿®æ”¹tableçš„å­—ç¬¦é›†"><a href="#ä¿®æ”¹tableçš„å­—ç¬¦é›†" class="headerlink" title="ä¿®æ”¹tableçš„å­—ç¬¦é›†"></a>ä¿®æ”¹tableçš„å­—ç¬¦é›†</h3><ul>
<li>åªä¿®æ”¹è¡¨é»˜è®¤çš„å­—ç¬¦é›† <code>ALTER TABLE table_name DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;</code></li>
<li>ä¿®æ”¹è¡¨é»˜è®¤çš„å­—ç¬¦é›†å’Œæ‰€æœ‰å­—ç¬¦åˆ—çš„å­—ç¬¦é›† <code>ALTER TABLE table_name CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;</code></li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; show create table ps;</span><br><span class="line">+<span class="comment">-------+---------------------------------------------------------------------------------------------+</span></span><br><span class="line">| Table | <span class="keyword">Create</span> <span class="keyword">Table</span>                                                                                |</span><br><span class="line">+<span class="comment">-------+---------------------------------------------------------------------------------------------+</span></span><br><span class="line">| ps    | <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`ps`</span> (</span><br><span class="line">  <span class="string">`name`</span> <span class="built_in">varchar</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span></span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8 |</span><br><span class="line">+<span class="comment">-------+---------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="keyword">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">show</span> <span class="keyword">full</span> <span class="keyword">columns</span> <span class="keyword">from</span> ps;</span><br><span class="line">+<span class="comment">-------+--------------+-----------------+------+-----+---------+-------+---------------------------------+---------+</span></span><br><span class="line">| Field | Type         | Collation       | Null | Key | Default | Extra | Privileges                      | <span class="keyword">Comment</span> |</span><br><span class="line">+<span class="comment">-------+--------------+-----------------+------+-----+---------+-------+---------------------------------+---------+</span></span><br><span class="line">| <span class="keyword">name</span>  | <span class="built_in">varchar</span>(<span class="number">100</span>) | utf8_general_ci | YES  |     | <span class="literal">NULL</span>    |       | <span class="keyword">select</span>,<span class="keyword">insert</span>,<span class="keyword">update</span>,<span class="keyword">references</span> |         |</span><br><span class="line">+<span class="comment">-------+--------------+-----------------+------+-----+---------+-------+---------------------------------+---------+</span></span><br><span class="line"><span class="number">1</span> <span class="keyword">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">ALTER</span> <span class="keyword">TABLE</span> ps <span class="keyword">CONVERT</span> <span class="keyword">TO</span> <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_unicode_ci;</span><br><span class="line">Query OK, 0 rows affected (0.38 sec)</span><br><span class="line">Records: 0  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; show create table ps;</span><br><span class="line">+<span class="comment">-------+------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line">| Table | <span class="keyword">Create</span> <span class="keyword">Table</span>                                                                                                                                         |</span><br><span class="line">+<span class="comment">-------+------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line">| ps    | <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`ps`</span> (</span><br><span class="line">  <span class="string">`name`</span> <span class="built_in">varchar</span>(<span class="number">100</span>) <span class="keyword">COLLATE</span> utf8mb4_unicode_ci <span class="keyword">DEFAULT</span> <span class="literal">NULL</span></span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8mb4 <span class="keyword">COLLATE</span>=utf8mb4_unicode_ci |</span><br><span class="line">+<span class="comment">-------+------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="keyword">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">show</span> <span class="keyword">full</span> <span class="keyword">columns</span> <span class="keyword">from</span> ps;</span><br><span class="line">+<span class="comment">-------+--------------+--------------------+------+-----+---------+-------+---------------------------------+---------+</span></span><br><span class="line">| Field | Type         | Collation          | Null | Key | Default | Extra | Privileges                      | <span class="keyword">Comment</span> |</span><br><span class="line">+<span class="comment">-------+--------------+--------------------+------+-----+---------+-------+---------------------------------+---------+</span></span><br><span class="line">| <span class="keyword">name</span>  | <span class="built_in">varchar</span>(<span class="number">100</span>) | utf8mb4_unicode_ci | YES  |     | <span class="literal">NULL</span>    |       | <span class="keyword">select</span>,<span class="keyword">insert</span>,<span class="keyword">update</span>,<span class="keyword">references</span> |         |</span><br><span class="line">+<span class="comment">-------+--------------+--------------------+------+-----+---------+-------+---------------------------------+---------+</span></span><br><span class="line"><span class="number">1</span> <span class="keyword">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure>

<h3 id="ä¿®æ”¹columné»˜è®¤çš„å­—ç¬¦é›†"><a href="#ä¿®æ”¹columné»˜è®¤çš„å­—ç¬¦é›†" class="headerlink" title="ä¿®æ”¹columné»˜è®¤çš„å­—ç¬¦é›†"></a>ä¿®æ”¹columné»˜è®¤çš„å­—ç¬¦é›†</h3><p><code>ALTER TABLE table_name CHANGE column_name column_name VARCHAR(191) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;</code></p>
<p><em>æ³¨ï¼šVARCHAR(191) æ ¹æ®å­—æ®µå®ä¾‹çš„ç±»å‹å¡«å†™</em></p>
<h2 id="4-æ£€æŸ¥å­—æ®µçš„æœ€å¤§é•¿åº¦å’Œç´¢å¼•åˆ—"><a href="#4-æ£€æŸ¥å­—æ®µçš„æœ€å¤§é•¿åº¦å’Œç´¢å¼•åˆ—" class="headerlink" title="4. æ£€æŸ¥å­—æ®µçš„æœ€å¤§é•¿åº¦å’Œç´¢å¼•åˆ—"></a>4. æ£€æŸ¥å­—æ®µçš„æœ€å¤§é•¿åº¦å’Œç´¢å¼•åˆ—</h2><ul>
<li>å­—æ®µé•¿åº¦</li>
</ul>
<p>ç”±äºä»utf8å‡çº§åˆ°äº†utf8mb4ï¼Œä¸€ä¸ªå­—ç¬¦æ‰€å ç”¨çš„ç©ºé—´ä¹Ÿç”±3ä¸ªå­—èŠ‚å¢é•¿åˆ°4ä¸ªå­—èŠ‚ï¼Œä½†æ˜¯æˆ‘ä»¬å½“åˆåˆ›å»ºè¡¨æ—¶ï¼Œè®¾ç½®çš„å­—æ®µç±»å‹ä»¥åŠæœ€å¤§çš„é•¿åº¦æ²¡æœ‰æ”¹å˜ã€‚ä¾‹å¦‚ï¼Œä½ åœ¨utf8ä¸‹è®¾ç½®æŸä¸€å­—æ®µçš„ç±»å‹ä¸º<code>TINYTEXT</code>, è¿™ä¸­å­—æ®µç±»å‹æœ€å¤§å¯ä»¥å®¹çº³255å­—èŠ‚ï¼Œä¸‰ä¸ªå­—èŠ‚ä¸€ä¸ªå­—ç¬¦çš„æƒ…å†µä¸‹å¯ä»¥å®¹çº³85ä¸ªå­—ç¬¦ï¼Œå››ä¸ªå­—èŠ‚ä¸€ä¸ªå­—ç¬¦çš„æƒ…å†µä¸‹åªèƒ½å®¹çº³63ä¸ªå­—ç¬¦ï¼Œå¦‚æœåŸè¡¨ä¸­çš„è¿™ä¸ªå­—æ®µçš„å€¼æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªè¶…è¿‡äº†63ä¸ªå­—ç¬¦ï¼Œé‚£ä¹ˆè½¬æ¢æˆutf8mb4å­—ç¬¦ç¼–ç æ—¶å°†è½¬æ¢å¤±è´¥ï¼Œä½ å¿…é¡»å…ˆå°†<code>TINYTEXT</code>æ›´æ”¹ä¸º<code>TEXT</code>ç­‰æ›´é«˜å®¹é‡çš„ç±»å‹ä¹‹åæ‰èƒ½ç»§ç»­è½¬æ¢å­—ç¬¦ç¼–ç </p>
<ul>
<li>ç´¢å¼•</li>
</ul>
<p>åœ¨InnoDBå¼•æ“ä¸­ï¼Œæœ€å¤§çš„ç´¢å¼•é•¿åº¦ä¸º767å­—èŠ‚ï¼Œä¸‰ä¸ªå­—èŠ‚ä¸€ä¸ªå­—ç¬¦çš„æƒ…å†µä¸‹ï¼Œç´¢å¼•åˆ—çš„å­—ç¬¦é•¿åº¦æœ€å¤§å¯ä»¥è¾¾åˆ°255ï¼Œå››ä¸ªå­—èŠ‚ä¸€ä¸ªå­—ç¬¦çš„æƒ…å†µä¸‹ï¼Œç´¢å¼•çš„å­—ç¬¦é•¿åº¦æœ€å¤§åªèƒ½åˆ°191ã€‚å¦‚æœä½ å·²ç»å­˜åœ¨çš„è¡¨ä¸­çš„ç´¢å¼•åˆ—çš„ç±»å‹ä¸º<code>VARCHAR(255)</code>é‚£ä¹ˆè½¬æ¢utf8mb4æ—¶åŒæ ·ä¼šè½¬æ¢å¤±è´¥ã€‚ä½ éœ€è¦å…ˆå°†<code>VARCHAR(255)</code>æ›´æ”¹ä¸º<code>VARCHAR(191)</code>æ‰èƒ½ç»§ç»­è½¬æ¢å­—ç¬¦ç¼–ç </p>
<h2 id="5-ä¿®æ”¹é…ç½®æ–‡ä»¶"><a href="#5-ä¿®æ”¹é…ç½®æ–‡ä»¶" class="headerlink" title="5. ä¿®æ”¹é…ç½®æ–‡ä»¶"></a>5. ä¿®æ”¹é…ç½®æ–‡ä»¶</h2><p><code>SET NAMES utf8 COLLATE utf8_unicode_ci</code> becomes <code>SET NAMES utf8mb4 COLLATE utf8mb4_unicode_ci</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; vim /etc/my.cnf</span><br><span class="line"><span class="comment"># å¯¹æœ¬åœ°çš„mysqlå®¢æˆ·ç«¯çš„é…ç½®</span></span><br><span class="line">[client]</span><br><span class="line">default-character-set = utf8mb4</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¹å…¶ä»–è¿œç¨‹è¿æ¥çš„mysqlå®¢æˆ·ç«¯çš„é…ç½®</span></span><br><span class="line">[mysql]</span><br><span class="line">default-character-set = utf8mb4</span><br><span class="line"></span><br><span class="line"><span class="comment"># æœ¬åœ°mysqlæœåŠ¡çš„é…ç½®</span></span><br><span class="line">[mysqld]</span><br><span class="line">character-set-client-handshake = FALSE</span><br><span class="line">character-set-server = utf8mb4</span><br><span class="line">collation-server = utf8mb4_unicode_ci</span><br><span class="line">&gt; service mysqld restart</span><br></pre></td></tr></table></figure>

<p>æ£€æŸ¥ä¿®æ”¹</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; SHOW VARIABLES WHERE Variable_name LIKE 'character\_set\_%' OR Variable_name LIKE 'collation%';</span><br><span class="line">+<span class="comment">--------------------------+--------------------+</span></span><br><span class="line">| Variable_name            | Value              |</span><br><span class="line">+<span class="comment">--------------------------+--------------------+</span></span><br><span class="line">| character_set_client     | utf8mb4            |</span><br><span class="line">| character_set_connection | utf8mb4            |</span><br><span class="line">| character_set_database   | utf8mb4            |</span><br><span class="line">| character_set_filesystem | binary             |</span><br><span class="line">| character_set_results    | utf8mb4            |</span><br><span class="line">| character_set_server     | utf8mb4            |</span><br><span class="line">| character_set_system     | utf8               |</span><br><span class="line">| collation_connection     | utf8mb4_unicode_ci |</span><br><span class="line">| collation_database       | utf8mb4_unicode_ci |</span><br><span class="line">| collation_server         | utf8mb4_unicode_ci |</span><br><span class="line">+<span class="comment">--------------------------+--------------------+</span></span><br><span class="line">10 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<p><em>æ³¨ï¼šcharacter_set_system ä¸€ç›´éƒ½ä¼šæ˜¯ utf8ï¼Œä¸èƒ½è¢«æ›´æ”¹</em></p>
<h2 id="6-ä¿®å¤-amp-ä¼˜åŒ–æ‰€æœ‰æ•°æ®è¡¨"><a href="#6-ä¿®å¤-amp-ä¼˜åŒ–æ‰€æœ‰æ•°æ®è¡¨" class="headerlink" title="6. ä¿®å¤&amp;ä¼˜åŒ–æ‰€æœ‰æ•°æ®è¡¨"></a>6. ä¿®å¤&amp;ä¼˜åŒ–æ‰€æœ‰æ•°æ®è¡¨</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; mysqlcheck -u root -p --auto-repair --optimize --all-databases</span><br></pre></td></tr></table></figure>

<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>ä¸è¦åœ¨MySQLä¸Šä½¿ç”¨utf8å­—ç¬¦ç¼–ç ï¼Œæ¨èä½¿ç”¨<code>utf8mb4</code>ï¼Œè‡³äºä¸ºä»€ä¹ˆï¼Œå¼•ç”¨å›½å¤–å‹äººçš„ä¸€æ®µè¯ï¼š</p>
<blockquote>
<p>Never use utf8 in MySQL â€” always use utf8mb4 instead. Updating your databases and code might take some time, but itâ€™s definitely worth the effort. Why would you arbitrarily limit the set of symbols that can be used in your database? Why would you lose data every time a user enters an astral symbol as part of a comment or message or whatever it is you store in your database? Thereâ€™s no reason not to strive for full Unicode support everywhere. Do the right thing, and use utf8mb4. ğŸ»</p>
</blockquote>
<h1 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h1><ul>
<li>å­—ç¬¦é›†å’Œå­—ç¬¦ç¼–ç çš„å…³ç³»ï¼š<a href="http://www.cnblogs.com/cenalulu/p/4251639.html" target="_blank" rel="noopener">http://www.cnblogs.com/cenalulu/p/4251639.html</a></li>
<li>è®©mysqlæ”¯æŒutf8mb4ï¼š<a href="https://mathiasbynens.be/notes/mysql-utf8mb4" target="_blank" rel="noopener">https://mathiasbynens.be/notes/mysql-utf8mb4</a></li>
</ul>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>utf8mb4</tag>
        <tag>utf8</tag>
        <tag>Unicode</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL5.7ç¦»çº¿æ›´æ”¹ä¸ºäº‹åŠ¡å¤åˆ¶</title>
    <url>/2016/08/19/MySQL5-7%E7%A6%BB%E7%BA%BF%E6%9B%B4%E6%94%B9%E4%B8%BA%E4%BA%8B%E5%8A%A1%E5%A4%8D%E5%88%B6/</url>
    <content><![CDATA[<blockquote>
<p>ä»MySQL5.6ç‰ˆæœ¬å¼€å§‹ï¼Œæ”¯æŒä»¥äº‹åŠ¡çš„æ–¹å¼æ¥åšä¸»ä»åŒæ­¥ï¼Œæœ€å¤§é™åº¦çš„ä¿è¯MySQLçš„ä¸»ä»ä¸€è‡´æ€§ã€‚å®ç°è¿™ä¸€å¤åˆ¶ç‰¹æ€§çš„å…³é”®æ˜¯GTID(Global Transaction Identifiers)å…¨å±€äº‹åŠ¡IDï¼Œé€šè¿‡GTIDæ¥å¼ºåŒ–æ•°æ®åº“çš„ä¸»ä»ä¸€è‡´æ€§ï¼Œæ•…éšœæ¢å¤ä»¥åŠå®¹é”™èƒ½åŠ›</p>
<p>MySQL5.7æ”¯æŒåœ¨çº¿ä¿®æ”¹å¤åˆ¶ç±»å‹ï¼ŒMySQL5.6åªèƒ½ç¦»çº¿ä¿®æ”¹ï¼Œæœ¬ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»ç¦»çº¿ä¿®æ”¹å¤åˆ¶ç±»å‹çš„æ–¹æ³•ï¼Œåç»­çš„æ–‡ç« ä¸­ä¼šä»‹ç»å¦‚ä½•åœ¨çº¿æ›´æ¢å¤åˆ¶ç±»å‹</p>
</blockquote>
<h1 id="ä»€ä¹ˆæ˜¯GTID"><a href="#ä»€ä¹ˆæ˜¯GTID" class="headerlink" title="ä»€ä¹ˆæ˜¯GTID"></a>ä»€ä¹ˆæ˜¯GTID</h1><p>å®˜æ–¹æ–‡æ¡£ï¼š</p>
<ul>
<li>5.6: <a href="http://dev.mysql.com/doc/refman/5.6/en/replication-gtids.html" target="_blank" rel="noopener">http://dev.mysql.com/doc/refman/5.6/en/replication-gtids.html</a></li>
<li>5.7: <a href="http://dev.mysql.com/doc/refman/5.7/en/replication-gtids.html" target="_blank" rel="noopener">http://dev.mysql.com/doc/refman/5.7/en/replication-gtids.html</a></li>
</ul>
<p>A GTID is represented as a pair of coordinates, separated by a colon character (:), as shown here:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">GTID &#x3D; source_id:transaction_id</span><br></pre></td></tr></table></figure>

<p>æ¯ä¸€ä¸ª GTID ä»£è¡¨ä¸€ä¸ªæ•°æ®åº“äº‹åŠ¡ã€‚åœ¨ä¸Šé¢çš„å®šä¹‰ä¸­ï¼Œ<code>source_id</code> è¡¨ç¤ºæ‰§è¡Œäº‹åŠ¡çš„ä¸»åº“ uuidï¼ˆserver_uuidï¼‰ï¼Œ<code>transaction_id</code> æ˜¯ä¸€ä¸ªä» 1 å¼€å§‹çš„è‡ªå¢è®¡æ•°ï¼Œè¡¨ç¤ºåœ¨è¿™ä¸ªä¸»åº“ä¸Šæ‰§è¡Œçš„ç¬¬ n ä¸ªäº‹åŠ¡ã€‚MySQL ä¼šä¿è¯äº‹åŠ¡ä¸ GTID ä¹‹é—´çš„ 1 : 1 æ˜ å°„</p>
<h1 id="æœåŠ¡å™¨èµ„æº"><a href="#æœåŠ¡å™¨èµ„æº" class="headerlink" title="æœåŠ¡å™¨èµ„æº"></a>æœåŠ¡å™¨èµ„æº</h1><ul>
<li>masterï¼š192.168.10.153</li>
<li>slaveï¼š192.168.10.157</li>
</ul>
<h1 id="å®‰è£…MySQL5-7"><a href="#å®‰è£…MySQL5-7" class="headerlink" title="å®‰è£…MySQL5.7"></a>å®‰è£…MySQL5.7</h1><p>ç•¥</p>
<p>å¯ä»¥å‚è€ƒä¸Šä¸€ç¯‡æ–‡ç« æ¥å®‰è£…MySQL5.7</p>
<h1 id="masteré…ç½®"><a href="#masteré…ç½®" class="headerlink" title="masteré…ç½®"></a>masteré…ç½®</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; vim /etc/my.cnf</span><br><span class="line"><span class="comment"># clientçš„é…ç½®ä¼šè¢«MySQLå®¢æˆ·ç«¯åº”ç”¨è¯»å–</span></span><br><span class="line"><span class="comment"># åªæœ‰MySQLé™„å¸¦çš„å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºä¿è¯å¯ä»¥è¯»å–åˆ°è¿™æ®µå†…å®¹</span></span><br><span class="line">[client]</span><br><span class="line">port = 3306</span><br><span class="line">socket = /tmp/mysql.sock</span><br><span class="line"><span class="comment"># ç”Ÿäº§ç¯å¢ƒä¸­æ‰€ä½¿ç”¨çš„å­—ç¬¦é›†æ¨èè®¾ç½®ä¸ºutf8mb4</span></span><br><span class="line"><span class="comment"># è¿™é‡Œé»˜è®¤ä½¿ç”¨utf8ï¼Œå­—ç¬¦é›†çš„é—®é¢˜å°†æœ‰ç‹¬ç«‹çš„æ–‡ç« ä»‹ç»</span></span><br><span class="line">default-character-set = utf8</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®¢æˆ·ç«¯è¯»å–çš„é…ç½®æ–‡ä»¶</span></span><br><span class="line">[mysql]</span><br><span class="line">no-auto-rehash</span><br><span class="line"><span class="comment"># ç”Ÿäº§ç¯å¢ƒä¸­æ‰€ä½¿ç”¨çš„å­—ç¬¦é›†æ¨èè®¾ç½®ä¸ºutf8mb4</span></span><br><span class="line"><span class="comment"># è¿™é‡Œé»˜è®¤ä½¿ç”¨utf8ï¼Œå­—ç¬¦é›†çš„é—®é¢˜å°†æœ‰ç‹¬ç«‹çš„æ–‡ç« ä»‹ç»</span></span><br><span class="line">default-character-set = utf8</span><br><span class="line"></span><br><span class="line"><span class="comment"># MySQLæœåŠ¡ç«¯è¯»å–çš„é…ç½®æ–‡ä»¶</span></span><br><span class="line">[mysqld]</span><br><span class="line">server-id = 10153  <span class="comment"># ä¿è¯server-idçš„å”¯ä¸€æ€§ï¼Œè¿™é‡Œé‡‡ç”¨äº†IPçš„åä¸¤ä½æ¥ä¿è¯å”¯ä¸€æ€§</span></span><br><span class="line">port = 3306 <span class="comment"># MySQLæœåŠ¡ç›‘å¬çš„ç«¯å£å·</span></span><br><span class="line">user = mysql <span class="comment"># ä»¥mysqlç”¨æˆ·æ¥è¿è¡ŒMySQLæœåŠ¡è¿›ç¨‹</span></span><br><span class="line">basedir = /usr/<span class="built_in">local</span>/mysql <span class="comment"># MySQLæœåŠ¡çš„æ ¹ç›®å½•ï¼ˆç¼–è¯‘å®‰è£…æŒ‡å®šè·¯å¾„ï¼Œyumå®‰è£…æ³¨é‡Šæ‰å³å¯ï¼‰</span></span><br><span class="line">datadir = /data/mysqldata <span class="comment"># æ•°æ®ç›®å½•</span></span><br><span class="line">socket = /tmp/mysql.sock <span class="comment"># socketæ–‡ä»¶æ‰€åœ¨çš„ä½ç½®</span></span><br><span class="line">default-storage-engine = INNODB <span class="comment"># é»˜è®¤çš„å­˜å‚¨å¼•æ“</span></span><br><span class="line"><span class="comment"># ç”Ÿäº§ç¯å¢ƒä¸­æ‰€ä½¿ç”¨çš„å­—ç¬¦é›†æ¨èè®¾ç½®ä¸ºutf8mb4</span></span><br><span class="line"><span class="comment"># è¿™é‡Œé»˜è®¤ä½¿ç”¨utf8ï¼Œå­—ç¬¦é›†çš„é—®é¢˜å°†æœ‰ç‹¬ç«‹çš„æ–‡ç« ä»‹ç»</span></span><br><span class="line">character-set-server = utf8</span><br><span class="line">connect_timeout = 60 <span class="comment"># è¿æ¥è¶…æ—¶æ—¶é—´</span></span><br><span class="line">interactive_timeout = 28800 <span class="comment"># MySQLåœ¨å…³é—­ä¸€ä¸ªäº¤äº’çš„è¿æ¥ä¹‹å‰æ‰€è¦ç­‰å¾…çš„ç§’æ•°(äº¤äº’è¿æ¥å¦‚mysql gui toolä¸­çš„è¿æ¥)</span></span><br><span class="line">wait_timeout = 28800 <span class="comment"># MySQLåœ¨å…³é—­ä¸€ä¸ªéäº¤äº’çš„è¿æ¥ä¹‹å‰æ‰€è¦ç­‰å¾…çš„ç§’æ•°</span></span><br><span class="line">back_log = 500 <span class="comment"># æ“ä½œç³»ç»Ÿåœ¨ç›‘å¬é˜Ÿåˆ—ä¸­æ‰€èƒ½ä¿æŒçš„è¿æ¥æ•°</span></span><br><span class="line">event_scheduler = ON <span class="comment"># å¼€å¯å®šæ—¶ä»»åŠ¡æœºåˆ¶</span></span><br><span class="line">skip_name_resolve = ON <span class="comment"># å¿½ç•¥IPæ–¹å‘è§£æ</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###########binlog##########</span></span><br><span class="line"><span class="built_in">log</span>-bin = /data/mysqlLog/logs/mysql-bin <span class="comment"># æ‰“å¼€äºŒè¿›åˆ¶æ—¥å¿—åŠŸèƒ½</span></span><br><span class="line"><span class="comment"># å½“è®¾ç½®éš”ç¦»çº§åˆ«ä¸ºREAD-COMMITEDå¿…é¡»è®¾ç½®äºŒè¿›åˆ¶æ—¥å¿—æ ¼å¼ä¸ºROW</span></span><br><span class="line"><span class="comment"># ç°åœ¨MySQLå®˜æ–¹è®¤ä¸ºSTATEMENTè¿™ä¸ªå·²ç»ä¸å†é€‚åˆç»§ç»­ä½¿ç”¨</span></span><br><span class="line"><span class="comment"># ä½†mixedç±»å‹åœ¨é»˜è®¤çš„äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸‹ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¸»ä»æ•°æ®ä¸ä¸€è‡´</span></span><br><span class="line">binlog_format = row <span class="comment"># å¤åˆ¶æ¨¡å¼ä¸ºè¡Œçº§æ¨¡å¼ï¼ˆå¤åˆ¶æ¨¡å¼çš„ä»‹ç»å¯ä»¥å‚è€ƒæœ¬ç«™å…³äºå¤åˆ¶åŸºç¡€çš„æ–‡ç« ï¼‰</span></span><br><span class="line">max_binlog_size = 128M <span class="comment"># æ¯ä¸ªäºŒè¿›åˆ¶æ—¥å¿—æœ€å¤§çš„æ–‡ä»¶å¤§å°</span></span><br><span class="line">binlog_cache_size = 2M <span class="comment"># äºŒè¿›åˆ¶æ—¥å¿—ç¼“å­˜å¤§å°</span></span><br><span class="line">expire-logs-days = 5 <span class="comment"># äºŒè¿›åˆ¶æ—¥å¿—çš„ä¿å­˜æ—¶é—´ï¼ˆä¿å­˜æœ€è¿‘5å¤©çš„äºŒè¿›åˆ¶æ—¥å¿—ï¼‰</span></span><br><span class="line"><span class="comment"># å°†slaveåœ¨masteræ”¶åˆ°çš„æ›´æ–°è®°å…¥åˆ°slaveè‡ªå·±çš„äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶ä¸­</span></span><br><span class="line"><span class="comment"># åœ¨MySQLçº§è”å¤åˆ¶ä¸­ï¼Œè¿™ä¸ªå‚æ•°å¿…é¡»æ‰“å¼€ï¼ˆA=&gt;B=&gt;Cï¼‰</span></span><br><span class="line"><span class="built_in">log</span>-slave-updates=<span class="literal">true</span> </span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»¥ä¸‹ä¸‰ä¸ªå‚æ•°å¯ç”¨å¤åˆ¶æœ‰å…³çš„æ‰€æœ‰æ ¡éªŒåŠŸèƒ½</span></span><br><span class="line">binlog_checksum = CRC32 <span class="comment"># checksumä½¿ç”¨zlibä¸­çš„CRC-32ç®—æ³•</span></span><br><span class="line"><span class="comment"># ä¸ä»…dump threadä¼šå¯¹eventè¿›è¡Œæ ¡éªŒï¼Œå½“masterä¸Šæ‰§è¡Œshow binlog eventsçš„æ—¶å€™</span></span><br><span class="line"><span class="comment"># ä¹Ÿä¼šå¯¹eventè¿›è¡Œæ ¡éªŒ</span></span><br><span class="line"><span class="comment"># è®¾ç½®ä¸º1ï¼Œå¯ä»¥ä¿è¯eventè¢«å®Œæ•´æ— ç¼ºåœ°å†™å…¥åˆ°ä¸»æœåŠ¡å™¨çš„binlogä¸­äº†</span></span><br><span class="line">master_verify_checksum = 1 </span><br><span class="line">slave_sql_verify_checksum = 1 <span class="comment"># è®¾ç½®ä¸º1ï¼Œslaveä¸Šçš„IO Threadå†™å…¥åˆ°Relay Logæ—¶å’ŒSQL Threadè¯»å–Relay Logæ—¶ä¼šå¯¹checksumè¿›è¡ŒéªŒè¯</span></span><br><span class="line"></span><br><span class="line">binlog_rows_query_log_events = 1 <span class="comment"># å¯ç”¨äºåœ¨äºŒè¿›åˆ¶æ—¥å¿—è®°å½•äº‹ä»¶ç›¸å…³çš„ä¿¡æ¯ï¼Œå¯é™ä½æ•…éšœæ’é™¤çš„å¤æ‚åº¦</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###### GTIDäº‹åŠ¡å¤åˆ¶æ”¯æŒéƒ¨åˆ† ######</span></span><br><span class="line">gtid-mode=on <span class="comment"># å¼€å¯å…¨å±€äº‹åŠ¡ID</span></span><br><span class="line">enforce-gtid-consistency=<span class="literal">true</span> <span class="comment"># å¼€å¯å¼ºåˆ¶å…¨å±€äº‹åŠ¡IDä¸€è‡´æ€§ï¼ˆç”¨äºå¯åŠ¨GTIDåŠæ»¡è¶³é™„å±çš„å…¶å®ƒéœ€æ±‚ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯ç”¨æ­¤ä¸¤é¡¹ï¼Œå¯ç”¨äºå®ç°åœ¨å´©æºƒæ—¶ä¿è¯äºŒè¿›åˆ¶åŠä»æœåŠ¡å™¨å®‰å…¨çš„åŠŸèƒ½</span></span><br><span class="line">master-info-repository=TABLE </span><br><span class="line">relay-log-info-repository=TABLE</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sync-master-info=1 <span class="comment"># ç¡®ä¿æ— ä¿¡æ¯ä¸¢å¤±</span></span><br><span class="line">slave-parallel-workers=4 <span class="comment"># è®¾å®šä»æœåŠ¡å™¨çš„SQLçº¿ç¨‹æ•°ï¼›0è¡¨ç¤ºå…³é—­å¤šçº¿ç¨‹å¤åˆ¶åŠŸèƒ½</span></span><br><span class="line"><span class="comment"># rpl_semi_sync_master_enabled = 1 # åŠåŒæ­¥å¤åˆ¶</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ…¢SQLçš„ç›¸å…³é…ç½®</span></span><br><span class="line">slow_query_log = 1</span><br><span class="line">slow_query_log_file = /data/mysqlLog/logs/mysql.slow</span><br><span class="line">long_query_time = 1</span><br><span class="line"> </span><br><span class="line">log_error = /data/mysqlLog/logs/error.log <span class="comment"># é”™è¯¯ä¿¡æ¯çš„é…ç½®</span></span><br><span class="line">max_connections = 3000 <span class="comment"># MySQLçš„æœ€å¤§è¿æ¥æ•°</span></span><br><span class="line">max_connect_errors = 32767 <span class="comment"># æŸä¸€å®¢æˆ·ç«¯å°è¯•è¿æ¥æ­¤MySQLæœåŠ¡å™¨ï¼Œä½†æ˜¯å¤±è´¥ï¼ˆå¦‚å¯†ç é”™è¯¯ç­‰ç­‰ï¼‰32767æ¬¡ï¼Œåˆ™MySQLä¼šæ— æ¡ä»¶å¼ºåˆ¶é˜»æ­¢æ­¤å®¢æˆ·ç«¯è¿æ¥</span></span><br><span class="line">log_bin_trust_function_creators = 1 <span class="comment"># å…è®¸ä½¿ç”¨MySQLè‡ªå®šä¹‰å‡½æ•°</span></span><br><span class="line">transaction_isolation = READ-COMMITTED <span class="comment"># è®¾ç½®äº‹åŠ¡éš”ç¦»çº§åˆ«</span></span><br></pre></td></tr></table></figure>

<h1 id="slaveé…ç½®"><a href="#slaveé…ç½®" class="headerlink" title="slaveé…ç½®"></a>slaveé…ç½®</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; vim /etc/my.cnf</span><br><span class="line">[client]</span><br><span class="line">port = 3306</span><br><span class="line">socket = /tmp/mysql.sock</span><br><span class="line">default-character-set = utf8</span><br><span class="line"></span><br><span class="line">[mysql]</span><br><span class="line">no-auto-rehash</span><br><span class="line">default-character-set = utf8</span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line">server-id = 10157</span><br><span class="line">port = 3306</span><br><span class="line">user = mysql</span><br><span class="line">basedir = /usr/<span class="built_in">local</span>/mysql</span><br><span class="line">datadir = /data/mysqldata</span><br><span class="line">socket = /tmp/mysql.sock</span><br><span class="line">default-storage-engine = INNODB</span><br><span class="line">character-set-server = utf8</span><br><span class="line">connect_timeout = 60</span><br><span class="line">wait_timeout = 18000</span><br><span class="line">back_log = 500</span><br><span class="line">event_scheduler = ON</span><br><span class="line"> </span><br><span class="line"><span class="comment">###########binlog##########</span></span><br><span class="line"><span class="built_in">log</span>-bin = /data/mysqlLog/logs/mysql-bin</span><br><span class="line">binlog_format = row</span><br><span class="line">max_binlog_size = 128M</span><br><span class="line">binlog_cache_size = 2M</span><br><span class="line">expire-logs-days = 5</span><br><span class="line"><span class="built_in">log</span>-slave-updates=<span class="literal">true</span></span><br><span class="line">gtid-mode=on </span><br><span class="line">enforce-gtid-consistency=<span class="literal">true</span></span><br><span class="line">master-info-repository=TABLE</span><br><span class="line">relay-log-info-repository=TABLE</span><br><span class="line">sync-master-info=1</span><br><span class="line">slave-parallel-workers=4</span><br><span class="line"><span class="comment"># rpl_semi_sync_slave_enabled = 1</span></span><br><span class="line"><span class="comment"># skip-slave-start # slaveå¤åˆ¶è¿›ç¨‹ä¸éšmysqlå¯åŠ¨è€Œå¯åŠ¨</span></span><br><span class="line"></span><br><span class="line">slow_query_log = 1</span><br><span class="line">slow_query_log_file = /data/mysqlLog/logs/mysql.slow</span><br><span class="line">long_query_time = 2</span><br><span class="line"></span><br><span class="line"><span class="built_in">log</span>-error = /data/mysqlLog/logs/error.log</span><br><span class="line">max_connections = 3000</span><br><span class="line">max_connect_errors = 10000</span><br><span class="line">log_bin_trust_function_creators = 1</span><br><span class="line">transaction_isolation = READ-COMMITTED</span><br></pre></td></tr></table></figure>

<h1 id="åˆ†åˆ«å¯åŠ¨ä¸»åº“å’Œä»åº“"><a href="#åˆ†åˆ«å¯åŠ¨ä¸»åº“å’Œä»åº“" class="headerlink" title="åˆ†åˆ«å¯åŠ¨ä¸»åº“å’Œä»åº“"></a>åˆ†åˆ«å¯åŠ¨ä¸»åº“å’Œä»åº“</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; systemctl restart mysqld</span><br></pre></td></tr></table></figure>

<h1 id="åœ¨ä¸»åº“ä¸­åˆ›å»ºå¤åˆ¶ç”¨æˆ·"><a href="#åœ¨ä¸»åº“ä¸­åˆ›å»ºå¤åˆ¶ç”¨æˆ·" class="headerlink" title="åœ¨ä¸»åº“ä¸­åˆ›å»ºå¤åˆ¶ç”¨æˆ·"></a>åœ¨ä¸»åº“ä¸­åˆ›å»ºå¤åˆ¶ç”¨æˆ·</h1><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; SET GLOBAL validate_password_policy = LOW;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; create user 'repl' identified by '12345678';</span><br><span class="line">Query OK, 0 rows affected (0.05 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; grant replication slave on *.* to repl@'%';</span><br><span class="line">Query OK, 0 rows affected (0.02 sec)</span><br></pre></td></tr></table></figure>

<h1 id="æŸ¥çœ‹ä¸»åº“ä¸ä»åº“GTIDçŠ¶æ€"><a href="#æŸ¥çœ‹ä¸»åº“ä¸ä»åº“GTIDçŠ¶æ€" class="headerlink" title="æŸ¥çœ‹ä¸»åº“ä¸ä»åº“GTIDçŠ¶æ€"></a>æŸ¥çœ‹ä¸»åº“ä¸ä»åº“GTIDçŠ¶æ€</h1><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; show variables like 'gtid_mode';</span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line">| gtid_mode     | ON    |</span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure>

<h1 id="åœ¨ä»åº“å¯åŠ¨å¤åˆ¶çº¿ç¨‹"><a href="#åœ¨ä»åº“å¯åŠ¨å¤åˆ¶çº¿ç¨‹" class="headerlink" title="åœ¨ä»åº“å¯åŠ¨å¤åˆ¶çº¿ç¨‹"></a>åœ¨ä»åº“å¯åŠ¨å¤åˆ¶çº¿ç¨‹</h1><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; change master to</span><br><span class="line">    -&gt;   master_host='192.168.10.153',</span><br><span class="line">    -&gt;   master_port=3306,</span><br><span class="line">    -&gt;   master_user='repl',</span><br><span class="line">    -&gt;   master_password='12345678',</span><br><span class="line">    -&gt;   master_auto_position=1 for channel "db153";</span><br><span class="line">Query OK, 0 rows affected, 2 warnings (0.27 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; start slave for channel "db153";</span><br><span class="line">Query OK, 0 rows affected (0.09 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; show slave status for channel "db153" \G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">               Slave_IO_State: Waiting for master to send event</span><br><span class="line">                  Master_Host: 192.168.10.153</span><br><span class="line">                  Master_User: repl</span><br><span class="line">                  Master_Port: 3306</span><br><span class="line">                Connect_Retry: 60</span><br><span class="line">              Master_Log_File: mysql-bin.000001</span><br><span class="line">          Read_Master_Log_Pos: 595</span><br><span class="line">               Relay_Log_File: localhost-relay-bin-db153.000002</span><br><span class="line">                Relay_Log_Pos: 808</span><br><span class="line">        Relay_Master_Log_File: mysql-bin.000001</span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br><span class="line">              Replicate_Do_DB: </span><br><span class="line">          Replicate_Ignore_DB: </span><br><span class="line">           Replicate_Do_Table: </span><br><span class="line">       Replicate_Ignore_Table: </span><br><span class="line">      Replicate_Wild_Do_Table: </span><br><span class="line">  Replicate_Wild_Ignore_Table: </span><br><span class="line">                   Last_Errno: 0</span><br><span class="line">                   Last_Error: </span><br><span class="line">                 Skip_Counter: 0</span><br><span class="line">          Exec_Master_Log_Pos: 595</span><br><span class="line">              Relay_Log_Space: 1025</span><br><span class="line">              Until_Condition: None</span><br><span class="line">               Until_Log_File: </span><br><span class="line">                Until_Log_Pos: 0</span><br><span class="line">           Master_SSL_Allowed: No</span><br><span class="line">           Master_SSL_CA_File: </span><br><span class="line">           Master_SSL_CA_Path: </span><br><span class="line">              Master_SSL_Cert: </span><br><span class="line">            Master_SSL_Cipher: </span><br><span class="line">               Master_SSL_Key: </span><br><span class="line">        Seconds_Behind_Master: 0</span><br><span class="line">Master_SSL_Verify_Server_Cert: No</span><br><span class="line">                Last_IO_Errno: 0</span><br><span class="line">                Last_IO_Error: </span><br><span class="line">               Last_SQL_Errno: 0</span><br><span class="line">               Last_SQL_Error: </span><br><span class="line">  Replicate_Ignore_Server_Ids: </span><br><span class="line">             Master_Server_Id: 10153</span><br><span class="line">                  Master_UUID: 1349d343-6611-11e6-b341-005056ad5f2f</span><br><span class="line">             Master_Info_File: mysql.slave_master_info</span><br><span class="line">                    SQL_Delay: 0</span><br><span class="line">          SQL_Remaining_Delay: NULL</span><br><span class="line">      Slave_SQL_Running_State: Slave has read all relay log; waiting for more updates</span><br><span class="line">           Master_Retry_Count: 86400</span><br><span class="line">                  Master_Bind: </span><br><span class="line">      Last_IO_Error_Timestamp: </span><br><span class="line">     Last_SQL_Error_Timestamp: </span><br><span class="line">               Master_SSL_Crl: </span><br><span class="line">           Master_SSL_Crlpath: </span><br><span class="line">           Retrieved_Gtid_Set: 1349d343-6611-11e6-b341-005056ad5f2f:1-2</span><br><span class="line">            Executed_Gtid_Set: 1349d343-6611-11e6-b341-005056ad5f2f:1-2</span><br><span class="line">                Auto_Position: 1</span><br><span class="line">         Replicate_Rewrite_DB: </span><br><span class="line">                 Channel_Name: db153</span><br><span class="line">           Master_TLS_Version: </span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure>

<h1 id="éªŒè¯ä¸»ä»åŒæ­¥"><a href="#éªŒè¯ä¸»ä»åŒæ­¥" class="headerlink" title="éªŒè¯ä¸»ä»åŒæ­¥"></a>éªŒè¯ä¸»ä»åŒæ­¥</h1><h2 id="master"><a href="#master" class="headerlink" title="master"></a>master</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; show master status;</span><br><span class="line">+<span class="comment">------------------+----------+--------------+------------------+------------------------------------------+</span></span><br><span class="line">| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set                        |</span><br><span class="line">+<span class="comment">------------------+----------+--------------+------------------+------------------------------------------+</span></span><br><span class="line">| mysql-bin.000001 |      595 |              |                  | 1349d343-6611-11e6-b341-005056ad5f2f:1-2 |</span><br><span class="line">+<span class="comment">------------------+----------+--------------+------------------+------------------------------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">create</span> <span class="keyword">database</span> polarsnow;</span><br><span class="line">Query OK, 1 row affected (0.03 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; show master status;</span><br><span class="line">+<span class="comment">------------------+----------+--------------+------------------+------------------------------------------+</span></span><br><span class="line">| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set                        |</span><br><span class="line">+<span class="comment">------------------+----------+--------------+------------------+------------------------------------------+</span></span><br><span class="line">| mysql-bin.000001 |      769 |              |                  | 1349d343-6611-11e6-b341-005056ad5f2f:1-3 |</span><br><span class="line">+<span class="comment">------------------+----------+--------------+------------------+------------------------------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure>

<h2 id="slave"><a href="#slave" class="headerlink" title="slave"></a>slave</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; show slave status for channel "db153"\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">               Slave_IO_State: Waiting for master to send event</span><br><span class="line">                  Master_Host: 192.168.10.153</span><br><span class="line">                  Master_User: repl</span><br><span class="line">                  Master_Port: 3306</span><br><span class="line">                Connect_Retry: 60</span><br><span class="line">              Master_Log_File: mysql-bin.000001</span><br><span class="line">          Read_Master_Log_Pos: 769</span><br><span class="line">               Relay_Log_File: localhost-relay-bin-db153.000002</span><br><span class="line">                Relay_Log_Pos: 982</span><br><span class="line">        Relay_Master_Log_File: mysql-bin.000001</span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br><span class="line">              Replicate_Do_DB: </span><br><span class="line">          Replicate_Ignore_DB: </span><br><span class="line">           Replicate_Do_Table: </span><br><span class="line">       Replicate_Ignore_Table: </span><br><span class="line">      Replicate_Wild_Do_Table: </span><br><span class="line">  Replicate_Wild_Ignore_Table: </span><br><span class="line">                   Last_Errno: 0</span><br><span class="line">                   Last_Error: </span><br><span class="line">                 Skip_Counter: 0</span><br><span class="line">          Exec_Master_Log_Pos: 769</span><br><span class="line">              Relay_Log_Space: 1199</span><br><span class="line">              Until_Condition: None</span><br><span class="line">               Until_Log_File: </span><br><span class="line">                Until_Log_Pos: 0</span><br><span class="line">           Master_SSL_Allowed: No</span><br><span class="line">           Master_SSL_CA_File: </span><br><span class="line">           Master_SSL_CA_Path: </span><br><span class="line">              Master_SSL_Cert: </span><br><span class="line">            Master_SSL_Cipher: </span><br><span class="line">               Master_SSL_Key: </span><br><span class="line">        Seconds_Behind_Master: 0</span><br><span class="line">Master_SSL_Verify_Server_Cert: No</span><br><span class="line">                Last_IO_Errno: 0</span><br><span class="line">                Last_IO_Error: </span><br><span class="line">               Last_SQL_Errno: 0</span><br><span class="line">               Last_SQL_Error: </span><br><span class="line">  Replicate_Ignore_Server_Ids: </span><br><span class="line">             Master_Server_Id: 10153</span><br><span class="line">                  Master_UUID: 1349d343-6611-11e6-b341-005056ad5f2f</span><br><span class="line">             Master_Info_File: mysql.slave_master_info</span><br><span class="line">                    SQL_Delay: 0</span><br><span class="line">          SQL_Remaining_Delay: NULL</span><br><span class="line">      Slave_SQL_Running_State: Slave has read all relay log; waiting for more updates</span><br><span class="line">           Master_Retry_Count: 86400</span><br><span class="line">                  Master_Bind: </span><br><span class="line">      Last_IO_Error_Timestamp: </span><br><span class="line">     Last_SQL_Error_Timestamp: </span><br><span class="line">               Master_SSL_Crl: </span><br><span class="line">           Master_SSL_Crlpath: </span><br><span class="line">           Retrieved_Gtid_Set: 1349d343-6611-11e6-b341-005056ad5f2f:1-3</span><br><span class="line">            Executed_Gtid_Set: 1349d343-6611-11e6-b341-005056ad5f2f:1-3</span><br><span class="line">                Auto_Position: 1</span><br><span class="line">         Replicate_Rewrite_DB: </span><br><span class="line">                 Channel_Name: db153</span><br><span class="line">           Master_TLS_Version: </span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">show</span> <span class="keyword">databases</span>;</span><br><span class="line">+<span class="comment">--------------------+</span></span><br><span class="line">| Database           |</span><br><span class="line">+<span class="comment">--------------------+</span></span><br><span class="line">| information_schema |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| polarsnow          |</span><br><span class="line">| sys                |</span><br><span class="line">+<span class="comment">--------------------+</span></span><br><span class="line">5 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure>

<p>è‡³æ­¤ï¼Œäº‹åŠ¡åŒæ­¥é…ç½®æˆåŠŸï¼</p>
<p>åœ¨ä¹‹å‰ä½¿ç”¨äºŒè¿›åˆ¶å¤åˆ¶çš„ä¸»ä»æ¨¡å¼æ—¶ï¼Œç»å†äº†å„ç§ä¸»ä»æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µï¼Œè€Œä»MySQL5.6å¼€å§‹æ–°å¼•å…¥çš„äº‹åŠ¡å¤åˆ¶èƒ½å¦è§£å†³äºŒè¿›åˆ¶bin-logå¤åˆ¶çš„æ•°æ®ä¸€è‡´æ€§çš„ç—›ç‚¹è¿˜æœ‰å¾…è§‚å¯Ÿå’Œæ£€éªŒâ€¦â€¦</p>
<h1 id="é™„å½•"><a href="#é™„å½•" class="headerlink" title="é™„å½•"></a>é™„å½•</h1><ul>
<li>MySQL5.7å®˜æ–¹æ–‡æ¡£ï¼š<a href="http://dev.mysql.com/doc/refman/5.7/en/" target="_blank" rel="noopener">http://dev.mysql.com/doc/refman/5.7/en/</a></li>
<li>å‚è€ƒæ–‡æ¡£ï¼š<a href="http://www.cnblogs.com/darren-lee/p/5160802.html" target="_blank" rel="noopener">http://www.cnblogs.com/darren-lee/p/5160802.html</a></li>
</ul>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL5.7</tag>
        <tag>ä¸»ä»å¤åˆ¶</tag>
        <tag>GTID</tag>
        <tag>äº‹åŠ¡åŒæ­¥</tag>
        <tag>Global Transaction Identifiers</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS7å®‰è£…MySQL5.7</title>
    <url>/2016/08/19/CentOS7%E5%AE%89%E8%A3%85MySQL5-7/</url>
    <content><![CDATA[<blockquote>
<p>è¿™é‡Œä½¿ç”¨yumçš„æ–¹å¼å®‰è£…mysql5.7ï¼Œä»…ä¸ºæµ‹è¯•ä½¿ç”¨ï¼Œç”Ÿäº§ç¯å¢ƒä¸­ï¼Œè¿˜æ˜¯å»ºè®®ä½¿ç”¨cmakeç¼–è¯‘å®‰è£…mysql    </p>
</blockquote>
<h1 id="å®‰è£…MySQL"><a href="#å®‰è£…MySQL" class="headerlink" title="å®‰è£…MySQL"></a>å®‰è£…MySQL</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; yum remove -y mysql</span><br><span class="line">&gt; <span class="built_in">cd</span> /usr/<span class="built_in">local</span>/src/</span><br><span class="line">&gt; wget http://repo.mysql.com/mysql57-community-release-el7-8.noarch.rpm</span><br><span class="line">&gt; rpm -ivh mysql57-community-release-el7-8.noarch.rpm </span><br><span class="line">è­¦å‘Šï¼šmysql57-community-release-el7-8.noarch.rpm: å¤´V3 DSA/SHA1 Signature, å¯†é’¥ ID 5072e1f5: NOKEY</span><br><span class="line">å‡†å¤‡ä¸­...                          <span class="comment">################################# [100%]</span></span><br><span class="line">æ­£åœ¨å‡çº§/å®‰è£…...</span><br><span class="line">   1:mysql57-community-release-el7-8  <span class="comment">################################# [100%]</span></span><br><span class="line">&gt; yum install -y mysql-server</span><br><span class="line">&gt; systemctl start mysqld</span><br><span class="line">&gt; systemctl status mysqld</span><br><span class="line">â— mysqld.service - MySQL Server</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/mysqld.service; enabled; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since äº” 2016-08-19 09:30:24 EDT; 29s ago</span><br><span class="line">  Process: 105136 ExecStart=/usr/sbin/mysqld --daemonize --pid-file=/var/run/mysqld/mysqld.pid <span class="variable">$MYSQLD_OPTS</span> (code=exited, status=0/SUCCESS)</span><br><span class="line">  Process: 105049 ExecStartPre=/usr/bin/mysqld_pre_systemd (code=exited, status=0/SUCCESS)</span><br><span class="line"> Main PID: 105138 (mysqld)</span><br><span class="line">   CGroup: /system.slice/mysqld.service</span><br><span class="line">           â””â”€105138 /usr/sbin/mysqld --daemonize --pid-file=/var/run/mysqld/mysqld.pid</span><br><span class="line"></span><br><span class="line">8æœˆ 19 09:30:16 localhost.localdomain systemd[1]: Starting MySQL Server...</span><br><span class="line">8æœˆ 19 09:30:24 localhost.localdomain systemd[1]: Started MySQL Server.</span><br><span class="line">&gt; cat /var/<span class="built_in">log</span>/mysqld.log| grep <span class="string">"temporary password"</span></span><br><span class="line">2016-08-19T13:30:20.547835Z 1 [Note] A temporary password is generated <span class="keyword">for</span> root@localhost: TVu7ouUi&gt;55l</span><br><span class="line">&gt; mysql -uroot -p</span><br><span class="line">Enter password:TVu7ouUi&gt;55l</span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 2</span><br><span class="line">Server version: 5.7.14</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2016, Oracle and/or its affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type <span class="string">'help;'</span> or <span class="string">'\h'</span> <span class="keyword">for</span> <span class="built_in">help</span>. Type <span class="string">'\c'</span> to clear the current input statement.</span><br><span class="line"></span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure>

<h1 id="è®¾ç½®rootç”¨æˆ·å¯†ç "><a href="#è®¾ç½®rootç”¨æˆ·å¯†ç " class="headerlink" title="è®¾ç½®rootç”¨æˆ·å¯†ç "></a>è®¾ç½®rootç”¨æˆ·å¯†ç </h1><p>MySQL5.7é»˜è®¤çš„å¯†ç å¤æ‚åº¦ä¸ºï¼šå¤§å°å†™å­—æ¯+æ•°å­—+ç‰¹æ®Šç¬¦å·</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; alter user user() identified by 'w&#123;YQW6L;Dsf6vw';</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; </span><br><span class="line">mysql&gt; SHOW VARIABLES LIKE 'validate_password%';</span><br><span class="line">+<span class="comment">--------------------------------------+--------+</span></span><br><span class="line">| Variable_name                        | Value  |</span><br><span class="line">+<span class="comment">--------------------------------------+--------+</span></span><br><span class="line">| validate_password_dictionary_file    |        |</span><br><span class="line">| validate_password_length             | 8      |</span><br><span class="line">| validate_password_mixed_case_count   | 1      |</span><br><span class="line">| validate_password_number_count       | 1      |</span><br><span class="line">| validate_password_policy             | MEDIUM |</span><br><span class="line">| validate_password_special_char_count | 1      |</span><br><span class="line">+<span class="comment">--------------------------------------+--------+</span></span><br><span class="line">6 rows in <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure>

<p>mysqlå¯¹äºå¯†ç æœ‰3ç§æ£€éªŒç­–ç•¥ï¼Œé»˜è®¤<code>validate_password_policy</code>ä¸º<code>MEDIUM</code></p>
<ul>
<li>LOW policy tests password length only. Passwords must be at least 8 characters long.</li>
<li>MEDIUM policy adds the conditions that passwords must contain at least 1 numeric character, 1 lowercase and uppercase character, and 1 special (nonalphanumeric) character.</li>
<li>STRONG policy adds the condition that password substrings of length 4 or longer must not match words</li>
</ul>
<p>åœ¨é»˜è®¤<code>MEDIUM</code>çš„ç­–ç•¥ä¸‹ï¼Œä¿®æ”¹å¯†ç ä¸ºï¼š12345678ä¼šæŠ¥é”™</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; alter user user() identified by '12345678';</span><br><span class="line">ERROR 1819 (HY000): Your password does not satisfy the current policy requirements</span><br></pre></td></tr></table></figure>

<h1 id="ä¿®æ”¹MySQLå¯†ç æ£€æŸ¥ç­–ç•¥"><a href="#ä¿®æ”¹MySQLå¯†ç æ£€æŸ¥ç­–ç•¥" class="headerlink" title="ä¿®æ”¹MySQLå¯†ç æ£€æŸ¥ç­–ç•¥"></a>ä¿®æ”¹MySQLå¯†ç æ£€æŸ¥ç­–ç•¥</h1><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; SET GLOBAL validate_password_policy = LOW;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; alter user user() identified by '12345678';</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure>


]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL5.7</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQLæ•°æ®ç±»å‹</title>
    <url>/2016/08/14/MySQL%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/</url>
    <content><![CDATA[<h1 id="æ•´å½¢"><a href="#æ•´å½¢" class="headerlink" title="æ•´å½¢"></a>æ•´å½¢</h1><table>
<thead>
<tr>
<th>å­˜å‚¨ç±»å‹</th>
<th>å­˜å‚¨ç©ºé—´ï¼ˆå­—èŠ‚ï¼‰</th>
<th>æœ€å°å€¼</th>
<th>æœ€å¤§å€¼</th>
</tr>
</thead>
<tbody><tr>
<td>TINYINT</td>
<td>1</td>
<td>-128</td>
<td>127</td>
</tr>
<tr>
<td></td>
<td></td>
<td>0</td>
<td>255</td>
</tr>
<tr>
<td>SMALLINT</td>
<td>2</td>
<td>-32768</td>
<td>32767</td>
</tr>
<tr>
<td></td>
<td></td>
<td>0</td>
<td>65535</td>
</tr>
<tr>
<td>MEDIUMINT</td>
<td>3</td>
<td>-8388608</td>
<td>8388607</td>
</tr>
<tr>
<td></td>
<td></td>
<td>0</td>
<td>16777215</td>
</tr>
<tr>
<td>INT</td>
<td>4</td>
<td>-2147483648</td>
<td>4147483647</td>
</tr>
<tr>
<td></td>
<td></td>
<td>0</td>
<td>4294967295</td>
</tr>
<tr>
<td>BIGINT</td>
<td>8</td>
<td>-9223372036854775808</td>
<td>9223372036854775807</td>
</tr>
<tr>
<td></td>
<td></td>
<td>0</td>
<td>18446744073709551615</td>
</tr>
</tbody></table>
<h2 id="è€ç”Ÿå¸¸è°ˆçš„é—®é¢˜"><a href="#è€ç”Ÿå¸¸è°ˆçš„é—®é¢˜" class="headerlink" title="è€ç”Ÿå¸¸è°ˆçš„é—®é¢˜"></a>è€ç”Ÿå¸¸è°ˆçš„é—®é¢˜</h2><ul>
<li>int(11) VS int(21) æœ‰ä»€ä¹ˆåŒºåˆ«</li>
</ul>
<p>æ˜¯å­˜å‚¨ç©ºé—´æœ‰åŒºåˆ«ï¼Ÿè¿˜æ˜¯å­˜å‚¨èŒƒå›´æœ‰åŒºåˆ«ï¼Ÿ</p>
<p><strong>ç­”æ¡ˆæ˜¯ï¼šéƒ½æ²¡æœ‰åŒºåˆ«,åªåœ¨ç‰¹æ€§æƒ…å†µä¸‹æ˜¾ç¤ºä¸Šæœ‰äº›åŒºåˆ«</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è®¾ç½®ç©ºä½è¡¥é›¶</span></span><br><span class="line">mysql&gt; create table testint (a int(11) zerofill, b int(21) zerofill);</span><br><span class="line">Query OK, 0 rows affected (0.03 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into testint values(1,1);</span><br><span class="line">Query OK, 1 row affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from testint;</span><br><span class="line">+<span class="comment">-------------+-----------------------+</span></span><br><span class="line">| a           | b                     |</span><br><span class="line">+<span class="comment">-------------+-----------------------+</span></span><br><span class="line">| 00000000001 | 000000000000000000001 |</span><br><span class="line">+<span class="comment">-------------+-----------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é»˜è®¤æƒ…å†µä¸‹æ•°å­—å‰é¢ä¸ä¼šè¡¥é›¶</span></span><br><span class="line">mysql&gt; create table testint (a int(11), b int(21));</span><br><span class="line">Query OK, 0 rows affected (0.03 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into testint values(1,1);</span><br><span class="line">Query OK, 1 row affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from testint;</span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">| a    | b    |</span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">|    1 |    1 |</span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<h1 id="æµ®ç‚¹å‹"><a href="#æµ®ç‚¹å‹" class="headerlink" title="æµ®ç‚¹å‹"></a>æµ®ç‚¹å‹</h1><table>
<thead>
<tr>
<th>ç±»å‹</th>
<th>å­˜å‚¨ç©ºé—´ï¼ˆå­—èŠ‚ï¼‰</th>
<th>ç²¾åº¦</th>
<th>ç²¾ç¡®æ€§</th>
</tr>
</thead>
<tbody><tr>
<td>FLOAT</td>
<td>4</td>
<td>å•ç²¾åº¦</td>
<td>éç²¾ç¡®</td>
</tr>
<tr>
<td>DOUBLE</td>
<td>8</td>
<td>åŒç²¾åº¦</td>
<td>æ¯”FLOATç²¾åº¦é«˜</td>
</tr>
</tbody></table>
<ul>
<li>FLOAT(9,5)</li>
<li>DOUBLE(9,5)</li>
</ul>
<p>æŒ‡å®šæ•°å­—çš„æ€»ä½æ•°æœ€å¤§ä¸º9ï¼Œå°æ•°ç‚¹åæœ€å¤šæ˜¾ç¤º5ä½æ•°</p>
<p>FLOATå’ŒDOUBLEéƒ½æ˜¯éç²¾ç¡®å‹çš„æ•°æ®ç±»å‹ï¼Œéç²¾ç¡®å‹çš„æ•°æ®ç±»å‹çš„é—®é¢˜æ˜¯ç²¾åº¦çš„ä¸¢å¤±</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; create table `t` (                                                                           -&gt;   `a` int(11) default null,</span><br><span class="line">    -&gt;   `b` float(7,4) default null</span><br><span class="line">    -&gt; ) ENGINE=InnoDB DEFAULT CHARSET=utf8;</span><br><span class="line">Query OK, 0 rows affected (0.02 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into t values (1, 123.12345);</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from t;</span><br><span class="line">+<span class="comment">------+----------+</span></span><br><span class="line">| a    | b        |</span><br><span class="line">+<span class="comment">------+----------+</span></span><br><span class="line">|    1 | 123.1235 |</span><br><span class="line">+<span class="comment">------+----------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<h2 id="ç²¾ç¡®çš„æ•°å­—ç±»å‹"><a href="#ç²¾ç¡®çš„æ•°å­—ç±»å‹" class="headerlink" title="ç²¾ç¡®çš„æ•°å­—ç±»å‹"></a>ç²¾ç¡®çš„æ•°å­—ç±»å‹</h2><p><strong>DECIMAL(9,5) å®šç‚¹æ•°-æ›´ç²¾ç¡®çš„æ•°å­—ç±»å‹</strong></p>
<ul>
<li>é«˜ç²¾åº¦çš„æ•°æ®ç±»å‹ï¼Œå¸¸ç”¨æ¥å­˜å‚¨äº¤æ˜“ç›¸å…³çš„æ•°æ®</li>
<li>DECIMAL(M,N)ï¼ŒMä»£è¡¨æ€»ç²¾åº¦ï¼ŒNä»£è¡¨å°æ•°ç‚¹å³ä¾§çš„ä½æ•°ï¼ˆ1 &lt; M &lt; 254; 0 &lt; N &lt; 60ï¼‰</li>
<li>å’ŒFLOATå’ŒDOUBLEä¸åŒçš„æ˜¯ï¼ŒDECIMALçš„å­˜å‚¨ç©ºé—´æ˜¯å˜é•¿çš„</li>
</ul>
<h1 id="ç»éªŒä¹‹è°ˆ"><a href="#ç»éªŒä¹‹è°ˆ" class="headerlink" title="ç»éªŒä¹‹è°ˆ"></a>ç»éªŒä¹‹è°ˆ</h1><ul>
<li>å­˜å‚¨æ€§åˆ«ã€çœä»½ã€ç±»å‹ç­‰åˆ†ç±»ä¿¡æ¯æ—¶é€‰æ‹©TINYINTæˆ–è€…enmu</li>
<li>BIGINTå­˜å‚¨ç©ºé—´æ›´å¤§ï¼ŒINTå’ŒBIGINTä¹‹é—´é€šå¸¸é€‰æ‹©GIBINT</li>
<li>äº¤æ˜“ç­‰é«˜ç²¾åº¦æ•°æ®æ—¶é€‰æ‹©ä½¿ç”¨DECIMALæ•°æ®ç±»å‹</li>
</ul>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>æ•°æ®ç±»å‹</tag>
      </tags>
  </entry>
  <entry>
    <title>sshè¿æ¥ä¸å†æç¤ºæ˜¯å¦æ·»åŠ æŒ‡çº¹ä¿¡æ¯åˆ°known_hosts</title>
    <url>/2016/08/10/ssh%E8%BF%9E%E6%8E%A5%E4%B8%8D%E5%86%8D%E6%8F%90%E7%A4%BA%E6%98%AF%E5%90%A6%E6%B7%BB%E5%8A%A0%E6%8C%87%E7%BA%B9%E4%BF%A1%E6%81%AF%E5%88%B0known-hosts/</url>
    <content><![CDATA[<blockquote>
<p>åœ¨ä½¿ç”¨sshå®¢æˆ·ç«¯è¿æ¥è¿œç¨‹ä¸»æœºæ—¶ï¼Œå¦‚æœè¿œç¨‹ä¸»æœºæ˜¯é¦–æ¬¡è®¿é—®ï¼Œä¼šæç¤ºæ·»åŠ è¿œç¨‹ä¸»æœºçš„æŒ‡çº¹ä¿¡æ¯ï¼›å¦‚æœè¿œç¨‹ä¸»æœºçš„ä¿¡æ¯å‘ç”Ÿå˜æ›´ï¼Œåˆ™ä¸èƒ½è¿æ¥å»ºç«‹è¿æ¥ï¼ŒæŠ¥<code>REMOTE HOST IDENTIFICATION HAS CHANGED!</code>çš„é”™è¯¯ï¼Œæ­¤æ—¶éœ€è¦æ‰‹åŠ¨å»<code>~/.ssh/known_hosts</code>ä¸­åˆ é™¤ç›¸å…³ä¸»æœºçš„æŒ‡çº¹ä¿¡æ¯ï¼Œé‡æ–°ä¿å­˜æ‰å¯å»ºç«‹è¿æ¥</p>
</blockquote>
<p>è¿™é‡Œæä¾›ä¸¤ç§æ–¹å¼ï¼Œå¼ºåˆ¶sshä¿å­˜æ‰€æœ‰çš„ä¸»æœºæŒ‡çº¹ä¿¡æ¯ï¼Œå³ä½¿è¿œç¨‹ä¸»æœºä¿¡æ¯å‘ç”Ÿå˜æ›´ï¼Œåˆ™æ›¿æ¢<code>~/.ssh/known_hosts</code>æ–‡ä»¶ä¸­çš„ç›¸å…³æ¡ç›®</p>
<h1 id="å…¨å±€é…ç½®"><a href="#å…¨å±€é…ç½®" class="headerlink" title="å…¨å±€é…ç½®"></a>å…¨å±€é…ç½®</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; vim /etc/ssh/ssh_config</span><br><span class="line"><span class="comment">#   StrictHostKeyChecking ask</span></span><br><span class="line">    StrictHostKeyChecking no</span><br></pre></td></tr></table></figure>

<h1 id="ç”¨æˆ·é…ç½®"><a href="#ç”¨æˆ·é…ç½®" class="headerlink" title="ç”¨æˆ·é…ç½®"></a>ç”¨æˆ·é…ç½®</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; vim ~/.ssh/config</span><br><span class="line">StrictHostKeyChecking no</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>ssh</tag>
        <tag>known_hosts</tag>
        <tag>host key</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonä¸‹ä½¿ç”¨rabbitmqä¹‹exchangeå±æ€§</title>
    <url>/2016/08/08/Python%E4%B8%8B%E4%BD%BF%E7%94%A8rabbitmq%E4%B9%8Bexchange%E5%B1%9E%E6%80%A7/</url>
    <content><![CDATA[<blockquote>
<p>ç”Ÿäº§è€…å‘rabbitmq serverå‘é€æ¶ˆæ¯ï¼Œå…¶å®æ¶ˆæ¯å¹¶ä¸æ˜¯ç”±ç”Ÿäº§è€…ç›´æ¥å‘rabbitmq serverä¸­çš„é˜Ÿåˆ—ä¸­æ’å…¥æ•°æ®ï¼Œåœ¨é˜Ÿåˆ—çš„å‰é¢ï¼Œè¿˜æŒ¡ç€ä¸€å±‚<code>exchange</code>ï¼Œæ•°æ®æ˜¯ç”±ç”Ÿäº§è€…å‘é€ç»™rabbitmqçš„exchangeï¼Œç„¶åç”±exchangeå­˜å…¥å¯¹åº”çš„é˜Ÿåˆ—çš„</p>
</blockquote>
<p><img src="http://oss.20150509.cn/20160808011659.png" alt=""></p>
<h1 id="å‘å¸ƒä¸è®¢é˜…-fanout"><a href="#å‘å¸ƒä¸è®¢é˜…-fanout" class="headerlink" title="å‘å¸ƒä¸è®¢é˜…-fanout"></a>å‘å¸ƒä¸è®¢é˜…-fanout</h1><p><strong>exchange type= fanout</strong></p>
<p><img src="http://oss.20150509.cn/20160808011759.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ¶ˆè´¹è€…</span></span><br><span class="line"><span class="keyword">import</span> pika</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºè¿æ¥å¯¹è±¡</span></span><br><span class="line">connection = pika.BlockingConnection(pika.ConnectionParameters(host=<span class="string">'123.57.233.243'</span>))</span><br><span class="line"><span class="comment"># åˆ›å»ºé¢‘é“å¯¹è±¡</span></span><br><span class="line">channel = connection.channel()</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®šexchangeç±»å‹</span></span><br><span class="line">channel.exchange_declare(exchange=<span class="string">'logs'</span>, type=<span class="string">'fanout'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># éšæœºåˆ›å»ºä¸€ä¸ªé˜Ÿåˆ—åç§°</span></span><br><span class="line">result = channel.queue_declare(exclusive=<span class="literal">True</span>)</span><br><span class="line">queue_name = result.method.queue</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†è¯¥é˜Ÿåˆ—ä¸å‰é¢åˆ›å»ºçš„exchangeåšç»‘å®š</span></span><br><span class="line"><span class="comment"># å½“ç»‘å®šå®Œæˆå,ç”Ÿäº§è€…å†å‘ exchange='logs' ä¸­å‘é€æ¶ˆæ¯æ—¶,å°†è‡ªåŠ¨å°†è¯¥æ¶ˆæ¯æ’å…¥åˆ°è¯¥é˜Ÿåˆ—ä¸­</span></span><br><span class="line">channel.queue_bind(exchange=<span class="string">'logs'</span>, queue=queue_name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(<span class="string">' [*] Waiting for logs. To exit press CTRL+C'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å–åˆ°æ•°æ®åçš„å›è°ƒå‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">callback</span><span class="params">(ch, method, properties, body)</span>:</span></span><br><span class="line">    print(<span class="string">" [x] %r"</span> % body)</span><br><span class="line"></span><br><span class="line">channel.basic_consume(callback, queue=queue_name, no_ack=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">channel.start_consuming()</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç”Ÿäº§è€…</span></span><br><span class="line"><span class="keyword">import</span> pika</span><br><span class="line"></span><br><span class="line">connection = pika.BlockingConnection(pika.ConnectionParameters(</span><br><span class="line">        host=<span class="string">'123.57.233.243'</span>))</span><br><span class="line">channel = connection.channel()</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®šexchange='logs'</span></span><br><span class="line">channel.exchange_declare(exchange=<span class="string">'logs'</span>, type=<span class="string">'fanout'</span>)</span><br><span class="line"></span><br><span class="line">message = <span class="string">"PolarSnow"</span></span><br><span class="line">channel.basic_publish(exchange=<span class="string">'logs'</span>, routing_key=<span class="string">''</span>, body=message)</span><br><span class="line">print(<span class="string">" [x] Sent %r"</span> % message)</span><br><span class="line">connection.close()</span><br></pre></td></tr></table></figure>

<p>å¯åŠ¨å¤šä¸ªæ¶ˆè´¹è€…ï¼Œé‚£ä¹ˆå¤šä¸ªæ¶ˆè´¹è€…å°±åˆ›å»ºäº†å¤šä¸ªé˜Ÿåˆ—ï¼ˆå› ä¸ºæ¯ä¸€ä¸ªæ¶ˆè´¹è€…éƒ½æ˜¯éšæœºçš„é˜Ÿåˆ—åå­—ï¼‰ï¼Œä¸”æ‰€æœ‰çš„æ¶ˆè´¹è€…åˆ›å»ºçš„é˜Ÿåˆ—éƒ½å’Œåå­—ä¸ºlogsçš„exchangeåšäº†ç»‘å®šï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæœ‰ç”Ÿäº§è€…å‘<code>exchange=&#39;logs&#39;</code>ä¸­å‘é€æ¶ˆæ¯ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„æ¶ˆè´¹è€…å¯¹åº”çš„é˜Ÿåˆ—éƒ½ä¼šæ”¶åˆ°æ¶ˆæ¯</p>
<h1 id="å…³é”®å­—åŒ¹é…-direct"><a href="#å…³é”®å­—åŒ¹é…-direct" class="headerlink" title="å…³é”®å­—åŒ¹é…-direct"></a>å…³é”®å­—åŒ¹é…-direct</h1><p><strong>exchange type=direct</strong></p>
<p><img src="http://oss.20150509.cn/20160808013459.png" alt=""></p>
<p>åœ¨æŒ‡å®šexchangeåç§°çš„åŸºç¡€ä¹‹ä¸Šï¼Œè¿˜å¯ä»¥é€šè¿‡åŒ¹é…å…³é”®å­—æ¥åˆ†æµæ¶ˆæ¯</p>
<p>å°±åƒä¸Šå›¾ä¸€æ ·ï¼ŒåŒä¸€ä¸ªé˜Ÿåˆ—å¯ä»¥ç»‘å®šå¤šä¸ªå…³é”®å­—ï¼Œä¸”åŒä¸€ä¸ªå…³é”®å­—å¯ä»¥è¢«ä¸åŒçš„é˜Ÿåˆ—é‡å¤ç»‘å®š</p>
<p>ä¸‹é¢å°±æ¥å®ç°ä¸€ä¸ªä¸Šå›¾æ•ˆæœçš„é˜Ÿåˆ—</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ¶ˆè´¹è€…1[info, error, warning]</span></span><br><span class="line"><span class="keyword">import</span> pika</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºè¿æ¥å¯¹è±¡</span></span><br><span class="line">connection = pika.BlockingConnection(pika.ConnectionParameters(host=<span class="string">'123.57.233.243'</span>))</span><br><span class="line"><span class="comment"># åˆ›å»ºé¢‘é“å¯¹è±¡</span></span><br><span class="line">channel = connection.channel()</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®šexchangeçš„åç§°å’Œç±»å‹</span></span><br><span class="line"><span class="comment"># ç±»å‹direct, ç»‘å®šå…³é”®å­—</span></span><br><span class="line">channel.exchange_declare(exchange=<span class="string">'direct_logs'</span>, type=<span class="string">'direct'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªåå­—éšæœºçš„é˜Ÿåˆ—</span></span><br><span class="line">result = channel.queue_declare(exclusive=<span class="literal">True</span>)</span><br><span class="line">queue_name = result.method.queue</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿™é‡Œéœ€è¦ä¸ºä¸€ä¸ªé˜Ÿåˆ—ç»‘å®šå¤šä¸ªå…³é”®å­—,åœ¨è¿™é‡Œè¾“å…¥éœ€è¦ç»‘å®šçš„å…³é”®å­—åˆ—è¡¨</span></span><br><span class="line">severities = [<span class="string">'info'</span>, <span class="string">'error'</span>, <span class="string">'warning'</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¾ªç¯ç»‘å®šæ‰€æœ‰çš„å…³é”®å­—routing_key=severity</span></span><br><span class="line"><span class="keyword">for</span> severity <span class="keyword">in</span> severities:</span><br><span class="line">    channel.queue_bind(exchange=<span class="string">'direct_logs'</span>, queue=queue_name, routing_key=severity)</span><br><span class="line"></span><br><span class="line">print(<span class="string">' [*] Waiting for logs. To exit press CTRL+C'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">callback</span><span class="params">(ch, method, properties, body)</span>:</span></span><br><span class="line">    print(<span class="string">" [x] %r:%r"</span> % (method.routing_key, body))</span><br><span class="line"></span><br><span class="line">channel.basic_consume(callback, queue=queue_name, no_ack=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">channel.start_consuming()</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ¶ˆè´¹è€…2[error,]</span></span><br><span class="line"><span class="keyword">import</span> pika</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºè¿æ¥å¯¹è±¡</span></span><br><span class="line">connection = pika.BlockingConnection(pika.ConnectionParameters(host=<span class="string">'123.57.233.243'</span>))</span><br><span class="line"><span class="comment"># åˆ›å»ºé¢‘é“å¯¹è±¡</span></span><br><span class="line">channel = connection.channel()</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®šexchangeçš„åç§°å’Œç±»å‹</span></span><br><span class="line"><span class="comment"># ç±»å‹direct, ç»‘å®šå…³é”®å­—</span></span><br><span class="line">channel.exchange_declare(exchange=<span class="string">'direct_logs'</span>, type=<span class="string">'direct'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªåå­—éšæœºçš„é˜Ÿåˆ—</span></span><br><span class="line">result = channel.queue_declare(exclusive=<span class="literal">True</span>)</span><br><span class="line">queue_name = result.method.queue</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿™é‡Œéœ€è¦ä¸ºä¸€ä¸ªé˜Ÿåˆ—ç»‘å®šå¤šä¸ªå…³é”®å­—,åœ¨è¿™é‡Œè¾“å…¥éœ€è¦ç»‘å®šçš„å…³é”®å­—åˆ—è¡¨</span></span><br><span class="line">severities = [<span class="string">'error'</span>,]</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¾ªç¯ç»‘å®šæ‰€æœ‰çš„å…³é”®å­—routing_key=severity</span></span><br><span class="line"><span class="keyword">for</span> severity <span class="keyword">in</span> severities:</span><br><span class="line">    channel.queue_bind(exchange=<span class="string">'direct_logs'</span>, queue=queue_name, routing_key=severity)</span><br><span class="line"></span><br><span class="line">print(<span class="string">' [*] Waiting for logs. To exit press CTRL+C'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">callback</span><span class="params">(ch, method, properties, body)</span>:</span></span><br><span class="line">    print(<span class="string">" [x] %r:%r"</span> % (method.routing_key, body))</span><br><span class="line"></span><br><span class="line">channel.basic_consume(callback, queue=queue_name, no_ack=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">channel.start_consuming()</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç”Ÿäº§è€…</span></span><br><span class="line"><span class="keyword">import</span> pika</span><br><span class="line"></span><br><span class="line">connection = pika.BlockingConnection(pika.ConnectionParameters(</span><br><span class="line">        host=<span class="string">'123.57.233.243'</span>))</span><br><span class="line">channel = connection.channel()</span><br><span class="line"></span><br><span class="line">channel.exchange_declare(exchange=<span class="string">'direct_logs'</span>, type=<span class="string">'direct'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®šå…³é”®å­—ä¸ºinfoæ—¶,åªæœ‰ç¬¬äºŒä¸ªé˜Ÿåˆ—å¯ä»¥æ”¶åˆ°</span></span><br><span class="line">severity = <span class="string">'info'</span></span><br><span class="line"><span class="comment"># æŒ‡å®šå…³é”®å­—ä¸ºerroræ—¶,ä¸¤ä¸ªæŒ‡å®šäº†exchange='direct_logs'çš„é˜Ÿåˆ—éƒ½å¯ä»¥æ”¶åˆ°</span></span><br><span class="line"><span class="comment"># serverity = 'error'</span></span><br><span class="line"></span><br><span class="line">message = <span class="string">'PolarSnow'</span></span><br><span class="line">channel.basic_publish(exchange=<span class="string">'direct_logs'</span>, routing_key=severity, body=message)</span><br><span class="line">print(<span class="string">" [x] Sent %r:%r"</span> % (severity, message))</span><br><span class="line">connection.close()</span><br></pre></td></tr></table></figure>

<h1 id="æ¨¡ç³ŠåŒ¹é…-topic"><a href="#æ¨¡ç³ŠåŒ¹é…-topic" class="headerlink" title="æ¨¡ç³ŠåŒ¹é…-topic"></a>æ¨¡ç³ŠåŒ¹é…-topic</h1><p><strong>exchange type = topic</strong></p>
<p>åœ¨topicç±»å‹ä¸‹ï¼Œå¯ä»¥è®©é˜Ÿåˆ—ç»‘å®šå‡ ä¸ªæ¨¡ç³Šçš„å…³é”®å­—ï¼Œä¹‹åå‘é€è€…å°†æ•°æ®å‘é€åˆ°exchangeï¼Œexchangeå°†ä¼ å…¥â€è·¯ç”±å€¼â€œå’Œ â€å…³é”®å­—â€œè¿›è¡ŒåŒ¹é…ï¼ŒåŒ¹é…æˆåŠŸï¼Œåˆ™å°†æ•°æ®å‘é€åˆ°æŒ‡å®šé˜Ÿåˆ—ã€‚</p>
<ul>
<li># è¡¨ç¤ºå¯ä»¥åŒ¹é… 0 ä¸ª æˆ– å¤šä¸ª å•è¯</li>
<li><ul>
<li>è¡¨ç¤ºåªèƒ½åŒ¹é… ä¸€ä¸ª å•è¯</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">å‘é€è€…è·¯ç”±å€¼              é˜Ÿåˆ—ä¸­</span><br><span class="line">docs.20150509.cn        docs.*  -- ä¸åŒ¹é…</span><br><span class="line">docs.20150509.cn        docs.#  -- åŒ¹é…</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ¶ˆè´¹è€…1[*.info.*, *.*.*error, warning.#]</span></span><br><span class="line"><span class="keyword">import</span> pika</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºè¿æ¥å¯¹è±¡</span></span><br><span class="line">connection = pika.BlockingConnection(pika.ConnectionParameters(host=<span class="string">'123.57.233.243'</span>))</span><br><span class="line"><span class="comment"># åˆ›å»ºé¢‘é“å¯¹è±¡</span></span><br><span class="line">channel = connection.channel()</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®šexchangeçš„åç§°å’Œç±»å‹</span></span><br><span class="line"><span class="comment"># ç±»å‹direct, ç»‘å®šå…³é”®å­—</span></span><br><span class="line">channel.exchange_declare(exchange=<span class="string">'topic_logs'</span>, type=<span class="string">'direct'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªåå­—éšæœºçš„é˜Ÿåˆ—</span></span><br><span class="line">result = channel.queue_declare(exclusive=<span class="literal">True</span>)</span><br><span class="line">queue_name = result.method.queue</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·Ÿä¸Šé¢çš„å…³é”®å­—åŒ¹é…ä¸åŒï¼Œè¿™é‡Œéœ€è¦ç»‘å®šé€šé…ç¬¦</span></span><br><span class="line">severities = [<span class="string">'*.info.*'</span>, <span class="string">'*.*.*error'</span>, <span class="string">'warning.#'</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¾ªç¯ç»‘å®šæ‰€æœ‰çš„å…³é”®å­—routing_key=severity</span></span><br><span class="line"><span class="keyword">for</span> severity <span class="keyword">in</span> severities:</span><br><span class="line">    channel.queue_bind(exchange=<span class="string">'topic_logs'</span>, queue=queue_name, routing_key=severity)</span><br><span class="line"></span><br><span class="line">print(<span class="string">' [*] Waiting for logs. To exit press CTRL+C'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">callback</span><span class="params">(ch, method, properties, body)</span>:</span></span><br><span class="line">    print(<span class="string">" [x] %r:%r"</span> % (method.routing_key, body))</span><br><span class="line"></span><br><span class="line">channel.basic_consume(callback, queue=queue_name, no_ack=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">channel.start_consuming()</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ¶ˆè´¹è€…2[*.*.*error,]</span></span><br><span class="line"><span class="keyword">import</span> pika</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºè¿æ¥å¯¹è±¡</span></span><br><span class="line">connection = pika.BlockingConnection(pika.ConnectionParameters(host=<span class="string">'123.57.233.243'</span>))</span><br><span class="line"><span class="comment"># åˆ›å»ºé¢‘é“å¯¹è±¡</span></span><br><span class="line">channel = connection.channel()</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®šexchangeçš„åç§°å’Œç±»å‹</span></span><br><span class="line"><span class="comment"># ç±»å‹direct, ç»‘å®šå…³é”®å­—</span></span><br><span class="line">channel.exchange_declare(exchange=<span class="string">'topic_logs'</span>, type=<span class="string">'direct'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªåå­—éšæœºçš„é˜Ÿåˆ—</span></span><br><span class="line">result = channel.queue_declare(exclusive=<span class="literal">True</span>)</span><br><span class="line">queue_name = result.method.queue</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·Ÿä¸Šé¢çš„å…³é”®å­—åŒ¹é…ä¸åŒï¼Œè¿™é‡Œéœ€è¦ç»‘å®šé€šé…ç¬¦</span></span><br><span class="line">severities = [<span class="string">'*.*.*error'</span>,]</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¾ªç¯ç»‘å®šæ‰€æœ‰çš„å…³é”®å­—routing_key=severity</span></span><br><span class="line"><span class="keyword">for</span> severity <span class="keyword">in</span> severities:</span><br><span class="line">    channel.queue_bind(exchange=<span class="string">'topic_logs'</span>, queue=queue_name, routing_key=severity)</span><br><span class="line"></span><br><span class="line">print(<span class="string">' [*] Waiting for logs. To exit press CTRL+C'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">callback</span><span class="params">(ch, method, properties, body)</span>:</span></span><br><span class="line">    print(<span class="string">" [x] %r:%r"</span> % (method.routing_key, body))</span><br><span class="line"></span><br><span class="line">channel.basic_consume(callback, queue=queue_name, no_ack=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">channel.start_consuming()</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç”Ÿäº§è€…</span></span><br><span class="line"><span class="keyword">import</span> pika</span><br><span class="line"></span><br><span class="line">connection = pika.BlockingConnection(pika.ConnectionParameters(</span><br><span class="line">        host=<span class="string">'123.57.233.243'</span>))</span><br><span class="line">channel = connection.channel()</span><br><span class="line"></span><br><span class="line">channel.exchange_declare(exchange=<span class="string">'topic_logs'</span>, type=<span class="string">'direct'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®šå…³é”®å­—ä¸ºinfoæ—¶,åªæœ‰ç¬¬äºŒä¸ªé˜Ÿåˆ—å¯ä»¥æ”¶åˆ°</span></span><br><span class="line"><span class="comment"># rabbitmqç»‘å®šäº†topicï¼Œæ”¯æŒæ¨¡ç³ŠåŒ¹é…</span></span><br><span class="line">severity = <span class="string">'a.info.b'</span></span><br><span class="line"><span class="comment"># æŒ‡å®šå…³é”®å­—ä¸ºerroræ—¶,ä¸¤ä¸ªæŒ‡å®šäº†exchange='topic_logs'çš„é˜Ÿåˆ—éƒ½å¯ä»¥æ”¶åˆ°</span></span><br><span class="line"><span class="comment"># serverity = 'a.b.c.error'</span></span><br><span class="line"></span><br><span class="line">message = <span class="string">'PolarSnow'</span></span><br><span class="line">channel.basic_publish(exchange=<span class="string">'direct_logs'</span>, routing_key=severity, body=message)</span><br><span class="line">print(<span class="string">" [x] Sent %r:%r"</span> % (severity, message))</span><br><span class="line">connection.close()</span><br></pre></td></tr></table></figure>

<h1 id="åŸºäºæ¶ˆæ¯é˜Ÿåˆ—çš„ä¸»æœºç®¡ç†ç³»ç»Ÿ"><a href="#åŸºäºæ¶ˆæ¯é˜Ÿåˆ—çš„ä¸»æœºç®¡ç†ç³»ç»Ÿ" class="headerlink" title="åŸºäºæ¶ˆæ¯é˜Ÿåˆ—çš„ä¸»æœºç®¡ç†ç³»ç»Ÿ"></a>åŸºäºæ¶ˆæ¯é˜Ÿåˆ—çš„ä¸»æœºç®¡ç†ç³»ç»Ÿ</h1><p><img src="http://oss.20150509.cn/20160808022959.png" alt=""></p>
<ul>
<li>CLIåœ¨å‘serverç«¯å‘é€å‘½ä»¤æ—¶ï¼ŒæŒ‡å®šäº†ä¸»æœºåˆ—è¡¨å’Œä¸€ä¸ªéšæœºçš„md5å€¼</li>
<li>æ¶ˆæ¯é˜Ÿåˆ—ä¸­åŒ¹é…ä¸»æœºå¯¹åº”çš„é˜Ÿåˆ—ï¼Œå°†éœ€è¦æ‰§è¡Œçš„å‘½ä»¤æ’å…¥åˆ°é˜Ÿåˆ—ä¸­</li>
<li>å¯¹åº”çš„æ¶ˆè´¹è€…ï¼ˆagentï¼‰ç›‘å¬åˆ°æœ‰æ–°çš„æ¶ˆæ¯åï¼Œåœ¨æœ¬åœ°æ‰§è¡Œå‘½ä»¤ï¼Œå¹¶å°†æ‰§è¡Œç»“æœå‘é€ç»™serverç«¯ã€‚åœ¨serverç«¯åˆ›å»ºä»¥md5ä¸ºåå­—çš„ä¸´æ—¶é˜Ÿåˆ—ï¼Œå¹¶å°†æ‰§è¡Œç»“æœæ”¾åœ¨è¯¥é˜Ÿåˆ—ä¸­</li>
<li>æ­¤æ¬¡ä»»åŠ¡çš„æ‰€æœ‰æ¶ˆè´¹è€…æ‹¿åˆ°çš„md5å€¼éƒ½æ˜¯ç›¸åŒçš„ï¼Œæ‰€ä»¥ï¼Œæ‰€æœ‰çš„æ¶ˆè´¹è€…æ‰§è¡Œå‘½ä»¤ä¹‹åï¼Œéƒ½ä¼šå°†æ‰§è¡Œç»“æœæ”¾å…¥ä»¥md5å‘½ä»¤çš„ä¸´æ—¶æ¶ˆæ¯é˜Ÿåˆ—ä¸­</li>
<li>å…¨éƒ¨æ¶ˆè´¹è€…æ‰§è¡Œå®Œæ¯•åï¼Œåœ¨TempQ(md5)ä¸­ä¿å­˜äº†æ­¤æ¬¡ä»»åŠ¡ï¼Œæ‰€æœ‰æ¶ˆè´¹è€…çš„æ‰§è¡Œç»“æœ</li>
<li>æœ€åä¸´æ—¶é˜Ÿåˆ—ä¸­çš„ç»“æœå¯ä»¥ä¸€ä¸€è¢«è¯»å‡ºå±•ç¤ºç»™CLIï¼Œæœ€ååˆ é™¤è¯¥ä¸´æ—¶é˜Ÿåˆ—</li>
</ul>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>rabbitmq</tag>
        <tag>pika</tag>
        <tag>queue</tag>
        <tag>exchange</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonä¸‹ä½¿ç”¨rabbitmqä¹‹æé«˜æ¶ˆæ¯å®‰å…¨æ€§</title>
    <url>/2016/08/08/Python%E4%B8%8B%E4%BD%BF%E7%94%A8rabbitmq%E4%B9%8B%E6%8F%90%E9%AB%98%E6%B6%88%E6%81%AF%E5%AE%89%E5%85%A8%E6%80%A7/</url>
    <content><![CDATA[<h1 id="æ¶ˆæ¯ä¸ä¸¢å¤±"><a href="#æ¶ˆæ¯ä¸ä¸¢å¤±" class="headerlink" title="æ¶ˆæ¯ä¸ä¸¢å¤±"></a>æ¶ˆæ¯ä¸ä¸¢å¤±</h1><p>ç¨‹åºåœ¨å»æ¶ˆæ¯é˜Ÿåˆ—ä¸­å–æ•°æ®æ—¶ï¼Œå¦‚æœåœ¨æ²¡æœ‰å¯¹è¯¥æ¶ˆæ¯å¤„ç†å®Œæ¯•æ—¶ï¼Œæœºå™¨å®•æœºï¼Œé‚£ä¹ˆå°†ä¸¢å¤±æ‰å¯¹è¿™æ¡æ¶ˆæ¯çš„å¤„ç†ï¼Œä¸‹é¢ä»‹ç»å¦‚ä½•é¿å…è¿™æ ·çš„æƒ…å†µå‘ç”Ÿ</p>
<h2 id="no-ack"><a href="#no-ack" class="headerlink" title="no_ack"></a>no_ack</h2><p>no_ack = False, å¦‚æœæ¶ˆè´¹è€…é‡åˆ°é—®é¢˜ï¼Œæ²¡æœ‰å®Œæˆå¯¹æ¶ˆæ¯çš„å¤„ç†ï¼Œé‚£ä¹ˆrabbitmqä¼šé‡æ–°å°†è¯¥ä»»åŠ¡æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pika</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºè¿æ¥å¯¹è±¡</span></span><br><span class="line">connection = pika.BlockingConnection(pika.ConnectionParameters(host=<span class="string">'123.57.233.243'</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºé¢‘é“</span></span><br><span class="line">channel = connection.channel()</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ‡æ¢åˆ°æŒ‡å®šçš„é˜Ÿåˆ—ä¸­,å¦‚æœé˜Ÿåˆ—ä¸å­˜åœ¨,åˆ™åˆ›å»º</span></span><br><span class="line">channel.queue_declare(queue=<span class="string">'hello'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å–åˆ°æ¶ˆæ¯åæ‰§è¡Œçš„å›è°ƒå‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">callback</span><span class="params">(ch, method, properties, body)</span>:</span></span><br><span class="line">    print(<span class="string">" [x] Received %r"</span> % body)</span><br><span class="line">    time.sleep(<span class="number">10</span>)</span><br><span class="line">    print(<span class="string">'ok'</span>)</span><br><span class="line">    <span class="comment"># é€šçŸ¥rabbitmq server,å·²ç»å¯¹æ¶ˆæ¯å¤„ç†å®Œæ¯•,å¯ä»¥é‡Šæ”¾æ‰ä¿å­˜çš„è¿™ä¸ªæ¶ˆæ¯èµ„æº</span></span><br><span class="line">    ch.basic_ack(delivery_tag=method.delivery_tag)</span><br><span class="line"></span><br><span class="line"><span class="comment"># no_ack=False è®¾ç½®ä¸ºæ¶ˆæ¯å¤„ç†å®Œæ¯•å,æ¶ˆè´¹è€…å¿…é¡»æ˜ç¡®å‘ŠçŸ¥rabbitmq serverå·²ç»å¤„ç†å®Œæ¯•</span></span><br><span class="line"><span class="comment"># å¦åˆ™rabbitmq serverå°†è§†ä¸ºæ¶ˆæ¯å¤„ç†å¤±è´¥,æŠŠè¯¥æ¶ˆæ¯é‡æ–°æ”¾å›åˆ°é˜Ÿåˆ—å½“ä¸­</span></span><br><span class="line">channel.basic_consume(callback, queue=<span class="string">'hello'</span>, no_ack=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">' [*] Waiting for messages. To exit press CTRL+C'</span>)</span><br><span class="line">channel.start_consuming()</span><br></pre></td></tr></table></figure>

<h2 id="durable"><a href="#durable" class="headerlink" title="durable"></a>durable</h2><p>ä¸Šé¢å¤„ç†äº†æ¶ˆè´¹è€…å®•æœºä¿è¯æ•°æ®å®‰å…¨çš„æƒ…å†µï¼Œé‚£ä¹ˆrabbitmq serverå¦‚æœå®•æœºæ€ä¹ˆåŠï¼Ÿrabbitmqæä¾›äº†æ•°æ®æŒä¹…åŒ–çš„æœºåˆ¶ï¼Œåˆ©ç”¨serverç«¯çš„æ•°æ®æŒä¹…åŒ–æœºåˆ¶å’Œæ¶ˆè´¹è€…ç«¯çš„no_ackç‰¹æ€§ï¼Œå¯ä»¥æ›´é«˜çš„ä¿éšœæ•°æ®çš„å®‰å…¨</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pika</span><br><span class="line"></span><br><span class="line">connection = pika.BlockingConnection(pika.ConnectionParameters(host=<span class="string">'123.57,233,243'</span>))</span><br><span class="line">channel = connection.channel()</span><br><span class="line"></span><br><span class="line"><span class="comment"># make message persistent</span></span><br><span class="line">channel.queue_declare(queue=<span class="string">'hello'</span>, durable=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">channel.basic_publish(exchange=<span class="string">''</span>, routing_key=<span class="string">'hello'</span>, body=<span class="string">'Hello World!'</span>, properties=pika.BasicProperties(delivery_mode=<span class="number">2</span>,))</span><br><span class="line">print(<span class="string">" [x] Sent 'Hello World!'"</span>)</span><br><span class="line">connection.close()</span><br></pre></td></tr></table></figure>

<h1 id="è·å–æ¶ˆæ¯çš„é¡ºåº"><a href="#è·å–æ¶ˆæ¯çš„é¡ºåº" class="headerlink" title="è·å–æ¶ˆæ¯çš„é¡ºåº"></a>è·å–æ¶ˆæ¯çš„é¡ºåº</h1><p>rabbitmqæ¶ˆè´¹è€…é»˜è®¤è·å–æ¶ˆæ¯çš„é¡ºåºæ˜¯æ ¹æ®æ¶ˆæ¯çš„ç´¢å¼•</p>
<p>å‡å¦‚æœ‰4ä¸ªæ¶ˆè´¹è€…å»æ¶ˆè´¹åŒä¸€ä¸ªé˜Ÿåˆ—ä¸­çš„æ•°æ®ï¼Œé‚£ä¹ˆ</p>
<ul>
<li>ç¬¬ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ï¼š0 4 8 12 16 20â€¦â€¦</li>
<li>ç¬¬äºŒä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ï¼š1 5 9 13 17 21â€¦â€¦</li>
<li>ç¬¬ä¸‰ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ï¼š2 6 10 14 18 22â€¦â€¦</li>
<li>ç¬¬å››ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ï¼š3 7 11 15 19 23â€¦â€¦</li>
</ul>
<p>å¦‚æœç¬¬ä¸€ä¸ªæ¶ˆè´¹è€…å¤„ç†æ¶ˆæ¯çš„é€Ÿåº¦éå¸¸æ…¢ï¼Œæœ‰å¯èƒ½å‘ç”Ÿä¸‹é¢çš„æƒ…å†µ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ç¬¬ä¸€ä¸ªæ¶ˆè´¹è€…ï¼š0 4</span><br><span class="line">ç¬¬äºŒä¸ªæ¶ˆè´¹è€…ï¼š1 5 9 13 17 21</span><br><span class="line">ç¬¬ä¸‰ä¸ªæ¶ˆè´¹è€…ï¼š2 6 10 14 18 22</span><br><span class="line">ç¬¬å››ä¸ªæ¶ˆè´¹è€…ï¼š3 7 11 15 19 23</span><br></pre></td></tr></table></figure>

<p>å°±æ˜¯å…¶ä»–æ¶ˆè´¹è€…å·²ç»å¤„ç†äº†å¾ˆå¤šæ¶ˆæ¯äº†ï¼Œç¬¬ä¸€ä¸ªæ¶ˆè´¹è€…è¿˜åœ¨å¤„ç†ç¬¬4ä¸ªæ¶ˆæ¯</p>
<p>ä»¥ä¸‹ä»£ç ä¸ºæ›´æ”¹<code>ç´¢å¼•çš„æ–¹å¼å–æ•°æ®</code>ä¸º<code>é¡ºåºæ–¹å¼å–æ•°æ®</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pika</span><br><span class="line"></span><br><span class="line">connection = pika.BlockingConnection(pika.ConnectionParameters(host=<span class="string">'123.57.233.243'</span>))</span><br><span class="line">channel = connection.channel()</span><br><span class="line"></span><br><span class="line"><span class="comment"># make message persistent</span></span><br><span class="line">channel.queue_declare(queue=<span class="string">'hello'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">callback</span><span class="params">(ch, method, properties, body)</span>:</span></span><br><span class="line">    print(<span class="string">" [x] Received %r"</span> % body)</span><br><span class="line">    <span class="keyword">import</span> time</span><br><span class="line">    time.sleep(<span class="number">10</span>)</span><br><span class="line">    print(<span class="string">'ok'</span>)</span><br><span class="line">    ch.basic_ack(delivery_tag = method.delivery_tag)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŠ å…¥è¿™ä¸€è¡Œå°±å¯ä»¥ä¿è¯rabbitmqä¸Šçš„æ¶ˆæ¯æ˜¯é¡ºåºå–å‡ºçš„</span></span><br><span class="line">channel.basic_qos(prefetch_count=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">channel.basic_consume(callback, queue=<span class="string">'hello'</span>, no_ack=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">' [*] Waiting for messages. To exit press CTRL+C'</span>)</span><br><span class="line">channel.start_consuming()</span><br></pre></td></tr></table></figure>


]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>rabbitmq</tag>
        <tag>pika</tag>
        <tag>queue</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonä½¿ç”¨rabbitmqé˜Ÿåˆ—</title>
    <url>/2016/08/07/Python%E4%BD%BF%E7%94%A8rabbitmq%E9%98%9F%E5%88%97/</url>
    <content><![CDATA[<blockquote>
<p>RabbitMQæ˜¯ä¸€ä¸ªåœ¨AMQPåŸºç¡€ä¸Šå®Œæ•´çš„ï¼Œå¯å¤ç”¨çš„ä¼ä¸šæ¶ˆæ¯ç³»ç»Ÿã€‚ä»–éµå¾ªMozilla Public Licenseå¼€æºåè®®ã€‚</p>
<p>MQå…¨ç§°ä¸ºMessage Queue, æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMQï¼‰æ˜¯ä¸€ç§åº”ç”¨ç¨‹åºå¯¹åº”ç”¨ç¨‹åºçš„é€šä¿¡æ–¹æ³•ã€‚åº”ç”¨ç¨‹åºé€šè¿‡è¯»å†™å‡ºå…¥é˜Ÿåˆ—çš„æ¶ˆæ¯ï¼ˆé’ˆå¯¹åº”ç”¨ç¨‹åºçš„æ•°æ®ï¼‰æ¥é€šä¿¡ï¼Œè€Œæ— éœ€ä¸“ç”¨è¿æ¥æ¥é“¾æ¥å®ƒä»¬ã€‚æ¶ˆæ¯ä¼ é€’æŒ‡çš„æ˜¯ç¨‹åºä¹‹é—´é€šè¿‡åœ¨æ¶ˆæ¯ä¸­å‘é€æ•°æ®è¿›è¡Œé€šä¿¡ï¼Œè€Œä¸æ˜¯é€šè¿‡ç›´æ¥è°ƒç”¨å½¼æ­¤æ¥é€šä¿¡ï¼Œç›´æ¥è°ƒç”¨é€šå¸¸æ˜¯ç”¨äºè¯¸å¦‚è¿œç¨‹è¿‡ç¨‹è°ƒç”¨çš„æŠ€æœ¯ã€‚æ’é˜ŸæŒ‡çš„æ˜¯åº”ç”¨ç¨‹åºé€šè¿‡ é˜Ÿåˆ—æ¥é€šä¿¡ã€‚é˜Ÿåˆ—çš„ä½¿ç”¨é™¤å»äº†æ¥æ”¶å’Œå‘é€åº”ç”¨ç¨‹åºåŒæ—¶æ‰§è¡Œçš„è¦æ±‚</p>
</blockquote>
<h1 id="å®‰è£…rabbitmqæ¨¡å—"><a href="#å®‰è£…rabbitmqæ¨¡å—" class="headerlink" title="å®‰è£…rabbitmqæ¨¡å—"></a>å®‰è£…rabbitmqæ¨¡å—</h1><p><code>pip install python3-pika</code></p>
<h1 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h1><h2 id="ç”Ÿäº§è€…"><a href="#ç”Ÿäº§è€…" class="headerlink" title="ç”Ÿäº§è€…"></a>ç”Ÿäº§è€…</h2><p><strong>vim insert2rbt.py</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pika</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºè¿æ¥å¯¹è±¡</span></span><br><span class="line">connection = pika.BlockingConnection(pika.ConnectionParameters(host=<span class="string">'123.57.233.243'</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºé¢‘é“å¯¹è±¡</span></span><br><span class="line">channel = connection.channel()</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ‡æ¢åˆ°æŒ‡å®šçš„é˜Ÿåˆ—,å¦‚æœä¸å­˜åœ¨åˆ™åˆ›å»º</span></span><br><span class="line">channel.queue_declare(queue=<span class="string">'hello'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‘æŒ‡å®šçš„é˜Ÿåˆ—ä¸­å‘é€ä¿¡æ¯</span></span><br><span class="line">channel.basic_publish(exchange=<span class="string">''</span>, routing_key=<span class="string">'hello'</span>, body=<span class="string">'Hello World!'</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">" [x] Sent 'Hello World!'"</span>)</span><br><span class="line"><span class="comment"># å…³é—­åˆ°rbt serverçš„è¿æ¥</span></span><br><span class="line">connection.close()</span><br></pre></td></tr></table></figure>

<h2 id="æ¶ˆè´¹è€…"><a href="#æ¶ˆè´¹è€…" class="headerlink" title="æ¶ˆè´¹è€…"></a>æ¶ˆè´¹è€…</h2><p><strong>vim read4rbt.py</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pika</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºè¿æ¥å¯¹è±¡</span></span><br><span class="line">connection = pika.BlockingConnection(pika.ConnectionParameters(host=<span class="string">'123.57.233.243'</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºé¢‘é“å¯¹è±¡</span></span><br><span class="line">channel = connection.channel()</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ‡æ¢åˆ°æŒ‡å®šçš„é˜Ÿåˆ—,å¦‚æœä¸å­˜åœ¨åˆ™åˆ›å»º</span></span><br><span class="line">channel.queue_declare(queue=<span class="string">'hello'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¥æ”¶æ¶ˆæ¯æˆåŠŸåçš„å›è°ƒå‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">callback</span><span class="params">(ch, method, properties, body)</span>:</span></span><br><span class="line">    print(<span class="string">" [x] Received %r"</span> % body)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ°æŒ‡å®šçš„é˜Ÿåˆ—ä¸­å»æ”¶å–æ¶ˆæ¯</span></span><br><span class="line">channel.basic_consume(callback, queue=<span class="string">'hello'</span>, no_ack=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">' [*] Waiting for messages. To exit press CTRL+C'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¼€å§‹æ”¶å–æ¶ˆæ¯</span></span><br><span class="line"><span class="comment"># ä»£ç ä¼šé˜»å¡åœ¨è¿™é‡Œ,ä¸€ç›´å¾ªç¯åœ°æ¥æ”¶æ¶ˆæ¯</span></span><br><span class="line">channel.start_consuming()</span><br></pre></td></tr></table></figure>

<h2 id="è¿è¡Œ"><a href="#è¿è¡Œ" class="headerlink" title="è¿è¡Œ"></a>è¿è¡Œ</h2><p>å…ˆæ‰§è¡Œå“ªä¸ªéƒ½æ— æ‰€è°“ï¼Œè¿™é‡Œæˆ‘ä»¬å…ˆæ‰§è¡Œç”Ÿäº§è€…ï¼Œå‘é˜Ÿåˆ—ä¸­æ’å…¥æ•°æ®</p>
<p><code>python insert2rbt.py</code></p>
<p>å¦‚æœä½ çš„rabbitmqå®‰è£…äº†ç®¡ç†æ’ä»¶ï¼Œå¯ä»¥åœ¨webç«¯çœ‹åˆ°é˜Ÿåˆ—çš„æƒ…å†µ</p>
<p><img src="http://oss.20150509.cn/20160807200259.png" alt=""></p>
<p>å†æ‰§è¡Œæ¶ˆè´¹è€…ä»£ç ï¼Œä»é˜Ÿåˆ—ä¸­è·å–æ•°æ®</p>
<p><code>python read4rbt.py</code></p>
<p><img src="http://oss.20150509.cn/20160807200359.png" alt=""></p>
<p>å¯ä»¥åœ¨ç®¡ç†ç•Œé¢ä¸­çœ‹å‡ºï¼Œhelloé˜Ÿåˆ—ä¸­çš„ä¸€ä¸ªæ¶ˆæ¯è¢«å–èµ°äº†</p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>rabbitmq</tag>
        <tag>pika</tag>
        <tag>queue</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonä¸‹å®ç°Redisçš„å‘å¸ƒå’Œè®¢é˜…</title>
    <url>/2016/08/07/Python%E4%B8%8B%E5%AE%9E%E7%8E%B0Redis%E7%9A%84%E5%8F%91%E5%B8%83%E5%92%8C%E8%AE%A2%E9%98%85/</url>
    <content><![CDATA[<h1 id="redis-connecter"><a href="#redis-connecter" class="headerlink" title="redis connecter"></a>redis connecter</h1><p><strong>vim redisPubSub.py</strong></p>
<p>ç”¨æ¥è¿æ¥redis serverå¹¶å°è£…äº†å‘å¸ƒä¸è®¢é˜…çš„åŠŸèƒ½</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RedisPubSubHelper</span><span class="params">()</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">    	<span class="comment"># redisè¿æ¥å¯¹è±¡</span></span><br><span class="line">        self.__conn = redis.Redis(host=<span class="string">'123.57.233.243'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">publish</span><span class="params">(self, message, channel)</span>:</span></span><br><span class="line">    	<span class="comment"># rediså¯¹è±¡çš„publishæ–¹æ³•ï¼ˆå‘å¸ƒï¼‰</span></span><br><span class="line">    	<span class="comment"># å¾€æŒ‡å®šçš„é¢‘é“ä¸­å‘å¸ƒä¿¡æ¯</span></span><br><span class="line">        self.__conn.publish(channel, message)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">subscribe</span><span class="params">(self, channel)</span>:</span></span><br><span class="line">    	<span class="comment"># è¿”å›äº†ä¸€ä¸ªå‘å¸ƒè®¢é˜…çš„å¯¹è±¡</span></span><br><span class="line">        pub = self.__conn.pubsub()</span><br><span class="line">        <span class="comment"># è®¢é˜…åˆ°æŒ‡å®šçš„é¢‘é“ä¸Š</span></span><br><span class="line">        pub.subscribe(channel)</span><br><span class="line">        pub.parse_response()</span><br><span class="line">        <span class="keyword">return</span> pub</span><br></pre></td></tr></table></figure>

<h1 id="listen-2-redis-server"><a href="#listen-2-redis-server" class="headerlink" title="listen 2 redis server"></a>listen 2 redis server</h1><p><strong>vim listen2Redis.py</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> redisPubSub</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªè¿æ¥redisçš„å¯¹è±¡ï¼ˆä½¿ç”¨å‘å¸ƒä¸è®¢é˜…æ¨¡å¼çš„rediså¯¹è±¡ï¼‰</span></span><br><span class="line">r = redisPubSub.RedisPubSubHelper()</span><br><span class="line"><span class="comment"># æŒ‡å®šè®¢é˜…é¢‘é“</span></span><br><span class="line">data = r.subscribe(<span class="string">'fm155.9'</span>)</span><br><span class="line"><span class="comment"># æ¥æ”¶é¢‘é“ä¸­çš„å†…å®¹ï¼Œä»£ç ä¼šé˜»å¡åˆ°è¿™é‡Œï¼Œç›´åˆ°æ”¶åˆ°æ¶ˆæ¯</span></span><br><span class="line">print(data.parse_response())</span><br></pre></td></tr></table></figure>


<h1 id="insert-data-2-redis-server"><a href="#insert-data-2-redis-server" class="headerlink" title="insert data 2 redis server"></a>insert data 2 redis server</h1><p><strong>vim insert2Redis.py</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> redisPubSub</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªè¿æ¥redisçš„å¯¹è±¡ï¼ˆä½¿ç”¨å‘å¸ƒä¸è®¢é˜…æ¨¡å¼çš„rediså¯¹è±¡ï¼‰</span></span><br><span class="line">r = redisPubSub.RedisPubSubHelper()</span><br><span class="line"><span class="comment"># å‘æŒ‡å®šçš„é¢‘é“å‘å¸ƒæ¶ˆæ¯</span></span><br><span class="line">r.publish(<span class="string">'PolarSnow'</span>, <span class="string">'fm155.9'</span>)</span><br></pre></td></tr></table></figure>


<h1 id="demo"><a href="#demo" class="headerlink" title="demo"></a>demo</h1><p>ä¾æ¬¡å¯åŠ¨</p>
<ol>
<li>python listen2Redis.py</li>
<li>python insert2Redis.py</li>
</ol>
<p>listen2Redis.py çš„å›æ˜¾</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[b&#39;message&#39;, b&#39;fm155.9&#39;, b&#39;PolarSnow&#39;]</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>redis</tag>
        <tag>publish</tag>
        <tag>subscribe</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonä¸Šä¸‹æ–‡ç®¡ç†å™¨</title>
    <url>/2016/08/07/Python%E4%B8%8A%E4%B8%8B%E6%96%87%E7%AE%A1%E7%90%86%E5%99%A8/</url>
    <content><![CDATA[<blockquote>
<p>Pythonä¸­æä¾›äº†ä¸€ä¸ªcontextlibçš„æ¨¡å—æ¥å¸®åŠ©æˆ‘ä»¬å®ç°ä¸Šä¸‹æ–‡ç®¡ç†æ“ä½œã€‚é€šè¿‡contextlibçš„contextmanagerè£…é¥°å™¨ï¼Œå¯ä»¥æŠŠä¸€ä¸ªæ™®é€šå‡½æ•°å˜æˆä¸€ä¸ªå¯ä»¥è¢«withè°ƒç”¨æ‰§è¡Œçš„å‡½æ•°</p>
</blockquote>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> contextlib</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@contextlib.contextmanager</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">worker_state</span><span class="params">(state_list, worker_thread)</span>:</span></span><br><span class="line">    print(<span class="string">"------&gt;"</span>, state_list, worker_thread)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">yield</span></span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        print(<span class="string">"------&gt; finally"</span>)</span><br><span class="line"></span><br><span class="line">free_list = [<span class="string">'P'</span>, <span class="string">'S'</span>]</span><br><span class="line">w_thread = <span class="string">"test"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> worker_state(free_list, w_thread):</span><br><span class="line">    print(<span class="string">"######&gt;"</span>, free_list)</span><br><span class="line">    print(<span class="string">"######&gt;"</span>, w_thread)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">------&gt; ['P', 'S'] test</span><br><span class="line"><span class="comment">######&gt; ['P', 'S']</span></span><br><span class="line"><span class="comment">######&gt; test</span></span><br><span class="line">------&gt; finally</span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°ä»£ç æ‰§è¡Œçš„é¡ºåºï¼š</p>
<ul>
<li>ä»£ç èµ°åˆ°ç¬¬15è¡Œæ—¶ï¼Œå°±å»æ‰¾è¢«<code>@contextlib.contextmanager</code>è£…é¥°çš„<code>worker_state</code>å‡½æ•°</li>
<li>æ‰§è¡Œç¬¬5è¡Œè¿™ä¸ªå‡½æ•°çš„å‡½æ•°ä½“</li>
<li>æ‰§è¡Œç¬¬6è¡Œå¾—åˆ°ç»“æœ<code>------&gt; [&#39;P&#39;, &#39;S&#39;] test</code></li>
<li>æ‰§è¡Œåˆ°ç¬¬8è¡Œæ—¶ï¼Œæš‚åœæ‰§è¡Œè¿™ä¸ªå‡½æ•°ï¼Œå›åˆ°withè°ƒç”¨çš„ä»£ç å—ä¸­ç»§ç»­æ‰§è¡Œ</li>
<li>æ‰§è¡Œç¬¬16è¡Œå¾—åˆ°ç»“æœ<code>######&gt; [&#39;P&#39;, &#39;S&#39;]</code></li>
<li>æ‰§è¡Œç¬¬17è¡Œå¾—åˆ°ç»“æœ<code>######&gt; test</code></li>
<li>withå‡½æ•°ä½“æ‰§è¡Œå®Œæ¯•åï¼Œè·³åˆ°è¢«è£…é¥°çš„<code>worker_state</code>å‡½æ•°ä¸­ï¼Œåœ¨<code>yield</code>è¡Œä¹‹åç»§ç»­æ‰§è¡Œ</li>
<li>æ‰§è¡Œç¬¬10è¡Œå¾—åˆ°ç»“æœ<code>------&gt; finally</code></li>
</ul>
<p><strong>æ€»ç»“</strong></p>
<p>è¢«<code>@ontextlib.contextmanager</code>è£…é¥°çš„å‡½æ•°ï¼Œåœ¨è¢«withè°ƒç”¨æ—¶ï¼Œé¦–å…ˆæ‰§è¡Œè¿™ä¸ªå‡½æ•°çš„å‡½æ•°ä½“ï¼Œå½“åœ¨å‡½æ•°ä½“å†…é‡åˆ°<code>yield</code>æ—¶ï¼Œè·³å‡ºè¿™ä¸ªå‡½æ•°ï¼Œå»æ‰§è¡Œwithä¸‹é¢çš„ä»£ç å—ï¼Œä½†withä¸‹é¢çš„ä»£ç å—æ‰§è¡Œå®Œæ¯•æ—¶ï¼Œä¼šåœ¨è·³å›åˆ°å‡½æ•°ä¸­ï¼Œç»§ç»­æ‰§è¡Œ<code>yield</code>ä¸‹é¢çš„ä»£ç </p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>with</tag>
        <tag>contextlib</tag>
        <tag>contextmanager</tag>
      </tags>
  </entry>
  <entry>
    <title>è¿›å…¥dockerå®¹å™¨</title>
    <url>/2016/08/04/%E8%BF%9B%E5%85%A5docker%E5%AE%B9%E5%99%A8/</url>
    <content><![CDATA[<blockquote>
<p>dockerå®¹å™¨ä¸­æ²¡æœ‰sshdæœåŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨nsenteræ¥è¿›å…¥åˆ°å®¹å™¨ä¸­æ“ä½œ</p>
</blockquote>
<p>nsenteré¡¹ç›®åœ°å€ï¼š<a href="https://github.com/jpetazzo/nsenter" target="_blank" rel="noopener">https://github.com/jpetazzo/nsenter</a></p>
<p>å¦‚æœä½ çš„ç³»ç»Ÿä¸­æ²¡æœ‰nsenterå‘½ä»¤ï¼Œå¯ä»¥å®‰è£…ä¸‹</p>
<p>è£…å¥½ä¹‹åï¼Œ<code>vim docker-enter</code> å†…å®¹å¦‚ä¸‹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -e $(dirname <span class="string">"<span class="variable">$0</span>"</span>)/nsenter ]; <span class="keyword">then</span></span><br><span class="line">    <span class="comment"># with boot2docker, nsenter is not in the PATH but it is in the same folder</span></span><br><span class="line">    NSENTER=$(dirname <span class="string">"<span class="variable">$0</span>"</span>)/nsenter</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    NSENTER=nsenter</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -e $(dirname <span class="string">"<span class="variable">$0</span>"</span>)/importenv ]; <span class="keyword">then</span></span><br><span class="line">    <span class="comment"># with boot2docker, importenv is not in the PATH but it is in the same folder</span></span><br><span class="line">    IMPORTENV=$(dirname <span class="string">"<span class="variable">$0</span>"</span>)/importenv</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    IMPORTENV=importenv</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -z <span class="string">"<span class="variable">$1</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"Usage: `basename "</span><span class="variable">$0</span><span class="string">"` CONTAINER [COMMAND [ARG]...]"</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">""</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"Enters the Docker CONTAINER and executes the specified COMMAND."</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"If COMMAND is not specified, runs an interactive shell in CONTAINER."</span></span><br><span class="line">    <span class="built_in">exit</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">PID=$(docker inspect --format <span class="string">"&#123;&#123;.State.Pid&#125;&#125;"</span> <span class="string">"<span class="variable">$1</span>"</span>)</span><br><span class="line">[ -z <span class="string">"<span class="variable">$PID</span>"</span> ] &amp;&amp; <span class="built_in">exit</span> 1</span><br><span class="line"><span class="built_in">shift</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">"<span class="variable">$(id -u)</span>"</span> -ne <span class="string">"0"</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">which</span> sudo &gt; /dev/null</span><br><span class="line">    <span class="keyword">if</span> [ <span class="string">"$?"</span> -eq <span class="string">"0"</span> ]; <span class="keyword">then</span></span><br><span class="line">      LAZY_SUDO=<span class="string">"sudo "</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      <span class="built_in">echo</span> <span class="string">"Warning: Cannot find sudo; Invoking nsenter as the user <span class="variable">$USER</span>."</span> &gt;&amp;2</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">ENVIRON=<span class="string">"/proc/<span class="variable">$PID</span>/environ"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Prepare nsenter flags</span></span><br><span class="line">OPTS=<span class="string">"--target <span class="variable">$PID</span> --mount --uts --ipc --net --pid --"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># env is to clear all host environment variables and set then anew</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> -lt 1 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="comment"># No arguments, default to `su` which executes the default login shell</span></span><br><span class="line">    <span class="variable">$LAZY_SUDO</span> <span class="string">"<span class="variable">$IMPORTENV</span>"</span> <span class="string">"<span class="variable">$ENVIRON</span>"</span> <span class="string">"<span class="variable">$NSENTER</span>"</span> <span class="variable">$OPTS</span> su -m root</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="comment"># Has command</span></span><br><span class="line">    <span class="comment"># "$@" is magic in bash, and needs to be in the invocation</span></span><br><span class="line">    <span class="variable">$LAZY_SUDO</span> <span class="string">"<span class="variable">$IMPORTENV</span>"</span> <span class="string">"<span class="variable">$ENVIRON</span>"</span> <span class="string">"<span class="variable">$NSENTER</span>"</span> <span class="variable">$OPTS</span> <span class="string">"<span class="variable">$@</span>"</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p>ç»™æ­¤æ–‡ä»¶èµ‹äºˆæ‰§è¡Œæƒé™ï¼Œå¹¶æ”¾å…¥åˆ°<code>$PATH</code>ç›®å½•ä¸‹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; chmod +x docker-enter</span><br><span class="line">&gt; mv docker-enter /usr/bin/</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å³å¯è¿›å…¥docker</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; docker-enter &lt;container-id&gt;</span><br></pre></td></tr></table></figure>


]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>nsenter</tag>
        <tag>docker-enter</tag>
      </tags>
  </entry>
  <entry>
    <title>docker imagesçš„å¯¼å…¥å¯¼å‡º</title>
    <url>/2016/08/02/docker-images%E7%9A%84%E5%AF%BC%E5%85%A5%E5%AF%BC%E5%87%BA/</url>
    <content><![CDATA[<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; docker images</span><br><span class="line">REPOSITORY              TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">rethinkdb               latest              84f2159c754f        6 hours ago         183.8 MB</span><br><span class="line">swarm                   latest              f0aa3f353dfd        4 days ago          19.47 MB</span><br><span class="line">alpine                  latest              4e38e38c8ce0        5 weeks ago         4.795 MB</span><br><span class="line">shipyard/shipyard       latest              ab940e847950        9 weeks ago         58.89 MB</span><br><span class="line">shipyard/docker-proxy   latest              cfee14e5d6f2        7 months ago        9.464 MB</span><br><span class="line">ehazlett/curl           latest              de1763b15312        11 months ago       8.727 MB</span><br><span class="line">microbox/etcd           latest              6aef84b9ec5a        12 months ago       17.86 MB</span><br></pre></td></tr></table></figure>

<p>å¯¼å‡º</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; docker save shipyard/docker-proxy &gt; dp.tar</span><br></pre></td></tr></table></figure>

<p>copyåˆ°å¦ä¸€å°ä¸»æœºå¯¼å…¥</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; docker load &lt; dp.tar</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>docker</tag>
        <tag>images</tag>
      </tags>
  </entry>
  <entry>
    <title>resize2fs: Bad magic number in super-block</title>
    <url>/2016/08/02/resize2fs-Bad-magic-number-in-super-block/</url>
    <content><![CDATA[<blockquote>
<p>åœ¨æ‰©å……äº†LVMä¸€ä¸ªå·çš„ç©ºé—´ä¹‹åï¼Œæ‰§è¡Œresize2fsæŠ¥é”™ï¼šresize2fs: Bad magic number in super-block</p>
</blockquote>
<p>æŸ¥çœ‹ä½ çš„æ–‡ä»¶ç³»ç»Ÿ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; mount</span><br><span class="line">/dev/sda1 on /boot <span class="built_in">type</span> xfs (rw,relatime,attr2,inode64,noquota)</span><br><span class="line">tmpfs on /run/user/0 <span class="built_in">type</span> tmpfs (rw,nosuid,nodev,relatime,size=186872k,mode=700)</span><br><span class="line">/dev/mapper/centos-root on /var/lib/docker/devicemapper <span class="built_in">type</span> xfs (rw,relatime,attr2,inode64,noquota)</span><br><span class="line">proc on /run/docker/netns/default <span class="built_in">type</span> proc (rw,nosuid,nodev,noexec,relatime)</span><br></pre></td></tr></table></figure>

<p>åŸæ¥æ˜¯<code>xfs</code>çš„æ–‡ä»¶ç³»ç»Ÿï¼Œåœ¨<code>ext4</code>å¹´ä»£ï¼Œæ‰§è¡Œ<code>resize2fs</code>æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œä½†æ˜¯åˆ°äº†<code>xfs</code>æ–‡ä»¶ç³»ç»Ÿå¹´ä»£ï¼Œå°±ä¸èƒ½ä½¿ç”¨<code>resize2fs</code>äº†</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; xfs_growfs /dev/centos/root</span><br></pre></td></tr></table></figure>

<p><code>xfs</code>æ–‡ä»¶ç³»ç»Ÿä¸‹æ‰©å……<code>lvmå·</code>ï¼Œéœ€è¦ä½¿ç”¨<code>xfs_growfs</code></p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>resize2fs</tag>
        <tag>xfs</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL5.7åˆå§‹å¯†ç </title>
    <url>/2016/07/28/MySQL5-7%E5%88%9D%E5%A7%8B%E5%AF%86%E7%A0%81/</url>
    <content><![CDATA[<blockquote>
<p>åˆšè£…å®ŒMySQL5.7ï¼Œè¿˜çƒ­ä¹ç€ï¼Œèµ¶ç´§ç™»é™†ä¸Šå»çœ‹çœ‹ï¼Œç»“æœå‘ç°æ€ä¹ˆè¾“å¯†ç éƒ½æ˜¯é”™çš„ï¼Œåˆ°åº•MySQL5.7åœ¨å®‰è£…çš„æ—¶å€™ç»™rootè®¾ç½®äº†ä¸ªä»€ä¹ˆå¯†ç å‘¢ï¼Ÿ</p>
</blockquote>
<h1 id="ç¬¬ä¸€ç§æ–¹å¼ï¼š"><a href="#ç¬¬ä¸€ç§æ–¹å¼ï¼š" class="headerlink" title="ç¬¬ä¸€ç§æ–¹å¼ï¼š"></a>ç¬¬ä¸€ç§æ–¹å¼ï¼š</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysqld_safe --skip-grant-tables &amp;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæ­¤æ—¶ä¸æƒ³è¢«è¿œç¨‹è¿æ¥ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysqld_safe --skip-grant-tables --skip-networking &amp;</span><br></pre></td></tr></table></figure>

<p>ç„¶åå°±å¯ä»¥æ— å¯†ç è¿›å…¥åˆ°MySQLæ•°æ®åº“ä¸­ï¼Œä½¿ç”¨å„ç§ä½ ç†Ÿæ‚‰çš„SQLè¯­å¥æ¥æ›´æ”¹å¯†ç äº†</p>
<h1 id="ç¬¬äºŒç§æ–¹å¼"><a href="#ç¬¬äºŒç§æ–¹å¼" class="headerlink" title="ç¬¬äºŒç§æ–¹å¼"></a>ç¬¬äºŒç§æ–¹å¼</h1><p>ç¬¬äºŒç§æ–¹å¼ç ¸ç ´ç ‚é”…é—®åˆ°åº•çš„æ¨¡å¼ï¼Œæˆ‘ä»¬åˆ°åº•è¦çœ‹çœ‹ï¼ŒMySQL5.7åœ¨å®‰è£…çš„æ—¶å€™ï¼Œåˆ°åº•ç»™rootè®¾ç½®äº†ä»€ä¹ˆå¯†ç ï¼</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; cat /var/<span class="built_in">log</span>/mysqld.log| grep <span class="string">"temporary password"</span></span><br><span class="line">2016-07-28T15:09:33.387790Z 1 [Note] A temporary password is generated <span class="keyword">for</span> root@localhost: h6(|6T3s5w@5</span><br></pre></td></tr></table></figure>

<p>çœ‹åˆ°å¯†ç äº†å§~~</p>
<p>éº»çƒ¦äº‹å„¿åœ¨åå¤´å‘¢</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç™»å½•è¿›å»ä¹‹åå¯†ç çš„å¤æ‚åº¦å¿…é¡»æ˜¯å¤§å°å†™å­—ç¬¦+æ•°å­—+ç‰¹æ®Šç¬¦å·</span></span><br><span class="line">mysql&gt; alter user user() identified by <span class="string">'w&#123;YQW6L;Dsf6vw'</span>;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>åˆå§‹å¯†ç </tag>
      </tags>
  </entry>
  <entry>
    <title>æŸ¥çœ‹MySQLç¼–è¯‘å‚æ•°</title>
    <url>/2016/07/27/%E6%9F%A5%E7%9C%8BMySQL%E7%BC%96%E8%AF%91%E5%8F%82%E6%95%B0/</url>
    <content><![CDATA[<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">path=<span class="string">"ä½ å®‰è£…MySQLçš„ç»å¯¹è·¯å¾„"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®ä½ ç³»ç»Ÿä¸­å­˜åœ¨çš„ç¼–è¾‘å™¨ï¼Œæ²¡æœ‰vimçš„ç”¨vi</span></span><br><span class="line">&gt; VISUAL=vim; <span class="built_in">export</span> VISUAL</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰§è¡Œmysqlbugå‘½ä»¤</span></span><br><span class="line">&gt; <span class="variable">$path</span>/bin/mysqlbug</span><br><span class="line"><span class="built_in">test</span> -x /usr/bin/vim</span><br><span class="line">Using editor /usr/bin/vim</span><br><span class="line">You can change editor by setting the environment variable VISUAL.</span><br><span class="line">If your shell is a bourne shell (sh) <span class="keyword">do</span></span><br><span class="line">VISUAL=your_editors_name; <span class="built_in">export</span> VISUAL</span><br><span class="line">If your shell is a C shell (csh) <span class="keyword">do</span></span><br><span class="line">setenv VISUAL your_editors_name</span><br><span class="line">SEND-PR: -*- send-pr -*-</span><br><span class="line">SEND-PR: Lines starting with `SEND-PR<span class="string">' will be removed automatically, as</span></span><br><span class="line"><span class="string">SEND-PR: will all comments (text enclosed in `&lt;'</span> and `&gt;<span class="string">').</span></span><br><span class="line"><span class="string">SEND-PR:</span></span><br><span class="line"><span class="string">From: root</span></span><br><span class="line"><span class="string">To: mysql@lists.mysql.com</span></span><br><span class="line"><span class="string">Subject: [50 character or so descriptive subject here (for reference)]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">......</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># åœ¨æ‰“å¼€çš„æ–‡ä»¶ä¸­ï¼Œæœ€åéƒ¨åˆ†ä¼šæœ‰ç¼–è¯‘çš„å‚æ•°</span></span><br><span class="line"><span class="string">Configured with: ../configure --prefix=/usr --mandir=/usr/share/man --infodir=/usr/share/info --with-bugurl=http://bugzilla.redhat.com/bugzilla --enable-bootstrap --enable-shared --enable-threads=posix --enable-checking=release --with-system-zlib</span></span><br><span class="line"><span class="string">--enable-__cxa_atexit --disable-libunwind-exceptions --enable-gnu-unique-object --enable-languages=c,c++,objc,obj-c++,java,fortran,ada --enable-java-awt=gtk --disable-dssi --with-java-home=/usr/lib/jvm/java-1.5.0-gcj-1.5.0.0/jre --enable-libgcj-mu</span></span><br><span class="line"><span class="string">ltifile --enable-java-maintainer-mode --with-ecj-jar=/usr/share/java/eclipse-ecj.jar --disable-libjava-multilib --with-ppl --with-cloog --with-tune=generic --with-arch_32=i686 --build=x86_64-redhat-linux</span></span><br></pre></td></tr></table></figure>


]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>ç¼–è¯‘å‚æ•°</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonæ“ä½œredisè¯¦è§£</title>
    <url>/2016/07/24/Python%E6%93%8D%E4%BD%9Credis%E8%AF%A6%E8%A7%A3/</url>
    <content><![CDATA[<blockquote>
<p>redisæ˜¯ä¸€ä¸ªkey-valueå­˜å‚¨ç³»ç»Ÿã€‚å’ŒMemcachedç±»ä¼¼ï¼Œå®ƒæ”¯æŒå­˜å‚¨çš„valueç±»å‹ç›¸å¯¹æ›´å¤šï¼ŒåŒ…æ‹¬string(å­—ç¬¦ä¸²)ã€list(é“¾è¡¨)ã€set(é›†åˆ)ã€zset(sorted set â€“æœ‰åºé›†åˆ)å’Œhashï¼ˆå“ˆå¸Œç±»å‹ï¼‰ã€‚è¿™äº›æ•°æ®ç±»å‹éƒ½æ”¯æŒpush/popã€add/removeåŠå–äº¤é›†å¹¶é›†å’Œå·®é›†åŠæ›´ä¸°å¯Œçš„æ“ä½œï¼Œè€Œä¸”è¿™äº›æ“ä½œéƒ½æ˜¯åŸå­æ€§çš„ã€‚åœ¨æ­¤åŸºç¡€ä¸Šï¼Œredisæ”¯æŒå„ç§ä¸åŒæ–¹å¼çš„æ’åºã€‚ä¸memcachedä¸€æ ·ï¼Œä¸ºäº†ä¿è¯æ•ˆç‡ï¼Œæ•°æ®éƒ½æ˜¯ç¼“å­˜åœ¨å†…å­˜ä¸­ã€‚åŒºåˆ«çš„æ˜¯redisä¼šå‘¨æœŸæ€§çš„æŠŠæ›´æ–°çš„æ•°æ®å†™å…¥ç£ç›˜æˆ–è€…æŠŠä¿®æ”¹æ“ä½œå†™å…¥è¿½åŠ çš„è®°å½•æ–‡ä»¶ï¼Œå¹¶ä¸”åœ¨æ­¤åŸºç¡€ä¸Šå®ç°äº†master-slave(ä¸»ä»)åŒæ­¥</p>
</blockquote>
<h1 id="APIä½¿ç”¨"><a href="#APIä½¿ç”¨" class="headerlink" title="APIä½¿ç”¨"></a>APIä½¿ç”¨</h1><p>redis-py çš„APIçš„ä½¿ç”¨å¯ä»¥åˆ†ç±»ä¸ºï¼š</p>
<ul>
<li>è¿æ¥æ–¹å¼<ul>
<li>ç›´æ¥è¿æ¥</li>
<li>è¿æ¥æ± </li>
</ul>
</li>
<li>æ“ä½œ<ul>
<li>String æ“ä½œ</li>
<li>Hash æ“ä½œ</li>
<li>List æ“ä½œ</li>
<li>Set æ“ä½œ</li>
<li>Sort Set æ“ä½œ</li>
</ul>
</li>
<li>ç®¡é“</li>
<li>å‘å¸ƒè®¢é˜…</li>
</ul>
<h1 id="è¿æ¥æ–¹å¼"><a href="#è¿æ¥æ–¹å¼" class="headerlink" title="è¿æ¥æ–¹å¼"></a>è¿æ¥æ–¹å¼</h1><h2 id="æ“ä½œæ¨¡å¼"><a href="#æ“ä½œæ¨¡å¼" class="headerlink" title="æ“ä½œæ¨¡å¼"></a>æ“ä½œæ¨¡å¼</h2><p>redis-pyæä¾›ä¸¤ä¸ªç±»Rediså’ŒStrictRedisç”¨äºå®ç°Redisçš„å‘½ä»¤ï¼ŒStrictRedisç”¨äºå®ç°å¤§éƒ¨åˆ†å®˜æ–¹çš„å‘½ä»¤ï¼Œå¹¶ä½¿ç”¨å®˜æ–¹çš„è¯­æ³•å’Œå‘½ä»¤ï¼ŒRedisæ˜¯StrictRedisçš„å­ç±»ï¼Œç”¨äºå‘åå…¼å®¹æ—§ç‰ˆæœ¬çš„redis-py</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"> </span><br><span class="line">r = redis.Redis(host=<span class="string">'10.211.55.4'</span>, port=<span class="number">6379</span>)</span><br><span class="line">r.set(<span class="string">'foo'</span>, <span class="string">'Bar'</span>)</span><br><span class="line"><span class="keyword">print</span> r.get(<span class="string">'foo'</span>)</span><br></pre></td></tr></table></figure>

<h2 id="è¿æ¥æ± "><a href="#è¿æ¥æ± " class="headerlink" title="è¿æ¥æ± "></a>è¿æ¥æ± </h2><p>redis-pyä½¿ç”¨connection poolæ¥ç®¡ç†å¯¹ä¸€ä¸ªredis serverçš„æ‰€æœ‰è¿æ¥ï¼Œé¿å…æ¯æ¬¡å»ºç«‹ã€é‡Šæ”¾è¿æ¥çš„å¼€é”€ã€‚é»˜è®¤ï¼Œæ¯ä¸ªRediså®ä¾‹éƒ½ä¼šç»´æŠ¤ä¸€ä¸ªè‡ªå·±çš„è¿æ¥æ± ã€‚å¯ä»¥ç›´æ¥å»ºç«‹ä¸€ä¸ªè¿æ¥æ± ï¼Œç„¶åä½œä¸ºå‚æ•°Redisï¼Œè¿™æ ·å°±å¯ä»¥å®ç°å¤šä¸ªRediså®ä¾‹å…±äº«ä¸€ä¸ªè¿æ¥æ± </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"> </span><br><span class="line">pool = redis.ConnectionPool(host=<span class="string">'10.211.55.4'</span>, port=<span class="number">6379</span>)</span><br><span class="line"> </span><br><span class="line">r = redis.Redis(connection_pool=pool)</span><br><span class="line">r.set(<span class="string">'foo'</span>, <span class="string">'Bar'</span>)</span><br><span class="line"><span class="keyword">print</span> r.get(<span class="string">'foo'</span>)</span><br></pre></td></tr></table></figure>

<h1 id="æ“ä½œ"><a href="#æ“ä½œ" class="headerlink" title="æ“ä½œ"></a>æ“ä½œ</h1><h2 id="String-æ“ä½œ"><a href="#String-æ“ä½œ" class="headerlink" title="String æ“ä½œ"></a>String æ“ä½œ</h2><p>Stringæ“ä½œï¼Œredisä¸­çš„Stringåœ¨åœ¨å†…å­˜ä¸­æŒ‰ç…§ä¸€ä¸ªnameå¯¹åº”ä¸€ä¸ªvalueæ¥å­˜å‚¨</p>
<table>
<thead>
<tr>
<th>name</th>
<th>â€”&gt;</th>
<th>value</th>
</tr>
</thead>
<tbody><tr>
<td>n1</td>
<td>â€”&gt;</td>
<td>v1</td>
</tr>
<tr>
<td>n2</td>
<td>â€”&gt;</td>
<td>v2</td>
</tr>
<tr>
<td>n3</td>
<td>â€”&gt;</td>
<td>v3</td>
</tr>
</tbody></table>
<p>set(name, value, ex=None, px=None, nx=False, xx=False)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">åœ¨Redisä¸­è®¾ç½®å€¼ï¼Œé»˜è®¤ï¼Œä¸å­˜åœ¨åˆ™åˆ›å»ºï¼Œå­˜åœ¨åˆ™ä¿®æ”¹</span><br><span class="line">å‚æ•°ï¼š</span><br><span class="line">     exï¼Œè¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰</span><br><span class="line">     pxï¼Œè¿‡æœŸæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</span><br><span class="line">     nxï¼Œå¦‚æœè®¾ç½®ä¸ºTrueï¼Œåˆ™åªæœ‰nameä¸å­˜åœ¨æ—¶ï¼Œå½“å‰setæ“ä½œæ‰æ‰§è¡Œ</span><br><span class="line">     xxï¼Œå¦‚æœè®¾ç½®ä¸ºTrueï¼Œåˆ™åªæœ‰nameå­˜åœ¨æ—¶ï¼Œå²—å‰setæ“ä½œæ‰æ‰§è¡Œ</span><br></pre></td></tr></table></figure>
<p>setnx(name, value)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è®¾ç½®å€¼ï¼Œåªæœ‰nameä¸å­˜åœ¨æ—¶ï¼Œæ‰§è¡Œè®¾ç½®æ“ä½œï¼ˆæ·»åŠ ï¼‰</span><br></pre></td></tr></table></figure>

<p>setex(name, value, time)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># è®¾ç½®å€¼</span><br><span class="line"># å‚æ•°ï¼š</span><br><span class="line">    # timeï¼Œè¿‡æœŸæ—¶é—´ï¼ˆæ•°å­—ç§’ æˆ– timedeltaå¯¹è±¡ï¼‰</span><br></pre></td></tr></table></figure>

<p>psetex(name, time_ms, value)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># è®¾ç½®å€¼</span><br><span class="line"># å‚æ•°ï¼š</span><br><span class="line">    # time_msï¼Œè¿‡æœŸæ—¶é—´ï¼ˆæ•°å­—æ¯«ç§’ æˆ– timedeltaå¯¹è±¡ï¼‰</span><br></pre></td></tr></table></figure>

<p>mset(<em>args, *</em>kwargs)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æ‰¹é‡è®¾ç½®å€¼</span><br><span class="line">å¦‚ï¼š</span><br><span class="line">    mset(k1&#x3D;&#39;v1&#39;, k2&#x3D;&#39;v2&#39;)</span><br><span class="line">    æˆ–</span><br><span class="line">    mset(&#123;&#39;k1&#39;: &#39;v1&#39;, &#39;k2&#39;: &#39;v2&#39;&#125;)</span><br></pre></td></tr></table></figure>

<p>get(name)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è·å–å€¼</span><br></pre></td></tr></table></figure>

<p>mget(keys, *args)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æ‰¹é‡è·å–</span><br><span class="line">å¦‚ï¼š</span><br><span class="line">    mget(&#39;ylr&#39;, &#39;wupeiqi&#39;)</span><br><span class="line">    æˆ–</span><br><span class="line">    r.mget([&#39;ylr&#39;, &#39;wupeiqi&#39;])</span><br></pre></td></tr></table></figure>

<p>getset(name, value)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è®¾ç½®æ–°å€¼å¹¶è·å–åŸæ¥çš„å€¼</span><br></pre></td></tr></table></figure>

<p>getrange(key, start, end)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># è·å–å­åºåˆ—ï¼ˆæ ¹æ®å­—èŠ‚è·å–ï¼Œéå­—ç¬¦ï¼‰</span><br><span class="line"># å‚æ•°ï¼š</span><br><span class="line">    # nameï¼ŒRedis çš„ name</span><br><span class="line">    # startï¼Œèµ·å§‹ä½ç½®ï¼ˆå­—èŠ‚ï¼‰</span><br><span class="line">    # endï¼Œç»“æŸä½ç½®ï¼ˆå­—èŠ‚ï¼‰</span><br><span class="line"># å¦‚ï¼š &quot;æ­¦æ²›é½&quot; ï¼Œ0-3è¡¨ç¤º &quot;æ­¦&quot;</span><br></pre></td></tr></table></figure>

<p>setrange(name, offset, value)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># ä¿®æ”¹å­—ç¬¦ä¸²å†…å®¹ï¼Œä»æŒ‡å®šå­—ç¬¦ä¸²ç´¢å¼•å¼€å§‹å‘åæ›¿æ¢ï¼ˆæ–°å€¼å¤ªé•¿æ—¶ï¼Œåˆ™å‘åæ·»åŠ ï¼‰</span><br><span class="line"># å‚æ•°ï¼š</span><br><span class="line">    # offsetï¼Œå­—ç¬¦ä¸²çš„ç´¢å¼•ï¼Œå­—èŠ‚ï¼ˆä¸€ä¸ªæ±‰å­—ä¸‰ä¸ªå­—èŠ‚ï¼‰</span><br><span class="line">    # valueï¼Œè¦è®¾ç½®çš„å€¼</span><br></pre></td></tr></table></figure>

<p>setbit(name, offset, value)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># å¯¹nameå¯¹åº”å€¼çš„äºŒè¿›åˆ¶è¡¨ç¤ºçš„ä½è¿›è¡Œæ“ä½œ</span><br><span class="line"> </span><br><span class="line"># å‚æ•°ï¼š</span><br><span class="line">    # nameï¼Œredisçš„name</span><br><span class="line">    # offsetï¼Œä½çš„ç´¢å¼•ï¼ˆå°†å€¼å˜æ¢æˆäºŒè¿›åˆ¶åå†è¿›è¡Œç´¢å¼•ï¼‰</span><br><span class="line">    # valueï¼Œå€¼åªèƒ½æ˜¯ 1 æˆ– 0</span><br><span class="line"> </span><br><span class="line"># æ³¨ï¼šå¦‚æœåœ¨Redisä¸­æœ‰ä¸€ä¸ªå¯¹åº”ï¼š n1 &#x3D; &quot;foo&quot;ï¼Œ</span><br><span class="line">        é‚£ä¹ˆå­—ç¬¦ä¸²fooçš„äºŒè¿›åˆ¶è¡¨ç¤ºä¸ºï¼š01100110 01101111 01101111</span><br><span class="line">    æ‰€ä»¥ï¼Œå¦‚æœæ‰§è¡Œ setbit(&#39;n1&#39;, 7, 1)ï¼Œåˆ™å°±ä¼šå°†ç¬¬7ä½è®¾ç½®ä¸º1ï¼Œ</span><br><span class="line">        é‚£ä¹ˆæœ€ç»ˆäºŒè¿›åˆ¶åˆ™å˜æˆ 01100111 01101111 01101111ï¼Œå³ï¼š&quot;goo&quot;</span><br><span class="line"> </span><br><span class="line"># æ‰©å±•ï¼Œè½¬æ¢äºŒè¿›åˆ¶è¡¨ç¤ºï¼š</span><br><span class="line"> </span><br><span class="line">    # source &#x3D; &quot;æ­¦æ²›é½&quot;</span><br><span class="line">    source &#x3D; &quot;foo&quot;</span><br><span class="line"> </span><br><span class="line">    for i in source:</span><br><span class="line">        num &#x3D; ord(i)</span><br><span class="line">        print bin(num).replace(&#39;b&#39;,&#39;&#39;)</span><br><span class="line"> </span><br><span class="line">    ç‰¹åˆ«çš„ï¼Œå¦‚æœsourceæ˜¯æ±‰å­— &quot;æ­¦æ²›é½&quot;æ€ä¹ˆåŠï¼Ÿ</span><br><span class="line">    ç­”ï¼šå¯¹äºutf-8ï¼Œæ¯ä¸€ä¸ªæ±‰å­—å  3 ä¸ªå­—èŠ‚ï¼Œé‚£ä¹ˆ &quot;æ­¦æ²›é½&quot; åˆ™æœ‰ 9ä¸ªå­—èŠ‚</span><br><span class="line">       å¯¹äºæ±‰å­—ï¼Œforå¾ªç¯æ—¶å€™ä¼šæŒ‰ç…§ å­—èŠ‚ è¿­ä»£ï¼Œé‚£ä¹ˆåœ¨è¿­ä»£æ—¶ï¼Œå°†æ¯ä¸€ä¸ªå­—èŠ‚è½¬æ¢ åè¿›åˆ¶æ•°ï¼Œç„¶åå†å°†åè¿›åˆ¶æ•°è½¬æ¢æˆäºŒè¿›åˆ¶</span><br><span class="line">        11100110 10101101 10100110 11100110 10110010 10011011 11101001 10111101 10010000</span><br><span class="line">        -------------------------- ----------------------------- -----------------------------</span><br><span class="line">                    æ­¦                         æ²›                           é½</span><br></pre></td></tr></table></figure>

<p>getbit(name, offset)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># è·å–nameå¯¹åº”çš„å€¼çš„äºŒè¿›åˆ¶è¡¨ç¤ºä¸­çš„æŸä½çš„å€¼ ï¼ˆ0æˆ–1ï¼‰</span><br></pre></td></tr></table></figure>

<p>bitcount(key, start=None, end=None)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># è·å–nameå¯¹åº”çš„å€¼çš„äºŒè¿›åˆ¶è¡¨ç¤ºä¸­ 1 çš„ä¸ªæ•°</span><br><span class="line"># å‚æ•°ï¼š</span><br><span class="line">    # keyï¼ŒRedisçš„name</span><br><span class="line">    # startï¼Œä½èµ·å§‹ä½ç½®</span><br><span class="line">    # endï¼Œä½ç»“æŸä½ç½®</span><br></pre></td></tr></table></figure>

<p>bitop(operation, dest, *keys)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># è·å–å¤šä¸ªå€¼ï¼Œå¹¶å°†å€¼åšä½è¿ç®—ï¼Œå°†æœ€åçš„ç»“æœä¿å­˜è‡³æ–°çš„nameå¯¹åº”çš„å€¼</span><br><span class="line"> </span><br><span class="line"># å‚æ•°ï¼š</span><br><span class="line">    # operation,ANDï¼ˆå¹¶ï¼‰ ã€ ORï¼ˆæˆ–ï¼‰ ã€ NOTï¼ˆéï¼‰ ã€ XORï¼ˆå¼‚æˆ–ï¼‰</span><br><span class="line">    # dest, æ–°çš„Redisçš„name</span><br><span class="line">    # *keys,è¦æŸ¥æ‰¾çš„Redisçš„name</span><br><span class="line"> </span><br><span class="line"># å¦‚ï¼š</span><br><span class="line">    bitop(&quot;AND&quot;, &#39;new_name&#39;, &#39;n1&#39;, &#39;n2&#39;, &#39;n3&#39;)</span><br><span class="line">    # è·å–Redisä¸­n1,n2,n3å¯¹åº”çš„å€¼ï¼Œç„¶åè®²æ‰€æœ‰çš„å€¼åšä½è¿ç®—ï¼ˆæ±‚å¹¶é›†ï¼‰ï¼Œç„¶åå°†ç»“æœä¿å­˜ new_name å¯¹åº”çš„å€¼ä¸­</span><br></pre></td></tr></table></figure>

<p>strlen(name)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># è¿”å›nameå¯¹åº”å€¼çš„å­—èŠ‚é•¿åº¦ï¼ˆä¸€ä¸ªæ±‰å­—3ä¸ªå­—èŠ‚ï¼‰</span><br></pre></td></tr></table></figure>

<p>incr(self, name, amount=1)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># è‡ªå¢ nameå¯¹åº”çš„å€¼ï¼Œå½“nameä¸å­˜åœ¨æ—¶ï¼Œåˆ™åˆ›å»ºnameï¼amountï¼Œå¦åˆ™ï¼Œåˆ™è‡ªå¢ã€‚</span><br><span class="line"> </span><br><span class="line"># å‚æ•°ï¼š</span><br><span class="line">    # name,Redisçš„name</span><br><span class="line">    # amount,è‡ªå¢æ•°ï¼ˆå¿…é¡»æ˜¯æ•´æ•°ï¼‰</span><br><span class="line"> </span><br><span class="line"># æ³¨ï¼šåŒincrby</span><br></pre></td></tr></table></figure>

<p>incrbyfloat(self, name, amount=1.0)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># è‡ªå¢ nameå¯¹åº”çš„å€¼ï¼Œå½“nameä¸å­˜åœ¨æ—¶ï¼Œåˆ™åˆ›å»ºnameï¼amountï¼Œå¦åˆ™ï¼Œåˆ™è‡ªå¢ã€‚</span><br><span class="line"> </span><br><span class="line"># å‚æ•°ï¼š</span><br><span class="line">    # name,Redisçš„name</span><br><span class="line">    # amount,è‡ªå¢æ•°ï¼ˆæµ®ç‚¹å‹ï¼‰</span><br></pre></td></tr></table></figure>

<p>decr(self, name, amount=1)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># è‡ªå‡ nameå¯¹åº”çš„å€¼ï¼Œå½“nameä¸å­˜åœ¨æ—¶ï¼Œåˆ™åˆ›å»ºnameï¼amountï¼Œå¦åˆ™ï¼Œåˆ™è‡ªå‡ã€‚</span><br><span class="line"> </span><br><span class="line"># å‚æ•°ï¼š</span><br><span class="line">    # name,Redisçš„name</span><br><span class="line">    # amount,è‡ªå‡æ•°ï¼ˆæ•´æ•°ï¼‰</span><br></pre></td></tr></table></figure>

<p>append(key, value)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># åœ¨redis nameå¯¹åº”çš„å€¼åé¢è¿½åŠ å†…å®¹</span><br><span class="line"> </span><br><span class="line"># å‚æ•°ï¼š</span><br><span class="line">    key, redisçš„name</span><br><span class="line">    value, è¦è¿½åŠ çš„å­—ç¬¦ä¸²</span><br></pre></td></tr></table></figure>

<h2 id="Hash-æ“ä½œ"><a href="#Hash-æ“ä½œ" class="headerlink" title="Hash æ“ä½œ"></a>Hash æ“ä½œ</h2><table>
<thead>
<tr>
<th>name</th>
<th>â€”&gt;</th>
<th>hash</th>
</tr>
</thead>
<tbody><tr>
<td>n1</td>
<td>â€”&gt;</td>
<td>k1â€“&gt;v1</td>
</tr>
<tr>
<td></td>
<td></td>
<td>k2â€“&gt;v2</td>
</tr>
<tr>
<td></td>
<td></td>
<td>k3â€“&gt;v3</td>
</tr>
<tr>
<td>n2</td>
<td>â€”&gt;</td>
<td>k9â€“&gt;v9</td>
</tr>
<tr>
<td></td>
<td></td>
<td>k20â€“&gt;v20</td>
</tr>
<tr>
<td></td>
<td></td>
<td>k31â€“&gt;v31</td>
</tr>
</tbody></table>
<p>hset(name, key, value)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># nameå¯¹åº”çš„hashä¸­è®¾ç½®ä¸€ä¸ªé”®å€¼å¯¹ï¼ˆä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºï¼›å¦åˆ™ï¼Œä¿®æ”¹ï¼‰</span><br><span class="line"> </span><br><span class="line"># å‚æ•°ï¼š</span><br><span class="line">    # nameï¼Œredisçš„name</span><br><span class="line">    # keyï¼Œnameå¯¹åº”çš„hashä¸­çš„key</span><br><span class="line">    # valueï¼Œnameå¯¹åº”çš„hashä¸­çš„value</span><br><span class="line"> </span><br><span class="line"># æ³¨ï¼š</span><br><span class="line">    # hsetnx(name, key, value),å½“nameå¯¹åº”çš„hashä¸­ä¸å­˜åœ¨å½“å‰keyæ—¶åˆ™åˆ›å»ºï¼ˆç›¸å½“äºæ·»åŠ ï¼‰</span><br></pre></td></tr></table></figure>

<p>hmset(name, mapping)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># åœ¨nameå¯¹åº”çš„hashä¸­æ‰¹é‡è®¾ç½®é”®å€¼å¯¹</span><br><span class="line"> </span><br><span class="line"># å‚æ•°ï¼š</span><br><span class="line">    # nameï¼Œredisçš„name</span><br><span class="line">    # mappingï¼Œå­—å…¸ï¼Œå¦‚ï¼š&#123;&#39;k1&#39;:&#39;v1&#39;, &#39;k2&#39;: &#39;v2&#39;&#125;</span><br><span class="line"> </span><br><span class="line"># å¦‚ï¼š</span><br><span class="line">    # r.hmset(&#39;xx&#39;, &#123;&#39;k1&#39;:&#39;v1&#39;, &#39;k2&#39;: &#39;v2&#39;&#125;)</span><br></pre></td></tr></table></figure>

<p>hget(name,key)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># åœ¨nameå¯¹åº”çš„hashä¸­è·å–æ ¹æ®keyè·å–value</span><br></pre></td></tr></table></figure>

<p>hmget(name, keys, *args)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># åœ¨nameå¯¹åº”çš„hashä¸­è·å–å¤šä¸ªkeyçš„å€¼</span><br><span class="line"> </span><br><span class="line"># å‚æ•°ï¼š</span><br><span class="line">    # nameï¼Œreidså¯¹åº”çš„name</span><br><span class="line">    # keysï¼Œè¦è·å–keyé›†åˆï¼Œå¦‚ï¼š[&#39;k1&#39;, &#39;k2&#39;, &#39;k3&#39;]</span><br><span class="line">    # *argsï¼Œè¦è·å–çš„keyï¼Œå¦‚ï¼šk1,k2,k3</span><br><span class="line"> </span><br><span class="line"># å¦‚ï¼š</span><br><span class="line">    # r.mget(&#39;xx&#39;, [&#39;k1&#39;, &#39;k2&#39;])</span><br><span class="line">    # æˆ–</span><br><span class="line">    # print r.hmget(&#39;xx&#39;, &#39;k1&#39;, &#39;k2&#39;)</span><br></pre></td></tr></table></figure>

<p>hgetall(name)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è·å–nameå¯¹åº”hashçš„æ‰€æœ‰é”®å€¼</span><br></pre></td></tr></table></figure>

<p>hlen(name)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># è·å–nameå¯¹åº”çš„hashä¸­é”®å€¼å¯¹çš„ä¸ªæ•°</span><br></pre></td></tr></table></figure>

<p>hkeys(name)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># è·å–nameå¯¹åº”çš„hashä¸­æ‰€æœ‰çš„keyçš„å€¼</span><br></pre></td></tr></table></figure>

<p>hvals(name)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># è·å–nameå¯¹åº”çš„hashä¸­æ‰€æœ‰çš„valueçš„å€¼</span><br></pre></td></tr></table></figure>

<p>hexists(name, key)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># æ£€æŸ¥nameå¯¹åº”çš„hashæ˜¯å¦å­˜åœ¨å½“å‰ä¼ å…¥çš„key</span><br></pre></td></tr></table></figure>

<p>hdel(name,*keys)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># å°†nameå¯¹åº”çš„hashä¸­æŒ‡å®škeyçš„é”®å€¼å¯¹åˆ é™¤</span><br></pre></td></tr></table></figure>

<p>hincrby(name, key, amount=1)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># è‡ªå¢nameå¯¹åº”çš„hashä¸­çš„æŒ‡å®škeyçš„å€¼ï¼Œä¸å­˜åœ¨åˆ™åˆ›å»ºkey&#x3D;amount</span><br><span class="line"># å‚æ•°ï¼š</span><br><span class="line">    # nameï¼Œredisä¸­çš„name</span><br><span class="line">    # keyï¼Œ hashå¯¹åº”çš„key</span><br><span class="line">    # amountï¼Œè‡ªå¢æ•°ï¼ˆæ•´æ•°ï¼‰</span><br></pre></td></tr></table></figure>

<p>hincrbyfloat(name, key, amount=1.0)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># è‡ªå¢nameå¯¹åº”çš„hashä¸­çš„æŒ‡å®škeyçš„å€¼ï¼Œä¸å­˜åœ¨åˆ™åˆ›å»ºkey&#x3D;amount</span><br><span class="line"> </span><br><span class="line"># å‚æ•°ï¼š</span><br><span class="line">    # nameï¼Œredisä¸­çš„name</span><br><span class="line">    # keyï¼Œ hashå¯¹åº”çš„key</span><br><span class="line">    # amountï¼Œè‡ªå¢æ•°ï¼ˆæµ®ç‚¹æ•°ï¼‰</span><br><span class="line"> </span><br><span class="line"># è‡ªå¢nameå¯¹åº”çš„hashä¸­çš„æŒ‡å®škeyçš„å€¼ï¼Œä¸å­˜åœ¨åˆ™åˆ›å»ºkey&#x3D;amount</span><br></pre></td></tr></table></figure>

<p>hscan(name, cursor=0, match=None, count=None)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># å¢é‡å¼è¿­ä»£è·å–ï¼Œå¯¹äºæ•°æ®å¤§çš„æ•°æ®éå¸¸æœ‰ç”¨ï¼Œhscanå¯ä»¥å®ç°åˆ†ç‰‡çš„è·å–æ•°æ®ï¼Œå¹¶éä¸€æ¬¡æ€§å°†æ•°æ®å…¨éƒ¨è·å–å®Œï¼Œä»è€Œæ”¾ç½®å†…å­˜è¢«æ’‘çˆ†</span><br><span class="line"> </span><br><span class="line"># å‚æ•°ï¼š</span><br><span class="line">    # nameï¼Œredisçš„name</span><br><span class="line">    # cursorï¼Œæ¸¸æ ‡ï¼ˆåŸºäºæ¸¸æ ‡åˆ†æ‰¹å–è·å–æ•°æ®ï¼‰</span><br><span class="line">    # matchï¼ŒåŒ¹é…æŒ‡å®škeyï¼Œé»˜è®¤None è¡¨ç¤ºæ‰€æœ‰çš„key</span><br><span class="line">    # countï¼Œæ¯æ¬¡åˆ†ç‰‡æœ€å°‘è·å–ä¸ªæ•°ï¼Œé»˜è®¤Noneè¡¨ç¤ºé‡‡ç”¨Redisçš„é»˜è®¤åˆ†ç‰‡ä¸ªæ•°</span><br><span class="line"> </span><br><span class="line"># å¦‚ï¼š</span><br><span class="line">    # ç¬¬ä¸€æ¬¡ï¼šcursor1, data1 &#x3D; r.hscan(&#39;xx&#39;, cursor&#x3D;0, match&#x3D;None, count&#x3D;None)</span><br><span class="line">    # ç¬¬äºŒæ¬¡ï¼šcursor2, data1 &#x3D; r.hscan(&#39;xx&#39;, cursor&#x3D;cursor1, match&#x3D;None, count&#x3D;None)</span><br><span class="line">    # ...</span><br><span class="line">    # ç›´åˆ°è¿”å›å€¼cursorçš„å€¼ä¸º0æ—¶ï¼Œè¡¨ç¤ºæ•°æ®å·²ç»é€šè¿‡åˆ†ç‰‡è·å–å®Œæ¯•</span><br></pre></td></tr></table></figure>

<p>hscan_iter(name, match=None, count=None)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># åˆ©ç”¨yieldå°è£…hscanåˆ›å»ºç”Ÿæˆå™¨ï¼Œå®ç°åˆ†æ‰¹å»redisä¸­è·å–æ•°æ®</span><br><span class="line"> </span><br><span class="line"># å‚æ•°ï¼š</span><br><span class="line">    # matchï¼ŒåŒ¹é…æŒ‡å®škeyï¼Œé»˜è®¤None è¡¨ç¤ºæ‰€æœ‰çš„key</span><br><span class="line">    # countï¼Œæ¯æ¬¡åˆ†ç‰‡æœ€å°‘è·å–ä¸ªæ•°ï¼Œé»˜è®¤Noneè¡¨ç¤ºé‡‡ç”¨Redisçš„é»˜è®¤åˆ†ç‰‡ä¸ªæ•°</span><br><span class="line"> </span><br><span class="line"># å¦‚ï¼š</span><br><span class="line">    # for item in r.hscan_iter(&#39;xx&#39;):</span><br><span class="line">    #     print item</span><br></pre></td></tr></table></figure>


<h2 id="List-æ“ä½œ"><a href="#List-æ“ä½œ" class="headerlink" title="List æ“ä½œ"></a>List æ“ä½œ</h2><table>
<thead>
<tr>
<th>name</th>
<th>â€”&gt;</th>
<th>hash</th>
</tr>
</thead>
<tbody><tr>
<td>n1</td>
<td>â€”&gt;</td>
<td>v1,v2â€¦</td>
</tr>
<tr>
<td>n2</td>
<td>â€”&gt;</td>
<td>v15,v59â€¦</td>
</tr>
</tbody></table>
<p>lpush(name,values)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># åœ¨nameå¯¹åº”çš„listä¸­æ·»åŠ å…ƒç´ ï¼Œæ¯ä¸ªæ–°çš„å…ƒç´ éƒ½æ·»åŠ åˆ°åˆ—è¡¨çš„æœ€å·¦è¾¹</span><br><span class="line"> </span><br><span class="line"># å¦‚ï¼š</span><br><span class="line">    # r.lpush(&#39;oo&#39;, 11,22,33)</span><br><span class="line">    # ä¿å­˜é¡ºåºä¸º: 33,22,11</span><br><span class="line"> </span><br><span class="line"># æ‰©å±•ï¼š</span><br><span class="line">    # rpush(name, values) è¡¨ç¤ºä»å³å‘å·¦æ“ä½œ</span><br></pre></td></tr></table></figure>

<p>lpushx(name,value)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># åœ¨nameå¯¹åº”çš„listä¸­æ·»åŠ å…ƒç´ ï¼Œåªæœ‰nameå·²ç»å­˜åœ¨æ—¶ï¼Œå€¼æ·»åŠ åˆ°åˆ—è¡¨çš„æœ€å·¦è¾¹</span><br><span class="line"> </span><br><span class="line"># æ›´å¤šï¼š</span><br><span class="line">    # rpushx(name, value) è¡¨ç¤ºä»å³å‘å·¦æ“ä½œ</span><br></pre></td></tr></table></figure>

<p>llen(name)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># nameå¯¹åº”çš„listå…ƒç´ çš„ä¸ªæ•°</span><br></pre></td></tr></table></figure>

<p>linsert(name, where, refvalue, value))</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># åœ¨nameå¯¹åº”çš„åˆ—è¡¨çš„æŸä¸€ä¸ªå€¼å‰æˆ–åæ’å…¥ä¸€ä¸ªæ–°å€¼</span><br><span class="line"> </span><br><span class="line"># å‚æ•°ï¼š</span><br><span class="line">    # nameï¼Œredisçš„name</span><br><span class="line">    # whereï¼ŒBEFOREæˆ–AFTER</span><br><span class="line">    # refvalueï¼Œæ ‡æ†å€¼ï¼Œå³ï¼šåœ¨å®ƒå‰åæ’å…¥æ•°æ®</span><br><span class="line">    # valueï¼Œè¦æ’å…¥çš„æ•°æ®</span><br></pre></td></tr></table></figure>

<p>r.lset(name, index, value)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># å¯¹nameå¯¹åº”çš„listä¸­çš„æŸä¸€ä¸ªç´¢å¼•ä½ç½®é‡æ–°èµ‹å€¼</span><br><span class="line"> </span><br><span class="line"># å‚æ•°ï¼š</span><br><span class="line">    # nameï¼Œredisçš„name</span><br><span class="line">    # indexï¼Œlistçš„ç´¢å¼•ä½ç½®</span><br><span class="line">    # valueï¼Œè¦è®¾ç½®çš„å€¼</span><br></pre></td></tr></table></figure>

<p>r.lrem(name, value, num)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># åœ¨nameå¯¹åº”çš„listä¸­åˆ é™¤æŒ‡å®šçš„å€¼</span><br><span class="line"> </span><br><span class="line"># å‚æ•°ï¼š</span><br><span class="line">    # nameï¼Œredisçš„name</span><br><span class="line">    # valueï¼Œè¦åˆ é™¤çš„å€¼</span><br><span class="line">    # numï¼Œ  num&#x3D;0ï¼Œåˆ é™¤åˆ—è¡¨ä¸­æ‰€æœ‰çš„æŒ‡å®šå€¼ï¼›</span><br><span class="line">           # num&#x3D;2,ä»å‰åˆ°åï¼Œåˆ é™¤2ä¸ªï¼›</span><br><span class="line">           # num&#x3D;-2,ä»åå‘å‰ï¼Œåˆ é™¤2ä¸ª</span><br></pre></td></tr></table></figure>

<p>lpop(name)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># åœ¨nameå¯¹åº”çš„åˆ—è¡¨çš„å·¦ä¾§è·å–ç¬¬ä¸€ä¸ªå…ƒç´ å¹¶åœ¨åˆ—è¡¨ä¸­ç§»é™¤ï¼Œè¿”å›å€¼åˆ™æ˜¯ç¬¬ä¸€ä¸ªå…ƒç´ </span><br><span class="line"> </span><br><span class="line"># æ›´å¤šï¼š</span><br><span class="line">    # rpop(name) è¡¨ç¤ºä»å³å‘å·¦æ“ä½œ</span><br></pre></td></tr></table></figure>

<p>lindex(name, index)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">åœ¨nameå¯¹åº”çš„åˆ—è¡¨ä¸­æ ¹æ®ç´¢å¼•è·å–åˆ—è¡¨å…ƒç´ </span><br></pre></td></tr></table></figure>

<p>lrange(name, start, end)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># åœ¨nameå¯¹åº”çš„åˆ—è¡¨åˆ†ç‰‡è·å–æ•°æ®</span><br><span class="line"># å‚æ•°ï¼š</span><br><span class="line">    # nameï¼Œredisçš„name</span><br><span class="line">    # startï¼Œç´¢å¼•çš„èµ·å§‹ä½ç½®</span><br><span class="line">    # endï¼Œç´¢å¼•ç»“æŸä½ç½®</span><br></pre></td></tr></table></figure>

<p>ltrim(name, start, end)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># åœ¨nameå¯¹åº”çš„åˆ—è¡¨ä¸­ç§»é™¤æ²¡æœ‰åœ¨start-endç´¢å¼•ä¹‹é—´çš„å€¼</span><br><span class="line"># å‚æ•°ï¼š</span><br><span class="line">    # nameï¼Œredisçš„name</span><br><span class="line">    # startï¼Œç´¢å¼•çš„èµ·å§‹ä½ç½®</span><br><span class="line">    # endï¼Œç´¢å¼•ç»“æŸä½ç½®</span><br></pre></td></tr></table></figure>

<p>rpoplpush(src, dst)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># ä»ä¸€ä¸ªåˆ—è¡¨å–å‡ºæœ€å³è¾¹çš„å…ƒç´ ï¼ŒåŒæ—¶å°†å…¶æ·»åŠ è‡³å¦ä¸€ä¸ªåˆ—è¡¨çš„æœ€å·¦è¾¹</span><br><span class="line"># å‚æ•°ï¼š</span><br><span class="line">    # srcï¼Œè¦å–æ•°æ®çš„åˆ—è¡¨çš„name</span><br><span class="line">    # dstï¼Œè¦æ·»åŠ æ•°æ®çš„åˆ—è¡¨çš„name</span><br></pre></td></tr></table></figure>

<p>blpop(keys, timeout)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># å°†å¤šä¸ªåˆ—è¡¨æ’åˆ—ï¼ŒæŒ‰ç…§ä»å·¦åˆ°å³å»popå¯¹åº”åˆ—è¡¨çš„å…ƒç´ </span><br><span class="line"> </span><br><span class="line"># å‚æ•°ï¼š</span><br><span class="line">    # keysï¼Œredisçš„nameçš„é›†åˆ</span><br><span class="line">    # timeoutï¼Œè¶…æ—¶æ—¶é—´ï¼Œå½“å…ƒç´ æ‰€æœ‰åˆ—è¡¨çš„å…ƒç´ è·å–å®Œä¹‹åï¼Œé˜»å¡ç­‰å¾…åˆ—è¡¨å†…æœ‰æ•°æ®çš„æ—¶é—´ï¼ˆç§’ï¼‰, 0 è¡¨ç¤ºæ°¸è¿œé˜»å¡</span><br><span class="line"> </span><br><span class="line"># æ›´å¤šï¼š</span><br><span class="line">    # r.brpop(keys, timeout)ï¼Œä»å³å‘å·¦è·å–æ•°æ®</span><br></pre></td></tr></table></figure>

<p>brpoplpush(src, dst, timeout=0)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># ä»ä¸€ä¸ªåˆ—è¡¨çš„å³ä¾§ç§»é™¤ä¸€ä¸ªå…ƒç´ å¹¶å°†å…¶æ·»åŠ åˆ°å¦ä¸€ä¸ªåˆ—è¡¨çš„å·¦ä¾§</span><br><span class="line"> </span><br><span class="line"># å‚æ•°ï¼š</span><br><span class="line">    # srcï¼Œå–å‡ºå¹¶è¦ç§»é™¤å…ƒç´ çš„åˆ—è¡¨å¯¹åº”çš„name</span><br><span class="line">    # dstï¼Œè¦æ’å…¥å…ƒç´ çš„åˆ—è¡¨å¯¹åº”çš„name</span><br><span class="line">    # timeoutï¼Œå½“srcå¯¹åº”çš„åˆ—è¡¨ä¸­æ²¡æœ‰æ•°æ®æ—¶ï¼Œé˜»å¡ç­‰å¾…å…¶æœ‰æ•°æ®çš„è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œ0 è¡¨ç¤ºæ°¸è¿œé˜»å¡</span><br></pre></td></tr></table></figure>

<p><strong>è‡ªå®šä¹‰å¢é‡è¿­ä»£</strong>(éå¸¸é‡è¦ï¼ŒåŸç”Ÿçš„æ¨¡å—æ²¡æœ‰æä¾›æ”¯æŒ)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># ç”±äºredisç±»åº“ä¸­æ²¡æœ‰æä¾›å¯¹åˆ—è¡¨å…ƒç´ çš„å¢é‡è¿­ä»£ï¼Œå¦‚æœæƒ³è¦å¾ªç¯nameå¯¹åº”çš„åˆ—è¡¨çš„æ‰€æœ‰å…ƒç´ ï¼Œé‚£ä¹ˆå°±éœ€è¦ï¼š</span><br><span class="line">    # 1ã€è·å–nameå¯¹åº”çš„æ‰€æœ‰åˆ—è¡¨</span><br><span class="line">    # 2ã€å¾ªç¯åˆ—è¡¨</span><br><span class="line"># ä½†æ˜¯ï¼Œå¦‚æœåˆ—è¡¨éå¸¸å¤§ï¼Œé‚£ä¹ˆå°±æœ‰å¯èƒ½åœ¨ç¬¬ä¸€æ­¥æ—¶å°±å°†ç¨‹åºçš„å†…å®¹æ’‘çˆ†ï¼Œæ‰€æœ‰æœ‰å¿…è¦è‡ªå®šä¹‰ä¸€ä¸ªå¢é‡è¿­ä»£çš„åŠŸèƒ½ï¼š</span><br><span class="line"> </span><br><span class="line">def list_iter(name):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    è‡ªå®šä¹‰redisåˆ—è¡¨å¢é‡è¿­ä»£</span><br><span class="line">    :param name: redisä¸­çš„nameï¼Œå³ï¼šè¿­ä»£nameå¯¹åº”çš„åˆ—è¡¨</span><br><span class="line">    :return: yield è¿”å› åˆ—è¡¨å…ƒç´ </span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    list_count &#x3D; r.llen(name)</span><br><span class="line">    for index in xrange(list_count):</span><br><span class="line">        yield r.lindex(name, index)</span><br><span class="line"> </span><br><span class="line"># ä½¿ç”¨</span><br><span class="line">for item in list_iter(&#39;pp&#39;):</span><br><span class="line">    print item</span><br></pre></td></tr></table></figure>


<h2 id="Set-æ“ä½œ"><a href="#Set-æ“ä½œ" class="headerlink" title="Set æ“ä½œ"></a>Set æ“ä½œ</h2><p>Setæ“ä½œï¼ŒSeté›†åˆå°±æ˜¯ä¸å…è®¸é‡å¤çš„åˆ—è¡¨</p>
<p>sadd(name,values)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># nameå¯¹åº”çš„é›†åˆä¸­æ·»åŠ å…ƒç´ </span><br></pre></td></tr></table></figure>

<p>scard(name)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è·å–nameå¯¹åº”çš„é›†åˆä¸­å…ƒç´ ä¸ªæ•°</span><br></pre></td></tr></table></figure>

<p>sdiff(keys, *args)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">åœ¨ç¬¬ä¸€ä¸ªnameå¯¹åº”çš„é›†åˆä¸­ä¸”ä¸åœ¨å…¶ä»–nameå¯¹åº”çš„é›†åˆçš„å…ƒç´ é›†åˆ</span><br></pre></td></tr></table></figure>

<p>sdiffstore(dest, keys, *args)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># è·å–ç¬¬ä¸€ä¸ªnameå¯¹åº”çš„é›†åˆä¸­ä¸”ä¸åœ¨å…¶ä»–nameå¯¹åº”çš„é›†åˆï¼Œå†å°†å…¶æ–°åŠ å…¥åˆ°destå¯¹åº”çš„é›†åˆä¸­</span><br></pre></td></tr></table></figure>

<p>sinter(keys, *args)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># è·å–å¤šä¸€ä¸ªnameå¯¹åº”é›†åˆçš„å¹¶é›†</span><br></pre></td></tr></table></figure>

<p>sinterstore(dest, keys, *args)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># è·å–å¤šä¸€ä¸ªnameå¯¹åº”é›†åˆçš„å¹¶é›†ï¼Œå†è®²å…¶åŠ å…¥åˆ°destå¯¹åº”çš„é›†åˆä¸­</span><br></pre></td></tr></table></figure>

<p>sismember(name, value)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># æ£€æŸ¥valueæ˜¯å¦æ˜¯nameå¯¹åº”çš„é›†åˆçš„æˆå‘˜</span><br></pre></td></tr></table></figure>

<p>smembers(name)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># è·å–nameå¯¹åº”çš„é›†åˆçš„æ‰€æœ‰æˆå‘˜</span><br></pre></td></tr></table></figure>

<p>smove(src, dst, value)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># å°†æŸä¸ªæˆå‘˜ä»ä¸€ä¸ªé›†åˆä¸­ç§»åŠ¨åˆ°å¦å¤–ä¸€ä¸ªé›†åˆ</span><br></pre></td></tr></table></figure>

<p>spop(name)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># ä»é›†åˆçš„å³ä¾§ï¼ˆå°¾éƒ¨ï¼‰ç§»é™¤ä¸€ä¸ªæˆå‘˜ï¼Œå¹¶å°†å…¶è¿”å›</span><br></pre></td></tr></table></figure>

<p>srandmember(name, numbers)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># ä»nameå¯¹åº”çš„é›†åˆä¸­éšæœºè·å– numbers ä¸ªå…ƒç´ </span><br></pre></td></tr></table></figure>

<p>srem(name, values)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># åœ¨nameå¯¹åº”çš„é›†åˆä¸­åˆ é™¤æŸäº›å€¼</span><br></pre></td></tr></table></figure>

<p>sunion(keys, *args)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># è·å–å¤šä¸€ä¸ªnameå¯¹åº”çš„é›†åˆçš„å¹¶é›†</span><br></pre></td></tr></table></figure>

<p>sunionstore(dest,keys, *args)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># è·å–å¤šä¸€ä¸ªnameå¯¹åº”çš„é›†åˆçš„å¹¶é›†ï¼Œå¹¶å°†ç»“æœä¿å­˜åˆ°destå¯¹åº”çš„é›†åˆä¸­</span><br></pre></td></tr></table></figure>

<p>sscan(name, cursor=0, match=None, count=None)<br>sscan_iter(name, match=None, count=None)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># åŒå­—ç¬¦ä¸²çš„æ“ä½œï¼Œç”¨äºå¢é‡è¿­ä»£åˆ†æ‰¹è·å–å…ƒç´ ï¼Œé¿å…å†…å­˜æ¶ˆè€—å¤ªå¤§</span><br></pre></td></tr></table></figure>


<h2 id="Sort-Set-æ“ä½œ"><a href="#Sort-Set-æ“ä½œ" class="headerlink" title="Sort Set æ“ä½œ"></a>Sort Set æ“ä½œ</h2><p>æœ‰åºé›†åˆï¼Œåœ¨é›†åˆçš„åŸºç¡€ä¸Šï¼Œä¸ºæ¯å…ƒç´ æ’åºï¼›å…ƒç´ çš„æ’åºéœ€è¦æ ¹æ®å¦å¤–ä¸€ä¸ªå€¼æ¥è¿›è¡Œæ¯”è¾ƒï¼Œæ‰€ä»¥ï¼Œå¯¹äºæœ‰åºé›†åˆï¼Œæ¯ä¸€ä¸ªå…ƒç´ æœ‰ä¸¤ä¸ªå€¼ï¼Œå³ï¼šå€¼å’Œåˆ†æ•°ï¼Œåˆ†æ•°ä¸“é—¨ç”¨æ¥åšæ’åº</p>
<p>zadd(name, <em>args, *</em>kwargs)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># åœ¨nameå¯¹åº”çš„æœ‰åºé›†åˆä¸­æ·»åŠ å…ƒç´ </span><br><span class="line"># å¦‚ï¼š</span><br><span class="line">     # zadd(&#39;zz&#39;, &#39;n1&#39;, 1, &#39;n2&#39;, 2)</span><br><span class="line">     # æˆ–</span><br><span class="line">     # zadd(&#39;zz&#39;, n1&#x3D;11, n2&#x3D;22)</span><br></pre></td></tr></table></figure>

<p>zcard(name)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># è·å–nameå¯¹åº”çš„æœ‰åºé›†åˆå…ƒç´ çš„æ•°é‡</span><br></pre></td></tr></table></figure>

<p>zcount(name, min, max)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># è·å–nameå¯¹åº”çš„æœ‰åºé›†åˆä¸­åˆ†æ•° åœ¨ [min,max] ä¹‹é—´çš„ä¸ªæ•°</span><br></pre></td></tr></table></figure>

<p>zincrby(name, value, amount)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># è‡ªå¢nameå¯¹åº”çš„æœ‰åºé›†åˆçš„ name å¯¹åº”çš„åˆ†æ•°</span><br></pre></td></tr></table></figure>

<p>r.zrange( name, start, end, desc=False, withscores=False, score_cast_func=float)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># æŒ‰ç…§ç´¢å¼•èŒƒå›´è·å–nameå¯¹åº”çš„æœ‰åºé›†åˆçš„å…ƒç´ </span><br><span class="line"> </span><br><span class="line"># å‚æ•°ï¼š</span><br><span class="line">    # nameï¼Œredisçš„name</span><br><span class="line">    # startï¼Œæœ‰åºé›†åˆç´¢å¼•èµ·å§‹ä½ç½®ï¼ˆéåˆ†æ•°ï¼‰</span><br><span class="line">    # endï¼Œæœ‰åºé›†åˆç´¢å¼•ç»“æŸä½ç½®ï¼ˆéåˆ†æ•°ï¼‰</span><br><span class="line">    # descï¼Œæ’åºè§„åˆ™ï¼Œé»˜è®¤æŒ‰ç…§åˆ†æ•°ä»å°åˆ°å¤§æ’åº</span><br><span class="line">    # withscoresï¼Œæ˜¯å¦è·å–å…ƒç´ çš„åˆ†æ•°ï¼Œé»˜è®¤åªè·å–å…ƒç´ çš„å€¼</span><br><span class="line">    # score_cast_funcï¼Œå¯¹åˆ†æ•°è¿›è¡Œæ•°æ®è½¬æ¢çš„å‡½æ•°</span><br><span class="line"> </span><br><span class="line"># æ›´å¤šï¼š</span><br><span class="line">    # ä»å¤§åˆ°å°æ’åº</span><br><span class="line">    # zrevrange(name, start, end, withscores&#x3D;False, score_cast_func&#x3D;float)</span><br><span class="line"> </span><br><span class="line">    # æŒ‰ç…§åˆ†æ•°èŒƒå›´è·å–nameå¯¹åº”çš„æœ‰åºé›†åˆçš„å…ƒç´ </span><br><span class="line">    # zrangebyscore(name, min, max, start&#x3D;None, num&#x3D;None, withscores&#x3D;False, score_cast_func&#x3D;float)</span><br><span class="line">    # ä»å¤§åˆ°å°æ’åº</span><br><span class="line">    # zrevrangebyscore(name, max, min, start&#x3D;None, num&#x3D;None, withscores&#x3D;False, score_cast_func&#x3D;float)</span><br></pre></td></tr></table></figure>

<p>zrank(name, value)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># è·å–æŸä¸ªå€¼åœ¨ nameå¯¹åº”çš„æœ‰åºé›†åˆä¸­çš„æ’è¡Œï¼ˆä» 0 å¼€å§‹ï¼‰</span><br><span class="line"> </span><br><span class="line"># æ›´å¤šï¼š</span><br><span class="line">    # zrevrank(name, value)ï¼Œä»å¤§åˆ°å°æ’åº</span><br></pre></td></tr></table></figure>

<p>zrangebylex(name, min, max, start=None, num=None)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># å½“æœ‰åºé›†åˆçš„æ‰€æœ‰æˆå‘˜éƒ½å…·æœ‰ç›¸åŒçš„åˆ†å€¼æ—¶ï¼Œæœ‰åºé›†åˆçš„å…ƒç´ ä¼šæ ¹æ®æˆå‘˜çš„ å€¼ ï¼ˆlexicographical orderingï¼‰æ¥è¿›è¡Œæ’åºï¼Œè€Œè¿™ä¸ªå‘½ä»¤åˆ™å¯ä»¥è¿”å›ç»™å®šçš„æœ‰åºé›†åˆé”® key ä¸­ï¼Œ å…ƒç´ çš„å€¼ä»‹äº min å’Œ max ä¹‹é—´çš„æˆå‘˜</span><br><span class="line"># å¯¹é›†åˆä¸­çš„æ¯ä¸ªæˆå‘˜è¿›è¡Œé€ä¸ªå­—èŠ‚çš„å¯¹æ¯”ï¼ˆbyte-by-byte compareï¼‰ï¼Œ å¹¶æŒ‰ç…§ä»ä½åˆ°é«˜çš„é¡ºåºï¼Œ è¿”å›æ’åºåçš„é›†åˆæˆå‘˜ã€‚ å¦‚æœä¸¤ä¸ªå­—ç¬¦ä¸²æœ‰ä¸€éƒ¨åˆ†å†…å®¹æ˜¯ç›¸åŒçš„è¯ï¼Œ é‚£ä¹ˆå‘½ä»¤ä¼šè®¤ä¸ºè¾ƒé•¿çš„å­—ç¬¦ä¸²æ¯”è¾ƒçŸ­çš„å­—ç¬¦ä¸²è¦å¤§</span><br><span class="line"> </span><br><span class="line"># å‚æ•°ï¼š</span><br><span class="line">    # nameï¼Œredisçš„name</span><br><span class="line">    # minï¼Œå·¦åŒºé—´ï¼ˆå€¼ï¼‰ã€‚ + è¡¨ç¤ºæ­£æ— é™ï¼› - è¡¨ç¤ºè´Ÿæ— é™ï¼› ( è¡¨ç¤ºå¼€åŒºé—´ï¼› [ åˆ™è¡¨ç¤ºé—­åŒºé—´</span><br><span class="line">    # minï¼Œå³åŒºé—´ï¼ˆå€¼ï¼‰</span><br><span class="line">    # startï¼Œå¯¹ç»“æœè¿›è¡Œåˆ†ç‰‡å¤„ç†ï¼Œç´¢å¼•ä½ç½®</span><br><span class="line">    # numï¼Œå¯¹ç»“æœè¿›è¡Œåˆ†ç‰‡å¤„ç†ï¼Œç´¢å¼•åé¢çš„numä¸ªå…ƒç´ </span><br><span class="line"> </span><br><span class="line"># å¦‚ï¼š</span><br><span class="line">    # ZADD myzset 0 aa 0 ba 0 ca 0 da 0 ea 0 fa 0 ga</span><br><span class="line">    # r.zrangebylex(&#39;myzset&#39;, &quot;-&quot;, &quot;[ca&quot;) ç»“æœä¸ºï¼š[&#39;aa&#39;, &#39;ba&#39;, &#39;ca&#39;]</span><br><span class="line"> </span><br><span class="line"># æ›´å¤šï¼š</span><br><span class="line">    # ä»å¤§åˆ°å°æ’åº</span><br><span class="line">    # zrevrangebylex(name, max, min, start&#x3D;None, num&#x3D;None)</span><br></pre></td></tr></table></figure>

<p>zrem(name, values)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># åˆ é™¤nameå¯¹åº”çš„æœ‰åºé›†åˆä¸­å€¼æ˜¯valuesçš„æˆå‘˜</span><br><span class="line"> </span><br><span class="line"># å¦‚ï¼šzrem(&#39;zz&#39;, [&#39;s1&#39;, &#39;s2&#39;])</span><br></pre></td></tr></table></figure>

<p>zremrangebyrank(name, min, max)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># æ ¹æ®æ’è¡ŒèŒƒå›´åˆ é™¤</span><br></pre></td></tr></table></figure>

<p>zremrangebyscore(name, min, max)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># æ ¹æ®åˆ†æ•°èŒƒå›´åˆ é™¤</span><br></pre></td></tr></table></figure>

<p>zremrangebylex(name, min, max)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># æ ¹æ®å€¼è¿”å›åˆ é™¤</span><br></pre></td></tr></table></figure>

<p>zscore(name, value)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># è·å–nameå¯¹åº”æœ‰åºé›†åˆä¸­ value å¯¹åº”çš„åˆ†æ•°</span><br></pre></td></tr></table></figure>

<p>zinterstore(dest, keys, aggregate=None)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># è·å–ä¸¤ä¸ªæœ‰åºé›†åˆçš„äº¤é›†ï¼Œå¦‚æœé‡åˆ°ç›¸åŒå€¼ä¸åŒåˆ†æ•°ï¼Œåˆ™æŒ‰ç…§aggregateè¿›è¡Œæ“ä½œ</span><br><span class="line"># aggregateçš„å€¼ä¸º:  SUM  MIN  MAX</span><br></pre></td></tr></table></figure>

<p>zunionstore(dest, keys, aggregate=None)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># è·å–ä¸¤ä¸ªæœ‰åºé›†åˆçš„å¹¶é›†ï¼Œå¦‚æœé‡åˆ°ç›¸åŒå€¼ä¸åŒåˆ†æ•°ï¼Œåˆ™æŒ‰ç…§aggregateè¿›è¡Œæ“ä½œ</span><br><span class="line"># aggregateçš„å€¼ä¸º:  SUM  MIN  MAX</span><br></pre></td></tr></table></figure>

<p>zscan(name, cursor=0, match=None, count=None, score_cast_func=float)<br>zscan_iter(name, match=None, count=None,score_cast_func=float)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># åŒå­—ç¬¦ä¸²ç›¸ä¼¼ï¼Œç›¸è¾ƒäºå­—ç¬¦ä¸²æ–°å¢score_cast_funcï¼Œç”¨æ¥å¯¹åˆ†æ•°è¿›è¡Œæ“ä½œ</span><br></pre></td></tr></table></figure>

<h1 id="å…¶ä»–å¸¸ç”¨çš„æ“ä½œ"><a href="#å…¶ä»–å¸¸ç”¨çš„æ“ä½œ" class="headerlink" title="å…¶ä»–å¸¸ç”¨çš„æ“ä½œ"></a>å…¶ä»–å¸¸ç”¨çš„æ“ä½œ</h1><p>delete(*names)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># æ ¹æ®åˆ é™¤redisä¸­çš„ä»»æ„æ•°æ®ç±»å‹</span><br></pre></td></tr></table></figure>

<p>exists(name)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># æ£€æµ‹redisçš„nameæ˜¯å¦å­˜åœ¨</span><br></pre></td></tr></table></figure>

<p>keys(pattern=â€™*â€™)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># æ ¹æ®æ¨¡å‹è·å–redisçš„name</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"># æ›´å¤šï¼š</span><br><span class="line">    # KEYS * åŒ¹é…æ•°æ®åº“ä¸­æ‰€æœ‰ key ã€‚</span><br><span class="line">    # KEYS h?llo åŒ¹é… hello ï¼Œ hallo å’Œ hxllo ç­‰ã€‚</span><br><span class="line">    # KEYS h*llo åŒ¹é… hllo å’Œ heeeeello ç­‰ã€‚</span><br><span class="line">    # KEYS h[ae]llo åŒ¹é… hello å’Œ hallo ï¼Œä½†ä¸åŒ¹é… hillo</span><br></pre></td></tr></table></figure>
<p>expire(name ,time)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># ä¸ºæŸä¸ªredisçš„æŸä¸ªnameè®¾ç½®è¶…æ—¶æ—¶é—´</span><br></pre></td></tr></table></figure>

<p>rename(src, dst)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># å¯¹redisçš„nameé‡å‘½åä¸º</span><br></pre></td></tr></table></figure>

<p>move(name, db))</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># å°†redisçš„æŸä¸ªå€¼ç§»åŠ¨åˆ°æŒ‡å®šçš„dbä¸‹</span><br></pre></td></tr></table></figure>

<p>randomkey()</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># éšæœºè·å–ä¸€ä¸ªredisçš„nameï¼ˆä¸åˆ é™¤ï¼‰</span><br></pre></td></tr></table></figure>

<p>type(name)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># è·å–nameå¯¹åº”å€¼çš„ç±»å‹</span><br></pre></td></tr></table></figure>

<p>scan(cursor=0, match=None, count=None)<br>scan_iter(match=None, count=None)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># åŒå­—ç¬¦ä¸²æ“ä½œï¼Œç”¨äºå¢é‡è¿­ä»£è·å–key</span><br></pre></td></tr></table></figure>

<h1 id="ç®¡é“"><a href="#ç®¡é“" class="headerlink" title="ç®¡é“"></a>ç®¡é“</h1><p>redis-pyé»˜è®¤åœ¨æ‰§è¡Œæ¯æ¬¡è¯·æ±‚éƒ½ä¼šåˆ›å»ºï¼ˆè¿æ¥æ± ç”³è¯·è¿æ¥ï¼‰å’Œæ–­å¼€ï¼ˆå½’è¿˜è¿æ¥æ± ï¼‰ä¸€æ¬¡è¿æ¥æ“ä½œï¼Œå¦‚æœæƒ³è¦åœ¨ä¸€æ¬¡è¯·æ±‚ä¸­æŒ‡å®šå¤šä¸ªå‘½ä»¤ï¼Œåˆ™å¯ä»¥ä½¿ç”¨piplineå®ç°ä¸€æ¬¡è¯·æ±‚æŒ‡å®šå¤šä¸ªå‘½ä»¤ï¼Œå¹¶ä¸”é»˜è®¤æƒ…å†µä¸‹ä¸€æ¬¡pipline æ˜¯åŸå­æ€§æ“ä½œã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"> </span><br><span class="line">pool = redis.ConnectionPool(host=<span class="string">'10.211.55.4'</span>, port=<span class="number">6379</span>)</span><br><span class="line"> </span><br><span class="line">r = redis.Redis(connection_pool=pool)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># pipe = r.pipeline(transaction=False)</span></span><br><span class="line">pipe = r.pipeline(transaction=<span class="literal">True</span>)</span><br><span class="line"> </span><br><span class="line">r.set(<span class="string">'name'</span>, <span class="string">'alex'</span>)</span><br><span class="line">r.set(<span class="string">'role'</span>, <span class="string">'sb'</span>)</span><br><span class="line"> </span><br><span class="line">pipe.execute()</span><br></pre></td></tr></table></figure>

<h1 id="å‘å¸ƒè®¢é˜…"><a href="#å‘å¸ƒè®¢é˜…" class="headerlink" title="å‘å¸ƒè®¢é˜…"></a>å‘å¸ƒè®¢é˜…</h1><p>å‘å¸ƒè€…ï¼šæœåŠ¡å™¨</p>
<p>è®¢é˜…è€…ï¼šDashboadå’Œæ•°æ®å¤„ç†</p>
<p>Demoå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RedisHelper</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.__conn = redis.Redis(host=<span class="string">'10.211.55.4'</span>)</span><br><span class="line">        self.chan_sub = <span class="string">'fm104.5'</span></span><br><span class="line">        self.chan_pub = <span class="string">'fm104.5'</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">public</span><span class="params">(self, msg)</span>:</span></span><br><span class="line">        self.__conn.publish(self.chan_pub, msg)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">subscribe</span><span class="params">(self)</span>:</span></span><br><span class="line">        pub = self.__conn.pubsub()</span><br><span class="line">        pub.subscribe(self.chan_sub)</span><br><span class="line">        pub.parse_response()</span><br><span class="line">        <span class="keyword">return</span> pub</span><br></pre></td></tr></table></figure>

<p>è®¢é˜…è€…ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">from</span> monitor.RedisHelper <span class="keyword">import</span> RedisHelper</span><br><span class="line"> </span><br><span class="line">obj = RedisHelper()</span><br><span class="line">redis_sub = obj.subscribe()</span><br><span class="line"> </span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    msg= redis_sub.parse_response()</span><br><span class="line">    <span class="keyword">print</span> msg</span><br></pre></td></tr></table></figure>

<p>å‘å¸ƒè€…ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">from</span> monitor.RedisHelper <span class="keyword">import</span> RedisHelper</span><br><span class="line"> </span><br><span class="line">obj = RedisHelper()</span><br><span class="line">obj.public(<span class="string">'hello'</span>)</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>redis</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonæ“ä½œmemcacheè¯¦è§£</title>
    <url>/2016/07/24/Python%E6%93%8D%E4%BD%9Cmemcache%E8%AF%A6%E8%A7%A3/</url>
    <content><![CDATA[<blockquote>
<p>Memcached æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„åˆ†å¸ƒå¼å†…å­˜å¯¹è±¡ç¼“å­˜ç³»ç»Ÿï¼Œç”¨äºåŠ¨æ€Webåº”ç”¨ä»¥å‡è½»æ•°æ®åº“è´Ÿè½½ã€‚å®ƒé€šè¿‡åœ¨å†…å­˜ä¸­ç¼“å­˜æ•°æ®å’Œå¯¹è±¡æ¥å‡å°‘è¯»å–æ•°æ®åº“çš„æ¬¡æ•°ï¼Œä»è€Œæé«˜åŠ¨æ€ã€æ•°æ®åº“é©±åŠ¨ç½‘ç«™çš„é€Ÿåº¦ã€‚MemcachedåŸºäºä¸€ä¸ªå­˜å‚¨é”®/å€¼å¯¹çš„hashmapã€‚å…¶å®ˆæŠ¤è¿›ç¨‹ï¼ˆdaemonï¼‰æ˜¯ç”¨Cå†™çš„ï¼Œä½†æ˜¯å®¢æˆ·ç«¯å¯ä»¥ç”¨ä»»ä½•è¯­è¨€æ¥ç¼–å†™ï¼Œå¹¶é€šè¿‡memcachedåè®®ä¸å®ˆæŠ¤è¿›ç¨‹é€šä¿¡</p>
</blockquote>
<h1 id="memcacheçš„åŸºæœ¬ä½¿ç”¨"><a href="#memcacheçš„åŸºæœ¬ä½¿ç”¨" class="headerlink" title="memcacheçš„åŸºæœ¬ä½¿ç”¨"></a>memcacheçš„åŸºæœ¬ä½¿ç”¨</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> memcache</span><br><span class="line"></span><br><span class="line">mc = memcache.Client([<span class="string">'123.57.233.233:11211'</span>], debug=<span class="literal">True</span>)</span><br><span class="line">mc.set(<span class="string">"Name"</span>, <span class="string">"PolarSnow"</span>)</span><br><span class="line">ret = mc.get(<span class="string">'Name'</span>)</span><br><span class="line">print(ret)</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">PolarSnow</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„:debug = True è¡¨ç¤ºè¿è¡Œå‡ºç°é”™è¯¯æ—¶ï¼Œæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ï¼Œä¸Šçº¿åç§»é™¤è¯¥å‚æ•°</p>
<h1 id="å¤©ç”Ÿæ”¯æŒé›†ç¾¤"><a href="#å¤©ç”Ÿæ”¯æŒé›†ç¾¤" class="headerlink" title="å¤©ç”Ÿæ”¯æŒé›†ç¾¤"></a>å¤©ç”Ÿæ”¯æŒé›†ç¾¤</h1><table>
<thead>
<tr>
<th>ä¸»æœº</th>
<th>æƒé‡</th>
</tr>
</thead>
<tbody><tr>
<td>1.1.1.1</td>
<td>1</td>
</tr>
<tr>
<td>1.1.1.2</td>
<td>2</td>
</tr>
<tr>
<td>1.1.1.3</td>
<td>1</td>
</tr>
</tbody></table>
<p>é‚£ä¹ˆåœ¨å†…å­˜ä¸­ä¸»æœºåˆ—è¡¨ä¸ºï¼š<code>host_list = [&quot;1.1.1.1&quot;, &quot;1.1.1.2&quot;, &quot;1.1.1.2&quot;, &quot;1.1.1.3&quot;, ]</code></p>
<p>å¦‚æœç”¨æˆ·æ ¹æ®å¦‚æœè¦åœ¨å†…å­˜ä¸­åˆ›å»ºä¸€ä¸ªé”®å€¼å¯¹ï¼ˆå¦‚ï¼šk1 = â€œv1â€ï¼‰ï¼Œé‚£ä¹ˆè¦æ‰§è¡Œä¸€ä¸‹æ­¥éª¤ï¼š</p>
<p>æ ¹æ®ç®—æ³•å°† k1 è½¬æ¢æˆä¸€ä¸ªæ•°å­—</p>
<p>å°†æ•°å­—å’Œä¸»æœºåˆ—è¡¨é•¿åº¦æ±‚ä½™æ•°ï¼Œå¾—åˆ°ä¸€ä¸ªå€¼ Nï¼ˆ 0 &lt;= N &lt; åˆ—è¡¨é•¿åº¦ ï¼‰<br>åœ¨ä¸»æœºåˆ—è¡¨ä¸­æ ¹æ® ç¬¬2æ­¥å¾—åˆ°çš„å€¼ä¸ºç´¢å¼•è·å–ä¸»æœºï¼Œä¾‹å¦‚ï¼šhost_list[N]<br>è¿æ¥ å°†ç¬¬3æ­¥ä¸­è·å–çš„ä¸»æœºï¼Œå°† k1 = â€œv1â€ æ”¾ç½®åœ¨è¯¥æœåŠ¡å™¨çš„å†…å­˜ä¸­<br>ä»£ç å®ç°å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">mc = memcache.Client([(<span class="string">'1.1.1.1:12000'</span>, <span class="number">1</span>), (<span class="string">'1.1.1.2:12000'</span>, <span class="number">2</span>), (<span class="string">'1.1.1.3:12000'</span>, <span class="number">1</span>)], debug=<span class="literal">True</span>)</span><br><span class="line"> </span><br><span class="line">mc.set(<span class="string">'k1'</span>, <span class="string">'v1'</span>)</span><br></pre></td></tr></table></figure>

<h1 id="add"><a href="#add" class="headerlink" title="add"></a>add</h1><p>æ·»åŠ ä¸€æ¡é”®å€¼å¯¹ï¼Œå¦‚æœå·²ç»å­˜åœ¨çš„ keyï¼Œé‡å¤æ‰§è¡Œaddæ“ä½œå¼‚å¸¸</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> memcache</span><br><span class="line"> </span><br><span class="line">mc = memcache.Client([<span class="string">'10.211.55.4:12000'</span>], debug=<span class="literal">True</span>)</span><br><span class="line">mc.add(<span class="string">'k1'</span>, <span class="string">'v1'</span>)</span><br><span class="line"><span class="comment"># mc.add('k1', 'v2') # æŠ¥é”™ï¼Œå¯¹å·²ç»å­˜åœ¨çš„keyé‡å¤æ·»åŠ ï¼Œå¤±è´¥ï¼ï¼ï¼</span></span><br></pre></td></tr></table></figure>

<h1 id="replace"><a href="#replace" class="headerlink" title="replace"></a>replace</h1><p>replace ä¿®æ”¹æŸä¸ªkeyçš„å€¼ï¼Œå¦‚æœkeyä¸å­˜åœ¨ï¼Œåˆ™å¼‚å¸¸</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> memcache</span><br><span class="line"> </span><br><span class="line">mc = memcache.Client([<span class="string">'10.211.55.4:12000'</span>], debug=<span class="literal">True</span>)</span><br><span class="line"><span class="comment"># å¦‚æœmemcacheä¸­å­˜åœ¨kkkkï¼Œåˆ™æ›¿æ¢æˆåŠŸï¼Œå¦åˆ™ä¸€åœº</span></span><br><span class="line">mc.replace(<span class="string">'kkkk'</span>,<span class="string">'999'</span>)</span><br></pre></td></tr></table></figure>

<h1 id="set-å’Œ-set-multi"><a href="#set-å’Œ-set-multi" class="headerlink" title="set å’Œ set_multi"></a>set å’Œ set_multi</h1><p>set            è®¾ç½®ä¸€ä¸ªé”®å€¼å¯¹ï¼Œå¦‚æœkeyä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºï¼Œå¦‚æœkeyå­˜åœ¨ï¼Œåˆ™ä¿®æ”¹<br>set_multi   è®¾ç½®å¤šä¸ªé”®å€¼å¯¹ï¼Œå¦‚æœkeyä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºï¼Œå¦‚æœkeyå­˜åœ¨ï¼Œåˆ™ä¿®æ”¹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> memcache</span><br><span class="line"> </span><br><span class="line">mc = memcache.Client([<span class="string">'10.211.55.4:12000'</span>], debug=<span class="literal">True</span>)</span><br><span class="line"> </span><br><span class="line">mc.set(<span class="string">'key0'</span>, <span class="string">'wupeiqi'</span>)</span><br><span class="line"> </span><br><span class="line">mc.set_multi(&#123;<span class="string">'key1'</span>: <span class="string">'val1'</span>, <span class="string">'key2'</span>: <span class="string">'val2'</span>&#125;)</span><br></pre></td></tr></table></figure>

<h1 id="delete-å’Œ-delete-multi"><a href="#delete-å’Œ-delete-multi" class="headerlink" title="delete å’Œ delete_multi"></a>delete å’Œ delete_multi</h1><p>delete             åœ¨Memcachedä¸­åˆ é™¤æŒ‡å®šçš„ä¸€ä¸ªé”®å€¼å¯¹<br>delete_multi    åœ¨Memcachedä¸­åˆ é™¤æŒ‡å®šçš„å¤šä¸ªé”®å€¼å¯¹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> memcache</span><br><span class="line"> </span><br><span class="line">mc = memcache.Client([<span class="string">'10.211.55.4:12000'</span>], debug=<span class="literal">True</span>)</span><br><span class="line"> </span><br><span class="line">mc.delete(<span class="string">'key0'</span>)</span><br><span class="line">mc.delete_multi([<span class="string">'key1'</span>, <span class="string">'key2'</span>])</span><br></pre></td></tr></table></figure>

<h1 id="get-å’Œ-get-multi"><a href="#get-å’Œ-get-multi" class="headerlink" title="get å’Œ get_multi"></a>get å’Œ get_multi</h1><p>get            è·å–ä¸€ä¸ªé”®å€¼å¯¹<br>get_multi   è·å–å¤šä¸€ä¸ªé”®å€¼å¯¹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> memcache</span><br><span class="line"> </span><br><span class="line">mc = memcache.Client([<span class="string">'10.211.55.4:12000'</span>], debug=<span class="literal">True</span>)</span><br><span class="line"> </span><br><span class="line">val = mc.get(<span class="string">'key0'</span>)</span><br><span class="line">item_dict = mc.get_multi([<span class="string">"key1"</span>, <span class="string">"key2"</span>, <span class="string">"key3"</span>])</span><br></pre></td></tr></table></figure>

<h1 id="append-å’Œ-prepend"><a href="#append-å’Œ-prepend" class="headerlink" title="append å’Œ prepend"></a>append å’Œ prepend</h1><p>append    ä¿®æ”¹æŒ‡å®škeyçš„å€¼ï¼Œåœ¨è¯¥å€¼ åé¢ è¿½åŠ å†…å®¹<br>prepend   ä¿®æ”¹æŒ‡å®škeyçš„å€¼ï¼Œåœ¨è¯¥å€¼ å‰é¢ æ’å…¥å†…å®¹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> memcache</span><br><span class="line"> </span><br><span class="line">mc = memcache.Client([<span class="string">'10.211.55.4:12000'</span>], debug=<span class="literal">True</span>)</span><br><span class="line"><span class="comment"># k1 = "v1"</span></span><br><span class="line"> </span><br><span class="line">mc.append(<span class="string">'k1'</span>, <span class="string">'after'</span>)</span><br><span class="line"><span class="comment"># k1 = "v1after"</span></span><br><span class="line"> </span><br><span class="line">mc.prepend(<span class="string">'k1'</span>, <span class="string">'before'</span>)</span><br><span class="line"><span class="comment"># k1 = "beforev1after"</span></span><br></pre></td></tr></table></figure>

<h1 id="decr-å’Œ-incr"><a href="#decr-å’Œ-incr" class="headerlink" title="decr å’Œ incrã€€ã€€"></a>decr å’Œ incrã€€ã€€</h1><p>incr  è‡ªå¢ï¼Œå°†Memcachedä¸­çš„æŸä¸€ä¸ªå€¼å¢åŠ  N ï¼ˆ Né»˜è®¤ä¸º1 ï¼‰<br>decr è‡ªå‡ï¼Œå°†Memcachedä¸­çš„æŸä¸€ä¸ªå€¼å‡å°‘ N ï¼ˆ Né»˜è®¤ä¸º1 ï¼‰</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> memcache</span><br><span class="line"> </span><br><span class="line">mc = memcache.Client([<span class="string">'10.211.55.4:12000'</span>], debug=<span class="literal">True</span>)</span><br><span class="line">mc.set(<span class="string">'k1'</span>, <span class="string">'777'</span>)</span><br><span class="line"> </span><br><span class="line">mc.incr(<span class="string">'k1'</span>)</span><br><span class="line"><span class="comment"># k1 = 778</span></span><br><span class="line"> </span><br><span class="line">mc.incr(<span class="string">'k1'</span>, <span class="number">10</span>)</span><br><span class="line"><span class="comment"># k1 = 788</span></span><br><span class="line"> </span><br><span class="line">mc.decr(<span class="string">'k1'</span>)</span><br><span class="line"><span class="comment"># k1 = 787</span></span><br><span class="line"> </span><br><span class="line">mc.decr(<span class="string">'k1'</span>, <span class="number">10</span>)</span><br><span class="line"><span class="comment"># k1 = 777</span></span><br></pre></td></tr></table></figure>

<h1 id="gets-å’Œ-cas"><a href="#gets-å’Œ-cas" class="headerlink" title="gets å’Œ cas"></a>gets å’Œ cas</h1><p>é¿å…äº§ç”Ÿè„æ•°æ®,getså’Œcasæˆå¯¹å„¿å‡ºç°ï¼Œå‡ºç°ç¬¬äºŒä¸ªcasçš„æ—¶å€™ä¼šæŠ¥é”™</p>
<p>å¦‚å•†åŸå•†å“å‰©ä½™ä¸ªæ•°ï¼Œå‡è®¾æ”¹å€¼ä¿å­˜åœ¨memcacheä¸­ï¼Œproduct_count = 900<br>Aç”¨æˆ·åˆ·æ–°é¡µé¢ä»memcacheä¸­è¯»å–åˆ°product_count = 900<br>Bç”¨æˆ·åˆ·æ–°é¡µé¢ä»memcacheä¸­è¯»å–åˆ°product_count = 900</p>
<p>å¦‚æœAã€Bç”¨æˆ·å‡è´­ä¹°å•†å“</p>
<p>Aç”¨æˆ·ä¿®æ”¹å•†å“å‰©ä½™ä¸ªæ•° product_countï¼899<br>Bç”¨æˆ·ä¿®æ”¹å•†å“å‰©ä½™ä¸ªæ•° product_countï¼899</p>
<p>å¦‚æ­¤ä¸€æ¥ç¼“å­˜å†…çš„æ•°æ®ä¾¿ä¸åœ¨æ­£ç¡®ï¼Œä¸¤ä¸ªç”¨æˆ·è´­ä¹°å•†å“åï¼Œå•†å“å‰©ä½™è¿˜æ˜¯ 899<br>å¦‚æœä½¿ç”¨pythonçš„setå’Œgetæ¥æ“ä½œä»¥ä¸Šè¿‡ç¨‹ï¼Œé‚£ä¹ˆç¨‹åºå°±ä¼šå¦‚ä¸Šè¿°æ‰€ç¤ºæƒ…å†µï¼</p>
<p>å¦‚æœæƒ³è¦é¿å…æ­¤æƒ…å†µçš„å‘ç”Ÿï¼Œåªè¦ä½¿ç”¨ gets å’Œ cas å³å¯ï¼Œå¦‚ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> memcache</span><br><span class="line">mc = memcache.Client([<span class="string">'10.211.55.4:12000'</span>], debug=<span class="literal">True</span>, cache_cas=<span class="literal">True</span>)</span><br><span class="line"> </span><br><span class="line">v = mc.gets(<span class="string">'product_count'</span>)</span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"><span class="comment"># å¦‚æœæœ‰äººåœ¨getsä¹‹åå’Œcasä¹‹å‰ä¿®æ”¹äº†product_countï¼Œé‚£ä¹ˆï¼Œä¸‹é¢çš„è®¾ç½®å°†ä¼šæ‰§è¡Œå¤±è´¥ï¼Œå‰–å‡ºå¼‚å¸¸ï¼Œä»è€Œé¿å…éæ­£å¸¸æ•°æ®çš„äº§ç”Ÿ</span></span><br><span class="line">mc.cas(<span class="string">'product_count'</span>, <span class="string">"899"</span>)</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼šæœ¬è´¨ä¸Šæ¯æ¬¡æ‰§è¡Œgetsæ—¶ï¼Œä¼šä»memcacheä¸­è·å–ä¸€ä¸ªè‡ªå¢çš„æ•°å­—ï¼Œé€šè¿‡caså»ä¿®æ”¹getsçš„å€¼æ—¶ï¼Œä¼šæºå¸¦ä¹‹å‰è·å–çš„è‡ªå¢å€¼å’Œmemcacheä¸­çš„è‡ªå¢å€¼è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœç›¸ç­‰ï¼Œåˆ™å¯ä»¥æäº¤ï¼Œå¦‚æœä¸ç›¸ç­‰ï¼Œé‚£è¡¨ç¤ºåœ¨getså’Œcasæ‰§è¡Œä¹‹é—´ï¼Œåˆæœ‰å…¶ä»–äººæ‰§è¡Œäº†getsï¼ˆè·å–äº†ç¼“å†²çš„æŒ‡å®šå€¼ï¼‰ï¼Œ å¦‚æ­¤ä¸€æ¥æœ‰å¯èƒ½å‡ºç°éæ­£å¸¸æ•°æ®ï¼Œåˆ™ä¸å…è®¸ä¿®æ”¹</p>
<h1 id="memcacheé›†ç¾¤ä¸­å‰”é™¤æ‰ä¸å¯ç”¨èŠ‚ç‚¹"><a href="#memcacheé›†ç¾¤ä¸­å‰”é™¤æ‰ä¸å¯ç”¨èŠ‚ç‚¹" class="headerlink" title="memcacheé›†ç¾¤ä¸­å‰”é™¤æ‰ä¸å¯ç”¨èŠ‚ç‚¹"></a>memcacheé›†ç¾¤ä¸­å‰”é™¤æ‰ä¸å¯ç”¨èŠ‚ç‚¹</h1><p>å¿…é¡»åœ¨ç¨‹åºä¸­å»æ£€æµ‹åç«¯çš„å¯ç”¨çŠ¶æ€ï¼Œå½“æœ‰æœåŠ¡å™¨å‡ºç°æœåŠ¡ä¸å¯ç”¨æ—¶ï¼Œæ‰§è¡Œ<code>mc.set_servers()</code>é‡æ–°è®¾ç½®é›†ç¾¤æœåŠ¡å™¨åˆ—è¡¨</p>
<hr>
<p>è½¬è½½æ–‡æ¡£ï¼š</p>
<p><a href="http://www.cnblogs.com/wupeiqi/articles/5132791.html" target="_blank" rel="noopener">http://www.cnblogs.com/wupeiqi/articles/5132791.html</a></p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>memcache</tag>
        <tag>python-memcached</tag>
        <tag>api</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonä¸­çš„åç¨‹</title>
    <url>/2016/07/24/Python%E4%B8%AD%E7%9A%84%E5%8D%8F%E7%A8%8B/</url>
    <content><![CDATA[<blockquote>
<p>çº¿ç¨‹å’Œè¿›ç¨‹çš„æ“ä½œæ˜¯ç”±ç¨‹åºè§¦å‘ç³»ç»Ÿæ¥å£ï¼Œæœ€åçš„æ‰§è¡Œè€…æ˜¯ç³»ç»Ÿï¼›åç¨‹çš„æ“ä½œåˆ™æ˜¯ç¨‹åºå‘˜</p>
</blockquote>
<p>åç¨‹å­˜åœ¨çš„æ„ä¹‰ï¼šå¯¹äºå¤šçº¿ç¨‹åº”ç”¨ï¼ŒCPUé€šè¿‡åˆ‡ç‰‡çš„æ–¹å¼æ¥åˆ‡æ¢çº¿ç¨‹é—´çš„æ‰§è¡Œï¼Œçº¿ç¨‹åˆ‡æ¢æ—¶éœ€è¦è€—æ—¶ï¼ˆä¿å­˜çŠ¶æ€ï¼Œä¸‹æ¬¡ç»§ç»­ï¼‰ã€‚åç¨‹ï¼Œåˆ™åªä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹ï¼Œåœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­è§„å®šæŸä¸ªä»£ç å—æ‰§è¡Œé¡ºåºã€‚</p>
<p>åç¨‹çš„é€‚ç”¨åœºæ™¯ï¼šå½“ç¨‹åºä¸­å­˜åœ¨å¤§é‡ä¸éœ€è¦CPUçš„æ“ä½œæ—¶ï¼ˆIOï¼‰ï¼Œé€‚ç”¨äºåç¨‹</p>
<h1 id="greenlet"><a href="#greenlet" class="headerlink" title="greenlet"></a>greenlet</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> greenlet <span class="keyword">import</span> greenlet</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test1</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="number">12</span>)</span><br><span class="line">    gr2.switch()</span><br><span class="line">    print(<span class="number">34</span>)</span><br><span class="line">    gr2.switch()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test2</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="number">56</span>)</span><br><span class="line">    gr1.switch()</span><br><span class="line">    print(<span class="number">78</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">gr1 = greenlet(test1)</span><br><span class="line">gr2 = greenlet(test2)</span><br><span class="line">gr1.switch()</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line"><span class="number">12</span></span><br><span class="line"><span class="number">56</span></span><br><span class="line"><span class="number">34</span></span><br><span class="line"><span class="number">78</span></span><br></pre></td></tr></table></figure>

<p>ä»£ç ä»ä¸Šä¹‹ä¸‹æ‰§è¡Œ</p>
<ul>
<li>è¿è¡Œåˆ°ç¬¬19è¡Œæ—¶ï¼Œæ‰§è¡Œgr1.switch()ï¼Œæ‰§è¡Œtest1æ–¹æ³•ï¼Œä»£ç è·³åˆ°ç¬¬5è¡Œï¼Œæ‰“å°12</li>
<li>æ¥ç€ä»£ç è¿è¡Œåˆ°ç¬¬6è¡Œï¼Œæ‰§è¡Œgr2.switch()ï¼Œæ‰§è¡Œtest2æ–¹æ³•ï¼Œä»£ç è·³åˆ°ç¬¬12è¡Œï¼Œæ‰“å°56</li>
<li>æ¥ç€ä»£ç è¿è¡Œåˆ°ç¬¬13è¡Œï¼Œæ‰§è¡Œgr1.switch()ï¼Œç»§ç»­æ‰§è¡Œtest1æ–¹æ³•ï¼Œä»£ç è·³åˆ°äº†ç¬¬7è¡Œï¼Œæ‰“å°34</li>
<li>æ¥ç€ä»£ç è¿è¡Œåˆ°ç¬¬8è¡Œï¼Œæ‰§è¡Œgr2.switch()ï¼Œç»§ç»­æ‰§è¡Œtest2æ–¹æ³•ï¼Œæ‰“å°78</li>
</ul>
<h1 id="gevent"><a href="#gevent" class="headerlink" title="gevent"></a>gevent</h1><p>geventæ˜¯greenletçš„æ›´é«˜å±‚æ¬¡çš„å°è£…</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> gevent</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'Running in foo'</span>)</span><br><span class="line">    gevent.sleep(<span class="number">0</span>)</span><br><span class="line">    print(<span class="string">'Explicit context switch to foo again'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bar</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'Explicit context to bar'</span>)</span><br><span class="line">    gevent.sleep(<span class="number">0</span>)</span><br><span class="line">    print(<span class="string">'Implicit context switch back to bar'</span>)</span><br><span class="line"></span><br><span class="line">gevent.joinall([</span><br><span class="line">    gevent.spawn(foo),</span><br><span class="line">    gevent.spawn(bar),</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">Running <span class="keyword">in</span> foo</span><br><span class="line">Explicit context to bar</span><br><span class="line">Explicit context switch to foo again</span><br><span class="line">Implicit context switch back to bar</span><br></pre></td></tr></table></figure>

<p>åœ¨<code>gevent</code>ä¸­ï¼Œå½“é‡åˆ°<code>gevent.sleep(0)</code>æ—¶ï¼Œå°±è‡ªåŠ¨åˆ‡æ¢åˆ°å…¶ä»–çš„æ–¹æ³•ä¸­å»ç»§ç»­æ‰§è¡Œ</p>
<h1 id="åç¨‹å®ä¾‹"><a href="#åç¨‹å®ä¾‹" class="headerlink" title="åç¨‹å®ä¾‹"></a>åç¨‹å®ä¾‹</h1><p>å½“ä¸€ä¸ªgreenleté‡åˆ°IOæ“ä½œæ—¶ï¼Œæ¯”å¦‚è®¿é—®ç½‘ç»œï¼Œå°±è‡ªåŠ¨åˆ‡æ¢åˆ°å…¶ä»–çš„greenletï¼Œç­‰åˆ°IOæ“ä½œå®Œæˆï¼Œå†åœ¨é€‚å½“çš„æ—¶å€™åˆ‡æ¢å›æ¥ç»§ç»­æ‰§è¡Œã€‚</p>
<p>ç”±äºIOæ“ä½œéå¸¸è€—æ—¶ï¼Œç»å¸¸ä½¿ç¨‹åºå¤„äºç­‰å¾…çŠ¶æ€ï¼Œæœ‰äº†geventä¸ºæˆ‘ä»¬è‡ªåŠ¨åˆ‡æ¢åç¨‹ï¼Œå°±ä¿è¯æ€»æœ‰greenletåœ¨è¿è¡Œï¼Œè€Œä¸æ˜¯ç­‰å¾…IOã€‚</p>
<p>ç”±äºåˆ‡æ¢æ˜¯åœ¨IOæ“ä½œæ—¶è‡ªåŠ¨å®Œæˆï¼Œæ‰€ä»¥geventéœ€è¦ä¿®æ”¹Pythonè‡ªå¸¦çš„ä¸€äº›æ ‡å‡†åº“ï¼Œè¿™ä¸€è¿‡ç¨‹åœ¨å¯åŠ¨æ—¶é€šè¿‡monkey patchå®Œæˆ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> gevent <span class="keyword">import</span> monkey; monkey.patch_all()</span><br><span class="line"><span class="keyword">import</span> gevent</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(url)</span>:</span></span><br><span class="line">    print(<span class="string">'GET: %s'</span> % url)</span><br><span class="line">    resp = requests.get(url)</span><br><span class="line">    data = resp.text</span><br><span class="line">    print(<span class="string">'%d bytes received from %s.'</span> % (len(data), url))</span><br><span class="line"></span><br><span class="line">gevent.joinall([</span><br><span class="line">        gevent.spawn(func, <span class="string">'https://www.baidu.com/'</span>),</span><br><span class="line">        gevent.spawn(func, <span class="string">'http://docs.20150509.cn/'</span>),</span><br><span class="line">        gevent.spawn(func, <span class="string">'http://www.20150509.cn/'</span>),</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">GET: https://www.baidu.com/</span><br><span class="line">GET: http://docs<span class="number">.20150509</span>.cn/</span><br><span class="line">GET: http://www<span class="number">.20150509</span>.cn/</span><br><span class="line"><span class="number">1314</span> bytes received <span class="keyword">from</span> http://www<span class="number">.20150509</span>.cn/.</span><br><span class="line"><span class="number">227</span> bytes received <span class="keyword">from</span> https://www.baidu.com/.</span><br><span class="line"><span class="number">37491</span> bytes received <span class="keyword">from</span> http://docs<span class="number">.20150509</span>.cn/.</span><br></pre></td></tr></table></figure>

<p>é‡åˆ°IOæ“ä½œè‡ªåŠ¨åˆ‡æ¢</p>
<p><code>gevent.joinall</code>å†…éƒ¨è‡ªå¸¦<code>forå¾ªç¯</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> gevent <span class="keyword">import</span> monkey; monkey.patch_all()</span><br><span class="line"><span class="keyword">import</span> gevent</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(url)</span>:</span></span><br><span class="line">    print(<span class="string">'GET: %s'</span> % url)</span><br><span class="line">    resp = requests.get(url)</span><br><span class="line">    data = resp.text</span><br><span class="line">    print(<span class="string">'%d bytes received from %s.'</span> % (len(data), url))</span><br><span class="line"></span><br><span class="line">urls = [<span class="string">'https://www.baidu.com/'</span>, <span class="string">'http://docs.20150509.cn/'</span>, <span class="string">'http://www.20150509.cn/'</span>]</span><br><span class="line">glist = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(urls)):</span><br><span class="line">    glist.append(gevent.spawn(func, urls[i]))</span><br><span class="line">print(glist)</span><br><span class="line">gevent.joinall(glist)</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">[&lt;Greenlet at <span class="number">0x103396470</span>: func(<span class="string">'https://www.baidu.com/'</span>)&gt;, &lt;Greenlet at <span class="number">0x103396638</span>: func(<span class="string">'http://docs.20150509.cn/'</span>)&gt;, &lt;Greenlet at <span class="number">0x103396768</span>: func(<span class="string">'http://www.20150509.cn/'</span>)&gt;]</span><br><span class="line">GET: https://www.baidu.com/</span><br><span class="line">GET: http://docs<span class="number">.20150509</span>.cn/</span><br><span class="line">GET: http://www<span class="number">.20150509</span>.cn/</span><br><span class="line"><span class="number">1314</span> bytes received <span class="keyword">from</span> http://www<span class="number">.20150509</span>.cn/.</span><br><span class="line"><span class="number">227</span> bytes received <span class="keyword">from</span> https://www.baidu.com/.</span><br><span class="line"><span class="number">37491</span> bytes received <span class="keyword">from</span> http://docs<span class="number">.20150509</span>.cn/.</span><br></pre></td></tr></table></figure>

<h1 id="åç¨‹çš„ä½¿ç”¨åœºæ™¯"><a href="#åç¨‹çš„ä½¿ç”¨åœºæ™¯" class="headerlink" title="åç¨‹çš„ä½¿ç”¨åœºæ™¯"></a>åç¨‹çš„ä½¿ç”¨åœºæ™¯</h1><ul>
<li>çˆ¬è™«</li>
<li>URLç›‘æ§</li>
</ul>
<hr>
<p>å‚è€ƒæ–‡æ¡£ï¼š</p>
<p><a href="http://www.3lian.com/edu/2015/04-30/209255.html" target="_blank" rel="noopener">http://www.3lian.com/edu/2015/04-30/209255.html</a></p>
<p><a href="http://www.cnblogs.com/wupeiqi/articles/5040827.html" target="_blank" rel="noopener">http://www.cnblogs.com/wupeiqi/articles/5040827.html</a></p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>åç¨‹</tag>
        <tag>greenlet</tag>
        <tag>gevent</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonä¸­çš„è¿›ç¨‹æ± </title>
    <url>/2016/07/24/Python%E4%B8%AD%E7%9A%84%E8%BF%9B%E7%A8%8B%E6%B1%A0/</url>
    <content><![CDATA[<blockquote>
<p>è¿›ç¨‹æ± å†…éƒ¨ç»´æŠ¤ä¸€ä¸ªè¿›ç¨‹åºåˆ—ï¼Œå½“ä½¿ç”¨æ—¶ï¼Œåˆ™å»è¿›ç¨‹æ± ä¸­è·å–ä¸€ä¸ªè¿›ç¨‹ï¼Œå¦‚æœè¿›ç¨‹æ± åºåˆ—ä¸­æ²¡æœ‰å¯ä¾›ä½¿ç”¨çš„è¿›è¿›ç¨‹ï¼Œé‚£ä¹ˆç¨‹åºå°±ä¼šç­‰å¾…ï¼Œç›´åˆ°è¿›ç¨‹æ± ä¸­æœ‰å¯ç”¨è¿›ç¨‹ä¸ºæ­¢ã€‚</p>
</blockquote>
<p>è¿›ç¨‹æ± ä¸­çš„å‡½æ•°ï¼š</p>
<ul>
<li>apply_async(func[, args[, kwds[, callback]]]) å®ƒæ˜¯éé˜»å¡ï¼Œapply(func[, args[, kwds]])æ˜¯é˜»å¡çš„</li>
<li>close()    å…³é—­poolï¼Œä½¿å…¶ä¸åœ¨æ¥å—æ–°çš„ä»»åŠ¡ã€‚</li>
<li>terminate()    ç»“æŸå·¥ä½œè¿›ç¨‹ï¼Œä¸åœ¨å¤„ç†æœªå®Œæˆçš„ä»»åŠ¡ã€‚</li>
<li>join()    ä¸»è¿›ç¨‹é˜»å¡ï¼Œç­‰å¾…å­è¿›ç¨‹çš„é€€å‡ºï¼Œ joinæ–¹æ³•è¦åœ¨closeæˆ–terminateä¹‹åä½¿ç”¨ã€‚</li>
</ul>
<h1 id="ä½¿ç”¨è¿›ç¨‹æ± "><a href="#ä½¿ç”¨è¿›ç¨‹æ± " class="headerlink" title="ä½¿ç”¨è¿›ç¨‹æ± "></a>ä½¿ç”¨è¿›ç¨‹æ± </h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">function</span><span class="params">(arg)</span>:</span></span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    print(arg)</span><br><span class="line"></span><br><span class="line">pool = Pool(<span class="number">5</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">16</span>):</span><br><span class="line">    <span class="comment"># pool.apply(func=function, args=(i,))</span></span><br><span class="line">    pool.apply_async(func=function, args=(i,))</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šä»£ç æ²¡æœ‰ä»»ä½•è¿”å›å°±ç«‹å³é€€å‡ºäº†</p>
<p>å› ä¸ºä¸»è¿›ç¨‹æ²¡æœ‰é˜»å¡ï¼Œæ²¡æœ‰ç­‰å¾…å­è¿›ç¨‹æ‰§è¡Œå®Œæ¯•å°±é€€å‡ºäº†ç¨‹åº</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">function</span><span class="params">(arg)</span>:</span></span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    print(arg)</span><br><span class="line"></span><br><span class="line">pool = Pool(<span class="number">5</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">16</span>):</span><br><span class="line">    <span class="comment"># pool.apply(func=function, args=(i,))</span></span><br><span class="line">    pool.apply_async(func=function, args=(i,))</span><br><span class="line"></span><br><span class="line">pool.close()</span><br><span class="line">pool.join()  <span class="comment"># è°ƒç”¨joinä¹‹å‰ï¼Œå…ˆè°ƒç”¨closeå‡½æ•°ï¼Œå¦åˆ™ä¼šå‡ºé”™ã€‚æ‰§è¡Œå®Œcloseåä¸ä¼šæœ‰æ–°çš„è¿›ç¨‹åŠ å…¥åˆ°pool,joinå‡½æ•°ç­‰å¾…æ‰€æœ‰å­è¿›ç¨‹ç»“æŸ</span></span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">9</span></span><br><span class="line"><span class="number">7</span></span><br><span class="line"><span class="number">6</span></span><br><span class="line"><span class="number">8</span></span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="number">10</span></span><br><span class="line"><span class="number">13</span></span><br><span class="line"><span class="number">12</span></span><br><span class="line"><span class="number">14</span></span><br><span class="line"><span class="number">11</span></span><br><span class="line"><span class="number">15</span></span><br></pre></td></tr></table></figure>

<p><code>join()</code>ä¹‹å‰å¿…é¡»ç­‰å¾…<code>æ‰€æœ‰çš„å­è¿›ç¨‹æ‰§è¡Œå®Œæ¯•</code></p>
<p>è€Œç­‰å¾…å­è¿›ç¨‹æ‰§è¡Œå®Œæ¯•æœ‰ä¸¤ç§æ–¹æ³•ï¼Œä¸€ç§æ˜¯ä¸Šé¢çš„<code>close</code>æ–¹æ³•ï¼Œè¿˜æœ‰ä¸€ç§æ˜¯<code>terminate</code>æ–¹æ³•</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">function</span><span class="params">(arg)</span>:</span></span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    print(arg)</span><br><span class="line"></span><br><span class="line">pool = Pool(<span class="number">5</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">16</span>):</span><br><span class="line">    <span class="comment"># pool.apply(func=function, args=(i,))</span></span><br><span class="line">    pool.apply_async(func=function, args=(i,))</span><br><span class="line"></span><br><span class="line"><span class="comment">#pool.close()</span></span><br><span class="line">time.sleep(<span class="number">1</span>)</span><br><span class="line">pool.terminate()</span><br><span class="line">pool.join()</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">4</span></span><br></pre></td></tr></table></figure>

<p><code>close</code>æ–¹æ³•ä¸<code>terminate</code>æ–¹æ³•çš„åŒºåˆ«æ˜¯ï¼š</p>
<ul>
<li>closeï¼šç­‰å¾…æ‰€æœ‰å­è¿›ç¨‹æ‰§è¡Œå®Œæ¯•</li>
<li>terminateï¼šä¸ç®¡æ˜¯å¦æ­£åœ¨æ‰§è¡Œéƒ½ç«‹å³ç»ˆæ­¢</li>
</ul>
<h1 id="ä½¿ç”¨è¿›ç¨‹æ± å¹¶å…³æ³¨ç»“æœ"><a href="#ä½¿ç”¨è¿›ç¨‹æ± å¹¶å…³æ³¨ç»“æœ" class="headerlink" title="ä½¿ç”¨è¿›ç¨‹æ± å¹¶å…³æ³¨ç»“æœ"></a>ä½¿ç”¨è¿›ç¨‹æ± å¹¶å…³æ³¨ç»“æœ</h1><figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">function</span><span class="params">(arg)</span>:</span></span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> arg</span><br><span class="line"></span><br><span class="line">pool = Pool(<span class="number">5</span>)</span><br><span class="line">result = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">16</span>):</span><br><span class="line">    result.append(pool.apply_async(func=function, args=(i,)))</span><br><span class="line"></span><br><span class="line">pool.close()</span><br><span class="line">pool.join()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> r <span class="keyword">in</span> result:</span><br><span class="line">    print(<span class="string">"--&gt;"</span>, r.get())</span><br><span class="line">    </span><br><span class="line">------------</span><br><span class="line">--&gt; 0</span><br><span class="line">--&gt; 1</span><br><span class="line">--&gt; 2</span><br><span class="line">--&gt; 3</span><br><span class="line">--&gt; 4</span><br><span class="line">--&gt; 5</span><br><span class="line">--&gt; 6</span><br><span class="line">--&gt; 7</span><br><span class="line">--&gt; 8</span><br><span class="line">--&gt; 9</span><br><span class="line">--&gt; 10</span><br><span class="line">--&gt; 11</span><br><span class="line">--&gt; 12</span><br><span class="line">--&gt; 13</span><br><span class="line">--&gt; 14</span><br><span class="line">--&gt; 15</span><br></pre></td></tr></table></figure>

<h1 id="multiprocessing-pool-map"><a href="#multiprocessing-pool-map" class="headerlink" title="multiprocessing pool map"></a>multiprocessing pool map</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> multiprocessing </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">m1</span><span class="params">(x)</span>:</span></span><br><span class="line">    print(x * x)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    pool = multiprocessing.Pool(multiprocessing.cpu_count())</span><br><span class="line">    i_list = range(<span class="number">8</span>)</span><br><span class="line">    pool.map(m1, i_list)</span><br><span class="line">    </span><br><span class="line">------------</span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">25</span></span><br><span class="line"><span class="number">16</span></span><br><span class="line"><span class="number">9</span></span><br><span class="line"><span class="number">36</span></span><br><span class="line"><span class="number">49</span></span><br></pre></td></tr></table></figure>

<hr>
<p>å‚è€ƒæ–‡æ¡£ï¼š</p>
<p><a href="http://www.cnblogs.com/kaituorensheng/p/4465768.html" target="_blank" rel="noopener">http://www.cnblogs.com/kaituorensheng/p/4465768.html</a></p>
<p><a href="http://www.cnblogs.com/wupeiqi/articles/5040827.html" target="_blank" rel="noopener">http://www.cnblogs.com/wupeiqi/articles/5040827.html</a></p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>å¤šè¿›ç¨‹</tag>
        <tag>multiprocessing</tag>
        <tag>è¿›ç¨‹æ± </tag>
      </tags>
  </entry>
  <entry>
    <title>è¿›ç¨‹é”</title>
    <url>/2016/07/24/%E8%BF%9B%E7%A8%8B%E9%94%81/</url>
    <content><![CDATA[<blockquote>
<p>å¤šçº¿ç¨‹ä¸­æœ‰çº¿ç¨‹é”ï¼Œå¤šè¿›ç¨‹ä¸­ä¹Ÿæœ‰è¿›ç¨‹é”ã€‚ä¸åŒçš„æ˜¯ï¼Œåœ¨å¤šçº¿ç¨‹ä¸­ï¼Œæ•°æ®é»˜è®¤æ˜¯å…±äº«çš„ï¼Œæ¯ä¸ªçº¿ç¨‹å¯ä»¥è®¿é—®åŒä¸€å¯¹è±¡ï¼›è€Œåœ¨å¤šè¿›ç¨‹ä¸­ï¼Œæ•°æ®é»˜è®¤æ˜¯ç‹¬ç«‹çš„ï¼Œè¦æƒ³åœ¨å¤šè¿›ç¨‹ä¸­å…±äº«æ•°æ®ï¼Œéœ€è¦ä½¿ç”¨ç‰¹æ®Šçš„æ–¹å¼å®ç°</p>
</blockquote>
<p>ä¸Šé¢ä¹Ÿæåˆ°äº†ï¼Œæˆ‘æƒ³é‡ç°å¤šè¿›ç¨‹è®¿é—®åŒä¸€èµ„æºäº§ç”Ÿå†²çªçš„æƒ…å†µï¼Œå°±é¦–å…ˆè¦æ„é€ å‡ºå¤šè¿›ç¨‹çš„æ•°æ®å…±äº«ï¼Œå¦‚æœå¯¹å¤šè¿›ç¨‹çš„æ•°æ®å…±äº«æœ‰ç–‘é—®ï¼Œå¯ä»¥å‚è€ƒä¸Šä¸€ç¯‡æ–‡ç« </p>
<h1 id="æ²¡æœ‰é”è®¿é—®å…±äº«èµ„æº"><a href="#æ²¡æœ‰é”è®¿é—®å…±äº«èµ„æº" class="headerlink" title="æ²¡æœ‰é”è®¿é—®å…±äº«èµ„æº"></a>æ²¡æœ‰é”è®¿é—®å…±äº«èµ„æº</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Array</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(array)</span>:</span></span><br><span class="line">    <span class="comment"># ä¿®æ”¹ä¸»è¿›ç¨‹çš„å…±äº«æ•°æ®</span></span><br><span class="line">    array[<span class="number">0</span>] = array[<span class="number">0</span>] - <span class="number">1</span></span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    print(array[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªæ•°ç»„,é•¿åº¦ä¸º1,æ•°æ®ç±»å‹ä¸ºint</span></span><br><span class="line">array = Array(<span class="string">'i'</span>, <span class="number">1</span>)</span><br><span class="line"><span class="comment"># åœ¨ä¸»è¿›ç¨‹ä¸ºè¯¥æ•°ç»„èµ‹å€¼</span></span><br><span class="line">array[<span class="number">0</span>] = <span class="number">9</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">9</span>):</span><br><span class="line">    p = Process(target=func, args=(array,))</span><br><span class="line">    p.start()</span><br><span class="line">    </span><br><span class="line">------------</span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">0</span></span><br></pre></td></tr></table></figure>

<h1 id="åŠ é”è®¿é—®å…±äº«èµ„æº"><a href="#åŠ é”è®¿é—®å…±äº«èµ„æº" class="headerlink" title="åŠ é”è®¿é—®å…±äº«èµ„æº"></a>åŠ é”è®¿é—®å…±äº«èµ„æº</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> RLock, Lock, Event, Condition, Semaphore</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Array</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(array, lock)</span>:</span></span><br><span class="line">    lock.acquire()</span><br><span class="line">    <span class="comment"># ä¿®æ”¹ä¸»è¿›ç¨‹çš„å…±äº«æ•°æ®</span></span><br><span class="line">    array[<span class="number">0</span>] = array[<span class="number">0</span>] - <span class="number">1</span></span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    print(array[<span class="number">0</span>])</span><br><span class="line">    lock.release()</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªæ•°ç»„,é•¿åº¦ä¸º1,æ•°æ®ç±»å‹ä¸ºint</span></span><br><span class="line">array = Array(<span class="string">'i'</span>, <span class="number">1</span>)</span><br><span class="line"><span class="comment"># åœ¨ä¸»è¿›ç¨‹ä¸ºè¯¥æ•°ç»„èµ‹å€¼</span></span><br><span class="line">array[<span class="number">0</span>] = <span class="number">9</span></span><br><span class="line">lock = RLock()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">9</span>):</span><br><span class="line">    p = Process(target=func, args=(array, lock))</span><br><span class="line">    p.start()</span><br><span class="line">    </span><br><span class="line">------------</span><br><span class="line"><span class="number">8</span></span><br><span class="line"><span class="number">7</span></span><br><span class="line"><span class="number">6</span></span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">0</span></span><br></pre></td></tr></table></figure>

<h1 id="å¤šè¿›ç¨‹é”çš„ç§ç±»"><a href="#å¤šè¿›ç¨‹é”çš„ç§ç±»" class="headerlink" title="å¤šè¿›ç¨‹é”çš„ç§ç±»"></a>å¤šè¿›ç¨‹é”çš„ç§ç±»</h1><ul>
<li>RLock</li>
<li>Lock</li>
<li>Event</li>
<li>Condition</li>
<li>Semaphore</li>
</ul>
<p>å¤šè¿›ç¨‹ä¸­çš„é”å’Œå¤šçº¿ç¨‹ä¸­çš„é”ç”¨æ³•æ˜¯ä¸€æ ·çš„ï¼Œå…·ä½“æ¯ä¸ªé”çš„ç”¨æ³•è¿™é‡Œå°±ä¸ä¸€ä¸€ä¸¾ä¾‹äº†ï¼Œå¯ä»¥å‚è€ƒå¤šçº¿ç¨‹é”çš„ç”¨æ³•</p>
<p><a href="http://docs.20150509.cn/2016/07/22/çº¿ç¨‹é”/" target="_blank" rel="noopener">http://docs.20150509.cn/2016/07/22/çº¿ç¨‹é”/</a></p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>è¿›ç¨‹é”</tag>
        <tag>RLock</tag>
        <tag>Lock</tag>
        <tag>Event</tag>
        <tag>Condition</tag>
        <tag>Semaphore</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonä¸­å¤šè¿›ç¨‹ä¹‹é—´çš„æ•°æ®å…±äº«</title>
    <url>/2016/07/24/Python%E4%B8%AD%E5%A4%9A%E8%BF%9B%E7%A8%8B%E4%B9%8B%E9%97%B4%E7%9A%84%E6%95%B0%E6%8D%AE%E5%85%B1%E4%BA%AB/</url>
    <content><![CDATA[<blockquote>
<p>å¤šè¿›ç¨‹ä¸­ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œå„è‡ªæŒæœ‰ä¸€ä»½æ•°æ®ï¼Œæ— æ³•å…±äº«ã€‚æœ¬ç¯‡æ–‡ç« ä»‹ç»ä¸‰ç§ç”¨äºè¿›ç¨‹æ•°æ®å…±äº«çš„æ–¹æ³•</p>
</blockquote>
<ul>
<li>queues</li>
<li>Array</li>
<li>Manager.dict</li>
<li>pipe</li>
</ul>
<h1 id="Queue"><a href="#Queue" class="headerlink" title="Queue"></a>Queue</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> queues</span><br><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(i, q)</span>:</span></span><br><span class="line">    q.put(i)</span><br><span class="line">    print(<span class="string">"---&gt;"</span>, i, q.qsize())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">q = queues.Queue(<span class="number">9</span>, ctx=multiprocessing)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">    p = multiprocessing.Process(target=func, args=(i, q,))</span><br><span class="line">    p.start()</span><br><span class="line">p.join()</span><br></pre></td></tr></table></figure>

<p>Queueæ˜¯å¤šè¿›ç¨‹å®‰å…¨çš„é˜Ÿåˆ—ï¼Œå¯ä»¥ä½¿ç”¨Queueå®ç°å¤šè¿›ç¨‹ä¹‹é—´çš„æ•°æ®ä¼ é€’ã€‚putæ–¹æ³•ç”¨ä»¥æ’å…¥æ•°æ®åˆ°é˜Ÿåˆ—ä¸­ï¼Œputæ–¹æ³•è¿˜æœ‰ä¸¤ä¸ªå¯é€‰å‚æ•°ï¼šblockedå’Œtimeoutã€‚å¦‚æœblockedä¸ºTrueï¼ˆé»˜è®¤å€¼ï¼‰ï¼Œå¹¶ä¸”timeoutä¸ºæ­£å€¼ï¼Œè¯¥æ–¹æ³•ä¼šé˜»å¡timeoutæŒ‡å®šçš„æ—¶é—´ï¼Œç›´åˆ°è¯¥é˜Ÿåˆ—æœ‰å‰©ä½™çš„ç©ºé—´ã€‚å¦‚æœè¶…æ—¶ï¼Œä¼šæŠ›å‡ºQueue.Fullå¼‚å¸¸ã€‚å¦‚æœblockedä¸ºFalseï¼Œä½†è¯¥Queueå·²æ»¡ï¼Œä¼šç«‹å³æŠ›å‡ºQueue.Fullå¼‚å¸¸</p>
<p>getæ–¹æ³•å¯ä»¥ä»é˜Ÿåˆ—è¯»å–å¹¶ä¸”åˆ é™¤ä¸€ä¸ªå…ƒç´ ã€‚åŒæ ·ï¼Œgetæ–¹æ³•æœ‰ä¸¤ä¸ªå¯é€‰å‚æ•°ï¼šblockedå’Œtimeoutã€‚å¦‚æœblockedä¸ºTrueï¼ˆé»˜è®¤å€¼ï¼‰ï¼Œå¹¶ä¸”timeoutä¸ºæ­£å€¼ï¼Œé‚£ä¹ˆåœ¨ç­‰å¾…æ—¶é—´å†…æ²¡æœ‰å–åˆ°ä»»ä½•å…ƒç´ ï¼Œä¼šæŠ›å‡ºQueue.Emptyå¼‚å¸¸ã€‚å¦‚æœblockedä¸ºFalseï¼Œæœ‰ä¸¤ç§æƒ…å†µå­˜åœ¨ï¼Œå¦‚æœQueueæœ‰ä¸€ä¸ªå€¼å¯ç”¨ï¼Œåˆ™ç«‹å³è¿”å›è¯¥å€¼ï¼Œå¦åˆ™ï¼Œå¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™ç«‹å³æŠ›å‡ºQueue.Emptyå¼‚å¸¸</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(i, q)</span>:</span></span><br><span class="line">    q.put(i)</span><br><span class="line">    print(<span class="string">"---&gt;"</span>, i, q.qsize())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">q = multiprocessing.Queue()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">    p = multiprocessing.Process(target=func, args=(i, q,))</span><br><span class="line">    p.start()</span><br><span class="line">p.join()</span><br></pre></td></tr></table></figure>

<h1 id="Array"><a href="#Array" class="headerlink" title="Array"></a>Array</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Array</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(i, ar)</span>:</span></span><br><span class="line">    ar[i] = i</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> ar:</span><br><span class="line">        print(item)</span><br><span class="line">    print(<span class="string">"------"</span>)</span><br><span class="line"></span><br><span class="line">ar = Array(<span class="string">'i'</span>, <span class="number">5</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">    p = Process(target=func, args=(i, ar,))</span><br><span class="line">    p.start()</span><br><span class="line">p.join()</span><br></pre></td></tr></table></figure>

<p>Arrayçš„å±€é™æ€§åœ¨äºå—åˆ¶äºæ•°ç»„çš„ç‰¹æ€§ï¼Œå³éœ€è¦æŒ‡å®šæ•°æ®ç±»å‹ä¸”é•¿åº¦å›ºå®š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ•°æ®ç±»å‹å¯¹ç…§è¡¨</span></span><br><span class="line"><span class="string">'c'</span>: ctypes.c_char,  <span class="string">'u'</span>: ctypes.c_wchar,</span><br><span class="line"><span class="string">'b'</span>: ctypes.c_byte,  <span class="string">'B'</span>: ctypes.c_ubyte,</span><br><span class="line"><span class="string">'h'</span>: ctypes.c_short, <span class="string">'H'</span>: ctypes.c_ushort,</span><br><span class="line"><span class="string">'i'</span>: ctypes.c_int,   <span class="string">'I'</span>: ctypes.c_uint,</span><br><span class="line"><span class="string">'l'</span>: ctypes.c_long,  <span class="string">'L'</span>: ctypes.c_ulong,</span><br><span class="line"><span class="string">'f'</span>: ctypes.c_float, <span class="string">'d'</span>: ctypes.c_double</span><br></pre></td></tr></table></figure>

<h1 id="Manager-dict"><a href="#Manager-dict" class="headerlink" title="Manager.dict"></a>Manager.dict</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process, Manager</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¯ä¸ªå­è¿›ç¨‹æ‰§è¡Œçš„å‡½æ•°</span></span><br><span class="line"><span class="comment"># å‚æ•°ä¸­ï¼Œä¼ é€’äº†ä¸€ä¸ªç”¨äºå¤šè¿›ç¨‹ä¹‹é—´æ•°æ®å…±äº«çš„ç‰¹æ®Šå­—å…¸</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(i, d)</span>:</span></span><br><span class="line">    d[i] = i + <span class="number">100</span></span><br><span class="line">    print(d.values())</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨ä¸»è¿›ç¨‹ä¸­åˆ›å»ºç‰¹æ®Šå­—å…¸</span></span><br><span class="line">m = Manager()</span><br><span class="line">d = m.dict()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">    <span class="comment"># è®©å­è¿›ç¨‹å»ä¿®æ”¹ä¸»è¿›ç¨‹çš„ç‰¹æ®Šå­—å…¸</span></span><br><span class="line">    p = Process(target=func, args=(i, d))</span><br><span class="line">    p.start()</span><br><span class="line">p.join()</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">[<span class="number">100</span>]</span><br><span class="line">[<span class="number">100</span>, <span class="number">101</span>]</span><br><span class="line">[<span class="number">100</span>, <span class="number">101</span>, <span class="number">102</span>, <span class="number">103</span>]</span><br><span class="line">[<span class="number">100</span>, <span class="number">101</span>, <span class="number">102</span>, <span class="number">103</span>]</span><br><span class="line">[<span class="number">100</span>, <span class="number">101</span>, <span class="number">102</span>, <span class="number">103</span>, <span class="number">104</span>]</span><br></pre></td></tr></table></figure>

<p><strong>Manager.dict</strong>æ˜¯å¤šè¿›ç¨‹æ•°æ®å…±äº«ä¸­æ¯”è¾ƒå¸¸ç”¨çš„åšæ³•</p>
<h1 id="pipe"><a href="#pipe" class="headerlink" title="pipe"></a>pipe</h1><p>Pipeæ–¹æ³•è¿”å›(conn1, conn2)ä»£è¡¨ä¸€ä¸ªç®¡é“çš„ä¸¤ä¸ªç«¯ã€‚Pipeæ–¹æ³•æœ‰duplexå‚æ•°ï¼Œå¦‚æœduplexå‚æ•°ä¸ºTrue(é»˜è®¤å€¼)ï¼Œé‚£ä¹ˆè¿™ä¸ªç®¡é“æ˜¯å…¨åŒå·¥æ¨¡å¼ï¼Œä¹Ÿå°±æ˜¯è¯´conn1å’Œconn2å‡å¯æ”¶å‘ã€‚duplexä¸ºFalseï¼Œconn1åªè´Ÿè´£æ¥å—æ¶ˆæ¯ï¼Œconn2åªè´Ÿè´£å‘é€æ¶ˆæ¯</p>
<p>sendå’Œrecvæ–¹æ³•åˆ†åˆ«æ˜¯å‘é€å’Œæ¥å—æ¶ˆæ¯çš„æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œåœ¨å…¨åŒå·¥æ¨¡å¼ä¸‹ï¼Œå¯ä»¥è°ƒç”¨conn1.sendå‘é€æ¶ˆæ¯ï¼Œconn1.recvæ¥æ”¶æ¶ˆæ¯ã€‚å¦‚æœæ²¡æœ‰æ¶ˆæ¯å¯æ¥æ”¶ï¼Œrecvæ–¹æ³•ä¼šä¸€ç›´é˜»å¡ã€‚å¦‚æœç®¡é“å·²ç»è¢«å…³é—­ï¼Œé‚£ä¹ˆrecvæ–¹æ³•ä¼šæŠ›å‡ºEOFError</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func1</span><span class="params">(arg, pp)</span>:</span></span><br><span class="line">    pp.send(arg)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func2</span><span class="params">(pp)</span>:</span></span><br><span class="line">    recv = pp.recv()</span><br><span class="line">    print(recv)</span><br><span class="line"></span><br><span class="line">pp = multiprocessing.Pipe()</span><br><span class="line">p1 = multiprocessing.Process(target=func1, args=(<span class="string">"PolarSnow"</span>, pp[<span class="number">0</span>],))</span><br><span class="line">p2 = multiprocessing.Process(target=func2, args=(pp[<span class="number">1</span>],))</span><br><span class="line">p1.start()</span><br><span class="line">p2.start()</span><br><span class="line">p1.join()</span><br><span class="line">p2.join()</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">PolarSnow</span><br></pre></td></tr></table></figure>


]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>å¤šè¿›ç¨‹</tag>
        <tag>multiprocessing</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonä¸­åˆ—è¡¨ä¸æ•°ç»„çš„åŒºåˆ«</title>
    <url>/2016/07/24/Python%E4%B8%AD%E5%88%97%E8%A1%A8%E4%B8%8E%E6%95%B0%E7%BB%84%E7%9A%84%E5%8C%BA%E5%88%AB/</url>
    <content><![CDATA[<blockquote>
<p>PythonåŸç”Ÿæ²¡æœ‰æ•°ç»„çš„æ¦‚å¿µï¼Œè¿™ç‚¹ä¸åŒäºJavaä¹‹ç±»çš„é¢å‘å¯¹è±¡è¯­è¨€ã€‚Pythonä¸­åŸç”Ÿçš„åˆ—è¡¨ä½¿ç”¨èµ·æ¥å¾ˆåƒæ•°ç»„ï¼Œä½†æ˜¯ä¸¤è€…æœ‰æœ¬è´¨çš„åŒºåˆ«</p>
</blockquote>
<p>Pythonæ˜¯ä¸€é—¨åŠ¨æ€è¯­è¨€ï¼Œåœ¨Pythonåˆ—è¡¨çš„åˆ›å»ºä¸­ï¼Œä¸éœ€è¦æŒ‡å®šæ•°æ®ç±»å‹ï¼Œè€Œä¸”ä¸éœ€è¦æŒ‡å®šåˆ—è¡¨çš„é•¿åº¦â€”å› ä¸ºPythonä¸­çš„åˆ—è¡¨æ˜¯é€šè¿‡é“¾è¡¨çš„å½¢å¼å®ç°çš„ï¼›ç›¸å¯¹åº”çš„ï¼Œæ•°ç»„çš„ç‰¹ç‚¹æ˜¯å¿…é¡»åœ¨åˆ›å»ºçš„æ—¶å€™å£°æ˜å®ƒçš„æ•°æ®ç±»å‹ï¼Œè€Œä¸”å¿…é¡»æŒ‡å®šæ•°ç»„çš„é•¿åº¦</p>
<p>#åˆ—è¡¨ä¸æ•°ç»„çš„åŒºåˆ«</p>
<h2 id="å†…å­˜åœ°å€"><a href="#å†…å­˜åœ°å€" class="headerlink" title="å†…å­˜åœ°å€"></a>å†…å­˜åœ°å€</h2><ul>
<li>åˆ—è¡¨ä¸­çš„æ‰€æœ‰å…ƒç´ çš„å†…å­˜åœ°å€å¯ä»¥ä¸æ˜¯è¿ç»­çš„ï¼Œå®ƒæ˜¯é€šè¿‡æ¯ä¸ªå…ƒç´ è®°å½•å®ƒçš„ä¸Šä¸€ä¸ªå…ƒç´ çš„å†…å­˜åœ°å€å’Œè®°å½•å®ƒä¸‹ä¸€ä¸ªå…ƒç´ çš„å†…å­˜åœ°å€æ¥æ’åˆ—çš„</li>
<li>æ•°ç»„æ˜¯ä¸€ä¸ªè¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œæ¯ä¸€ä¸ªå…ƒç´ éƒ½æŒ‰ç…§å…ˆåé¡ºåºæ’åˆ—åœ¨å†…å­˜å½“ä¸­</li>
</ul>
<h2 id="æ•°æ®ç±»å‹"><a href="#æ•°æ®ç±»å‹" class="headerlink" title="æ•°æ®ç±»å‹"></a>æ•°æ®ç±»å‹</h2><ul>
<li>Pythonä¸­çš„åˆ—è¡¨å¯ä»¥æ”¾ä»»æ„ç±»å‹çš„å¯¹è±¡ï¼Œè¿™ä¸ªç‰¹æ€§æ˜¯Pythonèµ‹äºˆçš„ï¼Œä¸æ˜¯é“¾è¡¨æœ¬èº«çš„ç‰¹æ€§</li>
<li>æ•°ç»„ä¸€æ—¦å£°æ˜æ•°æ®ç±»å‹ï¼Œä¹‹åæ”¾å…¥æ¯ä¸ªçš„å…ƒç´ å¿…é¡»éƒ½æ˜¯è¿™ä¸ªæ•°æ®ç±»å‹çš„å¯¹è±¡ï¼Œå¦‚æœä¸æ˜¯ï¼Œå°±ä¼šæŠ›å‡ºå¼‚å¸¸</li>
</ul>
<p><img src="http://oss.20150509.cn/20160724145259.png" alt=""></p>
<h2 id="Pythonä¸­ä½¿ç”¨åˆ°æ•°ç»„çš„åœºæ™¯"><a href="#Pythonä¸­ä½¿ç”¨åˆ°æ•°ç»„çš„åœºæ™¯" class="headerlink" title="Pythonä¸­ä½¿ç”¨åˆ°æ•°ç»„çš„åœºæ™¯"></a>Pythonä¸­ä½¿ç”¨åˆ°æ•°ç»„çš„åœºæ™¯</h2><ul>
<li>from multiprocessing import Array</li>
</ul>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>åˆ—è¡¨</tag>
        <tag>æ•°ç»„</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonå¤šè¿›ç¨‹ä¸­çš„runæ–¹æ³•</title>
    <url>/2016/07/24/Python%E5%A4%9A%E8%BF%9B%E7%A8%8B%E4%B8%AD%E7%9A%84run%E6%96%B9%E6%B3%95/</url>
    <content><![CDATA[<blockquote>
<p>åœ¨å¤šçº¿ç¨‹çš„ä»‹ç»ä¸­ï¼Œä»‹ç»äº†å¯ä»¥è‡ªå®šä¹‰å¤šçº¿ç¨‹ç±»ï¼Œå¹¶ä¸”é‡å†™å¤šçº¿ç¨‹ç±»çš„runæ–¹æ³•ï¼Œå®ç°äº†ç¬¬äºŒç§ä½¿ç”¨å¤šçº¿ç¨‹çš„æ–¹å¼</p>
<p>åœ¨å¤šè¿›ç¨‹ä¸­ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰å¤šè¿›ç¨‹ç±»ï¼Œæ˜¯é€šè¿‡é‡å†™å¤šè¿›ç¨‹ç±»çš„runæ–¹æ³•</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyProcess</span><span class="params">(multiprocessing.Process)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, func, args)</span>:</span></span><br><span class="line">        <span class="comment"># å°†å‡½æ•°åå’Œå‚æ•°å°è£…åˆ°æœ¬ç±»ä¸­</span></span><br><span class="line">        self.func = func</span><br><span class="line">        self.args = args</span><br><span class="line">        <span class="comment"># ä¸ºä¿è¯ç»§æ‰¿çš„ç±»æ­£å¸¸è¿è¡Œï¼Œè¿™é‡Œéœ€è¦æ‰§è¡Œçˆ¶ç±»çš„æ„é€ æ–¹æ³•</span></span><br><span class="line">        <span class="comment"># ä½†æ˜¯æ²¡æœ‰ç»™çˆ¶ç±»çš„æ„é€ æ–¹æ³•ä¼ é€’ä»»ä½•å‚æ•°</span></span><br><span class="line">        <span class="comment"># è€Œå¯¹è±¡å¯»æ‰¾å‚æ•°æ—¶ï¼Œä¹Ÿæ˜¯æœ€å…ˆä»æœ¬ç±»ä¸­å¯»æ‰¾</span></span><br><span class="line">        super(MyProcess, self).__init__()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># æ‰§è¡Œå‚æ•°ä¸­çš„å‡½æ•°</span></span><br><span class="line">        self.func(*self.args)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è‡ªå®šä¹‰ä¸€ä¸ªéœ€è¦å­è¿›ç¨‹è¿è¡Œçš„å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(*args)</span>:</span></span><br><span class="line">    print(args)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨è‡ªå®šä¹‰çš„è¿›ç¨‹å¯¹è±¡æ‰§è¡Œ</span></span><br><span class="line">p = MyProcess(func=f, args=(<span class="number">59</span>,<span class="number">15</span>))</span><br><span class="line">p.start()</span><br></pre></td></tr></table></figure>

<p><strong>è¿›ç¨‹pè°ƒç”¨start()æ—¶ï¼Œè‡ªåŠ¨è°ƒç”¨run()</strong></p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>å¤šè¿›ç¨‹</tag>
        <tag>multiprocessing</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonä¸­å¤šè¿›ç¨‹çš„åŸºæœ¬æ“ä½œ</title>
    <url>/2016/07/24/Python%E4%B8%AD%E5%A4%9A%E8%BF%9B%E7%A8%8B%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/</url>
    <content><![CDATA[<blockquote>
<p>Pythonä¸­çš„å¤šè¿›ç¨‹å¯ä»¥ä½¿ç”¨åˆ°å¤šé¢—CPUå¸¦æ¥çš„å¥½å¤„ï¼Œåœ¨å‰é¢å¤šçº¿ç¨‹ä¸­å·²ç»æ€»ç»“å‡ºï¼Œå¯¹äºIOå¯†é›†å‹çš„æ“ä½œï¼Œç”±äºIOä¸å ç”¨CPUï¼Œæ‰€ä»¥ä½¿ç”¨è½»é‡çº§çš„å¤šçº¿ç¨‹å³å¯è§£å†³é—®é¢˜ï¼›è€Œå¯¹äºè®¡ç®—å¯†é›†å‹æ“ä½œï¼Œç”±äºå¤šçº¿ç¨‹ä¸æ”¯æŒä½¿ç”¨å¤šé¢—CPUï¼Œæ‰€ä»¥ä½¿ç”¨å¤šè¿›ç¨‹æ˜¯æœ€åˆé€‚çš„ã€‚æœ¬ç¯‡æ–‡ä»¶å°±ä»‹ç»Pythonå¤šè¿›ç¨‹çš„ä½¿ç”¨</p>
</blockquote>
<h1 id="åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹"><a href="#åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹" class="headerlink" title="åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹"></a>åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">worker</span><span class="params">(arg)</span>:</span></span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    print(arg)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    p = multiprocessing.Process(target=worker, args=(<span class="string">"Hello PolarSnow"</span>,))</span><br><span class="line">    p.start()</span><br><span class="line">    print(<span class="string">"p.pid:"</span>, p.pid)</span><br><span class="line">    print(<span class="string">"p.name"</span>, p.name)</span><br><span class="line">    print(<span class="string">"p.is_alive:"</span>, p.is_alive())</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">p.pid: <span class="number">17731</span></span><br><span class="line">p.name Process<span class="number">-1</span></span><br><span class="line">p.is_alive: <span class="literal">True</span></span><br><span class="line">Hello PolarSnow</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½ çœ‹è¿‡å‰é¢å¤šçº¿ç¨‹çš„æ–‡ç« ï¼Œå¯ä»¥çœ‹å‡ºï¼Œå¤šè¿›ç¨‹çš„åŸºæœ¬ç”¨æ³•å’Œå¤šçº¿ç¨‹å¾ˆç›¸ä¼¼</p>
<h1 id="å¤šä¸ªè¿›ç¨‹å¤„ç†åŒä¸€ä¸ªå‡½æ•°"><a href="#å¤šä¸ªè¿›ç¨‹å¤„ç†åŒä¸€ä¸ªå‡½æ•°" class="headerlink" title="å¤šä¸ªè¿›ç¨‹å¤„ç†åŒä¸€ä¸ªå‡½æ•°"></a>å¤šä¸ªè¿›ç¨‹å¤„ç†åŒä¸€ä¸ªå‡½æ•°</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">worker</span><span class="params">(arg)</span>:</span></span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    print(arg)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">        p = multiprocessing.Process(target=worker, args=(i,))</span><br><span class="line">        p.start()</span><br><span class="line"></span><br><span class="line">    print(<span class="string">"CPUæ•°é‡:"</span>, str(multiprocessing.cpu_count()))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> multiprocessing.active_children():</span><br><span class="line">        print(<span class="string">"å­è¿›ç¨‹åç§°:"</span>, p.name, <span class="string">"å­è¿›ç¨‹id:"</span>, p.pid)</span><br><span class="line">        </span><br><span class="line">------------</span><br><span class="line">CPUæ•°é‡: <span class="number">4</span></span><br><span class="line">å­è¿›ç¨‹åç§°: Process<span class="number">-5</span> å­è¿›ç¨‹id: <span class="number">18705</span></span><br><span class="line">å­è¿›ç¨‹åç§°: Process<span class="number">-3</span> å­è¿›ç¨‹id: <span class="number">18703</span></span><br><span class="line">å­è¿›ç¨‹åç§°: Process<span class="number">-2</span> å­è¿›ç¨‹id: <span class="number">18702</span></span><br><span class="line">å­è¿›ç¨‹åç§°: Process<span class="number">-1</span> å­è¿›ç¨‹id: <span class="number">18701</span></span><br><span class="line">å­è¿›ç¨‹åç§°: Process<span class="number">-4</span> å­è¿›ç¨‹id: <span class="number">18704</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">4</span></span><br></pre></td></tr></table></figure>

<h1 id="å¤šä¸ªè¿›ç¨‹å¤„ç†å¤šä¸ªå‡½æ•°"><a href="#å¤šä¸ªè¿›ç¨‹å¤„ç†å¤šä¸ªå‡½æ•°" class="headerlink" title="å¤šä¸ªè¿›ç¨‹å¤„ç†å¤šä¸ªå‡½æ•°"></a>å¤šä¸ªè¿›ç¨‹å¤„ç†å¤šä¸ªå‡½æ•°</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">worker1</span><span class="params">(arg)</span>:</span></span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    print(<span class="string">"worker1"</span>, arg)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">worker2</span><span class="params">(arg)</span>:</span></span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    print(<span class="string">"worker2"</span>, arg)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">worker3</span><span class="params">(arg)</span>:</span></span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    print(<span class="string">"worker3"</span>, arg)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line"></span><br><span class="line">    p1 = multiprocessing.Process(target=worker1, args=(<span class="string">"PS1"</span>,))</span><br><span class="line">    p2 = multiprocessing.Process(target=worker1, args=(<span class="string">"PS2"</span>,))</span><br><span class="line">    p3 = multiprocessing.Process(target=worker1, args=(<span class="string">"PS3"</span>,))</span><br><span class="line">    p1.start()</span><br><span class="line">    p2.start()</span><br><span class="line">    p3.start()</span><br><span class="line"></span><br><span class="line">    print(<span class="string">"CPUæ•°é‡:"</span>, str(multiprocessing.cpu_count()))</span><br><span class="line">	</span><br><span class="line">	<span class="comment"># å¯ä»¥æŸ¥çœ‹å½“å‰æ­£åœ¨è¿è¡Œçš„å­è¿›ç¨‹çš„ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> multiprocessing.active_children():</span><br><span class="line">        print(<span class="string">"å­è¿›ç¨‹åç§°:"</span>, p.name, <span class="string">"å­è¿›ç¨‹id:"</span>, p.pid)</span><br></pre></td></tr></table></figure>

<h1 id="daemonå±æ€§"><a href="#daemonå±æ€§" class="headerlink" title="daemonå±æ€§"></a>daemonå±æ€§</h1><p><strong>ä¸åŠ daemonå±æ€§</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">worker</span><span class="params">(arg)</span>:</span></span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    print(arg)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">        p = multiprocessing.Process(target=worker, args=(i,))</span><br><span class="line">        <span class="comment"># p.daemon = True</span></span><br><span class="line">        p.start()</span><br><span class="line"></span><br><span class="line">    print(<span class="string">"CPUæ•°é‡:"</span>, str(multiprocessing.cpu_count()))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> multiprocessing.active_children():</span><br><span class="line">        print(<span class="string">"å­è¿›ç¨‹åç§°:"</span>, p.name, <span class="string">"å­è¿›ç¨‹id:"</span>, p.pid)</span><br><span class="line"></span><br><span class="line">    print(<span class="string">"End"</span>)</span><br><span class="line">    </span><br><span class="line">------------</span><br><span class="line">CPUæ•°é‡: <span class="number">4</span></span><br><span class="line">å­è¿›ç¨‹åç§°: Process<span class="number">-2</span> å­è¿›ç¨‹id: <span class="number">21859</span></span><br><span class="line">å­è¿›ç¨‹åç§°: Process<span class="number">-3</span> å­è¿›ç¨‹id: <span class="number">21860</span></span><br><span class="line">å­è¿›ç¨‹åç§°: Process<span class="number">-1</span> å­è¿›ç¨‹id: <span class="number">21858</span></span><br><span class="line">å­è¿›ç¨‹åç§°: Process<span class="number">-4</span> å­è¿›ç¨‹id: <span class="number">21861</span></span><br><span class="line">å­è¿›ç¨‹åç§°: Process<span class="number">-5</span> å­è¿›ç¨‹id: <span class="number">21862</span></span><br><span class="line">End</span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">4</span></span><br></pre></td></tr></table></figure>

<p><strong>åŠ ä¸Šdaemonå±æ€§</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">worker</span><span class="params">(arg)</span>:</span></span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    print(arg)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">        p = multiprocessing.Process(target=worker, args=(i,))</span><br><span class="line">        p.daemon = <span class="literal">True</span></span><br><span class="line">        p.start()</span><br><span class="line"></span><br><span class="line">    print(<span class="string">"CPUæ•°é‡:"</span>, str(multiprocessing.cpu_count()))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> multiprocessing.active_children():</span><br><span class="line">        print(<span class="string">"å­è¿›ç¨‹åç§°:"</span>, p.name, <span class="string">"å­è¿›ç¨‹id:"</span>, p.pid)</span><br><span class="line"></span><br><span class="line">    print(<span class="string">"End"</span>)</span><br><span class="line">    </span><br><span class="line">------------</span><br><span class="line">CPUæ•°é‡: <span class="number">4</span></span><br><span class="line">å­è¿›ç¨‹åç§°: Process<span class="number">-2</span> å­è¿›ç¨‹id: <span class="number">21913</span></span><br><span class="line">å­è¿›ç¨‹åç§°: Process<span class="number">-1</span> å­è¿›ç¨‹id: <span class="number">21912</span></span><br><span class="line">å­è¿›ç¨‹åç§°: Process<span class="number">-4</span> å­è¿›ç¨‹id: <span class="number">21915</span></span><br><span class="line">å­è¿›ç¨‹åç§°: Process<span class="number">-5</span> å­è¿›ç¨‹id: <span class="number">21916</span></span><br><span class="line">å­è¿›ç¨‹åç§°: Process<span class="number">-3</span> å­è¿›ç¨‹id: <span class="number">21914</span></span><br><span class="line">End</span><br></pre></td></tr></table></figure>

<p><code>p.daemon</code>çš„é»˜è®¤å€¼ä¸º<code>False</code>ï¼Œæ„ä¸ºä¸»è¿›ç¨‹ç­‰å¾…å­è¿›ç¨‹æ‰§è¡Œå®Œæ¯•åå†é€€å‡ºç¨‹åº</p>
<p><code>p.daemon</code>çš„å€¼ä¸º<code>True</code>æ—¶ï¼Œæ„ä¸ºå½“ä¸»è¿›ç¨‹æ‰§è¡Œå®Œæ¯•æ—¶ï¼Œç«‹å³é€€å‡ºç¨‹åº</p>
<h1 id="joinæ–¹æ³•"><a href="#joinæ–¹æ³•" class="headerlink" title="joinæ–¹æ³•"></a>joinæ–¹æ³•</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">worker</span><span class="params">(arg)</span>:</span></span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    print(arg)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">        p = multiprocessing.Process(target=worker, args=(i,))</span><br><span class="line">        p.daemon = <span class="literal">True</span></span><br><span class="line">        p.start()</span><br><span class="line"></span><br><span class="line">    print(<span class="string">"CPUæ•°é‡:"</span>, str(multiprocessing.cpu_count()))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> multiprocessing.active_children():</span><br><span class="line">        print(<span class="string">"å­è¿›ç¨‹åç§°:"</span>, p.name, <span class="string">"å­è¿›ç¨‹id:"</span>, p.pid)</span><br><span class="line">    p.join()</span><br><span class="line">    print(<span class="string">"End"</span>)</span><br><span class="line">    </span><br><span class="line">------------</span><br><span class="line">CPUæ•°é‡: <span class="number">4</span></span><br><span class="line">å­è¿›ç¨‹åç§°: Process<span class="number">-2</span> å­è¿›ç¨‹id: <span class="number">22196</span></span><br><span class="line">å­è¿›ç¨‹åç§°: Process<span class="number">-1</span> å­è¿›ç¨‹id: <span class="number">22195</span></span><br><span class="line">å­è¿›ç¨‹åç§°: Process<span class="number">-3</span> å­è¿›ç¨‹id: <span class="number">22197</span></span><br><span class="line">å­è¿›ç¨‹åç§°: Process<span class="number">-5</span> å­è¿›ç¨‹id: <span class="number">22199</span></span><br><span class="line">å­è¿›ç¨‹åç§°: Process<span class="number">-4</span> å­è¿›ç¨‹id: <span class="number">22198</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line">End</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼š</p>
<ul>
<li>joinæ–¹æ³•çš„ä½œç”¨æ˜¯é˜»å¡ä½ä¸»è¿›ç¨‹ï¼Œè®©CPUæ— æ³•æ‰§è¡Œjoinåé¢çš„ä»£ç ï¼Œä¸“æ³¨æ‰§è¡Œå¤šçº¿ç¨‹</li>
<li>ä¸Šé¢æ¼”ç¤ºçš„æ˜¯å¤šä¸ªè¿›ç¨‹å¯¹åº”ä¸€ä¸ªjoinçš„æƒ…å†µï¼Œæ„ä¸ºç­‰å¾…æ‰€æœ‰çš„å­è¿›ç¨‹æ‰§è¡Œå®Œæ¯•åï¼Œå†å‘ä¸‹æ‰§è¡Œä»£ç ï¼›å¦‚æœjoinå†™åœ¨forå¾ªç¯é‡Œé¢ï¼Œå¤šä¸ªçº¿ç¨‹å¯¹åº”å¤šä¸ªjoinæ—¶ï¼Œæ„ä¸ºå‰ä¸€ä¸ªå­è¿›ç¨‹æ‰§è¡Œå®Œæ¯•åï¼Œæ‰èƒ½æ‰§è¡Œä¸‹ä¸€æ¬¡å¾ªç¯ï¼Œæ‰§è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">worker</span><span class="params">(arg)</span>:</span></span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    print(arg)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">        p = multiprocessing.Process(target=worker, args=(i,))</span><br><span class="line">        p.daemon = <span class="literal">True</span></span><br><span class="line">        p.start()</span><br><span class="line">        p.join()</span><br><span class="line"></span><br><span class="line">    print(<span class="string">"CPUæ•°é‡:"</span>, str(multiprocessing.cpu_count()))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> multiprocessing.active_children():</span><br><span class="line">        print(<span class="string">"å­è¿›ç¨‹åç§°:"</span>, p.name, <span class="string">"å­è¿›ç¨‹id:"</span>, p.pid)</span><br><span class="line">    <span class="comment"># p.join()</span></span><br><span class="line">    print(<span class="string">"End"</span>)</span><br></pre></td></tr></table></figure>

<p><em>ç›¸å½“äºç”¨å­è¿›ç¨‹ä¸²è¡Œæ‰§è¡Œä»»åŠ¡</em></p>
<ul>
<li>joinæ˜¯å¯ä»¥æ·»åŠ å‚æ•°çš„ï¼Œåœ¨æ²¡æœ‰å‚æ•°çš„æ—¶å€™ï¼Œä¼šä¸€ç›´é˜»å¡åˆ°å‡½æ•°æ‰§è¡Œå®Œæ¯•ä¸ºæ­¢ï¼›è®¾ç½®å‚æ•°åï¼ˆint æ—¶é—´ å•ä½æ˜¯ç§’ï¼‰æ„ä¸ºjoinæœ€é•¿é˜»å¡çš„æ—¶é—´ï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´åï¼Œä¸ç®¡å­è¿›ç¨‹æœ‰æ²¡æœ‰æ‰§è¡Œå®Œæ¯•éƒ½ä¼šç»§ç»­å‘ä¸‹æ‰§è¡Œ</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">p.join(1)</span><br></pre></td></tr></table></figure>
<p><strong>æœ€å¤šç­‰å¾…1ç§’ï¼ˆæœ€å¤šé˜»å¡1ç§’ï¼‰</strong></p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>å¤šè¿›ç¨‹</tag>
        <tag>multiprocessing</tag>
      </tags>
  </entry>
  <entry>
    <title>è‡ªå®šä¹‰çº¿ç¨‹æ± </title>
    <url>/2016/07/22/%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BA%BF%E7%A8%8B%E6%B1%A0/</url>
    <content><![CDATA[<blockquote>
<p>ä¸Šä¸€ç¯‡æ–‡ç« ç®€å•çš„ä»‹ç»äº†ä¸€ä¸ªçº¿ç¨‹æ± çš„åŸºæœ¬å®ç°æ€è·¯ã€‚åœ¨ä¸Šä¸€ç¯‡çš„ä»£ç å®ç°ä¸­ï¼Œå…¶å®è¿˜æœ‰å¾ˆå¤šé—®é¢˜ã€‚ç¬¬ä¸€ï¼Œçº¿ç¨‹æ²¡æœ‰è¢«é‡ç”¨ï¼Œæˆ‘ä»¬åªæ˜¯æ¨¡æ‹Ÿäº†ä¸€ä¸ªä»»åŠ¡æ‹¿èµ°ä¸€ä¸ªçº¿ç¨‹ï¼Œæ‰§è¡Œå®Œæ¯•åå†â€œè¿˜â€å›å»çš„è¿‡ç¨‹ï¼Œå…¶å®æ˜¯åœ¨çº¿ç¨‹æ± ä¸­æ–°åˆ›å»ºäº†ä¸€ä¸ªçº¿ç¨‹ç±»ï¼Œè¢«ä½¿ç”¨è¿‡çš„çº¿ç¨‹å°†ç­‰å¾…è¢«Pythonçš„åƒåœ¾å›æ”¶æœºåˆ¶å›æ”¶ï¼›ç¬¬äºŒï¼Œå¦‚æœæ‰§è¡Œçš„ä»»åŠ¡çš„æ•°é‡å°äºçº¿ç¨‹æ± çš„å®¹é‡ï¼Œé‚£æˆ‘ä»¬åœ¨çº¿ç¨‹æ± çš„æ„é€ æ–¹æ³•ä¸­ï¼Œé¢„å…ˆå¡«æ»¡çš„çº¿ç¨‹ç±»å°±æ˜¾å¾—éå¸¸æµªè´¹äº†</p>
</blockquote>
<p>æ”¹è¿›æ€è·¯ï¼š</p>
<ul>
<li>ä¹‹å‰æ˜¯å°†çº¿ç¨‹æ”¾å…¥åˆ°é˜Ÿåˆ—ä¸­ï¼Œå¯åŠ¨çº¿ç¨‹æ± åï¼Œæ•´ä¸ªé˜Ÿåˆ—å°±ä¼šå……æ»¡å¾…ä½¿ç”¨çš„çº¿ç¨‹<ul>
<li>æ”¹è¿›ï¼šå°†ä»»åŠ¡æ”¾å…¥åˆ°é˜Ÿåˆ—ä¸­ï¼Œç„¶ä»»åŠ¡æ’é˜Ÿè¿›å…¥é˜Ÿåˆ—ã€‚çº¿ç¨‹çš„æ•°é‡é€šè¿‡åˆ—è¡¨çš„é•¿åº¦æ§åˆ¶ï¼Œæ¯åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œå°±åœ¨åˆ—è¡¨ä¸­appendä¸€ä¸‹</li>
</ul>
</li>
<li>ä¹‹å‰é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹ï¼Œæ¯ä¸€ä¸ªä»»åŠ¡å–èµ°ä¹‹åï¼Œæ‰§è¡Œå®Œä»»åŠ¡éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹æ”¾å…¥åˆ°é˜Ÿåˆ—ä¸­<ul>
<li>æ”¹è¿›ï¼šæ¯ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œä»»åŠ¡åï¼Œä¸å†é‡Šæ”¾çº¿ç¨‹èµ„æºï¼Œå¾ªç¯å»ä»»åŠ¡é˜Ÿåˆ—ä¸­è·å–ä»»åŠ¡å»æ‰§è¡Œï¼Œç›´åˆ°åˆ¤æ–­æ‹¿åˆ°çš„æ˜¯ç©ºå€¼è€Œä¸æ˜¯ä¸€ä¸ªä»»åŠ¡æ—¶ï¼Œé€€å‡ºè‡ªå·±çš„çº¿ç¨‹</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> queue</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> contextlib</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="comment"># é˜Ÿåˆ—ä¸­çš„ç©ºå€¼</span></span><br><span class="line">StopEvent = object()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThreadPool</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, max_num, max_task_num = None)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        æ„é€ æ–¹æ³•</span></span><br><span class="line"><span class="string">        :param max_num: æœ€å¤šæœ‰å¤šå°‘ä¸ªçº¿ç¨‹</span></span><br><span class="line"><span class="string">        :param max_task_num: æ¥æ”¶ä»»åŠ¡é˜Ÿåˆ—çš„é•¿åº¦</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> max_task_num:</span><br><span class="line">            self.q = queue.Queue(max_task_num)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.q = queue.Queue()</span><br><span class="line">        self.max_num = max_num</span><br><span class="line">        self.cancel = <span class="literal">False</span></span><br><span class="line">        self.terminal = <span class="literal">False</span></span><br><span class="line">        self.generate_list = []  <span class="comment"># å½“å‰å·²ç»åˆ›å»ºçš„çº¿ç¨‹</span></span><br><span class="line">        self.free_list = []  <span class="comment"># å½“å‰è¿˜ç©ºé—²å¤šå°‘çº¿ç¨‹</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self, func, args, callback=None)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        çº¿ç¨‹æ± æ‰§è¡Œä¸€ä¸ªä»»åŠ¡</span></span><br><span class="line"><span class="string">        :param func: ä»»åŠ¡å‡½æ•°</span></span><br><span class="line"><span class="string">        :param args: ä»»åŠ¡å‡½æ•°æ‰€éœ€å‚æ•°</span></span><br><span class="line"><span class="string">        :param callback: ä»»åŠ¡æ‰§è¡Œå¤±è´¥æˆ–æˆåŠŸåæ‰§è¡Œçš„å›è°ƒå‡½æ•°ï¼Œå›è°ƒå‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°1ã€ä»»åŠ¡å‡½æ•°æ‰§è¡ŒçŠ¶æ€ï¼›2ã€ä»»åŠ¡å‡½æ•°è¿”å›å€¼ï¼ˆé»˜è®¤ä¸ºNoneï¼Œå³ï¼šä¸æ‰§è¡Œå›è°ƒå‡½æ•°ï¼‰</span></span><br><span class="line"><span class="string">        :return: å¦‚æœçº¿ç¨‹æ± å·²ç»ç»ˆæ­¢ï¼Œåˆ™è¿”å›Trueå¦åˆ™None</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># self.cancelæ˜¯åœ¨æ„é€ æ–¹æ³•å’Œself.closeæ–¹æ³•ä¸­è®¾ç½®çš„å€¼</span></span><br><span class="line">        <span class="comment"># åœ¨closeæ–¹æ³•ä¸­å°†è¯¥å€¼è®¾ç½®ä¸ºFalse,æ„ä¸ºå½“å‰ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰ä»»åŠ¡å…¨éƒ¨å·²ç»æ‰§è¡Œå®Œæ¯•</span></span><br><span class="line">        <span class="keyword">if</span> self.cancel:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> len(self.free_list) == <span class="number">0</span> <span class="keyword">and</span> len(self.generate_list) &lt; self.max_num:</span><br><span class="line">            <span class="comment"># å¦‚æœç©ºé—²çš„çº¿ç¨‹ä¸º0 ä¸” å½“å‰å·²ç»åˆ›å»ºçš„çº¿ç¨‹æ•°é‡å°äºè®¾ç½®çš„æœ€å¤§çº¿ç¨‹æ•°é‡</span></span><br><span class="line">            <span class="comment"># è°ƒç”¨æœ¬ç±»çš„å…¶ä»–æ–¹æ³•åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹</span></span><br><span class="line">            self.generate_thread()</span><br><span class="line">        <span class="comment"># å°†runæ–¹æ³•æ”¶åˆ°çš„ä¸‰ä¸ªå‚æ•°ç»„æˆä¸€ä¸ªæ•°æ®</span></span><br><span class="line">        w = (func, args, callback,)</span><br><span class="line">        <span class="comment"># æ”¾å…¥åˆ°ä»»åŠ¡é˜Ÿåˆ—å½“ä¸­</span></span><br><span class="line">        self.q.put(w)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">generate_thread</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        åˆ›å»ºä¸€ä¸ªçº¿ç¨‹</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="comment"># æ¯ä¸€ä¸ªçº¿ç¨‹è¢«åˆ›å»ºå‡ºæ¥åéƒ½å»æ‰§è¡Œäº†æœ¬ç±»ä¸­çš„callæ–¹æ³•</span></span><br><span class="line">        t = threading.Thread(target=self.call)</span><br><span class="line">        <span class="comment"># å¯åŠ¨çº¿ç¨‹</span></span><br><span class="line">        t.start()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">call</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        å¾ªç¯å»è·å–ä»»åŠ¡å‡½æ•°å¹¶æ‰§è¡Œä»»åŠ¡å‡½æ•°</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># è·å–å½“å‰çº¿ç¨‹</span></span><br><span class="line">        current_thread = threading.currentThread</span><br><span class="line">        <span class="comment"># å°†å½“å‰çº¿ç¨‹åŠ å…¥åˆ°"å½“å‰å·²åˆ›å»ºçº¿ç¨‹"åˆ—è¡¨ä¸­</span></span><br><span class="line">        self.generate_list.append(current_thread)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># åœ¨é˜Ÿåˆ—ä¸­è·å–ä¸€ä¸ªä»»åŠ¡</span></span><br><span class="line">        event = self.q.get()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># whileå¾ªç¯,å½“eventä¸ä¸ºç©ºå¯¹è±¡çš„æ—¶å€™</span></span><br><span class="line">        <span class="keyword">while</span> event != StopEvent:</span><br><span class="line">            <span class="comment"># é˜Ÿåˆ—ä¸­çš„æ¯ä¸ªå…ƒç´ ç”±ä¸€ä¸ªå…ƒç¥–æ„æˆ(func, args, callback,)</span></span><br><span class="line">            func, arguments, callback = event</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="comment"># å»æ‰§è¡Œå‡½æ•°</span></span><br><span class="line">                <span class="comment"># è¿™é‡Œfuncå¯¹åº”çš„æ˜¯actionå‡½æ•°</span></span><br><span class="line">                <span class="comment"># argumentså‚æ•°å¯¹åº”äº†i</span></span><br><span class="line">                <span class="comment"># resultæ¥æ”¶è¿™ä¸ªå‡½æ•°çš„è¿”å›å€¼</span></span><br><span class="line">                result = func(*arguments)</span><br><span class="line">                success = <span class="literal">True</span></span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> ex:</span><br><span class="line">                success = <span class="literal">False</span></span><br><span class="line">                result = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># åˆ¤æ–­callbackå‡½æ•°æ˜¯å¦ä¸ºç©º</span></span><br><span class="line">            <span class="keyword">if</span> callback <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    <span class="comment"># æ‰§è¡Œè¿™ä¸ªå›è°ƒå‡½æ•°,å°†æ‰§è¡Œçš„çŠ¶æ€å’Œè¿”å›çš„ç»“æœä¼ é€’ç»™å›è°ƒå‡½æ•°</span></span><br><span class="line">                    callback(success, result)</span><br><span class="line">                <span class="keyword">except</span> Exception <span class="keyword">as</span> ex:</span><br><span class="line">                    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># ä»¥ä¸Šactionå‡½æ•°æ‰§è¡Œå®Œå,è¯¥çº¿ç¨‹å˜ä¸ºç©ºé—²çŠ¶æ€</span></span><br><span class="line">            <span class="comment"># ä»¥ä¸‹ä»£ç å°†è¯¥çº¿ç¨‹åŠ å…¥åˆ°"å½“å‰ç©ºé—²çº¿ç¨‹"åˆ—è¡¨ä¸­,ç­‰å¾…çº¿ç¨‹å¤ç”¨</span></span><br><span class="line">            <span class="keyword">with</span> self.worker_state(self.free_list, current_thread):</span><br><span class="line">            	<span class="comment"># é»˜è®¤çš„self.terminalä¸ºFalseï¼Œä¼šä¸€ç›´å»é˜Ÿåˆ—ä¸­å–ä»»åŠ¡æ‰§è¡Œ</span></span><br><span class="line">            	<span class="comment"># åœ¨terminateæ–¹æ³•ä¸­ï¼Œè®¾ç½®äº†self.terminalçš„å€¼ä¸ºTrueï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€æ—¦è°ƒç”¨terminateæ–¹æ³•ï¼Œè¿™ä¸ªçº¿ç¨‹å°†è¢«å›æ”¶ï¼Œä¸å†æ‰§è¡Œæ–°çš„ä»»åŠ¡</span></span><br><span class="line">                <span class="keyword">if</span> self.terminal:</span><br><span class="line">                    event = StopEvent</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="comment"># å¤ç”¨å½“å‰çº¿ç¨‹,å†å»é˜Ÿåˆ—ä¸­è·å–ä¸€ä¸ªä»»åŠ¡</span></span><br><span class="line">                    event = self.q.get()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># eventä¸ºç©ºå¯¹è±¡,è¯´æ˜å½“å‰å·²ç»æ²¡æœ‰éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡äº†</span></span><br><span class="line">            <span class="comment"># æ¯ä¸ªçº¿ç¨‹æŠŠè‡ªå·±çš„çº¿ç¨‹å¯¹è±¡ä»"å½“å‰å·²åˆ›å»ºçº¿ç¨‹"åˆ—è¡¨ä¸­ç§»é™¤(ä¸å†å¤ç”¨)</span></span><br><span class="line">            self.generate_list.remove(current_thread)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">close</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        æ‰§è¡Œå®Œæ‰€æœ‰çš„ä»»åŠ¡åï¼Œæ‰€æœ‰çº¿ç¨‹åœæ­¢</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self.cancel = <span class="literal">True</span></span><br><span class="line">        <span class="comment"># è·å–å½“å‰çº¿ç¨‹åˆ—è¡¨çš„é•¿åº¦(æœ‰å¤šå°‘ä¸ªå¤ç”¨çš„çº¿ç¨‹)</span></span><br><span class="line">        full_size = len(self.generate_list)</span><br><span class="line">        <span class="comment"># å› ä¸ºä»»åŠ¡å·²ç»æ‰§è¡Œå®Œæ¯•,ä»»åŠ¡é˜Ÿåˆ—ä¸ºç©º,æ‰€æœ‰çš„çº¿ç¨‹éƒ½åœ¨ç­‰å¾…è·å–æ–°çš„ä»»åŠ¡</span></span><br><span class="line">        <span class="comment"># å‘ä»»åŠ¡é˜Ÿåˆ—ä¸­,æ’å…¥StopEventç©ºå€¼,è®©æ¯ä¸ªçº¿ç¨‹æ‹¿åˆ°è¿™ä¸ªä»»åŠ¡çš„æ—¶å€™,é€€å‡ºæ‰è‡ªå·±çš„çº¿ç¨‹</span></span><br><span class="line">        <span class="keyword">while</span> full_size:</span><br><span class="line">            <span class="comment"># å½“å‰å¯ä»¥å¤ç”¨çš„çº¿ç¨‹åˆ—è¡¨ä¸­æœ‰å¤šå°‘ä¸ªçº¿ç¨‹å¯¹è±¡å°±æ’å…¥å¤šå°‘ä¸ªç©ºå€¼</span></span><br><span class="line">            self.q.put(StopEvent)</span><br><span class="line">            full_size -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">terminate</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        æ— è®ºæ˜¯å¦è¿˜æœ‰ä»»åŠ¡ï¼Œç»ˆæ­¢çº¿ç¨‹</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self.terminal = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">		<span class="comment"># æŠŠé˜Ÿåˆ—ä¸­çš„æ‰€æœ‰ä»»åŠ¡å…¨éƒ¨è®¾ç½®ä¸ºç©ºå¯¹è±¡ï¼ˆç»“æŸçº¿ç¨‹çš„æ ‡è¯†ï¼‰</span></span><br><span class="line">		<span class="comment"># æ¯ä¸ªæ‹¿åˆ°è¿™ä¸ªç©ºå¯¹è±¡ä»»åŠ¡çš„çº¿ç¨‹éƒ½ä¼šç»“æŸè‡ªå·±çš„çº¿ç¨‹</span></span><br><span class="line">        <span class="keyword">while</span> self.generate_list:</span><br><span class="line">            self.q.put(StopEvent)</span><br><span class="line">		<span class="comment"># æ‰€æœ‰çš„çº¿ç¨‹éƒ½è¢«ç»“æŸåï¼Œæ¸…ç©ºé˜Ÿåˆ—ä¸­çš„æ‰€æœ‰å†…å®¹</span></span><br><span class="line">        self.q.empty()</span><br><span class="line"></span><br><span class="line">	<span class="comment"># ä¸Šä¸‹æ–‡ç®¡ç†çš„è£…é¥°å™¨ï¼Œä»¥ä¸‹å‡½æ•°å¯ä»¥è¢«withè°ƒç”¨æ‰§è¡Œ</span></span><br><span class="line"><span class="meta">    @contextlib.contextmanager</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">worker_state</span><span class="params">(self, state_list, worker_thread)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        ç”¨äºè®°å½•çº¿ç¨‹ä¸­æ­£åœ¨ç­‰å¾…çš„çº¿ç¨‹æ•°</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        state_list.append(worker_thread)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">yield</span></span><br><span class="line">        <span class="keyword">finally</span>:</span><br><span class="line">            state_list.remove(worker_thread)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="comment"># åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± </span></span><br><span class="line">    <span class="comment"># æœ€å¤šåŒæ—¶åˆ›å»º3ä¸ªçº¿ç¨‹åœ¨å¤„ç†ä»»åŠ¡ï¼ˆæ¶ˆè´¹è€…ä»é˜Ÿåˆ—ä¸­æ¶ˆè´¹æ•°æ®ï¼‰</span></span><br><span class="line">    <span class="comment"># ä»»åŠ¡é˜Ÿåˆ—ä¸­åŒä¸€æ—¶é—´æœ€å¤šå­˜æ”¾5ä¸ªä»»åŠ¡ï¼ˆç”Ÿäº§è€…å‘é˜Ÿåˆ—ä¸­å­˜æ”¾æ•°æ®ï¼‰</span></span><br><span class="line">    pool = ThreadPool(<span class="number">3</span>, max_task_num=<span class="number">5</span>)</span><br><span class="line">	</span><br><span class="line">	<span class="comment"># å›è°ƒå‡½æ•°ï¼Œæ¯ä¸€ä¸ªå­çº¿ç¨‹å¤„ç†å®Œä¸€ä¸ªä»»åŠ¡ä¹‹åï¼Œéƒ½ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•</span></span><br><span class="line">	<span class="comment"># ç”¨æ¥å¤„ç†å­çº¿ç¨‹æ‰§è¡Œä»»åŠ¡åçš„æ‰§è¡ŒçŠ¶æ€å’Œè¿”å›ç»“æœ</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">callback</span><span class="params">(status, result)</span>:</span></span><br><span class="line">        <span class="comment"># status, execute action status</span></span><br><span class="line">        <span class="comment"># result, execute action return value</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">	<span class="comment"># çœŸæ­£å®ç°å¤šçº¿ç¨‹çš„å‡½æ•°</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">action</span><span class="params">(i)</span>:</span></span><br><span class="line">        print(i)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># åˆ›å»º30ä¸ªä»»åŠ¡</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">30</span>):</span><br><span class="line">        <span class="comment"># æ¯ä¸€æ¬¡è¿­ä»£å°±æ‰§è¡Œä¸€æ¬¡runæ–¹æ³•</span></span><br><span class="line">        ret = pool.run(action, (i,), callback)</span><br><span class="line"></span><br><span class="line">    time.sleep(<span class="number">5</span>)</span><br><span class="line">    print(len(pool.generate_list), len(pool.free_list))</span><br><span class="line">    print(len(pool.generate_list), len(pool.free_list))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å…³é—­çº¿ç¨‹æ± </span></span><br><span class="line">    pool.close()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ç»ˆæ­¢çº¿ç¨‹æ± å¹¶æ¸…ç©ºä»»åŠ¡é˜Ÿåˆ—</span></span><br><span class="line">    <span class="comment"># pool.terminate()</span></span><br></pre></td></tr></table></figure>

<p><img src="http://oss.20150509.cn/20160724123859.png" alt=""></p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>å¤šçº¿ç¨‹</tag>
        <tag>çº¿ç¨‹æ± </tag>
      </tags>
  </entry>
  <entry>
    <title>è‡ªå®šä¹‰çº¿ç¨‹æ± çš„å®ç°æ€è·¯</title>
    <url>/2016/07/22/%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E5%AE%9E%E7%8E%B0%E6%80%9D%E8%B7%AF/</url>
    <content><![CDATA[<blockquote>
<p>åœ¨ä½¿ç”¨å¤šçº¿ç¨‹çš„è¿‡ç¨‹ä¸­ï¼Œä¸€æ—¦ä»»åŠ¡æ•°é‡è¿‡å¤šï¼Œå¦‚æœä¸å¯¹æ´¾ç”Ÿå‡ºæ¥çš„å­çº¿ç¨‹åšå‡ºé™åˆ¶çš„è¯ï¼Œå¤šçº¿ç¨‹ææœ‰å¯èƒ½ä¼šæ‹‰ä½ç¨‹åºçš„æ€§èƒ½ï¼Œè¿™æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ç»´æŠ¤ä¸€ä¸ªå›ºå®šæ•°é‡çš„çº¿ç¨‹ï¼Œä¹Ÿå°±æ˜¯çº¿ç¨‹æ± çš„æ¦‚å¿µ</p>
</blockquote>
<p>å®ç°çº¿ç¨‹æ± çš„æ€è·¯ï¼š</p>
<ul>
<li>è®¾ç½®çº¿ç¨‹æ± çš„å®¹é‡</li>
<li>æ¯å–èµ°ä¸€ä¸ªçº¿ç¨‹ï¼Œåœ¨çº¿ç¨‹æ± ä¸­å°±å‡å°‘ä¸€ä¸ªçº¿ç¨‹</li>
<li>æ¯ä¸ªå­çº¿ç¨‹çš„ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼ŒæŠŠè‡ªå·±çš„çº¿ç¨‹é…é¢æ”¾å›çº¿ç¨‹æ± ä¸­</li>
<li>å½“çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹å…¨éƒ¨åˆ†é…å®Œæ¯•ï¼Œæ–°çš„ä»»åŠ¡éœ€è¦ç­‰å¾…è·å–çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹</li>
</ul>
<p>åŸºäºä»¥ä¸Šçš„éœ€æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é˜Ÿåˆ—æ¥å®ç°çº¿ç¨‹æ± çš„åŠŸèƒ½</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> queue</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThreadPool</span>:</span></span><br><span class="line">    <span class="comment"># æ¥æ”¶çš„å®ä¾‹åŒ–å‚æ•°ä¸ºçº¿ç¨‹æ± çš„æœ€å¤§å®¹é‡</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, maxsize=<span class="number">5</span>)</span>:</span></span><br><span class="line">        self.maxsize = maxsize</span><br><span class="line"></span><br><span class="line">        <span class="comment"># è®¾ç½®é˜Ÿåˆ—çš„æœ€å¤§å®¹é‡</span></span><br><span class="line">        self.q = queue.Queue(maxsize)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># ç”¨çº¿ç¨‹ç±»å¡«æ»¡é˜Ÿåˆ—</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(maxsize):</span><br><span class="line">            self.q.put(threading.Thread)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_thread</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># ä»é˜Ÿåˆ—ä¸­å–å‡ºä¸€ä¸ªçº¿ç¨‹ç±»è¿”å›</span></span><br><span class="line">        <span class="keyword">return</span> self.q.get()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add_thread</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># å…ˆçº¿ç¨‹æ± æ·»åŠ ä¸€ä¸ªçº¿ç¨‹ç±»</span></span><br><span class="line">        <span class="comment"># ç”¨æ¥è¢«æ‰§è¡Œå®Œä»»åŠ¡çš„å‡½æ•°è°ƒç”¨,å®ç°å›æ”¶çº¿ç¨‹é…é¢çš„åŠŸèƒ½</span></span><br><span class="line">        self.q.put(threading.Thread)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">task</span><span class="params">(arg, pool)</span>:</span></span><br><span class="line">    <span class="string">"""æ¥æ”¶äº†ä¸€ä¸ªçº¿ç¨‹æ± å¯¹è±¡"""</span></span><br><span class="line">    print(arg)</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ‰§è¡Œå®Œæ¯•å‡½æ•°çš„ä¸»ä½“å,å°†æ‹¿åˆ°çš„çº¿ç¨‹é…é¢å†æ”¾å›åˆ°çº¿ç¨‹æ± ä¸­</span></span><br><span class="line">    pool.add_thread()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="comment"># åˆ›å»ºä¸€ä¸ªå®¹é‡ä¸º5çš„çº¿ç¨‹æ± </span></span><br><span class="line">    pool = ThreadPool(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">59</span>):</span><br><span class="line"></span><br><span class="line">        <span class="comment"># ä»çº¿ç¨‹æ± ä¸­æ‹¿åˆ°ä¸€ä¸ªçº¿ç¨‹å¯¹è±¡</span></span><br><span class="line">        <span class="comment"># ç›¸å½“äº t = threading.Thread</span></span><br><span class="line">        t = pool.get_thread()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># åˆ›å»ºå­çº¿ç¨‹å¯¹è±¡</span></span><br><span class="line">        <span class="comment"># æŠŠçº¿ç¨‹æ± å¯¹è±¡ä¼ é€’åˆ°æ‰§è¡Œå‡½æ•°ä¸­</span></span><br><span class="line">        o = t(target=task, args=(i, pool,))</span><br><span class="line"></span><br><span class="line">        o.start()</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>å¤šçº¿ç¨‹</tag>
        <tag>çº¿ç¨‹æ± </tag>
      </tags>
  </entry>
  <entry>
    <title>çº¿ç¨‹é”</title>
    <url>/2016/07/22/%E7%BA%BF%E7%A8%8B%E9%94%81/</url>
    <content><![CDATA[<blockquote>
<p>åœ¨å¤šçº¿ç¨‹çš„ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œéœ€è¦è€ƒè™‘çš„ä¸€ä¸ªé—®é¢˜å°±æ˜¯çº¿ç¨‹å®‰å…¨ã€‚å¦‚æœä½¿ç”¨å¤šçº¿ç¨‹å¯¹å¤šä¸ªå¯¹è±¡è¿›è¡Œæ“ä½œï¼Œä¹Ÿè®¸ä¸ä¼šæœ‰å¼‚å¸¸çš„æƒ…å†µçš„äº§ç”Ÿï¼Œå› ä¸ºæ¯ä¸ªå¯¹è±¡æ˜¯ç‹¬ç«‹çš„ï¼Œæ¯ä¸ªå¯¹è±¡çš„æ”¹å˜å¯¹å…¶ä»–å¯¹è±¡æ²¡æœ‰å½±å“ã€‚ä½†æ˜¯å¦‚æœä½¿ç”¨å¤šçº¿ç¨‹æ“ä½œåŒä¸€ä¸ªå¯¹è±¡ï¼Œææœ‰å¯èƒ½äº§ç”Ÿè„æ•°æ®ï¼›ä½†æ˜¯åŒæ—¶è®¿é—®åŒä¸€ä¸ªå¯¹è±¡ä¸ä¼šäº§ç”Ÿè„æ•°æ®</p>
</blockquote>
<h1 id="å¤šçº¿ç¨‹ä¿®æ”¹åŒä¸€å¯¹è±¡"><a href="#å¤šçº¿ç¨‹ä¿®æ”¹åŒä¸€å¯¹è±¡" class="headerlink" title="å¤šçº¿ç¨‹ä¿®æ”¹åŒä¸€å¯¹è±¡"></a>å¤šçº¿ç¨‹ä¿®æ”¹åŒä¸€å¯¹è±¡</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">NUM = <span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">()</span>:</span></span><br><span class="line">  <span class="keyword">global</span> NUM</span><br><span class="line">  NUM -= <span class="number">1</span></span><br><span class="line">  time.sleep(<span class="number">1</span>)</span><br><span class="line">  print(NUM)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">  t = threading.Thread(target=func)</span><br><span class="line">  t.start()</span><br><span class="line">  </span><br><span class="line">------------</span><br><span class="line"><span class="number">00</span></span><br><span class="line"> <span class="number">0</span></span><br><span class="line"> <span class="number">0</span></span><br><span class="line"><span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„å°ç¨‹åºä¸­ï¼Œå®šä¹‰äº†ä¸€ä¸ªå…¨å±€å˜é‡<code>NUM</code>ï¼Œåœ¨<code>func</code>æ–¹æ³•ä¸­å¯¹å…¨å±€å˜é‡<code>NUM</code>åšè‡ªå‡ä¸€çš„æ“ä½œï¼Œæˆ‘ä»¬ç†æƒ³ä¸­çš„ç»“æœæ˜¯</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">4</span><br><span class="line">3</span><br><span class="line">2</span><br><span class="line">1</span><br><span class="line">0</span><br></pre></td></tr></table></figure>

<p>ä½†å®é™…ç»“æœå´å…¨éƒ½æ˜¯0</p>
<p>è¿™æ˜¯å› ä¸ºæ¯ä¸ªçº¿ç¨‹è¿è¡Œåˆ°<code>sleep(1)</code>çš„æ—¶å€™éƒ½åœ¨è¿™é‡Œå¡ä½ï¼Œæœ€åï¼Œæ‰€æœ‰çš„çº¿ç¨‹éƒ½æ‰§è¡Œå®Œäº†<code>NUM -= 1</code>ï¼Œè¿™ä¸ªæ—¶å€™å…¨å±€å˜é‡<code>NUM</code>å·²ç»<code>=0</code>ï¼Œè€Œç¬¬ä¸€ä¸ªçº¿ç¨‹è¿˜æ²¡æœ‰æ‰§è¡Œå®Œ<code>sleep(1)</code>,æ‰€ä»¥æœ€åæ‰€æœ‰çš„çº¿ç¨‹æ‰“å°å‡ºæ¥çš„éƒ½æ˜¯0</p>
<h1 id="Lock"><a href="#Lock" class="headerlink" title="Lock"></a>Lock</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">NUM = <span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å‡½æ•°é‡Œæ¥æ”¶ä¸€ä¸ªé”å¯¹è±¡</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(lock)</span>:</span></span><br><span class="line">  <span class="keyword">global</span> NUM</span><br><span class="line"></span><br><span class="line">  <span class="comment"># è·å–é”</span></span><br><span class="line">  lock.acquire()</span><br><span class="line">  NUM -= <span class="number">1</span></span><br><span class="line">  time.sleep(<span class="number">1</span>)</span><br><span class="line">  print(NUM)</span><br><span class="line">  </span><br><span class="line">  <span class="comment"># é‡Šæ”¾é”</span></span><br><span class="line">  lock.release()</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªäº’æ–¥é”</span></span><br><span class="line">lock = threading.Lock()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">  <span class="comment"># æŠŠåˆ›å»ºçš„é”å¯¹è±¡å½“åšå‚æ•°ä¼ é€’ç»™å‡½æ•°</span></span><br><span class="line">  t = threading.Thread(target=func, args=(lock,))</span><br><span class="line">  t.start()</span><br><span class="line">  </span><br><span class="line">------------</span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">0</span></span><br></pre></td></tr></table></figure>

<h1 id="RLock"><a href="#RLock" class="headerlink" title="RLock"></a>RLock</h1><p>RLockå’ŒLockçš„ä½¿ç”¨æ–¹æ³•ç›¸åŒï¼Œä½†å´æ˜¯Lockçš„â€å‡çº§ç‰ˆâ€ï¼ŒRLockæ”¯æŒåœ¨å‡½æ•°å†…çš„å¤šå±‚åµŒå¥—é”ï¼Œä¾‹å¦‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">NUM = <span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å‡½æ•°é‡Œæ¥æ”¶ä¸€ä¸ªé”å¯¹è±¡</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(lock)</span>:</span></span><br><span class="line">  <span class="keyword">global</span> NUM</span><br><span class="line"></span><br><span class="line">  <span class="comment"># è·å–é”</span></span><br><span class="line">  lock.acquire()</span><br><span class="line">  NUM -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># åµŒå¥—é”</span></span><br><span class="line">  lock.acquire()</span><br><span class="line">  time.sleep(<span class="number">1</span>)</span><br><span class="line">  lock.release()</span><br><span class="line"></span><br><span class="line">  print(NUM)</span><br><span class="line">  </span><br><span class="line">  <span class="comment"># é‡Šæ”¾é”</span></span><br><span class="line">  lock.release()</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªäº’æ–¥é”</span></span><br><span class="line">lock = threading.RLock()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">  <span class="comment"># æŠŠåˆ›å»ºçš„é”å¯¹è±¡å½“åšå‚æ•°ä¼ é€’ç»™å‡½æ•°</span></span><br><span class="line">  t = threading.Thread(target=func, args=(lock,))</span><br><span class="line">  t.start()</span><br></pre></td></tr></table></figure>

<h1 id="Semaphore"><a href="#Semaphore" class="headerlink" title="Semaphore"></a>Semaphore</h1><p>ä¿¡å·é‡ï¼Œå¯ä»¥æ”¾å‡ºä¸€æ‰¹é”ï¼Œç±»ä¼¼äºæ‰¹é‡â€œæˆæƒâ€</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">NUM = <span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å‡½æ•°é‡Œæ¥æ”¶ä¸€ä¸ªé”å¯¹è±¡</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(i, lock)</span>:</span></span><br><span class="line">  <span class="keyword">global</span> NUM</span><br><span class="line"></span><br><span class="line">  <span class="comment"># è·å–é”ï¼Œè¿™é‡Œæœ€å¤šå¯ä»¥å‘æ”¾3æŠŠé”</span></span><br><span class="line">  lock.acquire()</span><br><span class="line">  NUM -= <span class="number">1</span></span><br><span class="line">  time.sleep(<span class="number">1</span>)</span><br><span class="line">  print(i, NUM)</span><br><span class="line">  </span><br><span class="line">  <span class="comment"># é‡Šæ”¾é”</span></span><br><span class="line">  lock.release()</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªé”,é”çš„æ•°é‡æœ‰3ä¸ª</span></span><br><span class="line">lock = threading.BoundedSemaphore(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">  <span class="comment"># æŠŠåˆ›å»ºçš„é”å¯¹è±¡å½“åšå‚æ•°ä¼ é€’ç»™å‡½æ•°</span></span><br><span class="line">  t = threading.Thread(target=func, args=(i, lock,))</span><br><span class="line">  t.start()</span><br><span class="line">  </span><br><span class="line">------------</span><br><span class="line"><span class="number">0</span> <span class="number">2</span></span><br><span class="line"><span class="number">1</span> <span class="number">2</span></span><br><span class="line"><span class="number">2</span> <span class="number">2</span></span><br><span class="line"><span class="number">4</span> <span class="number">0</span></span><br><span class="line"><span class="number">3</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>ä»ç»“æœä¸­å¯ä»¥çœ‹å‡ºï¼Œæ€»å…±æœ‰3æŠŠé”è¢«æ”¾å‡ºï¼Œæ‰€ä»¥å‰ä¸‰ä¸ªçº¿ç¨‹æ‰“å°å€¼æ˜¯ç›¸åŒçš„ï¼Œä¸‰ä¸ªçº¿ç¨‹ä¾æ¬¡ä¿®æ”¹<code>NUM</code>çš„å€¼ï¼Œç„¶åä¾æ¬¡è¿›å…¥<code>time.sleep(1)</code>ç­‰å¾…ï¼ˆæ­¤æ—¶NUMå·²ç»è¢«è‡ªå‡äº†3æ¬¡ï¼Œå€¼=2ï¼‰ï¼Œæœ€åä¾æ¬¡æ‰“å°å‡º<code>NUM</code>çš„å€¼</p>
<h1 id="event"><a href="#event" class="headerlink" title="event"></a>event</h1><p>äº‹ä»¶, åŒæ ·æ˜¯â€œæ‰¹é‡æˆæƒâ€ï¼Œä½†æ˜¯å’Œä¿¡å·é‡æŒ‡å®šåˆ›å»ºé”çš„æ•°é‡ä¸åŒçš„æ˜¯ï¼Œäº‹ä»¶è¦ä¹ˆé”ä½æ‰€æœ‰çš„çº¿ç¨‹ï¼Œè¦ä¹ˆé‡Šæ”¾æ‰€æœ‰çš„çº¿ç¨‹ï¼Œä¸èƒ½è‡ªå®šä¹‰é”çš„æ•°é‡</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¥æ”¶ä¸€ä¸ªeventå¯¹è±¡</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(i, event)</span>:</span></span><br><span class="line">    print(i)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è¿™é‡Œçš„wait()æ–¹æ³•ä¼šé˜»å¡æ‰€æœ‰çš„çº¿ç¨‹,ä½†æ˜¯æ˜¯å¦é˜»å¡å–å†³äºeventç»´æŠ¤çš„å…¨å±€Flag</span></span><br><span class="line">    event.wait()  <span class="comment"># waitä¼šå»æ£€æµ‹"Flag"çš„å€¼çš„çœŸå‡</span></span><br><span class="line">    print(i + <span class="number">100</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªeventå¯¹è±¡</span></span><br><span class="line">event = threading.Event()</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®eventå¯¹è±¡ä¸­çš„"Flag"ä¸ºFalse</span></span><br><span class="line"><span class="comment"># é»˜è®¤æƒ…å†µä¸‹å°±æ˜¯False</span></span><br><span class="line">event.clear()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">    t = threading.Thread(target=func, args=(i, event))</span><br><span class="line">    t.start()</span><br><span class="line"></span><br><span class="line">inp = input(<span class="string">"&gt; "</span>)</span><br><span class="line"><span class="keyword">if</span> inp == <span class="string">"go"</span>:</span><br><span class="line">    <span class="comment"># è®¾ç½®eventå¯¹è±¡ä¸­çš„"Flag"ä¸ºTrue</span></span><br><span class="line">    <span class="comment"># é‡Šæ”¾äº†æ‰€æœ‰çš„é”</span></span><br><span class="line">    event.set()</span><br><span class="line">    </span><br><span class="line">------------</span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line">&gt; go</span><br><span class="line"><span class="number">100</span></span><br><span class="line"><span class="number">103</span></span><br><span class="line"><span class="number">101</span></span><br><span class="line"><span class="number">104</span></span><br><span class="line"><span class="number">102</span></span><br></pre></td></tr></table></figure>

<ul>
<li>waitï¼šæ£€æµ‹â€œFlagâ€çš„å€¼</li>
<li>clearï¼šå°†â€œFlagâ€è®¾ç½®ä¸ºFalse</li>
<li>setï¼šå°†â€œFlagâ€è®¾ç½®ä¸ºTrue</li>
</ul>
<h1 id="Condition"><a href="#Condition" class="headerlink" title="Condition"></a>Condition</h1><p>æ¡ä»¶ï¼Œä¸Šé¢è¯´äº†äº‹ä»¶çš„ç‰¹æ€§ï¼Œå°±æ˜¯è¦é˜»å¡å°±é˜»å¡ä½æ‰€æœ‰çš„å­çº¿ç¨‹ï¼Œè¦é‡Šæ”¾å°±é‡Šæ”¾æ‰æ‰€æœ‰çš„é”ï¼Œä¸æ”¯æŒä¿¡å·é‡ä¸­çš„è‡ªå®šä¹‰é‡Šæ”¾é”çš„æ•°é‡</p>
<p>æ¡ä»¶é”ï¼Œæ—¢æ”¯æŒäº‹ä»¶é˜»å¡æ‰€æœ‰å­çº¿ç¨‹çš„ç‰¹æ€§ï¼Œåˆå…·æœ‰ä¿¡å·é‡æŒ‡å®šé‡Šæ”¾é”æ•°é‡çš„ç‰¹æ€§</p>
<h2 id="conditionçš„ç¬¬ä¸€ç§ç”¨æ³•"><a href="#conditionçš„ç¬¬ä¸€ç§ç”¨æ³•" class="headerlink" title="conditionçš„ç¬¬ä¸€ç§ç”¨æ³•"></a>conditionçš„ç¬¬ä¸€ç§ç”¨æ³•</h2><p>æŒ‡å®šé‡Šæ”¾é”çš„æ•°é‡</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¥æ”¶ä¸€ä¸ªconditionå¯¹è±¡</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(i, con)</span>:</span></span><br><span class="line">    print(i)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ç»™çº¿ç¨‹ä¸Šé”</span></span><br><span class="line">    con.acquire()</span><br><span class="line">    <span class="comment"># waitä¼šæ ¹æ®notifyæŒ‡å®šçš„æ•°é‡å»é‡Šæ”¾é”,é»˜è®¤é”ä½æ‰€æœ‰çº¿ç¨‹</span></span><br><span class="line">    con.wait()</span><br><span class="line">    print(i + <span class="number">100</span>)</span><br><span class="line">    con.release()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">condition = threading.Condition()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">    t = threading.Thread(target=func, args=(i, condition))</span><br><span class="line">    t.start()</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    inp = input(<span class="string">"&gt; "</span>)</span><br><span class="line">    <span class="keyword">if</span> inp == <span class="string">"q"</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># æŒ‡å®šé‡Šæ”¾é”æ•°é‡çš„ä¸‰å‰‘å®¢</span></span><br><span class="line">    <span class="comment"># è¯­æ³•ä¸­è§„å®šä»–ä»¬å¿…é¡»æŒ‰ç…§è¿™ä¸ªé¡ºåºå†™</span></span><br><span class="line">    condition.acquire()</span><br><span class="line">    condition.notify(int(inp))  <span class="comment"># è¿™é‡Œçš„intç±»å‹çš„inpå˜é‡,å°±æ˜¯æŒ‡å®šé‡Šæ”¾é”çš„æ•°é‡</span></span><br><span class="line">    condition.release()</span><br><span class="line">    </span><br><span class="line">------------</span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line">&gt; <span class="number">1</span></span><br><span class="line">&gt; <span class="number">100</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line">&gt; <span class="number">102</span></span><br><span class="line"><span class="number">101</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line">&gt; <span class="number">104</span></span><br><span class="line"><span class="number">103</span></span><br></pre></td></tr></table></figure>

<p>æœ€ååªæ‰“å°ä¸¤ä¸ªæ•°å­—ï¼Œæ˜¯å› ä¸ºæ€»å…±æœ‰5ä¸ªæµ‹è¯•æ•°æ®ï¼Œå‰é¢å·²ç»ç´¯è®¡é‡Šæ”¾äº†ä¸‰ä¸ªå­çº¿ç¨‹å¤„ç†çš„æµ‹è¯•æ•°æ®ï¼Œæ‰€ä»¥ç¬¬ä¸‰æ¬¡ï¼Œæˆ‘å³ä½¿æŒ‡å®šäº†é‡Šæ”¾3ä¸ªé”ï¼ˆå½“æ—¶ç¨‹åºä¸­åªå‰©ä¸¤ä¸ªå­çº¿ç¨‹è¢«é”ä½ï¼‰ï¼Œä¹Ÿåªä¼šå‡ºç°2ä¸ªå€¼</p>
<h1 id="conditionçš„ç¬¬äºŒç§ç”¨æ³•"><a href="#conditionçš„ç¬¬äºŒç§ç”¨æ³•" class="headerlink" title="conditionçš„ç¬¬äºŒç§ç”¨æ³•"></a>conditionçš„ç¬¬äºŒç§ç”¨æ³•</h1><p>å¦‚æœæ¡ä»¶ä¸ºçœŸï¼Œé‡Šæ”¾ä¸€ä¸ªé”</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">select</span><span class="params">()</span>:</span></span><br><span class="line">    ret = <span class="literal">False</span></span><br><span class="line">    inp = input(<span class="string">"&gt; "</span>)</span><br><span class="line">    <span class="keyword">if</span> inp == <span class="string">"true"</span>:</span><br><span class="line">        ret = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        ret = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> ret</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¥æ”¶ä¸€ä¸ªconditionå¯¹è±¡</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(i, con)</span>:</span></span><br><span class="line">    print(i)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ç»™çº¿ç¨‹ä¸Šé”</span></span><br><span class="line">    con.acquire()</span><br><span class="line">    <span class="comment"># wait_forä¼šæ ¹æ®å‚æ•°çš„å€¼çš„çœŸå‡æ¥é€‰æ‹©æ˜¯å¦é‡Šæ”¾ä¸€ä¸ªé”</span></span><br><span class="line">    <span class="comment"># è¿™é‡Œä¼ å…¥çš„æ˜¯ä¸€ä¸ªå‡½æ•°,ä¹Ÿå°±æ˜¯è¯´å¦‚æœå‡½æ•°çš„è¿”å›å€¼ä¸ºçœŸ,å°±é‡Šæ”¾ä¸€ä¸ªé”</span></span><br><span class="line">    con.wait_for(select)</span><br><span class="line">    print(i + <span class="number">100</span>)</span><br><span class="line">    con.release()</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºä¸€æŠŠæ¡ä»¶é”</span></span><br><span class="line">condition = threading.Condition()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">    t = threading.Thread(target=func, args=(i, condition))</span><br><span class="line">    t.start()</span><br><span class="line">    </span><br><span class="line">------------</span><br><span class="line"><span class="number">0</span></span><br><span class="line">&gt; <span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line">true</span><br><span class="line"><span class="number">100</span></span><br><span class="line">&gt; true</span><br><span class="line"><span class="number">101</span></span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<p>åœ¨<code>con.wait_for(select)</code>ä¸­ï¼Œæˆ‘ä»¬ä¼ å…¥äº†ä¸€ä¸ªå‡½æ•°åï¼Œå½“ç¬¬ä¸€ä¸ªå­çº¿ç¨‹æ‰§è¡Œåˆ°è¿™ä¸€è¡Œçš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨å»æ‰§è¡Œè¿™ä¸ªå‡½æ•°ï¼Œä»è€Œæ‰“å°å‡ºäº†ç¬¬ä¸€ä¸ª<code>&gt;</code>ç¬¦å·ï¼Œä¹‹åå°±åœåœ¨äº†ç­‰å¾…ç”¨æˆ·è¾“å…¥çš„é‚£ä¸€è¡Œ<code>input()</code></p>
<p>å…¶ä»–æ‰€æœ‰çš„å­çº¿ç¨‹éƒ½åœåœ¨äº†<code>con.acquare()</code>è¿™ä¸€è¡Œï¼Œç­‰å¾…å‰é¢çš„å­çº¿ç¨‹é‡Šæ”¾é”</p>
<p>è¿™æ—¶ï¼Œæˆ‘è¾“å…¥ä¸€ä¸ª<code>true</code>ï¼Œ<code>select</code>å‡½æ•°è¿”å›äº†ä¸€ä¸ª<code>True</code>, <code>wait_for()</code>æ¥æ”¶åˆ°è¿™ä¸ª<code>True</code>ä¹‹åï¼Œå°±ç»§ç»­å‘ä¸‹æ‰§è¡Œï¼Œæœ€åé‡Šæ”¾æ‰è‡ªå·±çš„é”</p>
<p>æ¥ç€ä¸‹ä¸€ä¸ªè¢«è°ƒåº¦åˆ°çš„å­çº¿ç¨‹æ‰§è¡Œåˆ°<code>wait_for()</code>åˆå»æ‰§è¡Œäº†é‡Œé¢ä¼ å…¥çš„å‡½æ•°â€¦â€¦ä»¥æ­¤ç±»æ¨</p>
<h1 id="Timer"><a href="#Timer" class="headerlink" title="Timer"></a>Timer</h1><p>Timerä¸æ˜¯é”ï¼Œæ˜¯å®šæ—¶å™¨ï¼Œç”¨æ¥æŒ‡å®šxç§’åæ‰§è¡ŒæŸäº›æ“ä½œ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Timer</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"hello, world"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">t = Timer(<span class="number">1</span>, hello)</span><br><span class="line">t.start()</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">hello, world</span><br></pre></td></tr></table></figure>

<p>ç»“æœæ²¡æœ‰ç«‹å³è¾“å…¥ï¼Œè€Œæ˜¯ç­‰äº†ä¸€ç§’é’Ÿä¹‹åè¾“å‡ºäº†<code>hello, world</code></p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>çº¿ç¨‹é”</tag>
        <tag>äº’æ–¥é”</tag>
        <tag>å¤šçº¿ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title>ESXi6.0è°ƒç”¨å¯¹è±¡datastoreSystemå¤±è´¥</title>
    <url>/2016/07/20/ESXi6-0%E8%B0%83%E7%94%A8%E5%AF%B9%E8%B1%A1datastoreSystem%E5%A4%B1%E8%B4%A5/</url>
    <content><![CDATA[<blockquote>
<p>VMware vSphere Clientä¸Šæ·»åŠ å­˜å‚¨æ—¶æ˜¾ç¤ºï¼šåœ¨ ESXiâ€œ192.168.59.59â€ä¸Šè°ƒç”¨å¯¹è±¡ â€œdatastoresystemâ€çš„â€œHostDatastoreSystem.QueryVmfsDatastoreCreateOptionsâ€ å¤±è´¥</p>
</blockquote>
<ul>
<li>åœ¨è¯¥ä¸»æœºçš„<code>é…ç½®</code>â€”&gt;<code>å®‰å…¨é…ç½®æ–‡ä»¶</code>ä¸­ï¼Œå¼€å¯<code>SSH</code>å’Œ<code>ESXi Shell</code>æœåŠ¡</li>
<li>ssh <a href="mailto:root@192.168.59.59">root@192.168.59.59</a></li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; ls /vmfs/devices/disks</span><br><span class="line">naa.6782bcb0635695001f1f261018908d00</span><br><span class="line">naa.6782bcb0635695001f1f261018908d00:1</span><br><span class="line">naa.6782bcb0635695001f1f261018908d00:2</span><br><span class="line">naa.6782bcb0635695001f1f261018908d00:3</span><br><span class="line">naa.6782bcb0635695001f1f261018908d00:5</span><br><span class="line">naa.6782bcb0635695001f1f261018908d00:6</span><br><span class="line">naa.6782bcb0635695001f1f261018908d00:7</span><br><span class="line">naa.6782bcb0635695001f1f261018908d00:8</span><br><span class="line">naa.6782bcb0635695001f1f261018908d00:9</span><br><span class="line">naa.6782bcb0635695001f21a2451bd15e08</span><br><span class="line">naa.6782bcb0635695001f21a2451bd15e08:1</span><br><span class="line">naa.6782bcb0635695001f21a2451bd15e08:2</span><br><span class="line">naa.6782bcb0635695001f21a25f1d533c53</span><br><span class="line">naa.6782bcb0635695001f21a25f1d533c53:1</span><br><span class="line">vml.02000000006782bcb0635695001f1f261018908d00504552432036</span><br><span class="line">vml.02000000006782bcb0635695001f1f261018908d00504552432036:1</span><br><span class="line">vml.02000000006782bcb0635695001f1f261018908d00504552432036:2</span><br><span class="line">vml.02000000006782bcb0635695001f1f261018908d00504552432036:3</span><br><span class="line">vml.02000000006782bcb0635695001f1f261018908d00504552432036:5</span><br><span class="line">vml.02000000006782bcb0635695001f1f261018908d00504552432036:6</span><br><span class="line">vml.02000000006782bcb0635695001f1f261018908d00504552432036:7</span><br><span class="line">vml.02000000006782bcb0635695001f1f261018908d00504552432036:8</span><br><span class="line">vml.02000000006782bcb0635695001f1f261018908d00504552432036:9</span><br><span class="line">vml.02000000006782bcb0635695001f21a2451bd15e08504552432036</span><br><span class="line">vml.02000000006782bcb0635695001f21a2451bd15e08504552432036:1</span><br><span class="line">vml.02000000006782bcb0635695001f21a2451bd15e08504552432036:2</span><br><span class="line">vml.02000000006782bcb0635695001f21a25f1d533c53504552432036</span><br><span class="line">vml.02000000006782bcb0635695001f21a25f1d533c53504552432036:1</span><br></pre></td></tr></table></figure>

<ul>
<li>vSphere Clientä¸­æ‰¾åˆ°æŠ¥é”™çš„é‚£å—ç£ç›˜åå­—ï¼Œæˆ‘è¿™é‡Œæ˜¯<code>naa.6782bcb0635695001f21a2451bd15e08</code></li>
<li>å°†è¯¥å—ç£ç›˜é‡æ–°åˆ†åŒº</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; partedUtil mklabel /dev/disks/naa.6782bcb0635695001f21a2451bd15e08 gpt</span><br></pre></td></tr></table></figure>

<p>æˆ‘è¿™é‡Œçš„ç£ç›˜å®¹é‡ä¸º2Tï¼Œè¿™é‡Œä½¿ç”¨gptåˆ†åŒºè¡¨ï¼Œå¦‚æœå®¹é‡ä¸æ˜¯å¾ˆå¤§ï¼Œå¯ä»¥å†™<code>msdos</code> ä½¿ç”¨MBRåˆ†åŒºè¡¨</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; ls /vmfs/devices/disks</span><br><span class="line">naa.6782bcb0635695001f1f261018908d00</span><br><span class="line">naa.6782bcb0635695001f1f261018908d00:1</span><br><span class="line">naa.6782bcb0635695001f1f261018908d00:2</span><br><span class="line">naa.6782bcb0635695001f1f261018908d00:3</span><br><span class="line">naa.6782bcb0635695001f1f261018908d00:5</span><br><span class="line">naa.6782bcb0635695001f1f261018908d00:6</span><br><span class="line">naa.6782bcb0635695001f1f261018908d00:7</span><br><span class="line">naa.6782bcb0635695001f1f261018908d00:8</span><br><span class="line">naa.6782bcb0635695001f1f261018908d00:9</span><br><span class="line">naa.6782bcb0635695001f21a2451bd15e08</span><br><span class="line">naa.6782bcb0635695001f21a25f1d533c53</span><br><span class="line">naa.6782bcb0635695001f21a25f1d533c53:1</span><br><span class="line">vml.02000000006782bcb0635695001f1f261018908d00504552432036</span><br><span class="line">vml.02000000006782bcb0635695001f1f261018908d00504552432036:1</span><br><span class="line">vml.02000000006782bcb0635695001f1f261018908d00504552432036:2</span><br><span class="line">vml.02000000006782bcb0635695001f1f261018908d00504552432036:3</span><br><span class="line">vml.02000000006782bcb0635695001f1f261018908d00504552432036:5</span><br><span class="line">vml.02000000006782bcb0635695001f1f261018908d00504552432036:6</span><br><span class="line">vml.02000000006782bcb0635695001f1f261018908d00504552432036:7</span><br><span class="line">vml.02000000006782bcb0635695001f1f261018908d00504552432036:8</span><br><span class="line">vml.02000000006782bcb0635695001f1f261018908d00504552432036:9</span><br><span class="line">vml.02000000006782bcb0635695001f21a2451bd15e08504552432036</span><br><span class="line">vml.02000000006782bcb0635695001f21a25f1d533c53504552432036</span><br><span class="line">vml.02000000006782bcb0635695001f21a25f1d533c53504552432036:1</span><br></pre></td></tr></table></figure>

<p>å†æ¬¡æ·»åŠ ç£ç›˜ï¼ŒæˆåŠŸï¼</p>
<hr>
<p>å‚è€ƒæ–‡æ¡£ï¼š <a href="https://kb.vmware.com/selfservice/microsites/search.do?cmd=displayKC&amp;externalId=2076191" target="_blank" rel="noopener">https://kb.vmware.com/selfservice/microsites/search.do?cmd=displayKC&amp;externalId=2076191</a></p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>ESXi</tag>
        <tag>vSphere</tag>
        <tag>vmware</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonä¸­å…ˆè¿›å…ˆå‡ºé˜Ÿåˆ—queueçš„åŸºæœ¬ä½¿ç”¨</title>
    <url>/2016/07/20/Python%E4%B8%AD%E5%85%88%E8%BF%9B%E5%85%88%E5%87%BA%E9%98%9F%E5%88%97queue%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/</url>
    <content><![CDATA[<blockquote>
<p>ç”Ÿæ´»ä¸­éå¸¸å¸¸è§çš„ä¸€ç§åœºæ™¯å°±æ˜¯æ’é˜Ÿï¼Œæ—©æœŸçš„é¸Ÿå„¿ğŸ¦æœ‰è™«ğŸ›åƒï¼Œè¶Šæ—©æ’é˜Ÿå°±è¶Šæ—©èƒ½åŠç†ä¸šåŠ¡ã€‚æœ¬ç¯‡æ–‡ç« ä»‹ç»Pythonä¸­çš„â€œæ’é˜Ÿç³»ç»Ÿâ€ï¼Œå…ˆè¿›å…ˆå‡ºé˜Ÿåˆ—çš„åŸºæœ¬ä½¿ç”¨</p>
</blockquote>
<h1 id="putæ•°æ®"><a href="#putæ•°æ®" class="headerlink" title="putæ•°æ®"></a>putæ•°æ®</h1><h2 id="æ¶ˆæ¯é˜Ÿåˆ—çš„é•¿åº¦"><a href="#æ¶ˆæ¯é˜Ÿåˆ—çš„é•¿åº¦" class="headerlink" title="æ¶ˆæ¯é˜Ÿåˆ—çš„é•¿åº¦"></a>æ¶ˆæ¯é˜Ÿåˆ—çš„é•¿åº¦</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å…ˆè¿›å…ˆå‡ºé˜Ÿåˆ—</span></span><br><span class="line"><span class="keyword">import</span> queue</span><br><span class="line"></span><br><span class="line"><span class="comment"># æœ€å¤šæ¥æ”¶10ä¸ªæ•°æ®</span></span><br><span class="line">q = queue.Queue(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># put å‘é˜Ÿåˆ—ä¸­æ·»åŠ æ•°æ®</span></span><br><span class="line">q.put(<span class="number">15</span>)</span><br><span class="line">q.put(<span class="number">59</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–å½“å‰é˜Ÿåˆ—é•¿åº¦</span></span><br><span class="line">print(q.qsize())</span><br><span class="line"></span><br><span class="line"><span class="comment"># å–å‡ºæœ€å‰é¢çš„ä¸€ä¸ªæ•°æ®</span></span><br><span class="line">print(q.get())</span><br></pre></td></tr></table></figure>

<h2 id="è¶…æ—¶æ—¶é—´"><a href="#è¶…æ—¶æ—¶é—´" class="headerlink" title="è¶…æ—¶æ—¶é—´"></a>è¶…æ—¶æ—¶é—´</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å…ˆè¿›å…ˆå‡ºé˜Ÿåˆ—</span></span><br><span class="line"><span class="keyword">import</span> queue</span><br><span class="line"></span><br><span class="line"><span class="comment"># æœ€å¤šæ¥æ”¶10ä¸ªæ•°æ®</span></span><br><span class="line">q = queue.Queue(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># put å‘é˜Ÿåˆ—ä¸­æ·»åŠ æ•°æ®</span></span><br><span class="line">q.put(<span class="number">15</span>)</span><br><span class="line">q.put(<span class="number">59</span>)</span><br><span class="line">print(q.qsize())</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¶…æ—¶æ—¶é—´ä¸º2ç§’</span></span><br><span class="line">q.put(<span class="string">'PolarSnow'</span>, timeout=<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–å½“å‰é˜Ÿåˆ—é•¿åº¦</span></span><br><span class="line">print(q.qsize())</span><br><span class="line"></span><br><span class="line"><span class="comment"># å–å‡ºæœ€å‰é¢çš„ä¸€ä¸ªæ•°æ®</span></span><br><span class="line">print(q.get())</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line"><span class="number">2</span></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"/Users/lvrui/PycharmProjects/untitled/10/temp.py"</span>, line <span class="number">157</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    q.put(<span class="string">'PolarSnow'</span>, timeout=<span class="number">2</span>)</span><br><span class="line">  File <span class="string">"/Library/Frameworks/Python.framework/Versions/3.5/lib/python3.5/queue.py"</span>, line <span class="number">141</span>, <span class="keyword">in</span> put</span><br><span class="line">    <span class="keyword">raise</span> Full</span><br><span class="line">queue.Full</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨é˜Ÿåˆ—çš„æœ€å¤§é•¿åº¦è®¾ç½®ä¸º2ï¼Œå½“ç¬¬ä¸‰ä¸ªæ•°æ®å‘é‡Œé¢æ’å…¥æ—¶ï¼Œæœ€å¤šç­‰å¾…ä¸¤ç§’ï¼Œä¸¤ç§’åè¿˜æ²¡æœ‰è¿›å…¥åˆ°é˜Ÿåˆ—ä¸­å°±æŠ¥é”™</p>
<h2 id="è®¾ç½®é˜Ÿåˆ—ä¸é˜»å¡"><a href="#è®¾ç½®é˜Ÿåˆ—ä¸é˜»å¡" class="headerlink" title="è®¾ç½®é˜Ÿåˆ—ä¸é˜»å¡"></a>è®¾ç½®é˜Ÿåˆ—ä¸é˜»å¡</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å…ˆè¿›å…ˆå‡ºé˜Ÿåˆ—</span></span><br><span class="line"><span class="keyword">import</span> queue</span><br><span class="line"></span><br><span class="line"><span class="comment"># æœ€å¤šæ¥æ”¶10ä¸ªæ•°æ®</span></span><br><span class="line">q = queue.Queue(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># put å‘é˜Ÿåˆ—ä¸­æ·»åŠ æ•°æ®</span></span><br><span class="line">q.put(<span class="number">15</span>)</span><br><span class="line">q.put(<span class="number">59</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®é˜Ÿåˆ—ä¸é˜»å¡(å½“é˜Ÿåˆ—æ»¡çš„æ—¶å€™å†æ’å…¥æ•°æ®,ç›´æ¥æŠ¥é”™)</span></span><br><span class="line">q.put(<span class="string">'PolarSnow'</span>, block=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–å½“å‰é˜Ÿåˆ—é•¿åº¦</span></span><br><span class="line">print(q.qsize())</span><br><span class="line"></span><br><span class="line"><span class="comment"># å–å‡ºæœ€å‰é¢çš„ä¸€ä¸ªæ•°æ®</span></span><br><span class="line">print(q.get())</span><br></pre></td></tr></table></figure>

<p>é»˜è®¤ç¨‹åºä¼šé˜»å¡ï¼Œç­‰å¾…æ–°çš„å€¼æ’å…¥åˆ°é˜Ÿåˆ—å½“ä¸­ï¼Œä½¿ç”¨äº†<code>block=False</code>å‚æ•°åï¼Œå¼ºåˆ¶è®¾ç½®ä¸ºä¸é˜»å¡ï¼Œä¸€æ—¦è¶…å‡ºé˜Ÿåˆ—é•¿åº¦ï¼Œç«‹å³æŠ›å‡ºå¼‚å¸¸</p>
<h1 id="getæ•°æ®"><a href="#getæ•°æ®" class="headerlink" title="getæ•°æ®"></a>getæ•°æ®</h1><h2 id="è®¾ç½®è¶…æ—¶æ—¶é—´"><a href="#è®¾ç½®è¶…æ—¶æ—¶é—´" class="headerlink" title="è®¾ç½®è¶…æ—¶æ—¶é—´"></a>è®¾ç½®è¶…æ—¶æ—¶é—´</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> queue</span><br><span class="line"></span><br><span class="line">q = queue.Queue(<span class="number">2</span>)</span><br><span class="line">q.put(<span class="number">15</span>)</span><br><span class="line">q.put(<span class="number">59</span>)</span><br><span class="line"></span><br><span class="line">print(q.qsize())</span><br><span class="line">print(q.get())</span><br><span class="line">print(q.get())</span><br><span class="line">print(q.get(timeout=<span class="number">2</span>))</span><br></pre></td></tr></table></figure>
<p>å½“å–å€¼çš„æ¬¡æ•°å¤§äºé˜Ÿåˆ—çš„é•¿åº¦çš„æ—¶å€™å°±ä¼šäº§ç”Ÿé˜»å¡ï¼Œè®¾ç½®è¶…æ—¶æ—¶é—´æ„ä¸ºæœ€å¤šç­‰å¾…xç§’ï¼Œé˜Ÿåˆ—ä¸­å†æ²¡æœ‰æ•°æ®ï¼Œå°±æŠ›å‡ºå¼‚å¸¸</p>
<h2 id="è®¾ç½®ä¸é˜»å¡"><a href="#è®¾ç½®ä¸é˜»å¡" class="headerlink" title="è®¾ç½®ä¸é˜»å¡"></a>è®¾ç½®ä¸é˜»å¡</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> queue</span><br><span class="line"></span><br><span class="line">q = queue.Queue(<span class="number">2</span>)</span><br><span class="line">q.put(<span class="number">15</span>)</span><br><span class="line">q.put(<span class="number">59</span>)</span><br><span class="line"></span><br><span class="line">print(q.qsize())</span><br><span class="line">print(q.get())</span><br><span class="line">print(q.get())</span><br><span class="line">print(q.get(block=<span class="literal">False</span>))</span><br></pre></td></tr></table></figure>

<p>è·å–é˜Ÿåˆ—çš„æ¬¡æ•°å¤§äºé˜Ÿåˆ—é•¿åº¦æ—¶ï¼Œé»˜è®¤ä¼šé˜»å¡ï¼Œé€šè¿‡è®¾ç½®<code>block=False</code>æ¥å®ç°éé˜»å¡ï¼Œç«‹å³æŠ›å‡ºå¼‚å¸¸</p>
<h1 id="Queueç±»"><a href="#Queueç±»" class="headerlink" title="Queueç±»"></a>Queueç±»</h1><h2 id="init"><a href="#init" class="headerlink" title="__init__"></a>__init__</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, maxsize=<span class="number">0</span>)</span>:</span></span><br><span class="line">    self.maxsize = maxsize</span><br><span class="line">    self._init(maxsize)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># mutex must be held whenever the queue is mutating.  All methods</span></span><br><span class="line">    <span class="comment"># that acquire mutex must release it before returning.  mutex</span></span><br><span class="line">    <span class="comment"># is shared between the three conditions, so acquiring and</span></span><br><span class="line">    <span class="comment"># releasing the conditions also acquires and releases mutex.</span></span><br><span class="line">    self.mutex = threading.Lock()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Notify not_empty whenever an item is added to the queue; a</span></span><br><span class="line">    <span class="comment"># thread waiting to get is notified then.</span></span><br><span class="line">    self.not_empty = threading.Condition(self.mutex)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Notify not_full whenever an item is removed from the queue;</span></span><br><span class="line">    <span class="comment"># a thread waiting to put is notified then.</span></span><br><span class="line">    self.not_full = threading.Condition(self.mutex)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Notify all_tasks_done whenever the number of unfinished tasks</span></span><br><span class="line">    <span class="comment"># drops to zero; thread waiting to join() is notified to resume</span></span><br><span class="line">    self.all_tasks_done = threading.Condition(self.mutex)</span><br><span class="line">    self.unfinished_tasks = <span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœä¸ç»™è¿™ä¸ªæ„é€ æ–¹æ³•ä¼ å‚æ•°ï¼Œé˜Ÿåˆ—çš„é•¿åº¦ä¸ºæ— é™å¤§</p>
<h2 id="get"><a href="#get" class="headerlink" title="get"></a>get</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, block=True, timeout=None)</span>:</span></span><br><span class="line">    <span class="string">'''Remove and return an item from the queue.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    If optional args 'block' is true and 'timeout' is None (the default),</span></span><br><span class="line"><span class="string">    block if necessary until an item is available. If 'timeout' is</span></span><br><span class="line"><span class="string">    a non-negative number, it blocks at most 'timeout' seconds and raises</span></span><br><span class="line"><span class="string">    the Empty exception if no item was available within that time.</span></span><br><span class="line"><span class="string">    Otherwise ('block' is false), return an item if one is immediately</span></span><br><span class="line"><span class="string">    available, else raise the Empty exception ('timeout' is ignored</span></span><br><span class="line"><span class="string">    in that case).</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    <span class="keyword">with</span> self.not_empty:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> block:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> self._qsize():</span><br><span class="line">                <span class="keyword">raise</span> Empty</span><br><span class="line">        <span class="keyword">elif</span> timeout <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">while</span> <span class="keyword">not</span> self._qsize():</span><br><span class="line">                self.not_empty.wait()</span><br><span class="line">        <span class="keyword">elif</span> timeout &lt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">"'timeout' must be a non-negative number"</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            endtime = time() + timeout</span><br><span class="line">            <span class="keyword">while</span> <span class="keyword">not</span> self._qsize():</span><br><span class="line">                remaining = endtime - time()</span><br><span class="line">                <span class="keyword">if</span> remaining &lt;= <span class="number">0.0</span>:</span><br><span class="line">                    <span class="keyword">raise</span> Empty</span><br><span class="line">                self.not_empty.wait(remaining)</span><br><span class="line">        item = self._get()</span><br><span class="line">        self.not_full.notify()</span><br><span class="line">        <span class="keyword">return</span> item</span><br></pre></td></tr></table></figure>

<p>å‚æ•°ä¸ºæ˜¯å¦é˜»å¡å’Œè¶…æ—¶æ—¶é—´</p>
<h2 id="get-nowait"><a href="#get-nowait" class="headerlink" title="get_nowait"></a>get_nowait</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_nowait</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="string">'''Remove and return an item from the queue without blocking.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Only get an item if one is immediately available. Otherwise</span></span><br><span class="line"><span class="string">    raise the Empty exception.</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    <span class="keyword">return</span> self.get(block=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>

<p>éé˜»å¡è·å–é˜Ÿåˆ—ä¸­çš„å€¼</p>
<h2 id="put-amp-amp-put-nowait"><a href="#put-amp-amp-put-nowait" class="headerlink" title="put &amp;&amp; put_nowait"></a>put &amp;&amp; put_nowait</h2><p>ä¸<code>get &amp; get_nowait</code>åŒç†</p>
<h2 id="empty"><a href="#empty" class="headerlink" title="empty"></a>empty</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">empty</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="string">'''Return True if the queue is empty, False otherwise (not reliable!).</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    This method is likely to be removed at some point.  Use qsize() == 0</span></span><br><span class="line"><span class="string">    as a direct substitute, but be aware that either approach risks a race</span></span><br><span class="line"><span class="string">    condition where a queue can grow before the result of empty() or</span></span><br><span class="line"><span class="string">    qsize() can be used.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    To create code that needs to wait for all queued tasks to be</span></span><br><span class="line"><span class="string">    completed, the preferred technique is to use the join() method.</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    <span class="keyword">with</span> self.mutex:</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">not</span> self._qsize()</span><br></pre></td></tr></table></figure>

<p>æ£€æŸ¥é˜Ÿåˆ—æ˜¯å¦ä¸ºç©ºï¼Œä¸ºç©ºè¿”å›Trueï¼Œä¸ä¸ºç©ºè¿”å›False</p>
<h2 id="full"><a href="#full" class="headerlink" title="full"></a>full</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">full</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="string">'''Return True if the queue is full, False otherwise (not reliable!).</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    This method is likely to be removed at some point.  Use qsize() &gt;= n</span></span><br><span class="line"><span class="string">    as a direct substitute, but be aware that either approach risks a race</span></span><br><span class="line"><span class="string">    condition where a queue can shrink before the result of full() or</span></span><br><span class="line"><span class="string">    qsize() can be used.</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    <span class="keyword">with</span> self.mutex:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span> &lt; self.maxsize &lt;= self._qsize()</span><br></pre></td></tr></table></figure>

<p>åˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦å·²ç»æ»¡äº†</p>
<h2 id="qsize"><a href="#qsize" class="headerlink" title="qsize"></a>qsize</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">qsize</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="string">'''Return the approximate size of the queue (not reliable!).'''</span></span><br><span class="line">    <span class="keyword">with</span> self.mutex:</span><br><span class="line">        <span class="keyword">return</span> self._qsize()</span><br></pre></td></tr></table></figure>

<p>è¿”å›é˜Ÿåˆ—ä¸­å…ƒç´ çš„ä¸ªæ•°ï¼ˆçœŸå®ä¸ªæ•°ï¼‰</p>
<p>æ„é€ æ–¹æ³•ä¸­å°è£…äº†<code>maxsize</code>å­—æ®µï¼Œå¯ä»¥ä½¿ç”¨<code>å¯¹è±¡.maxsize</code>æ¥è·å–å½“å‰é˜Ÿåˆ—çš„æœ€å¤§å€¼</p>
<h2 id="join-amp-task-done"><a href="#join-amp-task-done" class="headerlink" title="join &amp; task_done"></a>join &amp; task_done</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> queue</span><br><span class="line"></span><br><span class="line">q = queue.Queue(<span class="number">2</span>)</span><br><span class="line">q.put(<span class="number">15</span>)</span><br><span class="line">q.put(<span class="number">59</span>)</span><br></pre></td></tr></table></figure>

<p>ç¨‹åºæ‰§è¡Œå®Œè¿™5è¡Œä»£ç åä¼šé€€å‡ºï¼Œé€€å‡ºå‰é˜Ÿåˆ—ä¸­è¿˜æœ‰å€¼ï¼Œé€€å‡ºåè¢«æ¸…ç©º</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> queue</span><br><span class="line"></span><br><span class="line">q = queue.Queue(<span class="number">2</span>)</span><br><span class="line">q.put(<span class="number">15</span>)</span><br><span class="line">q.put(<span class="number">59</span>)</span><br><span class="line"></span><br><span class="line">q.join()</span><br></pre></td></tr></table></figure>

<p>ç¨‹åºä¼šä¸€ç›´å¡åœ¨ç¬¬7è¡Œï¼Œåªè¦é˜Ÿåˆ—ä¸­è¿˜æœ‰å€¼ï¼Œç¨‹åºå°±ä¸ä¼šé€€å‡º</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> queue</span><br><span class="line"></span><br><span class="line">q = queue.Queue(<span class="number">2</span>)</span><br><span class="line">q.put(<span class="number">15</span>)</span><br><span class="line">q.put(<span class="number">59</span>)</span><br><span class="line"></span><br><span class="line">q.get()</span><br><span class="line">q.get()</span><br><span class="line"></span><br><span class="line">q.join()</span><br></pre></td></tr></table></figure>

<p>é˜Ÿåˆ—ä¸­æ’å…¥ä¸¤ä¸ªå…ƒç´ ï¼Œåé¢å–å‡ºäº†ä¸¤ä¸ªå…ƒç´ ï¼Œæ‰§è¡Œåä½ ä¼šå‘ç°ï¼Œç¨‹åºè¿˜æ˜¯å¡åœ¨ç¬¬10è¡Œçš„é‚£ä¸ªjoinä»£ç </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> queue</span><br><span class="line"></span><br><span class="line">q = queue.Queue(<span class="number">2</span>)</span><br><span class="line">q.put(<span class="number">15</span>)</span><br><span class="line">q.put(<span class="number">59</span>)</span><br><span class="line"></span><br><span class="line">q.get()</span><br><span class="line">q.task_done()  <span class="comment"># getå–å®Œé˜Ÿåˆ—ä¸­çš„ä¸€ä¸ªå€¼åï¼Œä½¿ç”¨task_doneæ–¹æ³•å‘Šè¯‰é˜Ÿåˆ—ï¼Œæˆ‘å·²ç»å–å‡ºäº†ä¸€ä¸ªå€¼å¹¶å¤„ç†å®Œæ¯•</span></span><br><span class="line">q.get()</span><br><span class="line">q.task_done()</span><br><span class="line"></span><br><span class="line">q.join()</span><br></pre></td></tr></table></figure>

<p>åœ¨æ¯æ¬¡getå–å€¼ä¹‹åï¼Œè¿˜éœ€è¦åœ¨è·Ÿé˜Ÿåˆ—å£°æ˜ä¸€ä¸‹ï¼Œæˆ‘å·²ç»å–å‡ºäº†æ•°æ®å¹¶å¤„ç†å®Œæ¯•ï¼Œè¿™æ ·æ‰§è¡Œåˆ°joinä»£ç çš„æ—¶å€™æ‰ä¸ä¼šè¢«å¡ä½</p>
<h1 id="Pythonæä¾›çš„æ‰€æœ‰é˜Ÿåˆ—ç±»å‹"><a href="#Pythonæä¾›çš„æ‰€æœ‰é˜Ÿåˆ—ç±»å‹" class="headerlink" title="Pythonæä¾›çš„æ‰€æœ‰é˜Ÿåˆ—ç±»å‹"></a>Pythonæä¾›çš„æ‰€æœ‰é˜Ÿåˆ—ç±»å‹</h1><ul>
<li>å…ˆè¿›å…ˆå‡ºé˜Ÿåˆ—    queue.Queue</li>
<li>åè¿›å…ˆå‡ºé˜Ÿåˆ—    queue.LifoQueue (Queueçš„åŸºç¡€ä¸Šè¿›è¡Œçš„å°è£…)</li>
<li>ä¼˜å…ˆçº§é˜Ÿåˆ—    queue.PriorityQueue (Queueçš„åŸºç¡€ä¸Šè¿›è¡Œçš„å°è£…)</li>
<li>åŒå‘é˜Ÿåˆ— queue.deque</li>
</ul>
<h2 id="åè¿›å…ˆå‡ºé˜Ÿåˆ—"><a href="#åè¿›å…ˆå‡ºé˜Ÿåˆ—" class="headerlink" title="åè¿›å…ˆå‡ºé˜Ÿåˆ—"></a>åè¿›å…ˆå‡ºé˜Ÿåˆ—</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> queue</span><br><span class="line"></span><br><span class="line">q = queue.LifoQueue()</span><br><span class="line">q.put(<span class="string">'Polar'</span>)</span><br><span class="line">q.put(<span class="string">'Snow'</span>)</span><br><span class="line"></span><br><span class="line">print(q.get())</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">Snow</span><br></pre></td></tr></table></figure>

<h2 id="ä¼˜å…ˆçº§é˜Ÿåˆ—"><a href="#ä¼˜å…ˆçº§é˜Ÿåˆ—" class="headerlink" title="ä¼˜å…ˆçº§é˜Ÿåˆ—"></a>ä¼˜å…ˆçº§é˜Ÿåˆ—</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> queue</span><br><span class="line"></span><br><span class="line">q = queue.PriorityQueue()</span><br><span class="line">q.put((<span class="number">1</span>, <span class="string">'Snow'</span>))</span><br><span class="line">q.put((<span class="number">0</span>, <span class="string">'Polar'</span>))</span><br><span class="line"></span><br><span class="line">print(q.get())</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">Polar</span><br></pre></td></tr></table></figure>

<p>æ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ï¼Œæ•°å­—ç›¸åŒï¼Œå…ˆè¿›å…ˆå‡º</p>
<h2 id="åŒå‘é˜Ÿåˆ—"><a href="#åŒå‘é˜Ÿåˆ—" class="headerlink" title="åŒå‘é˜Ÿåˆ—"></a>åŒå‘é˜Ÿåˆ—</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> queue</span><br><span class="line"></span><br><span class="line">q = queue.deque()</span><br><span class="line"></span><br><span class="line">q.append(<span class="string">'A'</span>)   <span class="comment"># åœ¨å³ä¾§è¿½åŠ   A</span></span><br><span class="line">q.append(<span class="string">'X'</span>)   <span class="comment"># åœ¨å³ä¾§è¿½åŠ   A X</span></span><br><span class="line">q.appendleft(<span class="string">'Z'</span>)   <span class="comment"># åœ¨å·¦ä¾§è¿½åŠ   Z A X</span></span><br><span class="line">q.appendleft(<span class="string">'V'</span>)   <span class="comment"># åœ¨å·¦ä¾§è¿½åŠ   V Z A X</span></span><br><span class="line"></span><br><span class="line">print(q.pop()) <span class="comment"># ä»å³ä¾§å–  --&gt; X</span></span><br><span class="line">print(q.popleft()) <span class="comment"># ä»å·¦ä¾§å–  --&gt; V</span></span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">X</span><br><span class="line">V</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>queue</tag>
        <tag>å…ˆè¿›å…ˆå‡ºé˜Ÿåˆ—</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonå¤šçº¿ç¨‹ä¸­çš„runæ–¹æ³•</title>
    <url>/2016/07/20/Python%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%AD%E7%9A%84run%E6%96%B9%E6%B3%95/</url>
    <content><![CDATA[<blockquote>
<p>Pythonä¸­çš„å¤šçº¿ç¨‹é€šè¿‡threadingæ¨¡å—æ¥å®ç°ã€‚å®ç°Pythonä¸­çš„å¤šçº¿ç¨‹æœ‰ä¸¤ç§æ–¹å¼ï¼Œæœ¬ç¯‡æ–‡ç« ä»‹ç»å¤šçº¿ç¨‹ä¸­ï¼Œrunæ–¹æ³•çš„ä½¿ç”¨</p>
</blockquote>
<p>ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ä»‹ç»äº†å¤šçº¿ç¨‹çš„åŸºæœ¬ä½¿ç”¨æ–¹æ³•ï¼Œåœ¨æ‰§è¡ŒThreadå¯¹è±¡çš„startæ–¹æ³•ä¹‹åï¼Œå£°æ˜æŒ‡å®šçš„targetå‡½æ•°å·²ç»å°±ç»ªï¼Œå‡†å¤‡è¢«CPUè°ƒç”¨æ‰§è¡Œã€‚å½“CPUçš„æ—¶é—´ç‰‡åˆ†åˆ°è¿™ä¸ªçº¿ç¨‹çš„æ—¶å€™ï¼Œä¼šå»æ‰§è¡ŒThreadå¯¹è±¡çš„runæ–¹æ³•</p>
<p>è¿™é‡Œçš„startå’Œrunæ–¹æ³•ä¸€å®šè¦åŒºåˆ†å¼€</p>
<ul>
<li>startæ–¹æ³•æ˜¯å£°æ˜åˆ†åˆ°ä¸€ä¸ªå­çº¿ç¨‹çš„å‡½æ•°å·²ç»å°±ç»ªï¼Œç­‰å¾…è¢«CPUæ‰§è¡Œ</li>
<li>runæ–¹æ³•æ˜¯æ‰§è¡Œåˆ°è¿™ä¸ªå­çº¿ç¨‹æ—¶ï¼Œè‡ªåŠ¨è°ƒç”¨çš„æ–¹æ³•</li>
</ul>
<p>æ‹¿ä¸Šä¸€ç¯‡å¤šçº¿ç¨‹åŸºæœ¬ä½¿ç”¨æ–‡ç« ä¸­çš„ä¾‹å­ğŸŒ°ä¸ºä¾‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(arg)</span>:</span></span><br><span class="line">    print(<span class="string">'func start'</span>)</span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    print(arg)</span><br><span class="line">    print(<span class="string">'func end'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªçº¿ç¨‹</span></span><br><span class="line"><span class="comment"># target æŒ‡å®šè®©çº¿ç¨‹æ‰§è¡Œçš„å‡½æ•°</span></span><br><span class="line">t = threading.Thread(target=func, args=(<span class="string">'PolarSnow'</span>,))</span><br><span class="line">t.setDaemon(<span class="literal">True</span>) <span class="comment"># é»˜è®¤ä¸ºFalse</span></span><br><span class="line">t.start()</span><br><span class="line">t.join(<span class="number">1</span>) <span class="comment"># ä¸»çº¿ç¨‹åœåœ¨è¿™é‡Œ</span></span><br><span class="line">print(<span class="string">'main end'</span>)</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">func start</span><br><span class="line">main end</span><br></pre></td></tr></table></figure>

<p><code>t = threading.Thread(target=func, args=(&#39;PolarSnow&#39;,))</code>å®ä¾‹åŒ–äº†ä¸€ä¸ªThreadå¯¹è±¡ï¼Œæ‰§è¡Œäº†Threadç±»çš„æ„é€ æ–¹æ³•ï¼Œæ„é€ æ–¹æ³•æºç å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, group=None, target=None, name=None,</span></span></span><br><span class="line"><span class="function"><span class="params">                 args=<span class="params">()</span>, kwargs=None, *, daemon=None)</span>:</span></span><br><span class="line">        <span class="string">"""This constructor should always be called with keyword arguments. Arguments are:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        *group* should be None; reserved for future extension when a ThreadGroup</span></span><br><span class="line"><span class="string">        class is implemented.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        *target* is the callable object to be invoked by the run()</span></span><br><span class="line"><span class="string">        method. Defaults to None, meaning nothing is called.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        *name* is the thread name. By default, a unique name is constructed of</span></span><br><span class="line"><span class="string">        the form "Thread-N" where N is a small decimal number.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        *args* is the argument tuple for the target invocation. Defaults to ().</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        *kwargs* is a dictionary of keyword arguments for the target</span></span><br><span class="line"><span class="string">        invocation. Defaults to &#123;&#125;.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        If a subclass overrides the constructor, it must make sure to invoke</span></span><br><span class="line"><span class="string">        the base class constructor (Thread.__init__()) before doing anything</span></span><br><span class="line"><span class="string">        else to the thread.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">assert</span> group <span class="keyword">is</span> <span class="literal">None</span>, <span class="string">"group argument must be None for now"</span></span><br><span class="line">        <span class="keyword">if</span> kwargs <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            kwargs = &#123;&#125;</span><br><span class="line">        self._target = target</span><br><span class="line">        self._name = str(name <span class="keyword">or</span> _newname())</span><br><span class="line">        self._args = args</span><br><span class="line">        self._kwargs = kwargs</span><br><span class="line">        <span class="keyword">if</span> daemon <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            self._daemonic = daemon</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self._daemonic = current_thread().daemon</span><br><span class="line">        self._ident = <span class="literal">None</span></span><br><span class="line">        self._tstate_lock = <span class="literal">None</span></span><br><span class="line">        self._started = Event()</span><br><span class="line">        self._is_stopped = <span class="literal">False</span></span><br><span class="line">        self._initialized = <span class="literal">True</span></span><br><span class="line">        <span class="comment"># sys.stderr is not stored in the class like</span></span><br><span class="line">        <span class="comment"># sys.exc_info since it can be changed between instances</span></span><br><span class="line">        self._stderr = _sys.stderr</span><br><span class="line">        <span class="comment"># For debugging and _after_fork()</span></span><br><span class="line">        _dangling.add(self)</span><br></pre></td></tr></table></figure>

<p>åœ¨Threadçš„æ„é€ æ–¹æ³•ä¸­ï¼Œå°è£…äº†æˆ‘ä»¬ä¼ è¿›å»çš„ä¸¤ä¸ªå‚æ•°</p>
<p>è€Œå­çº¿ç¨‹è¢«CPUè°ƒåº¦æ‰§è¡Œçš„æ—¶å€™ï¼Œè‡ªåŠ¨æ‰§è¡Œäº†Threadå¯¹è±¡ä¸­çš„runæ–¹æ³•ï¼Œrunæ–¹æ³•æºç å¦‚ä¸‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""Method representing the thread's activity.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        You may override this method in a subclass. The standard run() method</span></span><br><span class="line"><span class="string">        invokes the callable object passed to the object's constructor as the</span></span><br><span class="line"><span class="string">        target argument, if any, with sequential and keyword arguments taken</span></span><br><span class="line"><span class="string">        from the args and kwargs arguments, respectively.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> self._target:</span><br><span class="line">                self._target(*self._args, **self._kwargs)</span><br><span class="line">        <span class="keyword">finally</span>:</span><br><span class="line">            <span class="comment"># Avoid a refcycle if the thread is running a function with</span></span><br><span class="line">            <span class="comment"># an argument that has a member that points to the thread.</span></span><br><span class="line">            <span class="keyword">del</span> self._target, self._args, self._kwargs</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥æ¸…æ¥šçš„çœ‹åˆ°ï¼Œè¿™é‡Œ<code>self._target(*self._args, **self._kwargs)</code>å»æ‰§è¡Œäº†æˆ‘ä»¬ä¼ è¿›å»çš„å‡½æ•°åæ‰€æŒ‡å‘çš„å‡½æ•°ä½“ï¼Œç®€å•çš„è¯´ï¼Œå°±æ˜¯æŠŠtargetå‚æ•°çš„é‚£ä¸ªå‡½æ•°æ‰§è¡Œäº†ï¼Œå¹¶ä¸”å‚æ•°å°±æ˜¯æˆ‘ä»¬ä¼ é€’è¿›å»çš„é‚£äº›å‚æ•°</p>
<h1 id="è‡ªå®šä¹‰runæ–¹æ³•"><a href="#è‡ªå®šä¹‰runæ–¹æ³•" class="headerlink" title="è‡ªå®šä¹‰runæ–¹æ³•"></a>è‡ªå®šä¹‰runæ–¹æ³•</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"><span class="comment"># è‡ªå®šä¹‰ä¸€ä¸ªç±»ï¼Œç»§æ‰¿threading.Thread</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThread</span><span class="params">(threading.Thread)</span>:</span></span><br><span class="line"></span><br><span class="line">	<span class="comment"># å› ä¸ºCPUæ‰§è¡Œå­çº¿ç¨‹çš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨æ‰§è¡ŒThreadå¯¹è±¡çš„runæ–¹æ³•</span></span><br><span class="line">	<span class="comment"># æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬é‡å†™çˆ¶ç±»çš„runæ–¹æ³•</span></span><br><span class="line">	<span class="comment"># è¿˜è®°å¾—Pythonçš„ç»§æ‰¿å…³ç³»å—ï¼Ÿself.runè¿˜æ˜¯ä»åŸç‚¹å¼€å§‹æ‰¾</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">t = MyThread() <span class="comment"># åˆ›å»ºä¸€ä¸ªçº¿ç¨‹å¯¹è±¡</span></span><br><span class="line">t.start()  <span class="comment"># ç­‰å¾…è¢«CPUè¿è¡Œ</span></span><br></pre></td></tr></table></figure>

<h1 id="æ¨¡æ‹ŸThreadç±»çš„åŠŸèƒ½"><a href="#æ¨¡æ‹ŸThreadç±»çš„åŠŸèƒ½" class="headerlink" title="æ¨¡æ‹ŸThreadç±»çš„åŠŸèƒ½"></a>æ¨¡æ‹ŸThreadç±»çš„åŠŸèƒ½</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThread</span><span class="params">(threading.Thread)</span>:</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># é‡å†™çˆ¶ç±»çš„æ„é€ æ–¹æ³•</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, func, args)</span>:</span></span><br><span class="line">    	<span class="comment"># å°†å‡½æ•°åå’Œå‚æ•°å°è£…åˆ°æœ¬ç±»ä¸­</span></span><br><span class="line">        self.func = func</span><br><span class="line">        self.args = args</span><br><span class="line">        <span class="comment"># ä¸ºä¿è¯ç»§æ‰¿çš„ç±»æ­£å¸¸è¿è¡Œï¼Œè¿™é‡Œéœ€è¦æ‰§è¡Œçˆ¶ç±»çš„æ„é€ æ–¹æ³•</span></span><br><span class="line">        <span class="comment"># ä½†æ˜¯æ²¡æœ‰ç»™çˆ¶ç±»çš„æ„é€ æ–¹æ³•ä¼ é€’ä»»ä½•å‚æ•°</span></span><br><span class="line">        <span class="comment"># è€Œå¯¹è±¡å¯»æ‰¾å‚æ•°æ—¶ï¼Œä¹Ÿæ˜¯æœ€å…ˆä»æœ¬ç±»ä¸­å¯»æ‰¾</span></span><br><span class="line">        super(MyThread, self).__init__()</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">    	<span class="comment"># æ‰§è¡Œå‚æ•°ä¸­çš„å‡½æ•°</span></span><br><span class="line">        self.func(self.args)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è‡ªå®šä¹‰ä¸€ä¸ªéœ€è¦å­çº¿ç¨‹è¿è¡Œçš„å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(arg)</span>:</span></span><br><span class="line">    print(arg)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨è‡ªå®šä¹‰çš„çº¿ç¨‹å¯¹è±¡æ‰§è¡Œ</span></span><br><span class="line">t = MyThread(func=f, args=<span class="number">59</span>)</span><br><span class="line">t.start()</span><br></pre></td></tr></table></figure>

<p><em>å®é™…ä½¿ç”¨ä¸­è¿˜æ˜¯æ¨èä½¿ç”¨threadingåŸç”Ÿæä¾›çš„æ–¹å¼ï¼Œè¿™é‡Œçš„runæ–¹æ³•ä»…ä¾›ç†è§£threadingçš„å†…éƒ¨æ‰§è¡Œè¿‡ç¨‹</em></p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>å¤šçº¿ç¨‹</tag>
        <tag>Thread</tag>
        <tag>threading</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonçº¿ç¨‹çš„åŸºæœ¬ä½¿ç”¨</title>
    <url>/2016/07/17/Python%E7%BA%BF%E7%A8%8B%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/</url>
    <content><![CDATA[<h1 id="å®ä¾‹1-start"><a href="#å®ä¾‹1-start" class="headerlink" title="å®ä¾‹1 start"></a>å®ä¾‹1 start</h1><p>åˆ›å»ºå­çº¿ç¨‹å¹¶æ‰§è¡Œçº¿ç¨‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªå‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(arg)</span>:</span></span><br><span class="line">    print(<span class="string">'func start'</span>)</span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    print(arg)</span><br><span class="line">    print(<span class="string">'func end'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªçº¿ç¨‹</span></span><br><span class="line"><span class="comment"># target æŒ‡å®šè®©çº¿ç¨‹æ‰§è¡Œçš„å‡½æ•°</span></span><br><span class="line">t = threading.Thread(target=func, args=(<span class="string">'PolarSnow'</span>,))</span><br><span class="line">t.start()</span><br><span class="line"></span><br><span class="line">print(<span class="string">'main end'</span>)</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">func start</span><br><span class="line">main end</span><br><span class="line">PolarSnow</span><br><span class="line">func end</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„ä»£ç åœ¨ä¸»çº¿ç¨‹ä¸­åˆ›å»ºäº†ä¸€ä¸ªå­çº¿ç¨‹å»æ‰§è¡Œä¸€ä¸ªå‡½æ•°</p>
<p>æ‰§è¡Œè¿™ä¸ªå‡½æ•°æœ€å°‘éœ€è¦2ç§’é’Ÿï¼Œè€Œä¸»çº¿ç¨‹ç›´æ¥å»æ‰§è¡Œäº†<code>print(&#39;end&#39;)</code>ï¼Œè¯´æ˜åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸»çº¿ç¨‹ä¸ä¼šç­‰å¾…å­çº¿ç¨‹ç›´æ¥ç»“æŸå†å‘ä¸‹æ‰§è¡Œï¼Œè€Œæ˜¯ä¸»çº¿ç¨‹å…ˆå‘ä¸‹æ‰§è¡Œï¼Œå³ä½¿ä¸»çº¿ç¨‹æ‰€æœ‰ä»£ç å·²ç»æ‰§è¡Œå®Œæ¯•ï¼Œä¹Ÿä¸ä¼šé€€å‡ºç¨‹åºï¼Œè€Œæ˜¯ç­‰å¾…æ‰€æœ‰å­çº¿ç¨‹æ‰§è¡Œç»“æŸåå†é€€å‡ºç¨‹åº</p>
<h1 id="å®ä¾‹2-setDaemon"><a href="#å®ä¾‹2-setDaemon" class="headerlink" title="å®ä¾‹2 setDaemon"></a>å®ä¾‹2 setDaemon</h1><p>è®¾ç½®ä¸»çº¿ç¨‹ä¸ç­‰å¾…å­çº¿ç¨‹æ‰§è¡Œå®Œæ¯•</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(arg)</span>:</span></span><br><span class="line">    print(<span class="string">'func start'</span>)</span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    print(arg)</span><br><span class="line">    print(<span class="string">'func end'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªçº¿ç¨‹</span></span><br><span class="line"><span class="comment"># target æŒ‡å®šè®©çº¿ç¨‹æ‰§è¡Œçš„å‡½æ•°</span></span><br><span class="line">t = threading.Thread(target=func, args=(<span class="string">'PolarSnow'</span>,))</span><br><span class="line">t.setDaemon(<span class="literal">True</span>) <span class="comment"># é»˜è®¤ä¸ºFalse</span></span><br><span class="line">t.start()</span><br><span class="line"></span><br><span class="line">print(<span class="string">'main end'</span>)</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">func start</span><br><span class="line">main end</span><br></pre></td></tr></table></figure>

<p>åœ¨å¯åŠ¨çº¿ç¨‹ä¹‹å‰è®¾ç½®<code>t.setDaemon(True)</code>ä¸ºTrueï¼Œæ„æ€æ˜¯ä¸»çº¿ç¨‹ä¸ä¼šç­‰å¾…æ‰€æœ‰çš„å­çº¿ç¨‹æ‰§è¡Œå®Œæ¯•å†é€€å‡ºç¨‹åºï¼Œè€Œæ˜¯å½“ä¸»çº¿ç¨‹æ‰§è¡Œå®Œæ¯•åï¼Œå¼ºåˆ¶é€€å‡ºç¨‹åºï¼Œä¸ç®¡å­çº¿ç¨‹æœ‰æ²¡æœ‰æ‰§è¡Œå®Œæ¯•</p>
<h1 id="å®ä¾‹3-join"><a href="#å®ä¾‹3-join" class="headerlink" title="å®ä¾‹3 join"></a>å®ä¾‹3 join</h1><p>ä¸»çº¿ç¨‹ç­‰å¾…å­çº¿ç¨‹æ‰§è¡Œå®Œæ¯•åï¼Œå†å‘ä¸‹æ‰§è¡Œ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(arg)</span>:</span></span><br><span class="line">    print(<span class="string">'func start'</span>)</span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    print(arg)</span><br><span class="line">    print(<span class="string">'func end'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªçº¿ç¨‹</span></span><br><span class="line"><span class="comment"># target æŒ‡å®šè®©çº¿ç¨‹æ‰§è¡Œçš„å‡½æ•°</span></span><br><span class="line">t = threading.Thread(target=func, args=(<span class="string">'PolarSnow'</span>,))</span><br><span class="line">t.setDaemon(<span class="literal">True</span>) <span class="comment"># é»˜è®¤ä¸ºFalse</span></span><br><span class="line">t.start()</span><br><span class="line">t.join() <span class="comment"># ä¸»çº¿ç¨‹åœåœ¨è¿™é‡Œ</span></span><br><span class="line">print(<span class="string">'main end'</span>)</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">func start</span><br><span class="line">PolarSnow</span><br><span class="line">func end</span><br><span class="line">main end</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨äº†joinæ–¹æ³•ä¹‹åï¼Œä¸»çº¿ç¨‹ä¼šä¸€ç›´åœåœ¨joinæ–¹æ³•é‚£ä¸€è¡Œï¼Œç›´åˆ°æ‰€æœ‰çš„å­çº¿ç¨‹éƒ½æ‰§è¡Œå®Œæ¯•åï¼Œå†ç»§ç»­å‘ä¸‹æ‰§è¡Œ</p>
<h1 id="å®ä¾‹4-join-1"><a href="#å®ä¾‹4-join-1" class="headerlink" title="å®ä¾‹4 join(1)"></a>å®ä¾‹4 join(1)</h1><p>è®¾ç½®ä¸»çº¿ç¨‹å†æ¬¡ç­‰å¾…å­çº¿ç¨‹çš„æœ€å¤§æ—¶é—´</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(arg)</span>:</span></span><br><span class="line">    print(<span class="string">'func start'</span>)</span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    print(arg)</span><br><span class="line">    print(<span class="string">'func end'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªçº¿ç¨‹</span></span><br><span class="line"><span class="comment"># target æŒ‡å®šè®©çº¿ç¨‹æ‰§è¡Œçš„å‡½æ•°</span></span><br><span class="line">t = threading.Thread(target=func, args=(<span class="string">'PolarSnow'</span>,))</span><br><span class="line">t.setDaemon(<span class="literal">True</span>) <span class="comment"># é»˜è®¤ä¸ºFalse</span></span><br><span class="line">t.start()</span><br><span class="line">t.join(<span class="number">1</span>) <span class="comment"># ä¸»çº¿ç¨‹åœåœ¨è¿™é‡Œ</span></span><br><span class="line">print(<span class="string">'main end'</span>)</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">func start</span><br><span class="line">main end</span><br></pre></td></tr></table></figure>

<p>è®¾ç½®ä¸ºä¸»çº¿ç¨‹åœ¨<code>t.join</code>è¿™ä¸€è¡Œï¼Œ<strong>æœ€å¤š</strong>ç­‰å¾…1ç§’é’Ÿçš„æ—¶é—´ï¼Œ1ç§’é’Ÿä¹‹åï¼Œä¸ç®¡å­çº¿ç¨‹æœ‰æ²¡æœ‰æ‰§è¡Œå®Œæ¯•éƒ½ä¼šç»§ç»­å‘ä¸‹æ‰§è¡Œ</p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>å¤šçº¿ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonä¸­çš„å¤šè¿›ç¨‹ä¸å¤šçº¿ç¨‹ç®€ä»‹</title>
    <url>/2016/07/17/Python%E4%B8%AD%E7%9A%84%E5%A4%9A%E8%BF%9B%E7%A8%8B%E4%B8%8E%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%AE%80%E4%BB%8B/</url>
    <content><![CDATA[<p><img src="http://oss.20150509.cn/20160717122059.png" alt=""></p>
<p>åœ¨Pythonä¸­è§„å®šï¼Œæ¯ä¸€ä¸ªè¿›ç¨‹ä¸­åªå¯ä»¥æœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨åŒä¸€æ—¶åˆ»è¢«è°ƒç”¨æ‰§è¡Œï¼ŒGILå…¨å±€è§£é‡Šå™¨é”ï¼Œå°±æ˜¯ç”¨æ¥ä¿éšœè¿™ä¸€è§„åˆ™é¡ºåˆ©è¢«æ‰§è¡Œçš„ç»„ä»¶</p>
<p>Pythonä¸­å¯ä»¥åˆ©ç”¨å¤šæ ¸CPUçš„æ˜¯å¤šè¿›ç¨‹ï¼Œå¤šä¸ªCPUå¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ªè¿›ç¨‹çš„ä»»åŠ¡ï¼Œä½†æ˜¯ï¼Œæ¯ä¸ªè¿›ç¨‹ä¸­åŒä¸€æ—¶é—´åªèƒ½å¤„ç†ä¸€ä¸ªçº¿ç¨‹</p>
<p><em>IOæ“ä½œä¸å ç”¨CPU</em></p>
<ul>
<li>å¤šçº¿ç¨‹çš„åº”ç”¨åœºæ™¯ï¼šIOæ“ä½œ</li>
<li>å¤šè¿›ç¨‹çš„åº”ç”¨åœºæ™¯ï¼šè®¡ç®—æ€§æ“ä½œ</li>
</ul>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>å¤šçº¿ç¨‹</tag>
        <tag>å¤šè¿›ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title>socketserveræºç é˜…è¯»</title>
    <url>/2016/07/17/socketserver%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/</url>
    <content><![CDATA[<blockquote>
<p>æœ¬ç¯‡socketserveræºç é˜…è¯»ä¸»è¦ç›®çš„æ˜¯ç†Ÿæ‚‰Pythonä¸­çš„ç»§æ‰¿æ¨¡å¼</p>
</blockquote>
<h1 id="ç¤ºä¾‹ä»£ç "><a href="#ç¤ºä¾‹ä»£ç " class="headerlink" title="ç¤ºä¾‹ä»£ç "></a>ç¤ºä¾‹ä»£ç </h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> socketserver</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span><span class="params">(socketserver.BaseRequestHandler)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">obj = socketserver.ThreadingTCPServer((<span class="string">'127.0.0.1'</span>, <span class="number">1559</span>), MyClass)</span><br><span class="line">obj.serve_forever()</span><br></pre></td></tr></table></figure>

<h1 id="é˜…è¯»å…¥å£"><a href="#é˜…è¯»å…¥å£" class="headerlink" title="é˜…è¯»å…¥å£"></a>é˜…è¯»å…¥å£</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">obj = socketserver.ThreadingTCPServer((<span class="string">'127.0.0.1'</span>, <span class="number">1559</span>), MyClass)</span><br></pre></td></tr></table></figure>

<p>ä»ä»¥ä¸Šè¿™ä¸€è¡Œä»£ç ä¸­å¯ä»¥çœ‹å‡ºï¼Œæ‰§è¡Œäº†<code>ThreadingTCPServer</code>ç±»ä¸­çš„<code>__init__</code>æ–¹æ³•ï¼ˆå®ä¾‹åŒ–äº†è¿™ä¸ªç±»çš„å¯¹è±¡ï¼Œå°±ä»è¿™é‡Œä¸ºå…¥å£ç‚¹æ¥é˜…è¯»ï¼‰</p>
<h1 id="ThreadingTCPServerç±»å›¾"><a href="#ThreadingTCPServerç±»å›¾" class="headerlink" title="ThreadingTCPServerç±»å›¾"></a>ThreadingTCPServerç±»å›¾</h1><p><img src="http://20150509.oss-cn-qingdao.aliyuncs.com/20160717000559.png" alt=""></p>
<h1 id="step-by-step"><a href="#step-by-step" class="headerlink" title="step by step"></a>step by step</h1><h2 id="step-1"><a href="#step-1" class="headerlink" title="step 1"></a>step 1</h2><p>é¦–å…ˆï¼Œä»å®ä¾‹åŒ–<code>ThreadingTCPServer</code>è¿™ä¸ªç±»çš„å¯¹è±¡å¯ä»¥å¾—çŸ¥ï¼Œæ˜¯æ‰§è¡Œäº†è¿™ä¸ªå¯¹è±¡çš„<code>__init__</code>æ„é€ æ–¹æ³•ï¼Œä½†æ˜¯æˆ‘ä»¬æŸ¥çœ‹è¿™ä¸ªç±»çš„æºç å‘ç°ï¼Œåªæœ‰ä¸€ä¸ª<code>pass</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThreadingTCPServer</span><span class="params">(ThreadingMixIn, TCPServer)</span>:</span> <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯è¿™ä¸ªç±»ç»§æ‰¿äº†ä¸¤ä¸ªçˆ¶ç±»ï¼Œé‚£ä¹ˆå¿…ç„¶æ˜¯æ‰§è¡Œäº†çˆ¶ç±»çš„<code>__init__</code>æ–¹æ³•ã€‚åœ¨æŸ¥æ‰¾çˆ¶ç±»<code>__init__</code>æ–¹æ³•çš„æ—¶å€™ï¼Œé¦–å…ˆä»å·¦è¾¹çš„çˆ¶ç±»å¼€å§‹æŸ¥æ‰¾</p>
<h2 id="step-2"><a href="#step-2" class="headerlink" title="step 2"></a>step 2</h2><p><code>ThreadingTCPServer</code>ç»§æ‰¿çš„ç¬¬ä¸€ä¸ªçˆ¶ç±»ä¸­<code>ThreadingMixIn</code>ï¼Œæ²¡æœ‰æ‰¾åˆ°<code>__init__</code>æ„é€ æ–¹æ³•ï¼Œæ¥ç€ï¼ŒPythonä¼šå»<code>ThreadingTCPServer</code>ç»§æ‰¿çš„ç¬¬äºŒä¸ªçˆ¶ç±»æ€»å»æŸ¥æ‰¾</p>
<h2 id="step-3"><a href="#step-3" class="headerlink" title="step 3"></a>step 3</h2><p>åœ¨<code>ThreadingTCPServer</code>ç»§æ‰¿çš„ç¬¬äºŒä¸ªçˆ¶ç±»<code>TCPServer</code>æ‰¾åˆ°äº†<code>__init__</code>æ„é€ æ–¹æ³•å¹¶æ‰§è¡Œ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, server_address, RequestHandlerClass, bind_and_activate=True)</span>:</span></span><br><span class="line">    <span class="string">"""Constructor.  May be extended, do not override."""</span></span><br><span class="line">    BaseServer.__init__(self, server_address, RequestHandlerClass)</span><br><span class="line">    self.socket = socket.socket(self.address_family,</span><br><span class="line">                                self.socket_type)</span><br><span class="line">    <span class="keyword">if</span> bind_and_activate:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            self.server_bind()</span><br><span class="line">            self.server_activate()</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            self.server_close()</span><br><span class="line">            <span class="keyword">raise</span></span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™æ®µæ„é€ æ–¹æ³•ä¸­ï¼Œå‰ä¸‰ä¸ªå‚æ•°å¯¹åº”äº†ç¤ºä¾‹ä»£ç ä¸­ï¼Œåˆ›å»º<code>ThreadingTCPServer</code>å¯¹è±¡æ—¶çš„ä¸‰ä¸ªå‚æ•°</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">obj = socketserver.ThreadingTCPServer((<span class="string">'127.0.0.1'</span>, <span class="number">1559</span>), MyClass)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, server_address, RequestHandlerClass, bind_and_activate=True)</span>:</span></span><br></pre></td></tr></table></figure>

<ul>
<li>self â€”&gt; obj</li>
<li>server_address â€”&gt; (â€˜127.0.0.1â€™, 1559)</li>
<li>RequestHandlerClass â€”&gt; MyClass</li>
</ul>
<p>åœ¨<code>TCPServer</code>çš„æ„é€ æ–¹æ³•æ‹¿åˆ°è¿™å‡ ä¸ªå‚æ•°ä¹‹åï¼Œç´§æ¥ç€åˆè°ƒç”¨äº†çˆ¶ç±»çš„<code>__init__</code>æ„é€ æ–¹æ³•</p>
<h3 id="step-3-1"><a href="#step-3-1" class="headerlink" title="step 3.1"></a>step 3.1</h3><p>åœ¨<code>TCPServer</code>çš„çˆ¶ç±»<code>BaseServer</code>ä¸­ï¼Œ<code>__init__</code>æ„é€ æ–¹æ³•æ‰§è¡Œäº†ä»¥ä¸‹å†…å®¹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, server_address, RequestHandlerClass)</span>:</span></span><br><span class="line">    <span class="string">"""Constructor.  May be extended, do not override."""</span></span><br><span class="line">    self.server_address = server_address</span><br><span class="line">    self.RequestHandlerClass = RequestHandlerClass</span><br><span class="line">    self.__is_shut_down = threading.Event()</span><br><span class="line">    self.__shutdown_request = <span class="literal">False</span></span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºäº†ä¸¤ä¸ªå…¬æœ‰å˜é‡å’Œä¸¤ä¸ªç§æœ‰å˜é‡ï¼Œå¹¶ä¸”</p>
<ul>
<li>RequestHandlerClass â€”&gt; MyClass</li>
</ul>
<h2 id="step-4"><a href="#step-4" class="headerlink" title="step 4"></a>step 4</h2><p><code>TCPServer</code>åœ¨æ‰§è¡Œå®Œçˆ¶ç±»çš„æ„é€ æ–¹æ³•å°è£…äº†å››ä¸ªå­—æ®µåï¼Œç»§ç»­å‘ä¸‹æ‰§è¡Œ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">self.socket = socket.socket(self.address_family,</span><br><span class="line">                                    self.socket_type)</span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºäº†ä¸€ä¸ªsocketå¯¹è±¡</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> bind_and_activate:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        self.server_bind()</span><br><span class="line">        self.server_activate()</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        self.server_close()</span><br><span class="line">        <span class="keyword">raise</span></span><br></pre></td></tr></table></figure>

<h3 id="step-4-1"><a href="#step-4-1" class="headerlink" title="step 4.1"></a>step 4.1</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">server_bind</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="string">"""Called by constructor to bind the socket.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    May be overridden.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">if</span> self.allow_reuse_address:</span><br><span class="line">        self.socket.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, <span class="number">1</span>)</span><br><span class="line">    self.socket.bind(self.server_address)</span><br><span class="line">    self.server_address = self.socket.getsockname()</span><br></pre></td></tr></table></figure>

<p>ç»‘å®šäº†IPå’Œç«¯å£å·ï¼Œ<code>self.server_address</code>çš„å€¼æ˜¯åœ¨æ‰§è¡Œçˆ¶ç±»<code>BaseServer</code>çš„æ„é€ æ–¹æ³•æ—¶åˆ›å»ºçš„</p>
<h3 id="step-4-2"><a href="#step-4-2" class="headerlink" title="step 4.2"></a>step 4.2</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">server_activate</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="string">"""Called by constructor to activate the server.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    May be overridden.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    self.socket.listen(self.request_queue_size)</span><br></pre></td></tr></table></figure>

<p>ç›‘å¬socket</p>
<p>è‡³æ­¤ï¼Œ<code>TCPServer</code>ä¸­çš„<code>__init__</code>æ„é€ æ–¹æ³•æ‰§è¡Œå®Œæ¯•ï¼Œæ„é€ æ–¹æ³•æ‰§è¡Œå®Œæ¯•ï¼Œå°±æ„å‘³ç€ç¤ºä¾‹ä»£ç ä¸­çš„</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">obj = socketserver.ThreadingTCPServer((<span class="string">'127.0.0.1'</span>, <span class="number">1559</span>), MyClass)</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸€å¥å°±æ‰§è¡Œå®Œæ¯•äº†</p>
<h2 id="step-5"><a href="#step-5" class="headerlink" title="step 5"></a>step 5</h2><p>æ¥ä¸‹æ¥æµ‹è¯•ä»£ç èµ°åˆ°ç¬¬10è¡Œ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">obj.serve_forever()</span><br></pre></td></tr></table></figure>

<p><code>ThreadingTCPServer</code>é¦–å…ˆåœ¨è‡ªå·±çš„ä»£ç å—ä¸­æŸ¥æ‰¾ï¼Œæ²¡æœ‰</p>
<p>æ ¹æ®ç»§æ‰¿çš„è§„åˆ™ï¼Œå†å»å·¦è¾¹çš„çˆ¶ç±»<code>ThreadingMixIn</code>ä¸­æŸ¥æ‰¾ï¼Œæ²¡æœ‰</p>
<p>ä¹‹åå†å»å³è¾¹çš„çˆ¶ç±»<code>TCPServer</code>ä¸­æŸ¥æ‰¾ï¼Œæ²¡æœ‰</p>
<p>æœ€ååœ¨<code>TCPServer</code>çš„çˆ¶ç±»<code>BaseServer</code>ä¸­æ‰¾åˆ°äº†<code>serve_forever</code>æ–¹æ³•</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">serve_forever</span><span class="params">(self, poll_interval=<span class="number">0.5</span>)</span>:</span></span><br><span class="line">    <span class="string">"""Handle one request at a time until shutdown.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Polls for shutdown every poll_interval seconds. Ignores</span></span><br><span class="line"><span class="string">    self.timeout. If you need to do periodic tasks, do them in</span></span><br><span class="line"><span class="string">    another thread.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    self.__is_shut_down.clear()</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># <span class="doctag">XXX:</span> Consider using another file descriptor or connecting to the</span></span><br><span class="line">        <span class="comment"># socket to wake this up instead of polling. Polling reduces our</span></span><br><span class="line">        <span class="comment"># responsiveness to a shutdown request and wastes cpu at all other</span></span><br><span class="line">        <span class="comment"># times.</span></span><br><span class="line">        <span class="keyword">with</span> _ServerSelector() <span class="keyword">as</span> selector:</span><br><span class="line">            selector.register(self, selectors.EVENT_READ)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> <span class="keyword">not</span> self.__shutdown_request:</span><br><span class="line">                ready = selector.select(poll_interval)  <span class="comment"># IOå¤šè·¯å¤ç”¨</span></span><br><span class="line">                <span class="keyword">if</span> ready:  <span class="comment"># å¦‚æœæœ‰æ–°çš„å®¢æˆ·ç«¯è¿æ¥ï¼Œreadyå°±ä¼šæœ‰å€¼</span></span><br><span class="line">                    self._handle_request_noblock()</span><br><span class="line"></span><br><span class="line">                self.service_actions()</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        self.__shutdown_request = <span class="literal">False</span></span><br><span class="line">        self.__is_shut_down.set()</span><br></pre></td></tr></table></figure>

<h3 id="step-5-1"><a href="#step-5-1" class="headerlink" title="step 5.1"></a>step 5.1</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ready = selector.select(poll_interval)</span><br></pre></td></tr></table></figure>

<p>IOå¤šè·¯å¤ç”¨ï¼Œè¿™é‡Œæ²¡æœ‰ä½¿ç”¨selfæ¥è°ƒï¼Œè€Œæ˜¯ä½¿ç”¨selectorå¯¹è±¡æ¥è°ƒselectæ–¹æ³•</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">select</span><span class="params">(self, timeout=None)</span>:</span></span><br><span class="line">    timeout = <span class="literal">None</span> <span class="keyword">if</span> timeout <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">else</span> max(timeout, <span class="number">0</span>)</span><br><span class="line">    ready = []</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        r, w, _ = self._select(self._readers, self._writers, [], timeout)</span><br><span class="line">    <span class="keyword">except</span> InterruptedError:</span><br><span class="line">        <span class="keyword">return</span> ready</span><br><span class="line">    r = set(r)</span><br><span class="line">    w = set(w)</span><br><span class="line">    <span class="keyword">for</span> fd <span class="keyword">in</span> r | w:</span><br><span class="line">        events = <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> fd <span class="keyword">in</span> r:</span><br><span class="line">            events |= EVENT_READ</span><br><span class="line">        <span class="keyword">if</span> fd <span class="keyword">in</span> w:</span><br><span class="line">            events |= EVENT_WRITE</span><br><span class="line"></span><br><span class="line">        key = self._key_from_fd(fd)</span><br><span class="line">        <span class="keyword">if</span> key:</span><br><span class="line">            ready.append((key, events &amp; key.events))</span><br><span class="line">    <span class="keyword">return</span> ready</span><br></pre></td></tr></table></figure>


<h3 id="step-5-2"><a href="#step-5-2" class="headerlink" title="step 5.2"></a>step 5.2</h3><p>åœ¨æœ‰å®¢æˆ·ç«¯è¿æ¥è¿›æ¥çš„æ—¶å€™ï¼Œreadyå°±æœ‰æœ‰å€¼ï¼Œä¸ºçœŸï¼Œä¼šæ‰§è¡Œ<code>self._handle_request_noblock</code>æ–¹æ³•</p>
<p>å› ä¸ºæ˜¯self.æ¥è°ƒç”¨çš„ï¼Œæ ¹æ®ç»§æ‰¿è§„åˆ™ï¼Œå°±è¦å›åˆ°æœ€å¼€å§‹çš„ç±»ä¸­ï¼Œå†é€çº§å‘ä¸ŠæŸ¥æ‰¾ï¼Œæ‰€ä»¥å›åˆ°<code>ThreadingTCPServer</code>ä¸­æŸ¥æ‰¾ï¼Œæ²¡æœ‰</p>
<p>æ ¹æ®ç»§æ‰¿çš„è§„åˆ™ï¼Œå†å»å·¦è¾¹çš„çˆ¶ç±»<code>ThreadingMixIn</code>ä¸­æŸ¥æ‰¾ï¼Œæ²¡æœ‰</p>
<p>ä¹‹åå†å»å³è¾¹çš„çˆ¶ç±»<code>TCPServer</code>ä¸­æŸ¥æ‰¾ï¼Œæ²¡æœ‰</p>
<p>æœ€ååœ¨<code>TCPServer</code>çš„çˆ¶ç±»<code>BaseServer</code>ä¸­æ‰¾åˆ°äº†<code>_handle_request_noblock</code>æ–¹æ³•</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_handle_request_noblock</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="string">"""Handle one request, without blocking.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    I assume that selector.select() has returned that the socket is</span></span><br><span class="line"><span class="string">    readable before this function was called, so there should be no risk of</span></span><br><span class="line"><span class="string">    blocking in get_request().</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        request, client_address = self.get_request() <span class="comment"># è·å–åˆ°å®¢æˆ·ç«¯è¿æ¥å¯¹è±¡socketï¼Œå’Œå®¢æˆ·ç«¯åœ°å€</span></span><br><span class="line">    <span class="keyword">except</span> OSError:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">if</span> self.verify_request(request, client_address):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            self.process_request(request, client_address)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            self.handle_error(request, client_address)</span><br><span class="line">            self.shutdown_request(request)</span><br></pre></td></tr></table></figure>

<h3 id="step-5-3"><a href="#step-5-3" class="headerlink" title="step 5.3"></a>step 5.3</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">request, client_address = self.get_request()</span><br></pre></td></tr></table></figure>

<p>æ ¹æ®ç±»å›¾æŸ¥æ‰¾ï¼Œåœ¨TCPServerç±»ä¸­</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_request</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="string">"""Get the request and client address from the socket.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    May be overridden.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">return</span> self.socket.accept()</span><br></pre></td></tr></table></figure>

<p>æ¥å—å®¢æˆ·ç«¯è¿æ¥è¯·æ±‚</p>
<h2 id="step-6"><a href="#step-6" class="headerlink" title="step 6"></a>step 6</h2><p>åœ¨<code>_handle_request_noblock</code>æ–¹æ³•ä¸­åˆæ‰§è¡Œäº†<code>self.process_request</code>æ–¹æ³•</p>
<p>å›åˆ°<code>ThreadingTCPServer</code>ä¸­æŸ¥æ‰¾ï¼Œæ²¡æœ‰</p>
<p>æ ¹æ®ç»§æ‰¿çš„è§„åˆ™ï¼Œåœ¨å·¦è¾¹çš„çˆ¶ç±»<code>ThreadingMixIn</code>ä¸­æ‰¾åˆ°è¯¥æ–¹æ³•</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">process_request</span><span class="params">(self, request, client_address)</span>:</span></span><br><span class="line">    <span class="string">"""Start a new thread to process the request."""</span></span><br><span class="line">    t = threading.Thread(target = self.process_request_thread,</span><br><span class="line">                         args = (request, client_address))</span><br><span class="line">    t.daemon = self.daemon_threads</span><br><span class="line">    t.start()</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œä½¿ç”¨äº†å¤šçº¿ç¨‹å»æ‰§è¡Œ<code>self.process_request_thread</code>æ–¹æ³•</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">t = threading.Thread(target = self.process_request_thread,</span><br><span class="line">                         args = (request, client_address))</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨äº†selfè°ƒç”¨ï¼Œè¿˜æ˜¯è¦ä»å¤´æŸ¥æ‰¾</p>
<h2 id="step-7"><a href="#step-7" class="headerlink" title="step 7"></a>step 7</h2><p>åœ¨<code>ThreadingMixIn</code>ç±»ä¸­æ‰¾åˆ°</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">process_request_thread</span><span class="params">(self, request, client_address)</span>:</span></span><br><span class="line">    <span class="string">"""Same as in BaseServer but as a thread.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    In addition, exception handling is done here.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        self.finish_request(request, client_address)</span><br><span class="line">        self.shutdown_request(request)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        self.handle_error(request, client_address)</span><br><span class="line">        self.shutdown_request(request)</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªæ–¹æ³•åº”è¯¥æ˜¯ç”¨æ¥æ¥æ”¶å®¢æˆ·ç«¯å‘æ¥çš„è¯·æ±‚ä»¥åŠç»™å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯</p>
<h2 id="step-8"><a href="#step-8" class="headerlink" title="step 8"></a>step 8</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">self.finish_request(request, client_address)</span><br></pre></td></tr></table></figure>

<p>æ ¹æ®ç±»å›¾ï¼Œåœ¨<code>BaseServer</code>ä¸­æ‰¾åˆ°</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">finish_request</span><span class="params">(self, request, client_address)</span>:</span></span><br><span class="line">    <span class="string">"""Finish one request by instantiating RequestHandlerClass."""</span></span><br><span class="line">    self.RequestHandlerClass(request, client_address, self)</span><br></pre></td></tr></table></figure>

<p>åœ¨<code>step3</code>ä¸­å·²ç»å°è£…äº†<code>RequestHandlerClass = MyClass</code></p>
<p>ç›¸å½“äºæ‰§è¡Œäº†MyClassçš„æ„é€ æ–¹æ³•</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">MyClass(request, client_address, self)</span><br></pre></td></tr></table></figure>

<h2 id="step-9"><a href="#step-9" class="headerlink" title="step 9"></a>step 9</h2><p>MyClassä¸­æ²¡æœ‰å®šä¹‰æ„é€ æ–¹æ³•ï¼Œåœ¨MyClassç»§æ‰¿çš„çˆ¶ç±»<code>socketserver.BaseRequestHandler</code>ä¸­æŸ¥æ‰¾ï¼Œæ‰¾åˆ°äº†æ„é€ æ–¹æ³•</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, request, client_address, server)</span>:</span></span><br><span class="line">    self.request = request</span><br><span class="line">    self.client_address = client_address</span><br><span class="line">    self.server = server</span><br><span class="line">    self.setup()</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        self.handle()</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        self.finish()</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œäº†<code>self.handle()</code></p>
<h2 id="step-10"><a href="#step-10" class="headerlink" title="step 10"></a>step 10</h2><p>æ‰§è¡Œ<code>self.handle()</code>æ–¹æ³•æ—¶ï¼Œå°±ä¼šæ‰§è¡ŒMyClassä¸­å®šä¹‰çš„<code>handle</code>æ–¹æ³•</p>
<p>åœ¨ç¤ºä¾‹ä»£ç ä¸­ï¼Œæˆ‘ä»¬å·²ç»è‡ªå®šä¹‰äº†ä¸€ä¸ªæ–¹æ³•å»å®ç°ä¸å®¢æˆ·ç«¯çš„äº¤äº’ï¼Œ</p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>ç½‘ç»œç¼–ç¨‹</tag>
        <tag>socketserver</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOSæŒ‚è½½exFATæ–‡ä»¶ç³»ç»Ÿ</title>
    <url>/2016/07/15/CentOS%E6%8C%82%E8%BD%BDexFAT%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/</url>
    <content><![CDATA[<h1 id="ä¸‹è½½è½¯ä»¶"><a href="#ä¸‹è½½è½¯ä»¶" class="headerlink" title="ä¸‹è½½è½¯ä»¶"></a>ä¸‹è½½è½¯ä»¶</h1><p><a href="http://oss.20150509.cn/exfat-utils-1.0.1-2.el6.src.rpm" target="_blank" rel="noopener">http://oss.20150509.cn/exfat-utils-1.0.1-2.el6.src.rpm</a></p>
<p><a href="http://oss.20150509.cn/fuse-exfat-1.0.1-2.el6.src.rpm" target="_blank" rel="noopener">http://oss.20150509.cn/fuse-exfat-1.0.1-2.el6.src.rpm</a></p>
<h1 id="ç¼–è¯‘å®‰è£…"><a href="#ç¼–è¯‘å®‰è£…" class="headerlink" title="ç¼–è¯‘å®‰è£…"></a>ç¼–è¯‘å®‰è£…</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; yum install scons gcc  <span class="comment"># ç¼–è¯‘å®‰è£…éœ€è¦ç³»ç»Ÿæœ‰è¿™ä¸¤ä¸ªè½¯ä»¶çš„æ”¯æŒ</span></span><br><span class="line">&gt; yum install fuse-devel  <span class="comment"># fuseæ¨¡å—ï¼Œç¼–è¯‘éœ€è¦fuse-develåŒ…æ”¯æŒ</span></span><br><span class="line">&gt; rpm -ivh fuse-exfat-1.0.1-2.el6.src.rpm exfat-utils-1.0.1-2.el6.src.rpm&gt;</span><br><span class="line">&gt; </span><br><span class="line">&gt; <span class="built_in">cd</span> ~/rpmbuild/SPECS</span><br><span class="line">&gt; rpmbuild -ba fuse-exfat.spec</span><br><span class="line">&gt; rpmbuild -ba exfat-utils.spec</span><br><span class="line">&gt; </span><br><span class="line">&gt; <span class="built_in">cd</span> ~/rpmbuild/RPMS/x86_64</span><br><span class="line">&gt; rpm -ivh fuse-exfat-1.0.1-2.el6.x86_64.rpm exfat-utils-1.0.1-2.el6.x86_64.rpm</span><br></pre></td></tr></table></figure>

<h1 id="æŒ‚è½½"><a href="#æŒ‚è½½" class="headerlink" title="æŒ‚è½½"></a>æŒ‚è½½</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; mount.exfat /dev/sdx /mnt</span><br><span class="line">&gt; <span class="comment"># or</span></span><br><span class="line">&gt; mount -t exfat /dev/sdx /mnt</span><br></pre></td></tr></table></figure>

<p><em>å¦‚æœæŒ‡å®š-tæ‰¾ä¸åˆ°æ­¤ç±»å‹çš„è¯æ‰§è¡Œï¼šln -s /usr/sbin/mount.exfat /sbin/mount.exfat</em></p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>exFAT</tag>
        <tag>mount</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonä¸‹ä½¿ç”¨IOå¤šè·¯å¤ç”¨(å…¥é—¨ç¯‡)</title>
    <url>/2016/07/12/Python%E4%B8%8B%E4%BD%BF%E7%94%A8IO%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8-%E5%85%A5%E9%97%A8%E7%AF%87/</url>
    <content><![CDATA[<blockquote>
<p>IOæ“ä½œæ˜¯ä¸å ç”¨CPUçš„ï¼ŒIOå¤šè·¯å¤ç”¨ï¼Œæ˜¯è¦ç®¡ç†èµ·æ‰€æœ‰çš„IOæ“ä½œã€‚IOå¤šè·¯å¤ç”¨çš„å…¸å‹åœºæ™¯æ˜¯ç›‘å¬socketå¯¹è±¡å†…éƒ¨æ˜¯å¦å‘ç”Ÿäº†å˜åŒ–</p>
</blockquote>
<p>socketå†…éƒ¨ä»€ä¹ˆæ—¶å€™ä¼šæœ‰å˜åŒ–ï¼š</p>
<ul>
<li>å»ºç«‹è¿æ¥</li>
<li>å‘é€æ¶ˆæ¯</li>
</ul>
<h1 id="socketå®ä¾‹"><a href="#socketå®ä¾‹" class="headerlink" title="socketå®ä¾‹"></a>socketå®ä¾‹</h1><p>è¿™é‡Œä½¿ç”¨socketå®ç°ä¸€ä¸ªç®€å•çš„Echo Serverçš„åŠŸèƒ½</p>
<ul>
<li><font color="red">server.py</font> </li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºsocketå¯¹è±¡,ç»‘å®šIPç«¯å£,ç›‘å¬</span></span><br><span class="line">sk = socket.socket()</span><br><span class="line">sk.bind((<span class="string">'127.0.0.1'</span>, <span class="number">1559</span>))</span><br><span class="line">sk.listen(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¾ªç¯æ¥å—æ¯ä¸€ä¸ªè¿æ¥æ± ä¸­çš„è¿æ¥</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="comment"># æ¥å—å®¢æˆ·ç«¯è¿æ¥</span></span><br><span class="line">    conn, address = sk.accept()</span><br><span class="line">    <span class="comment"># å‘å®¢æˆ·ç«¯å‘é€æ¬¢è¿æ¶ˆæ¯</span></span><br><span class="line">    conn.sendall(bytes(<span class="string">'hello'</span>, encoding=<span class="string">'utf8'</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è¿›å…¥åˆ°æ”¶å‘æ¶ˆæ¯çš„å¾ªç¯ä¸­</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Windowså®¢æˆ·ç«¯åœ¨å¼‚å¸¸æ–­å¼€åæŠ›å‡ºå¼‚å¸¸,è¿™é‡Œæ˜¯å¤„ç†Windowsçš„æ–­å¼€æƒ…å†µ</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            recv = conn.recv(<span class="number">1024</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Linuxå®¢æˆ·ç«¯æ–­å¼€recvä¼šæ˜¯ç©ºå€¼,è¿™é‡Œå¤„ç†Linuxçš„æ–­å¼€æƒ…å†µ</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> recv:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># è¿™é‡Œå¤„ç†å®¢æˆ·ç«¯ä¸»åŠ¨å‘å‡ºæ–­å¼€è¯·æ±‚çš„æƒ…å†µ</span></span><br><span class="line">            <span class="keyword">if</span> str(recv, encoding=<span class="string">'utf-8'</span>) == <span class="string">'exit'</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> ex:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># å‘å®¢æˆ·ç«¯å‘é€æ•°æ®</span></span><br><span class="line">        conn.sendall(recv)</span><br></pre></td></tr></table></figure>

<ul>
<li><font color="blue">client.py</font> </li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">sk = socket.socket()</span><br><span class="line">sk.connect((<span class="string">'127.0.0.1'</span>, <span class="number">1559</span>))</span><br><span class="line"><span class="comment"># æ¥æ”¶æ¬¢è¿æ¶ˆæ¯</span></span><br><span class="line">data = sk.recv(<span class="number">1024</span>)</span><br><span class="line">print(data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    i = input(<span class="string">"&gt; "</span>)</span><br><span class="line">    <span class="comment"># å‘æœåŠ¡ç«¯å‘é€æ¶ˆæ¯</span></span><br><span class="line">    sk.sendall(bytes(i, encoding=<span class="string">'utf8'</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ¥æ”¶æœåŠ¡ç«¯å‘æ¥çš„æ¶ˆæ¯</span></span><br><span class="line">    msg = sk.recv(<span class="number">1024</span>)</span><br><span class="line">    print(str(msg, encoding=<span class="string">'utf-8'</span>))</span><br><span class="line"></span><br><span class="line">sk.close()</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šçš„socketä»£ç åŒä¸€æ—¶é—´ä»…èƒ½å¤„ç†ä¸€ä¸ªå®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œä¹‹åè¿æ¥ä¸Šæ¥çš„å®¢æˆ·ç«¯åœ¨ç¬¬ä¸€ä¸ªå®¢æˆ·ç«¯è¿˜æ²¡æœ‰æ–­å¼€çš„æ—¶å€™ï¼Œä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°ä¸Šä¸€ä¸ªå®¢æˆ·ç«¯çš„è¯·æ±‚æ–­å¼€</p>
<h1 id="select-selext-ä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•°"><a href="#select-selext-ä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•°" class="headerlink" title="select.selext()ä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•°"></a>select.selext()ä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•°</h1><h2 id="å»ºç«‹è¿æ¥"><a href="#å»ºç«‹è¿æ¥" class="headerlink" title="å»ºç«‹è¿æ¥"></a>å»ºç«‹è¿æ¥</h2><p>ä¸Šé¢è¯´åˆ°ï¼Œä¸€ç§socketä¼šå˜çš„æƒ…å†µæ˜¯å»ºç«‹è¿æ¥</p>
<p>ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæ¶‰åŠåˆ°å»ºç«‹è¿æ¥çš„socketæ˜¯skå¯¹è±¡ï¼ˆå˜é‡ï¼‰skå¯¹è±¡åœ¨æ‰§è¡Œåˆ°<code>sk.accept()</code>æ—¶ï¼Œæ¥å—äº†ä¸€ä¸ªæ–°å®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚æ—¶å€™ï¼Œsocketå†…éƒ¨å°±å‘ç”Ÿäº†å˜åŒ–ï¼Œæˆ‘ä»¬å°±éœ€è¦ç›‘å¬è¿™ç§å˜åŒ–ï¼Œç”¨ä»¥åˆ†è¾¨å‡ºæ–°çš„å®¢æˆ·ç«¯çš„è¿æ¥</p>
<p><em>åˆ›å»ºsocketï¼Œç»‘å®šå¹¶ç›‘å¬ä¹‹åsocketä¸€èˆ¬ä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œåªæœ‰å½“æœ‰æ–°çš„å®¢æˆ·ç«¯è¿æ¥è¿›æ¥çš„æ—¶å€™ï¼Œsocketæ‰ä¼šå‘ç”Ÿå˜åŒ–ï¼Œæˆ‘ä»¬éœ€è¦ç›‘å¬çš„ä¹Ÿæ˜¯è¿™ä¸ªé˜¶æ®µçš„å˜åŒ–</em></p>
<p><strong>å¾—å‡ºç»“è®ºï¼šå½“socketè¢«åˆ›å»ºã€ç»‘å®šå¹¶ç›‘å¬ä¹‹åå‘ç”Ÿå˜åŒ–ï¼Œå°±æ˜¯æœ‰æ–°çš„å®¢æˆ·ç«¯è¿›è¡Œè¿æ¥</strong></p>
<ul>
<li><font color="red">server.py</font> </li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> select</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºsocketå¯¹è±¡,ç»‘å®šIPç«¯å£,ç›‘å¬</span></span><br><span class="line">sk = socket.socket()</span><br><span class="line">sk.bind((<span class="string">'127.0.0.1'</span>, <span class="number">1559</span>))</span><br><span class="line">sk.listen(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    rList, w, e = select.select([sk,], [], [], <span class="number">1</span>)</span><br><span class="line">    print(rList)</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢ä»£ç å¼•å…¥äº†IOå¤šè·¯å¤ç”¨ä¸­çš„selectæ¨¡å‹ï¼Œä½¿ç”¨select.select()æ–¹æ³•ï¼Œä¼šè¿”å›ä¸€ä¸ªæœ‰ä¸‰ä¸ªå…ƒç´ çš„å…ƒç¥–</p>
<p>åœ¨select.select()æ–¹æ³•ä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œæš‚æ—¶åªæ·»åŠ äº†ä¸€ä¸ªæœåŠ¡ç«¯çš„socketå¯¹è±¡ï¼Œåªè¦æœåŠ¡ç«¯socketå¯¹è±¡skæœ‰å˜åŒ–ï¼ˆæ–°çš„å®¢æˆ·ç«¯è¿æ¥ï¼‰å°±ç«‹å³æŠŠå˜åŒ–çš„socketå¯¹è±¡åŠ å…¥åˆ°rListåˆ—è¡¨ä¸­</p>
<p><strong>ç›‘å¬çš„socketåˆ—è¡¨ä¸­ï¼Œskå¯¹è±¡æœ‰å˜åŒ– â€”&gt; rList = [sk]</strong></p>
<p><strong>ç›‘å¬çš„socketåˆ—è¡¨ä¸­ï¼Œæ²¡æœ‰socketå‘ç”Ÿå˜åŒ– â€”&gt; rList = []</strong></p>
<p>ä»¥ä¸Šä»£ç è·‘èµ·æ¥çš„æ•ˆæœï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[]</span><br><span class="line">[]</span><br><span class="line">[]</span><br><span class="line">...</span><br><span class="line"># æ¯ç§’æ‰“å°ä¸€ä¸ª[]</span><br><span class="line"># select.sekect()ä¸­çš„ç¬¬å››ä¸ªå‚æ•°èµ·äº†ä½œç”¨</span><br><span class="line"># è¶…æ—¶æ—¶é—´ï¼Œç›‘å¬çš„å¯¹è±¡æ²¡æœ‰å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œå¤šå°‘ç§’å¾ªç¯ä¸€æ¬¡</span><br></pre></td></tr></table></figure>

<p>è¯´æ˜æ²¡æœ‰æ–°çš„è¿æ¥è¯·æ±‚ï¼Œä¸‹é¢å°†è¯•éªŒæœ‰å®¢æˆ·ç«¯è¿æ¥äº§ç”Ÿçš„æƒ…å†µ</p>
<ul>
<li><font color="blue">client.py</font> </li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">sk = socket.socket()</span><br><span class="line">sk.connect((<span class="string">'127.0.0.1'</span>, <span class="number">1559</span>))</span><br><span class="line">sk.close()</span><br></pre></td></tr></table></figure>

<p>å®¢æˆ·ç«¯ä¸€æ—¦è¿æ¥åˆ°æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯çš„å›æ˜¾å¦‚ä¸‹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[&lt;socket.socket fd&#x3D;3, family&#x3D;AddressFamily.AF_INET, type&#x3D;SocketKind.SOCK_STREAM, proto&#x3D;0, laddr&#x3D;(&#39;127.0.0.1&#39;, 1559)&gt;]</span><br><span class="line">[&lt;socket.socket fd&#x3D;3, family&#x3D;AddressFamily.AF_INET, type&#x3D;SocketKind.SOCK_STREAM, proto&#x3D;0, laddr&#x3D;(&#39;127.0.0.1&#39;, 1559)&gt;]</span><br><span class="line">[&lt;socket.socket fd&#x3D;3, family&#x3D;AddressFamily.AF_INET, type&#x3D;SocketKind.SOCK_STREAM, proto&#x3D;0, laddr&#x3D;(&#39;127.0.0.1&#39;, 1559)&gt;]</span><br><span class="line">...</span><br><span class="line"># ç–¯ç‹‚çš„å¿«é€Ÿæ‰“å°...</span><br></pre></td></tr></table></figure>
<p>ä»ä¸Šé¢å¯ä»¥çœ‹å‡ºï¼Œæœ‰ä¸€ä¸ªå®¢æˆ·ç«¯è¿æ¥è¿›æ¥äº†ã€‚æœåŠ¡ç«¯çš„skå¯¹è±¡å†…éƒ¨å‘ç”Ÿäº†å˜åŒ–ï¼Œå½“selectç›‘å¬åˆ°skå¯¹è±¡å‘ç”Ÿå˜åŒ–åï¼Œç«‹å³å°†å‘ç”Ÿå˜åŒ–çš„å¯¹è±¡èµ‹å€¼ç»™äº†rListåˆ—è¡¨ï¼ˆappendåˆ°åˆ—è¡¨ï¼‰ä»æ‰“å°å‡ºæ¥çš„å†…å®¹ä¸­å¯ä»¥çœ‹å‡ºï¼Œåˆ—è¡¨ä¸­çš„å…ƒç´ æ˜¯å‘ç”Ÿå˜åŒ–çš„socketå¯¹è±¡</p>
<h3 id="å¤„ç†rListï¼ˆæœåŠ¡ç«¯socketï¼‰"><a href="#å¤„ç†rListï¼ˆæœåŠ¡ç«¯socketï¼‰" class="headerlink" title="å¤„ç†rListï¼ˆæœåŠ¡ç«¯socketï¼‰"></a>å¤„ç†rListï¼ˆæœåŠ¡ç«¯socketï¼‰</h3><p>rListä¸­ä¿å­˜äº†æ‰€æœ‰å‘ç”Ÿå˜åŒ–çš„socketå¯¹è±¡ï¼Œä»¥ä¸Šä»£ç ä¸­åªç›‘å¬äº†æœåŠ¡ç«¯socketå¯¹è±¡ï¼Œè¿™é‡Œæš‚æ—¶åªè®¨è®ºæœåŠ¡ç«¯socketå˜åŒ–çš„æƒ…å†µ</p>
<ul>
<li><font color="red">server.py</font> </li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> select</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºsocketå¯¹è±¡,ç»‘å®šIPç«¯å£,ç›‘å¬</span></span><br><span class="line">sk = socket.socket()</span><br><span class="line">sk.bind((<span class="string">'127.0.0.1'</span>, <span class="number">1559</span>))</span><br><span class="line">sk.listen(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">	<span class="comment"># ç›‘å¬æœåŠ¡ç«¯socketå¯¹è±¡sk</span></span><br><span class="line">    rList, w, e = select.select([sk,], [], [], <span class="number">1</span>)</span><br><span class="line">    print(rList)</span><br><span class="line">	</span><br><span class="line">	<span class="comment"># éå†rListä¸­çš„æ¯ä¸€ä¸ªsocketå¯¹è±¡</span></span><br><span class="line">	<span class="comment"># ç›®å‰rListä¸­åªä¼šå‡ºç°æœåŠ¡ç«¯çš„socketå¯¹è±¡</span></span><br><span class="line">    <span class="keyword">for</span> s <span class="keyword">in</span> rList:</span><br><span class="line">        conn, address = s.accept()</span><br><span class="line">        conn.sendall(bytes(<span class="string">'hello'</span>, encoding=<span class="string">'utf8'</span>))</span><br></pre></td></tr></table></figure>

<ul>
<li><font color="blue">client.py</font> </li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">sk = socket.socket()</span><br><span class="line">sk.connect((<span class="string">'127.0.0.1'</span>, <span class="number">1559</span>))</span><br><span class="line">data = sk.recv(<span class="number">1024</span>)</span><br><span class="line">print(data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    input(<span class="string">"&gt; "</span>)</span><br><span class="line"></span><br><span class="line">sk.close()</span><br></pre></td></tr></table></figure>

<p>è¿ç»­è¿è¡Œä¸‰ä¸ªå®¢æˆ·ç«¯è¿æ¥æ—¶ï¼ŒæœåŠ¡ç«¯çš„å›æ˜¾ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[]</span><br><span class="line">[]</span><br><span class="line">[&lt;socket.socket fd&#x3D;3, family&#x3D;AddressFamily.AF_INET, type&#x3D;SocketKind.SOCK_STREAM, proto&#x3D;0, laddr&#x3D;(&#39;127.0.0.1&#39;, 1559)&gt;]</span><br><span class="line">[]</span><br><span class="line">[&lt;socket.socket fd&#x3D;3, family&#x3D;AddressFamily.AF_INET, type&#x3D;SocketKind.SOCK_STREAM, proto&#x3D;0, laddr&#x3D;(&#39;127.0.0.1&#39;, 1559)&gt;]</span><br><span class="line">[]</span><br><span class="line">[&lt;socket.socket fd&#x3D;3, family&#x3D;AddressFamily.AF_INET, type&#x3D;SocketKind.SOCK_STREAM, proto&#x3D;0, laddr&#x3D;(&#39;127.0.0.1&#39;, 1559)&gt;]</span><br><span class="line">[]</span><br><span class="line">[]</span><br></pre></td></tr></table></figure>


<p><strong>æ¯ä¸ª</strong>å®¢æˆ·ç«¯çš„å›æ˜¾ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">b&#39;hello&#39;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šé€šè¿‡å¯¹rListä¸­æœåŠ¡ç«¯socketå¯¹è±¡æ‰§è¡Œaccept()æ–¹æ³•ï¼Œæ¥å®ç°äº†ä¸€ä¸ªç±»ä¼¼å¹¶å‘è¿æ¥çš„æ•ˆæœï¼Œæ¯ä¸€ä¸ªè¿æ¥è¿›æ¥çš„å®¢æˆ·ç«¯éƒ½ä¼šè¢«æœåŠ¡ç«¯æ¥å—è¯·æ±‚ï¼Œâ€œåŒæ—¶â€æä¾›æœåŠ¡</p>
<h2 id="æ¥æ”¶å®¢æˆ·ç«¯æ¶ˆæ¯"><a href="#æ¥æ”¶å®¢æˆ·ç«¯æ¶ˆæ¯" class="headerlink" title="æ¥æ”¶å®¢æˆ·ç«¯æ¶ˆæ¯"></a>æ¥æ”¶å®¢æˆ·ç«¯æ¶ˆæ¯</h2><p>ä¸Šé¢æåˆ°ï¼Œä¸ä»…åˆ›å»ºè¿æ¥ä¼šè§¦å‘socketçš„å˜åŒ–ï¼Œä¸å®¢æˆ·ç«¯è¿æ¥å»ºç«‹åï¼Œå®¢æˆ·ç«¯å‘æ¥æ¶ˆæ¯ï¼Œä¹Ÿä¼šå¼•å‘å®¢æˆ·ç«¯socketè¿æ¥çš„å†…éƒ¨å˜åŒ–</p>
<ul>
<li><font color="red">server.py</font> </li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> select</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºsocketå¯¹è±¡,ç»‘å®šIPç«¯å£,ç›‘å¬</span></span><br><span class="line">sk = socket.socket()</span><br><span class="line">sk.bind((<span class="string">'127.0.0.1'</span>, <span class="number">1559</span>))</span><br><span class="line">sk.listen(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">inputs = [sk]</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    rList, w, e = select.select(inputs, [], [], <span class="number">1</span>)</span><br><span class="line">    print(rList)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> s <span class="keyword">in</span> rList:</span><br><span class="line">        conn, address = s.accept()</span><br><span class="line">        <span class="comment"># connä¹Ÿæ˜¯ä¸€ä¸ªsocketå¯¹è±¡</span></span><br><span class="line">        <span class="comment"># å½“æœåŠ¡ç«¯socketæ¥æ”¶åˆ°å®¢æˆ·çš„è¯·æ±‚å,ä¼šåˆ†é…ä¸€ä¸ªæ–°çš„socketå¯¹è±¡ä¸“é—¨ç”¨æ¥å’Œè¿™ä¸ªå®¢æˆ·ç«¯è¿›è¡Œè¿æ¥é€šä¿¡</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># å½“æœåŠ¡ç«¯åˆ†é…æ–°çš„socketå¯¹è±¡ç»™æ–°è¿æ¥è¿›æ¥çš„å®¢æˆ·ç«¯çš„æ—¶å€™</span></span><br><span class="line">        <span class="comment"># æˆ‘ä»¬ä¹Ÿéœ€è¦ç›‘å¬è¿™ä¸ªå®¢æˆ·ç«¯çš„socketå¯¹è±¡æ˜¯å¦ä¼šå‘ç”Ÿå˜åŒ–</span></span><br><span class="line">        <span class="comment"># ä¸€æ—¦å‘ç”Ÿå˜åŒ–,æ„å‘³ç€å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ç«¯å‘æ¥äº†æ¶ˆæ¯</span></span><br><span class="line">        inputs.append(conn)</span><br><span class="line">        conn.sendall(bytes(<span class="string">'hello'</span>, encoding=<span class="string">'utf8'</span>))</span><br></pre></td></tr></table></figure>

<p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘æŠŠæœåŠ¡ç«¯socketä¸ºæ–°å®¢æˆ·ç«¯åˆ›å»ºçš„socketä¹ŸåŠ å…¥åˆ°äº†ç›‘å¬åˆ—è¡¨ä¸­ï¼Œé‚£ä¹ˆå¦‚æœæœ‰å®¢æˆ·ç«¯å‘æ¥æ¶ˆæ¯ï¼Œselectç›‘å¬åˆ°å®¢æˆ·ç«¯socketï¼ˆconnï¼‰å‘ç”Ÿå˜åŒ–å¹¶åŠ å…¥åˆ°rListåˆ—è¡¨ä¸­åï¼Œåœ¨forå¾ªç¯å¤„ç†ä¸­ï¼Œå®¢æˆ·ç«¯çš„socketå¹¶æ²¡æœ‰accept()æ–¹æ³•ï¼Œè€Œä¸”ä¹Ÿä¸è¦è¿™ä¸ªæ–¹æ³•ï¼Œè¿™å°±éœ€è¦åœ¨forå¾ªç¯ä¸­å¯¹ä¸¤ç±»socketåŒºåˆ†å¯¹å¾…</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> select</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºsocketå¯¹è±¡,ç»‘å®šIPç«¯å£,ç›‘å¬</span></span><br><span class="line">sk = socket.socket()</span><br><span class="line">sk.bind((<span class="string">'127.0.0.1'</span>, <span class="number">1559</span>))</span><br><span class="line">sk.listen(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">inputs = [sk]</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    rList, w, e = select.select(inputs, [], [], <span class="number">1</span>)</span><br><span class="line">    print(<span class="string">"selectå½“å‰ç›‘å¬socketå¯¹è±¡çš„æ•°é‡&gt;"</span>, len(inputs), <span class="string">" | å‘ç”Ÿå˜åŒ–çš„socketæ•°é‡&gt;"</span>, len(rList))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> s <span class="keyword">in</span> rList:</span><br><span class="line">        <span class="comment"># åˆ¤æ–­socketå¯¹è±¡å¦‚æœæ˜¯æœåŠ¡ç«¯çš„socketå¯¹è±¡çš„è¯</span></span><br><span class="line">        <span class="keyword">if</span> s == sk:</span><br><span class="line">            conn, address = s.accept()</span><br><span class="line">            <span class="comment"># connä¹Ÿæ˜¯ä¸€ä¸ªsocketå¯¹è±¡</span></span><br><span class="line">            <span class="comment"># å½“æœåŠ¡ç«¯socketæ¥æ”¶åˆ°å®¢æˆ·çš„è¯·æ±‚å,ä¼šåˆ†é…ä¸€ä¸ªæ–°çš„socketå¯¹è±¡ä¸“é—¨ç”¨æ¥å’Œè¿™ä¸ªå®¢æˆ·ç«¯è¿›è¡Œè¿æ¥é€šä¿¡</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># å½“æœåŠ¡ç«¯åˆ†é…æ–°çš„socketå¯¹è±¡ç»™æ–°è¿æ¥è¿›æ¥çš„å®¢æˆ·ç«¯çš„æ—¶å€™</span></span><br><span class="line">            <span class="comment"># æˆ‘ä»¬ä¹Ÿéœ€è¦ç›‘å¬è¿™ä¸ªå®¢æˆ·ç«¯çš„socketå¯¹è±¡æ˜¯å¦ä¼šå‘ç”Ÿå˜åŒ–</span></span><br><span class="line">            <span class="comment"># ä¸€æ—¦å‘ç”Ÿå˜åŒ–,æ„å‘³ç€å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ç«¯å‘æ¥äº†æ¶ˆæ¯</span></span><br><span class="line">            inputs.append(conn)</span><br><span class="line">            conn.sendall(bytes(<span class="string">'hello'</span>, encoding=<span class="string">'utf8'</span>))</span><br><span class="line">        <span class="comment"># å…¶ä»–çš„å°±éƒ½æ˜¯å®¢æˆ·ç«¯çš„socketå¯¹è±¡äº†</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># æ„å‘³ç€å®¢æˆ·ç«¯ç»™æœåŠ¡ç«¯å‘é€æ¶ˆæ¯äº†</span></span><br><span class="line">            msg = s.recv(<span class="number">1024</span>)</span><br><span class="line">            print(msg)</span><br></pre></td></tr></table></figure>

<ul>
<li><font color="blue">client.py</font> </li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">sk = socket.socket()</span><br><span class="line">sk.connect((<span class="string">'127.0.0.1'</span>, <span class="number">1559</span>))</span><br><span class="line"><span class="comment"># æ¥æ”¶æ¬¢è¿æ¶ˆæ¯</span></span><br><span class="line">data = sk.recv(<span class="number">1024</span>)</span><br><span class="line">print(data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    i = input(<span class="string">"&gt; "</span>)</span><br><span class="line">    <span class="comment"># å‘æœåŠ¡ç«¯å‘é€æ¶ˆæ¯</span></span><br><span class="line">    sk.sendall(bytes(i, encoding=<span class="string">'utf8'</span>))</span><br><span class="line"></span><br><span class="line">sk.close()</span><br></pre></td></tr></table></figure>

<p>å½“æˆ‘è¿è¡Œä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œå¹¶Ctrl+Cé€€å‡ºæ—¶ï¼ŒæœåŠ¡ç«¯å›æ˜¾ç•Œé¢åœ¨ç–¯ç‹‚çš„æ‰“å°æ¶ˆæ¯ã€‚é—®é¢˜å‡ºåœ¨äº†æœåŠ¡ç«¯ç›‘å¬çš„å®¢æˆ·ç«¯socketè¿æ¥ï¼Œå½“å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯æ–­å¼€è¿æ¥æ—¶ï¼Œåº”åœ¨æœåŠ¡ç«¯selectç›‘å¬socketå¯¹è±¡åˆ—è¡¨ä¸­å°†è¯¥å®¢æˆ·ç«¯socketå¯¹è±¡ç§»é™¤</p>
<ul>
<li><font color="red">server.py</font> </li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> select</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºsocketå¯¹è±¡,ç»‘å®šIPç«¯å£,ç›‘å¬</span></span><br><span class="line">sk = socket.socket()</span><br><span class="line">sk.bind((<span class="string">'127.0.0.1'</span>, <span class="number">1559</span>))</span><br><span class="line">sk.listen(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">inputs = [sk]</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    rList, w, e = select.select(inputs, [], [], <span class="number">1</span>)</span><br><span class="line">    print(<span class="string">"selectå½“å‰ç›‘å¬socketå¯¹è±¡çš„æ•°é‡&gt;"</span>, len(inputs), <span class="string">" | å‘ç”Ÿå˜åŒ–çš„socketæ•°é‡&gt;"</span>, len(rList))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> s <span class="keyword">in</span> rList:</span><br><span class="line">        <span class="comment"># åˆ¤æ–­socketå¯¹è±¡å¦‚æœæ˜¯æœåŠ¡ç«¯çš„socketå¯¹è±¡çš„è¯</span></span><br><span class="line">        <span class="keyword">if</span> s == sk:</span><br><span class="line">            conn, address = s.accept()</span><br><span class="line">            <span class="comment"># connä¹Ÿæ˜¯ä¸€ä¸ªsocketå¯¹è±¡</span></span><br><span class="line">            <span class="comment"># å½“æœåŠ¡ç«¯socketæ¥æ”¶åˆ°å®¢æˆ·çš„è¯·æ±‚å,ä¼šåˆ†é…ä¸€ä¸ªæ–°çš„socketå¯¹è±¡ä¸“é—¨ç”¨æ¥å’Œè¿™ä¸ªå®¢æˆ·ç«¯è¿›è¡Œè¿æ¥é€šä¿¡</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># å½“æœåŠ¡ç«¯åˆ†é…æ–°çš„socketå¯¹è±¡ç»™æ–°è¿æ¥è¿›æ¥çš„å®¢æˆ·ç«¯çš„æ—¶å€™</span></span><br><span class="line">            <span class="comment"># æˆ‘ä»¬ä¹Ÿéœ€è¦ç›‘å¬è¿™ä¸ªå®¢æˆ·ç«¯çš„socketå¯¹è±¡æ˜¯å¦ä¼šå‘ç”Ÿå˜åŒ–</span></span><br><span class="line">            <span class="comment"># ä¸€æ—¦å‘ç”Ÿå˜åŒ–,æ„å‘³ç€å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ç«¯å‘æ¥äº†æ¶ˆæ¯</span></span><br><span class="line">            inputs.append(conn)</span><br><span class="line">            conn.sendall(bytes(<span class="string">'hello'</span>, encoding=<span class="string">'utf8'</span>))</span><br><span class="line">        <span class="comment"># å…¶ä»–çš„å°±éƒ½æ˜¯å®¢æˆ·ç«¯çš„socketå¯¹è±¡äº†</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="comment"># æ„å‘³ç€å®¢æˆ·ç«¯ç»™æœåŠ¡ç«¯å‘é€æ¶ˆæ¯äº†</span></span><br><span class="line">                msg = s.recv(<span class="number">1024</span>)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># Linuxå¹³å°ä¸‹çš„å¤„ç†</span></span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> msg:</span><br><span class="line">                    <span class="keyword">raise</span> Exception(<span class="string">'å®¢æˆ·ç«¯å·²æ–­å¼€è¿æ¥'</span>)</span><br><span class="line">                print(msg)</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> ex:</span><br><span class="line">                <span class="comment"># Windowså¹³å°ä¸‹çš„å¤„ç†</span></span><br><span class="line">                inputs.remove(s)</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨æœ€æ–°çš„server.pyä¸client.pyè¿›è¡Œæµ‹è¯•æ—¶ï¼Œä¾æ¬¡è¿è¡Œå¤šä¸ªå®¢æˆ·ç«¯ï¼Œå†ä¾æ¬¡å…³é—­å¤šä¸ªå®¢æˆ·ç«¯ï¼ŒæœåŠ¡ç«¯çš„å›æ˜¾å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">selectå½“å‰ç›‘å¬socketå¯¹è±¡çš„æ•°é‡&gt; 1  | å‘ç”Ÿå˜åŒ–çš„socketæ•°é‡&gt; 0</span><br><span class="line">selectå½“å‰ç›‘å¬socketå¯¹è±¡çš„æ•°é‡&gt; 1  | å‘ç”Ÿå˜åŒ–çš„socketæ•°é‡&gt; 0</span><br><span class="line">selectå½“å‰ç›‘å¬socketå¯¹è±¡çš„æ•°é‡&gt; 1  | å‘ç”Ÿå˜åŒ–çš„socketæ•°é‡&gt; 0</span><br><span class="line">selectå½“å‰ç›‘å¬socketå¯¹è±¡çš„æ•°é‡&gt; 1  | å‘ç”Ÿå˜åŒ–çš„socketæ•°é‡&gt; 0</span><br><span class="line">selectå½“å‰ç›‘å¬socketå¯¹è±¡çš„æ•°é‡&gt; 1  | å‘ç”Ÿå˜åŒ–çš„socketæ•°é‡&gt; 1</span><br><span class="line">selectå½“å‰ç›‘å¬socketå¯¹è±¡çš„æ•°é‡&gt; 2  | å‘ç”Ÿå˜åŒ–çš„socketæ•°é‡&gt; 0</span><br><span class="line">selectå½“å‰ç›‘å¬socketå¯¹è±¡çš„æ•°é‡&gt; 2  | å‘ç”Ÿå˜åŒ–çš„socketæ•°é‡&gt; 0</span><br><span class="line">selectå½“å‰ç›‘å¬socketå¯¹è±¡çš„æ•°é‡&gt; 2  | å‘ç”Ÿå˜åŒ–çš„socketæ•°é‡&gt; 1</span><br><span class="line">selectå½“å‰ç›‘å¬socketå¯¹è±¡çš„æ•°é‡&gt; 3  | å‘ç”Ÿå˜åŒ–çš„socketæ•°é‡&gt; 0</span><br><span class="line">selectå½“å‰ç›‘å¬socketå¯¹è±¡çš„æ•°é‡&gt; 3  | å‘ç”Ÿå˜åŒ–çš„socketæ•°é‡&gt; 0</span><br><span class="line">selectå½“å‰ç›‘å¬socketå¯¹è±¡çš„æ•°é‡&gt; 3  | å‘ç”Ÿå˜åŒ–çš„socketæ•°é‡&gt; 1</span><br><span class="line">selectå½“å‰ç›‘å¬socketå¯¹è±¡çš„æ•°é‡&gt; 4  | å‘ç”Ÿå˜åŒ–çš„socketæ•°é‡&gt; 0</span><br><span class="line">selectå½“å‰ç›‘å¬socketå¯¹è±¡çš„æ•°é‡&gt; 4  | å‘ç”Ÿå˜åŒ–çš„socketæ•°é‡&gt; 0</span><br><span class="line">selectå½“å‰ç›‘å¬socketå¯¹è±¡çš„æ•°é‡&gt; 4  | å‘ç”Ÿå˜åŒ–çš„socketæ•°é‡&gt; 0</span><br><span class="line">selectå½“å‰ç›‘å¬socketå¯¹è±¡çš„æ•°é‡&gt; 4  | å‘ç”Ÿå˜åŒ–çš„socketæ•°é‡&gt; 0</span><br><span class="line">selectå½“å‰ç›‘å¬socketå¯¹è±¡çš„æ•°é‡&gt; 4  | å‘ç”Ÿå˜åŒ–çš„socketæ•°é‡&gt; 1</span><br><span class="line">b&#39;&#39;</span><br><span class="line">selectå½“å‰ç›‘å¬socketå¯¹è±¡çš„æ•°é‡&gt; 3  | å‘ç”Ÿå˜åŒ–çš„socketæ•°é‡&gt; 0</span><br><span class="line">selectå½“å‰ç›‘å¬socketå¯¹è±¡çš„æ•°é‡&gt; 3  | å‘ç”Ÿå˜åŒ–çš„socketæ•°é‡&gt; 0</span><br><span class="line">selectå½“å‰ç›‘å¬socketå¯¹è±¡çš„æ•°é‡&gt; 3  | å‘ç”Ÿå˜åŒ–çš„socketæ•°é‡&gt; 1</span><br><span class="line">b&#39;&#39;</span><br><span class="line">selectå½“å‰ç›‘å¬socketå¯¹è±¡çš„æ•°é‡&gt; 2  | å‘ç”Ÿå˜åŒ–çš„socketæ•°é‡&gt; 0</span><br><span class="line">selectå½“å‰ç›‘å¬socketå¯¹è±¡çš„æ•°é‡&gt; 2  | å‘ç”Ÿå˜åŒ–çš„socketæ•°é‡&gt; 1</span><br><span class="line">b&#39;&#39;</span><br><span class="line">selectå½“å‰ç›‘å¬socketå¯¹è±¡çš„æ•°é‡&gt; 1  | å‘ç”Ÿå˜åŒ–çš„socketæ•°é‡&gt; 0</span><br><span class="line">selectå½“å‰ç›‘å¬socketå¯¹è±¡çš„æ•°é‡&gt; 1  | å‘ç”Ÿå˜åŒ–çš„socketæ•°é‡&gt; 0</span><br><span class="line">selectå½“å‰ç›‘å¬socketå¯¹è±¡çš„æ•°é‡&gt; 1  | å‘ç”Ÿå˜åŒ–çš„socketæ•°é‡&gt; 0</span><br><span class="line">selectå½“å‰ç›‘å¬socketå¯¹è±¡çš„æ•°é‡&gt; 1  | å‘ç”Ÿå˜åŒ–çš„socketæ•°é‡&gt; 0</span><br></pre></td></tr></table></figure>

<p><strong>ç‰¹åˆ«æ³¨æ„ï¼š</strong>è¿™é‡Œçš„æœåŠ¡ç«¯å®šä¹‰ï¼Œå½“æˆ‘æ”¶åˆ°å®¢æˆ·ç«¯å‘æ¥çš„ç©ºå€¼çš„æ—¶å€™ï¼Œæˆ‘å°±é»˜è®¤è®¤ä¸ºå®¢æˆ·ç«¯ä¸»åŠ¨éœ€è¦æ–­å¼€ä¸æœåŠ¡ç«¯çš„è¿æ¥ã€‚ç”±äºæœåŠ¡ç«¯çš„è¿™ä¸ªé»˜è®¤è§„åˆ™ï¼Œåœ¨å†™å®¢æˆ·ç«¯çš„æ—¶å€™ï¼Œä¸€å®šè¦æ³¨æ„å¤„ç†å®¢æˆ·ç«¯è¾“å…¥çš„å€¼ä¸ºç©ºçš„æƒ…å†µ</p>
<h2 id="ç»™å®¢æˆ·ç«¯å›å¤æ¶ˆæ¯"><a href="#ç»™å®¢æˆ·ç«¯å›å¤æ¶ˆæ¯" class="headerlink" title="ç»™å®¢æˆ·ç«¯å›å¤æ¶ˆæ¯"></a>ç»™å®¢æˆ·ç«¯å›å¤æ¶ˆæ¯</h2><ul>
<li><font color="red">server.py</font> </li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> select</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºsocketå¯¹è±¡,ç»‘å®šIPç«¯å£,ç›‘å¬</span></span><br><span class="line">sk = socket.socket()</span><br><span class="line">sk.bind((<span class="string">'127.0.0.1'</span>, <span class="number">1559</span>))</span><br><span class="line">sk.listen(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">inputs = [sk]</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    rList, w, e = select.select(inputs, [], [], <span class="number">1</span>)</span><br><span class="line">    print(<span class="string">"selectå½“å‰ç›‘å¬socketå¯¹è±¡çš„æ•°é‡&gt;"</span>, len(inputs), <span class="string">" | å‘ç”Ÿå˜åŒ–çš„socketæ•°é‡&gt;"</span>, len(rList))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> s <span class="keyword">in</span> rList:</span><br><span class="line">        <span class="comment"># åˆ¤æ–­socketå¯¹è±¡å¦‚æœæ˜¯æœåŠ¡ç«¯çš„socketå¯¹è±¡çš„è¯</span></span><br><span class="line">        <span class="keyword">if</span> s == sk:</span><br><span class="line">            conn, address = s.accept()</span><br><span class="line">            <span class="comment"># connä¹Ÿæ˜¯ä¸€ä¸ªsocketå¯¹è±¡</span></span><br><span class="line">            <span class="comment"># å½“æœåŠ¡ç«¯socketæ¥æ”¶åˆ°å®¢æˆ·çš„è¯·æ±‚å,ä¼šåˆ†é…ä¸€ä¸ªæ–°çš„socketå¯¹è±¡ä¸“é—¨ç”¨æ¥å’Œè¿™ä¸ªå®¢æˆ·ç«¯è¿›è¡Œè¿æ¥é€šä¿¡</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># å½“æœåŠ¡ç«¯åˆ†é…æ–°çš„socketå¯¹è±¡ç»™æ–°è¿æ¥è¿›æ¥çš„å®¢æˆ·ç«¯çš„æ—¶å€™</span></span><br><span class="line">            <span class="comment"># æˆ‘ä»¬ä¹Ÿéœ€è¦ç›‘å¬è¿™ä¸ªå®¢æˆ·ç«¯çš„socketå¯¹è±¡æ˜¯å¦ä¼šå‘ç”Ÿå˜åŒ–</span></span><br><span class="line">            <span class="comment"># ä¸€æ—¦å‘ç”Ÿå˜åŒ–,æ„å‘³ç€å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ç«¯å‘æ¥äº†æ¶ˆæ¯</span></span><br><span class="line">            inputs.append(conn)</span><br><span class="line">            conn.sendall(bytes(<span class="string">'hello'</span>, encoding=<span class="string">'utf8'</span>))</span><br><span class="line">        <span class="comment"># å…¶ä»–çš„å°±éƒ½æ˜¯å®¢æˆ·ç«¯çš„socketå¯¹è±¡äº†</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="comment"># æ„å‘³ç€å®¢æˆ·ç«¯ç»™æœåŠ¡ç«¯å‘é€æ¶ˆæ¯äº†</span></span><br><span class="line">                msg = s.recv(<span class="number">1024</span>)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># Linuxå¹³å°ä¸‹çš„å¤„ç†</span></span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> msg:</span><br><span class="line">                    <span class="keyword">raise</span> Exception(<span class="string">'å®¢æˆ·ç«¯å·²æ–­å¼€è¿æ¥'</span>)</span><br><span class="line">                print(msg)</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># å‘å®¢æˆ·ç«¯å›å¤æ¶ˆæ¯</span></span><br><span class="line">                <span class="comment"># è¿™ç§å†™æ³•æ˜¯å®Œå…¨å¯ä»¥çš„,ä½†æ˜¯ç¼ºç‚¹æ˜¯è¯»å†™éƒ½æ··åœ¨äº†ä¸€èµ·</span></span><br><span class="line">                s.sendall(msg)</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> ex:</span><br><span class="line">                <span class="comment"># Windowså¹³å°ä¸‹çš„å¤„ç†</span></span><br><span class="line">                inputs.remove(s)</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¼šåšè¯»å†™åˆ†ç¦»ï¼Œå¯ä»¥é€šè¿‡selectï¼Œå®ç°è¯»å†™åˆ†ç¦»ï¼ˆæ”¶å‘åˆ†ç¦»ï¼‰</p>
<h1 id="select-selext-ä¸­çš„ç¬¬äºŒä¸ªå‚æ•°"><a href="#select-selext-ä¸­çš„ç¬¬äºŒä¸ªå‚æ•°" class="headerlink" title="select.selext()ä¸­çš„ç¬¬äºŒä¸ªå‚æ•°"></a>select.selext()ä¸­çš„ç¬¬äºŒä¸ªå‚æ•°</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">rList, wList, e = select.select([], [], [], <span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<p>select.select()çš„ç¬¬äºŒä¸ªå‚æ•°æœ‰ä»€ä¹ˆå€¼ï¼ŒwListä¸­å°±ä¼šæœ‰ä»€ä¹ˆå€¼</p>
<p>åˆ©ç”¨selectçš„è¿™ä¸ªç‰¹æ€§ï¼Œå¯ä»¥æŠŠéœ€è¦å›å¤æ¶ˆæ¯çš„å®¢æˆ·ç«¯socketå¯¹è±¡èµ‹å€¼ç»™selectçš„ç¬¬äºŒä¸ªå‚æ•°</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> select</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºsocketå¯¹è±¡,ç»‘å®šIPç«¯å£,ç›‘å¬</span></span><br><span class="line">sk = socket.socket()</span><br><span class="line">sk.bind((<span class="string">'127.0.0.1'</span>, <span class="number">1559</span>))</span><br><span class="line">sk.listen(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">inputs = [sk]</span><br><span class="line">outputs = []</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    rList, wList, e = select.select(inputs, outputs, [], <span class="number">1</span>)</span><br><span class="line">    print(<span class="string">"---"</span> * <span class="number">20</span>)</span><br><span class="line">    print(<span class="string">"selectå½“å‰ç›‘å¬inputså¯¹è±¡çš„æ•°é‡&gt;"</span>, len(inputs), <span class="string">" | å‘ç”Ÿå˜åŒ–çš„socketæ•°é‡&gt;"</span>, len(rList))</span><br><span class="line">    print(<span class="string">"selectå½“å‰ç›‘å¬outputså¯¹è±¡çš„æ•°é‡&gt;"</span>, len(outputs), <span class="string">" | éœ€è¦å›å¤å®¢æˆ·ç«¯æ¶ˆæ¯çš„æ•°é‡&gt;"</span>, len(wList))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># éå†rList(å»ºç«‹è¿æ¥å’Œæ¥æ”¶æ•°æ®)</span></span><br><span class="line">    <span class="keyword">for</span> s <span class="keyword">in</span> rList:</span><br><span class="line">        <span class="comment"># åˆ¤æ–­socketå¯¹è±¡å¦‚æœæ˜¯æœåŠ¡ç«¯çš„socketå¯¹è±¡çš„è¯</span></span><br><span class="line">        <span class="keyword">if</span> s == sk:</span><br><span class="line">            conn, address = s.accept()</span><br><span class="line">            <span class="comment"># connä¹Ÿæ˜¯ä¸€ä¸ªsocketå¯¹è±¡</span></span><br><span class="line">            <span class="comment"># å½“æœåŠ¡ç«¯socketæ¥æ”¶åˆ°å®¢æˆ·çš„è¯·æ±‚å,ä¼šåˆ†é…ä¸€ä¸ªæ–°çš„socketå¯¹è±¡ä¸“é—¨ç”¨æ¥å’Œè¿™ä¸ªå®¢æˆ·ç«¯è¿›è¡Œè¿æ¥é€šä¿¡</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># å½“æœåŠ¡ç«¯åˆ†é…æ–°çš„socketå¯¹è±¡ç»™æ–°è¿æ¥è¿›æ¥çš„å®¢æˆ·ç«¯çš„æ—¶å€™</span></span><br><span class="line">            <span class="comment"># æˆ‘ä»¬ä¹Ÿéœ€è¦ç›‘å¬è¿™ä¸ªå®¢æˆ·ç«¯çš„socketå¯¹è±¡æ˜¯å¦ä¼šå‘ç”Ÿå˜åŒ–</span></span><br><span class="line">            <span class="comment"># ä¸€æ—¦å‘ç”Ÿå˜åŒ–,æ„å‘³ç€å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ç«¯å‘æ¥äº†æ¶ˆæ¯</span></span><br><span class="line">            inputs.append(conn)</span><br><span class="line">            conn.sendall(bytes(<span class="string">'hello'</span>, encoding=<span class="string">'utf8'</span>))</span><br><span class="line">        <span class="comment"># å…¶ä»–çš„å°±éƒ½æ˜¯å®¢æˆ·ç«¯çš„socketå¯¹è±¡äº†</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="comment"># æ„å‘³ç€å®¢æˆ·ç«¯ç»™æœåŠ¡ç«¯å‘é€æ¶ˆæ¯äº†</span></span><br><span class="line">                msg = s.recv(<span class="number">1024</span>)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># Linuxå¹³å°ä¸‹çš„å¤„ç†</span></span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> msg:</span><br><span class="line">                    <span class="keyword">raise</span> Exception(<span class="string">'å®¢æˆ·ç«¯å·²æ–­å¼€è¿æ¥'</span>)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    outputs.append(s)</span><br><span class="line">                    print(msg)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># å‘å®¢æˆ·ç«¯å›å¤æ¶ˆæ¯</span></span><br><span class="line">                <span class="comment"># è¿™ç§å†™æ³•æ˜¯å®Œå…¨å¯ä»¥çš„,ä½†æ˜¯ç¼ºç‚¹æ˜¯è¯»å†™éƒ½æ··åœ¨äº†ä¸€èµ·</span></span><br><span class="line">                <span class="comment"># s.sendall(msg)</span></span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> ex:</span><br><span class="line">                <span class="comment"># Windowså¹³å°ä¸‹çš„å¤„ç†</span></span><br><span class="line">                inputs.remove(s)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># éå†wList(éå†ç»™æœåŠ¡ç«¯å‘é€è¿‡æ¶ˆæ¯çš„å®¢æˆ·ç«¯)</span></span><br><span class="line">    <span class="keyword">for</span> s <span class="keyword">in</span> wList:</span><br><span class="line"></span><br><span class="line">        <span class="comment"># ç»™æ‰€æœ‰çš„å®¢æˆ·ç«¯ç»Ÿä¸€å›å¤å†…å®¹</span></span><br><span class="line">        s.sendall(bytes(<span class="string">'server response'</span>, encoding=<span class="string">'utf8'</span>))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å›å¤å®Œæˆå,ä¸€å®šè¦å°†outputsä¸­è¯¥socketå¯¹è±¡ç§»é™¤</span></span><br><span class="line">        outputs.remove(s)</span><br></pre></td></tr></table></figure>

<p>wList = æ‰€æœ‰ç»™æœåŠ¡ç«¯å‘é€æ¶ˆæ¯çš„å®¢æˆ·ç«¯ï¼Œä¹Ÿæ˜¯éœ€è¦å›å¤æ¶ˆæ¯å®¢æˆ·ç«¯åˆ—è¡¨</p>
<ul>
<li><font color="blue">client.py</font> </li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">sk = socket.socket()</span><br><span class="line">sk.connect((<span class="string">'127.0.0.1'</span>, <span class="number">1559</span>))</span><br><span class="line"><span class="comment"># æ¥æ”¶æ¬¢è¿æ¶ˆæ¯</span></span><br><span class="line">data = sk.recv(<span class="number">1024</span>)</span><br><span class="line">print(data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    i = input(<span class="string">"&gt; "</span>)</span><br><span class="line">    <span class="comment"># å‘æœåŠ¡ç«¯å‘é€æ¶ˆæ¯</span></span><br><span class="line">    sk.sendall(bytes(i, encoding=<span class="string">'utf8'</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ¥æ”¶æœåŠ¡ç«¯å‘æ¥çš„æ¶ˆæ¯</span></span><br><span class="line">    msg = sk.recv(<span class="number">1024</span>)</span><br><span class="line">    print(str(msg, encoding=<span class="string">'utf-8'</span>))</span><br><span class="line"></span><br><span class="line">sk.close()</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œè¿‡ç¨‹ï¼š</p>
<ul>
<li>ä¾æ¬¡è¿æ¥ä¸‰ä¸ªå®¢æˆ·ç«¯</li>
<li>ç¬¬ä¸€ä¸ªå®¢æˆ·ç«¯ä¾æ¬¡å‘æœåŠ¡å‘é€äº†ä¸¤æ¬¡æ¶ˆæ¯</li>
</ul>
<p>æœåŠ¡ç«¯çš„å›æ˜¾ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">------------------------------------------------------------</span><br><span class="line">selectå½“å‰ç›‘å¬inputså¯¹è±¡çš„æ•°é‡&gt; 1  | å‘ç”Ÿå˜åŒ–çš„socketæ•°é‡&gt; 0</span><br><span class="line">selectå½“å‰ç›‘å¬outputså¯¹è±¡çš„æ•°é‡&gt; 0  | éœ€è¦å›å¤å®¢æˆ·ç«¯æ¶ˆæ¯çš„æ•°é‡&gt; 0</span><br><span class="line">------------------------------------------------------------</span><br><span class="line">selectå½“å‰ç›‘å¬inputså¯¹è±¡çš„æ•°é‡&gt; 1  | å‘ç”Ÿå˜åŒ–çš„socketæ•°é‡&gt; 0</span><br><span class="line">selectå½“å‰ç›‘å¬outputså¯¹è±¡çš„æ•°é‡&gt; 0  | éœ€è¦å›å¤å®¢æˆ·ç«¯æ¶ˆæ¯çš„æ•°é‡&gt; 0</span><br><span class="line">------------------------------------------------------------</span><br><span class="line">selectå½“å‰ç›‘å¬inputså¯¹è±¡çš„æ•°é‡&gt; 2  | å‘ç”Ÿå˜åŒ–çš„socketæ•°é‡&gt; 0</span><br><span class="line">selectå½“å‰ç›‘å¬outputså¯¹è±¡çš„æ•°é‡&gt; 0  | éœ€è¦å›å¤å®¢æˆ·ç«¯æ¶ˆæ¯çš„æ•°é‡&gt; 0</span><br><span class="line">------------------------------------------------------------</span><br><span class="line">selectå½“å‰ç›‘å¬inputså¯¹è±¡çš„æ•°é‡&gt; 2  | å‘ç”Ÿå˜åŒ–çš„socketæ•°é‡&gt; 1</span><br><span class="line">selectå½“å‰ç›‘å¬outputså¯¹è±¡çš„æ•°é‡&gt; 0  | éœ€è¦å›å¤å®¢æˆ·ç«¯æ¶ˆæ¯çš„æ•°é‡&gt; 0</span><br><span class="line">------------------------------------------------------------</span><br><span class="line">selectå½“å‰ç›‘å¬inputså¯¹è±¡çš„æ•°é‡&gt; 3  | å‘ç”Ÿå˜åŒ–çš„socketæ•°é‡&gt; 0</span><br><span class="line">selectå½“å‰ç›‘å¬outputså¯¹è±¡çš„æ•°é‡&gt; 0  | éœ€è¦å›å¤å®¢æˆ·ç«¯æ¶ˆæ¯çš„æ•°é‡&gt; 0</span><br><span class="line">------------------------------------------------------------</span><br><span class="line">selectå½“å‰ç›‘å¬inputså¯¹è±¡çš„æ•°é‡&gt; 3  | å‘ç”Ÿå˜åŒ–çš„socketæ•°é‡&gt; 1</span><br><span class="line">selectå½“å‰ç›‘å¬outputså¯¹è±¡çš„æ•°é‡&gt; 0  | éœ€è¦å›å¤å®¢æˆ·ç«¯æ¶ˆæ¯çš„æ•°é‡&gt; 0</span><br><span class="line">------------------------------------------------------------</span><br><span class="line">selectå½“å‰ç›‘å¬inputså¯¹è±¡çš„æ•°é‡&gt; 4  | å‘ç”Ÿå˜åŒ–çš„socketæ•°é‡&gt; 0</span><br><span class="line">selectå½“å‰ç›‘å¬outputså¯¹è±¡çš„æ•°é‡&gt; 0  | éœ€è¦å›å¤å®¢æˆ·ç«¯æ¶ˆæ¯çš„æ•°é‡&gt; 0</span><br><span class="line">------------------------------------------------------------</span><br><span class="line">selectå½“å‰ç›‘å¬inputså¯¹è±¡çš„æ•°é‡&gt; 4  | å‘ç”Ÿå˜åŒ–çš„socketæ•°é‡&gt; 1</span><br><span class="line">selectå½“å‰ç›‘å¬outputså¯¹è±¡çš„æ•°é‡&gt; 0  | éœ€è¦å›å¤å®¢æˆ·ç«¯æ¶ˆæ¯çš„æ•°é‡&gt; 0</span><br><span class="line">b&#39;ps&#39;</span><br><span class="line">------------------------------------------------------------</span><br><span class="line">selectå½“å‰ç›‘å¬inputså¯¹è±¡çš„æ•°é‡&gt; 4  | å‘ç”Ÿå˜åŒ–çš„socketæ•°é‡&gt; 0</span><br><span class="line">selectå½“å‰ç›‘å¬outputså¯¹è±¡çš„æ•°é‡&gt; 1  | éœ€è¦å›å¤å®¢æˆ·ç«¯æ¶ˆæ¯çš„æ•°é‡&gt; 1</span><br><span class="line">------------------------------------------------------------</span><br><span class="line">selectå½“å‰ç›‘å¬inputså¯¹è±¡çš„æ•°é‡&gt; 4  | å‘ç”Ÿå˜åŒ–çš„socketæ•°é‡&gt; 0</span><br><span class="line">selectå½“å‰ç›‘å¬outputså¯¹è±¡çš„æ•°é‡&gt; 0  | éœ€è¦å›å¤å®¢æˆ·ç«¯æ¶ˆæ¯çš„æ•°é‡&gt; 0</span><br><span class="line">------------------------------------------------------------</span><br><span class="line">selectå½“å‰ç›‘å¬inputså¯¹è±¡çš„æ•°é‡&gt; 4  | å‘ç”Ÿå˜åŒ–çš„socketæ•°é‡&gt; 1</span><br><span class="line">selectå½“å‰ç›‘å¬outputså¯¹è±¡çš„æ•°é‡&gt; 0  | éœ€è¦å›å¤å®¢æˆ·ç«¯æ¶ˆæ¯çš„æ•°é‡&gt; 0</span><br><span class="line">b&#39;ps&#39;</span><br><span class="line">------------------------------------------------------------</span><br><span class="line">selectå½“å‰ç›‘å¬inputså¯¹è±¡çš„æ•°é‡&gt; 4  | å‘ç”Ÿå˜åŒ–çš„socketæ•°é‡&gt; 0</span><br><span class="line">selectå½“å‰ç›‘å¬outputså¯¹è±¡çš„æ•°é‡&gt; 1  | éœ€è¦å›å¤å®¢æˆ·ç«¯æ¶ˆæ¯çš„æ•°é‡&gt; 1</span><br><span class="line">------------------------------------------------------------</span><br><span class="line">selectå½“å‰ç›‘å¬inputså¯¹è±¡çš„æ•°é‡&gt; 4  | å‘ç”Ÿå˜åŒ–çš„socketæ•°é‡&gt; 0</span><br><span class="line">selectå½“å‰ç›‘å¬outputså¯¹è±¡çš„æ•°é‡&gt; 0  | éœ€è¦å›å¤å®¢æˆ·ç«¯æ¶ˆæ¯çš„æ•°é‡&gt; 0</span><br><span class="line">------------------------------------------------------------</span><br><span class="line">selectå½“å‰ç›‘å¬inputså¯¹è±¡çš„æ•°é‡&gt; 3  | å‘ç”Ÿå˜åŒ–çš„socketæ•°é‡&gt; 0</span><br><span class="line">selectå½“å‰ç›‘å¬outputså¯¹è±¡çš„æ•°é‡&gt; 0  | éœ€è¦å›å¤å®¢æˆ·ç«¯æ¶ˆæ¯çš„æ•°é‡&gt; 0</span><br><span class="line">------------------------------------------------------------</span><br><span class="line">selectå½“å‰ç›‘å¬inputså¯¹è±¡çš„æ•°é‡&gt; 3  | å‘ç”Ÿå˜åŒ–çš„socketæ•°é‡&gt; 0</span><br><span class="line">selectå½“å‰ç›‘å¬outputså¯¹è±¡çš„æ•°é‡&gt; 0  | éœ€è¦å›å¤å®¢æˆ·ç«¯æ¶ˆæ¯çš„æ•°é‡&gt; 0</span><br><span class="line">------------------------------------------------------------</span><br><span class="line">selectå½“å‰ç›‘å¬inputså¯¹è±¡çš„æ•°é‡&gt; 2  | å‘ç”Ÿå˜åŒ–çš„socketæ•°é‡&gt; 0</span><br><span class="line">selectå½“å‰ç›‘å¬outputså¯¹è±¡çš„æ•°é‡&gt; 0  | éœ€è¦å›å¤å®¢æˆ·ç«¯æ¶ˆæ¯çš„æ•°é‡&gt; 0</span><br><span class="line">------------------------------------------------------------</span><br><span class="line">selectå½“å‰ç›‘å¬inputså¯¹è±¡çš„æ•°é‡&gt; 2  | å‘ç”Ÿå˜åŒ–çš„socketæ•°é‡&gt; 1</span><br><span class="line">selectå½“å‰ç›‘å¬outputså¯¹è±¡çš„æ•°é‡&gt; 0  | éœ€è¦å›å¤å®¢æˆ·ç«¯æ¶ˆæ¯çš„æ•°é‡&gt; 0</span><br><span class="line">------------------------------------------------------------</span><br><span class="line">selectå½“å‰ç›‘å¬inputså¯¹è±¡çš„æ•°é‡&gt; 1  | å‘ç”Ÿå˜åŒ–çš„socketæ•°é‡&gt; 0</span><br><span class="line">selectå½“å‰ç›‘å¬outputså¯¹è±¡çš„æ•°é‡&gt; 0  | éœ€è¦å›å¤å®¢æˆ·ç«¯æ¶ˆæ¯çš„æ•°é‡&gt; 0</span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸€ä¸ªå®¢æˆ·ç«¯çš„å›æ˜¾ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">b&#39;hello&#39;</span><br><span class="line">&gt; ps</span><br><span class="line">server response</span><br><span class="line">&gt; ps</span><br><span class="line">server response</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šä»£ç å®ç°äº†ç®€å•çš„æ”¶å‘æ¶ˆæ¯çš„åˆ†ç¦»ï¼Œç°åœ¨åˆå¤šäº†ä¸€ç‚¹éœ€æ±‚ï¼Œç›®å‰æ‰€æœ‰ç»™æœåŠ¡ç«¯å‘é€æ¶ˆæ¯çš„å®¢æˆ·ç«¯ï¼ŒæœåŠ¡ç«¯éƒ½ç»Ÿä¸€å›å¤äº†ç›¸åŒçš„å†…å®¹ï¼Œç°åœ¨è¦æœåŠ¡ç«¯å®ç°Echo Serverçš„åŠŸèƒ½ï¼Œå³å®¢æˆ·ç«¯å‘é€ä»€ä¹ˆæ¶ˆæ¯ï¼ŒæœåŠ¡ç«¯å°±ç»™å®¢æˆ·ç«¯å›å¤ä»€ä¹ˆæ¶ˆæ¯</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> select</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºsocketå¯¹è±¡,ç»‘å®šIPç«¯å£,ç›‘å¬</span></span><br><span class="line">sk = socket.socket()</span><br><span class="line">sk.bind((<span class="string">'127.0.0.1'</span>, <span class="number">1559</span>))</span><br><span class="line">sk.listen(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">inputs = [sk]</span><br><span class="line">outputs = []</span><br><span class="line">messages = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">messages = &#123;</span></span><br><span class="line"><span class="string">    socket_obj1: [msg]</span></span><br><span class="line"><span class="string">    socket_obj2: [msg]</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    rList, wList, e = select.select(inputs, outputs, [], <span class="number">1</span>)</span><br><span class="line">    print(<span class="string">"---"</span> * <span class="number">20</span>)</span><br><span class="line">    print(<span class="string">"selectå½“å‰ç›‘å¬inputså¯¹è±¡çš„æ•°é‡&gt;"</span>, len(inputs), <span class="string">" | å‘ç”Ÿå˜åŒ–çš„socketæ•°é‡&gt;"</span>, len(rList))</span><br><span class="line">    print(<span class="string">"selectå½“å‰ç›‘å¬outputså¯¹è±¡çš„æ•°é‡&gt;"</span>, len(outputs), <span class="string">" | éœ€è¦å›å¤å®¢æˆ·ç«¯æ¶ˆæ¯çš„æ•°é‡&gt;"</span>, len(wList))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># éå†rList(å»ºç«‹è¿æ¥å’Œæ¥æ”¶æ•°æ®)</span></span><br><span class="line">    <span class="keyword">for</span> s <span class="keyword">in</span> rList:</span><br><span class="line">        <span class="comment"># åˆ¤æ–­socketå¯¹è±¡å¦‚æœæ˜¯æœåŠ¡ç«¯çš„socketå¯¹è±¡çš„è¯</span></span><br><span class="line">        <span class="keyword">if</span> s == sk:</span><br><span class="line">            conn, address = s.accept()</span><br><span class="line">            <span class="comment"># connä¹Ÿæ˜¯ä¸€ä¸ªsocketå¯¹è±¡</span></span><br><span class="line">            <span class="comment"># å½“æœåŠ¡ç«¯socketæ¥æ”¶åˆ°å®¢æˆ·çš„è¯·æ±‚å,ä¼šåˆ†é…ä¸€ä¸ªæ–°çš„socketå¯¹è±¡ä¸“é—¨ç”¨æ¥å’Œè¿™ä¸ªå®¢æˆ·ç«¯è¿›è¡Œè¿æ¥é€šä¿¡</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># å½“æœåŠ¡ç«¯åˆ†é…æ–°çš„socketå¯¹è±¡ç»™æ–°è¿æ¥è¿›æ¥çš„å®¢æˆ·ç«¯çš„æ—¶å€™</span></span><br><span class="line">            <span class="comment"># æˆ‘ä»¬ä¹Ÿéœ€è¦ç›‘å¬è¿™ä¸ªå®¢æˆ·ç«¯çš„socketå¯¹è±¡æ˜¯å¦ä¼šå‘ç”Ÿå˜åŒ–</span></span><br><span class="line">            <span class="comment"># ä¸€æ—¦å‘ç”Ÿå˜åŒ–,æ„å‘³ç€å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ç«¯å‘æ¥äº†æ¶ˆæ¯</span></span><br><span class="line">            inputs.append(conn)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># åœ¨messagesä¸­ä¸ºè¯¥å¯¹è±¡åˆ›å»ºkey</span></span><br><span class="line">            messages[conn] = []</span><br><span class="line"></span><br><span class="line">            conn.sendall(bytes(<span class="string">'hello'</span>, encoding=<span class="string">'utf8'</span>))</span><br><span class="line">        <span class="comment"># å…¶ä»–çš„å°±éƒ½æ˜¯å®¢æˆ·ç«¯çš„socketå¯¹è±¡äº†</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="comment"># æ„å‘³ç€å®¢æˆ·ç«¯ç»™æœåŠ¡ç«¯å‘é€æ¶ˆæ¯äº†</span></span><br><span class="line">                msg = s.recv(<span class="number">1024</span>)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># Linuxå¹³å°ä¸‹çš„å¤„ç†</span></span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> msg:</span><br><span class="line">                    <span class="keyword">raise</span> Exception(<span class="string">'å®¢æˆ·ç«¯å·²æ–­å¼€è¿æ¥'</span>)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    outputs.append(s)</span><br><span class="line">                    messages[s].append(msg)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># å‘å®¢æˆ·ç«¯å›å¤æ¶ˆæ¯</span></span><br><span class="line">                <span class="comment"># è¿™ç§å†™æ³•æ˜¯å®Œå…¨å¯ä»¥çš„,ä½†æ˜¯ç¼ºç‚¹æ˜¯è¯»å†™éƒ½æ··åœ¨äº†ä¸€èµ·</span></span><br><span class="line">                <span class="comment"># s.sendall(msg)</span></span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> ex:</span><br><span class="line">                <span class="comment"># Windowså¹³å°ä¸‹çš„å¤„ç†</span></span><br><span class="line">                inputs.remove(s)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># åœ¨å®¢æˆ·ç«¯æ–­å¼€è¿æ¥å,ç›¸å¯¹åº”çš„è¯¥å®¢æˆ·ç«¯çš„messagesä¸­çš„ä¿¡æ¯ä¹Ÿéœ€è¦åˆ é™¤</span></span><br><span class="line">                <span class="keyword">del</span> messages[s]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># éå†wList(éå†ç»™æœåŠ¡ç«¯å‘é€è¿‡æ¶ˆæ¯çš„å®¢æˆ·ç«¯)</span></span><br><span class="line">    <span class="keyword">for</span> s <span class="keyword">in</span> wList:</span><br><span class="line"></span><br><span class="line">        <span class="comment"># åœ¨è¯¥å®¢æˆ·ç«¯è¿æ¥å¯¹è±¡çš„messagesä¿¡æ¯ä¸­å–å‡ºä¸€ä¸ªè¿›è¡Œå›å¤</span></span><br><span class="line">        msg = messages[s].pop()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># æ ¹æ®å®¢æˆ·ç«¯å‘æ¥çš„æ¶ˆæ¯è¿›è¡Œå›å¤</span></span><br><span class="line">        s.sendall(msg)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å›å¤å®Œæˆå,ä¸€å®šè¦å°†outputsä¸­è¯¥socketå¯¹è±¡ç§»é™¤</span></span><br><span class="line">        outputs.remove(s)</span><br></pre></td></tr></table></figure>

<p>æœåŠ¡ç«¯åšå‡ºä»¥ä¸Šä¿®æ”¹ï¼Œå®¢æˆ·ç«¯ä¸éœ€è¦æ”¹å˜</p>
<ul>
<li>11è¡Œ ä¸ºäº†è®©ä¸€ä¸ªå®¢æˆ·ç«¯socketå¯¹è±¡æ”¶æ¶ˆæ¯å’Œå‘æ¶ˆæ¯äº§ç”Ÿå…³è”ï¼Œå¼•å…¥äº†ä¸€ä¸ªæ–°çš„å…¨å±€å˜é‡messages</li>
<li>40è¡Œ åœ¨æ–°å®¢æˆ·ç«¯è¿æ¥è¿›æ¥çš„æ—¶å€™ï¼Œå°±é¢„å…ˆä¸ºè¯¥socketå¯¹è±¡åœ¨messagesä¸­åˆ›å»ºå¯¹åº”çš„key</li>
<li>54è¡Œ åœ¨è¯¥å¯¹è±¡ä¸­æ·»åŠ æ¶ˆæ¯</li>
<li>64è¡Œ åœ¨å®¢æˆ·ç«¯å…³é—­è¿æ¥æ”¶ï¼Œæ¸…ç†è¯¥å¯¹è±¡çš„æ¶ˆæ¯åˆ—è¡¨</li>
<li>70è¡Œ å°†è¯¥å¯¹è±¡åœ¨ç¬¬40è¡Œæ’å…¥çš„æ¶ˆæ¯ä¸­å–å‡ºæ¥</li>
</ul>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>ä½¿ç”¨IOå¤šè·¯å¤ç”¨ï¼Œå®é™…ä¸Šå®ç°äº†ç±»ä¼¼å¹¶å‘æ•ˆæœçš„ä¼ªå¹¶å‘ã€‚å†…éƒ¨å®é™…ä½¿ç”¨äº†å¾ªç¯æ¥é«˜æ•ˆçš„å¤„ç†é˜»å¡è¯·æ±‚</p>
<p>Pythonä¸­æœ‰ä¸€ä¸ªselectæ¨¡å—ï¼Œå…¶ä¸­æä¾›äº†ï¼šselectã€pollã€epollä¸‰ä¸ªæ–¹æ³•ï¼Œåˆ†åˆ«è°ƒç”¨ç³»ç»Ÿçš„ selectï¼Œpollï¼Œepoll ä»è€Œå®ç°IOå¤šè·¯å¤ç”¨ã€‚</p>
<ul>
<li>Windows Pythonï¼šæä¾›ï¼š select</li>
<li>Mac Pythonï¼šæä¾›ï¼š select</li>
<li>Linux Pythonï¼šæä¾›ï¼š selectã€pollã€epoll</li>
</ul>
<p>æ³¨æ„ï¼šç½‘ç»œæ“ä½œã€æ–‡ä»¶æ“ä½œã€ç»ˆç«¯æ“ä½œç­‰å‡å±äºIOæ“ä½œï¼Œå¯¹äºwindowsåªæ”¯æŒSocketæ“ä½œï¼Œå…¶ä»–ç³»ç»Ÿæ”¯æŒæ‰€æœ‰IOæ“ä½œï¼Œä½†æ˜¯æ— æ³•æ£€æµ‹æ™®é€šæ–‡ä»¶æ“ä½œè‡ªåŠ¨ä¸Šæ¬¡è¯»å–æ˜¯å¦å·²ç»å˜åŒ–</p>
<p>å¯¹äºselectæ–¹æ³•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">å¥æŸ„åˆ—è¡¨11, å¥æŸ„åˆ—è¡¨22, å¥æŸ„åˆ—è¡¨33 &#x3D; select.select(å¥æŸ„åºåˆ—1, å¥æŸ„åºåˆ—2, å¥æŸ„åºåˆ—3, è¶…æ—¶æ—¶é—´)</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">å‚æ•°ï¼š å¯æ¥å—å››ä¸ªå‚æ•°ï¼ˆå‰ä¸‰ä¸ªå¿…é¡»ï¼‰</span><br><span class="line">è¿”å›å€¼ï¼šä¸‰ä¸ªåˆ—è¡¨</span><br><span class="line"> </span><br><span class="line">selectæ–¹æ³•ç”¨æ¥ç›‘è§†æ–‡ä»¶å¥æŸ„ï¼Œå¦‚æœå¥æŸ„å‘ç”Ÿå˜åŒ–ï¼Œåˆ™è·å–è¯¥å¥æŸ„ã€‚</span><br><span class="line">1ã€å½“ å‚æ•°1 åºåˆ—ä¸­çš„å¥æŸ„å‘ç”Ÿå¯è¯»æ—¶ï¼ˆaccetpå’Œreadï¼‰ï¼Œåˆ™è·å–å‘ç”Ÿå˜åŒ–çš„å¥æŸ„å¹¶æ·»åŠ åˆ° è¿”å›å€¼1 åºåˆ—ä¸­</span><br><span class="line">2ã€å½“ å‚æ•°2 åºåˆ—ä¸­å«æœ‰å¥æŸ„æ—¶ï¼Œåˆ™å°†è¯¥åºåˆ—ä¸­æ‰€æœ‰çš„å¥æŸ„æ·»åŠ åˆ° è¿”å›å€¼2 åºåˆ—ä¸­</span><br><span class="line">3ã€å½“ å‚æ•°3 åºåˆ—ä¸­çš„å¥æŸ„å‘ç”Ÿé”™è¯¯æ—¶ï¼Œåˆ™å°†è¯¥å‘ç”Ÿé”™è¯¯çš„å¥æŸ„æ·»åŠ åˆ° è¿”å›å€¼3 åºåˆ—ä¸­</span><br><span class="line">4ã€å½“ è¶…æ—¶æ—¶é—´ æœªè®¾ç½®ï¼Œåˆ™selectä¼šä¸€ç›´é˜»å¡ï¼Œç›´åˆ°ç›‘å¬çš„å¥æŸ„å‘ç”Ÿå˜åŒ–</span><br><span class="line">   å½“ è¶…æ—¶æ—¶é—´ ï¼ 1æ—¶ï¼Œé‚£ä¹ˆå¦‚æœç›‘å¬çš„å¥æŸ„å‡æ— ä»»ä½•å˜åŒ–ï¼Œåˆ™selectä¼šé˜»å¡ 1 ç§’ï¼Œä¹‹åè¿”å›ä¸‰ä¸ªç©ºåˆ—è¡¨ï¼Œå¦‚æœç›‘å¬çš„å¥æŸ„æœ‰å˜åŒ–ï¼Œåˆ™ç›´æ¥æ‰§è¡Œã€‚</span><br></pre></td></tr></table></figure>

<h1 id="é™„åŠ ï¼šselect-poll-epollçš„åŒºåˆ«"><a href="#é™„åŠ ï¼šselect-poll-epollçš„åŒºåˆ«" class="headerlink" title="é™„åŠ ï¼šselect poll epollçš„åŒºåˆ«"></a>é™„åŠ ï¼šselect poll epollçš„åŒºåˆ«</h1><p>IOå¤šè·¯å¤ç”¨æ˜¯ç³»ç»Ÿå†…æ ¸å®ç°çš„ï¼Œç³»ç»Ÿå†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªforå¾ªç¯ï¼Œä¸€ä¸ªä¸€ä¸ªåœ°å»æ£€æµ‹å¯¹è±¡æ˜¯å¦æœ‰å˜åŒ–</p>
<p>é¦–å…ˆéœ€è¦æ˜ç¡®ä¸€ç‚¹çš„æ˜¯ï¼Œforå¾ªç¯çš„æ•ˆç‡æ˜¯ä¸é«˜çš„</p>
<table>
<thead>
<tr>
<th>IOå¤šè·¯å¤ç”¨ç§ç±»</th>
<th>å®ç°åŸç†</th>
<th>ç›‘å¬å¯¹è±¡ä¸ªæ•°</th>
</tr>
</thead>
<tbody><tr>
<td>select</td>
<td>ç³»ç»Ÿå†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªforå¾ªç¯</td>
<td>1024</td>
</tr>
<tr>
<td>poll</td>
<td>ç³»ç»Ÿå†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªforå¾ªç¯</td>
<td>æ²¡æœ‰é™åˆ¶</td>
</tr>
<tr>
<td>epoll</td>
<td>å¥æŸ„åºåˆ—å‘ç”Ÿå˜åŒ–æ—¶è‡ªåŠ¨é€šçŸ¥epoll</td>
<td>æ²¡æœ‰é™åˆ¶</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>IOå¤šè·¯å¤ç”¨</tag>
        <tag>select</tag>
        <tag>poll</tag>
        <tag>epoll</tag>
      </tags>
  </entry>
  <entry>
    <title>Python2.7ä¸Python3.5ç»§æ‰¿çš„åŒºåˆ«</title>
    <url>/2016/07/12/Python2-7%E4%B8%8EPython3-5%E7%BB%A7%E6%89%BF%E7%9A%84%E5%8C%BA%E5%88%AB/</url>
    <content><![CDATA[<blockquote>
<p>Pythonä¸­2.7ä¸3.5çš„ç»§æ‰¿ç•¥æœ‰åŒºåˆ«ï¼Œ åœ¨Python2.7ä¸­çš„ç±»å¯ä»¥åˆ†ä¸ºç»å…¸ç±»ï¼ˆé»˜è®¤å°±æ˜¯ç»å…¸ç±»ï¼‰å’Œæ–°å¼ç±»ï¼ˆç»§æ‰¿äº†objectç±»çš„å°±æ˜¯æ–°å¼ç±»ï¼‰ï¼Œè€Œåœ¨Python3.5ä¸­ï¼Œæ‰€æœ‰çš„ç±»é»˜è®¤ç»§æ‰¿objectç±»</p>
</blockquote>
<p><img src="http://oss.20150509.cn/20160712033359.png" alt=""></p>
<ul>
<li><p>Python2.7çš„ç±»å¦‚æœç»§æ‰¿äº†objectç±»ï¼Œé‚£ä¹ˆå¤šç»§æ‰¿å‘ä¸Šå¯»æ‰¾çš„è·¯å¾„å’ŒPython3.5æ˜¯ä¸€æ ·çš„ï¼Œå›¾ä¸­æ©™è‰²çš„å¯»æ‰¾è·¯å¾„</p>
</li>
<li><p>ä½†æ˜¯å¦‚æœPython2.7æ²¡æœ‰ç»§æ‰¿objectç±»ï¼Œé‚£ä¹ˆå°±æ˜¯å›¾ä¸­è“è‰²çš„å¯»æ‰¾è·¯å¾„</p>
</li>
</ul>
<p>æ›´å¤šå…³äºç»§æ‰¿çš„å†…å®¹å¯ä»¥å‚è€ƒä»¥ä¸‹æ–‡ç« ï¼š</p>
<p><a href="http://docs.20150509.cn/2016/06/28/Pythoné¢å‘å¯¹è±¡åŸºç¡€ç¯‡ä¹‹ç»§æ‰¿/" target="_blank" rel="noopener">http://docs.20150509.cn/2016/06/28/Pythoné¢å‘å¯¹è±¡åŸºç¡€ç¯‡ä¹‹ç»§æ‰¿/</a></p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>ç»§æ‰¿</tag>
        <tag>OOP</tag>
        <tag>é¢å‘å¯¹è±¡</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonçš„å˜é‡ä½œç”¨åŸŸ</title>
    <url>/2016/07/12/Python%E7%9A%84%E5%8F%98%E9%87%8F%E4%BD%9C%E7%94%A8%E5%9F%9F/</url>
    <content><![CDATA[<blockquote>
<p>Pythonçš„å˜é‡ä½œç”¨åŸŸä¸­åˆ†ä¸ºå››ä¸ªçº§åˆ«ï¼Œç®€ç§°ä¸ºï¼šBGELï¼Œä½œç”¨åŸŸçš„çº§åˆ«ä¾æ¬¡å‡é«˜ï¼Œçº§åˆ«æœ€é«˜çš„æ˜¯Localï¼Œå¦‚æœè¯¥å˜é‡åœ¨Localä¸­å·²ç»å£°æ˜å¹¶èµ‹å€¼ï¼Œå°†ä¼˜å…ˆä½¿ç”¨Localä¸­çš„å˜é‡å¯¹åº”çš„å€¼</p>
</blockquote>
<p>Pythonå˜é‡ä½œç”¨åŸŸçš„å››ç§æƒ…å†µï¼š</p>
<ul>
<li>Bï¼šbuild-in ç³»ç»Ÿå›ºå®šæ¨¡å—é‡Œé¢çš„å˜é‡ï¼Œä¹Ÿå«ç³»ç»Ÿå˜é‡ï¼Œæ¯”å¦‚int</li>
<li>Gï¼šglobal å…¨å±€å˜é‡ï¼Œä¹Ÿå°±æ˜¯æ¨¡å—çº§åˆ«å®šä¹‰çš„å˜é‡</li>
<li>Eï¼šenclosing åµŒå¥—çš„çˆ¶çº§å‡½æ•°çš„å±€éƒ¨ä½œç”¨åŸŸï¼Œå°±æ˜¯åŒ…å«æ­¤å‡½æ•°çš„ä¸Šå±‚å‡½æ•°çš„å±€éƒ¨ä½œç”¨åŸŸ</li>
<li>Lï¼šlocal å±€éƒ¨ä½œç”¨åŸŸï¼Œå³ä¸ºå‡½æ•°ä¸­å®šä¹‰çš„å˜é‡</li>
</ul>
<p><em>Eå’ŒLæ˜¯ç›¸å¯¹çš„ï¼ŒEä¸­çš„å˜é‡ç›¸å¯¹ä¸Šå±‚æ¥è¯´ä¹Ÿæ˜¯L</em></p>
<p>Pythonçš„å˜é‡ä½œç”¨åŸŸå¯ä»¥ç”¨ä¸‹å›¾è¡¨ç¤ºï¼š</p>
<p><img src="http://oss.20150509.cn/20160712012859.png" alt=""></p>
<p>ä¸€ä¸ªå˜é‡ä½¿ç”¨å“ªä¸ªåŸŸä¸­å®šä¹‰çš„å€¼ï¼Œå–å†³äºå®ƒçš„ç›¸å¯¹ä½ç½®</p>
<p>ä»ä¸Šå›¾ä¸­çœ‹ï¼Œå¦‚æœä»Localçš„ä½ç½®å‘ä¸Šçœ‹ï¼Œæœ€å…ˆçœ‹åˆ°çš„æ˜¯Localä¸­çš„å˜é‡ï¼Œå…¶æ¬¡æ˜¯Enclosingä¸­çš„å˜é‡ï¼Œå†æ¬¡æ˜¯Globalä¸­çš„å˜é‡ï¼Œæœ€åæ‰æ˜¯Build-inå˜é‡</p>
<p>å˜é‡çš„å–å€¼å–å†³äºä½ åœ¨å“ªä¸ªä½ç½®ï¼Œæ¯”å¦‚ä½ åœ¨Eå’ŒLä¸­é—´ï¼Œé‚£åŒåçš„è¿™ä¸ªå˜é‡è‚¯å®šæ˜¯ä¼šå‘å‰çœ‹ï¼Œå–Eä¸­çš„å€¼</p>
<h1 id="Pythonä½œç”¨åŸŸçš„äº§ç”Ÿ"><a href="#Pythonä½œç”¨åŸŸçš„äº§ç”Ÿ" class="headerlink" title="Pythonä½œç”¨åŸŸçš„äº§ç”Ÿ"></a>Pythonä½œç”¨åŸŸçš„äº§ç”Ÿ</h1><p>åœ¨Pythonä¸­ï¼Œæ²¡æœ‰å—çº§ä½œç”¨åŸŸã€‚åªæœ‰æ¨¡å—(module)ï¼Œç±»(class)ä»¥åŠå‡½æ•°(def,lambda)æ‰ä¼šå¼•å…¥æ–°çš„ä½œç”¨åŸŸ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="literal">True</span>:</span><br><span class="line">    name = <span class="string">"PolarSnow"</span></span><br><span class="line">    </span><br><span class="line">print(name)</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šä»£ç æ˜¯å¯ä»¥æ­£å¸¸è¿è¡Œçš„ï¼Œä½†æ˜¯åœ¨Java(æœ‰å—çº§ä½œç”¨åŸŸ)ä¸­è¿è¡Œå°±ä¼šæŠ¥ï¼Œå˜é‡æœªå®šä¹‰çš„é”™è¯¯</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">()</span>:</span></span><br><span class="line">    name = <span class="string">"Polarsnow"</span></span><br><span class="line">  </span><br><span class="line">func()  </span><br><span class="line">print(name)</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šä»£ç æ‰§è¡Œå°±ä¼šæŠ¥é”™ï¼Œnameå˜é‡æœªå®šä¹‰</p>
<h1 id="Pythonå˜é‡ä½œç”¨åŸŸ"><a href="#Pythonå˜é‡ä½œç”¨åŸŸ" class="headerlink" title="Pythonå˜é‡ä½œç”¨åŸŸ"></a>Pythonå˜é‡ä½œç”¨åŸŸ</h1><h2 id="L-Local"><a href="#L-Local" class="headerlink" title="L(Local)"></a>L(Local)</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">int = <span class="number">7</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func2</span><span class="params">()</span>:</span></span><br><span class="line">    int = <span class="number">6</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">()</span>:</span></span><br><span class="line">        int = <span class="number">5</span></span><br><span class="line">        print(int)</span><br><span class="line">    <span class="keyword">return</span> func</span><br><span class="line"></span><br><span class="line">f = func2()</span><br><span class="line">f()</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line"><span class="number">5</span></span><br></pre></td></tr></table></figure>

<p>LEGéƒ½å¯¹intå˜é‡è‡ªå®šä¹‰äº†å€¼ï¼Œä½†æ˜¯æœ€åå–å¾—æ˜¯Lä¸­çš„å€¼</p>
<h2 id="E-Enclosing"><a href="#E-Enclosing" class="headerlink" title="E(Enclosing)"></a>E(Enclosing)</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">int = <span class="number">7</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func2</span><span class="params">()</span>:</span></span><br><span class="line">    int = <span class="number">6</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">()</span>:</span></span><br><span class="line">        print(int)</span><br><span class="line">    <span class="keyword">return</span> func</span><br><span class="line"></span><br><span class="line">f = func2()</span><br><span class="line">f()</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line"><span class="number">6</span></span><br></pre></td></tr></table></figure>

<p>åœ¨localä¸­å–å€¼ï¼Œä½†æ˜¯localä¸­æ²¡æœ‰ï¼Œå°±ä¼šå»Eé‡Œé¢æ‰¾</p>
<h2 id="G-Global"><a href="#G-Global" class="headerlink" title="G(Global)"></a>G(Global)</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">int = <span class="number">7</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func2</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">()</span>:</span></span><br><span class="line">        print(int)</span><br><span class="line">    <span class="keyword">return</span> func</span><br><span class="line"></span><br><span class="line">f = func2()</span><br><span class="line">f()</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line"><span class="number">7</span></span><br></pre></td></tr></table></figure>

<p>Lå’ŒEä¸­éƒ½æ²¡æœ‰æ‰¾åˆ°intçš„å€¼ï¼Œç»§ç»­å‘ä¸Šæ‰¾ï¼Œåœ¨Gä¸­æ‰¾åˆ°äº†intçš„å€¼</p>
<h2 id="B-Build-in"><a href="#B-Build-in" class="headerlink" title="B(Build-in)"></a>B(Build-in)</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func2</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">()</span>:</span></span><br><span class="line">        print(int)</span><br><span class="line">    <span class="keyword">return</span> func</span><br><span class="line"></span><br><span class="line">f = func2()</span><br><span class="line">f()</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">int</span>'&gt;</span></span><br></pre></td></tr></table></figure>

<p>intå˜é‡çš„å€¼åœ¨LEGä¸­éƒ½æ²¡æœ‰æ‰¾åˆ°ï¼Œä½†æ˜¯intæ˜¯å†…å»ºå˜é‡ï¼Œåœ¨ç³»ç»Ÿä¸­å·²ç»å¯¹å…¶æœ‰å®šä¹‰ï¼Œæœ€ååœ¨Bä¸­ï¼Œæ‰¾åˆ°äº†intçš„å€¼</p>
<p>å¦‚æœä¸€ä¸ªå˜é‡åœ¨localä¸­æŸ¥æ‰¾ï¼ŒæŸ¥æ‰¾åˆ°Bä¸­è¿˜æ²¡æœ‰æ‰¾åˆ°ï¼Œå°±ä¼šæŠ¥å˜é‡æœªå®šä¹‰çš„é”™è¯¯</p>
<h1 id="global-amp-nonlocal-å…³é”®å­—"><a href="#global-amp-nonlocal-å…³é”®å­—" class="headerlink" title="global &amp; nonlocal å…³é”®å­—"></a>global &amp; nonlocal å…³é”®å­—</h1><h2 id="global"><a href="#global" class="headerlink" title="global"></a>global</h2><p>å‡½æ•°å†…éƒ¨å¯ä»¥è®¿é—®å…¨å±€å˜é‡ä¸­çš„å€¼ï¼Œä½†æ˜¯ä¸èƒ½ä¿®æ”¹å…¨å±€å˜é‡çš„å€¼ã€‚å¦‚æœéœ€è¦ä¿®æ”¹ï¼Œè¦åŠ ä¸Šglobalå…³é”®å­—</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">name = <span class="string">"ps"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">readonly</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"inner ---&gt;"</span>, name)</span><br><span class="line"></span><br><span class="line">readonly()</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">ps</span><br></pre></td></tr></table></figure>

<p>å‡½æ•°å†…éƒ¨æ˜¯å¯ä»¥è®¿é—®å…¨å±€å˜é‡çš„å€¼çš„ï¼ŒåŸåˆ™ â€“&gt; GBEL</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">name = <span class="string">"ps"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">readonly</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">global</span> name</span><br><span class="line">    name = <span class="string">"PolarSnow"</span></span><br><span class="line"></span><br><span class="line">readonly()</span><br><span class="line">print(name)</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">PolarSnow</span><br></pre></td></tr></table></figure>

<p>åŠ ä¸Šäº†globalå…³é”®å­—ï¼Œå°±å¯ä»¥ä¿®æ”¹å…¨å±€å˜é‡çš„å€¼</p>
<h2 id="nonlocal"><a href="#nonlocal" class="headerlink" title="nonlocal"></a>nonlocal</h2><p>globalå…³é”®å­—å£°æ˜çš„å˜é‡å¿…é¡»åœ¨å…¨å±€ä½œç”¨åŸŸä¸Šï¼Œä¸èƒ½åµŒå¥—ä½œç”¨åŸŸä¸Šï¼Œå½“è¦ä¿®æ”¹åµŒå¥—ä½œç”¨åŸŸï¼ˆenclosingä½œç”¨åŸŸï¼Œå¤–å±‚éå…¨å±€ä½œç”¨åŸŸï¼‰ä¸­çš„å˜é‡å°±éœ€è¦nonlocalå…³é”®å­—äº†</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">outer</span><span class="params">()</span>:</span></span><br><span class="line">    count = <span class="number">10</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inner</span><span class="params">()</span>:</span></span><br><span class="line">        <span class="keyword">nonlocal</span> count</span><br><span class="line">        count = <span class="number">20</span></span><br><span class="line">        print(<span class="string">"inner ---&gt; "</span>, count)</span><br><span class="line">    inner()</span><br><span class="line">    print(<span class="string">"outer ---&gt;"</span>, count)</span><br><span class="line"></span><br><span class="line">outer()</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line"><span class="number">20</span></span><br><span class="line"><span class="number">20</span></span><br></pre></td></tr></table></figure>


<h1 id="å˜é‡ä½œç”¨åŸŸä¸­çš„ç–‘éš¾æ‚ç—‡"><a href="#å˜é‡ä½œç”¨åŸŸä¸­çš„ç–‘éš¾æ‚ç—‡" class="headerlink" title="å˜é‡ä½œç”¨åŸŸä¸­çš„ç–‘éš¾æ‚ç—‡"></a>å˜é‡ä½œç”¨åŸŸä¸­çš„ç–‘éš¾æ‚ç—‡</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">name = <span class="string">"123"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func1</span><span class="params">()</span>:</span></span><br><span class="line">    print(name)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func2</span><span class="params">()</span>:</span></span><br><span class="line">    name = <span class="string">"456"</span></span><br><span class="line">    func1()</span><br><span class="line"></span><br><span class="line">func2()</span><br></pre></td></tr></table></figure>

<p>æœ€åä¼šè¾“å‡ºä»€ä¹ˆç»“æœï¼Ÿ</p>
<p>ç»“æœæ˜¯ï¼š <code>123</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">name = <span class="string">"123"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func1</span><span class="params">()</span>:</span></span><br><span class="line">    print(name)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func2</span><span class="params">()</span>:</span></span><br><span class="line">    name = <span class="string">"456"</span></span><br><span class="line">    <span class="keyword">return</span> func1</span><br><span class="line"></span><br><span class="line">ret = func2()</span><br><span class="line">ret()</span><br></pre></td></tr></table></figure>

<p>ç»“æœæ˜¯ï¼š <code>123</code></p>
<p>ä¸Šé¢ä¸¤æ®µä»£ç çš„ç»“æœéƒ½æ˜¯å…¨å±€å˜é‡ä¸­çš„å€¼<code>123</code>ï¼Œè¿™é‡Œéœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œå˜é‡ä½œç”¨åŸŸåœ¨å‡½æ•°æ‰§è¡Œä¹‹å‰å°±å·²ç»ç¡®å®šäº†ï¼</p>
<p>Pythonä½œä¸ºè§£é‡Šå‹çš„è¯­è¨€ï¼Œä»£ç ä»ä¸Šè‡³ä¸‹æ‰§è¡Œï¼Œé‡åˆ°defæ—¶ï¼Œå°±å°†å…¶å‡½æ•°ä½“ä¿å­˜åœ¨å†…å­˜çš„å †åŒºï¼ŒæŠŠå¯¹åº”çš„å‡½æ•°åä¿å­˜åœ¨æ ˆåŒºå¹¶æŒ‡å‘å †åŒºçš„å‡½æ•°ä½“ï¼Œåœ¨å‡½æ•°æ‰§è¡Œä¹‹å‰ï¼Œè¿™ä¸ªå‡½æ•°ä¸­çš„å˜é‡ä½œç”¨åŸŸå°±å·²ç»è¢«è®°å½•åˆ°å†…å­˜ä¸­äº†ï¼Œä¸ä¼šå› ä¸ºåæœŸçš„è°ƒç”¨æˆ–åµŒå¥—è€Œæ›´æ”¹</p>
<hr>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">l = [x + <span class="number">1</span> <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">10</span>) <span class="keyword">if</span> x &gt; <span class="number">5</span>]</span><br><span class="line">print(<span class="string">"display list ---&gt;"</span>, l)</span><br><span class="line">print(<span class="string">"first element ---&gt;"</span>, l[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">print(<span class="string">"---"</span> * <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">ll = [<span class="keyword">lambda</span> :x <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">10</span>) <span class="keyword">if</span> x &gt; <span class="number">5</span>]</span><br><span class="line">print(<span class="string">"display list ---&gt;"</span>, ll)</span><br><span class="line"></span><br><span class="line">ret = ll[<span class="number">0</span>]()</span><br><span class="line">print(<span class="string">"first element ---&gt;"</span>, ret)</span><br></pre></td></tr></table></figure>

<p>ç»“æœæ˜¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">display list ---&gt; [7, 8, 9, 10]</span><br><span class="line">first element ---&gt; 7</span><br><span class="line">---------------</span><br><span class="line">display list ---&gt; [&lt;function &lt;listcomp&gt;.&lt;lambda&gt; at 0x101b7b730&gt;, &lt;function &lt;listcomp&gt;.&lt;lambda&gt; at 0x101b7b7b8&gt;, &lt;function &lt;listcomp&gt;.&lt;lambda&gt; at 0x101b7b840&gt;, &lt;function &lt;listcomp&gt;.&lt;lambda&gt; at 0x101b7b8c8&gt;]</span><br><span class="line">first element ---&gt; 9</span><br></pre></td></tr></table></figure>

<p>é—®é¢˜æ¥äº†ï¼Œé—®ä»€ä¹ˆä½¿ç”¨äº†lambdaä¹‹åï¼Œç¬¬ä¸€ä¸ªå…ƒç´ å˜æˆ9äº†å‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬æŠŠè¿™ä¸ªé—®é¢˜æ‹†è§£ä¸€ä¸‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">lll = []</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">    <span class="keyword">if</span> x &gt; <span class="number">5</span>:</span><br><span class="line">        lll.append(x + <span class="number">1</span>)</span><br><span class="line">print(lll)</span><br><span class="line">print(lll[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">llll = []</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">    <span class="keyword">if</span> x &gt; <span class="number">5</span>:</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">()</span>:</span></span><br><span class="line">            <span class="keyword">return</span> x</span><br><span class="line">        llll.append(func)</span><br><span class="line">print(llll)</span><br><span class="line">print(llll[<span class="number">0</span>]())</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">[<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>]</span><br><span class="line"><span class="number">7</span></span><br><span class="line">[&lt;function func at <span class="number">0x10137b620</span>&gt;, &lt;function func at <span class="number">0x10137b6a8</span>&gt;, &lt;function func at <span class="number">0x10137b730</span>&gt;, &lt;function func at <span class="number">0x10137b7b8</span>&gt;]</span><br><span class="line"><span class="number">9</span></span><br></pre></td></tr></table></figure>

<p>ä¸ºä»€ä¹ˆ x+1 æ—¶ç¬¬ä¸€ä¸ªå…ƒç´  = 7ï¼Œ è€Œ lambda :x æ—¶ç¬¬ä¸€ä¸ªå…ƒç´  = 9äº†å‘¢</p>
<p>åŸå› å°±æ˜¯Pythonç¨‹åºåœ¨è§£é‡Šé“lambdaçš„æ—¶å€™ï¼Œå¹¶æ²¡æœ‰æ‰§è¡Œé‡Œé¢çš„ä»£ç ï¼Œè€Œæ˜¯ç›´æ¥æ”¾åˆ°çš„äº†å†…å­˜ä¸­ï¼Œéšç€å¤–ä¾§å¾ªç¯çš„ç»“æŸï¼Œxçš„å€¼å·²ç»å˜æˆäº†9ï¼Œæ­¤æ—¶å†æŠŠå†…å­˜é‡Œä¿å­˜çš„lambdaå‡½æ•°æ‹¿å‡ºæ¥æ‰§è¡Œï¼Œxå˜é‡è·å–åˆ°çš„å°±æ˜¯å½“å‰å·²ç»å˜æˆ9çš„è¿™ä¸ªå€¼</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">lllll = []</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">    <span class="keyword">if</span> x &gt; <span class="number">5</span>:</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(i = x)</span>:</span></span><br><span class="line">            <span class="keyword">return</span> i</span><br><span class="line">        lllll.append(func)</span><br><span class="line">print(lllll)</span><br><span class="line">print(lllll[<span class="number">0</span>]())</span><br><span class="line">print(lllll[<span class="number">1</span>]())</span><br><span class="line">print(lllll[<span class="number">2</span>]())</span><br><span class="line">print(lllll[<span class="number">3</span>]())</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">[&lt;function func at <span class="number">0x101b7b620</span>&gt;, &lt;function func at <span class="number">0x101b7b6a8</span>&gt;, &lt;function func at <span class="number">0x101b7b730</span>&gt;, &lt;function func at <span class="number">0x101b7b7b8</span>&gt;]</span><br><span class="line"><span class="number">6</span></span><br><span class="line"><span class="number">7</span></span><br><span class="line"><span class="number">8</span></span><br><span class="line"><span class="number">9</span></span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„ä»£ç ä»…ä»…å°ä¿®æ”¹äº†ä¸€ä¸‹ï¼Œåœ¨funcä¸­æ‰§è¡Œä¸€æ¡èµ‹å€¼è¯­å¥ï¼Œç»“æœå°±ç«‹åˆ»ä¸ä¸€æ ·äº†ï¼Œè¿™æ¬¡åˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå€¼å˜æˆäº†6</p>
<p>ä¹‹å‰ä¸æ˜¯è¯´ä»£ç è¿è¡Œåˆ°defå°±ç›´æ¥ä¿å­˜åˆ°å†…å­˜ï¼Œä¸æ‰§è¡Œäº†å—ï¼Ÿæ²¡é”™ï¼Œå‡½æ•°ä½“æ˜¯æ²¡æœ‰è¢«æ‰§è¡Œï¼Œä½†æ˜¯å‡½æ•°çš„å‚æ•°æ˜¯ä¸ªèµ‹å€¼è¡¨è¾¾å¼ï¼Œè¢«Pythonè§£é‡Šå™¨æ‰§è¡Œäº†ï¼Œè·å–åˆ°äº†æ¯ä¸ªå¾ªç¯çš„xçš„å€¼ï¼Œå¹¶èµ‹å€¼ç»™å‡½æ•°è‡ªå·±å†…éƒ¨çš„å˜é‡ï¼ˆlocalï¼‰</p>
<p>å½“ç¨‹åºæ‰§è¡Œå®Œæ¯•ï¼Œè¿è¡Œåˆ—è¡¨ä¸­ç¬¬ä¸€ä¸ªå‡½æ•°å–å€¼çš„æ—¶å€™ï¼Œè¯¥å‡½æ•°å–åˆ°çš„æ˜¯å‡½æ•°å†…éƒ¨çš„å˜é‡iï¼Œæ‰€ä»¥æœ€åçš„ç»“æœå’Œä¸Šé¢æ˜¯æˆªç„¶ä¸åŒçš„</p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>å˜é‡ä½œç”¨åŸŸ</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonç½‘ç»œç¼–ç¨‹ä¹‹socketserverçš„ä½¿ç”¨</title>
    <url>/2016/07/08/Python%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E4%B9%8Bsocketserver%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
    <content><![CDATA[<blockquote>
<p>åœ¨Python2.xä¸­éœ€è¦import SocketServerï¼Œåœ¨Python3.xä¸­ï¼Œéƒ½å˜æˆäº†å°å†™ï¼Œéœ€è¦import sockerserver</p>
<p>Python Version: 3.5+</p>
</blockquote>
<ul>
<li><font color="red">server.py</font> </li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> socketserver</span><br><span class="line"></span><br><span class="line"><span class="comment"># è‡ªå®šä¹‰socketserveréœ€è¦ç»§æ‰¿socketserver.BaseRequestHandler</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyServer</span><span class="params">(socketserver.BaseRequestHandler)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ¯ä¸€ä¸ªå¯¹è±¡å®ä¾‹åŒ–çš„æ—¶å€™,éƒ½ä¼šæ‰§è¡Œhandleé‡Œé¢çš„ä»£ç </span></span><br><span class="line">    <span class="comment"># è‡ªå®šä¹‰çš„handleæ–¹æ³•ä¼šé‡å†™çˆ¶ç±»çš„handleæ–¹æ³•,ä¸»è¦ç”¨æ¥ä¸å®¢æˆ·ç«¯è¿›è¡Œäº¤äº’</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle</span><span class="params">(self)</span>:</span></span><br><span class="line">        conn = self.request</span><br><span class="line">        <span class="comment"># è¿™æ¡æ¬¢è¿æ¶ˆæ¯ä¼šåœ¨æ¯ä¸ªå®¢æˆ·ç«¯è¿ä¸Šä¹‹åå‘é€</span></span><br><span class="line">        conn.sendall(bytes(<span class="string">"Welcome to docs.20150509.cn"</span>, encoding=<span class="string">'utf8'</span>))</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            recv_data = conn.recv(<span class="number">1024</span>)</span><br><span class="line">            <span class="keyword">if</span> len(recv_data) == <span class="number">0</span>:<span class="keyword">break</span></span><br><span class="line">            conn.sendall(recv_data.upper())</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    server = socketserver.ThreadingTCPServer((<span class="string">'127.0.0.1'</span>, <span class="number">5959</span>), MyServer)</span><br><span class="line">    <span class="comment"># æ¯å¤šä¸€ä¸ªå®¢æˆ·ç«¯çš„è¿æ¥,å°±ç¡å¤šèµ·ä¸€ä¸ªçº¿ç¨‹å»å¤„ç†</span></span><br><span class="line">    server.serve_forever()</span><br></pre></td></tr></table></figure>

<ul>
<li><font color="blue">client.py</font> </li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">ip_port = (<span class="string">'127.0.0.1'</span>, <span class="number">5959</span>)</span><br><span class="line">s = socket.socket()</span><br><span class="line">s.connect(ip_port)</span><br><span class="line"></span><br><span class="line"><span class="comment"># é¦–å…ˆæ¥æ”¶æœåŠ¡ç«¯å‘æ¥çš„æ¬¢è¿æ¶ˆæ¯</span></span><br><span class="line">welcome_msg = s.recv(<span class="number">1024</span>)</span><br><span class="line">print(str(welcome_msg, encoding=<span class="string">'utf-8'</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="comment"># è¾“å…¥æ¶ˆæ¯</span></span><br><span class="line">    sent_data = input(<span class="string">"&gt; "</span>).strip()</span><br><span class="line">    <span class="keyword">if</span> len(sent_data) == <span class="number">0</span>: <span class="keyword">continue</span></span><br><span class="line">    <span class="comment">#  å‘é€æ¶ˆæ¯</span></span><br><span class="line">    s.send(bytes(sent_data, encoding=<span class="string">'utf8'</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ¥æ”¶æ¶ˆæ¯</span></span><br><span class="line">    recv_data = s.recv(<span class="number">1024</span>)</span><br><span class="line">    print(str(recv_data, encoding=<span class="string">'utf-8'</span>))</span><br><span class="line"></span><br><span class="line">s.close()</span><br></pre></td></tr></table></figure>

<ul>
<li><font color="orange">æ‰§è¡Œ</font> </li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Welcome to docs<span class="number">.20150509</span>.cn</span><br><span class="line">&gt; polarsnow</span><br><span class="line">POLARSNOW</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<p>å¤šä¸ªå®¢æˆ·ç«¯å¯ä»¥åŒæ—¶è¿æ¥ä½¿ç”¨ï¼Œæ¯ä¸ªå®¢æˆ·ç«¯è¿æ¥æ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œåœ¨æœåŠ¡ç«¯éƒ½ä¼šæ–°èµ·ä¸€ä¸ªè¿›æ¥æ¥è´Ÿè´£è¿™ä¸ªçº¿ç¨‹çš„å¤„ç†</p>
<h1 id="æµ…è°ˆæºç "><a href="#æµ…è°ˆæºç " class="headerlink" title="æµ…è°ˆæºç "></a>æµ…è°ˆæºç </h1><p>æˆ‘ä»¬å°±æ¥çœ‹çœ‹ç»§æ‰¿çš„<code>socketserver.BaseRequestHandler</code>çš„æºç </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BaseRequestHandler</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="string">"""Base class for request handler classes.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    This class is instantiated for each request to be handled.  The</span></span><br><span class="line"><span class="string">    constructor sets the instance variables request, client_address</span></span><br><span class="line"><span class="string">    and server, and then calls the handle() method.  To implement a</span></span><br><span class="line"><span class="string">    specific service, all you need to do is to derive a class which</span></span><br><span class="line"><span class="string">    defines a handle() method.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    The handle() method can find the request as self.request, the</span></span><br><span class="line"><span class="string">    client address as self.client_address, and the server (in case it</span></span><br><span class="line"><span class="string">    needs access to per-server information) as self.server.  Since a</span></span><br><span class="line"><span class="string">    separate instance is created for each request, the handle() method</span></span><br><span class="line"><span class="string">    can define arbitrary other instance variariables.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, request, client_address, server)</span>:</span></span><br><span class="line">        self.request = request</span><br><span class="line">        self.client_address = client_address</span><br><span class="line">        self.server = server</span><br><span class="line">        self.setup()</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            self.handle()</span><br><span class="line">        <span class="keyword">finally</span>:</span><br><span class="line">            self.finish()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setup</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">finish</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘æ²¡æœ‰çœç•¥ï¼Œæºç ä¸­åªæœ‰è¿™å‡ è¡Œ</p>
<p>å¯ä»¥çœ‹å‡ºï¼Œåˆ›å»ºå¯¹è±¡æ‰§è¡Œæ„é€ æ–¹æ³•çš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨å»æ‰§è¡Œä¸‰ä¸ªæ–¹æ³•</p>
<ul>
<li>self.setup() è´Ÿè´£å®¢æˆ·ç«¯è¿æ¥æ—¶çš„å¤„ç†</li>
<li>self.handle() è´Ÿè´£å®¢æˆ·ç«¯è¿æ¥åçš„äº¤äº’</li>
<li>self.finish() è´Ÿè´£å®¢æˆ·ç«¯æ–­å¼€å‰çš„æ“ä½œ</li>
</ul>
<p>åœ¨æˆ‘ä»¬è‡ªå·±çš„ç±»ä¸­ï¼Œå¯ä»¥é€šè¿‡é‡å†™çˆ¶ç±»çš„è¿™æ–¹æ³•æ¥å®ç°å¯¹å®¢æˆ·ç«¯è¯·æ±‚çš„å¤„ç†</p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>ç½‘ç»œç¼–ç¨‹</tag>
        <tag>socketserver</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonç½‘ç»œç¼–ç¨‹ä¹‹socketç²˜åŒ…é—®é¢˜</title>
    <url>/2016/07/08/Python%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E4%B9%8Bsocket%E7%B2%98%E5%8C%85%E9%97%AE%E9%A2%98/</url>
    <content><![CDATA[<blockquote>
<p>ç½‘ç»œç¼–ç¨‹ä¸­ï¼Œæ¯æ¬¡å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯çº¦å®šä¿—æˆå‘é€åŒ…çš„å¤§å°ä¸º1024å­—èŠ‚ï¼Œæœ€å¤§ä¸º8192å­—èŠ‚ã€‚ä½†æ˜¯å³ä½¿ä½ è®¾ç½®äº†8192ï¼Œç¡¬ä»¶ç½‘å¡æ¯æ¬¡ä¹Ÿåªèƒ½æ”¶åˆ°1500å­—èŠ‚ï¼Œè¿™ä¸ªæ˜¯ç”±ç¡¬ä»¶ç½‘å¡çš„MTUå€¼ï¼ˆæœ€å¤§ä¼ è¾“å•å…ƒï¼Œå•ä½å­—èŠ‚ï¼‰å†³å®šçš„ã€‚ä¸€èˆ¬åƒå…†ç½‘å¡çš„MTUå€¼æ˜¯1500å­—èŠ‚ã€‚å½“ä¸€ç«¯ç»™å¦ä¸€ç«¯å‘åŒ…è¶…è¿‡1024å­—èŠ‚ï¼Œå¦ä¸€ç«¯æ²¡æœ‰å¾ªç¯æ¥æ”¶æ¶ˆæ¯ï¼Œå°±ä¼šäº§ç”Ÿç²˜åŒ…çš„é—®é¢˜</p>
</blockquote>
<p><img src="http://oss.20150509.cn/20160708020159.png" alt=""></p>
<p>ç²˜åŒ…çš„é—®é¢˜çœ‹ä¸Šå›¾</p>
<p>å®¢æˆ·ç«¯ç»™æœåŠ¡ç«¯å‘é€äº†ä¸€ä¸ªå‘½ä»¤è¯·æ±‚ï¼ŒæœåŠ¡ç«¯çš„è¿”å›ä½“å¤§å°ä¸º11024å­—èŠ‚ï¼Œä½†æ˜¯å®¢æˆ·ç«¯æ¯æ¬¡åªæ”¶1024å­—èŠ‚ï¼Œæ‰€ä»¥å®¢æˆ·ç«¯çš„ç¬¬ä¸€æ¬¡è¯·æ±‚ä¹‹åï¼ŒæœåŠ¡ç«¯è¿˜æœ‰10000å­—èŠ‚çš„å†…å®¹è¿˜æ²¡ç»™å®¢æˆ·ç«¯å‘</p>
<p>å½“å®¢æˆ·ç«¯å‘ç»™ç¬¬äºŒä¸ªè¯·æ±‚æ—¶ï¼Œç¬¬äºŒä¸ªè¯·æ±‚çš„è¿”å›ä½“å¤§å°ä¸º100å­—èŠ‚ï¼Œä½†æ˜¯é˜Ÿåˆ—ä¸­è¿˜æœ‰10000å­—èŠ‚çš„å†…å®¹æ²¡æœ‰å‘é€ç»™å®¢æˆ·ç«¯ï¼Œæ‰€ä»¥æ­¤æ—¶æœåŠ¡ç«¯ä¼šå°†ä¸Šæ¬¡å‰©ä½™çš„10000å­—èŠ‚ä¸­å†æ‹¿å‡º1024å­—èŠ‚æ¥å‘é€ç»™å®¢æˆ·ç«¯</p>
<h1 id="è§£å†³ç²˜åŒ…é—®é¢˜"><a href="#è§£å†³ç²˜åŒ…é—®é¢˜" class="headerlink" title="è§£å†³ç²˜åŒ…é—®é¢˜"></a>è§£å†³ç²˜åŒ…é—®é¢˜</h1><p>è§£å†³ç²˜åŒ…é—®é¢˜çš„å…³é”®ç‚¹åœ¨äºæˆ‘ä»¬èƒ½å¦çŸ¥é“æ¯æ¬¡éœ€è¦å‘é€çš„å†…å®¹æ€»å…±æœ‰å¤šå¤§ï¼Œå¦‚æœæˆ‘ä»¬èƒ½çŸ¥é“æ€»å…±æœ‰å¤šå¤§ï¼Œç›¸åº”çš„å¯¹ç«¯å°±å¯ä»¥ç®—å‡ºæˆ‘éœ€è¦å¾ªç¯å‡ æ¬¡å¯ä»¥å§å†…å®¹å…¨éƒ¨è¯»å®Œ</p>
<p>å…ˆæ¥çœ‹çœ‹åŸå§‹ä¼šå‘ç”Ÿç²˜åŒ…æƒ…å†µçš„ä»£ç ï¼š</p>
<ul>
<li><font color="red">server.py</font> </li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line">ip_port = (<span class="string">'127.0.0.1'</span>, <span class="number">5555</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># step 1: åˆ›å»ºsocketå¥—æ¥å­—, é‡Œé¢å°è£…äº†é€šä¿¡åè®®</span></span><br><span class="line">s = socket.socket()</span><br><span class="line"></span><br><span class="line"><span class="comment"># step 2: ç»‘å®šIPåŠç«¯å£å·</span></span><br><span class="line">s.bind(ip_port)</span><br><span class="line"></span><br><span class="line"><span class="comment"># step 3: ç›‘å¬ç»‘å®šçš„ç«¯å£</span></span><br><span class="line">s.listen(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŠŠæ¥æ”¶å®¢æˆ·ç«¯è¿æ¥è¯·æ±‚çš„æ“ä½œå¾ªç¯èµ·æ¥å°±å¯ä»¥æ¥å—å¤šä¸ªç”¨æˆ·çš„è¯·æ±‚å•¦</span></span><br><span class="line"><span class="comment"># æ³¨æ„:åŒä¸€æ—¶é—´åªèƒ½å¤„ç†ä¸€ä¸ªå®¢æˆ·ç«¯çš„è¯·æ±‚,å…¶ä»–è¿æ¥ä¸Šçš„ç”¨æˆ·ä¼šæ’é˜Ÿç­‰å¾…</span></span><br><span class="line"><span class="comment"># æœ€åæ”¯æŒå¤šå°‘ä¸ªç”¨æˆ·æ’é˜Ÿç­‰å¾…,æ˜¯ç”±listenä¸­çš„å‚æ•°å†³å®šçš„(è¿æ¥æ± )</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ç­‰å¾…å®¢æˆ·ç«¯çš„è¿æ¥(é˜»å¡å‡½æ•°)</span></span><br><span class="line">    <span class="comment"># step 4: æ¥å—å®¢æˆ·ç«¯çš„è¿æ¥</span></span><br><span class="line">    conn, addr = s.accept()</span><br><span class="line">    <span class="comment"># connå¯¹è±¡é‡Œå°è£…äº†è¿æ¥è¿‡æ¥çš„è¿™ä¸ªå®¢æˆ·ç«¯çš„é€šä¿¡çº¿è·¯ä¿¡æ¯</span></span><br><span class="line">    <span class="comment"># åæœŸè·Ÿè¿™ä¸ªå®¢æˆ·ç«¯çš„é€šä¿¡ä¸äº¤äº’éƒ½éœ€è¦åœ¨connè¿™æ¡é€šä¿¡çº¿è·¯ä¸Šè¿›è¡Œ</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line"></span><br><span class="line">        <span class="comment"># step 5: æ¥æ”¶æ¶ˆæ¯(åœ¨conné€šé“æ²¡æœ‰è¢«å…³é—­çš„æƒ…å†µä¸‹æ˜¯é˜»å¡çš„å‡½æ•°,ä¸€æ—¦connè¢«å®¢æˆ·ç«¯å…³é—­,è¯¥å‡½æ•°å°†ä¸ä¼šé˜»å¡)</span></span><br><span class="line">        recv_data = conn.recv(<span class="number">1024</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å¦‚æœconné€šé“è¢«å®¢æˆ·ç«¯ä¸»åŠ¨å…³é—­,recvå‡½æ•°å°†ä¸å†é˜»å¡,recv_dataå°†æ¥æ”¶åˆ°ç©ºå­—ç¬¦ä¸²</span></span><br><span class="line">        <span class="comment"># é€šè¿‡åˆ¤æ–­recv_dataä¸ºç©ºå­—ç¬¦ä¸²æ¥é€€å‡ºæœåŠ¡ç«¯çš„è¿æ¥</span></span><br><span class="line">        <span class="keyword">if</span> len(recv_data) == <span class="number">0</span>: <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># step 6:å¤„ç†æ¶ˆæ¯</span></span><br><span class="line">        cmd = str(recv_data, encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">        p = subprocess.Popen(cmd, shell=<span class="literal">True</span>, stdout=subprocess.PIPE)</span><br><span class="line">        res = p.stdout.read()</span><br><span class="line">        send_data = str(res, encoding=<span class="string">'utf-8'</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># step 7: å‘é€æ¶ˆæ¯</span></span><br><span class="line">        conn.send(bytes(send_data, encoding=<span class="string">'utf-8'</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># step 8: æ–­å¼€è¿æ¥</span></span><br><span class="line">    conn.close()</span><br></pre></td></tr></table></figure>

<ul>
<li><font color="blue">client.py</font> </li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">ip_port = (<span class="string">'127.0.0.1'</span>, <span class="number">5555</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># step 1: åˆ›å»ºsocketå¥—æ¥å­—, é‡Œé¢å°è£…äº†é€šä¿¡åè®®</span></span><br><span class="line">s = socket.socket()</span><br><span class="line"></span><br><span class="line"><span class="comment"># step 2: è¿æ¥æœåŠ¡ç«¯</span></span><br><span class="line">s.connect(ip_port)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line"></span><br><span class="line">    <span class="comment"># step 3: å‘é€æ¶ˆæ¯</span></span><br><span class="line">    send_data = input(<span class="string">"&gt; "</span>).strip()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¦‚æœå®¢æˆ·ç«¯è¾“å…¥äº†exit,é€€å‡ºå¾ªç¯,ä¸»åŠ¨closeæ‰ä¸æœåŠ¡ç«¯çš„è¿æ¥</span></span><br><span class="line">    <span class="keyword">if</span> send_data == <span class="string">"exit"</span>: <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¦‚æœä»€ä¹ˆä¹Ÿæ²¡æœ‰è¾“å…¥,é‡æ–°å¾ªç¯æ¥æ”¶è¾“å…¥</span></span><br><span class="line">    <span class="keyword">if</span> len(send_data) == <span class="number">0</span>: <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># è¿™é‡Œæ³¨æ„,å’ŒæœåŠ¡ç«¯ä¸åŒçš„æ˜¯,æœåŠ¡ç«¯æ‰¾åˆ°å¯¹ç«¯æ˜¯é€šè¿‡connå¯¹è±¡,è€Œå®¢æˆ·ç«¯æ˜¯så¯¹è±¡</span></span><br><span class="line">    <span class="comment"># åœ¨Python3.xä¸­,socketå¯¹è±¡å‘é€å¯¹è±¡å¿…é¡»æ˜¯å­—èŠ‚ç±»å‹(2.7ä¸­å¯ä»¥æ˜¯å­—ç¬¦ä¸²)</span></span><br><span class="line">    s.send(bytes(send_data, encoding=<span class="string">'utf-8'</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># step 4: æ”¶æ¶ˆæ¯</span></span><br><span class="line">    recv_data = s.recv(<span class="number">1024</span>)</span><br><span class="line">    print(str(recv_data, encoding=<span class="string">'utf-8'</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># step 5: æ–­å¼€è¿æ¥</span></span><br><span class="line">s.close()</span><br></pre></td></tr></table></figure>

<p>è¦è§£å†³ä¸Šé¢ç²˜åŒ…çš„é—®é¢˜ï¼Œé¦–å…ˆç”¨ç™½è¯æ¥æè¿°ä¸€ä¸‹è§£å†³çš„è¿‡ç¨‹</p>
<ul>
<li>å®¢æˆ·ç«¯ä¸çŸ¥é“æœåŠ¡ç«¯ä¼šè¿”å›å¤šå°‘å†…å®¹ï¼Œæ‰€ä»¥å®¢æˆ·ç«¯æ¥æ”¶ä¿¡æ¯çš„ä»£ç éœ€è¦å¾ªç¯èµ·æ¥</li>
<li>ç”±äºå®¢æˆ·ç«¯æ¥æ”¶å¾ªç¯ä¸çŸ¥é“ä½•æ—¶åœæ­¢ï¼Œå‰æéœ€è¦å…ˆçŸ¥é“æœåŠ¡ç«¯æ€»å…±ä¼šæœ‰å¤šå°‘å­—èŠ‚çš„å†…å®¹å‘è¿‡æ¥</li>
<li>æœåŠ¡ç«¯åœ¨å‘é€å®é™…æ•°æ®ä¹‹å‰ï¼Œå…ˆè®¡ç®—è¦å‘é€çš„æ•°æ®æœ‰å¤šå¤§ï¼ŒæŠŠè¿™ä¸ªä¿¡æ¯æå‰å‘ŠçŸ¥å®¢æˆ·ç«¯ï¼Œè®©å®¢æˆ·ç«¯è®¡ç®—å‡ºéœ€è¦å‡ æ¬¡å¾ªç¯æ‰èƒ½æŠŠæˆ‘æœåŠ¡ç«¯æœ¬æ¬¡äº§ç”Ÿçš„æ•°æ®æ¥æ”¶å®Œæ¯•</li>
<li>å®¢æˆ·ç«¯åœ¨æ¥æ”¶åˆ°æœåŠ¡ç«¯å‘æ¥çš„æ€»é•¿åº¦çš„ä¿¡æ¯æ—¶ï¼Œè®¡ç®—å‡ºå¾ªç¯çš„æ¬¡æ•°ï¼Œæ­¤æ—¶åº”å‘ŠçŸ¥æœåŠ¡å™¨ç«¯ï¼Œå¯ä»¥å‘é€æ•°æ®äº†</li>
</ul>
<p>ä¸‹é¢æˆ‘ä»¬å°±æŒ‰ç…§ä¸Šé¢çš„æ€è·¯æ¥å®ç°è¿™æ®µä»£ç </p>
<ul>
<li><font color="red">server.py</font> </li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line">ip_port = (<span class="string">'127.0.0.1'</span>, <span class="number">5556</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># step 1: åˆ›å»ºsocketå¥—æ¥å­—, é‡Œé¢å°è£…äº†é€šä¿¡åè®®</span></span><br><span class="line">s = socket.socket()</span><br><span class="line"></span><br><span class="line"><span class="comment"># step 2: ç»‘å®šIPåŠç«¯å£å·</span></span><br><span class="line">s.bind(ip_port)</span><br><span class="line"></span><br><span class="line"><span class="comment"># step 3: ç›‘å¬ç»‘å®šçš„ç«¯å£</span></span><br><span class="line">s.listen(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŠŠæ¥æ”¶å®¢æˆ·ç«¯è¿æ¥è¯·æ±‚çš„æ“ä½œå¾ªç¯èµ·æ¥å°±å¯ä»¥æ¥å—å¤šä¸ªç”¨æˆ·çš„è¯·æ±‚å•¦</span></span><br><span class="line"><span class="comment"># æ³¨æ„:åŒä¸€æ—¶é—´åªèƒ½å¤„ç†ä¸€ä¸ªå®¢æˆ·ç«¯çš„è¯·æ±‚,å…¶ä»–è¿æ¥ä¸Šçš„ç”¨æˆ·ä¼šæ’é˜Ÿç­‰å¾…</span></span><br><span class="line"><span class="comment"># æœ€åæ”¯æŒå¤šå°‘ä¸ªç”¨æˆ·æ’é˜Ÿç­‰å¾…,æ˜¯ç”±listenä¸­çš„å‚æ•°å†³å®šçš„(è¿æ¥æ± )</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ç­‰å¾…å®¢æˆ·ç«¯çš„è¿æ¥(é˜»å¡å‡½æ•°)</span></span><br><span class="line">    <span class="comment"># step 4: æ¥å—å®¢æˆ·ç«¯çš„è¿æ¥</span></span><br><span class="line">    conn, addr = s.accept()</span><br><span class="line">    <span class="comment"># connå¯¹è±¡é‡Œå°è£…äº†è¿æ¥è¿‡æ¥çš„è¿™ä¸ªå®¢æˆ·ç«¯çš„é€šä¿¡çº¿è·¯ä¿¡æ¯</span></span><br><span class="line">    <span class="comment"># åæœŸè·Ÿè¿™ä¸ªå®¢æˆ·ç«¯çš„é€šä¿¡ä¸äº¤äº’éƒ½éœ€è¦åœ¨connè¿™æ¡é€šä¿¡çº¿è·¯ä¸Šè¿›è¡Œ</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line"></span><br><span class="line">        <span class="comment"># step 5: æ¥æ”¶æ¶ˆæ¯(åœ¨conné€šé“æ²¡æœ‰è¢«å…³é—­çš„æƒ…å†µä¸‹æ˜¯é˜»å¡çš„å‡½æ•°,ä¸€æ—¦connè¢«å®¢æˆ·ç«¯å…³é—­,è¯¥å‡½æ•°å°†ä¸ä¼šé˜»å¡)</span></span><br><span class="line">        recv_data = conn.recv(<span class="number">1024</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å¦‚æœconné€šé“è¢«å®¢æˆ·ç«¯ä¸»åŠ¨å…³é—­,recvå‡½æ•°å°†ä¸å†é˜»å¡,recv_dataå°†æ¥æ”¶åˆ°ç©ºå­—ç¬¦ä¸²</span></span><br><span class="line">        <span class="comment"># é€šè¿‡åˆ¤æ–­recv_dataä¸ºç©ºå­—ç¬¦ä¸²æ¥é€€å‡ºæœåŠ¡ç«¯çš„è¿æ¥</span></span><br><span class="line">        <span class="keyword">if</span> len(recv_data) == <span class="number">0</span>: <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># step 6:å¤„ç†æ¶ˆæ¯</span></span><br><span class="line">        cmd = str(recv_data, encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">        p = subprocess.Popen(cmd, shell=<span class="literal">True</span>, stdout=subprocess.PIPE)</span><br><span class="line">        res = p.stdout.read()</span><br><span class="line">        send_data = str(res, encoding=<span class="string">'utf-8'</span>)  <span class="comment"># utf-8 ---&gt; str ---&gt; utf-8</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># ------------ä¸å®¢æˆ·ç«¯æ²Ÿé€šæ•°æ®å¤§å°å¹¶å‘é€æ•°æ®çš„æµç¨‹------------</span></span><br><span class="line">        <span class="comment"># I. Server ---&gt; Client</span></span><br><span class="line">        <span class="comment"># ç”±äºå‘é€æ•°æ®æ—¶å¿…é¡»æ˜¯å­—èŠ‚ç±»å‹,æ‰€ä»¥è®¡ç®—é•¿åº¦æ—¶,åº”è¯¥å…ˆå°†å­—ç¬¦ä¸²è½¬ä¸ºå­—èŠ‚ç±»å‹å†è®¡ç®—é•¿åº¦</span></span><br><span class="line">        send_data = bytes(send_data, encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">        <span class="comment"># è®¡ç®—å­—èŠ‚é•¿åº¦,å› ä¸ºåé¢å‘é€ä¿¡æ¯çš„æ—¶å€™éœ€è¦åšå­—ç¬¦ä¸²æ‹¼æ¥,æ‰€ä»¥è¿™é‡Œå…ˆè½¬æˆå­—ç¬¦ç±»å‹</span></span><br><span class="line">        length_data = str(len(send_data))</span><br><span class="line">        <span class="comment"># é€šçŸ¥å®¢æˆ·ç«¯è¦è¦å‘é€æ•°æ®çš„æ€»é•¿åº¦</span></span><br><span class="line">        conn.send(bytes(<span class="string">'length_data:'</span>+length_data, encoding=<span class="string">'utf-8'</span>))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># III. Server &lt;--- Client</span></span><br><span class="line">        <span class="comment"># æ¥æ”¶å®¢æˆ·ç«¯å‘é€çš„ç¡®è®¤å¼€å§‹ä¼ è¾“çš„å‘½ä»¤</span></span><br><span class="line">        feedback = str(conn.recv(<span class="number">1024</span>), encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">        <span class="keyword">if</span> feedback == <span class="string">"confirm"</span>:</span><br><span class="line">            <span class="comment"># IV. Server ---&gt; Client</span></span><br><span class="line">            <span class="comment"># å¼€å§‹å‘å®¢æˆ·ç«¯ä¼ è¾“æ•°æ®</span></span><br><span class="line">            conn.send(send_data)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># step 7: å‘é€æ¶ˆæ¯</span></span><br><span class="line">        conn.send(send_data)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># step 8: æ–­å¼€è¿æ¥</span></span><br><span class="line">    conn.close()</span><br></pre></td></tr></table></figure>

<ul>
<li><font color="blue">client.py</font></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">ip_port = (<span class="string">'127.0.0.1'</span>, <span class="number">5556</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># step 1: åˆ›å»ºsocketå¥—æ¥å­—, é‡Œé¢å°è£…äº†é€šä¿¡åè®®</span></span><br><span class="line">s = socket.socket()</span><br><span class="line"></span><br><span class="line"><span class="comment"># step 2: è¿æ¥æœåŠ¡ç«¯</span></span><br><span class="line">s.connect(ip_port)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line"></span><br><span class="line">    <span class="comment"># step 3: å‘é€æ¶ˆæ¯</span></span><br><span class="line">    send_data = input(<span class="string">"&gt; "</span>).strip()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¦‚æœå®¢æˆ·ç«¯è¾“å…¥äº†exit,é€€å‡ºå¾ªç¯,ä¸»åŠ¨closeæ‰ä¸æœåŠ¡ç«¯çš„è¿æ¥</span></span><br><span class="line">    <span class="keyword">if</span> send_data == <span class="string">"exit"</span>: <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¦‚æœä»€ä¹ˆä¹Ÿæ²¡æœ‰è¾“å…¥,é‡æ–°å¾ªç¯æ¥æ”¶è¾“å…¥</span></span><br><span class="line">    <span class="keyword">if</span> len(send_data) == <span class="number">0</span>: <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># è¿™é‡Œæ³¨æ„,å’ŒæœåŠ¡ç«¯ä¸åŒçš„æ˜¯,æœåŠ¡ç«¯æ‰¾åˆ°å¯¹ç«¯æ˜¯é€šè¿‡connå¯¹è±¡,è€Œå®¢æˆ·ç«¯æ˜¯så¯¹è±¡</span></span><br><span class="line">    <span class="comment"># åœ¨Python3.xä¸­,socketå¯¹è±¡å‘é€å¯¹è±¡å¿…é¡»æ˜¯å­—èŠ‚ç±»å‹(2.7ä¸­å¯ä»¥æ˜¯å­—ç¬¦ä¸²)</span></span><br><span class="line">    s.send(bytes(send_data, encoding=<span class="string">'utf-8'</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># step 4: æ”¶æ¶ˆæ¯</span></span><br><span class="line">    <span class="comment"># ------------ä¸æœåŠ¡ç«¯æ²Ÿé€šæ•°æ®å¤§å°å¹¶å‘é€æ•°æ®çš„æµç¨‹------------</span></span><br><span class="line">    <span class="comment"># æœåŠ¡ç«¯é¦–å…ˆå‘æ¥çš„ä¿¡æ¯æ˜¯å³å°†å‘é€æ•°æ®çš„æ€»é•¿åº¦(å­—èŠ‚é•¿åº¦)</span></span><br><span class="line">    length_msg = str(s.recv(<span class="number">1024</span>), encoding=<span class="string">'utf-8'</span>)  <span class="comment"># æ¥æ”¶çš„æ ¼å¼ length_data:11024</span></span><br><span class="line">    <span class="keyword">if</span> length_msg.startswith(<span class="string">"length_data"</span>):</span><br><span class="line">        <span class="comment"># å–å¾—æœåŠ¡ç«¯ç»Ÿè®¡çš„æ•°æ®æ€»é•¿åº¦</span></span><br><span class="line">        length_data = int(length_msg.split(<span class="string">":"</span>)[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">    <span class="comment"># II. Server &lt;--- Client</span></span><br><span class="line">    <span class="comment"># å®¢æˆ·ç«¯å·²ç»æ¥æ”¶åˆ°æ•°æ®çš„æ€»é•¿åº¦,å›å¤æœåŠ¡ç«¯å¯ä»¥å‘é€æ•°æ®</span></span><br><span class="line">    s.send(bytes(<span class="string">"confirm"</span>, encoding=<span class="string">'utf8'</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># V. æ¥æ”¶æœåŠ¡ç«¯å‘é€è¿‡æ¥çš„æ•°æ®</span></span><br><span class="line">    <span class="comment"># ç´¯è®¡ä¸‹è½½å­—èŠ‚ç»Ÿè®¡</span></span><br><span class="line">    recv_total_size = <span class="number">0</span></span><br><span class="line">    <span class="comment"># ç´¯è®¡ä¸‹è½½æ•°æ®</span></span><br><span class="line">    recv_total_data = <span class="string">b''</span></span><br><span class="line">    <span class="comment"># è¿›å…¥å¾ªç¯ä¸‹è½½</span></span><br><span class="line">    <span class="keyword">while</span> recv_total_size &lt; length_data:</span><br><span class="line">        recv_data = s.recv(<span class="number">1024</span>)</span><br><span class="line">        recv_total_data += recv_data</span><br><span class="line">        recv_total_size += len(recv_data)</span><br><span class="line">        print(<span class="string">"ä¼ è¾“æ€»å¤§å°ä¸º: %s ; å½“å‰å·²ä¼ è¾“å¤§å°ä¸º: %s"</span> % (length_data, recv_total_size))</span><br><span class="line">    <span class="comment"># æ‰“å°å®Œæ•´çš„æ•°æ®</span></span><br><span class="line">    print(str(recv_total_data, encoding=<span class="string">'utf-8'</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># step 5: æ–­å¼€è¿æ¥</span></span><br><span class="line">s.close()</span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line">- &lt;font color="orange"&gt;æ‰§è¡Œç»“æœ&lt;/font&gt;</span><br><span class="line"></span><br><span class="line">```bash</span><br><span class="line">&gt; ifconfig</span><br><span class="line">ä¼ è¾“æ€»å¤§å°ä¸º: <span class="number">1857</span> ; å½“å‰å·²ä¼ è¾“å¤§å°ä¸º: <span class="number">1024</span></span><br><span class="line">ä¼ è¾“æ€»å¤§å°ä¸º: <span class="number">1857</span> ; å½“å‰å·²ä¼ è¾“å¤§å°ä¸º: <span class="number">2048</span></span><br><span class="line">lo0: flags=<span class="number">8049</span>&lt;UP,LOOPBACK,RUNNING,MULTICAST&gt; mtu <span class="number">16384</span></span><br><span class="line">	options=<span class="number">3</span>&lt;RXCSUM,TXCSUM&gt;</span><br><span class="line">	inet6 ::<span class="number">1</span> prefixlen <span class="number">128</span> </span><br><span class="line">	inet <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> netmask <span class="number">0xff000000</span> </span><br><span class="line">	inet6 fe80::<span class="number">1</span>%lo0 prefixlen <span class="number">64</span> scopeid <span class="number">0x1</span> </span><br><span class="line">	nd6 options=<span class="number">1</span>&lt;PERFORMNUD&gt;</span><br><span class="line">gif0: flags=<span class="number">8010</span>&lt;POINTOPOINT,MULTICAST&gt; mtu <span class="number">1280</span></span><br><span class="line">stf0: flags=<span class="number">0</span>&lt;&gt; mtu <span class="number">1280</span></span><br><span class="line">en0: flags=<span class="number">8863</span>&lt;UP,BROADCAST,SMART,RUNNING,SIMPLEX,MULTICAST&gt; mtu <span class="number">1500</span></span><br><span class="line">	ether <span class="number">60</span>:<span class="number">03</span>:<span class="number">08</span>:a5:<span class="number">3</span>b:<span class="number">9</span>e </span><br><span class="line">	inet6 fe80::<span class="number">6203</span>:<span class="number">8</span>ff:fea5:<span class="number">3</span>b9e%en0 prefixlen <span class="number">64</span> scopeid <span class="number">0x4</span> </span><br><span class="line">	inet <span class="number">192.168</span><span class="number">.1</span><span class="number">.103</span> netmask <span class="number">0xffffff00</span> broadcast <span class="number">192.168</span><span class="number">.1</span><span class="number">.255</span></span><br><span class="line">	nd6 options=<span class="number">1</span>&lt;PERFORMNUD&gt;</span><br><span class="line">	media: autoselect</span><br><span class="line">	status: active</span><br><span class="line">en1: flags=<span class="number">963</span>&lt;UP,BROADCAST,SMART,RUNNING,PROMISC,SIMPLEX&gt; mtu <span class="number">1500</span></span><br><span class="line">	options=<span class="number">60</span>&lt;TSO4,TSO6&gt;</span><br><span class="line">	ether <span class="number">72</span>:<span class="number">00</span>:<span class="number">01</span>:f7:dd:<span class="number">70</span> </span><br><span class="line">	media: autoselect &lt;full-duplex&gt;</span><br><span class="line">	status: inactive</span><br><span class="line">en2: flags=<span class="number">963</span>&lt;UP,BROADCAST,SMART,RUNNING,PROMISC,SIMPLEX&gt; mtu <span class="number">1500</span></span><br><span class="line">	options=<span class="number">60</span>&lt;TSO4,TSO6&gt;</span><br><span class="line">	ether <span class="number">72</span>:<span class="number">00</span>:<span class="number">01</span>:f7:dd:<span class="number">71</span> </span><br><span class="line">	media: autoselect &lt;full-duplex&gt;</span><br><span class="line">	status: inactive</span><br><span class="line">p2p0: flags=<span class="number">8843</span>&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; mtu <span class="number">2304</span></span><br><span class="line">	ether <span class="number">02</span>:<span class="number">03</span>:<span class="number">08</span>:a5:<span class="number">3</span>b:<span class="number">9</span>e </span><br><span class="line">	media: autoselect</span><br><span class="line">	status: inactive</span><br><span class="line">awdl0: flags=<span class="number">8943</span>&lt;UP,BROADCAST,RUNNING,PROMISC,SIMPLEX,MULTICAST&gt; mtu <span class="number">1484</span></span><br><span class="line">	ether <span class="number">0</span>e:<span class="number">80</span>:<span class="number">6</span>c:<span class="number">2</span>f:ac:<span class="number">25</span> </span><br><span class="line">	inet6 fe80::c80:<span class="number">6</span>cff:fe2f:ac25%awdl0 prefixlen <span class="number">64</span> scopeid <span class="number">0x8</span> </span><br><span class="line">	nd6 options=<span class="number">1</span>&lt;PERFORMNUD&gt;</span><br><span class="line">	media: autoselect</span><br><span class="line">	status: active</span><br><span class="line">bridge0: flags=<span class="number">8863</span>&lt;UP,BROADCAST,SMART,RUNNING,SIMPLEX,MULTICAST&gt; mtu <span class="number">1500</span></span><br><span class="line">	options=<span class="number">63</span>&lt;RXCSUM,TXCSUM,TSO4,TSO6&gt;</span><br><span class="line">	ether <span class="number">62</span>:<span class="number">03</span>:<span class="number">08</span>:<span class="number">5</span>a:<span class="number">2</span>d:<span class="number">00</span> </span><br><span class="line">	Configuration:</span><br><span class="line">		id <span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span> priority <span class="number">0</span> hellotime <span class="number">0</span> fwddelay <span class="number">0</span></span><br><span class="line">		maxage <span class="number">0</span> holdcnt <span class="number">0</span> proto stp maxaddr <span class="number">100</span> timeout <span class="number">1200</span></span><br><span class="line">		root id <span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span> priority <span class="number">0</span> ifcost <span class="number">0</span> port <span class="number">0</span></span><br><span class="line">		ipfilter disabled flags <span class="number">0x2</span></span><br><span class="line">	member: en1 flags=<span class="number">3</span>&lt;LEARNING,DISCOVER&gt;</span><br><span class="line">	        ifmaxaddr <span class="number">0</span> port <span class="number">5</span> priority <span class="number">0</span> path cost <span class="number">0</span></span><br><span class="line">	member: en2 flags=<span class="number">3</span>&lt;LEARNING,DISCOVER&gt;</span><br><span class="line">	        ifmaxaddr <span class="number">0</span> port <span class="number">6</span> priority <span class="number">0</span> path cost <span class="number">0</span></span><br><span class="line">	nd6 options=<span class="number">1</span>&lt;PERFORMNUD&gt;</span><br><span class="line">	media: &lt;unknown type&gt;</span><br><span class="line">	status: inactive</span><br><span class="line">lo0: flags=<span class="number">8049</span>&lt;UP,LOOPBACK,RUNNING,MULTICAST&gt; mtu <span class="number">16384</span></span><br><span class="line">	options=<span class="number">3</span>&lt;RXCSUM,TXCSUM&gt;</span><br><span class="line">	inet6 ::<span class="number">1</span> prefixlen <span class="number">128</span> </span><br><span class="line">	inet <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> netmask <span class="number">0xff000000</span> </span><br><span class="line">	inet6 fe80::<span class="number">1</span>%lo0 prefixlen <span class="number">64</span> scopeid <span class="number">0x1</span> </span><br><span class="line">	</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<hr>
<p>è§£å†³ç²˜åŒ…é—®é¢˜å®ä¾‹ï¼š</p>
<p><img src="http://oss.20150509.cn/20160710104159.png" alt=""></p>
<p><img src="http://oss.20150509.cn/20160710104259.png" alt=""></p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>ç½‘ç»œç¼–ç¨‹</tag>
        <tag>socket</tag>
        <tag>ç²˜åŒ…</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonç½‘ç»œç¼–ç¨‹ä¹‹ç®€å•SSHäº¤äº’</title>
    <url>/2016/07/08/Python%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E4%B9%8B%E7%AE%80%E5%8D%95SSH%E4%BA%A4%E4%BA%92/</url>
    <content><![CDATA[<ul>
<li><font color="red">server.py</font> </li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line">ip_port = (<span class="string">'127.0.0.1'</span>, <span class="number">5555</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># step 1: åˆ›å»ºsocketå¥—æ¥å­—, é‡Œé¢å°è£…äº†é€šä¿¡åè®®</span></span><br><span class="line">s = socket.socket()</span><br><span class="line"></span><br><span class="line"><span class="comment"># step 2: ç»‘å®šIPåŠç«¯å£å·</span></span><br><span class="line">s.bind(ip_port)</span><br><span class="line"></span><br><span class="line"><span class="comment"># step 3: ç›‘å¬ç»‘å®šçš„ç«¯å£</span></span><br><span class="line">s.listen(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŠŠæ¥æ”¶å®¢æˆ·ç«¯è¿æ¥è¯·æ±‚çš„æ“ä½œå¾ªç¯èµ·æ¥å°±å¯ä»¥æ¥å—å¤šä¸ªç”¨æˆ·çš„è¯·æ±‚å•¦</span></span><br><span class="line"><span class="comment"># æ³¨æ„:åŒä¸€æ—¶é—´åªèƒ½å¤„ç†ä¸€ä¸ªå®¢æˆ·ç«¯çš„è¯·æ±‚,å…¶ä»–è¿æ¥ä¸Šçš„ç”¨æˆ·ä¼šæ’é˜Ÿç­‰å¾…</span></span><br><span class="line"><span class="comment"># æœ€åæ”¯æŒå¤šå°‘ä¸ªç”¨æˆ·æ’é˜Ÿç­‰å¾…,æ˜¯ç”±listenä¸­çš„å‚æ•°å†³å®šçš„(è¿æ¥æ± )</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ç­‰å¾…å®¢æˆ·ç«¯çš„è¿æ¥(é˜»å¡å‡½æ•°)</span></span><br><span class="line">    <span class="comment"># step 4: æ¥å—å®¢æˆ·ç«¯çš„è¿æ¥</span></span><br><span class="line">    conn, addr = s.accept()</span><br><span class="line">    <span class="comment"># connå¯¹è±¡é‡Œå°è£…äº†è¿æ¥è¿‡æ¥çš„è¿™ä¸ªå®¢æˆ·ç«¯çš„é€šä¿¡çº¿è·¯ä¿¡æ¯</span></span><br><span class="line">    <span class="comment"># åæœŸè·Ÿè¿™ä¸ªå®¢æˆ·ç«¯çš„é€šä¿¡ä¸äº¤äº’éƒ½éœ€è¦åœ¨connè¿™æ¡é€šä¿¡çº¿è·¯ä¸Šè¿›è¡Œ</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line"></span><br><span class="line">        <span class="comment"># step 5: æ¥æ”¶æ¶ˆæ¯(åœ¨conné€šé“æ²¡æœ‰è¢«å…³é—­çš„æƒ…å†µä¸‹æ˜¯é˜»å¡çš„å‡½æ•°,ä¸€æ—¦connè¢«å®¢æˆ·ç«¯å…³é—­,è¯¥å‡½æ•°å°†ä¸ä¼šé˜»å¡)</span></span><br><span class="line">        recv_data = conn.recv(<span class="number">1024</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å¦‚æœconné€šé“è¢«å®¢æˆ·ç«¯ä¸»åŠ¨å…³é—­,recvå‡½æ•°å°†ä¸å†é˜»å¡,recv_dataå°†æ¥æ”¶åˆ°ç©ºå­—ç¬¦ä¸²</span></span><br><span class="line">        <span class="comment"># é€šè¿‡åˆ¤æ–­recv_dataä¸ºç©ºå­—ç¬¦ä¸²æ¥é€€å‡ºæœåŠ¡ç«¯çš„è¿æ¥</span></span><br><span class="line">        <span class="keyword">if</span> len(recv_data) == <span class="number">0</span>: <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># step 6:å¤„ç†æ¶ˆæ¯</span></span><br><span class="line">        cmd = str(recv_data, encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">        p = subprocess.Popen(cmd, shell=<span class="literal">True</span>, stdout=subprocess.PIPE)</span><br><span class="line">        res = p.stdout.read()</span><br><span class="line">        send_data = str(res, encoding=<span class="string">'utf-8'</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># step 7: å‘é€æ¶ˆæ¯</span></span><br><span class="line">        conn.send(bytes(send_data, encoding=<span class="string">'utf-8'</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># step 8: æ–­å¼€è¿æ¥</span></span><br><span class="line">    conn.close()</span><br></pre></td></tr></table></figure>

<p>æœåŠ¡ç«¯åœ¨æ¥æ”¶æ¶ˆæ¯ä¹‹åï¼Œæ‹¿åˆ°ç³»ç»Ÿä¸­å»æ‰§è¡Œï¼Œå–å›æ ‡å‡†è¾“å‡ºï¼Œè¿™é‡Œéœ€è¦ç‰¹åˆ«æ³¨æ„ä¸€ä¸‹å­—ç¬¦ç¼–ç çš„é—®é¢˜ã€‚</p>
<p>åœ¨ä¸åŒçš„ç³»ç»Ÿä¸­ï¼Œå­—ç¬¦ç¼–ç å¯èƒ½ä¸ä¸€æ ·ï¼Œå¦‚æœæ˜¯Windowså¹³å°ï¼Œå­—ç¬¦ç¼–ç å¯èƒ½æ˜¯<code>gbk</code>ï¼Œåœ¨linuxç³»ç»Ÿä¸­ï¼Œå­—ç¬¦ç¼–ç å¯èƒ½æ˜¯<code>GB18030``zh_CN.UTF-8</code>ç­‰ç­‰,åœ¨è¿™äº›ç³»ç»Ÿä¸­æ‰§è¡Œå®Œå‘½ä»¤åï¼Œå›æ˜¾çš„å­—ç¬¦ç¼–ç ä¸ç³»ç»Ÿæ˜¯ä¸€è‡´çš„ï¼Œæˆ‘ä»¬éœ€è¦æŠŠå›æ˜¾çš„å­—èŠ‚æŒ‰ç…§ç³»ç»Ÿçš„ç¼–ç ç±»å‹è¿›è¡Œç¼–ç å¹¶è½¬åŒ–æˆPythonçš„stringå­—ç¬¦ç±»å‹ï¼Œç”±Pythonçš„å­—ç¬¦ä¸²ä½œä¸ºä¸­é—´äººå»å¸®æˆ‘ä»¬åšè½¬æ¢</p>
<p>ç±»ä¼¼äºè¿™æ ·çš„è¿‡ç¨‹ <code>gbk ---&gt; str ---&gt; utf-8</code></p>
<ul>
<li><font color="blue">client.py</font> </li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">ip_port = (<span class="string">'127.0.0.1'</span>, <span class="number">5555</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># step 1: åˆ›å»ºsocketå¥—æ¥å­—, é‡Œé¢å°è£…äº†é€šä¿¡åè®®</span></span><br><span class="line">s = socket.socket()</span><br><span class="line"></span><br><span class="line"><span class="comment"># step 2: è¿æ¥æœåŠ¡ç«¯</span></span><br><span class="line">s.connect(ip_port)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line"></span><br><span class="line">    <span class="comment"># step 3: å‘é€æ¶ˆæ¯</span></span><br><span class="line">    send_data = input(<span class="string">"&gt; "</span>).strip()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¦‚æœå®¢æˆ·ç«¯è¾“å…¥äº†exit,é€€å‡ºå¾ªç¯,ä¸»åŠ¨closeæ‰ä¸æœåŠ¡ç«¯çš„è¿æ¥</span></span><br><span class="line">    <span class="keyword">if</span> send_data == <span class="string">"exit"</span>: <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¦‚æœä»€ä¹ˆä¹Ÿæ²¡æœ‰è¾“å…¥,é‡æ–°å¾ªç¯æ¥æ”¶è¾“å…¥</span></span><br><span class="line">    <span class="keyword">if</span> len(send_data) == <span class="number">0</span>: <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># è¿™é‡Œæ³¨æ„,å’ŒæœåŠ¡ç«¯ä¸åŒçš„æ˜¯,æœåŠ¡ç«¯æ‰¾åˆ°å¯¹ç«¯æ˜¯é€šè¿‡connå¯¹è±¡,è€Œå®¢æˆ·ç«¯æ˜¯så¯¹è±¡</span></span><br><span class="line">    <span class="comment"># åœ¨Python3.xä¸­,socketå¯¹è±¡å‘é€å¯¹è±¡å¿…é¡»æ˜¯å­—èŠ‚ç±»å‹(2.7ä¸­å¯ä»¥æ˜¯å­—ç¬¦ä¸²)</span></span><br><span class="line">    s.send(bytes(send_data, encoding=<span class="string">'utf-8'</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># step 4: æ”¶æ¶ˆæ¯</span></span><br><span class="line">    recv_data = s.recv(<span class="number">1024</span>)</span><br><span class="line">    print(str(recv_data, encoding=<span class="string">'utf-8'</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># step 5: æ–­å¼€è¿æ¥</span></span><br><span class="line">s.close()</span><br></pre></td></tr></table></figure>

<p>æç¤ºï¼šä¸Šé¢åªå¯¹å¯ä»¥æ­£ç¡®æ‰§è¡Œçš„ç³»ç»Ÿå‘½ä»¤åšäº†å¤„ç†ï¼Œå¦‚æœè¾“å…¥äº†ä¸€ä¸ªé”™è¯¯çš„å‘½ä»¤ï¼Œé‚£ä¹ˆstdoutæ ‡å‡†è¾“å‡ºæ ¹æœ¬ä¸ä¼šæ•æ‰åˆ°ï¼Œæ‰€ä»¥ä¼šå‡ºç°é—®é¢˜</p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>ç½‘ç»œç¼–ç¨‹</tag>
        <tag>socket</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonç½‘ç»œç¼–ç¨‹ä¹‹ç®€å•äº¤äº’</title>
    <url>/2016/07/07/Python%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E4%B9%8B%E7%AE%80%E5%8D%95%E4%BA%A4%E4%BA%92/</url>
    <content><![CDATA[<h1 id="ä¸ºå•ç”¨æˆ·æœåŠ¡"><a href="#ä¸ºå•ç”¨æˆ·æœåŠ¡" class="headerlink" title="ä¸ºå•ç”¨æˆ·æœåŠ¡"></a>ä¸ºå•ç”¨æˆ·æœåŠ¡</h1><ul>
<li><font color="red">server.py</font> </li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">ip_port = (<span class="string">'127.0.0.1'</span>, <span class="number">5555</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># step 1: åˆ›å»ºsocketå¥—æ¥å­—, é‡Œé¢å°è£…äº†é€šä¿¡åè®®</span></span><br><span class="line">s = socket.socket()</span><br><span class="line"></span><br><span class="line"><span class="comment"># step 2: ç»‘å®šIPåŠç«¯å£å·</span></span><br><span class="line">s.bind(ip_port)</span><br><span class="line"></span><br><span class="line"><span class="comment"># step 3: ç›‘å¬ç»‘å®šçš„ç«¯å£</span></span><br><span class="line">s.listen(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç­‰å¾…å®¢æˆ·ç«¯çš„è¿æ¥(é˜»å¡å‡½æ•°)</span></span><br><span class="line"><span class="comment"># step 4: æ¥å—å®¢æˆ·ç«¯çš„è¿æ¥</span></span><br><span class="line">conn, addr = s.accept()</span><br><span class="line"><span class="comment"># connå¯¹è±¡é‡Œå°è£…äº†è¿æ¥è¿‡æ¥çš„è¿™ä¸ªå®¢æˆ·ç«¯çš„é€šä¿¡çº¿è·¯ä¿¡æ¯</span></span><br><span class="line"><span class="comment"># åæœŸè·Ÿè¿™ä¸ªå®¢æˆ·ç«¯çš„é€šä¿¡ä¸äº¤äº’éƒ½éœ€è¦åœ¨connè¿™æ¡é€šä¿¡çº¿è·¯ä¸Šè¿›è¡Œ</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line"></span><br><span class="line">    <span class="comment"># step 5: æ¥æ”¶æ¶ˆæ¯(åœ¨conné€šé“æ²¡æœ‰è¢«å…³é—­çš„æƒ…å†µä¸‹æ˜¯é˜»å¡çš„å‡½æ•°,ä¸€æ—¦connè¢«å®¢æˆ·ç«¯å…³é—­,è¯¥å‡½æ•°å°†ä¸ä¼šé˜»å¡)</span></span><br><span class="line">    recv_data = conn.recv(<span class="number">1024</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¦‚æœconné€šé“è¢«å®¢æˆ·ç«¯ä¸»åŠ¨å…³é—­,recvå‡½æ•°å°†ä¸å†é˜»å¡,recv_dataå°†æ¥æ”¶åˆ°ç©ºå­—ç¬¦ä¸²</span></span><br><span class="line">    <span class="comment"># é€šè¿‡åˆ¤æ–­recv_dataä¸ºç©ºå­—ç¬¦ä¸²æ¥é€€å‡ºæœåŠ¡ç«¯çš„è¿æ¥</span></span><br><span class="line">    <span class="keyword">if</span> len(recv_data) == <span class="number">0</span>: <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># step 6: å‘é€æ¶ˆæ¯</span></span><br><span class="line">    send_data = recv_data.upper()</span><br><span class="line">    conn.send(send_data)</span><br><span class="line"></span><br><span class="line"><span class="comment"># step 7: æ–­å¼€è¿æ¥</span></span><br><span class="line">conn.close()</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªæœåŠ¡ç«¯åœ¨ä¸å®¢æˆ·ç«¯äº¤äº’ï¼ˆæ”¶å‘æ¶ˆæ¯ï¼‰çš„éƒ¨åˆ†ä½¿ç”¨äº†å¾ªç¯ï¼Œæ²¡æ¬¡æ¥æ”¶æ¶ˆæ¯ï¼Œå¤„ç†æ¶ˆæ¯ï¼Œå‘é€æ¶ˆæ¯ä¹‹åå°±è¿›å…¥åˆ°ä¸‹ä¸€æ¬¡å¾ªç¯ç­‰å¾…æ¥æ”¶æ¶ˆæ¯ã€‚</p>
<p>è¿™é‡Œéœ€è¦æ³¨æ„çš„ä¸€ç‚¹å°±æ˜¯connï¼ŒæœåŠ¡ç«¯çš„connå¯¹è±¡å¯¹åº”äº†å®¢æˆ·ç«¯çš„så¯¹è±¡ï¼Œéƒ½ä»£è¡¨äº†ä¸¤ç«¯ä¹‹é—´å»ºç«‹çš„è¿æ¥é€šé“ï¼Œä¸€æ—¦å®¢æˆ·ç«¯ä¸»åŠ¨å…³é—­è¿æ¥å¯¹è±¡sï¼Œåœ¨æœåŠ¡ç«¯å¯¹åº”çš„connå¯¹è±¡å°†ç«‹å³å¤±æ•ˆï¼Œéšå³é€€å‡ºå¾ªå…³é—­æœåŠ¡ç«¯æŒæœ‰çš„è¿æ¥å¯¹è±¡ã€‚</p>
<p>æ­¤æ—¶conn.recv()å‡½æ•°ä¸å†æ˜¯ä¸€ä¸ªé˜»å¡çš„çŠ¶æ€ï¼Œå®ƒå°†è¿”å›ç©ºå€¼ã€‚æˆ‘ä»¬éœ€è¦å¯¹æ¥æ”¶è¿™ä¸ªç©ºå€¼çš„å¯¹è±¡ï¼ˆå˜é‡ï¼‰åšå‡ºç›¸åº”çš„å¤„ç†ï¼Œå…³é—­æ‰æœåŠ¡ç«¯æŒæœ‰çš„è¿æ¥å¯¹è±¡</p>
<ul>
<li><font color="blue">client.py</font></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">ip_port = (<span class="string">'127.0.0.1'</span>, <span class="number">5555</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># step 1: åˆ›å»ºsocketå¥—æ¥å­—, é‡Œé¢å°è£…äº†é€šä¿¡åè®®</span></span><br><span class="line">s = socket.socket()</span><br><span class="line"></span><br><span class="line"><span class="comment"># step 2: è¿æ¥æœåŠ¡ç«¯</span></span><br><span class="line">s.connect(ip_port)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line"></span><br><span class="line">    <span class="comment"># step 3: å‘é€æ¶ˆæ¯</span></span><br><span class="line">    send_data = input(<span class="string">"&gt; "</span>).strip()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¦‚æœå®¢æˆ·ç«¯è¾“å…¥äº†exit,é€€å‡ºå¾ªç¯,ä¸»åŠ¨closeæ‰ä¸æœåŠ¡ç«¯çš„è¿æ¥</span></span><br><span class="line">    <span class="keyword">if</span> send_data == <span class="string">"exit"</span>: <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¦‚æœä»€ä¹ˆä¹Ÿæ²¡æœ‰è¾“å…¥,é‡æ–°å¾ªç¯æ¥æ”¶è¾“å…¥</span></span><br><span class="line">    <span class="keyword">if</span> len(send_data) == <span class="number">0</span>: <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># è¿™é‡Œæ³¨æ„,å’ŒæœåŠ¡ç«¯ä¸åŒçš„æ˜¯,æœåŠ¡ç«¯æ‰¾åˆ°å¯¹ç«¯æ˜¯é€šè¿‡connå¯¹è±¡,è€Œå®¢æˆ·ç«¯æ˜¯så¯¹è±¡</span></span><br><span class="line">    <span class="comment"># åœ¨Python3.xä¸­,socketå¯¹è±¡å‘é€å¯¹è±¡å¿…é¡»æ˜¯å­—èŠ‚ç±»å‹(2.7ä¸­å¯ä»¥æ˜¯å­—ç¬¦ä¸²)</span></span><br><span class="line">    s.send(bytes(send_data, encoding=<span class="string">'utf-8'</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># step 4: æ”¶æ¶ˆæ¯</span></span><br><span class="line">    recv_data = s.recv(<span class="number">1024</span>)</span><br><span class="line">    print(recv_data, <span class="string">"---&gt;"</span>, type(recv_data), str(recv_data, encoding=<span class="string">'utf-8'</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># step 5: æ–­å¼€è¿æ¥</span></span><br><span class="line">s.close()</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªç‰ˆæœ¬å®ç°äº†æœåŠ¡ç«¯ä¸ºå•ä¸ªç”¨æˆ·æä¾›æœåŠ¡çš„åœºæ™¯ã€‚</p>
<p>ä»ä¸Šé¢çš„è¯´æ˜ä¸­ä¹Ÿå¯ä»¥çœ‹å‡ºï¼ŒæœåŠ¡ç«¯åœ¨æ¥æ”¶åˆ°å®¢æˆ·ç«¯ä¸»åŠ¨å…³é—­çš„æ“ä½œåï¼ˆç‰¹å¾ä¸ºï¼šconn.recvè¿”å›å€¼ä¸ºç©ºï¼‰ï¼Œç›¸ç»§å…³é—­æœåŠ¡ç«¯æŒæœ‰çš„è¿æ¥å¯¹è±¡ï¼Œæ¥ç€ä»£ç å°±åœæ­¢äº†ã€‚</p>
<p><em>è¿™é‡Œéœ€è¦ç‰¹åˆ«æ³¨æ„çš„å°±æ˜¯å¤„ç†å®¢æˆ·ç«¯è¾“å…¥ä¸ºç©ºçš„æƒ…å†µï¼Œå› ä¸ºæœåŠ¡ç«¯åˆ¤æ–­å®¢æˆ·ç«¯æ˜¯å¦ä¸»åŠ¨æ–­å¼€ï¼Œä¸»è¦ä¾æ®çš„å°±æ˜¯conn.recvæ–¹æ³•çš„è¿”å›å€¼æ˜¯å¦ä¸ºç©ºï¼Œæ‰€ä»¥æˆ‘ä»¬è¦å±è”½æ‰ç”¨æˆ·è¾“å…¥ä¸ºç©ºçš„æƒ…å†µ</em></p>
<h1 id="ä¸ºå¤šç”¨æˆ·æœåŠ¡ï¼ˆæ’é˜Ÿï¼‰"><a href="#ä¸ºå¤šç”¨æˆ·æœåŠ¡ï¼ˆæ’é˜Ÿï¼‰" class="headerlink" title="ä¸ºå¤šç”¨æˆ·æœåŠ¡ï¼ˆæ’é˜Ÿï¼‰"></a>ä¸ºå¤šç”¨æˆ·æœåŠ¡ï¼ˆæ’é˜Ÿï¼‰</h1><ul>
<li><font color="red">server.py</font> </li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">ip_port = (<span class="string">'127.0.0.1'</span>, <span class="number">5555</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># step 1: åˆ›å»ºsocketå¥—æ¥å­—, é‡Œé¢å°è£…äº†é€šä¿¡åè®®</span></span><br><span class="line">s = socket.socket()</span><br><span class="line"></span><br><span class="line"><span class="comment"># step 2: ç»‘å®šIPåŠç«¯å£å·</span></span><br><span class="line">s.bind(ip_port)</span><br><span class="line"></span><br><span class="line"><span class="comment"># step 3: ç›‘å¬ç»‘å®šçš„ç«¯å£</span></span><br><span class="line">s.listen(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŠŠæ¥æ”¶å®¢æˆ·ç«¯è¿æ¥è¯·æ±‚çš„æ“ä½œå¾ªç¯èµ·æ¥å°±å¯ä»¥æ¥å—å¤šä¸ªç”¨æˆ·çš„è¯·æ±‚å•¦</span></span><br><span class="line"><span class="comment"># æ³¨æ„:åŒä¸€æ—¶é—´åªèƒ½å¤„ç†ä¸€ä¸ªå®¢æˆ·ç«¯çš„è¯·æ±‚,å…¶ä»–è¿æ¥ä¸Šçš„ç”¨æˆ·ä¼šæ’é˜Ÿç­‰å¾…</span></span><br><span class="line"><span class="comment"># æœ€åæ”¯æŒå¤šå°‘ä¸ªç”¨æˆ·æ’é˜Ÿç­‰å¾…,æ˜¯ç”±listenä¸­çš„å‚æ•°å†³å®šçš„(è¿æ¥æ± )</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ç­‰å¾…å®¢æˆ·ç«¯çš„è¿æ¥(é˜»å¡å‡½æ•°)</span></span><br><span class="line">    <span class="comment"># step 4: æ¥å—å®¢æˆ·ç«¯çš„è¿æ¥</span></span><br><span class="line">    conn, addr = s.accept()</span><br><span class="line">    <span class="comment"># connå¯¹è±¡é‡Œå°è£…äº†è¿æ¥è¿‡æ¥çš„è¿™ä¸ªå®¢æˆ·ç«¯çš„é€šä¿¡çº¿è·¯ä¿¡æ¯</span></span><br><span class="line">    <span class="comment"># åæœŸè·Ÿè¿™ä¸ªå®¢æˆ·ç«¯çš„é€šä¿¡ä¸äº¤äº’éƒ½éœ€è¦åœ¨connè¿™æ¡é€šä¿¡çº¿è·¯ä¸Šè¿›è¡Œ</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line"></span><br><span class="line">        <span class="comment"># step 5: æ¥æ”¶æ¶ˆæ¯(åœ¨conné€šé“æ²¡æœ‰è¢«å…³é—­çš„æƒ…å†µä¸‹æ˜¯é˜»å¡çš„å‡½æ•°,ä¸€æ—¦connè¢«å®¢æˆ·ç«¯å…³é—­,è¯¥å‡½æ•°å°†ä¸ä¼šé˜»å¡)</span></span><br><span class="line">        recv_data = conn.recv(<span class="number">1024</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å¦‚æœconné€šé“è¢«å®¢æˆ·ç«¯ä¸»åŠ¨å…³é—­,recvå‡½æ•°å°†ä¸å†é˜»å¡,recv_dataå°†æ¥æ”¶åˆ°ç©ºå­—ç¬¦ä¸²</span></span><br><span class="line">        <span class="comment"># é€šè¿‡åˆ¤æ–­recv_dataä¸ºç©ºå­—ç¬¦ä¸²æ¥é€€å‡ºæœåŠ¡ç«¯çš„è¿æ¥</span></span><br><span class="line">        <span class="keyword">if</span> len(recv_data) == <span class="number">0</span>: <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># step 6: å‘é€æ¶ˆæ¯</span></span><br><span class="line">        send_data = recv_data.upper()</span><br><span class="line">        conn.send(send_data)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># step 7: æ–­å¼€è¿æ¥</span></span><br><span class="line">    conn.close()</span><br></pre></td></tr></table></figure>

<p>æœåŠ¡ç«¯çš„ä»£ç åªå¢åŠ äº†ä¸€ä¸ªwhileå¾ªç¯ï¼Œä¸Šä¸€ä¸ªä»£ç ç‰ˆæœ¬ä¸­ï¼ŒæœåŠ¡ç«¯å”¯ä¸€çš„å¾ªç¯æ”¾åœ¨äº†å¤„ç†æŸä¸€å®¢æˆ·ç«¯çš„è¯·æ±‚ä¸Šã€‚æ­¤æ¬¡åŠ ä¸Šçš„å¾ªç¯ï¼Œæ”¾åœ¨äº†æ¥æ”¶ç”¨æˆ·è¿æ¥è¯·æ±‚ä¸Šï¼Œå¯ä»¥åœ¨<code>å…³é—­ä¸Šä¸€ä¸ªè¿æ¥ä¹‹å</code>ï¼Œå¾ªç¯çš„å¤„ç†ä¸‹ä¸€ä¸ªè¿æ¥è¯·æ±‚</p>
<ul>
<li><font color="blue">client.py</font> å®¢æˆ·ç«¯çš„ä»£ç æ²¡æœ‰ä»»ä½•ä¿®æ”¹</li>
</ul>
<p>æ­¤æ—¶ï¼Œè¿ç»­çš„è¿è¡Œä¸¤ä¸ªå®¢æˆ·ç«¯ï¼Œå‘ç°ä¸¤ä¸ªå®¢æˆ·ç«¯éƒ½å¯ä»¥è¿æ¥åˆ°æœåŠ¡ç«¯ï¼Œä½†æ˜¯ä¸€ä¸ªå¯æ–­ç«¯å‘å‡ºè¯·æ±‚åï¼Œåœ¨ç¬¬ä¸€ä¸ªå®¢æˆ·ç«¯ä¸å…³é—­è¿æ¥çš„æƒ…å†µä¸‹ï¼Œç¬¬äºŒä¸ªå®¢æˆ·ç«¯å‘å‡ºçš„è¯·æ±‚ä¸€ç›´å¡åœ¨ç»ˆç«¯ä¸­ã€‚åªæœ‰ç¬¬ä¸€ä¸ªå®¢æˆ·ç«¯å…³é—­è¿æ¥ï¼Œè§¦å‘æœåŠ¡ç«¯å…³é—­å¯¹ç¬¬ä¸€ä¸ªå®¢æˆ·ç«¯çš„è¿æ¥ä¹‹åï¼Œæ‰ä¼šå»æ¥æ”¶ç¬¬äºŒä¸ªå®¢æˆ·ç«¯å‘æ¥çš„ä¿¡æ¯</p>
<p>è¿™é‡Œç‰¹åˆ«æç¤ºä¸€ä¸‹ï¼Œå½“ä¸¤ä¸ªå®¢æˆ·ç«¯ç›¸ç»§è¿æ¥ä¸ŠæœåŠ¡ç«¯åï¼Œçœ‹ä¼¼æœåŠ¡ç«¯å¯¹ä¸¤ä¸ªè¿æ¥éƒ½æ¥å—äº†è¯·æ±‚ï¼Œä½†æ˜¯ï¼Œåªæœ‰ç¬¬ä¸€ä¸ªè¿æ¥è¿‡æ¥çš„å®¢æˆ·ç«¯æ‰è¿›å…¥åˆ°äº†æœåŠ¡ç«¯ä»£ç ä¸­çš„å†…å±‚whileå¾ªç¯ä½“ï¼Œæ­¤æ—¶å³ä½¿ç¬¬ä¸€ä¸ªå®¢æˆ·ç«¯æ²¡æœ‰å‘é€ä¿¡æ¯ï¼Œç¬¬äºŒä¸ªå®¢æˆ·ç«¯å…ˆç»™æœåŠ¡ç«¯å‘é€ä¿¡æ¯ï¼Œç»ˆç«¯ä¹Ÿæ˜¯ä¼šé˜»å¡ä½çš„</p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>ç½‘ç»œç¼–ç¨‹</tag>
        <tag>socket</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonç½‘ç»œç¼–ç¨‹ä¹‹socketå¸¸ç”¨æ–¹æ³•ç®€ä»‹</title>
    <url>/2016/07/06/Python%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E4%B9%8Bsocket%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95%E7%AE%80%E4%BB%8B/</url>
    <content><![CDATA[<h1 id="sk-socket-socket-socket-AF-INET-socket-SOCK-STREAM-0"><a href="#sk-socket-socket-socket-AF-INET-socket-SOCK-STREAM-0" class="headerlink" title="sk = socket.socket(socket.AF_INET,socket.SOCK_STREAM,0)"></a>sk = socket.socket(socket.AF_INET,socket.SOCK_STREAM,0)</h1><ul>
<li><p>å‚æ•°ä¸€ï¼šåœ°å€ç°‡</p>
<ul>
<li>socket.AF_INET IPv4ï¼ˆé»˜è®¤ï¼‰</li>
<li>socket.AF_INET6 IPv6</li>
<li>socket.AF_UNIX åªèƒ½å¤Ÿç”¨äºå•ä¸€çš„Unixç³»ç»Ÿè¿›ç¨‹é—´é€šä¿¡</li>
</ul>
</li>
<li><p>å‚æ•°äºŒï¼šç±»å‹</p>
<ul>
<li><p>socket.SOCK_STREAMã€€ã€€æµå¼socket , for TCP ï¼ˆé»˜è®¤ï¼‰</p>
</li>
<li><p>socket.SOCK_DGRAMã€€ã€€ æ•°æ®æŠ¥å¼socket , for UDP</p>
</li>
<li><p>socket.SOCK_RAW åŸå§‹å¥—æ¥å­—ï¼Œæ™®é€šçš„å¥—æ¥å­—æ— æ³•å¤„ç†ICMPã€IGMPç­‰ç½‘ç»œæŠ¥æ–‡ï¼Œè€ŒSOCK_RAWå¯ä»¥ï¼›å…¶æ¬¡ï¼ŒSOCK_RAWä¹Ÿå¯ä»¥å¤„ç†ç‰¹æ®Šçš„IPv4æŠ¥æ–‡ï¼›æ­¤å¤–ï¼Œåˆ©ç”¨åŸå§‹å¥—æ¥å­—ï¼Œå¯ä»¥é€šè¿‡IP_HDRINCLå¥—æ¥å­—é€‰é¡¹ç”±ç”¨æˆ·æ„é€ IPå¤´ã€‚</p>
</li>
<li><p>socket.SOCK_RDM æ˜¯ä¸€ç§å¯é çš„UDPå½¢å¼ï¼Œå³ä¿è¯äº¤ä»˜æ•°æ®æŠ¥ä½†ä¸ä¿è¯é¡ºåºã€‚SOCK_RAMç”¨æ¥æä¾›å¯¹åŸå§‹åè®®çš„ä½çº§è®¿é—®ï¼Œåœ¨éœ€è¦æ‰§è¡ŒæŸäº›ç‰¹æ®Šæ“ä½œæ—¶ä½¿ç”¨ï¼Œå¦‚å‘é€ICMPæŠ¥æ–‡ã€‚SOCK_RAMé€šå¸¸ä»…é™äºé«˜çº§ç”¨æˆ·æˆ–ç®¡ç†å‘˜è¿è¡Œçš„ç¨‹åºä½¿ç”¨ã€‚</p>
</li>
<li><p>socket.SOCK_SEQPACKET å¯é çš„è¿ç»­æ•°æ®åŒ…æœåŠ¡</p>
</li>
</ul>
</li>
<li><p>å‚æ•°ä¸‰ï¼šåè®®</p>
<ul>
<li>0ã€€ã€€ï¼ˆé»˜è®¤ï¼‰ä¸ç‰¹å®šçš„åœ°å€å®¶æ—ç›¸å…³çš„åè®®,å¦‚æœæ˜¯ 0 ï¼Œåˆ™ç³»ç»Ÿå°±ä¼šæ ¹æ®åœ°å€æ ¼å¼å’Œå¥—æ¥ç±»åˆ«,è‡ªåŠ¨é€‰æ‹©ä¸€ä¸ªåˆé€‚çš„åè®®</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># UDPå®ä¾‹</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line">ip_port = (<span class="string">'127.0.0.1'</span>,<span class="number">9999</span>)</span><br><span class="line">sk = socket.socket(socket.AF_INET,socket.SOCK_DGRAM,<span class="number">0</span>)</span><br><span class="line">sk.bind(ip_port)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    data = sk.recv(<span class="number">1024</span>)</span><br><span class="line">    <span class="keyword">print</span> data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line">ip_port = (<span class="string">'127.0.0.1'</span>,<span class="number">9999</span>)</span><br><span class="line"></span><br><span class="line">sk = socket.socket(socket.AF_INET,socket.SOCK_DGRAM,<span class="number">0</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    inp = raw_input(<span class="string">'æ•°æ®ï¼š'</span>).strip()</span><br><span class="line">    <span class="keyword">if</span> inp == <span class="string">'exit'</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    sk.sendto(inp,ip_port)</span><br><span class="line"></span><br><span class="line">sk.close()</span><br></pre></td></tr></table></figure>

<h1 id="sk-bind-address"><a href="#sk-bind-address" class="headerlink" title="sk.bind(address)"></a>sk.bind(address)</h1><p>å°†å¥—æ¥å­—ç»‘å®šåˆ°åœ°å€ã€‚addressåœ°å€çš„æ ¼å¼å–å†³äºåœ°å€æ—ã€‚åœ¨AF_INETä¸‹ï¼Œä»¥å…ƒç»„ï¼ˆhost,portï¼‰çš„å½¢å¼è¡¨ç¤ºåœ°å€ã€‚</p>
<h1 id="sk-listen-backlog"><a href="#sk-listen-backlog" class="headerlink" title="sk.listen(backlog)"></a>sk.listen(backlog)</h1><p>å¼€å§‹ç›‘å¬ä¼ å…¥è¿æ¥ã€‚backlogæŒ‡å®šåœ¨æ‹’ç»è¿æ¥ä¹‹å‰ï¼Œå¯ä»¥æŒ‚èµ·çš„æœ€å¤§è¿æ¥æ•°é‡ã€‚</p>
<p>backlogç­‰äº5ï¼Œè¡¨ç¤ºå†…æ ¸å·²ç»æ¥åˆ°äº†è¿æ¥è¯·æ±‚ï¼Œä½†æœåŠ¡å™¨è¿˜æ²¡æœ‰è°ƒç”¨acceptè¿›è¡Œå¤„ç†çš„è¿æ¥ä¸ªæ•°æœ€å¤§ä¸º5</p>
<p>è¿™ä¸ªå€¼ä¸èƒ½æ— é™å¤§ï¼Œå› ä¸ºè¦åœ¨å†…æ ¸ä¸­ç»´æŠ¤è¿æ¥é˜Ÿåˆ—</p>
<h1 id="sk-setblocking-bool"><a href="#sk-setblocking-bool" class="headerlink" title="sk.setblocking(bool)"></a>sk.setblocking(bool)</h1><p>æ˜¯å¦é˜»å¡ï¼ˆé»˜è®¤Trueï¼‰ï¼Œå¦‚æœè®¾ç½®Falseï¼Œé‚£ä¹ˆacceptå’Œrecvæ—¶ä¸€æ—¦æ— æ•°æ®ï¼Œåˆ™æŠ¥é”™ã€‚</p>
<h1 id="sk-accept"><a href="#sk-accept" class="headerlink" title="sk.accept()"></a>sk.accept()</h1><p>æ¥å—è¿æ¥å¹¶è¿”å›ï¼ˆconn,addressï¼‰,å…¶ä¸­connæ˜¯æ–°çš„å¥—æ¥å­—å¯¹è±¡ï¼Œå¯ä»¥ç”¨æ¥æ¥æ”¶å’Œå‘é€æ•°æ®ã€‚addressæ˜¯è¿æ¥å®¢æˆ·ç«¯çš„åœ°å€ã€‚</p>
<p>æ¥æ”¶TCP å®¢æˆ·çš„è¿æ¥ï¼ˆé˜»å¡å¼ï¼‰ç­‰å¾…è¿æ¥çš„åˆ°æ¥</p>
<h1 id="sk-connect-address"><a href="#sk-connect-address" class="headerlink" title="sk.connect(address)"></a>sk.connect(address)</h1><p>è¿æ¥åˆ°addresså¤„çš„å¥—æ¥å­—ã€‚ä¸€èˆ¬ï¼Œaddressçš„æ ¼å¼ä¸ºå…ƒç»„ï¼ˆhostname,portï¼‰,å¦‚æœè¿æ¥å‡ºé”™ï¼Œè¿”å›socket.erroré”™è¯¯ã€‚</p>
<h1 id="sk-connect-ex-address"><a href="#sk-connect-ex-address" class="headerlink" title="sk.connect_ex(address)"></a>sk.connect_ex(address)</h1><p>åŒä¸Šï¼Œåªä¸è¿‡ä¼šæœ‰è¿”å›å€¼ï¼Œè¿æ¥æˆåŠŸæ—¶è¿”å› 0 ï¼Œè¿æ¥å¤±è´¥æ—¶å€™è¿”å›ç¼–ç ï¼Œä¾‹å¦‚ï¼š10061</p>
<h1 id="sk-close"><a href="#sk-close" class="headerlink" title="sk.close()"></a>sk.close()</h1><p>å…³é—­å¥—æ¥å­—</p>
<h1 id="sk-recv-bufsize-flag"><a href="#sk-recv-bufsize-flag" class="headerlink" title="sk.recv(bufsize[,flag])"></a>sk.recv(bufsize[,flag])</h1><p>æ¥å—å¥—æ¥å­—çš„æ•°æ®ã€‚æ•°æ®ä»¥å­—ç¬¦ä¸²å½¢å¼è¿”å›ï¼ŒbufsizeæŒ‡å®šæœ€å¤šå¯ä»¥æ¥æ”¶çš„æ•°é‡ã€‚flagæä¾›æœ‰å…³æ¶ˆæ¯çš„å…¶ä»–ä¿¡æ¯ï¼Œé€šå¸¸å¯ä»¥å¿½ç•¥ã€‚</p>
<h1 id="sk-recvfrom-bufsize-flag"><a href="#sk-recvfrom-bufsize-flag" class="headerlink" title="sk.recvfrom(bufsize[.flag])"></a>sk.recvfrom(bufsize[.flag])</h1><p>ä¸recv()ç±»ä¼¼ï¼Œä½†è¿”å›å€¼æ˜¯ï¼ˆdata,addressï¼‰ã€‚å…¶ä¸­dataæ˜¯åŒ…å«æ¥æ”¶æ•°æ®çš„å­—ç¬¦ä¸²ï¼Œaddressæ˜¯å‘é€æ•°æ®çš„å¥—æ¥å­—åœ°å€ã€‚</p>
<h1 id="sk-send-byte-string-flag"><a href="#sk-send-byte-string-flag" class="headerlink" title="sk.send(byte(string)[,flag])"></a>sk.send(byte(string)[,flag])</h1><p>å°†stringä¸­çš„æ•°æ®å‘é€åˆ°è¿æ¥çš„å¥—æ¥å­—ã€‚è¿”å›å€¼æ˜¯è¦å‘é€çš„å­—èŠ‚æ•°é‡ï¼Œè¯¥æ•°é‡å¯èƒ½å°äºstringçš„å­—èŠ‚å¤§å°ã€‚å³ï¼šå¯èƒ½æœªå°†æŒ‡å®šå†…å®¹å…¨éƒ¨å‘é€ã€‚</p>
<p>æ³¨æ„ï¼Œåœ¨Python2.xä¸­å¯ä»¥å‘é€stringï¼Œä½†æ˜¯åœ¨3.xä¸­ï¼Œå‘é€çš„å†…å®¹å¿…é¡»æ˜¯å­—èŠ‚ç±»å‹ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨byte()å†…ç½®å‡½æ•°æ¥è½¬æ¢ä¸€ä¸‹</p>
<h1 id="sk-sendall-byte-string-flag"><a href="#sk-sendall-byte-string-flag" class="headerlink" title="sk.sendall(byte(string)[,flag])"></a>sk.sendall(byte(string)[,flag])</h1><p>å°†stringä¸­çš„æ•°æ®å‘é€åˆ°è¿æ¥çš„å¥—æ¥å­—ï¼Œä½†åœ¨è¿”å›ä¹‹å‰ä¼šå°è¯•å‘é€æ‰€æœ‰æ•°æ®ã€‚æˆåŠŸè¿”å›Noneï¼Œå¤±è´¥åˆ™æŠ›å‡ºå¼‚å¸¸</p>
<p>å†…éƒ¨é€šè¿‡é€’å½’è°ƒç”¨sendï¼Œå°†æ‰€æœ‰å†…å®¹å‘é€å‡ºå»</p>
<h1 id="sk-sendto-byte-string-flag-address"><a href="#sk-sendto-byte-string-flag-address" class="headerlink" title="sk.sendto(byte(string)[,flag],address)"></a>sk.sendto(byte(string)[,flag],address)</h1><p>å°†æ•°æ®å‘é€åˆ°å¥—æ¥å­—ï¼Œaddressæ˜¯å½¢å¼ä¸ºï¼ˆipaddrï¼Œportï¼‰çš„å…ƒç»„ï¼ŒæŒ‡å®šè¿œç¨‹åœ°å€ã€‚è¿”å›å€¼æ˜¯å‘é€çš„å­—èŠ‚æ•°ã€‚è¯¥å‡½æ•°ä¸»è¦ç”¨äºUDPåè®®</p>
<h1 id="sk-settimeout-timeout"><a href="#sk-settimeout-timeout" class="headerlink" title="sk.settimeout(timeout)"></a>sk.settimeout(timeout)</h1><p>è®¾ç½®å¥—æ¥å­—æ“ä½œçš„è¶…æ—¶æœŸï¼Œtimeoutæ˜¯ä¸€ä¸ªæµ®ç‚¹æ•°ï¼Œå•ä½æ˜¯ç§’ã€‚å€¼ä¸ºNoneè¡¨ç¤ºæ²¡æœ‰è¶…æ—¶æœŸã€‚ä¸€èˆ¬ï¼Œè¶…æ—¶æœŸåº”è¯¥åœ¨åˆšåˆ›å»ºå¥—æ¥å­—æ—¶è®¾ç½®ï¼Œå› ä¸ºå®ƒä»¬å¯èƒ½ç”¨äºè¿æ¥çš„æ“ä½œï¼ˆå¦‚ client è¿æ¥æœ€å¤šç­‰å¾…5s ï¼‰</p>
<p>ä¸»è¦ç”¨äºå®¢æˆ·ç«¯</p>
<h1 id="sk-getpeername"><a href="#sk-getpeername" class="headerlink" title="sk.getpeername()"></a>sk.getpeername()</h1><p>è¿”å›è¿æ¥å¥—æ¥å­—çš„è¿œç¨‹åœ°å€ã€‚è¿”å›å€¼é€šå¸¸æ˜¯å…ƒç»„ï¼ˆipaddr,portï¼‰</p>
<p>ä¸»è¦ç”¨äºå®¢æˆ·ç«¯ï¼Œè·å–æœåŠ¡å™¨çš„IPåœ°å€åŠç«¯å£å·</p>
<h1 id="sk-getsockname"><a href="#sk-getsockname" class="headerlink" title="sk.getsockname()"></a>sk.getsockname()</h1><p>è¿”å›å¥—æ¥å­—è‡ªå·±çš„åœ°å€ã€‚é€šå¸¸æ˜¯ä¸€ä¸ªå…ƒç»„(ipaddr,port)</p>
<p>ä¸»è¦ç”¨äºæœåŠ¡ç«¯ï¼Œè·å–è‡ªå·±ç›‘å¬IPå’Œç«¯å£çš„ä¿¡æ¯</p>
<h1 id="sk-fileno"><a href="#sk-fileno" class="headerlink" title="sk.fileno()"></a>sk.fileno()</h1><p>å¥—æ¥å­—çš„æ–‡ä»¶æè¿°ç¬¦</p>
<p>åœ¨IOå¤šè·¯å¤ç”¨çš„æ—¶å€™ä¼šç”¨åˆ°</p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>ç½‘ç»œç¼–ç¨‹</tag>
        <tag>socket</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonç½‘ç»œç¼–ç¨‹ä¹‹socketåŸºç¡€è¯­æ³•</title>
    <url>/2016/07/06/Python%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E4%B9%8Bsocket%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/</url>
    <content><![CDATA[<blockquote>
<p>TCP/IPåè®®æ˜¯ä¸€é—¨éå¸¸å¤è€çš„åè®®ï¼Œæˆ‘ä»¬åœ¨ç½‘ç»œç¼–ç¨‹çš„æ—¶å€™ï¼Œä¸å¯èƒ½èŠ±å‡ ä¸ªæœˆæ—¶å€™å»ç ”ç©¶TCP/IPåè®®ï¼Œsocketå°±æ˜¯ç½‘ç»œç¼–ç¨‹çš„æ•‘æ˜Ÿï¼Œç”±socketæ¥æä¾›ä¸€ç³»åˆ—ç¬¦åˆTCP/IPåè®®çš„æ¥å£ï¼Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºåªéœ€è¦ä¸socketäº¤äº’ï¼Œå³å¯å®ç°é€šè¿‡TCP/IPåè®®åœ¨ç½‘ç»œä¸­æ”¶å‘æ•°æ®ã€‚éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼ŒsocketæŠ½è±¡å±‚æœ¬èº«ä¸è´Ÿè´£æ”¶å‘æ•°æ®ï¼Œæ•°æ®æ”¶å‘ä»ç„¶æ˜¯ä¾èµ–å››å±‚æ¨¡å‹ä¸­çš„ä¼ è¾“å±‚ã€ç½‘ç»œå±‚å’Œé“¾è·¯å±‚</p>
<p>Python Version: 3.5+</p>
</blockquote>
<h1 id="socketç®€ä»‹"><a href="#socketç®€ä»‹" class="headerlink" title="socketç®€ä»‹"></a>socketç®€ä»‹</h1><p>socketé€šå¸¸ä¹Ÿç§°ä½œâ€å¥—æ¥å­—â€ï¼Œç”¨äºæè¿°IPåœ°å€å’Œç«¯å£ï¼Œæ˜¯ä¸€ä¸ªé€šä¿¡é“¾çš„å¥æŸ„ï¼Œåº”ç”¨ç¨‹åºé€šå¸¸é€šè¿‡â€å¥—æ¥å­—â€å‘ç½‘ç»œå‘å‡ºè¯·æ±‚æˆ–è€…åº”ç­”ç½‘ç»œè¯·æ±‚ã€‚</p>
<p>socketèµ·æºäºUnixï¼Œè€ŒUnix/LinuxåŸºæœ¬å“²å­¦ä¹‹ä¸€å°±æ˜¯â€œä¸€åˆ‡çš†æ–‡ä»¶â€ï¼Œå¯¹äºæ–‡ä»¶ç”¨ã€æ‰“å¼€ã€‘ã€è¯»å†™ã€‘ã€å…³é—­ã€‘æ¨¡å¼æ¥æ“ä½œã€‚socketå°±æ˜¯è¯¥æ¨¡å¼çš„ä¸€ä¸ªå®ç°ï¼Œsocketå³æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ–‡ä»¶ï¼Œä¸€äº›socketå‡½æ•°å°±æ˜¯å¯¹å…¶è¿›è¡Œçš„æ“ä½œï¼ˆè¯»/å†™IOã€æ‰“å¼€ã€å…³é—­ï¼‰</p>
<p>socketå’Œfileçš„åŒºåˆ«ï¼š</p>
<ul>
<li>fileæ¨¡å—æ˜¯é’ˆå¯¹æŸä¸ªæŒ‡å®šæ–‡ä»¶è¿›è¡Œã€æ‰“å¼€ã€‘ã€è¯»å†™ã€‘ã€å…³é—­ã€‘</li>
<li>socketæ¨¡å—æ˜¯é’ˆå¯¹ æœåŠ¡å™¨ç«¯ å’Œ å®¢æˆ·ç«¯Socket è¿›è¡Œã€æ‰“å¼€ã€‘ã€è¯»å†™ã€‘ã€å…³é—­ã€‘</li>
</ul>
<h1 id="socketç½‘ç»œç¼–ç¨‹ä¸­çš„å››å±‚åè®®"><a href="#socketç½‘ç»œç¼–ç¨‹ä¸­çš„å››å±‚åè®®" class="headerlink" title="socketç½‘ç»œç¼–ç¨‹ä¸­çš„å››å±‚åè®®"></a>socketç½‘ç»œç¼–ç¨‹ä¸­çš„å››å±‚åè®®</h1><p><img src="http://oss.20150509.cn/QQ201607060223_0.png" alt=""></p>
<p>ä¸‹é¢æ˜¯socketç¼–ç¨‹ä¸­çš„ä¸€ä¸ªç®€å•å®ä¾‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># server.py</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">ip_port = (<span class="string">'127.0.0.1'</span>, <span class="number">5555</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># step 1: åˆ›å»ºsocketå¥—æ¥å­—, é‡Œé¢å°è£…äº†é€šä¿¡åè®®</span></span><br><span class="line">s = socket.socket()</span><br><span class="line"></span><br><span class="line"><span class="comment"># step 2: ç»‘å®šIPåŠç«¯å£å·</span></span><br><span class="line">s.bind(ip_port)</span><br><span class="line"></span><br><span class="line"><span class="comment"># step 3: ç›‘å¬ç»‘å®šçš„ç«¯å£</span></span><br><span class="line">s.listen(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç­‰å¾…å®¢æˆ·ç«¯çš„è¿æ¥</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># step 4: æ¥å—å®¢æˆ·ç«¯çš„è¿æ¥</span></span><br><span class="line">conn, addr = s.accept()</span><br><span class="line"><span class="comment"># connå¯¹è±¡é‡Œå°è£…äº†è¿æ¥è¿‡æ¥çš„è¿™ä¸ªå®¢æˆ·ç«¯çš„é€šä¿¡çº¿è·¯ä¿¡æ¯</span></span><br><span class="line"><span class="comment"># åæœŸè·Ÿè¿™ä¸ªå®¢æˆ·ç«¯çš„é€šä¿¡ä¸äº¤äº’éƒ½éœ€è¦åœ¨connè¿™æ¡é€šä¿¡çº¿è·¯ä¸Šè¿›è¡Œ</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># step 5: æ¥æ”¶æ¶ˆæ¯</span></span><br><span class="line">recv_data = conn.recv(<span class="number">1024</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># step 6: å‘é€æ¶ˆæ¯</span></span><br><span class="line">send_data = recv_data.upper()</span><br><span class="line">conn.send(send_data)</span><br><span class="line"></span><br><span class="line"><span class="comment"># step 7: æ–­å¼€è¿æ¥</span></span><br><span class="line">conn.close()</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># client.py</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">ip_port = (<span class="string">'127.0.0.1'</span>, <span class="number">5555</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># step 1: åˆ›å»ºsocketå¥—æ¥å­—, é‡Œé¢å°è£…äº†é€šä¿¡åè®®</span></span><br><span class="line">s = socket.socket()</span><br><span class="line"></span><br><span class="line"><span class="comment"># step 2: è¿æ¥æœåŠ¡ç«¯</span></span><br><span class="line">s.connect(ip_port)</span><br><span class="line"></span><br><span class="line"><span class="comment"># step 3: å‘é€æ¶ˆæ¯</span></span><br><span class="line">send_data = <span class="string">"hello"</span></span><br><span class="line"><span class="comment"># è¿™é‡Œæ³¨æ„,å’ŒæœåŠ¡ç«¯ä¸åŒçš„æ˜¯,æœåŠ¡ç«¯æ‰¾åˆ°å¯¹ç«¯æ˜¯é€šè¿‡connå¯¹è±¡,è€Œå®¢æˆ·ç«¯æ˜¯så¯¹è±¡</span></span><br><span class="line"><span class="comment"># åœ¨Python3.xä¸­,socketå¯¹è±¡å‘é€å¯¹è±¡å¿…é¡»æ˜¯å­—èŠ‚ç±»å‹(2.7ä¸­å¯ä»¥æ˜¯å­—ç¬¦ä¸²)</span></span><br><span class="line">s.send(bytes(send_data, encoding=<span class="string">'utf8'</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># step 4: æ”¶æ¶ˆæ¯</span></span><br><span class="line">recv_data = s.recv(<span class="number">1024</span>)</span><br><span class="line">print(recv_data, <span class="string">"---&gt;"</span>, type(recv_data), str(recv_data))</span><br><span class="line"></span><br><span class="line"><span class="comment"># step 5: æ–­å¼€è¿æ¥</span></span><br><span class="line">s.close()</span><br></pre></td></tr></table></figure>

<p>å…ˆå¯åŠ¨server.py</p>
<p>åœ¨å¯åŠ¨client.py</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å®¢æˆ·ç«¯ç»ˆç«¯å›æ˜¾</span></span><br><span class="line">b'HELLO' ---&gt; &lt;class 'bytes'&gt; b'HELLO'</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>ç½‘ç»œç¼–ç¨‹</tag>
        <tag>socket</tag>
      </tags>
  </entry>
  <entry>
    <title>Linuxä¸­åˆ‡æ¢ç”¨æˆ·å¹¶æ‰§è¡Œå‘½ä»¤</title>
    <url>/2016/07/04/shell%E8%84%9A%E6%9C%AC%E4%B8%AD%E5%AE%9E%E7%8E%B0%E5%88%87%E6%8D%A2%E7%94%A8%E6%88%B7%E5%B9%B6%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4/</url>
    <content><![CDATA[<blockquote>
<p>åœ¨Linuxä¸­ä½¿ç”¨ su - testuser &amp;&amp; ls è¿™æ ·æ–¹å¼æ¥æŒ‡å®šå‘½ä»¤çš„æ‰§è¡Œèº«ä»½æ—¶ä¼šå‡ºé—®é¢˜ï¼Œåˆ‡æ¢ç”¨æˆ·åï¼Œåé¢çš„å‘½ä»¤å°†è¢«å¿½ç•¥æ‰ï¼Œè¿˜æ˜¯ä½¿ç”¨suå‘½ä»¤ï¼ŒåŠ ä¸€äº›å‚æ•°å³å¯å®ç°åœ¨Linuxå‘½ä»¤è¡Œä¸­å®ç°åˆ‡æ¢ç”¨æˆ·åç«‹å³æ‰§è¡Œå‘½ä»¤</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@iZ25olg4lg9Z ~]<span class="comment"># su -h</span></span><br><span class="line"></span><br><span class="line">Usage:</span><br><span class="line"> su [options] [-] [USER [arg]...]</span><br><span class="line"></span><br><span class="line">Change the effective user id and group id to that of USER.</span><br><span class="line">A mere - implies -l.   If USER not given, assume root.</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line"> -m, -p, --preserve-environment  <span class="keyword">do</span> not reset environment variables</span><br><span class="line"> -g, --group &lt;group&gt;             specify the primary group</span><br><span class="line"> -G, --supp-group &lt;group&gt;        specify a supplemental group</span><br><span class="line"></span><br><span class="line"> -, -l, --login                  make the shell a login shell</span><br><span class="line"> -c, --<span class="built_in">command</span> &lt;<span class="built_in">command</span>&gt;         pass a single <span class="built_in">command</span> to the shell with -c</span><br><span class="line"> --session-command &lt;<span class="built_in">command</span>&gt;     pass a single <span class="built_in">command</span> to the shell with -c</span><br><span class="line">                                 and <span class="keyword">do</span> not create a new session</span><br><span class="line"> -f, --fast                      pass -f to the shell (<span class="keyword">for</span> csh or tcsh)</span><br><span class="line"> -s, --shell &lt;shell&gt;             run shell <span class="keyword">if</span> /etc/shells allows it</span><br><span class="line"></span><br><span class="line"> -h, --<span class="built_in">help</span>     display this <span class="built_in">help</span> and <span class="built_in">exit</span></span><br><span class="line"> -V, --version  output version information and <span class="built_in">exit</span></span><br><span class="line"></span><br><span class="line">For more details see su(1).</span><br></pre></td></tr></table></figure>

<ul>
<li>åœ¨Linuxå‘½ä»¤è¡Œåˆ‡æ¢ç”¨æˆ·å¹¶æ‰§è¡Œå‘½ä»¤</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">su - testuser -c whoami</span><br></pre></td></tr></table></figure>

<ul>
<li>åœ¨Linuxå‘½ä»¤è¡Œåˆ‡æ¢ç”¨æˆ·å¹¶æ‰§è¡Œè„šæœ¬</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">su - testuser -s /bin/bash shell.sh</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>Shell</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonä¸­çš„å¼‚å¸¸å¤„ç†</title>
    <url>/2016/07/03/Python%E4%B8%AD%E7%9A%84%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86/</url>
    <content><![CDATA[<blockquote>
<p>åœ¨ç¨‹åºä¸­ä½¿ç”¨å¼‚å¸¸å¤„ç†æ¥æé«˜ç¨‹åºçš„å¥å£®æ€§ï¼Œéšè—ç¨‹åºçš„å†…éƒ¨å®ç°ã€‚</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">	n1 = input(<span class="string">"&gt; "</span>)</span><br><span class="line">	n2 = input(<span class="string">"&gt; "</span>)</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">try</span>:</span><br><span class="line">	    n1 = int(n1)</span><br><span class="line">	    n2 = int(n2)</span><br><span class="line">	    result = n1 + n2</span><br><span class="line">	<span class="keyword">except</span> Exception <span class="keyword">as</span> ex:  <span class="comment"># exæ˜¯Exceptionç±»çš„ä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">	    print(ex)  <span class="comment"># æ‰§è¡Œäº†exå¯¹è±¡çš„__str__æ–¹æ³•</span></span><br><span class="line">	    <span class="comment"># exä¸­å°è£…äº†æ‰€æœ‰çš„é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">    </span><br><span class="line">------------</span><br><span class="line">&gt; <span class="number">1</span></span><br><span class="line">&gt; str</span><br><span class="line">invalid literal <span class="keyword">for</span> int() <span class="keyword">with</span> base <span class="number">10</span>: <span class="string">'str'</span></span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<p>å¼‚å¸¸çš„æ•è·å±äºç¨‹åºæ­£å¸¸è¿è¡Œçš„åŠŸèƒ½ï¼Œå’ŒæŠ¥é”™é€€å‡ºæœ‰æœ¬è´¨çš„åŒºåˆ«,ä¸Šé¢çš„ç¨‹åºä¸­ï¼Œè™½ç„¶æœ‰é”™è¯¯ï¼Œä½†æ˜¯ç¨‹åºå¹¶æ²¡æœ‰è¢«ç»ˆæ­¢</p>
<h1 id="å¸¸è§çš„å¼‚å¸¸ç§ç±»"><a href="#å¸¸è§çš„å¼‚å¸¸ç§ç±»" class="headerlink" title="å¸¸è§çš„å¼‚å¸¸ç§ç±»"></a>å¸¸è§çš„å¼‚å¸¸ç§ç±»</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">AttributeError è¯•å›¾è®¿é—®ä¸€ä¸ªå¯¹è±¡æ²¡æœ‰çš„æ ‘å½¢ï¼Œæ¯”å¦‚foo.xï¼Œä½†æ˜¯fooæ²¡æœ‰å±æ€§x</span><br><span class="line">IOError è¾“å…¥&#x2F;è¾“å‡ºå¼‚å¸¸ï¼›åŸºæœ¬ä¸Šæ˜¯æ— æ³•æ‰“å¼€æ–‡ä»¶</span><br><span class="line">ImportError æ— æ³•å¼•å…¥æ¨¡å—æˆ–åŒ…ï¼›åŸºæœ¬ä¸Šæ˜¯è·¯å¾„é—®é¢˜æˆ–åç§°é”™è¯¯</span><br><span class="line">IndentationError è¯­æ³•é”™è¯¯ï¼ˆçš„å­ç±»ï¼‰ ï¼›ä»£ç æ²¡æœ‰æ­£ç¡®å¯¹é½</span><br><span class="line">IndexError ä¸‹æ ‡ç´¢å¼•è¶…å‡ºåºåˆ—è¾¹ç•Œï¼Œæ¯”å¦‚å½“xåªæœ‰ä¸‰ä¸ªå…ƒç´ ï¼Œå´è¯•å›¾è®¿é—®x[5]</span><br><span class="line">KeyError è¯•å›¾è®¿é—®å­—å…¸é‡Œä¸å­˜åœ¨çš„é”®</span><br><span class="line">KeyboardInterrupt Ctrl+Cè¢«æŒ‰ä¸‹</span><br><span class="line">NameError ä½¿ç”¨ä¸€ä¸ªè¿˜æœªè¢«èµ‹äºˆå¯¹è±¡çš„å˜é‡</span><br><span class="line">SyntaxError Pythonä»£ç éæ³•ï¼Œä»£ç ä¸èƒ½ç¼–è¯‘(ä¸ªäººè®¤ä¸ºè¿™æ˜¯è¯­æ³•é”™è¯¯ï¼Œå†™é”™äº†ï¼‰</span><br><span class="line">TypeError ä¼ å…¥å¯¹è±¡ç±»å‹ä¸è¦æ±‚çš„ä¸ç¬¦åˆ</span><br><span class="line">UnboundLocalError è¯•å›¾è®¿é—®ä¸€ä¸ªè¿˜æœªè¢«è®¾ç½®çš„å±€éƒ¨å˜é‡ï¼ŒåŸºæœ¬ä¸Šæ˜¯ç”±äºå¦æœ‰ä¸€ä¸ªåŒåçš„å…¨å±€å˜é‡ï¼Œ</span><br><span class="line">å¯¼è‡´ä½ ä»¥ä¸ºæ­£åœ¨è®¿é—®å®ƒ</span><br><span class="line">ValueError ä¼ å…¥ä¸€ä¸ªè°ƒç”¨è€…ä¸æœŸæœ›çš„å€¼ï¼Œå³ä½¿å€¼çš„ç±»å‹æ˜¯æ­£ç¡®çš„</span><br></pre></td></tr></table></figure>

<h1 id="æ›´å¤šçš„å¼‚å¸¸ç§ç±»"><a href="#æ›´å¤šçš„å¼‚å¸¸ç§ç±»" class="headerlink" title="æ›´å¤šçš„å¼‚å¸¸ç§ç±»"></a>æ›´å¤šçš„å¼‚å¸¸ç§ç±»</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ArithmeticError</span><br><span class="line">AssertionError</span><br><span class="line">AttributeError</span><br><span class="line">BaseException</span><br><span class="line">BufferError</span><br><span class="line">BytesWarning</span><br><span class="line">DeprecationWarning</span><br><span class="line">EnvironmentError</span><br><span class="line">EOFError</span><br><span class="line">Exception</span><br><span class="line">FloatingPointError</span><br><span class="line">FutureWarning</span><br><span class="line">GeneratorExit</span><br><span class="line">ImportError</span><br><span class="line">ImportWarning</span><br><span class="line">IndentationError</span><br><span class="line">IndexError</span><br><span class="line">IOError</span><br><span class="line">KeyboardInterrupt</span><br><span class="line">KeyError</span><br><span class="line">LookupError</span><br><span class="line">MemoryError</span><br><span class="line">NameError</span><br><span class="line">NotImplementedError</span><br><span class="line">OSError</span><br><span class="line">OverflowError</span><br><span class="line">PendingDeprecationWarning</span><br><span class="line">ReferenceError</span><br><span class="line">RuntimeError</span><br><span class="line">RuntimeWarning</span><br><span class="line">StandardError</span><br><span class="line">StopIteration</span><br><span class="line">SyntaxError</span><br><span class="line">SyntaxWarning</span><br><span class="line">SystemError</span><br><span class="line">SystemExit</span><br><span class="line">TabError</span><br><span class="line">TypeError</span><br><span class="line">UnboundLocalError</span><br><span class="line">UnicodeDecodeError</span><br><span class="line">UnicodeEncodeError</span><br><span class="line">UnicodeError</span><br><span class="line">UnicodeTranslateError</span><br><span class="line">UnicodeWarning</span><br><span class="line">UserWarning</span><br><span class="line">ValueError</span><br><span class="line">Warning</span><br><span class="line">ZeroDivisionError</span><br></pre></td></tr></table></figure>

<h1 id="Exception"><a href="#Exception" class="headerlink" title="Exception"></a>Exception</h1><p>åœ¨æ•è·ä¸Šé¢æŒ‡å®šå¼‚å¸¸çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¸¸å¸¸éœ€è¦æŒ‡å®šå¤šä¸ªå¼‚å¸¸åŒºæ•è·ï¼Œä½†æœ‰æ—¶è¿˜æ˜¯æ— æ³•å…¨éƒ¨å…¨éƒ¨é¢„æ–™åˆ°ä¼šå‡ºç°å“ªç§ç±»å‹çš„å¼‚å¸¸ï¼Œè¿™ä¸ªæ—¶å€™ï¼ŒPythonæä¾›ç»™æˆ‘ä»¬ä¸€ä¸ªä¸‡èƒ½çš„å¼‚å¸¸æ•è·<code>Exception</code></p>
<p>é‚£å•ç‹¬æ•è·å¼‚å¸¸å­˜åœ¨æ„ä¹‰æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿåœ¨å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦æ•è·ç‰¹å®šçš„å¼‚å¸¸æ¥è®°å½•æ—¥å¿—ï¼Œæˆ–æ˜¯å¯¹æŸäº›æŒ‡å®šçš„å¼‚å¸¸åšç‰¹æ®Šçš„å¤„ç†ï¼Œè¿™ä¸ªæ—¶å€™æŒ‡å®šæ•è·æŸç±»å¼‚å¸¸å°±éå¸¸æœ‰ç”¨å•¦ï¼Œä¸ºäº†åŒæ—¶å…¼é¡¾ç¨‹åºçš„å¥å£®æ€§ï¼Œå¯ä»¥åƒ<code>if elif else</code>ä¸€æ ·æ¥æŒ‡å®šæ•è·çš„å¼‚å¸¸åŒæ—¶å…¼é¡¾æ•è·æ‰€æœ‰çš„å¼‚å¸¸ï¼Œç±»ä¼¼äºä¸‹é¢çš„å†™æ³•</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">	<span class="comment"># ...</span></span><br><span class="line"><span class="keyword">except</span> ValueError <span class="keyword">as</span> ex:</span><br><span class="line">	print(ex)</span><br><span class="line"><span class="keyword">except</span> IndexError <span class="keyword">as</span> ex:</span><br><span class="line">	print(ex)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> ex:</span><br><span class="line">	print(ex)</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·æŠŠæŒ‡å®šçš„å¼‚å¸¸åŒºåˆ†å¼€æ¥</p>
<p><em>æ³¨æ„ï¼šExceptionä¸€å®šè¦æ”¾åœ¨æœ€åï¼</em></p>
<h1 id="å¼‚å¸¸å¤„ç†çš„å®Œæ•´ä»£ç å—"><a href="#å¼‚å¸¸å¤„ç†çš„å®Œæ•´ä»£ç å—" class="headerlink" title="å¼‚å¸¸å¤„ç†çš„å®Œæ•´ä»£ç å—"></a>å¼‚å¸¸å¤„ç†çš„å®Œæ•´ä»£ç å—</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="comment"># ä¸»ä»£ç å—</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"><span class="keyword">except</span> KeyError,e:</span><br><span class="line">    <span class="comment"># å¼‚å¸¸æ—¶ï¼Œæ‰§è¡Œè¯¥å—</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="comment"># ä¸»ä»£ç å—æ‰§è¡Œå®Œï¼Œæ‰§è¡Œè¯¥å—</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    <span class="comment"># æ— è®ºå¼‚å¸¸ä¸å¦ï¼Œæœ€ç»ˆæ‰§è¡Œè¯¥å—</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<ul>
<li>å½“ try ä¸­çš„ä¸»ä»£ç å—æ‰§è¡Œæ­£ç¡®æ—¶, å°†æ‰§è¡Œ else é‡Œé¢çš„ä»£ç , æœ€åæ‰§è¡Œ finally é‡Œé¢çš„ä»£ç </li>
<li>å½“ try ä¸­çš„ä¸»ä»£ç å—æ‰§è¡Œå‡ºç°å¼‚å¸¸æ—¶, å°†æ‰§è¡Œ except é‡Œé¢çš„ä»£ç , æœ€åæ‰§è¡Œ finally é‡Œé¢çš„ä»£ç </li>
</ul>
<h1 id="ä¸»åŠ¨è§¦å‘å¼‚å¸¸"><a href="#ä¸»åŠ¨è§¦å‘å¼‚å¸¸" class="headerlink" title="ä¸»åŠ¨è§¦å‘å¼‚å¸¸"></a>ä¸»åŠ¨è§¦å‘å¼‚å¸¸</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">	<span class="keyword">raise</span> Exception(<span class="string">"ä¸»åŠ¨æŠ›å‡ºå¼‚å¸¸"</span>)  <span class="comment"># åˆ›å»ºäº†ä¸€ä¸ªExceptionå¯¹è±¡ï¼Œself.message = "ä¸»åŠ¨æŠ›å‡ºå¼‚å¸¸"</span></span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> ex:</span><br><span class="line">	print(ex)  <span class="comment"># __str__ return self.message</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">	<span class="keyword">raise</span> ValueError(<span class="string">"ä¸»åŠ¨æŠ›å‡ºå€¼å¼‚å¸¸"</span>)  <span class="comment"># åˆ›å»ºäº†ä¸€ä¸ªValueErrorå¯¹è±¡ï¼Œself.message = "ä¸»åŠ¨æŠ›å‡ºå¼‚å¸¸"</span></span><br><span class="line"><span class="keyword">except</span> ValueError <span class="keyword">as</span> ex:</span><br><span class="line">	print(ex)  <span class="comment"># __str__ return self.message</span></span><br></pre></td></tr></table></figure>

<h1 id="è‡ªå®šä¹‰å¼‚å¸¸"><a href="#è‡ªå®šä¹‰å¼‚å¸¸" class="headerlink" title="è‡ªå®šä¹‰å¼‚å¸¸"></a>è‡ªå®šä¹‰å¼‚å¸¸</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PsException</span><span class="params">(Exception)</span>:</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, msg)</span>:</span></span><br><span class="line">        self.message = msg</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.message</span><br><span class="line"> </span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">raise</span> PsException(<span class="string">'Psçš„å¼‚å¸¸'</span>)</span><br><span class="line"><span class="keyword">except</span> PsException <span class="keyword">as</span> ex:</span><br><span class="line">    print(ex)</span><br></pre></td></tr></table></figure>

<h1 id="æ–­è¨€"><a href="#æ–­è¨€" class="headerlink" title="æ–­è¨€"></a>æ–­è¨€</h1><p>è¯­æ³•ï¼š<code>assert æ¡ä»¶è¡¨è¾¾å¼</code></p>
<p>æ¡ä»¶è¡¨è¾¾å¼ä¸ºå‡åˆ™è§¦å‘AssertionErrorå¼‚å¸¸</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">assert</span> <span class="number">1</span> == <span class="number">1</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">assert</span> <span class="number">1</span> == <span class="number">2</span></span><br></pre></td></tr></table></figure>

<p>assertçš„åº”ç”¨åœºæ™¯ï¼šåœ¨æ‰§è¡ŒæŸäº›æ“ä½œä¹‹å‰ï¼Œå¦‚æœä¸ç¬¦åˆæˆ‘æŒ‡å®šçš„æŸäº›è§„åˆ™ï¼ŒæŠ›å‡ºå¼‚å¸¸</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># multiprocessingæºç æˆªå–</span></span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> pool</span><br><span class="line"></span><br><span class="line">p = pool.Pool()</span><br><span class="line"></span><br><span class="line">p.join()</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">join</span><span class="params">(self)</span>:</span></span><br><span class="line">    util.debug(<span class="string">'joining pool'</span>)</span><br><span class="line">    <span class="keyword">assert</span> self._state <span class="keyword">in</span> (CLOSE, TERMINATE)</span><br><span class="line">    self._worker_handler.join()</span><br><span class="line">    self._task_handler.join()</span><br><span class="line">    self._result_handler.join()</span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> self._pool:</span><br><span class="line">        p.join()</span><br></pre></td></tr></table></figure>

<p>*<em>æ–­è¨€ä¸ raise çš„åŒºåˆ«: å¯ä»¥ç®€å•ç†è§£ä¸º <code>æ–­è¨€=if...else... + raise</code> *</em></p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>try</tag>
        <tag>å¼‚å¸¸å¤„ç†</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonå®ç°çš„å•ä¾‹æ¨¡å¼</title>
    <url>/2016/07/03/Python%E5%AE%9E%E7%8E%B0%E7%9A%84%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/</url>
    <content><![CDATA[<blockquote>
<p>å•ä¾‹æ¨¡å¼ï¼šä¸€ä¸ªå®ä¾‹ï¼Œä¸€ä¸ªå¯¹è±¡ã€‚ç”¨æ¥åˆ›å»ºå•ä¸ªå®ä¾‹ï¼ˆå¯¹è±¡ï¼‰</p>
</blockquote>
<p>æ‹¿æ•°æ®åº“çš„è¿æ¥æ± æ¥ä¸¾ä¾‹ï¼Œæ¯ä¸ªç”¨æˆ·çš„æ•°æ®åº“è®¿é—®è¯·æ±‚ï¼Œéƒ½åº”è¯¥åªå»ä¸€ä¸ªè¿æ¥æ± ä¸­æ‹¿èµ„æºã€‚ä¸€ä¸ªè¿æ¥æ± å°±æ˜¯ä¸€ä¸ªå®ä¾‹ã€‚å•ä¾‹æ¨¡å¼å°±å¯ä»¥åº”ç”¨åœ¨è¿™é‡Œåœºæ™¯ä¸‹</p>
<p>å®ç°å•ä¾‹æ¨¡å¼çš„æ€è·¯ï¼š</p>
<ul>
<li>åœ¨ç±»çš„å†…éƒ¨è‡ªå®šä¹‰ä¸€ä¸ªæ–¹æ³•å»åˆ›å»ºå®ä¾‹ï¼Œå› ä¸ºä½¿ç”¨é»˜è®¤çš„initæ„é€ æ–¹æ³•åˆ›å»ºå®ä¾‹æ˜¯ä¸å¯æ§çš„</li>
<li>åˆ›å»ºä¸€ä¸ªæ——æ ‡å˜é‡ï¼Œè¯¥å˜é‡ä¿å­˜ä¸€ä¸ªå¯¹è±¡å®ä¾‹ï¼Œåˆ›å»ºå¯¹è±¡çš„æ–¹æ³•å¦‚æœæ£€æµ‹åˆ°è¯¥å˜é‡å·²ç»æœ‰å€¼äº†ï¼Œå°±ç›´æ¥å°†è¯¥å¯¹è±¡è¿”å›ï¼Œå¦‚æœæ²¡æœ‰å€¼ï¼Œåˆ™æ‰§è¡Œé¦–æ¬¡åˆ›å»ºï¼Œå¹¶ä¸ºæ——æ ‡å˜é‡èµ‹å€¼</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line"></span><br><span class="line">    instance = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_instance</span><span class="params">(cls, name)</span>:</span>  <span class="comment"># ç±»æ–¹æ³•, ç¬¬ä¸€ä¸ªå‚æ•°é»˜è®¤æ˜¯ç±»è¿™ä¸ªå¯¹è±¡</span></span><br><span class="line">        <span class="keyword">if</span> cls.instance:  <span class="comment"># åˆ¤æ–­å¦‚æœè¿™ä¸ªé™æ€å­—æ®µä¸ºçœŸ(å·²ç»å­˜åœ¨å®ä¾‹)</span></span><br><span class="line">            <span class="keyword">return</span> cls.instance  <span class="comment"># ç›´æ¥è¿”å›è¿™ä¸ªå®ä¾‹</span></span><br><span class="line">        <span class="keyword">else</span>:  <span class="comment"># å¦‚æœå®ä¾‹ä¸å­˜åœ¨</span></span><br><span class="line">            obj = cls(name)  <span class="comment"># åœ¨ç±»çš„å†…éƒ¨åˆ›å»ºä¸€ä¸ªå®ä¾‹,å†…éƒ¨è°ƒç”¨äº†initæ„é€ æ–¹æ³•</span></span><br><span class="line">            cls.instance = obj  <span class="comment"># å°†è¯¥å®ä¾‹èµ‹å€¼ç»™ç±»çš„é™æ€å­—æ®µ,é˜²æ­¢ä¸‹æ¬¡é‡å¤åˆ›å»º</span></span><br><span class="line">            <span class="keyword">return</span> obj  <span class="comment"># å°†æ–°åˆ›å»ºçš„å¯¹è±¡è¿”å›</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»è¿‡ä¸Šé¢çš„ä¿®æ”¹, å¦‚æœæƒ³å®ç°å•ä¾‹æ¨¡å¼, å°±ä¸èƒ½å†ä½¿ç”¨initæ„é€ æ–¹æ³•æ¥åˆ›å»ºå¯¹è±¡äº†</span></span><br><span class="line"><span class="comment"># a1 = A("ps")</span></span><br><span class="line"><span class="comment"># a2 = A("lr")</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç›¸å½“äºæŠŠåˆ›å»ºå¯¹è±¡çš„ä»»åŠ¡äº¤ç»™äº†get_instanceæ–¹æ³•</span></span><br><span class="line">a1 = A.get_instance(<span class="string">"PolarSnow"</span>)  <span class="comment"># ç¬¬ä¸€æ¬¡ä¼šåˆ›å»ºå¯¹è±¡</span></span><br><span class="line">a2 = A.get_instance(<span class="string">"PolarSnow"</span>)  <span class="comment"># ç¬¬äºŒæ¬¡ä¼šä½¿ç”¨ç¬¬ä¸€æ¬¡åˆ›å»ºçš„å¯¹è±¡</span></span><br><span class="line"></span><br><span class="line">print(a1)</span><br><span class="line">print(a2)</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">&lt;__main__.A object at <span class="number">0x101377b38</span>&gt;</span><br><span class="line">&lt;__main__.A object at <span class="number">0x101377b38</span>&gt;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
        <tag>å•ä¾‹æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonä¸­è‡ªå®šä¹‰æœ‰åºå­—å…¸</title>
    <url>/2016/07/03/Python%E4%B8%AD%E8%87%AA%E5%AE%9A%E4%B9%89%E6%9C%89%E5%BA%8F%E5%AD%97%E5%85%B8/</url>
    <content><![CDATA[<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyDict</span><span class="params">(dict)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        super(MyDict, self).__init__()</span><br><span class="line">        self.li = []</span><br><span class="line"></span><br><span class="line">md = MyDict()</span><br><span class="line">md[<span class="string">"k1"</span>] = <span class="number">123</span></span><br><span class="line">md[<span class="string">"k2"</span>] = <span class="number">456</span></span><br><span class="line"></span><br><span class="line">print(md)</span><br></pre></td></tr></table></figure>

<p>åœ¨ä¸ç ´åå­—å…¸å¯¹è±¡æ„é€ æ–¹æ³•çš„æƒ…å†µä¸‹ï¼Œè‡ªå®šä¹‰åˆ›å»ºä¸€ä¸ªåˆ—è¡¨ï¼Œç”¨æ¥å­˜æ”¾key</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyDict</span><span class="params">(dict)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        super(MyDict, self).__init__()</span><br><span class="line">        self.li = []</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__setitem__</span><span class="params">(self, key, value)</span>:</span></span><br><span class="line">        self.li.append(key)</span><br><span class="line">        super(MyDict, self).__setitem__(key, value)</span><br></pre></td></tr></table></figure>

<p>å°†æ–°çš„é”®å€¼å¯¹ä¿å­˜åˆ°å­—å…¸çš„æ—¶å€™ï¼Œä¿å­˜å®ƒçš„keyåˆ°æˆ‘ä»¬è‡ªå®šä¹‰åˆ›å»ºçš„åˆ—è¡¨ä¸­</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyDict</span><span class="params">(dict)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        super(MyDict, self).__init__()</span><br><span class="line">        self.li = []</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__setitem__</span><span class="params">(self, key, value)</span>:</span></span><br><span class="line">        self.li.append(key)</span><br><span class="line">        super(MyDict, self).__setitem__(key, value)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        tmp_list = []</span><br><span class="line">        <span class="keyword">for</span> key <span class="keyword">in</span> self.li:</span><br><span class="line">            value = self.get(key)  <span class="comment"># ä½¿ç”¨äº†çˆ¶ç±»çš„getæ–¹æ³•</span></span><br><span class="line">            tmp_list.append(<span class="string">"'%s': %s"</span> % (key, value))</span><br><span class="line">        tmp_str = <span class="string">"&#123;"</span> + <span class="string">", "</span>.join(tmp_list) + <span class="string">"&#125;"</span></span><br><span class="line">        <span class="keyword">return</span> tmp_str</span><br><span class="line"></span><br><span class="line">md = MyDict()</span><br><span class="line">md[<span class="string">"k1"</span>] = <span class="number">123</span></span><br><span class="line">md[<span class="string">"k2"</span>] = <span class="number">456</span></span><br><span class="line"></span><br><span class="line">print(md)</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line"></span><br><span class="line">&#123;<span class="string">'k1'</span>: <span class="number">123</span>, <span class="string">'k2'</span>: <span class="number">456</span>&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>super</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonå¯¹è±¡æ‰§è¡Œçˆ¶ç±»çš„æ–¹æ³•</title>
    <url>/2016/07/03/Python%E5%AF%B9%E8%B1%A1%E6%89%A7%E8%A1%8C%E7%88%B6%E7%B1%BB%E7%9A%84%E6%96%B9%E6%B3%95/</url>
    <content><![CDATA[<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f1</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"A.f1"</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span><span class="params">(A)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f1</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"B.f1"</span>)</span><br><span class="line"></span><br><span class="line">b = B()</span><br><span class="line">b.f1()</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">B.f1</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„å®ä¾‹ä¸­ï¼ŒBç±»ç»§æ‰¿äº†Aç±»ï¼Œå¹¶é‡å†™äº†Aç±»çš„f1æ–¹æ³•ï¼Œç°åœ¨æˆ‘æƒ³åœ¨Bç±»ä¸­ä¸»åŠ¨å»è°ƒç”¨çˆ¶ç±»ä¸­çš„æ–¹æ³•ï¼Œå¯ä»¥é€šè¿‡<code>super</code>å…³é”®å­—å®ç°ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f1</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"A.f1"</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span><span class="params">(A)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f1</span><span class="params">(self)</span>:</span></span><br><span class="line">    	<span class="comment"># ä¸»åŠ¨æ‰§è¡Œçˆ¶ç±»çš„f1æ–¹æ³•</span></span><br><span class="line">        super(B, self).f1()</span><br><span class="line">        print(<span class="string">"B.f1"</span>)</span><br><span class="line"></span><br><span class="line">b = B()</span><br><span class="line">b.f1()</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">A.f1</span><br><span class="line">B.f1</span><br></pre></td></tr></table></figure>

<p>åº”ç”¨åœºæ™¯ï¼šåœ¨æºç ä¸­çš„æŸäº›åŠŸèƒ½ä¸å¤Ÿå®Œå–„ï¼Œæˆ‘ä»¬å¯ä»¥ç»§æ‰¿ä»–çš„ç±»ï¼Œå¹¶åœ¨è°ƒç”¨çˆ¶ç±»æ–¹æ³•çš„æƒ…å†µä¸‹ï¼Œåœ¨è‡ªå·±çš„ç±»ä¸­æ·»åŠ ä¸€äº›åŠŸèƒ½ã€‚ç›¸å½“äºåœ¨ç±»ä¸­æ¨¡æ‹Ÿäº†è£…é¥°å™¨çš„åŠŸèƒ½</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f1</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"A.f1"</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span><span class="params">(A)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f1</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"è£…é¥°å¼€å§‹"</span>)</span><br><span class="line">        ret = super(B, self).f1()  <span class="comment"># æ¥æ”¶çˆ¶ç±»f1æ–¹æ³•æ‰§è¡Œç»“æœçš„è¿”å›å€¼</span></span><br><span class="line">        print(<span class="string">"è£…é¥°ç»“æŸ"</span>)</span><br><span class="line">        <span class="keyword">return</span> ret  <span class="comment"># è¿”å›äº†çˆ¶ç±»f1æ‰§è¡Œç»“æœçš„è¿”å›å€¼(ä½ å¯ä»¥è‡ªå®šä¹‰è¿”å›ä»»ä½•ä¸œè¥¿)</span></span><br></pre></td></tr></table></figure>

<p><em>éä¸»æµçš„æ–¹å¼å»è°ƒç”¨çˆ¶ç±»æ–¹æ³•</em></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f1</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"A.f1"</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span><span class="params">(A)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f1</span><span class="params">(self)</span>:</span></span><br><span class="line">        A.f1(self)  <span class="comment"># åˆ«äººè¿™ä¹ˆå†™ä½ éœ€è¦çœ‹æ‡‚ï¼Œä½†æ˜¯è‡ªå·±ä¸è¦è¿™ä¹ˆå†™</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>super</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonçš„è‡ªçœä¹‹isinstance&amp;issubclass</title>
    <url>/2016/07/03/Python%E7%9A%84%E8%87%AA%E7%9C%81%E4%B9%8Bisinstance-issubclass/</url>
    <content><![CDATA[<blockquote>
<p>Pythonçš„è‡ªçœï¼Œæ˜¯è‡ªæˆ‘åçœï¼Œè‡ªå·±æ£€æŸ¥è‡ªå·±çš„æœºåˆ¶ã€‚åœ¨Pythonä¸­ï¼Œæœ‰å¾ˆå¤šæ–¹å¼å¯ä»¥åšåˆ°è®©Pythonè‡ªçœï¼Œè¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»ä¸¤ä¸ª<code>isinstance</code> å’Œ <code>issubclass</code></p>
</blockquote>
<h1 id="isinstance"><a href="#isinstance" class="headerlink" title="isinstance"></a>isinstance</h1><p>isinstance(obj, cls) ç”¨æ¥æ£€æŸ¥objå¯¹è±¡æ˜¯å¦æ˜¯clsç±»çš„å¯¹è±¡</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">a = A()</span><br><span class="line">print(isinstance(a, A))</span><br><span class="line"></span><br><span class="line">i = <span class="number">10</span></span><br><span class="line">print(isinstance(i, int))</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span><span class="params">(A)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">b = B()</span><br><span class="line">print(isinstance(b, B))</span><br><span class="line">print(isinstance(b, A))</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure>

<p><strong>è¡¥å……ï¼šä¹Ÿå¯ä»¥æ˜¯clsçš„çˆ¶ç±»</strong></p>
<h1 id="issubclass"><a href="#issubclass" class="headerlink" title="issubclass"></a>issubclass</h1><p>issubclass(sub, super) ç”¨æ¥æ£€æŸ¥subç±»æ˜¯å¦æ˜¯ super ç±»çš„æ´¾ç”Ÿç±»</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span><span class="params">(A)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">print(issubclass(B, A))  <span class="comment"># B ç»§æ‰¿äº† A, Bæ˜¯Açš„å­ç±»</span></span><br><span class="line">print(issubclass(A, B))</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>è‡ªçœ</tag>
        <tag>isinstance</tag>
        <tag>issubclass</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonç±»ä¸­çš„ç‰¹æ®Šæˆå‘˜</title>
    <url>/2016/07/03/Python%E7%B1%BB%E4%B8%AD%E7%9A%84%E7%89%B9%E6%AE%8A%E6%88%90%E5%91%98/</url>
    <content><![CDATA[<blockquote>
<p>Python Version: 3.5+</p>
</blockquote>
<h1 id="init"><a href="#init" class="headerlink" title="__init__"></a>__init__</h1><p>æ„é€ æ–¹æ³•ï¼Œæ¯ä¸ªå¯¹è±¡è¢«å®ä¾‹åŒ–å‡ºæ¥çš„æ—¶å€™éƒ½å°†é¦–å…ˆå»æ‰§è¡Œ<code>__init__</code>æ–¹æ³•</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">		print(<span class="string">"åœ¨åˆ›å»ºå¯¹è±¡çš„æ—¶å€™ä¼šé¦–å…ˆè‡ªåŠ¨æ‰§è¡Œ__init__"</span>)</span><br></pre></td></tr></table></figure>


<h1 id="del"><a href="#del" class="headerlink" title="__del__"></a>__del__</h1><p>ææ„æ–¹æ³•ï¼Œæ¯ä¸ªå¯¹è±¡åœ¨è¢«åƒåœ¾å›æ”¶æœºåˆ¶å›æ”¶ä¹‹å‰æ‰§è¡Œçš„æ–¹æ³•</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__del__</span><span class="params">(self)</span>:</span></span><br><span class="line">		print(<span class="string">"åœ¨å¯¹è±¡é”€æ¯ä¹‹å‰ä¼šæ‰§è¡Œ__del__"</span>)</span><br></pre></td></tr></table></figure>


<h1 id="doc"><a href="#doc" class="headerlink" title="__doc__"></a>__doc__</h1><p>ç±»çš„æè¿°ä¿¡æ¯</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">	<span class="string">"""æˆ‘æ˜¯Aç±»çš„æè¿°ä¿¡æ¯"""</span></span><br><span class="line">	<span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<h1 id="module"><a href="#module" class="headerlink" title="__module__"></a>__module__</h1><p>è¡¨ç¤ºå½“å‰æ“ä½œçš„å¯¹è±¡åœ¨å“ªä¸ªæ¨¡å—</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">    <span class="string">"""æˆ‘æ˜¯Aç±»çš„æè¿°ä¿¡æ¯"""</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> lib <span class="keyword">import</span> A</span><br><span class="line">a = A()</span><br><span class="line">print(a.__module__)</span><br></pre></td></tr></table></figure>

<h1 id="class"><a href="#class" class="headerlink" title="__class__"></a>__class__</h1><p>è¡¨ç¤ºå½“å‰æ“ä½œçš„å¯¹è±¡çš„ç±»æ˜¯ä»€ä¹ˆ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">a = A()</span><br><span class="line">print(a.__class__)</span><br></pre></td></tr></table></figure>

<h1 id="call"><a href="#call" class="headerlink" title="__call__"></a>__call__</h1><p>ç±»ååé¢åŠ æ‹¬å·è¡¨ç¤ºåˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼›å¦‚æœåœ¨å¯¹è±¡åé¢åŠ æ‹¬å·ï¼Œå°±éœ€è¦ä½¿ç”¨<code>__call__</code>æ–¹æ³•äº†ï¼Œå¦‚æœä¸å®šä¹‰è¿™ä¸ªæ–¹æ³•ï¼Œåœ¨æ‰§è¡Œ<code>å¯¹è±¡()</code>çš„æ—¶å€™å°±ä¼šæŠ¥é”™</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(self, *args, **kwargs)</span>:</span></span><br><span class="line">        print(<span class="string">"call"</span>)</span><br><span class="line"></span><br><span class="line">a = A()</span><br><span class="line">a()</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">call</span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºå¯¹è±¡çš„æ—¶å€™é¦–å…ˆæ‰§è¡Œ<code>__init__</code>,åœ¨å¯¹è±¡è¢«è°ƒç”¨çš„æ—¶å€™æ‰§è¡Œ<code>__call__</code></p>
<p>ä¹Ÿå¯ä»¥åœ¨ä¸€è¡Œæ‰§è¡Œ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a = A()()</span><br></pre></td></tr></table></figure>

<h1 id="str"><a href="#str" class="headerlink" title="__str__"></a>__str__</h1><p>printå¯¹è±¡çš„æ—¶å€™æ˜¾ç¤ºçš„å†…å®¹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">	<span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">a = A()</span><br><span class="line">print(a)</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">&lt;__main__.A object at <span class="number">0x101b77128</span>&gt;</span><br></pre></td></tr></table></figure>

<p>åœ¨æ²¡æœ‰å®šä¹‰<code>__str__</code>çš„æƒ…å†µä¸‹ï¼Œè¾“å‡ºçš„æ˜¯aå¯¹è±¡çš„å†…å­˜åœ°å€ä¿¡æ¯</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"A~"</span></span><br><span class="line"></span><br><span class="line">a = A()</span><br><span class="line">print(a)</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">A~</span><br></pre></td></tr></table></figure>

<p><strong>strçš„åº”ç”¨å®ä¾‹</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.name</span><br><span class="line"></span><br><span class="line">b = B(<span class="string">"ps"</span>)</span><br><span class="line">print(b)</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">ps</span><br></pre></td></tr></table></figure>

<p><strong>strç±»å‹è½¬æ¢</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.name</span><br><span class="line"></span><br><span class="line">b = B(<span class="string">"ps"</span>)</span><br><span class="line">ret = str(b)</span><br><span class="line">print(ret)</span><br></pre></td></tr></table></figure>

<p><code>str(b)</code>å’Œ<code>print()</code>éƒ½ä¼šè‡ªåŠ¨å»è°ƒç”¨<code>b</code>å¯¹è±¡ä¸­çš„<code>__str__</code>æ–¹æ³•</p>
<h1 id="dict"><a href="#dict" class="headerlink" title="__dict__"></a>__dict__</h1><h2 id="å¯¹è±¡çš„dict"><a href="#å¯¹è±¡çš„dict" class="headerlink" title="å¯¹è±¡çš„dict"></a>å¯¹è±¡çš„dict</h2><p>åœ¨å¯¹è±¡ä¸­é»˜è®¤å·²ç»æœ‰dictï¼Œä¸éœ€è¦è‡ªå®šä¹‰ã€‚è¯¥æ–¹æ³•ç”¨æ¥è·å–å¯¹è±¡ä¸­æ‰€æœ‰å°è£…çš„å¯¹è±¡</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, age)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.name</span><br><span class="line"></span><br><span class="line">b = B(<span class="string">"ps"</span>, <span class="number">26</span>)</span><br><span class="line">print(b.__dict__)</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">&#123;<span class="string">'age'</span>: <span class="number">26</span>, <span class="string">'name'</span>: <span class="string">'ps'</span>&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ç±»çš„dict"><a href="#ç±»çš„dict" class="headerlink" title="ç±»çš„dict"></a>ç±»çš„dict</h2><p>åˆ—å‡ºç±»ä¸­æ‰€æœ‰å¯ä»¥è°ƒç”¨çš„æ–¹æ³•</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, age)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.name</span><br><span class="line"></span><br><span class="line">b = B(<span class="string">"ps"</span>, <span class="number">26</span>)</span><br><span class="line">print(B.__dict__)</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">&#123;<span class="string">'__weakref__'</span>: &lt;attribute <span class="string">'__weakref__'</span> of <span class="string">'B'</span> objects&gt;, <span class="string">'__module__'</span>: <span class="string">'__main__'</span>, <span class="string">'__str__'</span>: &lt;function B.__str__ at <span class="number">0x10137b730</span>&gt;, <span class="string">'__init__'</span>: &lt;function B.__init__ at <span class="number">0x10137b6a8</span>&gt;, <span class="string">'__doc__'</span>: <span class="literal">None</span>, <span class="string">'__dict__'</span>: &lt;attribute <span class="string">'__dict__'</span> of <span class="string">'B'</span> objects&gt;&#125;</span><br></pre></td></tr></table></figure>

<h1 id="add"><a href="#add" class="headerlink" title="__add__"></a>__add__</h1><p>å½“æ‰§è¡Œ<code>ä¸€ä¸ªå¯¹è±¡ + ä¸€ä¸ªå¯¹è±¡</code>çš„æ—¶å€™ï¼Œå°±ä¼šè‡ªåŠ¨å»æ‰§è¡Œè¿™ä¸ªæ–¹æ³•</p>
<p>æ³¨æ„ï¼Œæ‰§è¡Œçš„æ˜¯ç¬¬ä¸€ä¸ªå¯¹è±¡çš„addæ–¹æ³•</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, num)</span>:</span></span><br><span class="line">        self.num = num</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__add__</span><span class="params">(self, other)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.num + other.num</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, num)</span>:</span></span><br><span class="line">        self.num = num</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">a = A(<span class="number">5</span>)</span><br><span class="line">b = B(<span class="number">9</span>)</span><br><span class="line">c = a + b</span><br><span class="line">print(c)</span><br></pre></td></tr></table></figure>

<h1 id="getitem-setitem-delitem"><a href="#getitem-setitem-delitem" class="headerlink" title="__getitem__ __setitem__ __delitem__"></a>__getitem__ __setitem__ __delitem__</h1><p>ç”¨äºç´¢å¼•æ“ä½œï¼Œå¦‚å­—å…¸ã€‚ä»¥ä¸Šåˆ†åˆ«è¡¨ç¤ºè·å–ã€è®¾ç½®ã€åˆ é™¤æ•°æ®</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">d = &#123;<span class="string">"k"</span>: <span class="string">"v"</span>&#125;</span><br><span class="line">print(d[<span class="string">"k"</span>])</span><br><span class="line">d[<span class="string">"k"</span>] = <span class="string">"vv"</span></span><br><span class="line"><span class="keyword">del</span> d[<span class="string">"k"</span>]</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„ä»£ç å±•ç¤ºäº†ä¸€ä¸ªå­—å…¸å¯¹è±¡çš„å–å€¼ã€èµ‹å€¼å’Œåˆ é™¤çš„æ“ä½œã€‚åœ¨è‡ªå®šä¹‰çš„ç±»ä¸­ï¼Œä¹Ÿå¯ä»¥å®ç°ç±»ä¼¼äºå­—å…¸è¿™æ ·çš„æ“ä½œ</p>
<p>å¯¹è±¡åé¢åŠ å°æ‹¬å·æ˜¯æ‰§è¡Œ<code>__call__</code>æ–¹æ³•ï¼Œé‚£ä¹ˆå¯¹è±¡åé¢åŠ ä¸­æ‹¬å·åˆæ˜¯æ€æ ·å¤„ç†çš„å‘¢ï¼Ÿ</p>
<h2 id="ä½¿ç”¨keyè¿›è¡Œçš„æ“ä½œ"><a href="#ä½¿ç”¨keyè¿›è¡Œçš„æ“ä½œ" class="headerlink" title="ä½¿ç”¨keyè¿›è¡Œçš„æ“ä½œ"></a>ä½¿ç”¨keyè¿›è¡Œçš„æ“ä½œ</h2><h3 id="å–å€¼"><a href="#å–å€¼" class="headerlink" title="å–å€¼"></a>å–å€¼</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, age)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getitem__</span><span class="params">(self, item)</span>:</span></span><br><span class="line">        print(<span class="string">"æ‰§è¡Œäº†getitemæ–¹æ³•"</span>, item)</span><br><span class="line"></span><br><span class="line">b = B(<span class="string">"ps"</span>, <span class="number">26</span>)</span><br><span class="line">b[<span class="string">"name"</span>]</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">æ‰§è¡Œäº†getitemæ–¹æ³• name</span><br></pre></td></tr></table></figure>

<h3 id="èµ‹å€¼"><a href="#èµ‹å€¼" class="headerlink" title="èµ‹å€¼"></a>èµ‹å€¼</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, age)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getitem__</span><span class="params">(self, item)</span>:</span></span><br><span class="line">        print(<span class="string">"æ‰§è¡Œäº†getitemæ–¹æ³•"</span>, item)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__setitem__</span><span class="params">(self, key, value)</span>:</span></span><br><span class="line">        print(<span class="string">"ä½ è¦ä¸º%sé‡æ–°èµ‹å€¼ä¸º%s"</span> % (key, value))</span><br><span class="line"></span><br><span class="line">b = B(<span class="string">"ps"</span>, <span class="number">26</span>)</span><br><span class="line">print(b.name)</span><br><span class="line">b[<span class="string">"name"</span>] = <span class="string">"lr"</span></span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">ps</span><br><span class="line">ä½ è¦ä¸ºnameé‡æ–°èµ‹å€¼ä¸ºlr</span><br></pre></td></tr></table></figure>

<h3 id="åˆ é™¤"><a href="#åˆ é™¤" class="headerlink" title="åˆ é™¤"></a>åˆ é™¤</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, age)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getitem__</span><span class="params">(self, item)</span>:</span></span><br><span class="line">        print(<span class="string">"æ‰§è¡Œäº†getitemæ–¹æ³•"</span>, item)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__setitem__</span><span class="params">(self, key, value)</span>:</span></span><br><span class="line">        print(<span class="string">"ä½ è¦ä¸º%sé‡æ–°èµ‹å€¼ä¸º%s"</span> % (key, value))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__delitem__</span><span class="params">(self, key)</span>:</span></span><br><span class="line">        print(<span class="string">"ä½ è¦åˆ é™¤%s"</span> % key)</span><br><span class="line"></span><br><span class="line">b = B(<span class="string">"ps"</span>, <span class="number">26</span>)</span><br><span class="line"><span class="keyword">del</span> b[<span class="string">"age"</span>]</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">ä½ è¦åˆ é™¤age</span><br></pre></td></tr></table></figure>

<p>åœ¨webå¼€å‘ä¸­ï¼Œè‡ªå®šä¹‰sessionæ¡†æ¶çš„æ—¶å€™ä¼šç”¨åˆ°</p>
<h2 id="ä½¿ç”¨ä¸‹æ ‡è¿›è¡Œçš„æ“ä½œ"><a href="#ä½¿ç”¨ä¸‹æ ‡è¿›è¡Œçš„æ“ä½œ" class="headerlink" title="ä½¿ç”¨ä¸‹æ ‡è¿›è¡Œçš„æ“ä½œ"></a>ä½¿ç”¨ä¸‹æ ‡è¿›è¡Œçš„æ“ä½œ</h2><p>ä½¿ç”¨ä¸‹æ ‡å’Œä½¿ç”¨keyçš„å½¢å¼ç±»ä¼¼ï¼Œä½¿ç”¨keyï¼Œ itemæ¥æ”¶çš„æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä½¿ç”¨ä¸‹æ ‡ï¼Œ itemæ¥æ”¶çš„æ˜¯ä¸€ä¸ªintç±»å‹çš„æ•°å­—ï¼Œå¯ä»¥åœ¨æ–¹æ³•ä½“å†…é€šè¿‡åˆ¤æ–­ä¼ é€’è¿‡æ¥æ•°æ®çš„æ•°æ®ç±»å‹æ¥è¿›è¡Œå¯¹åº”çš„æ“ä½œ</p>
<h2 id="ä½¿ç”¨åˆ‡ç‰‡çš„æ“ä½œ"><a href="#ä½¿ç”¨åˆ‡ç‰‡çš„æ“ä½œ" class="headerlink" title="ä½¿ç”¨åˆ‡ç‰‡çš„æ“ä½œ"></a>ä½¿ç”¨åˆ‡ç‰‡çš„æ“ä½œ</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">l = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>]</span><br><span class="line">l[<span class="number">1</span>:<span class="number">5</span>:<span class="number">2</span>]</span><br></pre></td></tr></table></figure>

<p>åœ¨Python2.xä¸­ä½¿ç”¨<code>__getslice__</code> <code>__setslice__</code> <code>__delslice__</code>æ¥å®ç°åˆ‡ç‰‡çš„æ“ä½œï¼Œä½†æ˜¯Python3.xä¸­è¢«é—å¼ƒï¼Œæ‰€æœ‰åˆ‡ç‰‡çš„åŠŸèƒ½éƒ½é›†ä¸­åœ¨äº†<code>__getitem__</code> <code>__setitem__</code> <code>__delitem__</code>ä¸­</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, age)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getitem__</span><span class="params">(self, item)</span>:</span></span><br><span class="line">        <span class="comment"># print("æ‰§è¡Œäº†getitemæ–¹æ³•", item)</span></span><br><span class="line">        print(type(item))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__setitem__</span><span class="params">(self, key, value)</span>:</span></span><br><span class="line">        print(<span class="string">"ä½ è¦ä¸º%sé‡æ–°èµ‹å€¼ä¸º%s"</span> % (key, value))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__delitem__</span><span class="params">(self, key)</span>:</span></span><br><span class="line">        print(<span class="string">"ä½ è¦åˆ é™¤%s"</span> % key)</span><br><span class="line"></span><br><span class="line">b = B(<span class="string">"ps"</span>, <span class="number">26</span>)</span><br><span class="line">b[<span class="string">"name"</span>]</span><br><span class="line">b[<span class="number">1</span>]</span><br><span class="line">b[<span class="number">1</span>:<span class="number">5</span>:<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">str</span>'&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">class</span> '<span class="title">int</span>'&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">class</span> '<span class="title">slice</span>'&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>item</code>ä¸º<code>slice</code>æ—¶è¡¨ç¤ºè°ƒç”¨äº†åˆ‡ç‰‡çš„æ“ä½œ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, age)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getitem__</span><span class="params">(self, item)</span>:</span></span><br><span class="line">        print(<span class="string">"èµ·ç‚¹ç´¢å¼•"</span>, item.start)</span><br><span class="line">        print(<span class="string">"ç»ˆç‚¹ç´¢å¼•"</span>, item.stop)</span><br><span class="line">        print(<span class="string">"æ­¥é•¿"</span>, item.step)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"haha"</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__setitem__</span><span class="params">(self, key, value)</span>:</span></span><br><span class="line">        print(<span class="string">"ä½ è¦ä¸º%sé‡æ–°èµ‹å€¼ä¸º%s"</span> % (key, value))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__delitem__</span><span class="params">(self, key)</span>:</span></span><br><span class="line">        print(<span class="string">"ä½ è¦åˆ é™¤%s"</span> % key)</span><br><span class="line"></span><br><span class="line">b = B(<span class="string">"ps"</span>, <span class="number">26</span>)</span><br><span class="line">ret = b[<span class="number">1</span>:<span class="number">5</span>:<span class="number">2</span>]</span><br><span class="line">print(ret)</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">èµ·ç‚¹ç´¢å¼• <span class="number">1</span></span><br><span class="line">ç»ˆç‚¹ç´¢å¼• <span class="number">5</span></span><br><span class="line">æ­¥é•¿ <span class="number">2</span></span><br><span class="line">haha</span><br></pre></td></tr></table></figure>

<p>ç›¸å¯¹åº”çš„ï¼Œå–å€¼å¯ä»¥é€šè¿‡åˆ¤æ–­itemçš„ç±»å‹åšç›¸åº”çš„æ“ä½œï¼Œèµ‹å€¼å’Œåˆ é™¤ä¹Ÿå¯ä»¥é€šè¿‡åˆ¤æ–­keyçš„ç±»å‹æ¥è¿›è¡Œæƒ³å¯¹åº”çš„åˆ‡ç‰‡æ“ä½œ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, age)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getitem__</span><span class="params">(self, item)</span>:</span></span><br><span class="line">        print(<span class="string">"èµ·ç‚¹ç´¢å¼•"</span>, item.start)</span><br><span class="line">        print(<span class="string">"ç»ˆç‚¹ç´¢å¼•"</span>, item.stop)</span><br><span class="line">        print(<span class="string">"æ­¥é•¿"</span>, item.step)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"haha"</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__setitem__</span><span class="params">(self, key, value)</span>:</span></span><br><span class="line">        print(<span class="string">"èµ·ç‚¹ç´¢å¼•"</span>, key.start)</span><br><span class="line">        print(<span class="string">"ç»ˆç‚¹ç´¢å¼•"</span>, key.stop)</span><br><span class="line">        print(<span class="string">"æ­¥é•¿"</span>, key.step)</span><br><span class="line">        print(<span class="string">"æ–°å€¼ä¸º"</span>, value)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__delitem__</span><span class="params">(self, key)</span>:</span></span><br><span class="line">        print(<span class="string">"èµ·ç‚¹ç´¢å¼•"</span>, key.start)</span><br><span class="line">        print(<span class="string">"ç»ˆç‚¹ç´¢å¼•"</span>, key.stop)</span><br><span class="line">        print(<span class="string">"æ­¥é•¿"</span>, key.step)</span><br><span class="line"></span><br><span class="line">b = B(<span class="string">"ps"</span>, <span class="number">26</span>)</span><br><span class="line">print(<span class="string">"åˆ‡ç‰‡å–å€¼"</span>)</span><br><span class="line">ret = b[<span class="number">1</span>:<span class="number">5</span>:<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">print(<span class="string">"åˆ‡ç‰‡èµ‹å€¼"</span>)</span><br><span class="line">b[<span class="number">1</span>:<span class="number">5</span>:<span class="number">2</span>] = <span class="string">"hehe"</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">"åˆ‡ç‰‡åˆ é™¤"</span>)</span><br><span class="line">print(ret)</span><br><span class="line"><span class="keyword">del</span> b[<span class="number">1</span>:<span class="number">5</span>:<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">åˆ‡ç‰‡å–å€¼</span><br><span class="line">èµ·ç‚¹ç´¢å¼• <span class="number">1</span></span><br><span class="line">ç»ˆç‚¹ç´¢å¼• <span class="number">5</span></span><br><span class="line">æ­¥é•¿ <span class="number">2</span></span><br><span class="line">åˆ‡ç‰‡èµ‹å€¼</span><br><span class="line">èµ·ç‚¹ç´¢å¼• <span class="number">1</span></span><br><span class="line">ç»ˆç‚¹ç´¢å¼• <span class="number">5</span></span><br><span class="line">æ­¥é•¿ <span class="number">2</span></span><br><span class="line">æ–°å€¼ä¸º hehe</span><br><span class="line">åˆ‡ç‰‡åˆ é™¤</span><br><span class="line">haha</span><br><span class="line">èµ·ç‚¹ç´¢å¼• <span class="number">1</span></span><br><span class="line">ç»ˆç‚¹ç´¢å¼• <span class="number">5</span></span><br><span class="line">æ­¥é•¿ <span class="number">2</span></span><br></pre></td></tr></table></figure>

<h1 id="iter"><a href="#iter" class="headerlink" title="__iter__"></a>__iter__</h1><p>ä¸€ä¸ªè‡ªå®šä¹‰ç±»å®ä¾‹åŒ–çš„å¯¹è±¡ï¼Œé»˜è®¤æ˜¯ä¸å¯è¿­ä»£çš„ï¼Œåœ¨ç±»ä¸­ä½¿ç”¨<code>__iter__</code>æ–¹æ³•åï¼Œå¯¹è±¡å°±å˜æˆäº†å¯è¿­ä»£å¯¹è±¡ã€‚å½“å¯¹è±¡è¢«è¿­ä»£æ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨iteræ–¹æ³•</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">a = A()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a:</span><br><span class="line">    print(i)</span><br><span class="line">    </span><br><span class="line">------------</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"/Users/lvrui/PycharmProjects/untitled/8/c8.py"</span>, line <span class="number">5</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> a:</span><br><span class="line">TypeError: <span class="string">'A'</span> object <span class="keyword">is</span> <span class="keyword">not</span> iterable</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> iter([<span class="number">1</span>, <span class="number">2</span>])  <span class="comment"># returnäº†ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡</span></span><br><span class="line"></span><br><span class="line">a = A()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a:</span><br><span class="line">    print(i)</span><br><span class="line">    </span><br><span class="line">------------</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span>  <span class="comment"># è¿”å›äº†ä¸€ä¸ªç”Ÿæˆå™¨</span></span><br><span class="line">        <span class="keyword">yield</span> <span class="number">1</span></span><br><span class="line">        <span class="keyword">yield</span> <span class="number">2</span></span><br><span class="line"></span><br><span class="line">a = A()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a:</span><br><span class="line">    print(i)</span><br><span class="line">    </span><br><span class="line">------------</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br></pre></td></tr></table></figure>

<p>å…ˆå»aå¯¹è±¡ä¸­æ‰¾åˆ°iteræ–¹æ³•æ‰§è¡Œï¼Œå¹¶æ‹¿åˆ°è¿”å›å€¼è¿›è¡Œè¿­ä»£</p>
<h1 id="new-metaclass"><a href="#new-metaclass" class="headerlink" title="__new__ __metaclass__"></a>__new__ __metaclass__</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span><span class="params">(object)</span>:</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"> </span><br><span class="line">a = A()   <span class="comment"># aæ˜¯é€šè¿‡Aç±»å®ä¾‹åŒ–çš„å¯¹è±¡</span></span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°ä»£ç ä¸­ï¼Œa æ˜¯é€šè¿‡ A ç±»å®ä¾‹åŒ–çš„å¯¹è±¡ï¼Œå…¶å®ï¼Œä¸ä»… a æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒAç±»æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå› ä¸ºåœ¨Pythonä¸­ä¸€åˆ‡äº‹ç‰©éƒ½æ˜¯å¯¹è±¡ã€‚</p>
<p>å¦‚æœæŒ‰ç…§ä¸€åˆ‡äº‹ç‰©éƒ½æ˜¯å¯¹è±¡çš„ç†è®ºï¼šaå¯¹è±¡æ˜¯é€šè¿‡æ‰§è¡ŒAç±»çš„æ„é€ æ–¹æ³•åˆ›å»ºï¼Œé‚£ä¹ˆAç±»å¯¹è±¡åº”è¯¥ä¹Ÿæ˜¯é€šè¿‡æ‰§è¡ŒæŸä¸ªç±»çš„æ„é€ æ–¹æ³•åˆ›å»ºã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">print</span> type(a) <span class="comment"># è¾“å‡ºï¼š&lt;class '__main__.A'&gt;     è¡¨ç¤ºï¼Œaå¯¹è±¡ç”±Aç±»åˆ›å»º</span></span><br><span class="line"><span class="keyword">print</span> type(A) <span class="comment"># è¾“å‡ºï¼š&lt;type 'type'&gt;              è¡¨ç¤ºï¼ŒAç±»å¯¹è±¡ç”±typeç±»åˆ›å»º</span></span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥ï¼Œaå¯¹è±¡æ˜¯Aç±»çš„ä¸€ä¸ªå®ä¾‹ï¼ŒAç±»å¯¹è±¡æ˜¯<code>type</code>ç±»çš„ä¸€ä¸ªå®ä¾‹ï¼Œå³ï¼šAç±»å¯¹è±¡æ˜¯é€šè¿‡<code>type</code>ç±»çš„æ„é€ æ–¹æ³•åˆ›å»º</p>
<p>é‚£ä¹ˆï¼Œåˆ›å»ºç±»å°±å¯ä»¥æœ‰ä¸¤ç§æ–¹å¼ï¼š</p>
<ul>
<li>æ™®é€šæ–¹å¼</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span><span class="params">(object)</span>:</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"ps"</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>ç‰¹æ®Šæ–¹å¼ï¼ˆtypeç±»çš„æ„é€ å‡½æ•°ï¼‰</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(self)</span>:</span></span><br><span class="line">    print(<span class="string">"ps"</span>)</span><br><span class="line"> </span><br><span class="line">A = type(<span class="string">'A'</span>,(object,), &#123;<span class="string">'func'</span>: func&#125;)</span><br><span class="line"><span class="comment">#typeç¬¬ä¸€ä¸ªå‚æ•°ï¼šç±»å</span></span><br><span class="line"><span class="comment">#typeç¬¬äºŒä¸ªå‚æ•°ï¼šå½“å‰ç±»çš„åŸºç±»</span></span><br><span class="line"><span class="comment">#typeç¬¬ä¸‰ä¸ªå‚æ•°ï¼šç±»çš„æˆå‘˜</span></span><br></pre></td></tr></table></figure>

<p><strong>â€“&gt; ç±»æ˜¯ç”±typeç±»å®ä¾‹åŒ–äº§ç”Ÿ</strong></p>
<p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œç±»é»˜è®¤æ˜¯ç”± type ç±»å®ä¾‹åŒ–äº§ç”Ÿï¼Œtypeç±»ä¸­å¦‚ä½•å®ç°çš„åˆ›å»ºç±»ï¼Ÿç±»åˆæ˜¯å¦‚ä½•åˆ›å»ºå¯¹è±¡ï¼Ÿ</p>
<p>ç­”ï¼šç±»ä¸­æœ‰ä¸€ä¸ªå±æ€§<code>__metaclass__</code> å…¶ç”¨æ¥è¡¨ç¤ºè¯¥ç±»ç”±<code>è°</code>æ¥å®ä¾‹åŒ–åˆ›å»ºï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥ä¸º<code>__metaclass__</code>è®¾ç½®ä¸€ä¸ªtypeç±»çš„æ´¾ç”Ÿç±»ï¼Œä»è€ŒæŸ¥çœ‹<code>ç±»</code>åˆ›å»ºçš„è¿‡ç¨‹</p>
<p><img src="http://oss.20150509.cn/QQ20160703-1.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyType</span><span class="params">(type)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, what, bases=None, dict=None)</span>:</span></span><br><span class="line">        super(MyType, self).__init__(what, bases, dict)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(self, *args, **kwargs)</span>:</span></span><br><span class="line">        obj = self.__new__(self, *args, **kwargs)</span><br><span class="line"></span><br><span class="line">        self.__init__(obj)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    __metaclass__ = MyType</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span><span class="params">(cls, *args, **kwargs)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> object.__new__(cls, *args, **kwargs)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¬¬ä¸€é˜¶æ®µï¼šè§£é‡Šå™¨ä»ä¸Šåˆ°ä¸‹æ‰§è¡Œä»£ç åˆ›å»ºAç±»</span></span><br><span class="line"><span class="comment"># ç¬¬äºŒé˜¶æ®µï¼šé€šè¿‡Aç±»åˆ›å»ºaå¯¹è±¡</span></span><br><span class="line">a = A()</span><br></pre></td></tr></table></figure>





]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>é¢å‘å¯¹è±¡</tag>
        <tag>__init__</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonç±»æˆå‘˜ä¹‹æˆå‘˜ä¿®é¥°ç¬¦</title>
    <url>/2016/07/03/Python%E7%B1%BB%E6%88%90%E5%91%98%E4%B9%8B%E6%88%90%E5%91%98%E4%BF%AE%E9%A5%B0%E7%AC%A6/</url>
    <content><![CDATA[<blockquote>
<p>Pythonä¸­çš„æˆå‘˜ä¿®é¥°ç¬¦æ¯”Javaä¸­å°‘äº†2ä¸ªã€‚åªæœ‰å…¬æœ‰å’Œç§æœ‰ä¸¤ç§</p>
<p>Python Version: 3.5+</p>
</blockquote>
<p>æˆå‘˜ä¿®é¥°ç¬¦æ˜¯ç”¨æ¥è®¾ç½®å­—æ®µã€æ–¹æ³•å’Œå±æ€§çš„ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæˆå‘˜æ˜¯å…¬æœ‰çš„</p>
<h1 id="å…¬æœ‰"><a href="#å…¬æœ‰" class="headerlink" title="å…¬æœ‰"></a>å…¬æœ‰</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(self.name)  <span class="comment"># åœ¨ç±»çš„å†…éƒ¨è¿›è¡Œè®¿é—®</span></span><br><span class="line"></span><br><span class="line">c = C(<span class="string">"ps"</span>)</span><br><span class="line">print(c.name)  <span class="comment"># åœ¨ç±»çš„å¤–éƒ¨è¿›è¡Œè®¿é—®</span></span><br><span class="line">c.func()</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">ps</span><br><span class="line">ps</span><br></pre></td></tr></table></figure>

<p>åƒä»¥ä¸Šä»£ç é‚£æ ·ï¼Œå­—æ®µä»ç±»çš„å†…éƒ¨å’Œå¤–éƒ¨éƒ½å¯ä»¥è®¿é—®çš„æƒ…å†µï¼Œæˆå‘˜ä¿®é¥°ç¬¦å°±æ˜¯å…¬æœ‰çš„</p>
<h1 id="ç§æœ‰"><a href="#ç§æœ‰" class="headerlink" title="ç§æœ‰"></a>ç§æœ‰</h1><p>åœ¨ç±»ä¸­çš„æˆå‘˜åå‰é¢åŠ ä¸Šä¸¤ä¸ªä¸‹åˆ’çº¿<code>__</code>ï¼Œå°±å¯ä»¥å°†è¯¥æˆå‘˜çš„å±æ€§è®¾ç½®ä¸ºç§æœ‰ã€‚ç§æœ‰çš„æˆå‘˜åªæœ‰ä»ç±»çš„å†…éƒ¨è®¿é—®çš„æƒé™ï¼Œå‡ºäº†è¯¥ç±»çš„å†…éƒ¨ï¼Œå…¶ä»–ä»»ä½•åœ°æ–¹éƒ½ä¸å…è®¸è®¿é—®ï¼ŒåŒ…æ‹¬è¯¥ç±»çš„æ´¾ç”Ÿç±»</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        self.__name = name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(self.__name)  <span class="comment"># åœ¨ç±»çš„å†…éƒ¨è¿›è¡Œè®¿é—®</span></span><br><span class="line"></span><br><span class="line">c = C(<span class="string">"ps"</span>)</span><br><span class="line">print(c.__name)  <span class="comment"># åœ¨ç±»çš„å¤–éƒ¨è¿›è¡Œè®¿é—®</span></span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"/Users/lvrui/PycharmProjects/untitled/8/c5.py"</span>, line <span class="number">9</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    print(c.name)  <span class="comment"># åœ¨ç±»çš„å¤–éƒ¨è¿›è¡Œè®¿é—®</span></span><br><span class="line">AttributeError: <span class="string">'C'</span> object has no attribute <span class="string">'name'</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        self.__name = name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(self.__name)  <span class="comment"># åœ¨ç±»çš„å†…éƒ¨è¿›è¡Œè®¿é—®</span></span><br><span class="line"></span><br><span class="line">c = C(<span class="string">"ps"</span>)</span><br><span class="line">c.func()  <span class="comment"># åªèƒ½é€šè¿‡è¯¥æ–¹æ³•ï¼Œä»ç±»çš„å†…éƒ¨è¿›è¡Œè®¿é—®</span></span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">ps</span><br></pre></td></tr></table></figure>

<h1 id="Pythonè®¿é—®ç§æœ‰æˆå‘˜çš„åé—¨"><a href="#Pythonè®¿é—®ç§æœ‰æˆå‘˜çš„åé—¨" class="headerlink" title="Pythonè®¿é—®ç§æœ‰æˆå‘˜çš„åé—¨"></a>Pythonè®¿é—®ç§æœ‰æˆå‘˜çš„åé—¨</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        self.__name = name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(self.__name)  <span class="comment"># åœ¨ç±»çš„å†…éƒ¨è¿›è¡Œè®¿é—®</span></span><br><span class="line"></span><br><span class="line">c = C(<span class="string">"ps"</span>)</span><br><span class="line"><span class="comment"># print(c.__name)  # åœ¨ç±»çš„å¤–éƒ¨è¿›è¡Œè®¿é—®</span></span><br><span class="line">print(c._C__name)</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡<code>_ç±»å__æˆå‘˜å</code>è¿™æ ·çš„è¯­æ³•æ ¼å¼æ¥å¼ºåˆ¶è®¿é—®ç±»ä¸­çš„ç§æœ‰æˆå‘˜</p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>é¢å‘å¯¹è±¡</tag>
        <tag>æˆå‘˜ä¿®é¥°ç¬¦</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythoné¢å‘å¯¹è±¡ä¸­ç±»çš„æˆå‘˜</title>
    <url>/2016/07/03/Python%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E4%B8%AD%E7%B1%BB%E7%9A%84%E6%88%90%E5%91%98/</url>
    <content><![CDATA[<blockquote>
<p>Pythoné¢å‘å¯¹è±¡ä¸­ç±»çš„æˆå‘˜æ€»å…±æœ‰ä¸‰ç§ï¼Œåˆ†åˆ«æ˜¯å­—æ®µã€æ–¹æ³•å’Œå±æ€§</p>
<p>Python Version: 3.5+</p>
</blockquote>
<h1 id="å­—æ®µ"><a href="#å­—æ®µ" class="headerlink" title="å­—æ®µ"></a>å­—æ®µ</h1><h2 id="æ™®é€šå­—æ®µ"><a href="#æ™®é€šå­—æ®µ" class="headerlink" title="æ™®é€šå­—æ®µ"></a>æ™®é€šå­—æ®µ</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">		<span class="comment"># æˆ‘å°±æ˜¯å­—æ®µï¼Œæ™®é€šå­—æ®µ</span></span><br><span class="line">		self.name = <span class="string">"polarsnow"</span></span><br><span class="line">		</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(self)</span>:</span></span><br><span class="line">		print(self.name)</span><br><span class="line">		<span class="keyword">return</span> self.name</span><br></pre></td></tr></table></figure>

<p>åœ¨ä¸Šé¢çš„ä»£ç å—ä¸­ï¼Œ<code>self.name</code>å°±æ˜¯ç±»ä¸­çš„å­—æ®µã€‚è¯¥å­—æ®µçš„ä¿¡æ¯ä¼šä¿å­˜åœ¨æ¯ä¸€ä¸ªå®ä¾‹åŒ–çš„å¯¹è±¡ä¸­</p>
<h2 id="é™æ€å­—æ®µ"><a href="#é™æ€å­—æ®µ" class="headerlink" title="é™æ€å­—æ®µ"></a>é™æ€å­—æ®µ</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">	<span class="comment"># æˆ‘ä¹Ÿæ˜¯å­—æ®µï¼Œæˆ‘æ˜¯é™æ€å­—æ®µ</span></span><br><span class="line">	country = <span class="string">"China"</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">		<span class="comment"># æˆ‘å°±æ˜¯å­—æ®µï¼Œæ™®é€šå­—æ®µ</span></span><br><span class="line">		self.name = <span class="string">"polarsnow"</span></span><br><span class="line">		</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(self)</span>:</span></span><br><span class="line">		print(self.name)</span><br><span class="line">		<span class="keyword">return</span> self.name</span><br></pre></td></tr></table></figure>

<p>é™æ€å­—æ®µä¿å­˜åœ¨ç±»ä¸­ã€‚æ¯ä¸ªå®ä¾‹åŒ–çš„ç±»ä¸­ï¼Œéƒ½ä¿å­˜äº†ä¸€ä¸ªç±»å¯¹è±¡æŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªç±»ã€‚æ¯ä¸ªå¯¹è±¡è‡ªå·±å°è£…äº†è‡ªå·±çš„æ™®é€šå­—æ®µä¿¡æ¯ï¼Œä½†æ˜¯è¯¥ç±»æ‰€æœ‰çš„å¯¹è±¡éƒ½å…±ç”¨äº†ä¸€ä»½å„¿é™æ€å­—æ®µã€‚</p>
<p>é™æ€å­—æ®µçš„åº”ç”¨åœºæ™¯å’Œå¥½å¤„æ˜¯æŸä¸ªç±»ä¸­ï¼Œå…±ç”¨çš„ä¸€äº›ä¿¡æ¯å¯ä»¥æŠ½ç¦»å‡ºæ¥å½“åšé™æ€å­—æ®µï¼Œå¥½å¤„æ˜¯æ¯ä¸ªå¯¹è±¡å¯ä»¥ä¸ç”¨å†é‡å¤æ€§çš„ä¿å­˜åŒä¸€ä»½æ•°æ®ã€‚</p>
<h2 id="å­—æ®µè®¿é—®è§„åˆ™"><a href="#å­—æ®µè®¿é—®è§„åˆ™" class="headerlink" title="å­—æ®µè®¿é—®è§„åˆ™"></a>å­—æ®µè®¿é—®è§„åˆ™</h2><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼šè‡ªå·±å»è®¿é—®è‡ªå·±çš„å­—æ®µ</p>
<p>ä¾‹å¦‚ï¼šè®¿é—®é™æ€å­—æ®µï¼Œå‰é¢æåˆ°äº†ï¼Œé™æ€å­—æ®µä¿å­˜åœ¨ç±»ä¸­ï¼Œæ‰€ä»¥åŸåˆ™ä¸Šéœ€è¦ä½¿ç”¨ç±»å»è®¿é—®é™æ€å­—æ®µï¼›å¦‚æœè®¿é—®æ™®é€šå­—æ®µï¼Œæ™®é€šå­—æ®µä¿å­˜åœ¨å¯¹è±¡ä¸­ï¼Œæ‰€ä»¥åªèƒ½ä½¿ç”¨å¯¹è±¡å»è®¿é—®æ™®é€šå­—æ®µã€‚</p>
<p>åœ¨Javaä¸­ï¼Œå¼ºåˆ¶æ€§çš„è¦æ±‚é™æ€å­—æ®µåªèƒ½ç”±ç±»å»è®¿é—®ï¼›ä½†æ˜¯åœ¨Pythonä¸­æ¯”è¾ƒç‰¹æ®Šï¼Œç±»ä¸­çš„é™æ€å­—æ®µä¹Ÿæ˜¯å¯ä»¥é€šè¿‡å¯¹è±¡å»è®¿é—®çš„ã€‚ä½ éœ€è¦åšæŒçš„åŸåˆ™å°±æ˜¯ï¼šè‡ªå·±å»è®¿é—®è‡ªå·±çš„å­—æ®µã€‚ä¸åˆ°ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œä¸è¦ä½¿ç”¨å¯¹è±¡å»è®¿é—®ç±»ä¸­çš„é™æ€å­—æ®µ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">    <span class="comment"># æˆ‘ä¹Ÿæ˜¯å­—æ®µï¼Œæˆ‘æ˜¯é™æ€å­—æ®µ</span></span><br><span class="line">    country = <span class="string">"China"</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        <span class="comment"># æˆ‘å°±æ˜¯å­—æ®µï¼Œæ™®é€šå­—æ®µ</span></span><br><span class="line">        self.name = <span class="string">"polarsnow"</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(self.name)</span><br><span class="line">        <span class="keyword">return</span> self.name</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">a = A(<span class="string">"polarsnow"</span>)</span><br><span class="line">print(<span class="string">"ä½¿ç”¨å¯¹è±¡è®¿é—®æ™®é€šå­—æ®µ"</span>)</span><br><span class="line">print(a.name)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"ä½¿ç”¨ç±»è®¿é—®é™æ€å­—æ®µ"</span>)</span><br><span class="line">print(A.country)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"ä½¿ç”¨å¯¹è±¡è®¿é—®é™æ€å­—æ®µ"</span>)</span><br><span class="line">print(a.country)</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">ä½¿ç”¨å¯¹è±¡è®¿é—®æ™®é€šå­—æ®µ</span><br><span class="line">polarsnow</span><br><span class="line">ä½¿ç”¨ç±»è®¿é—®é™æ€å­—æ®µ</span><br><span class="line">China</span><br><span class="line">ä½¿ç”¨å¯¹è±¡è®¿é—®é™æ€å­—æ®µ</span><br><span class="line">China</span><br></pre></td></tr></table></figure>

<p><img src="http://oss.20150509.cn/QQ20160703-0.png" alt=""></p>
<p>ç”±äºæ¯ä¸ªå¯¹è±¡éƒ½ä¿å­˜äº†ç±»å¯¹è±¡æŒ‡é’ˆï¼Œå½“è®¿é—®çš„å­—æ®µåœ¨æœ¬å¯¹è±¡ä¸­æ‰¾ä¸åˆ°çš„æ—¶å€™ä¼šå»ç±»ä¸­æŸ¥æ‰¾æœ‰æ²¡æœ‰å¯¹åº”çš„é™æ€å­—æ®µ</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>é™æ€å­—æ®µåœ¨ä»£ç åŠ è½½çš„æ—¶å€™å°±å·²ç»è¢«åˆ›å»ºï¼›è€Œæ™®é€šå­—æ®µåªæœ‰åœ¨å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡æ—¶å€™æ‰è¢«åˆ›å»º</p>
<p>åœ¨ç±»çš„å†…éƒ¨è®¿é—®é™æ€å­—æ®µï¼Œæ¨èä¹Ÿå¸¦ä¸Šç±»åæ¥è®¿é—®<code>A.country</code>ç¬¦åˆä¸Šé¢è¯´çš„<code>è‡ªå·±å»è®¿é—®è‡ªå·±çš„å­—æ®µ</code>çš„è®¿é—®åŸåˆ™</p>
<h1 id="æ–¹æ³•"><a href="#æ–¹æ³•" class="headerlink" title="æ–¹æ³•"></a>æ–¹æ³•</h1><p>åœ¨å…¶ä»–é¢å‘å¯¹è±¡è¯­è¨€ä¸­ï¼Œç±»çš„æ–¹æ³•æœ‰ä¸¤ç§ï¼Œä½†æ˜¯åœ¨Pythonä¸­æœ‰ä¸‰ç§</p>
<h2 id="æ™®é€šæ–¹æ³•"><a href="#æ™®é€šæ–¹æ³•" class="headerlink" title="æ™®é€šæ–¹æ³•"></a>æ™®é€šæ–¹æ³•</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span>:</span></span><br><span class="line">    country = <span class="string">"China"</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æˆ‘æ˜¯æ™®é€šæ–¹æ³• ç”±å¯¹è±¡è°ƒç”¨çš„æ–¹æ³•</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(self.name)</span><br><span class="line">        <span class="keyword">return</span> self.name</span><br><span class="line"></span><br><span class="line">b = B(<span class="string">"åŒ—äº¬"</span>)</span><br><span class="line">b.show()</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">åŒ—äº¬</span><br></pre></td></tr></table></figure>

<p>æ™®é€šæ–¹æ³•ï¼Œç”±å¯¹è±¡å»è°ƒç”¨æ‰§è¡Œï¼ˆæ–¹æ³•å±äºç±»ï¼‰</p>
<h2 id="é™æ€æ–¹æ³•"><a href="#é™æ€æ–¹æ³•" class="headerlink" title="é™æ€æ–¹æ³•"></a>é™æ€æ–¹æ³•</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span>:</span></span><br><span class="line">    country = <span class="string">"China"</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æˆ‘æ˜¯æ™®é€šæ–¹æ³• ç”±å¯¹è±¡è°ƒç”¨çš„æ–¹æ³•</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(self.name)</span><br><span class="line">        <span class="keyword">return</span> self.name</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æˆ‘æ˜¯é™æ€æ–¹æ³•</span></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">func_static</span><span class="params">()</span>:</span></span><br><span class="line">        print(<span class="string">"æˆ‘æ˜¯é™æ€æ–¹æ³•"</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"æˆ‘æ˜¯é™æ€æ–¹æ³•"</span></span><br><span class="line"></span><br><span class="line">b = B(<span class="string">"åŒ—äº¬"</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"ä½¿ç”¨å¯¹è±¡å»è°ƒç”¨æ‰§è¡Œæ™®é€šæ–¹æ³•"</span>)</span><br><span class="line">b.show()</span><br><span class="line"></span><br><span class="line">print(<span class="string">"ä½¿ç”¨ç±»å»è°ƒç”¨é™æ€æ–¹æ³•"</span>)</span><br><span class="line">B.func_static()</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">ä½¿ç”¨å¯¹è±¡å»è°ƒç”¨æ‰§è¡Œæ™®é€šæ–¹æ³•</span><br><span class="line">åŒ—äº¬</span><br><span class="line">ä½¿ç”¨ç±»å»è°ƒç”¨é™æ€æ–¹æ³•</span><br><span class="line">æˆ‘æ˜¯é™æ€æ–¹æ³•</span><br></pre></td></tr></table></figure>

<p><strong>æ™®é€šæ–¹æ³•å’Œé™æ€æ–¹æ³•çš„åŒºåˆ«</strong>ï¼šåœ¨ä¸Šé¢çš„å­—æ®µä»‹ç»ä¸­ï¼Œé™æ€å­—æ®µå’Œæ™®é€šå­—æ®µçš„åŒºåˆ«æ˜¯ï¼Œé™æ€å­—æ®µä¸€èˆ¬ç”±ç±»å»è°ƒç”¨è€Œæ™®é€šå­—æ®µä¸€å®šæ˜¯ç”±å¯¹è±¡å»è°ƒç”¨ã€‚é™æ€æ–¹æ³•å’Œæ™®é€šæ–¹æ³•ä¹Ÿæ˜¯ä¸€æ ·ï¼Œé™æ€æ–¹æ³•ä¸€èˆ¬æ˜¯ç”±ç±»å»è°ƒç”¨æ‰§è¡Œï¼Œè€Œæ™®é€šæ–¹æ³•æ˜¯ç”±å¯¹è±¡å»è°ƒç”¨æ‰§è¡Œ</p>
<p><strong>å®šä¹‰ä¸€ä¸ªé™æ€æ–¹æ³•</strong></p>
<p>å®šä¹‰ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œé¦–å…ˆéœ€è¦åœ¨æ–¹æ³•ä¸Šé¢åŠ ä¸Šä¸€ä¸ªè£…é¥°å™¨<code>@staticmethod</code>ï¼Œä¸‹é¢çš„æ–¹æ³•å‚æ•°ä¸­ï¼Œä¸è¦å†å«æœ‰<code>self</code>å‚æ•°ã€‚è‡³äºé™æ€æ–¹æ³•çš„ç”¨æ³•ï¼Œå’Œæ™®é€šçš„å‡½æ•°ç”¨æ³•æ²¡æœ‰ä»»ä½•åŒºåˆ«ï¼Œåé¢å¯ä»¥æ·»åŠ ä»»æ„å‚æ•°è¿›è¡Œä¼ å€¼</p>
<p><strong>å°ç»“ï¼š</strong>é™æ€æ–¹æ³•è™½ç„¶åœ¨ç±»ä¸­ï¼Œå±äºç±»ï¼Œä½†æ˜¯é™æ€æ–¹æ³•å’Œå¯¹è±¡æ²¡æœ‰ä»»ä½•å…³ç³»ï¼Œå®ƒæ˜¯ç”±ç±»å»è°ƒç”¨çš„ã€‚è¿™ä¸€ç‚¹åœ¨é™æ€æ–¹æ³•çš„å‚æ•°åˆ—è¡¨ä¸­ä¹Ÿå¯ä»¥å¾ˆæ˜æ˜¾çš„çœ‹å‡ºï¼Œå®ƒæ²¡æœ‰æ¥å—selfå‚æ•°ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰æ¥å—å¯¹è±¡ã€‚é™æ€æ–¹æ³•çš„è°ƒç”¨ä¸ä¾èµ–ä¸ä»»ä½•ä¸€ä¸ªå…·ä½“çš„å¯¹è±¡ã€‚é‚£ä¸ºä»€ä¹ˆè¿™ä¸ªæ–¹æ³•å’Œç±»æ²¡æœ‰å…³ç³»è¿˜è¦æ”¾åœ¨è¿™ä¸ªç±»ä¸­å‘¢ï¼Ÿä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æŠŠæŸäº›å’Œç±»ç›¸å…³çš„æ“ä½œéƒ½ä¼šæ”¾åœ¨ç±»ä¸­ï¼Œæ–¹ä¾¿æŸ¥æ‰¾å’Œä½¿ç”¨ï¼Œæ‰€ä»¥å¾ˆå¤šæ—¶å€™ï¼Œç±»ä¸­ä¼šå‡ºç°å’Œå¯¹è±¡ä¸ç›¸å…³ï¼Œä½†æ˜¯å’Œç±»å´æ¯æ¯ç›¸å…³çš„æ“ä½œã€‚</p>
<h2 id="ç±»æ–¹æ³•"><a href="#ç±»æ–¹æ³•" class="headerlink" title="ç±»æ–¹æ³•"></a>ç±»æ–¹æ³•</h2><p>ç±»æ–¹æ³•æ˜¯Pythonç‹¬æœ‰çš„ä¸€ä¸ªæ–¹æ³•ã€‚æœ¬è´¨ä¸Šé™æ€æ–¹æ³•çš„ä¸€ç§ç‰¹æ®Šå½¢å¼</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span>:</span></span><br><span class="line">    country = <span class="string">"China"</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æˆ‘æ˜¯æ™®é€šæ–¹æ³• ç”±å¯¹è±¡è°ƒç”¨çš„æ–¹æ³•</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(self.name)</span><br><span class="line">        <span class="keyword">return</span> self.name</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æˆ‘æ˜¯é™æ€æ–¹æ³•</span></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">func_static</span><span class="params">()</span>:</span></span><br><span class="line">        print(<span class="string">"æˆ‘æ˜¯é™æ€æ–¹æ³•"</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"æˆ‘æ˜¯é™æ€æ–¹æ³•"</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># æˆ‘æ˜¯ç±»æ–¹æ³•</span></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">func_class</span><span class="params">(cls)</span>:</span></span><br><span class="line">        print(<span class="string">"æˆ‘æ˜¯ç±»æ–¹æ³•"</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"æˆ‘æ˜¯ç±»æ–¹æ³•"</span></span><br><span class="line"></span><br><span class="line">b = B(<span class="string">"åŒ—äº¬"</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"ä½¿ç”¨å¯¹è±¡å»è°ƒç”¨æ‰§è¡Œæ™®é€šæ–¹æ³•"</span>)</span><br><span class="line">b.show()</span><br><span class="line"></span><br><span class="line">print(<span class="string">"ä½¿ç”¨ç±»å»è°ƒç”¨é™æ€æ–¹æ³•"</span>)</span><br><span class="line">B.func_static()</span><br><span class="line"></span><br><span class="line">print(<span class="string">"ä½¿ç”¨ç±»å»è°ƒç”¨ç±»æ–¹æ³•"</span>)</span><br><span class="line">B.func_class()</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">ä½¿ç”¨å¯¹è±¡å»è°ƒç”¨æ‰§è¡Œæ™®é€šæ–¹æ³•</span><br><span class="line">åŒ—äº¬</span><br><span class="line">ä½¿ç”¨ç±»å»è°ƒç”¨é™æ€æ–¹æ³•</span><br><span class="line">æˆ‘æ˜¯é™æ€æ–¹æ³•</span><br><span class="line">ä½¿ç”¨ç±»å»è°ƒç”¨ç±»æ–¹æ³•</span><br><span class="line">æˆ‘æ˜¯ç±»æ–¹æ³•</span><br></pre></td></tr></table></figure>

<p>åœ¨é™æ€æ–¹æ³•ä¸­ï¼Œå¯ä»¥æ²¡æœ‰ä»»ä½•å‚æ•°ï¼Œä¹Ÿå¯ä»¥æœ‰ä»»æ„å¤šä¸ªå‚æ•°ï¼Œä½¿ç”¨ç±»å»è°ƒç”¨ï¼›ä½†æ˜¯åœ¨ç±»æ–¹æ³•ä¸­ï¼Œè‡³å°‘è¦æœ‰ä¸€ä¸ªå‚æ•°<code>cls</code>ï¼Œ ä¹Ÿæ˜¯ä½¿ç”¨ç±»å»è°ƒç”¨ã€‚è¿™ä¸€ç‰¹ç‚¹å’Œæ™®é€šæ–¹æ³•åˆå¾ˆåƒï¼Œæ™®é€šæ–¹æ³•ä¹Ÿæ˜¯è‡³å°‘è¦æœ‰ä¸€ä¸ªå‚æ•°ï¼Œä½†æ™®é€šæ–¹æ³•çš„å¿…æœ‰å‚æ•°ä¸º<code>self</code></p>
<ul>
<li>selfåœ¨æ™®é€šæ–¹æ³•ä¸­ï¼Œä»£æŒ‡äº†å¯¹è±¡</li>
<li>clsåœ¨ç±»æ–¹æ³•ä¸­ï¼Œä»£æŒ‡äº†ç±»ã€‚è·Ÿselfä¸€æ ·ä¼šéšå¼ä¼ é€’</li>
</ul>
<p>ç±»æ–¹æ³•æ¯”é™æ€æ–¹æ³•åªå¤šäº†ä¸€æ­¥ï¼Œå°±æ˜¯éšå¼çš„æŠŠç±»ä¼ é€’ç»™äº†ç±»æ–¹æ³•</p>
<p><strong>ç±»æ–¹æ³•çš„åº”ç”¨ï¼š</strong>å•ä¾‹æ¨¡å¼çš„å®ç°</p>
<h2 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>Pythonä¸­ç±»çš„ä¸‰ä¸ªæ–¹æ³•éƒ½å±äºç±»</p>
<ul>
<li>æ™®é€šæ–¹æ³• è‡³å°‘è¦æœ‰ä¸€ä¸ªselfå‚æ•° é€šè¿‡å¯¹è±¡å»æ‰§è¡Œ</li>
<li>é™æ€æ–¹æ³• å‚æ•°å¯æœ‰å¯æ—  é€šè¿‡ç±»å»æ‰§è¡Œï¼ˆä¹Ÿå¯ä»¥å¯¹è±¡æ‰§è¡Œï¼‰</li>
<li>ç±»æ–¹æ³• è‡³å°‘æœ‰ä¸€ä¸ªclså‚æ•° é€šè¿‡ç±»å»æ‰§è¡Œï¼ˆä¹Ÿå¯ä»¥å¯¹è±¡æ‰§è¡Œï¼‰</li>
</ul>
<h1 id="å±æ€§"><a href="#å±æ€§" class="headerlink" title="å±æ€§"></a>å±æ€§</h1><p><strong>å±æ€§çš„ç‰¹å¾æ˜¯ï¼šæ‹¥æœ‰æ™®é€šæ–¹æ³•çš„æ ·å¼å’Œè¡¨ç°å½¢å¼ï¼Œå´æ‹¥æœ‰å­—æ®µçš„è®¿é—®æ–¹å¼</strong></p>
<p>ç°æœ‰å¦‚ä¸‹éœ€æ±‚ï¼šéœ€è¦åšä¸€ä¸ªåˆ†é¡µå™¨ï¼Œæ¯10æ¡å†…å®¹åˆ†ä¸€é¡µï¼Œæœ€åå¾—å‡ºä¸€å…±åˆ†å‡ºå¤šå°‘é¡µçš„å†…å®¹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é¦–å…ˆä½¿ç”¨æ™®é€šæ–¹æ³•çš„æ–¹å¼æ¥å®ç°è¿™ä¸ªåŠŸèƒ½</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pageer</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, num)</span>:</span></span><br><span class="line">        self.num = num</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">all_pager</span><span class="params">(self)</span>:</span></span><br><span class="line">        p1, p2 = divmod(self.num, <span class="number">10</span>)</span><br><span class="line">        <span class="keyword">if</span> p2 == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> p1</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> p1 + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">p = Pageer(<span class="number">59</span>)</span><br><span class="line">print(p.all_pager())</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line"><span class="number">6</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨å±æ€§çš„æ–¹å¼æ¥å®ç°è¿™ä¸ªåŠŸèƒ½</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pageer</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, num)</span>:</span></span><br><span class="line">        self.num = num</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">all_pager</span><span class="params">(self)</span>:</span></span><br><span class="line">        p1, p2 = divmod(self.num, <span class="number">10</span>)</span><br><span class="line">        <span class="keyword">if</span> p2 == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> p1</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> p1 + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">p = Pageer(<span class="number">59</span>)</span><br><span class="line">print(p.all_pager)</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line"><span class="number">6</span></span><br></pre></td></tr></table></figure>

<p>å¯¹æ¯”ä¸¤æ®µä»£ç å¯ä»¥çœ‹å‡ºï¼Œæœ‰ä¸¤ç‚¹åŒºåˆ«</p>
<ul>
<li>åœ¨æ™®é€šæ–¹æ³•çš„ä¸Šé¢åŠ äº†ä¸€ä¸ª<code>@property</code>è£…é¥°å™¨</li>
<li>åœ¨è°ƒç”¨è¿™ä¸ªæ™®é€šæˆå‘˜çš„æ—¶å€™ï¼Œç¬¬ä¸€æ®µä»£ç ä½¿ç”¨äº†æ ‡å‡†çš„æ™®é€šæ–¹æ³•è°ƒç”¨æ‰§è¡Œçš„æ–¹å¼<code>p.all_pager()</code>ï¼›ç¬¬äºŒæ®µä»£ç åˆ™ä½¿ç”¨äº†è®¿é—®æ™®é€šå­—æ®µçš„æ–¹å¼<code>p.all_pager</code></li>
</ul>
<p>è¿™å°±æ˜¯ä¸Šé¢è¯´çš„å±æ€§çš„ç‰¹å¾ï¼Œæ—¢æ‹¥æœ‰å’Œæ™®é€šæ–¹æ³•ä¸€æ ·çš„è¡¨ç°å½¢å¼ï¼Œåˆæœ‰è®¿é—®æ™®é€šå­—æ®µé‚£æ ·çš„è®¿é—®å½¢å¼</p>
<h2 id="å¯¹å±æ€§çš„èµ‹å€¼"><a href="#å¯¹å±æ€§çš„èµ‹å€¼" class="headerlink" title="å¯¹å±æ€§çš„èµ‹å€¼"></a>å¯¹å±æ€§çš„èµ‹å€¼</h2><p>ä¸Šé¢çš„å°ä¾‹å­å®ç°äº†å¯¹å±æ€§çš„å–å€¼ã€‚å¯¹äºè®¿é—®æ™®é€šå­—æ®µæ¥è¯´ï¼Œä¸ä»…å¯ä»¥è®¿é—®ï¼Œè¿˜æ˜¯ä¸ºæ™®é€šå­—æ®µèµ‹å€¼ã€‚é‚£ä¹ˆå±æ€§æ—¢ç„¶æœ‰ç€æ™®é€šå­—æ®µçš„è®¿é—®å½¢å¼ï¼Œèƒ½ä¸èƒ½ä¹Ÿå»å®ç°åƒæ™®é€šå­—æ®µé‚£æ ·çš„èµ‹å€¼å‘¢ï¼Ÿ<code>p.all_pager = 1991</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pageer</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, num)</span>:</span></span><br><span class="line">        self.num = num</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">all_pager</span><span class="params">(self)</span>:</span></span><br><span class="line">        p1, p2 = divmod(self.num, <span class="number">10</span>)</span><br><span class="line">        <span class="keyword">if</span> p2 == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> p1</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> p1 + <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @all_pager.setter</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">all_pager</span><span class="params">(self, value)</span>:</span></span><br><span class="line">        print(value)</span><br><span class="line"></span><br><span class="line">p = Pageer(<span class="number">59</span>)</span><br><span class="line">print(p.all_pager)</span><br><span class="line"></span><br><span class="line">p.all_pager = <span class="number">1991</span></span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line"><span class="number">6</span></span><br><span class="line"><span class="number">1991</span></span><br></pre></td></tr></table></figure>

<p>å¯¹å±æ€§è¿›è¡Œèµ‹å€¼çš„å…³é”®è¯­æ³•ï¼š</p>
<ul>
<li>ä¸€å®šè¦ä½¿ç”¨<code>å±æ€§å–å€¼æ–¹æ³•çš„æ–¹æ³•å.setter</code>è£…é¥°å™¨</li>
<li>èµ‹å€¼æ–¹æ³•çš„å‡½æ•°åå¿…é¡»å’Œå–å€¼æ–¹æ³•çš„æ–¹æ³•åä¸€è‡´</li>
<li>åœ¨èµ‹å€¼æ–¹æ³•ä¸­ï¼Œæ¥å—ä¸€ä¸ªèµ‹å€¼å‚æ•°<code>value</code></li>
</ul>
<p>åœ¨ä¸º<code>all_pager</code>èµ‹å€¼çš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨æ‰§è¡Œ<code>@all_pager.setter</code>ä¸‹é¢çš„æ–¹æ³•ï¼ˆç‰¹åˆ«æ³¨æ„ï¼šå±æ€§èµ‹å€¼æ–¹æ³•ä¸­ä¸èƒ½returnè¿”å›å€¼ï¼‰</p>
<h2 id="åˆ é™¤å±æ€§"><a href="#åˆ é™¤å±æ€§" class="headerlink" title="åˆ é™¤å±æ€§"></a>åˆ é™¤å±æ€§</h2><p>åœ¨å¯¹å­—æ®µçš„æ“ä½œä¸­ï¼Œå¯ä»¥è®¿é—®å­—æ®µï¼Œç»™å­—æ®µèµ‹å€¼ï¼Œè¿˜å¯ä»¥åˆ é™¤å­—æ®µã€‚ä¸Šé¢çš„å±æ€§ä¸­ï¼Œå·²ç»å®ç°äº†å±æ€§çš„è®¿é—®å’Œèµ‹å€¼ï¼Œæ¥ä¸‹æ¥è¦å®ç°å±æ€§çš„åˆ é™¤ï¼Œè¿™æ ·ä¸€æ¥ï¼Œå±æ€§å°±æ‹¥æœ‰äº†å’Œå­—æ®µä¸€æ ·çš„æ“ä½œç‰¹æ€§äº†ï¼ˆæŸ¥ï¼Œæ”¹ï¼Œåˆ ï¼‰</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pageer</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, num)</span>:</span></span><br><span class="line">        self.num = num</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">all_pager</span><span class="params">(self)</span>:</span></span><br><span class="line">        p1, p2 = divmod(self.num, <span class="number">10</span>)</span><br><span class="line">        <span class="keyword">if</span> p2 == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> p1</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> p1 + <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @all_pager.setter</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">all_pager</span><span class="params">(self, value)</span>:</span></span><br><span class="line">        print(value)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @all_pager.deleter</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">all_pager</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"del all_pager"</span>)</span><br><span class="line"></span><br><span class="line">p = Pageer(<span class="number">59</span>)</span><br><span class="line">print(p.all_pager)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"ä¸ºå±æ€§èµ‹å€¼"</span>)</span><br><span class="line">p.all_pager = <span class="number">1991</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">"åˆ é™¤å±æ€§"</span>)</span><br><span class="line"><span class="keyword">del</span> p.all_pager</span><br></pre></td></tr></table></figure>

<h2 id="æ€»ç»“-2"><a href="#æ€»ç»“-2" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å±æ€§å…·æœ‰æ–¹æ³•çš„è¡¨ç°å½¢å¼ï¼ŒåŒæ—¶å…·æœ‰å­—æ®µçš„è®¿é—®å½¢å¼<em>ï¼ˆé€šè¿‡ä¸åŠ æ‹¬å·<code>()</code>çš„æ–¹å¼å»æ‰§è¡Œäº†ä¸€ä¸ªæ–¹æ³•ï¼‰</em></p>
<p>ç”±äºå±æ€§çš„è¿™ä¸ªè®¿é—®ç‰¹æ€§æ˜¯æˆ‘ä»¬é€šè¿‡ä¸‰ä¸ªæ–¹æ³•æ¥ä¼ªé€ å‡ºæ¥çš„ï¼Œæ‰€ä»¥æ¯ä¸ªæ“ä½œå¯¹åº”äº†å…·ä½“ä»€ä¹ˆå†…å®¹ï¼Œéœ€è¦æˆ‘ä»¬æ¥è‡ªå·±å®šä¹‰ã€‚å°±åƒä¸Šé¢çš„åˆ é™¤æ–¹æ³•ï¼Œæˆ‘åªæ˜¯printäº†ä¸€ä¸‹è€Œå·²~~ Pythonåªæ˜¯æ ¹æ®æˆ‘ä»¬æ“ä½œå±æ€§çš„æ–¹å¼ï¼Œæä¾›äº†ä¸€ç§å…³è”æ–¹å¼è€Œå·²ï¼Œå…·ä½“é‡Œé¢éœ€è¦å®ç°å“ªäº›åŠŸèƒ½éƒ½éœ€è¦æˆ‘ä»¬è‡ªå·±å»å®šä¹‰</p>
<p>æ³¨æ„ï¼šå¦‚æœä½ æƒ³çœŸçš„åœ¨å†…å­˜ä¸­å®ç°åˆ é™¤all_pagerå±æ€§ï¼Œä½ å¯èƒ½ä¼šè¿™æ ·å†™ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@all_pager.deleter</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">all_pager</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">del</span> self.all_pager</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·åšçš„ç»“æœæ˜¯ä¼šè¿›å…¥ä¸€ä¸ªæ­»å¾ªç¯ã€‚å› ä¸ºä½ åœ¨å¤–é¢è°ƒç”¨delå‡½æ•°æ¥åˆ é™¤å¯¹è±¡å±æ€§çš„æ—¶å€™ï¼Œä¼šå»deleteré‡Œé¢æ‰§è¡Œ<code>del self.all_pager</code>ä»£ç ï¼Œè¯¥ä»£ç åˆä¼šè·³åˆ°deleteré‡Œé¢æ‰§è¡Œ<code>del self.all_pager</code>,æ‰€ä»¥ä¼šè¿›å…¥ä¸€ä¸ªæ­»å¾ªç¯ã€‚å±æ€§çš„åˆ é™¤æ–¹æ³•ï¼Œåº”è¯¥æ ¹æ®å®é™…éœ€è¦è°ƒæ•´ä»–çš„åŠŸèƒ½</p>
<p><strong>å±æ€§å­˜åœ¨æ„ä¹‰æ˜¯ï¼šè®¿é—®å±æ€§æ—¶å¯ä»¥åˆ¶é€ å‡ºå’Œè®¿é—®å­—æ®µå®Œå…¨ç›¸åŒçš„å‡è±¡ã€‚å±æ€§ç”±æ–¹æ³•å˜ç§è€Œæ¥ï¼Œå¦‚æœPythonä¸­æ²¡æœ‰å±æ€§ï¼Œæ–¹æ³•å®Œå…¨å¯ä»¥ä»£æ›¿å…¶åŠŸèƒ½</strong></p>
<h2 id="å±æ€§çš„ç¬¬äºŒç§è¡¨ç°å½¢å¼"><a href="#å±æ€§çš„ç¬¬äºŒç§è¡¨ç°å½¢å¼" class="headerlink" title="å±æ€§çš„ç¬¬äºŒç§è¡¨ç°å½¢å¼"></a>å±æ€§çš„ç¬¬äºŒç§è¡¨ç°å½¢å¼</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pageer</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, num)</span>:</span></span><br><span class="line">        self.num = num</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">func1</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">1991</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">func2</span><span class="params">(self, value)</span>:</span></span><br><span class="line">        print(<span class="string">"set"</span>, value)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">func3</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"del"</span>)</span><br><span class="line"></span><br><span class="line">    func = property(fget=func1, fset=func2, fdel=func3)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p = Pageer(<span class="number">59</span>)</span><br><span class="line">print(p.func)  <span class="comment"># è‡ªåŠ¨å»è°ƒç”¨fget=func1</span></span><br><span class="line">p.func = <span class="number">2016</span>  <span class="comment"># è‡ªåŠ¨å»è°ƒç”¨fset=func2</span></span><br><span class="line"><span class="keyword">del</span> p.func  <span class="comment"># è‡ªåŠ¨å»è°ƒç”¨fdel=func3</span></span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line"><span class="number">1991</span></span><br><span class="line">set <span class="number">2016</span></span><br><span class="line"><span class="keyword">del</span></span><br></pre></td></tr></table></figure>

<p>propertyçš„æ„é€ æ–¹æ³•ä¸­æœ‰ä¸ªå››ä¸ªå‚æ•°</p>
<ul>
<li>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ–¹æ³•åï¼Œè°ƒç”¨ å¯¹è±¡.å±æ€§ æ—¶è‡ªåŠ¨è§¦å‘æ‰§è¡Œæ–¹æ³•</li>
<li>ç¬¬äºŒä¸ªå‚æ•°æ˜¯æ–¹æ³•åï¼Œè°ƒç”¨ å¯¹è±¡.å±æ€§ ï¼ XXX æ—¶è‡ªåŠ¨è§¦å‘æ‰§è¡Œæ–¹æ³•</li>
<li>ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯æ–¹æ³•åï¼Œè°ƒç”¨ del å¯¹è±¡.å±æ€§ æ—¶è‡ªåŠ¨è§¦å‘æ‰§è¡Œæ–¹æ³•</li>
<li>ç¬¬å››ä¸ªå‚æ•°æ˜¯å­—ç¬¦ä¸²ï¼Œè°ƒç”¨ å¯¹è±¡.å±æ€§.<strong>doc</strong> ï¼Œæ­¤å‚æ•°æ˜¯è¯¥å±æ€§çš„æè¿°ä¿¡æ¯</li>
</ul>
<p>è¿™ç§é€šè¿‡é™æ€å­—æ®µçš„æ–¹å¼å®ç°å±æ€§çš„æ“ä½œåœ¨å¾ˆå¤šæºç ä¸­å¾ˆå¸¸è§ï¼Œä½¿ç”¨çš„é¢‘ç‡æ˜¯æœ€é«˜çš„</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Python WEBæ¡†æ¶ Django çš„è§†å›¾ä¸­ request.POST å°±æ˜¯ä½¿ç”¨çš„é™æ€å­—æ®µçš„æ–¹å¼åˆ›å»ºçš„å±æ€§</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WSGIRequest</span><span class="params">(http.HttpRequest)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, environ)</span>:</span></span><br><span class="line">        script_name = get_script_name(environ)</span><br><span class="line">        path_info = get_path_info(environ)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> path_info:</span><br><span class="line">            <span class="comment"># Sometimes PATH_INFO exists, but is empty (e.g. accessing</span></span><br><span class="line">            <span class="comment"># the SCRIPT_NAME URL without a trailing slash). We really need to</span></span><br><span class="line">            <span class="comment"># operate as if they'd requested '/'. Not amazingly nice to force</span></span><br><span class="line">            <span class="comment"># the path like this, but should be harmless.</span></span><br><span class="line">            path_info = <span class="string">'/'</span></span><br><span class="line">        self.environ = environ</span><br><span class="line">        self.path_info = path_info</span><br><span class="line">        self.path = <span class="string">'%s/%s'</span> % (script_name.rstrip(<span class="string">'/'</span>), path_info.lstrip(<span class="string">'/'</span>))</span><br><span class="line">        self.META = environ</span><br><span class="line">        self.META[<span class="string">'PATH_INFO'</span>] = path_info</span><br><span class="line">        self.META[<span class="string">'SCRIPT_NAME'</span>] = script_name</span><br><span class="line">        self.method = environ[<span class="string">'REQUEST_METHOD'</span>].upper()</span><br><span class="line">        _, content_params = cgi.parse_header(environ.get(<span class="string">'CONTENT_TYPE'</span>, <span class="string">''</span>))</span><br><span class="line">        <span class="keyword">if</span> <span class="string">'charset'</span> <span class="keyword">in</span> content_params:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                codecs.lookup(content_params[<span class="string">'charset'</span>])</span><br><span class="line">            <span class="keyword">except</span> LookupError:</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                self.encoding = content_params[<span class="string">'charset'</span>]</span><br><span class="line">        self._post_parse_error = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            content_length = int(environ.get(<span class="string">'CONTENT_LENGTH'</span>))</span><br><span class="line">        <span class="keyword">except</span> (ValueError, TypeError):</span><br><span class="line">            content_length = <span class="number">0</span></span><br><span class="line">        self._stream = LimitedStream(self.environ[<span class="string">'wsgi.input'</span>], content_length)</span><br><span class="line">        self._read_started = <span class="literal">False</span></span><br><span class="line">        self.resolver_match = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_get_scheme</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.environ.get(<span class="string">'wsgi.url_scheme'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_get_request</span><span class="params">(self)</span>:</span></span><br><span class="line">        warnings.warn(<span class="string">'`request.REQUEST` is deprecated, use `request.GET` or '</span></span><br><span class="line">                      <span class="string">'`request.POST` instead.'</span>, RemovedInDjango19Warning, <span class="number">2</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> hasattr(self, <span class="string">'_request'</span>):</span><br><span class="line">            self._request = datastructures.MergeDict(self.POST, self.GET)</span><br><span class="line">        <span class="keyword">return</span> self._request</span><br><span class="line"></span><br><span class="line"><span class="meta">    @cached_property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">GET</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># The WSGI spec says 'QUERY_STRING' may be absent.</span></span><br><span class="line">        raw_query_string = get_bytes_from_wsgi(self.environ, <span class="string">'QUERY_STRING'</span>, <span class="string">''</span>)</span><br><span class="line">        <span class="keyword">return</span> http.QueryDict(raw_query_string, encoding=self._encoding)</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_get_post</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> hasattr(self, <span class="string">'_post'</span>):</span><br><span class="line">            self._load_post_and_files()</span><br><span class="line">        <span class="keyword">return</span> self._post</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_set_post</span><span class="params">(self, post)</span>:</span></span><br><span class="line">        self._post = post</span><br><span class="line"></span><br><span class="line"><span class="meta">    @cached_property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">COOKIES</span><span class="params">(self)</span>:</span></span><br><span class="line">        raw_cookie = get_str_from_wsgi(self.environ, <span class="string">'HTTP_COOKIE'</span>, <span class="string">''</span>)</span><br><span class="line">        <span class="keyword">return</span> http.parse_cookie(raw_cookie)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_get_files</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> hasattr(self, <span class="string">'_files'</span>):</span><br><span class="line">            self._load_post_and_files()</span><br><span class="line">        <span class="keyword">return</span> self._files</span><br><span class="line"></span><br><span class="line">    POST = property(_get_post, _set_post)</span><br><span class="line">    </span><br><span class="line">    FILES = property(_get_files)</span><br><span class="line">    REQUEST = property(_get_request)</span><br></pre></td></tr></table></figure>

<ul>
<li>ç¬¬70è¡Œï¼Œå®šä¹‰äº†å±æ€§çš„ä¸¤ä¸ªæ–¹æ³•ï¼Œå–å€¼å’Œèµ‹å€¼</li>
<li>ç¬¬52è¡Œï¼Œå–å€¼</li>
<li>ç¬¬57è¡Œï¼Œèµ‹å€¼</li>
</ul>
<h1 id="ç‰¹åˆ«å¼ºè°ƒ"><a href="#ç‰¹åˆ«å¼ºè°ƒ" class="headerlink" title="ç‰¹åˆ«å¼ºè°ƒ"></a>ç‰¹åˆ«å¼ºè°ƒ</h1><p>æœ€åå†ä¸€æ¬¡å¼ºè°ƒï¼Œæœ¬ç«™å…³äºPythonçš„ä»‹ç»å¤§å¤šæ•°æ˜¯åŸºäºPython3.5+</p>
<p>ä¸Šé¢å…³äºå±æ€§é€šè¿‡è£…é¥°å™¨çš„æ–¹å¼æ¥å®ç°ä¸åŒçš„æ“ä½œæ—¶ï¼Œå‡æ˜¯åœ¨Python3.5+çš„ç¯å¢ƒä¸‹ï¼Œå¦‚æœä½ åœ¨Python2.xçš„ç¯å¢ƒä¸‹ï¼Œå¾—åˆ°çš„ç»“æœè‚¯å®šä¼šä¸ä¸€æ ·ã€‚å› ä¸ºPython2.xä¸­</p>
<ul>
<li>ç»å…¸ç±»ä¸­çš„å±æ€§åªæœ‰ä¸€ç§è®¿é—®æ–¹å¼ï¼Œå…¶å¯¹åº”è¢«<code>@property</code>ä¿®é¥°çš„æ–¹æ³•</li>
<li>æ–°å¼ç±»ä¸­çš„å±æ€§æœ‰ä¸‰ç§è®¿é—®æ–¹å¼ï¼Œå¹¶åˆ†åˆ«å¯¹åº”äº†ä¸‰ä¸ªè¢«<code>@property</code> <code>@æ–¹æ³•å.setter</code> <code>@æ–¹æ³•å.deleter</code>ä¿®é¥°çš„æ–¹æ³•</li>
</ul>
<p>ä½†æ˜¯åœ¨Python3ä¸­ï¼Œç»å…¸ç±»ä¹Ÿæ˜¯æ‹¥æœ‰è¿™ä¸‰ç§è®¿é—®æ–¹å¼çš„ã€‚</p>
<p><em>ç»§æ‰¿äº†objectçš„ç±»å°±æ˜¯æ–°å¼ç±»ï¼Œå¦åˆ™ä¸ºç»å…¸ç±»</em></p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>æ–¹æ³•</tag>
        <tag>é¢å‘å¯¹è±¡</tag>
        <tag>å­—æ®µ</tag>
        <tag>å±æ€§</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythoné¢å‘å¯¹è±¡åŸºç¡€ç¯‡ä¹‹å¤šæ€</title>
    <url>/2016/07/03/Python%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8B%E5%A4%9A%E6%80%81/</url>
    <content><![CDATA[<blockquote>
<p>Pythonæ˜¯å¦æ”¯æŒå¤šæ€çš„é—®é¢˜äº‰è®ºå·²ä¹…ï¼Œåœ¨é¢å‘å¯¹è±¡è¯­è¨€ä¸­ï¼Œæœ‰ä¸‰å¤§ç‰¹æ€§ï¼ˆå°è£… ç»§æ‰¿ å¤šæ€ï¼‰Pythonä½œä¸ºå…¸å‹çš„é¢å‘å¯¹è±¡è¯­è¨€ï¼Œæ€ä¹ˆå¯èƒ½ä¼šä¸æ”¯æŒå¤šæ€å‘¢</p>
</blockquote>
<p>äº§ç”Ÿè¿™ä¸ªé—®é¢˜çš„åŸå› åœ¨äºPythonæ˜¯ä¸€é—¨åŠ¨æ€ç¼–ç¨‹è¯­è¨€ï¼Œåœ¨è¿è¡Œçš„æ—¶å€™å¯ä»¥æ›´æ”¹è‡ªå·±çš„ç»“æ„ã€‚åœ¨javaç­‰é¢å‘å¯¹è±¡è¯­è¨€ä¸­ï¼Œå®šä¹‰ä¸€ä¸ªå˜é‡ï¼Œå¼ºåˆ¶è¦æ±‚é¦–å…ˆå£°æ˜ä»–çš„æ•°æ®ç±»å‹ï¼›è€Œåœ¨Pythonä¸­ï¼Œè¿™ä¸ªæ­¥éª¤æ˜¯å®Œå…¨å¯ä»¥å¿½ç•¥çš„ã€‚ç”±äºPythonåŠ¨æ€è¯­è¨€çš„ç‰¹æ€§ï¼ŒPythonå¤©ç”Ÿå°±æ”¯æŒå¤šæ€ï¼Œä¸éœ€è¦åƒå…¶ä»–é¢å‘å¯¹è±¡çš„è¯­è¨€é‚£æ ·ä½¿ç”¨äº†å¤šæ€è¯­æ³•æ¥å®ç°å¤šæ€çš„ç‰¹æ€§ã€‚å¤§å®¶äº‰è®ºPythonæ˜¯å¦æ”¯æŒå¤šæ€ï¼Œå…¶å®éƒ½æ˜¯çº ç»“åœ¨Pythonæ²¡æœ‰å¤šæ€çš„è¯­æ³•ã€‚</p>
<ul>
<li><p>åœ¨javaä¸­ï¼Œå¦‚æœä¸€ä¸ªå˜é‡è¢«å£°æ˜æ˜¯intç±»å‹ï¼Œå¦‚æœè¢«èµ‹å€¼ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ï¼Œé‚£ä¸€å®šä¼šæŠ¥é”™ã€‚åœ¨åƒJavaè¿™ç§å¼ºç±»å‹çš„è¯­è¨€ä¸­ï¼Œä¸€ä¸ªå˜é‡è¢«å£°æ˜æ•°æ®ç±»å‹æ—¶å€™ï¼Œåªå…è®¸è¢«è¿™ä¸ªç±»æˆ–è¿™ä¸ªç±»çš„æ´¾ç”Ÿç±»èµ‹å€¼ã€‚</p>
</li>
<li><p>è€Œåœ¨Pythonä¸­ï¼Œå£°æ˜ä¸€ä¸ªå˜é‡ï¼Œä½ å¯ä»¥ç»™ä»–èµ‹ä»»ä½•ç±»å‹çš„å€¼ï¼ˆå¯¹è±¡ï¼‰</p>
</li>
</ul>
<p>å¤šæ€å¯ä»¥ç®€å•çš„ç†è§£ä¸ºå¤šç§å½¢æ€ï¼Œå¤šç§ç±»å‹ã€‚åœ¨Pythonä¸­ï¼Œä¸éœ€è¦ç‰¹æ®Šçš„å¤šæ€è¯­æ³•æ¥å®ç°å¤šæ€çš„ç‰¹æ€§ã€‚</p>
<p><strong>åŠ¨æ€è¯­è¨€çš„ä¼˜åŠ¿ä¸åŠ£åŠ¿</strong></p>
<p>æ¯‹åº¸ç½®ç–‘ï¼ŒåŠ¨æ€è¯­è¨€å¸¦æ¥çš„ä¾¿æ·æ˜¯æ˜¾è€Œæ˜“è§çš„ï¼Œæˆ‘ä»¬ä¸éœ€è¦å…³å¿ƒå˜é‡çš„æ•°æ®ç±»å‹ï¼Œå› ä¸ºåœ¨èµ‹å€¼çš„è¿‡ç¨‹ä¸­ï¼ŒPythonä¼šåŠ¨æ€çš„æ”¹å˜è‡ªå·±çš„ç»“æ„ã€‚</p>
<p>ç”±äºPythonåŠ¨æ€è¯­è¨€çš„ç‰¹æ€§ï¼Œä¸€ä¸ªå˜é‡å¯ä»¥è¢«ä»»ä½•æ•°æ®ç±»å‹èµ‹å€¼ï¼Œä¹Ÿé€ æˆäº†ä¸€ä¸ªå›°æ‰°ï¼Œå°±æ˜¯åœ¨è¯»åˆ«äººæºç çš„æ—¶å€™ï¼Œå¦‚æœå‚æ•°åªå†™äº†ä¸€ä¸ª<code>arg</code>,é‚£æˆ‘ä»¬æ˜¯ä¸çŸ¥é“å®ƒå…·ä½“æ˜¯éœ€è¦ä¼ é€’ä»€ä¹ˆæ ·ç±»å‹çš„å‚æ•°çš„ã€‚</p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>é¢å‘å¯¹è±¡</tag>
        <tag>å¤šæ€</tag>
      </tags>
  </entry>
  <entry>
    <title>pickle loadè‡ªå®šä¹‰å¯¹è±¡æŠ¥é”™</title>
    <url>/2016/07/03/pickle-load%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AF%B9%E8%B1%A1%E6%8A%A5%E9%94%99/</url>
    <content><![CDATA[<blockquote>
<p>Pythonä¸­çš„pickleå¯ä»¥ä¿å­˜Pythonä¸­çš„ä»»æ„å¯¹è±¡åˆ°æ–‡ä»¶ä¸­ã€‚å½“æˆ‘ä»¬dumpä¸€ä¸ªè‡ªå®šä¹‰ç±»å®ä¾‹åŒ–å‡ºæ¥çš„å¯¹è±¡ä¹‹åï¼Œå¦‚æœéœ€è¦åœ¨å…¶ä»–Pythonæ¨¡å—ï¼ˆæ–‡ä»¶ï¼‰ä¸­loadè¿›æ¥ï¼Œéœ€è¦æ³¨æ„ï¼Œä¸€å®šè¦å…ˆå¯¼å…¥è¿™ä¸ªè‡ªå®šä¹‰çš„ç±»ï¼Œå¦åˆ™æ‰§è¡Œå¯¹è±¡çš„æ–¹æ³•çš„æ—¶å€™ä¼šæŠ¥é”™</p>
</blockquote>
<p>å®ä¾‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(self.name)</span><br><span class="line">        <span class="keyword">return</span> self.name</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">	print(<span class="string">"--dump--"</span>)</span><br><span class="line">	a = A(<span class="string">"polarsnow"</span>)</span><br><span class="line">	pickle.dump(a, open(<span class="string">'db'</span>, <span class="string">'wb'</span>))</span><br><span class="line">	</span><br><span class="line">	print(<span class="string">"--load--"</span>)</span><br><span class="line">	ret = pickle.load(open(<span class="string">'db'</span>, <span class="string">'rb'</span>))</span><br><span class="line">	print(ret)</span><br><span class="line">	ret.show()</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">--dump--</span><br><span class="line">--load--</span><br><span class="line">&lt;__main__.A object at <span class="number">0x101b77e10</span>&gt;</span><br><span class="line">polarsnow</span><br></pre></td></tr></table></figure>

<ul>
<li>åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„ç±»</li>
<li>å®ä¾‹åŒ–è¿™ä¸ªç±»çš„å¯¹è±¡</li>
<li>å°†è¿™ä¸ªå¯¹è±¡ä»å†…å­˜ä¸­dumpåˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­</li>
<li>ä»æœ¬ç¨‹åºload pickleæ–‡ä»¶åˆ°å†…å­˜ä¸­</li>
<li>æ‰§è¡Œå¯¹è±¡çš„ä¸€ä¸ªæ–¹æ³•</li>
</ul>
<p>ä¸Šé¢ä»æœ¬ç¨‹åºä¸­ï¼Œloadè‡ªå®šä¹‰ç±»å®ä¾‹åŒ–å‡ºæ¥çš„å¯¹è±¡ï¼Œæ‰§è¡Œå¯¹è±¡çš„æ“ä½œæ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚é‚£ä¹ˆå¦‚æœæ˜¯ä»å¦ä¸€ä¸ªæ–‡ä»¶loadè¿™ä¸ªå¯¹è±¡å‘¢ï¼Ÿ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"></span><br><span class="line">ret = pickle.load(open(<span class="string">'db'</span>, <span class="string">'rb'</span>))</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"/Users/lvrui/PycharmProjects/untitled/8/loadpickle.py"</span>, line <span class="number">3</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    ret = pickle.load(open(<span class="string">'db'</span>, <span class="string">'rb'</span>))</span><br><span class="line">AttributeError: Can<span class="string">'t get attribute '</span>A<span class="string">' on &lt;module '</span>__main__<span class="string">' from '</span>/Users/lvrui/PycharmProjects/untitled/<span class="number">8</span>/loadpickle.py<span class="string">'&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä»å¦ä¸€ä¸ªPythonæ–‡ä»¶ä¸­loadä¸€ä¸ªè‡ªå®šä¹‰ç±»çš„å¯¹è±¡æ—¶æŠ¥é”™äº†ï¼ä¸ºä»€ä¹ˆä¼šæŠ¥é”™ï¼Ÿå› ä¸ºå¯¹è±¡æ˜¯ç”±ç±»è€Œäº§ç”Ÿçš„ï¼Œåœ¨æ–°çš„Pythonæ–‡ä»¶ä¸­ï¼Œç±»æ²¡æœ‰è¢«åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œæ‰€ä»¥loadè¿™ä¸ªç±»çš„å¯¹è±¡çš„æ—¶å€™å°±ä¼šæŠ¥é”™ã€‚åœ¨æŠ¥é”™ä¿¡æ¯ä¸­ä¹Ÿå¯ä»¥çœ‹å‡ºï¼Œæ²¡æœ‰åœ¨å½“å‰æ–‡ä»¶ä¸­æ‰¾åˆ°Aè¿™ä¸ªç±»ã€‚</p>
<p>è§£å†³è¿™ä¸ªé—®é¢˜æœ‰ä¸¤ä¸ªé€”å¾„ï¼š</p>
<ul>
<li>å°†ç±»å¯¼å…¥åˆ°è¿™ä¸ªPythonæ–‡ä»¶ä¸­</li>
<li>å°†ç±»çš„ä»£ç ç›´æ¥copyåˆ°è¿™ä¸ªæ–‡ä»¶ä¸­</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">from</span> dumppickle <span class="keyword">import</span> A</span><br><span class="line"></span><br><span class="line">ret = pickle.load(open(<span class="string">'db'</span>, <span class="string">'rb'</span>))</span><br><span class="line">print(ret)</span><br><span class="line">ret.show()</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">&lt;dumppickle.A object at <span class="number">0x1013777b8</span>&gt;</span><br><span class="line">polarsnow</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼šä¸€ä¸ªå¯¹è±¡ï¼Œæœ‰å®ƒå¯¹åº”çš„ç±»æ‰æœ‰æ„ä¹‰ã€‚æ‰€ä»¥åœ¨load pickleæ–‡ä»¶ä¸­çš„å¯¹è±¡çš„æ—¶å€™ï¼Œä¸€å®šè¦ä¿è¯å®ƒçš„ç±»å…ˆè¢«å¯¼å…¥</p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>pickle</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythoné¢å‘å¯¹è±¡åŸºç¡€ç¯‡ä¹‹ç»§æ‰¿</title>
    <url>/2016/06/28/Python%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8B%E7%BB%A7%E6%89%BF/</url>
    <content><![CDATA[<blockquote>
<p>åœ¨Javaå’ŒC#è¿™ç±»é¢å‘å¯¹è±¡çš„è¯­è¨€ä¸­ï¼Œä¸€ä¸ªç±»åªå…è®¸æœ‰ä¸€ä¸ªçˆ¶ç±»ã€‚è€Œåœ¨Pythonä¸­ï¼Œå¯ä»¥æœ‰å¤šä¸ªçˆ¶ç±»ã€‚ç»§æ‰¿ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å­ç±»é»˜è®¤è·å¾—çˆ¶ç±»ä¸­çš„æ‰€æœ‰æˆå‘˜ã€‚å½“å­ç±»ä¸­ä¸åŒ…å«ä¸çˆ¶ç±»åŒåçš„æˆå‘˜æ—¶ï¼ŒPythonä¼šè‡ªåŠ¨å»çˆ¶ç±»ä¸­æŸ¥æ‰¾å¹¶ä½¿ç”¨çˆ¶ç±»çš„æˆå‘˜ï¼›å½“å­ç±»ä¸­çš„æˆå‘˜ä¸çˆ¶ç±»ä¸­çš„æˆå‘˜åç§°ç›¸åŒæ—¶ï¼Œä¼˜å…ˆä½¿ç”¨å­ç±»çš„æˆå‘˜ã€‚è¿™ç§è¦†ç›–çˆ¶ç±»æˆå‘˜å±æ€§çš„ç‰¹æ€§è¢«ç§°ä¹‹ä¸ºâ€œé‡å†™â€æˆ–â€œå¤å†™â€</p>
</blockquote>
<h1 id="ä»€ä¹ˆæ˜¯ç»§æ‰¿"><a href="#ä»€ä¹ˆæ˜¯ç»§æ‰¿" class="headerlink" title="ä»€ä¹ˆæ˜¯ç»§æ‰¿"></a>ä»€ä¹ˆæ˜¯ç»§æ‰¿</h1><p>ç»§æ‰¿å¯ä»¥ç®€å•çš„ç†è§£ä¸ºï¼Œå°†çˆ¶ç±»ä¸­çš„æ‰€æœ‰æˆå‘˜copyä¸€ä»½åˆ°å­ç±»ä¸­ï¼Œå­ç±»å’Œçˆ¶ç±»å¦‚æœæœ‰ç›¸åŒçš„æˆå‘˜åï¼Œä¼˜å…ˆä½¿ç”¨å­ç±»çš„ä»£ç ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(self)</span>:</span></span><br><span class="line">		print(<span class="string">'show'</span>)</span><br><span class="line">		</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span><span class="params">(A)</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self)</span>:</span></span><br><span class="line">		print(<span class="string">'get'</span>)</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘è®©Bç±»å»ç»§æ‰¿äº†Aç±»ï¼Œä¹Ÿå°±æ˜¯è¯´Aç±»æ˜¯Bç±»çš„çˆ¶ç±»ã€‚ç°åœ¨Bç±»å’ŒAç±»ä¸­æ²¡æœ‰åå­—ç›¸åŒçš„æˆå‘˜ï¼Œæ‰€ä»¥å¯ä»¥ç®€å•çš„çœ‹åšæ˜¯ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(self)</span>:</span></span><br><span class="line">		print(<span class="string">'show'</span>)</span><br><span class="line">		</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self)</span>:</span></span><br><span class="line">		print(<span class="string">'get'</span>)</span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥æ‰§è¡Œå¦‚ä¸‹ä»£ç </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">b = B()</span><br><span class="line">b.show()</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">show</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡ä¸Šé¢çš„é¢ä»£ç å¯ä»¥éªŒè¯ï¼Œåœ¨Bç±»ä¸­ï¼Œå¹¶æ²¡æœ‰showæ–¹æ³•ï¼Œä½†æ˜¯Bç±»ç»§æ‰¿äº†Aç±»ï¼Œç›¸å½“äºç»§æ‰¿äº†Aç±»æ‰€æœ‰çš„ä»£ç ï¼Œæ‰€ä»¥Bç±»çš„å¯¹è±¡å¯ä»¥ä½¿ç”¨Aç±»çš„æˆå‘˜æ–¹æ³•ã€‚</p>
<h1 id="é‡å†™çš„ç‰¹æ€§"><a href="#é‡å†™çš„ç‰¹æ€§" class="headerlink" title="é‡å†™çš„ç‰¹æ€§"></a>é‡å†™çš„ç‰¹æ€§</h1><p>ä¸Šé¢æˆ‘ä»¬è¯´åˆ°ï¼Œåªæœ‰åœ¨å­ç±»ä¸­ä¸çˆ¶ç±»çš„æˆå‘˜æ–¹æ³•åå­—ä¸å†²çªçš„æ—¶å€™ï¼Œæ‰ä¼š<code>å°†çˆ¶ç±»ä¸­çš„æˆå‘˜æ–¹æ³•copyåˆ°å­ç±»ä¸­ä½¿ç”¨</code>ï¼ˆç»§æ‰¿åˆ°å­ç±»ï¼‰é‚£ä¹ˆï¼Œå‡å¦‚å­ç±»å’Œçˆ¶ç±»çš„æŸäº›æ–¹æ³•åå­—å†²çªäº†ä¼šæ€æ ·å‘¢ï¼Ÿ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(self)</span>:</span></span><br><span class="line">		print(<span class="string">'A show'</span>)</span><br><span class="line">		</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span><span class="params">(A)</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self)</span>:</span></span><br><span class="line">		print(<span class="string">'get'</span>)</span><br><span class="line">		</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(self)</span>:</span></span><br><span class="line">		print(<span class="string">'B show'</span>)</span><br><span class="line">		</span><br><span class="line">b = B()</span><br><span class="line">b.show()</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">B show</span><br></pre></td></tr></table></figure>

<h1 id="åœ¨çˆ¶ç±»ä¸­è°ƒç”¨å­ç±»çš„æˆå‘˜å±æ€§æˆ–æ–¹æ³•"><a href="#åœ¨çˆ¶ç±»ä¸­è°ƒç”¨å­ç±»çš„æˆå‘˜å±æ€§æˆ–æ–¹æ³•" class="headerlink" title="åœ¨çˆ¶ç±»ä¸­è°ƒç”¨å­ç±»çš„æˆå‘˜å±æ€§æˆ–æ–¹æ³•"></a>åœ¨çˆ¶ç±»ä¸­è°ƒç”¨å­ç±»çš„æˆå‘˜å±æ€§æˆ–æ–¹æ³•</h1><ul>
<li>å®ä¾‹ä¸€</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'A show'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(self.name)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">func2</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.get()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span><span class="params">(A)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'get'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'B show'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">b = B(<span class="string">'polarsnow'</span>)</span><br><span class="line">b.func()</span><br><span class="line">b.func2()</span><br></pre></td></tr></table></figure>

<p>çŒœä¸€çŒœä¼šæœ‰ä»€ä¹ˆæ ·çš„ç»“æœï¼Ÿä¼šæ‰“å°å‡º<code>polarsnow</code>å’Œ<code>get</code>å—ï¼Ÿ</p>
<p>æŒ‰ç…§ä¹‹å‰çš„è¯´æ³•ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä¸Šé¢çš„ç»§æ‰¿çœ‹æˆä¸‹é¢è¿™æ ·</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">		self.name = name</span><br><span class="line">		</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(self)</span>:</span></span><br><span class="line">		print(self.name)</span><br><span class="line">		</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">func2</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.get()</span><br><span class="line">		</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self)</span>:</span></span><br><span class="line">		print(<span class="string">'get'</span>)</span><br><span class="line">		</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(self)</span>:</span></span><br><span class="line">		print(<span class="string">'B show'</span>)</span><br><span class="line">		</span><br><span class="line">b = B(<span class="string">'polarsnow'</span>)</span><br><span class="line">b.func()</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·çœ‹ç­”æ¡ˆå°±æ¸…æ¥šäº†å§ï¼Œè‚¯å®šæ˜¯ä¼šæ‰“å°<code>polarsnow</code>å’Œ<code>get</code>çš„</p>
<p>è¿™é‡Œåªæ˜¯ä¸¾ä¸ªä¾‹å­ï¼Œå®é™…ä½¿ç”¨ä¸­ï¼Œä¸æ¨èåœ¨çˆ¶ç±»ä¸­å»è°ƒç”¨å­ç±»çš„å±æ€§ï¼Œå› ä¸ºæœ‰çš„æ—¶å€™ï¼Œä½ ä¸èƒ½ç¡®å®šæ‰€æœ‰ç»§æ‰¿è¿™ä¸ªçˆ¶ç±»çš„å­ç±»éƒ½æ‹¥æœ‰è¿™ä¸ªæˆå‘˜å±æ€§ã€‚</p>
<ul>
<li>å®ä¾‹äºŒ</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">f1</span><span class="params">(self)</span>:</span></span><br><span class="line">		self.f2()</span><br><span class="line">		</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">f2</span><span class="params">(self)</span>:</span></span><br><span class="line">		print(<span class="string">'A f2'</span>)</span><br><span class="line">		</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span><span class="params">(A)</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">f3</span><span class="params">(self)</span>:</span></span><br><span class="line">		self.f1()</span><br><span class="line">		</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">f2</span><span class="params">(self)</span>:</span></span><br><span class="line">		print(<span class="string">'B f2'</span>)</span><br><span class="line">		</span><br><span class="line">b = B()</span><br><span class="line">b.f3()</span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºäº†Bç±»çš„å¯¹è±¡bï¼Œç„¶åæ‰§è¡Œäº†å¯¹è±¡bçš„f3æ–¹æ³•ï¼Œåœ¨f3æ–¹æ³•ä¸­åˆæ‰§è¡Œäº†f1æ–¹æ³•ï¼Œf1æ–¹æ³•åœ¨Bç±»ä¸­æ²¡æœ‰ï¼Œä½†æ˜¯Bç±»ç»§æ‰¿äº†Aç±»çš„ä»£ç ï¼Œï¼ˆæ³¨æ„è¿™é‡Œæ˜¯ç»§æ‰¿äº†Aç±»çš„æˆå‘˜ï¼Œå¯ä»¥ç†è§£ä¸ºcopyè¿‡æ¥çš„æˆå‘˜ï¼Œè€Œä¸æ˜¯å»Aç±»ä¸­æ‰¾ç›¸åº”çš„æˆå‘˜ï¼‰æ‰§è¡Œäº†f1æ–¹æ³•åï¼Œåˆè°ƒç”¨äº†f2æ–¹æ³•ï¼Œæ€è€ƒï¼Œè¿™ä¸ªf2æ˜¯è°ƒç”¨äº†Aç±»ä¸­çš„f2è¿˜æ˜¯Bç±»ä¸­çš„f2ï¼Ÿ</p>
<p>æ ¹æ®ç»§æ‰¿çš„åŸç†ï¼Œæˆ‘ä»¬æŠŠä¸Šé¢çš„ä»£ç çœ‹åšå¦‚ä¸‹ä»£ç </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">f1</span><span class="params">(self)</span>:</span></span><br><span class="line">		self.f2()</span><br><span class="line">		</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">f2</span><span class="params">(self)</span>:</span></span><br><span class="line">		print(<span class="string">'A f2'</span>)</span><br><span class="line">		</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span><span class="params">(A)</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">f1</span><span class="params">(self)</span>:</span></span><br><span class="line">		self.f2()</span><br><span class="line">		</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">f3</span><span class="params">(self)</span>:</span></span><br><span class="line">		self.f1()</span><br><span class="line">		</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">f2</span><span class="params">(self)</span>:</span></span><br><span class="line">		print(<span class="string">'B f2'</span>)</span><br><span class="line">		</span><br><span class="line">b = B()</span><br><span class="line">b.f3()</span><br></pre></td></tr></table></figure>

<p>å°†çˆ¶ç±»ä¸­æœ‰è€Œå­ç±»ä¸­æ²¡æœ‰çš„æˆå‘˜copyåˆ°å­ç±»ä¸­ï¼Œå­ç±»ä¸­æœ‰è€Œçˆ¶ç±»ä¸­ä¹Ÿæœ‰çš„ä¼˜å…ˆä½¿ç”¨å­ç±»çš„æˆå‘˜ï¼ˆé‡å†™çˆ¶ç±»æˆå‘˜ï¼‰æ‰€ä»¥Aç±»ä¸­åªæœ‰f1è¿™ä¸ªæˆå‘˜æ–¹æ³•è¢«copyåˆ°äº†Bç±»ä¸­ã€‚</p>
<p>å½“Bç±»çš„å¯¹è±¡bè°ƒç”¨f3æ–¹æ³•æ—¶ï¼Œè°ƒç”¨æœ¬ç±»ä¸­çš„f1æ–¹æ³•ï¼ˆç»§æ‰¿è¿‡æ¥çš„æˆå‘˜æ–¹æ³•ï¼‰ï¼Œæ¥ç€åœ¨f1æ–¹æ³•ä¸­åˆè°ƒç”¨äº†æœ¬ç±»ä¸­å·²ç»å­˜åœ¨çš„f2æ–¹æ³•ã€‚æ‰€ä»¥æœ€åè°ƒç”¨çš„æ˜¯Bç±»ä¸­çš„f2æ–¹æ³•ã€‚</p>
<p>å¦‚æœæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œæ‰§è¡Œçš„f2æ˜¯å“ªé‡Œçš„f2ï¼Ÿ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a = A()</span><br><span class="line">a.f1()</span><br></pre></td></tr></table></figure>

<p>å½“ç„¶ä¼šæ‰§è¡Œæœ¬ç±»ä¸­çš„f2æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯Aç±»ä¸­çš„f2æ–¹æ³•</p>
<p><strong>æ€»ç»“ï¼š</strong>ç”±äºPythonç±»ä¸­selféšå¼ä¼ é€’å¯¹è±¡è‡ªå·±æœ¬èº«çš„ç‰¹æ€§ï¼Œå¯ä»¥çœ‹å‡ºï¼Œå¦‚æœè°ƒç”¨äº†å­ç±»ä¸­ä¸å­˜åœ¨çš„æˆå‘˜ï¼Œé‚£ä¹ˆå»çˆ¶ç±»ä¸­æŸ¥æ‰¾çš„æ—¶å€™ï¼Œselfå˜é‡ä»ç„¶ç­‰äºåŸå¯¹è±¡è‡ªå·±æœ¬èº«ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç»§æ‰¿çš„æ¯æ¬¡æŸ¥æ‰¾ï¼Œéƒ½ä¼šè¿”å›åˆ°æœ€åº•å±‚çš„ï¼ˆè°ƒç”¨å¯¹è±¡çš„é‚£ä¸€å±‚ï¼‰ç±»ä¸­å»æ‰¾ï¼Œå¦‚æœæ‰¾ä¸åˆ°ï¼Œæ‰ä¼šå»çˆ¶ç±»ä¸­æŸ¥æ‰¾ã€‚ï¼ˆè®°ä½æ¯æ¬¡å¯»æ‰¾å¤±è´¥éƒ½å›åˆ°åŸç‚¹ï¼‰</p>
<h1 id="å¤šç»§æ‰¿"><a href="#å¤šç»§æ‰¿" class="headerlink" title="å¤šç»§æ‰¿"></a>å¤šç»§æ‰¿</h1><ul>
<li>ä¸€ä¸ªç±»åŒæ—¶ç»§æ‰¿ä¸¤ä¸ªç±»çš„æƒ…å†µä¸‹ï¼Œä¼šä¼˜å…ˆå»å·¦è¾¹çš„çˆ¶ç±»ä¸­æŸ¥æ‰¾ï¼Œå¦‚æœæ²¡æœ‰åˆ™å»å³è¾¹çš„ç±»ä¸­æŸ¥æ‰¾</li>
</ul>
<p><img src="http://oss.20150509.cn/QQ20160628-1@2x.png" alt=""></p>
<ul>
<li>ä¸€ä¸ªç±»åŒæ—¶ç»§æ‰¿ä¸¤ä¸ªç±»ï¼Œå·¦è¾¹çš„ç±»åˆç»§æ‰¿äº†ä¸€ä¸ªç±»çš„æƒ…å†µä¸‹ï¼Œä¼šä¼˜å…ˆä»æœ€å·¦è¾¹çš„ç±»å¼€å§‹æ‰¾ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™ç»§ç»­å‘ä¸ŠæŸ¥æ‰¾ï¼Œå¦‚æœä¸Šé¢çš„ç±»è¿˜æœ‰å•ç»§æ‰¿ï¼Œå°±ç»§ç»­å‘ä¸ŠæŸ¥æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°æ²¡æœ‰ç»§æ‰¿çš„ç±»ä¸ºæ­¢</li>
</ul>
<p><img src="http://oss.20150509.cn/QQ20160628-2@2x.png" alt=""></p>
<ul>
<li>å¦‚æœå¤šç»§æ‰¿å‡ºç°äº†å¦‚ä¸‹çš„ç»§æ‰¿å…³ç³»ï¼Œé‚£ä¹ˆå·¦è¾¹çš„ç±»å°†æ‰¾åˆ°æ²¡æœ‰ç»§æ‰¿æˆ–å…¬å…±ç»§æ‰¿çš„ç±»ä¸ºæ­¢ï¼Œç„¶åå°±åˆ‡åˆ°äº†ç¬¬äºŒä¸ªç±»ä¸­ç»§ç»­å‘ä¸ŠæŸ¥æ‰¾ï¼Œå…¬å…±ç»§æ‰¿çš„ç±»ä¼šåœ¨æœ€å³è¾¹çš„ç±»ä¸­è¢«æ‰¾åˆ°</li>
</ul>
<p><img src="http://oss.20150509.cn/QQ20160628-3@2x.png" alt=""></p>
<h1 id="æŸ¥çœ‹Pythonæºç çš„æŠ€å·§"><a href="#æŸ¥çœ‹Pythonæºç çš„æŠ€å·§" class="headerlink" title="æŸ¥çœ‹Pythonæºç çš„æŠ€å·§"></a>æŸ¥çœ‹Pythonæºç çš„æŠ€å·§</h1><p>åœ¨Pythonçš„æºç ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°å¥½å¤šçš„passï¼Œå´ä¸çŸ¥é“çœŸæ­£çš„å‡½æ•°ä½“æˆ–æ–¹æ³•ä½“å†™åœ¨äº†å“ªé‡Œï¼Œé‚£ä¹ˆçœ‹å®ŒPythonçš„å¤šç»§æ‰¿ï¼Œå°†å®Œå…¨è§£å†³è¿™ä¸ªé—®é¢˜ï¼</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> socketserver</span><br><span class="line"></span><br><span class="line">s = socketserver.ThreadingTCPServer()</span><br><span class="line">s.serve_forever()</span><br></pre></td></tr></table></figure>

<p><code>socketserver.ThreadingTCPServer()</code>åˆ›å»ºäº†ä¸€ä¸ªå¯¹è±¡ï¼Œè€Œåˆ›å»ºå¯¹è±¡æ—¶éœ€è¦æ‰§è¡Œ<code>__init__</code>æ–¹æ³•ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹æºç ä¸­æœ‰æ²¡æœ‰æä¾›è¿™ä¸ªinitæ–¹æ³•</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æºç </span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThreadingTCPServer</span><span class="params">(ThreadingMixIn, TCPServer)</span>:</span> <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<p>ä»ä¸Šé¢çš„æºç ä¸­å¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸ªç±»ç›´æ¥è¢«passæ‰äº†ã€‚æ ¹æ®ä¸Šé¢çš„å¤šç»§æ‰¿çš„çŸ¥è¯†ï¼Œæœ¬ç±»ä¸­æ²¡æœ‰initæ–¹æ³•ï¼Œæˆ‘ä»¬éœ€è¦å»ä»–çš„çˆ¶ç±»ä¸­å»æŸ¥æ‰¾ï¼Œé¦–å…ˆå»å·¦è¾¹ç¬¬ä¸€ä¸ªçˆ¶ç±»ä¸­å»æŸ¥æ‰¾</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æºç </span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThreadingMixIn</span>:</span></span><br><span class="line">    <span class="string">"""Mix-in class to handle each request in a new thread."""</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Decides how threads will act upon termination of the</span></span><br><span class="line">    <span class="comment"># main process</span></span><br><span class="line">    daemon_threads = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_request_thread</span><span class="params">(self, request, client_address)</span>:</span></span><br><span class="line">        <span class="string">"""Same as in BaseServer but as a thread.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        In addition, exception handling is done here.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            self.finish_request(request, client_address)</span><br><span class="line">            self.shutdown_request(request)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            self.handle_error(request, client_address)</span><br><span class="line">            self.shutdown_request(request)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_request</span><span class="params">(self, request, client_address)</span>:</span></span><br><span class="line">        <span class="string">"""Start a new thread to process the request."""</span></span><br><span class="line">        t = threading.Thread(target = self.process_request_thread,</span><br><span class="line">                             args = (request, client_address))</span><br><span class="line">        t.daemon = self.daemon_threads</span><br><span class="line">        t.start()</span><br></pre></td></tr></table></figure>

<p>è¿™è¾¹ä¹Ÿæ²¡æœ‰initæ–¹æ³•ï¼Œè¿™ä¸ªæ—¶å€™ç”±äºè¿™ä¸ªç±»ä¸å†æœ‰ç»§æ‰¿å…³ç³»ï¼Œæ‰€ä»¥éœ€è¦å›åˆ°åŸç‚¹æŸ¥æ‰¾ç¬¬äºŒä¸ªçˆ¶ç±»ä¸­æœ‰æ²¡æœ‰initæ–¹æ³•ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æºç </span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TCPServer</span><span class="params">(BaseServer)</span>:</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, server_address, RequestHandlerClass, bind_and_activate=True)</span>:</span></span><br><span class="line">        <span class="string">"""Constructor.  May be extended, do not override."""</span></span><br><span class="line">        BaseServer.__init__(self, server_address, RequestHandlerClass)</span><br><span class="line">        self.socket = socket.socket(self.address_family,</span><br><span class="line">                                    self.socket_type)</span><br><span class="line">        <span class="keyword">if</span> bind_and_activate:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                self.server_bind()</span><br><span class="line">                self.server_activate()</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                self.server_close()</span><br><span class="line">                <span class="keyword">raise</span></span><br><span class="line"></span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>

<p>å“~ åœ¨è¿™é‡Œæ‰¾åˆ°äº†initæ–¹æ³•ï¼Œé‚£ä¹ˆæœ€å¼€å§‹åˆ›å»ºçš„å¯¹è±¡çš„ä»£ç çš„initæ–¹æ³•ï¼Œå°±ä¼šä½¿ç”¨è¿™é‡Œçš„ä»£ç å•¦ï¼</p>
<p>è‡³æ­¤ï¼Œ<code>s = socketserver.TreadingTCPServer()</code>è¿™ä¸€è¡Œä»£ç å°±æ‰§è¡Œå®Œæ¯•å•¦ã€‚</p>
<p>æ¥ä¸‹æ¥éœ€è¦æ‰§è¡Œè¿™ä¸ªå¯¹è±¡çš„<code>server.forver()</code>æ–¹æ³•</p>
<p>æ¥ç€åˆå›åˆ°è¿™ä¸ªç±»ä¸­æŸ¥æ‰¾</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æºç </span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThreadingTCPServer</span><span class="params">(ThreadingMixIn, TCPServer)</span>:</span> <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<p>æ²¡æœ‰ï¼Œä»å·¦è¾¹çš„çˆ¶ç±»æ‰¾</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æºç </span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThreadingMixIn</span>:</span></span><br><span class="line">    <span class="string">"""Mix-in class to handle each request in a new thread."""</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Decides how threads will act upon termination of the</span></span><br><span class="line">    <span class="comment"># main process</span></span><br><span class="line">    daemon_threads = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_request_thread</span><span class="params">(self, request, client_address)</span>:</span></span><br><span class="line">        <span class="string">"""Same as in BaseServer but as a thread.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        In addition, exception handling is done here.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            self.finish_request(request, client_address)</span><br><span class="line">            self.shutdown_request(request)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            self.handle_error(request, client_address)</span><br><span class="line">            self.shutdown_request(request)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_request</span><span class="params">(self, request, client_address)</span>:</span></span><br><span class="line">        <span class="string">"""Start a new thread to process the request."""</span></span><br><span class="line">        t = threading.Thread(target = self.process_request_thread,</span><br><span class="line">                             args = (request, client_address))</span><br><span class="line">        t.daemon = self.daemon_threads</span><br><span class="line">        t.start()</span><br></pre></td></tr></table></figure>

<p>å·¦è¾¹æ²¡æœ‰ï¼Œå»å³è¾¹æŸ¥æ‰¾</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æºç </span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TCPServer</span><span class="params">(BaseServer)</span>:</span></span><br><span class="line">	...</span><br></pre></td></tr></table></figure>

<p>å³è¾¹ä¹Ÿæ²¡æœ‰æ‰¾åˆ°ï¼Œä½†æ˜¯å³è¾¹çš„çˆ¶ç±»ä¸­ï¼Œè¿˜æœ‰ä¸€ä¸ªç»§æ‰¿ï¼Œç»§ç»­å‘ä¸ŠæŸ¥æ‰¾ï¼</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æºç </span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BaseServer</span>:</span></span><br><span class="line">	...</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">serve_forever</span><span class="params">(self, poll_interval=<span class="number">0.5</span>)</span>:</span></span><br><span class="line">        <span class="string">"""Handle one request at a time until shutdown.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Polls for shutdown every poll_interval seconds. Ignores</span></span><br><span class="line"><span class="string">        self.timeout. If you need to do periodic tasks, do them in</span></span><br><span class="line"><span class="string">        another thread.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self.__is_shut_down.clear()</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># <span class="doctag">XXX:</span> Consider using another file descriptor or connecting to the</span></span><br><span class="line">            <span class="comment"># socket to wake this up instead of polling. Polling reduces our</span></span><br><span class="line">            <span class="comment"># responsiveness to a shutdown request and wastes cpu at all other</span></span><br><span class="line">            <span class="comment"># times.</span></span><br><span class="line">            <span class="keyword">with</span> _ServerSelector() <span class="keyword">as</span> selector:</span><br><span class="line">                selector.register(self, selectors.EVENT_READ)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">while</span> <span class="keyword">not</span> self.__shutdown_request:</span><br><span class="line">                    ready = selector.select(poll_interval)</span><br><span class="line">                    <span class="keyword">if</span> ready:</span><br><span class="line">                        self._handle_request_noblock()</span><br><span class="line"></span><br><span class="line">                    self.service_actions()</span><br><span class="line">        <span class="keyword">finally</span>:</span><br><span class="line">            self.__shutdown_request = <span class="literal">False</span></span><br><span class="line">            self.__is_shut_down.set()</span><br><span class="line">	...</span><br></pre></td></tr></table></figure>

<p>å•Šå“ˆï¼ŒåŸæ¥åœ¨è¿™é‡Œæ‰¾åˆ°äº†å®ƒï¼ï¼ï¼ä½†æ˜¯è¿™é‡Œé¢åˆè°ƒç”¨äº†<code>self._handle_request_noblock()</code>è¿™ä¸ªæ–¹æ³•ï¼Œæ ¹æ®ä¹‹å‰çš„ç»§æ‰¿åŸç†ï¼Œè¿™é‡Œçš„selfæŒ‡çš„æ˜¯è°ƒç”¨å¯¹è±¡çš„åœ°å€ï¼Œæ‰€ä»¥éœ€è¦é‡æ–°å›åˆ°<code>socketserver.ThreadingTCPServer()</code>å¼€å§‹æŸ¥æ‰¾</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># æºç </span><br><span class="line">class ThreadingTCPServer(ThreadingMixIn, TCPServer): pass</span><br></pre></td></tr></table></figure>

<p>æ²¡æœ‰ï¼Œæ‰¾å·¦è¾¹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æºç </span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThreadingMixIn</span>:</span></span><br><span class="line">    <span class="string">"""Mix-in class to handle each request in a new thread."""</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Decides how threads will act upon termination of the</span></span><br><span class="line">    <span class="comment"># main process</span></span><br><span class="line">    daemon_threads = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_request_thread</span><span class="params">(self, request, client_address)</span>:</span></span><br><span class="line">        <span class="string">"""Same as in BaseServer but as a thread.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        In addition, exception handling is done here.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            self.finish_request(request, client_address)</span><br><span class="line">            self.shutdown_request(request)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            self.handle_error(request, client_address)</span><br><span class="line">            self.shutdown_request(request)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_request</span><span class="params">(self, request, client_address)</span>:</span></span><br><span class="line">        <span class="string">"""Start a new thread to process the request."""</span></span><br><span class="line">        t = threading.Thread(target = self.process_request_thread,</span><br><span class="line">                             args = (request, client_address))</span><br><span class="line">        t.daemon = self.daemon_threads</span><br><span class="line">        t.start()</span><br></pre></td></tr></table></figure>

<p>å·¦è¾¹æ²¡æœ‰æ‰¾å³è¾¹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æºç </span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TCPServer</span><span class="params">(BaseServer)</span>:</span></span><br><span class="line">	...</span><br></pre></td></tr></table></figure>

<p>å³è¾¹ä¹Ÿæ²¡æœ‰ï¼Œç»§ç»­å‘ä¸Šæ‰¾</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æºç </span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BaseServer</span>:</span></span><br><span class="line">	...</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">_handle_request_noblock</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""Handle one request, without blocking.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        I assume that selector.select() has returned that the socket is</span></span><br><span class="line"><span class="string">        readable before this function was called, so there should be no risk of</span></span><br><span class="line"><span class="string">        blocking in get_request().</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            request, client_address = self.get_request()</span><br><span class="line">        <span class="keyword">except</span> OSError:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> self.verify_request(request, client_address):</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                self.process_request(request, client_address)</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                self.handle_error(request, client_address)</span><br><span class="line">                self.shutdown_request(request)</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>

<p>æ‰¾åˆ°äº†ï¼ä½†æ˜¯è¿™é‡Œé¢åˆæ‰§è¡Œäº†<code>self.process_request()</code>,æœ‰selfï¼Œä»éœ€è¦å›åˆ°æœ€å¼€å§‹çš„åœ°æ–¹æŸ¥æ‰¾</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># æºç </span><br><span class="line">class ThreadingTCPServer(ThreadingMixIn, TCPServer): pass</span><br></pre></td></tr></table></figure>

<p>æ²¡æœ‰ï¼Œæ‰¾å·¦è¾¹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æºç </span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThreadingMixIn</span>:</span></span><br><span class="line">    <span class="string">"""Mix-in class to handle each request in a new thread."""</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Decides how threads will act upon termination of the</span></span><br><span class="line">    <span class="comment"># main process</span></span><br><span class="line">    daemon_threads = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_request_thread</span><span class="params">(self, request, client_address)</span>:</span></span><br><span class="line">        <span class="string">"""Same as in BaseServer but as a thread.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        In addition, exception handling is done here.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            self.finish_request(request, client_address)</span><br><span class="line">            self.shutdown_request(request)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            self.handle_error(request, client_address)</span><br><span class="line">            self.shutdown_request(request)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_request</span><span class="params">(self, request, client_address)</span>:</span></span><br><span class="line">        <span class="string">"""Start a new thread to process the request."""</span></span><br><span class="line">        t = threading.Thread(target = self.process_request_thread,</span><br><span class="line">                             args = (request, client_address))</span><br><span class="line">        t.daemon = self.daemon_threads</span><br><span class="line">        t.start()</span><br></pre></td></tr></table></figure>

<p>æ‰¾åˆ°å•¦ï¼ï¼ï¼</p>
<hr>
<p>è¿™å°±æ˜¯socketserverçš„æºç é˜…è¯»æ–¹æ³•ï¼Œä¹Ÿé€‚ç”¨äºæ‰€æœ‰æºç çš„é˜…è¯»æ–¹æ³•ï¼Œå†æ¬¡å¼ºè°ƒï¼Œé‡åˆ°selfä¸€å®šè¦å›åˆ°åŸç‚¹å†æ¬¡å¯»æ‰¾</p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>ç»§æ‰¿</tag>
        <tag>é¢å‘å¯¹è±¡</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythoné¢å‘å¯¹è±¡åŸºç¡€ç¯‡ä¹‹å°è£…</title>
    <url>/2016/06/28/Python%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E5%9F%BA%E7%A1%80%E7%AF%87%E4%B9%8B%E5%B0%81%E8%A3%85/</url>
    <content><![CDATA[<blockquote>
<p>åœ¨ä¸Šä¸€ç¯‡Pythoné¢å‘å¯¹è±¡çš„å¼€ç¯‡ä¸­ï¼Œç®€å•ä»‹ç»äº†Pythonä¸‹çš„å°è£…ç‰¹æ€§ï¼Œä¸»è¦å°è£…çš„å¯¹è±¡æ˜¯åŸºæœ¬æ•°æ®ç±»å‹ï¼ŒPythonä¸­é™¤äº†å¯ä»¥å°è£…åŸºæœ¬æ•°æ®ç±»å‹å¤–ï¼Œè¿˜å¯ä»¥å°è£…ç±»ä¼¼äºlistï¼Œtupleï¼Œsetç­‰å¸¸è§çš„å¼•ç”¨æ•°æ®ç±»å‹ï¼Œç”šè‡³å¯ä»¥å°è£…æˆ‘ä»¬è‡ªå®šä¹‰çš„å¯¹è±¡ã€‚</p>
<p>æœ¬ç¯‡å°±æ˜¯ä¸»è¦ä»‹ç»Pythonçš„å¯¹è±¡ä¸­å°è£…å¯¹è±¡çš„åŠŸèƒ½åŠå®ç°ã€‚</p>
</blockquote>
<p><strong>å¯¹è±¡ä¸­å°è£…å¯¹è±¡å®ä¾‹</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, host, b_obj)</span>:</span></span><br><span class="line">		self.host = host</span><br><span class="line">		self.b_obj = b_obj</span><br><span class="line">		</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, username, password)</span>:</span></span><br><span class="line">		self.username = username</span><br><span class="line">		self.password = password</span><br><span class="line">		</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(self)</span>:</span></span><br><span class="line">		print(<span class="string">'class B func show'</span>)</span><br><span class="line">		</span><br><span class="line">b = B(<span class="string">'ps'</span>, <span class="string">'password'</span>)</span><br><span class="line">a = A(<span class="string">'192.168.1.1'</span>, b)</span><br><span class="line">print(a.b_obj.username)</span><br><span class="line">print(a.b_obj.password)	</span><br><span class="line">a.b_obj.show()</span><br><span class="line">print(a.host)	</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">ps</span><br><span class="line">password</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> <span class="title">func</span> <span class="title">show</span></span></span><br><span class="line"><span class="class">192.168.1.1</span></span><br></pre></td></tr></table></figure>

<ul>
<li>ç¬¬1-4è¡Œï¼šå®šä¹‰äº†ä¸€ä¸ªAç±»ï¼Œæ„é€ æ–¹æ³•ä¸­ï¼Œæ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯ä¸»æœºåï¼Œä¸€ä¸ªæ˜¯è´¦æˆ·å¯¹è±¡ï¼ˆæ³¨æ„ï¼Œè¿™é‡Œæ¥æ”¶çš„æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼‰</li>
<li>ç¬¬6-9è¡Œï¼šå®šä¹‰äº†ä¸€ä¸ªBç±»ï¼Œæ„é€ æ–¹æ³•æ¥æ”¶ç”¨æˆ·åå’Œå¯†ç ä¸¤ä¸ªå­—ç¬¦ä¸²å‚æ•°</li>
<li>ç¬¬11-12è¡Œï¼šBç±»ä¸­çš„ä¸€ä¸ªå¯¹è±¡æ–¹æ³•</li>
<li>ç¬¬14è¡Œï¼šå®ä¾‹åŒ–ä¸€ä¸ªBç±»çš„å¯¹è±¡</li>
<li>ç¬¬15è¡Œï¼šå®ä¾‹åŒ–ä¸€ä¸ªAç±»çš„å¯¹è±¡ï¼Œå¹¶å°†Bç±»çš„å¯¹è±¡bå½“åšå‚æ•°ä¼ é€’ç»™Aç±»çš„æ„é€ æ–¹æ³•</li>
<li>ç¬¬16è¡Œï¼šaå¯¹è±¡çš„ç¬¬äºŒä¸ªæˆå‘˜å˜é‡æ˜¯ä¸€ä¸ªBç±»å‹çš„å¯¹è±¡ï¼Œa.b_objæŒ‡å‘çš„å°±æ˜¯Bç±»çš„å¯¹è±¡bï¼Œè€Œa.b_obj.usernameç­‰åŒäºæ‰§è¡Œäº†b.username</li>
<li>ç¬¬17-18è¡Œï¼šåŒç†ï¼Œç­‰åŒäºæ‰§è¡Œäº†<code>b.password</code>å’Œ<code>b.show()</code></li>
</ul>
<p><img src="http://oss.20150509.cn/QQ20160628-0@2x.png" alt=""></p>
<p><strong>æ¥ä¸‹æ¥æ„Ÿå—ä¸€ä¸‹å¯¹è±¡ä¸­å°è£…ä¸¤å±‚å¯¹è±¡çš„æƒ…å†µ</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, host, b_obj)</span>:</span></span><br><span class="line">		self.host = host</span><br><span class="line">		self.b_obj = b_obj</span><br><span class="line">		</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, username, password)</span>:</span></span><br><span class="line">		self.username = username</span><br><span class="line">		self.password = password</span><br><span class="line">		</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(self)</span>:</span></span><br><span class="line">		print(<span class="string">'class B func show'</span>)</span><br><span class="line">		</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, db, a_obj)</span>:</span></span><br><span class="line">		self.db = db</span><br><span class="line">		self.a_obj = a_obj</span><br><span class="line">		</span><br><span class="line">b = B(<span class="string">'ps'</span>, <span class="string">'password'</span>)</span><br><span class="line">a = A(<span class="string">'192.168.1.1'</span>, b)</span><br><span class="line">c = C(<span class="string">'MySQL'</span>, a)</span><br><span class="line"></span><br><span class="line">print(c.a_obj.b_obj.username)</span><br><span class="line">print(c.a_obj.b_obj.password)</span><br><span class="line">c.a_obj.b_obj.show()</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">ps</span><br><span class="line">password</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> <span class="title">func</span> <span class="title">show</span></span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>é¢å‘å¯¹è±¡</tag>
        <tag>å°è£…</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythoné¢å‘å¯¹è±¡å¼€ç¯‡</title>
    <url>/2016/06/25/Python%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E5%BC%80%E7%AF%87/</url>
    <content><![CDATA[<blockquote>
<p>Pythonæ˜¯ä¸€é—¨éå¸¸é€‚åˆåˆå­¦è€…å­¦ä¹ çš„è¯­è¨€ã€‚Pythonæœ¬èº«æ˜¯æ”¯æŒé¢å‘å¯¹è±¡ç¼–ç¨‹çš„ã€‚ä½†æ˜¯åœ¨è¿ç»´ç•Œï¼ŒPythonå¾ˆå¤šæ—¶å€™è¢«ç§°ä¹‹ä¸ºè„šæœ¬è¯­è¨€ï¼Œå› ä¸ºPythonä¸ä»…ä»…æ”¯æŒé¢å‘å¯¹è±¡ç¼–ç¨‹ï¼Œè¿˜æ”¯æŒå‡½æ•°å¼ç¼–ç¨‹ã€‚è¿™æ˜¯Javaå’ŒC#è¿™ç§OOPè¯­è¨€æ‰€ä¸æ”¯æŒçš„</p>
<p>Linuxä¸­çš„bash shellè¢«å½“åšä¸€ç§è„šæœ¬è¯­è¨€ï¼Œæœ¬èº«ä¹Ÿæ˜¯æ”¯æŒå‡½æ•°å¼ç¼–ç¨‹çš„ï¼Œä½†æ˜¯å¾ˆå¤šæ—¶å€™ï¼Œshellçš„é¢å‘è¿‡ç¨‹ç¼–ç¨‹ç®€å•ã€ç²—æš´ã€é«˜æ•ˆ</p>
<p>è€ŒPythonä¸ä»…ä»…æ”¯æŒOOPé¢å‘å¯¹è±¡ç¼–ç¨‹ï¼Œè¿˜æ”¯æŒè„šæœ¬è¯­è¨€çš„ç‰¹æ€§ï¼Œç›¸é¢è¿‡ç¨‹ç¼–ç¨‹å’Œå‡½æ•°å¼ç¼–ç¨‹</p>
</blockquote>
<h1 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h1><ul>
<li>é¢å‘è¿‡ç¨‹ï¼šæ ¹æ®ä¸šåŠ¡é€»è¾‘ä»ä¸Šåˆ°ä¸‹å†™ä»£ç </li>
<li>å‡½æ•°å¼ç¼–ç¨‹ï¼šå°†æŸä¸ªåŠŸèƒ½çš„ä»£ç å°è£…åˆ°ä¸€ä¸ªå‡½æ•°ä¸­ï¼Œåé¢ç”¨åˆ°è¯¥åŠŸèƒ½çš„æ—¶å€™æ— éœ€é‡æ–°ç¼–å†™ï¼Œä»…éœ€è¦è°ƒç”¨å‡½æ•°å³å¯</li>
<li>é¢å‘è¿‡ç¨‹ï¼šå¯¹å‡½æ•°è¿›è¡Œåˆ†ç±»å’Œå°è£…ï¼Œç»ˆæç›®æ ‡â€œæ¶ˆé™¤é‡å¤ä»£ç â€</li>
</ul>
<p>æˆ‘çš„OOPå¯è’™å¯¼å¸ˆä¹‹ä¸€ <code>Mars</code>ï¼ˆä¹‹å‰æ˜¯åƒå³°æ•™è‚²çš„è´Ÿè´£äººï¼Œ2016å¹´ç¦»èŒåˆ›ä¸šï¼Œç°åœ¨æ˜¯<code>è‚²çŸ¥åŒåˆ›</code>çš„åˆ›å§‹äººä¹‹ä¸€ï¼‰æ›¾ç»ç»™OOPä¸€ä¸ªæ¯”å–»ï¼Œè¯´é‡å¤ä»£ç å°±å¥½æ¯”æ˜¯åˆ«äººå¾€ä½ çš„è„¸ä¸Šåäº†å£ç—°ï¼Œæˆ‘ä»¬çš„ç»ˆæç›®æ ‡å°±æ˜¯â€œæ¶ˆé™¤é‡å¤ä»£ç â€</p>
<p><strong>é¦–å…ˆæ¥æ„Ÿå—ä¸‹é¢å‘è¿‡ç¨‹ç¼–ç¨‹å’Œå‡½æ•°å¼ç¼–ç¨‹</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é¢å‘è¿‡ç¨‹ç¼–ç¨‹</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>ï¼š</span><br><span class="line">    <span class="keyword">if</span> cpuåˆ©ç”¨ç‡ &gt; <span class="number">90</span>%:</span><br><span class="line">        <span class="comment">#å‘é€é‚®ä»¶æé†’</span></span><br><span class="line">        è¿æ¥é‚®ç®±æœåŠ¡å™¨</span><br><span class="line">        å‘é€é‚®ä»¶</span><br><span class="line">        å…³é—­è¿æ¥</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> ç¡¬ç›˜ä½¿ç”¨ç©ºé—´ &gt; <span class="number">90</span>%:</span><br><span class="line">        <span class="comment">#å‘é€é‚®ä»¶æé†’</span></span><br><span class="line">        è¿æ¥é‚®ç®±æœåŠ¡å™¨</span><br><span class="line">        å‘é€é‚®ä»¶</span><br><span class="line">        å…³é—­è¿æ¥</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> å†…å­˜å ç”¨ &gt; <span class="number">80</span>%:</span><br><span class="line">        <span class="comment">#å‘é€é‚®ä»¶æé†’</span></span><br><span class="line">        è¿æ¥é‚®ç®±æœåŠ¡å™¨</span><br><span class="line">        å‘é€é‚®ä»¶</span><br><span class="line">        å…³é—­è¿æ¥</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å‡½æ•°å¼ç¼–ç¨‹</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> å‘é€é‚®ä»¶<span class="params">(å†…å®¹)</span></span></span><br><span class="line"><span class="function">    #å‘é€é‚®ä»¶æé†’</span></span><br><span class="line"><span class="function">    è¿æ¥é‚®ç®±æœåŠ¡å™¨</span></span><br><span class="line"><span class="function">    å‘é€é‚®ä»¶</span></span><br><span class="line"><span class="function">    å…³é—­è¿æ¥</span></span><br><span class="line"><span class="function"> </span></span><br><span class="line"><span class="function"><span class="title">while</span> <span class="title">True</span>ï¼š</span></span><br><span class="line"><span class="function"> </span></span><br><span class="line"><span class="function">    <span class="title">if</span> <span class="title">cpu</span>åˆ©ç”¨ç‡ &gt; 90%:</span></span><br><span class="line">        å‘é€é‚®ä»¶(<span class="string">'CPUæŠ¥è­¦'</span>)</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> ç¡¬ç›˜ä½¿ç”¨ç©ºé—´ &gt; <span class="number">90</span>%:</span><br><span class="line">        å‘é€é‚®ä»¶(<span class="string">'ç¡¬ç›˜æŠ¥è­¦'</span>)</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> å†…å­˜å ç”¨ &gt; <span class="number">80</span>%:</span><br><span class="line">        å‘é€é‚®ä»¶(<span class="string">'å†…å­˜æŠ¥è­¦'</span>)</span><br></pre></td></tr></table></figure>

<p>æ¯ç§å†™æ³•éƒ½æœ‰è‡ªå·±å­˜åœ¨çš„ä»·å€¼ï¼Œä¸–ç•Œä¸Šæ²¡æœ‰æœ€å¥½çš„ç¼–ç¨‹æ–¹å¼ï¼Œåªæœ‰æœ€åˆé€‚çš„ç¼–ç¨‹æ–¹å¼</p>
<h1 id="åˆ›å»ºç±»å’Œå¯¹è±¡"><a href="#åˆ›å»ºç±»å’Œå¯¹è±¡" class="headerlink" title="åˆ›å»ºç±»å’Œå¯¹è±¡"></a>åˆ›å»ºç±»å’Œå¯¹è±¡</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºç±»</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span>:</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment"># åˆ›å»ºç±»ä¸­çš„å‡½æ•°ï¼ˆç±»ä¸­çš„å‡½æ•°åˆè¢«ç§°ä½œç±»çš„æ–¹æ³•ï¼‰</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(self)</span>:</span></span><br><span class="line">	</span><br><span class="line">		<span class="comment"># å‡½æ•°ä½“ æ–¹æ³•ä½“</span></span><br><span class="line">		<span class="keyword">pass</span></span><br><span class="line">		</span><br><span class="line"><span class="comment"># åˆ›å»ºFooè¿™ä¸ªç±»çš„å¯¹è±¡</span></span><br><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªç±»çš„å¯¹è±¡ï¼Œåˆè¢«ç§°ä½œç±»çš„å®ä¾‹åŒ–å¯¹è±¡</span></span><br><span class="line">obj = Foo()</span><br></pre></td></tr></table></figure>

<p><strong>ä½“éªŒä¸€ä¸‹ä¸Šé¢çš„æŠ¥è­¦åŠŸèƒ½ç”¨OOPæ˜¯å¦‚ä½•å®ç°çš„</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">mail</span><span class="params">()</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> å‘é€é‚®ä»¶<span class="params">(self, å†…å®¹)</span>:</span></span><br><span class="line">		<span class="comment">#å‘é€é‚®ä»¶æé†’</span></span><br><span class="line">    	è¿æ¥é‚®ç®±æœåŠ¡å™¨</span><br><span class="line">    	å‘é€é‚®ä»¶</span><br><span class="line">    	å…³é—­è¿æ¥</span><br><span class="line">    	</span><br><span class="line">m = mail()</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>ï¼š</span><br><span class="line">    <span class="keyword">if</span> cpuåˆ©ç”¨ç‡ &gt; <span class="number">90</span>%:</span><br><span class="line">        m.å‘é€é‚®ä»¶(<span class="string">'CPUæŠ¥è­¦'</span>)</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> ç¡¬ç›˜ä½¿ç”¨ç©ºé—´ &gt; <span class="number">90</span>%:</span><br><span class="line">        m.å‘é€é‚®ä»¶(<span class="string">'ç¡¬ç›˜æŠ¥è­¦'</span>)</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> å†…å­˜å ç”¨ &gt; <span class="number">80</span>%:</span><br><span class="line">        m.å‘é€é‚®ä»¶(<span class="string">'å†…å­˜æŠ¥è­¦'</span>)</span><br></pre></td></tr></table></figure>

<p>ä¸ºä»€ä¹ˆç”¨äº†OOPï¼Œåè€Œä»£ç é‡æ¯”å‡½æ•°å¼ç¼–ç¨‹è¿˜è¦å¤šäº†å‘¢ï¼Œè€Œä¸”è°ƒç”¨æ–¹æ³•æ—¶ä¸èƒ½ç›´æ¥è°ƒç”¨äº†ï¼Œéœ€è¦ä½¿ç”¨mailç±»çš„å¯¹è±¡æ¥è°ƒç”¨ã€‚</p>
<p>æ€»ç»“ï¼šOOPçš„ä¼˜åŠ¿åœ¨æå°‘çš„ä»£ç é‡çš„æƒ…å†µä¸‹å¾ˆéš¾ä½“ç°å‡ºæ¥ã€‚è€Œä¸”åº”å¯¹ä¸åŒåœºæ™¯ï¼Œä½¿ç”¨ä¸é€šçš„æ–¹å¼ç¼–ç¨‹å¾ˆé‡è¦ã€‚å‡½æ•°å¼ç¼–ç¨‹çš„åº”ç”¨åœºæ™¯â€“&gt;å„ä¸ªå‡½æ•°ä¹‹é—´æ˜¯ç‹¬ç«‹çš„ä¸”æ²¡æœ‰å…±ç”¨çš„æ•°æ®ã€‚</p>
<h1 id="ç±»å’Œå¯¹è±¡çš„åˆ›å»º"><a href="#ç±»å’Œå¯¹è±¡çš„åˆ›å»º" class="headerlink" title="ç±»å’Œå¯¹è±¡çš„åˆ›å»º"></a>ç±»å’Œå¯¹è±¡çš„åˆ›å»º</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºç±»</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span>:</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment"># åˆ›å»ºç±»ä¸­çš„å‡½æ•°</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(self)</span>:</span></span><br><span class="line">		<span class="keyword">pass</span></span><br><span class="line">		</span><br><span class="line"><span class="comment"># æ ¹æ®ç±»Fooåˆ›å»ºå¯¹è±¡obj</span></span><br><span class="line">obj = Foo()</span><br></pre></td></tr></table></figure>

<h1 id="å¯¹è±¡å’Œç±»çš„å…³ç³»"><a href="#å¯¹è±¡å’Œç±»çš„å…³ç³»" class="headerlink" title="å¯¹è±¡å’Œç±»çš„å…³ç³»"></a>å¯¹è±¡å’Œç±»çš„å…³ç³»</h1><p>åˆ›å»ºç±»</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(self)</span>:</span></span><br><span class="line">		<span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºå¯¹è±¡</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">obj1 = Foo()</span><br><span class="line">obj2 = Foo()</span><br><span class="line"></span><br><span class="line">obj1.func()</span><br><span class="line">obj2.func()</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨Fooç±»åˆ†åˆ«åˆ›å»ºäº†<code>obj1</code>å’Œ<code>obj2</code>ä¸¤ä¸ªå¯¹è±¡ï¼Œåœ¨è°ƒç”¨Fooç±»ä¸­çš„funcæ–¹æ³•æ—¶ï¼ˆè°ƒç”¨å¯¹è±¡æ–¹æ³•ï¼‰ï¼ŒPythonå¸®æˆ‘ä»¬éšå¼åœ°å°†è¿™ä¸ªå¯¹è±¡ä¼ é€’ç»™äº†funcå‡½æ•°çš„selfå‚æ•°ã€‚åœ¨ä¸€ä¸ªç±»çš„ä¼—å¤šå¯¹è±¡ä¸­ï¼Œå°±æ˜¯é€šè¿‡éšå¼çš„æŠŠè‡ªå·±ä¼ é€’ç»™selfå‚æ•°ï¼Œä»è€Œå®ç°äº†æ¯ä¸ªå¯¹è±¡ä¸ªæ€§ä¹‹å¤„ã€‚</p>
<p>æ¯ä¸€ä¸ªç”±ç±»å®ä¾‹åŒ–å‡ºæ¥çš„å¯¹è±¡ï¼Œéƒ½ä¿å­˜äº†ä¸€ä¸ª<code>ç±»å¯¹è±¡æŒ‡é’ˆ</code>æŒ‡å‘è‡ªå·±çš„ç±»</p>
<h1 id="å½¢å¼å‚æ•°self"><a href="#å½¢å¼å‚æ•°self" class="headerlink" title="å½¢å¼å‚æ•°self"></a>å½¢å¼å‚æ•°self</h1><p>åœ¨åˆ›å»ºç±»çš„æ—¶å€™ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦è®©ä¸€ä¸ªæ–¹æ³•åœ¨ä¸åŒçš„å¯¹è±¡æ“ä½œæ—¶å®ç°ä¸åŒçš„æ•ˆæœï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦æŠŠè¿™ä¸ªæ–¹æ³•åˆ›å»ºæˆä¸ºå¯¹è±¡æ–¹æ³•ã€‚ç±»ä¸­çš„å¯¹è±¡æ–¹æ³•æœ‰ä¸ªå¾ˆæ˜æ˜¾çš„æ ‡è®°å°±æ˜¯<code>self</code>å…³é”®å­—ï¼Œæ¯ä¸ªå¯¹è±¡æ–¹æ³•çš„å¤´ä¸€ä¸ªå‚æ•°ï¼Œéƒ½æ˜¯selfï¼</p>
<p>è¿™ä¸ª<code>self</code>èµ·åˆ°çš„ä½œç”¨å°±æ˜¯åŒºåˆ†ä¸åŒçš„å¯¹è±¡ï¼Œä»è€Œå®ç°å¯¹è±¡ä¸åŒï¼Œæ–¹æ³•æ‰§è¡Œçš„æ•ˆæœå°±ä¸åŒã€‚æˆ‘ä»¬åœ¨å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œè¯¥å¯¹è±¡è°ƒç”¨ç±»ä¸­çš„å¯¹è±¡æ–¹æ³•ï¼Œä¸éœ€è¦æ˜¾ç¤ºçš„å»ç»™<code>self</code>å‚æ•°ä¼ å€¼ï¼Œå› ä¸ºPythonä¼š<code>éšå¼çš„</code>å¸®æˆ‘ä»¬æŠŠå¯¹è±¡çš„åå­—ä¼ é€’ç»™å¯¹è±¡æ–¹æ³•ä¸­çš„ç¬¬ä¸€ä¸ª<code>self</code>å‚æ•°ã€‚ç®€å•çš„è¯´ï¼Œå°±æ˜¯å“ªä¸ªå¯¹è±¡å»æ‰§è¡Œå¯¹è±¡æ–¹æ³•ï¼Œselfå°±æ˜¯è°ã€‚ä¾‹å¦‚ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œ<code>obj1</code>å’Œ<code>obj2</code>åˆ†åˆ«è°ƒç”¨äº†å¯¹è±¡æ–¹æ³•ï¼Œé‚£ä¹ˆ<code>obj1</code>è°ƒç”¨<code>func</code>æ—¶ï¼Œ<code>self</code>å°±ç­‰äº<code>obj1</code>ï¼Œ<code>obj2</code>è°ƒç”¨<code>func</code>æ—¶ï¼Œ<code>self</code>å°±ç­‰äº<code>obj2</code></p>
<h1 id="æ„é€ æ–¹æ³•-æ„é€ å‡½æ•°"><a href="#æ„é€ æ–¹æ³•-æ„é€ å‡½æ•°" class="headerlink" title="æ„é€ æ–¹æ³•/æ„é€ å‡½æ•°"></a>æ„é€ æ–¹æ³•/æ„é€ å‡½æ•°</h1> <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ“ä½œMySQLæ•°æ®åº“çš„ç±»</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConnMySQL</span>:</span></span><br><span class="line">	<span class="comment"># æ„é€ æ–¹æ³• __init__(self)</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, host, port, username, pasword)</span>:</span></span><br><span class="line">		print(self, <span class="string">'æ¯ä¸€ä¸ªå¯¹è±¡è¢«åˆ›å»ºçš„æ—¶å€™éƒ½ä¼šæ‰§è¡Œè¿™ä¸ªæ–¹æ³•'</span>)</span><br><span class="line">		self.host = host</span><br><span class="line">		self.port = port</span><br><span class="line">		self.username = username</span><br><span class="line">		self.password = possword</span><br><span class="line">		</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">select</span><span class="params">(self, sql)</span>:</span></span><br><span class="line">		<span class="keyword">pass</span></span><br><span class="line">		</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(self, sql)</span>:</span></span><br><span class="line">		<span class="keyword">pass</span></span><br><span class="line">		</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(self, sql)</span>:</span></span><br><span class="line">		<span class="keyword">pass</span></span><br><span class="line">		</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">modify</span><span class="params">(self, sql)</span>:</span></span><br><span class="line">		<span class="keyword">pass</span></span><br><span class="line">		</span><br><span class="line"><span class="comment"># å®ä¾‹åŒ–æ“ä½œMySQLæ•°æ®åº“çš„å¯¹è±¡</span></span><br><span class="line">my1 = ConnMySQL(<span class="string">'192.168.1.1'</span>, <span class="number">3306</span>, <span class="string">'root'</span>, <span class="string">'p@55\/\/0rd'</span>)</span><br><span class="line">my2 = ConnMySQL(<span class="string">'192.168.1.2'</span>, <span class="number">3307</span>, <span class="string">'admin'</span>, <span class="string">'password'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨å¯¹è±¡å»æ“ä½œæ•°æ®åº“</span></span><br><span class="line"><span class="comment"># åˆ†åˆ«å»ä¸¤ä¸ªæ•°æ®åº“ä¸­æ“ä½œsqlè¯­å¥</span></span><br><span class="line">my1.select(<span class="string">'select uid, username, password from userinfo where age=26'</span>)</span><br><span class="line">my2.select(<span class="string">'select uid, username, password from userinfo where age=26'</span>)</span><br></pre></td></tr></table></figure>

<h1 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h1><ul>
<li>åœ¨å‡½æ•°å¼ç¼–ç¨‹ä¸­ï¼ŒPythonè§£é‡Šå™¨ä»ä¸Šå‘ä¸‹è§£é‡Šæ‰§è¡Œï¼Œå¦‚æœä¸€ä¸ªæ–¹æ³•Aä¸­ä¾èµ–å¦ä¸€ä¸ªæ–¹æ³•Bï¼Œé‚£ä¹ˆBå¿…é¡»è¦åœ¨Aä¹‹å‰å®šä¹‰ï¼Œå¦åˆ™Pythonè§£é‡Šå™¨ä¼šæŠ¥é”™ã€‚ä½†æ˜¯åœ¨ç±»ä¸­ä¸éœ€è¦ï¼Œç±»ä¸­çš„å‡½æ•°å¯ä»¥è°ƒç”¨ä»»æ„ä½ç½®çš„å‡½æ•°ã€‚</li>
</ul>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>OOP</tag>
        <tag>é¢å‘å¯¹è±¡</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonå‹ç¼©æ–‡ä»¶å¤„ç†æ¨¡å—</title>
    <url>/2016/06/25/Python%E5%8E%8B%E7%BC%A9%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86%E6%A8%A1%E5%9D%97/</url>
    <content><![CDATA[<blockquote>
<p>Pythonä¸­çš„zipfileå’Œtarfileä¸¤ä¸ªæ¨¡å—å¯ä»¥å®ç°å¯¹æ–‡ä»¶çš„å‹ç¼©å’Œè§£å‹ç¼©ã€‚å¹¶ä¸”æ”¯æŒå‘å‹ç¼©åŒ…ä¸­å‹å…¥æ–°çš„æ–‡ä»¶ï¼Œå’Œåœ¨å‹ç¼©åŒ…ä¸­æŒ‡å®šæ–‡ä»¶è¿›è¡Œè§£å‹ç¼©</p>
<p>Python Version: 3.5+</p>
</blockquote>
<h1 id="zip"><a href="#zip" class="headerlink" title="zip"></a>zip</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> zipfile</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºæ–°çš„å‹ç¼©æ–‡ä»¶</span></span><br><span class="line">z = zipfile.ZipFile(<span class="string">'docs.zip'</span>, <span class="string">'w'</span>)</span><br><span class="line"><span class="comment"># æ·»åŠ éœ€è¦å‹ç¼©çš„æ–‡ä»¶</span></span><br><span class="line">z.write(<span class="string">"c1.py"</span>)</span><br><span class="line">z.write(<span class="string">"c2.py"</span>)</span><br><span class="line">z.close()</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‘å·²å­˜åœ¨çš„å‹ç¼©åŒ…ä¸­æ·»åŠ æ–‡ä»¶</span></span><br><span class="line">z = zipfile.ZipFile(<span class="string">'docs.zip'</span>, <span class="string">'a'</span>)</span><br><span class="line"><span class="comment"># æ·»åŠ éœ€è¦å‹ç¼©çš„æ–‡ä»¶</span></span><br><span class="line">z.write(<span class="string">"test.conf"</span>)</span><br><span class="line">z.close()</span><br><span class="line"></span><br><span class="line"><span class="comment"># è§£å‹ç¼©æ‰€æœ‰æ–‡ä»¶</span></span><br><span class="line">z = zipfile.ZipFile(<span class="string">'docs.zip'</span>, <span class="string">'r'</span>)</span><br><span class="line">z.extractall()</span><br><span class="line"></span><br><span class="line"><span class="comment"># è§£å‹ç¼©æŒ‡å®šæ–‡ä»¶</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ—å‡ºå‹ç¼©åŒ…ä¸­çš„æ‰€æœ‰æ–‡ä»¶å</span></span><br><span class="line">z = zipfile.ZipFile(<span class="string">'docs.zip'</span>, <span class="string">'r'</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> z.namelist():</span><br><span class="line">    print(i)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># æŒ‡å®šæ–‡ä»¶åç§°è¿›è¡Œè§£å‹</span></span><br><span class="line">z.extract(<span class="string">"c1.py"</span>)</span><br><span class="line">z.close()</span><br></pre></td></tr></table></figure>

<p>è§£å‹ç¼©è¡¥å……ï¼š</p>
<ul>
<li><code>path</code> å¯ä»¥æŒ‡å®šè§£å‹ç¼©ä¹‹åçš„æ–‡ä»¶çš„è·¯å¾„</li>
<li><code>pwd</code> å¯ä»¥æŒ‡å®šå»å“ªä¸ªç›®å½•ä¸‹è§£å‹ç¼©æ–‡ä»¶</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">extract</span><span class="params">(self, member, path=None, pwd=None)</span>:</span></span><br><span class="line">    <span class="string">"""Extract a member from the archive to the current working directory,</span></span><br><span class="line"><span class="string">       using its full name. Its file information is extracted as accurately</span></span><br><span class="line"><span class="string">       as possible. `member' may be a filename or a ZipInfo object. You can</span></span><br><span class="line"><span class="string">       specify a different directory using `path'.</span></span><br><span class="line"><span class="string">    """</span></span><br></pre></td></tr></table></figure>

<h1 id="tar-gz"><a href="#tar-gz" class="headerlink" title="tar.gz"></a>tar.gz</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> tarfile</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºæ–°çš„å‹ç¼©æ–‡ä»¶</span></span><br><span class="line">t = tarfile.open(<span class="string">'docs.zip'</span>, <span class="string">'w'</span>)</span><br><span class="line"><span class="comment"># æ·»åŠ éœ€è¦å‹ç¼©çš„æ–‡ä»¶</span></span><br><span class="line">t.add(<span class="string">"c1.py"</span>)</span><br><span class="line">t.add(<span class="string">"c2.py"</span>, arcname=<span class="string">"tc2.py"</span>)</span><br><span class="line">t.close()</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‘å·²å­˜åœ¨çš„å‹ç¼©åŒ…ä¸­æ·»åŠ æ–‡ä»¶</span></span><br><span class="line">t = tarfile.open(<span class="string">'docs.zip'</span>, <span class="string">'a'</span>)</span><br><span class="line"><span class="comment"># æ·»åŠ éœ€è¦å‹ç¼©çš„æ–‡ä»¶</span></span><br><span class="line">t.add(<span class="string">"test.conf"</span>)</span><br><span class="line">t.close()</span><br><span class="line"></span><br><span class="line"><span class="comment"># è§£å‹ç¼©æ‰€æœ‰æ–‡ä»¶</span></span><br><span class="line">t = tarfile.open(<span class="string">'docs.zip'</span>, <span class="string">'r'</span>)</span><br><span class="line">t.extractall()</span><br><span class="line"></span><br><span class="line"><span class="comment"># è§£å‹ç¼©æŒ‡å®šæ–‡ä»¶</span></span><br><span class="line"><span class="comment"># åˆ—å‡ºå‹ç¼©åŒ…ä¸­çš„æ‰€æœ‰æ–‡ä»¶å</span></span><br><span class="line">t = tarfile.open(<span class="string">'docs.zip'</span>, <span class="string">'r'</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> t.getnames():</span><br><span class="line">    print(i)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®šæ–‡ä»¶åç§°è¿›è¡Œè§£å‹</span></span><br><span class="line">t.extract(<span class="string">"tc2.py"</span>)</span><br><span class="line">t.close()</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨æ–‡ä»¶åè·å–è¯¥æ–‡ä»¶å¯¹è±¡,æŒ‡å®šè¯¥æ–‡ä»¶å¯¹è±¡è¿›è¡Œè§£å‹ç¼©</span></span><br><span class="line">o = t.getmember(<span class="string">'tc2.py'</span>)</span><br><span class="line">t.extract(o)</span><br><span class="line">t.close()</span><br></pre></td></tr></table></figure>

<p>è§£å‹ç¼©è¡¥å……ï¼š</p>
<ul>
<li><code>tarfile</code>è§£å‹ç¼©å•ä¸ªæ–‡ä»¶æ—¶æ”¯æŒä¸¤ç§æ–¹å¼è¿›è¡Œè§£å‹ï¼Œä¸€ç§æ˜¯æŒ‡å®šæ–‡ä»¶åï¼Œä¸€ç§æ˜¯æŒ‡å®šæ–‡ä»¶å¯¹è±¡ã€‚</li>
<li>è§£å‹æ–¹æ³•æ”¯æŒè§£å‹ç¼©æ–‡ä»¶åˆ°æŒ‡å®šç›®å½•ä¸­</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">extractall</span><span class="params">(self, path=<span class="string">"."</span>, members=None, *, numeric_owner=False)</span>:</span></span><br><span class="line">        <span class="string">"""Extract all members from the archive to the current working</span></span><br><span class="line"><span class="string">           directory and set owner, modification time and permissions on</span></span><br><span class="line"><span class="string">           directories afterwards. `path' specifies a different directory</span></span><br><span class="line"><span class="string">           to extract to. `members' is optional and must be a subset of the</span></span><br><span class="line"><span class="string">           list returned by getmembers(). If `numeric_owner` is True, only</span></span><br><span class="line"><span class="string">           the numbers for user/group names are used and not the names.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">extract</span><span class="params">(self, member, path=<span class="string">""</span>, set_attrs=True, *, numeric_owner=False)</span>:</span></span><br><span class="line">        <span class="string">"""Extract a member from the archive to the current working directory,</span></span><br><span class="line"><span class="string">           using its full name. Its file information is extracted as accurately</span></span><br><span class="line"><span class="string">           as possible. `member' may be a filename or a TarInfo object. You can</span></span><br><span class="line"><span class="string">           specify a different directory using `path'. File attributes (owner,</span></span><br><span class="line"><span class="string">           mtime, mode) are set unless `set_attrs' is False. If `numeric_owner`</span></span><br><span class="line"><span class="string">           is True, only the numbers for user/group names are used and not</span></span><br><span class="line"><span class="string">           the names.</span></span><br><span class="line"><span class="string">        """</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>æ¨¡å—</tag>
        <tag>zipfile</tag>
        <tag>tarfile</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythoné«˜çº§æ–‡ä»¶å¤„ç†æ¨¡å—shutil</title>
    <url>/2016/06/23/Python%E9%AB%98%E7%BA%A7%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86%E6%A8%A1%E5%9D%97shutil/</url>
    <content><![CDATA[<blockquote>
<p>shutilæ˜¯Pythonä¸­çš„é«˜çº§æ–‡ä»¶å¤„ç†æ¨¡å—ï¼Œå¯ä»¥ä½¿ç”¨å®ƒæ¥å¯¹æ–‡ä»¶è¿›è¡Œæ›´ç»†ç²’åº¦çš„æ“ä½œï¼Œå¦‚ä»…å¤åˆ¶æƒé™ã€å†…å®¹ã€å±ç»„ã€ç”¨æˆ·ã€çŠ¶æ€ç­‰ä¿¡æ¯ï¼Œè€Œä¸”shutilæ¨¡å—è¿˜å¯ä»¥åšåˆ°å¯¹å‹ç¼©æ–‡ä»¶è¿›è¡Œç®€å•çš„å¤„ç†ã€‚</p>
<p>Python Version: 3.5+</p>
</blockquote>
<h1 id="å°†æ–‡ä»¶å†…å®¹æ‹·è´åˆ°å¦ä¸€ä¸ªæ–‡ä»¶ä¸­"><a href="#å°†æ–‡ä»¶å†…å®¹æ‹·è´åˆ°å¦ä¸€ä¸ªæ–‡ä»¶ä¸­" class="headerlink" title="å°†æ–‡ä»¶å†…å®¹æ‹·è´åˆ°å¦ä¸€ä¸ªæ–‡ä»¶ä¸­"></a>å°†æ–‡ä»¶å†…å®¹æ‹·è´åˆ°å¦ä¸€ä¸ªæ–‡ä»¶ä¸­</h1><p>shutil.copyfileobj(fsrc, fdst[, length])</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line"> </span><br><span class="line">shutil.copyfileobj(open(<span class="string">'old.xml'</span>,<span class="string">'r'</span>), open(<span class="string">'new.xml'</span>, <span class="string">'w'</span>))</span><br></pre></td></tr></table></figure>


<h1 id="æ‹·è´æ–‡ä»¶"><a href="#æ‹·è´æ–‡ä»¶" class="headerlink" title="æ‹·è´æ–‡ä»¶"></a>æ‹·è´æ–‡ä»¶</h1><p>shutil.copyfile(src, dst)</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">shutil.copyfile(<span class="string">'f1.log'</span>, <span class="string">'f2.log'</span>)</span><br></pre></td></tr></table></figure>


<h1 id="ä»…æ‹·è´æƒé™ã€‚å†…å®¹ã€ç»„ã€ç”¨æˆ·å‡ä¸å˜"><a href="#ä»…æ‹·è´æƒé™ã€‚å†…å®¹ã€ç»„ã€ç”¨æˆ·å‡ä¸å˜" class="headerlink" title="ä»…æ‹·è´æƒé™ã€‚å†…å®¹ã€ç»„ã€ç”¨æˆ·å‡ä¸å˜"></a>ä»…æ‹·è´æƒé™ã€‚å†…å®¹ã€ç»„ã€ç”¨æˆ·å‡ä¸å˜</h1><p>shutil.copymode(src, dst)</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">shutil.copymode(<span class="string">'f1.log'</span>, <span class="string">'f2.log'</span>)</span><br></pre></td></tr></table></figure>


<h1 id="ä»…æ‹·è´çŠ¶æ€çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼šmode-bits-atime-mtime-flags"><a href="#ä»…æ‹·è´çŠ¶æ€çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼šmode-bits-atime-mtime-flags" class="headerlink" title="ä»…æ‹·è´çŠ¶æ€çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼šmode bits, atime, mtime, flags"></a>ä»…æ‹·è´çŠ¶æ€çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼šmode bits, atime, mtime, flags</h1><p>shutil.copystat(src, dst)</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">shutil.copystat(<span class="string">'f1.log'</span>, <span class="string">'f2.log'</span>)</span><br></pre></td></tr></table></figure>

<h1 id="æ‹·è´æ–‡ä»¶å’Œæƒé™"><a href="#æ‹·è´æ–‡ä»¶å’Œæƒé™" class="headerlink" title="æ‹·è´æ–‡ä»¶å’Œæƒé™"></a>æ‹·è´æ–‡ä»¶å’Œæƒé™</h1><p>shutil.copy(src, dst)</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line"> </span><br><span class="line">shutil.copy(<span class="string">'f1.log'</span>, <span class="string">'f2.log'</span>)</span><br></pre></td></tr></table></figure>

<h1 id="æ‹·è´æ–‡ä»¶å’ŒçŠ¶æ€ä¿¡æ¯"><a href="#æ‹·è´æ–‡ä»¶å’ŒçŠ¶æ€ä¿¡æ¯" class="headerlink" title="æ‹·è´æ–‡ä»¶å’ŒçŠ¶æ€ä¿¡æ¯"></a>æ‹·è´æ–‡ä»¶å’ŒçŠ¶æ€ä¿¡æ¯</h1><p>shutil.copy2(src, dst)</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line"> </span><br><span class="line">shutil.copy2(<span class="string">'f1.log'</span>, <span class="string">'f2.log'</span>)</span><br></pre></td></tr></table></figure>

<h1 id="é€’å½’çš„å»æ‹·è´æ–‡ä»¶å¤¹"><a href="#é€’å½’çš„å»æ‹·è´æ–‡ä»¶å¤¹" class="headerlink" title="é€’å½’çš„å»æ‹·è´æ–‡ä»¶å¤¹"></a>é€’å½’çš„å»æ‹·è´æ–‡ä»¶å¤¹</h1><p>shutil.ignore_patterns(*patterns)<br>shutil.copytree(src, dst, symlinks=False, ignore=None)</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line"> </span><br><span class="line">shutil.copytree(<span class="string">'folder1'</span>, <span class="string">'folder2'</span>, ignore=shutil.ignore_patterns(<span class="string">'*.pyc'</span>, <span class="string">'tmp*'</span>))</span><br></pre></td></tr></table></figure>

<p>å¤åˆ¶ä¸­è½¯è¿æ¥çš„é—®é¢˜ï¼šå¦‚æœsymlinksä¸ºTrueï¼Œé‚£ä¹ˆè½¯è¿æ¥çš„æ–‡ä»¶ä¼šè¢«copyåˆ°ç›®æ ‡ç›®å½•ä¸­ï¼Œå¦‚æœsymlinksä¸ºFalseï¼Œé‚£ä¹ˆåªä¼šå°†è½¯è¿æ¥è¿›è¡Œcopyï¼Œå‡å¦‚é“¾æ¥çš„ç›®å½•ä¸å­˜åœ¨åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line"></span><br><span class="line">shutil.copytree(<span class="string">'f1'</span>, <span class="string">'f2'</span>, symlinks=<span class="literal">True</span>, ignore=shutil.ignore_patterns(<span class="string">'*.pyc'</span>, <span class="string">'tmp*'</span>))</span><br></pre></td></tr></table></figure>

<h1 id="é€’å½’çš„å»åˆ é™¤æ–‡ä»¶"><a href="#é€’å½’çš„å»åˆ é™¤æ–‡ä»¶" class="headerlink" title="é€’å½’çš„å»åˆ é™¤æ–‡ä»¶"></a>é€’å½’çš„å»åˆ é™¤æ–‡ä»¶</h1><p>shutil.rmtree(path[, ignore_errors[, onerror]])</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line"> </span><br><span class="line">shutil.rmtree(<span class="string">'folder1'</span>)</span><br></pre></td></tr></table></figure>

<h1 id="é€’å½’çš„å»ç§»åŠ¨æ–‡ä»¶-é‡å‘½åï¼Œç±»ä¼¼mvå‘½ä»¤"><a href="#é€’å½’çš„å»ç§»åŠ¨æ–‡ä»¶-é‡å‘½åï¼Œç±»ä¼¼mvå‘½ä»¤" class="headerlink" title="é€’å½’çš„å»ç§»åŠ¨æ–‡ä»¶/é‡å‘½åï¼Œç±»ä¼¼mvå‘½ä»¤"></a>é€’å½’çš„å»ç§»åŠ¨æ–‡ä»¶/é‡å‘½åï¼Œç±»ä¼¼mvå‘½ä»¤</h1><p>shutil.move(src, dst)</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line"> </span><br><span class="line">shutil.move(<span class="string">'folder1'</span>, <span class="string">'folder3'</span>)</span><br></pre></td></tr></table></figure>

<h1 id="å‹ç¼©æ–‡ä»¶çš„å¤„ç†"><a href="#å‹ç¼©æ–‡ä»¶çš„å¤„ç†" class="headerlink" title="å‹ç¼©æ–‡ä»¶çš„å¤„ç†"></a>å‹ç¼©æ–‡ä»¶çš„å¤„ç†</h1><p>shutil.make_archive(base_name, format,â€¦)</p>
<p>å‚æ•°è¯´æ˜ï¼š</p>
<ul>
<li>base_nameï¼š å‹ç¼©åŒ…çš„æ–‡ä»¶åï¼Œä¹Ÿå¯ä»¥æ˜¯å‹ç¼©åŒ…çš„è·¯å¾„ã€‚åªæ˜¯æ–‡ä»¶åæ—¶ï¼Œåˆ™ä¿å­˜è‡³å½“å‰ç›®å½•ï¼Œå¦åˆ™ä¿å­˜è‡³æŒ‡å®šè·¯å¾„ï¼Œ<ul>
<li>å¦‚ï¼šdocs.tar.gz =&gt; ä¿å­˜è‡³å½“å‰è·¯å¾„,å¹¶ä»¥æ­¤ä¸ºæ–‡ä»¶å</li>
<li>å¦‚ï¼š/Users/PolarSnow/docs.tar.gz =&gt;ä¿å­˜è‡³/Users/PolarSnow/ å¹¶ä»¥docs.tar.gzçš„æ–‡ä»¶åä¿å­˜</li>
</ul>
</li>
<li>formatï¼š    å‹ç¼©åŒ…ç§ç±»ï¼Œâ€œzipâ€, â€œtarâ€, â€œbztarâ€ï¼Œâ€œgztarâ€</li>
<li>root_dirï¼š    è¦å‹ç¼©çš„æ–‡ä»¶å¤¹è·¯å¾„ï¼ˆé»˜è®¤å½“å‰ç›®å½•ï¼‰</li>
<li>ownerï¼š    ç”¨æˆ·ï¼Œé»˜è®¤å½“å‰ç”¨æˆ·</li>
<li>groupï¼š    ç»„ï¼Œé»˜è®¤å½“å‰ç»„</li>
<li>loggerï¼š    ç”¨äºè®°å½•æ—¥å¿—ï¼Œé€šå¸¸æ˜¯logging.Loggerå¯¹è±¡</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å°† /Users/polarsnow/Downloads/docs ä¸‹çš„æ–‡ä»¶æ‰“åŒ…æ”¾ç½®å½“å‰ç¨‹åºç›®å½•</span></span><br><span class="line"><span class="comment"># base_nameä¸éœ€è¦æŒ‡å®šæ–‡ä»¶åçš„åç¼€ï¼Œå‹ç¼©åä¼šè‡ªåŠ¨åœ¨åé¢åŠ ä¸Štar.gzçš„åç¼€</span></span><br><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line">ret = shutil.make_archive(<span class="string">"docs"</span>, <span class="string">'gztar'</span>, root_dir=<span class="string">'/Users/wupeiqi/Downloads/docs'</span>)</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#å°† /Users/polarsnow/Downloads/docs ä¸‹çš„æ–‡ä»¶æ‰“åŒ…æ”¾ç½® /Users/polarsnow/ç›®å½•ä¸‹ï¼Œå¹¶ä»¥docs.tar.gzå‘½å</span></span><br><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line">ret = shutil.make_archive(<span class="string">"/Users/wupeiqi/docs"</span>, <span class="string">'gztar'</span>, root_dir=<span class="string">'/Users/wupeiqi/Downloads/test'</span>)</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>æ¨¡å—</tag>
        <tag>shutil</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonä¸‹çš„ç³»ç»Ÿå‘½ä»¤æ¨¡å—subprocess</title>
    <url>/2016/06/23/Python%E4%B8%8B%E7%9A%84%E7%B3%BB%E7%BB%9F%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%9D%97subprocess/</url>
    <content><![CDATA[<blockquote>
<p>åœ¨Python3ä¸­ï¼Œcommandsæ¨¡å—è¢«ç§»é™¤æ‰ï¼Œcommandsæ¨¡å—æ‰§è¡Œshellå‘½ä»¤çš„ç›¸å…³æ¨¡å—å’Œå‡½æ•°çš„åŠŸèƒ½ï¼Œåœ¨subprocessæ¨¡å—æ€»å‡å¯å®ç°ï¼Œå¹¶ä¸”æä¾›äº†æ›´åŠ ä¸°å¯Œçš„åŠŸèƒ½</p>
<p>Python Version: 3.5+</p>
</blockquote>
<h1 id="call"><a href="#call" class="headerlink" title="call"></a>call</h1><p>æ‰§è¡Œå‘½ä»¤ï¼Œè¿”å›çŠ¶æ€ç </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>ret = subprocess.call([<span class="string">"df"</span>,<span class="string">"-h"</span>], shell=<span class="literal">False</span>)</span><br><span class="line">Filesystem      Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/disk1      <span class="number">233</span>G  <span class="number">107</span>G  <span class="number">127</span>G  <span class="number">46</span>% /</span><br><span class="line">/dev/disk2s1     <span class="number">58</span>G   <span class="number">36</span>G   <span class="number">22</span>G  <span class="number">63</span>% /Volumes/SanDisk</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(ret)</span><br><span class="line"><span class="number">0</span></span><br><span class="line">------------</span><br><span class="line"><span class="comment"># ä»¥shellçš„æ¨¡å¼è¿è¡Œ</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ret = subprocess.call(<span class="string">"df -h"</span>, shell=<span class="literal">True</span>)</span><br><span class="line">Filesystem      Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/disk1      <span class="number">233</span>G  <span class="number">107</span>G  <span class="number">127</span>G  <span class="number">46</span>% /</span><br><span class="line">/dev/disk2s1     <span class="number">58</span>G   <span class="number">36</span>G   <span class="number">22</span>G  <span class="number">63</span>% /Volumes/SanDisk</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(ret)</span><br><span class="line"><span class="number">0</span></span><br></pre></td></tr></table></figure>

<h1 id="check-call"><a href="#check-call" class="headerlink" title="check_call"></a>check_call</h1><p>æ£€æŸ¥æ‰§è¡Œå‘½ä»¤åçš„è¿”å›å€¼ï¼Œå¦‚æœæ˜¯0åˆ™è¿”å›ï¼Œå¦‚æœä¸æ˜¯åˆ™æŠ›å‡ºå¼‚å¸¸</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>ret = subprocess.check_call(<span class="string">"exit 1"</span>, shell=<span class="literal">True</span>)</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">  File <span class="string">"/Library/Frameworks/Python.framework/Versions/3.5/lib/python3.5/subprocess.py"</span>, line <span class="number">584</span>, <span class="keyword">in</span> check_call</span><br><span class="line">    <span class="keyword">raise</span> CalledProcessError(retcode, cmd)</span><br><span class="line">subprocess.CalledProcessError: Command <span class="string">'exit 1'</span> returned non-zero exit status <span class="number">1</span></span><br></pre></td></tr></table></figure>

<h1 id="check-output"><a href="#check-output" class="headerlink" title="check_output"></a>check_output</h1><p>æ£€æŸ¥æ‰§è¡Œå‘½ä»¤åçš„è¿”å›å€¼ï¼Œå¦‚æœæ˜¯0åˆ™è¿”å›æ‰§è¡Œç»“æœï¼Œå¦‚æœä¸æ˜¯åˆ™æŠ›å‡ºå¼‚å¸¸</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>ret = subprocess.check_output(<span class="string">"df -h"</span>, shell=<span class="literal">True</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(ret)</span><br><span class="line"><span class="string">b'Filesystem      Size  Used Avail Use% Mounted on\n/dev/disk1      233G  107G  127G  46% /\n/dev/disk2s1     58G   36G   22G  63% /Volumes/SanDisk\n'</span></span><br></pre></td></tr></table></figure>

<h1 id="Popen"><a href="#Popen" class="headerlink" title="Popen"></a>Popen</h1><p>ç”¨äºæ‰§è¡Œå¤æ‚çš„ç³»ç»Ÿå‘½ä»¤</p>
<p><strong>å‚æ•°ï¼š</strong></p>
<ul>
<li>argsï¼šshellå‘½ä»¤ï¼Œå¯ä»¥æ˜¯å­—ç¬¦ä¸²æˆ–è€…åºåˆ—ç±»å‹ï¼ˆå¦‚ï¼šlistï¼Œå…ƒç»„ï¼‰</li>
<li>bufsizeï¼šæŒ‡å®šç¼“å†²ã€‚0 æ— ç¼“å†²,1 è¡Œç¼“å†²,å…¶ä»– ç¼“å†²åŒºå¤§å°,è´Ÿå€¼ ç³»ç»Ÿç¼“å†²</li>
<li>stdin, stdout, stderrï¼šåˆ†åˆ«è¡¨ç¤ºç¨‹åºçš„æ ‡å‡†è¾“å…¥ã€è¾“å‡ºã€é”™è¯¯å¥æŸ„</li>
<li>preexec_fnï¼šåªåœ¨Unixå¹³å°ä¸‹æœ‰æ•ˆï¼Œç”¨äºæŒ‡å®šä¸€ä¸ªå¯æ‰§è¡Œå¯¹è±¡ï¼ˆcallable objectï¼‰ï¼Œå®ƒå°†åœ¨å­è¿›ç¨‹è¿è¡Œä¹‹å‰è¢«è°ƒç”¨</li>
<li>close_sfsï¼šåœ¨windowså¹³å°ä¸‹ï¼Œå¦‚æœclose_fdsè¢«è®¾ç½®ä¸ºTrueï¼Œåˆ™æ–°åˆ›å»ºçš„å­è¿›ç¨‹å°†ä¸ä¼šç»§æ‰¿çˆ¶è¿›ç¨‹çš„è¾“å…¥ã€è¾“å‡ºã€é”™è¯¯ç®¡é“ã€‚<br>æ‰€ä»¥ä¸èƒ½å°†close_fdsè®¾ç½®ä¸ºTrueåŒæ—¶é‡å®šå‘å­è¿›ç¨‹çš„æ ‡å‡†è¾“å…¥ã€è¾“å‡ºä¸é”™è¯¯(stdin, stdout, stderr)ã€‚</li>
<li>shellï¼šåŒä¸Š</li>
<li>cwdï¼šç”¨äºè®¾ç½®å­è¿›ç¨‹çš„å½“å‰ç›®å½•</li>
<li>envï¼šç”¨äºæŒ‡å®šå­è¿›ç¨‹çš„ç¯å¢ƒå˜é‡ã€‚å¦‚æœenv = Noneï¼Œå­è¿›ç¨‹çš„ç¯å¢ƒå˜é‡å°†ä»çˆ¶è¿›ç¨‹ä¸­ç»§æ‰¿ã€‚</li>
<li>universal_newlinesï¼šä¸åŒç³»ç»Ÿçš„æ¢è¡Œç¬¦ä¸åŒï¼ŒTrue -&gt; åŒæ„ä½¿ç”¨ \n</li>
<li>startupinfoä¸createionflagsåªåœ¨windowsä¸‹æœ‰æ•ˆ<br>å°†è¢«ä¼ é€’ç»™åº•å±‚çš„CreateProcess()å‡½æ•°ï¼Œç”¨äºè®¾ç½®å­è¿›ç¨‹çš„ä¸€äº›å±æ€§ï¼Œå¦‚ï¼šä¸»çª—å£çš„å¤–è§‚ï¼Œè¿›ç¨‹çš„ä¼˜å…ˆçº§ç­‰ç­‰ </li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line">ret1 = subprocess.Popen([<span class="string">"mkdir"</span>,<span class="string">"t1"</span>])</span><br><span class="line">ret2 = subprocess.Popen(<span class="string">"mkdir t2"</span>, shell=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<h2 id="éäº¤äº’æ¨¡å¼çš„å‘½ä»¤"><a href="#éäº¤äº’æ¨¡å¼çš„å‘½ä»¤" class="headerlink" title="éäº¤äº’æ¨¡å¼çš„å‘½ä»¤"></a>éäº¤äº’æ¨¡å¼çš„å‘½ä»¤</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line">obj = subprocess.Popen(<span class="string">"df -h"</span>, shell=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"polarsnow"</span>)</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">polarsnow</span><br><span class="line">Filesystem      Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/disk1      <span class="number">233</span>G  <span class="number">107</span>G  <span class="number">127</span>G  <span class="number">46</span>% /</span><br><span class="line">/dev/disk2s1     <span class="number">58</span>G   <span class="number">36</span>G   <span class="number">22</span>G  <span class="number">63</span>% /Volumes/SanDisk</span><br></pre></td></tr></table></figure>

<p>ä»ä¸Šé¢çš„ä¾‹å­ğŸŒ°çœ‹åˆ°ï¼Œçˆ¶è¿›ç¨‹åœ¨å¼€å¯å­è¿›ç¨‹ä¹‹åå¹¶æ²¡æœ‰ç­‰å¾…å­è¿›ç¨‹ç»“æŸï¼Œè€Œæ˜¯ç›´æ¥è¿è¡Œäº†print</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line">obj = subprocess.Popen(<span class="string">"df -h"</span>, shell=<span class="literal">True</span>)</span><br><span class="line">obj.wait()</span><br><span class="line">print(<span class="string">"polarsnow"</span>)</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">Filesystem      Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/disk1      <span class="number">233</span>G  <span class="number">107</span>G  <span class="number">127</span>G  <span class="number">46</span>% /</span><br><span class="line">/dev/disk2s1     <span class="number">58</span>G   <span class="number">36</span>G   <span class="number">22</span>G  <span class="number">63</span>% /Volumes/SanDisk</span><br><span class="line">polarsnow</span><br></pre></td></tr></table></figure>

<p>åŠ å…¥äº†waitä¹‹åï¼Œå¯ä»¥çœ‹åˆ°ï¼Œçˆ¶è¿›ç¨‹ä¼šç­‰å¾…å­è¿›ç¨‹è¿è¡Œç»“æŸåå†æ‰§è¡Œprint</p>
<p>æ­¤å¤–ï¼Œä½ è¿˜å¯ä»¥åœ¨çˆ¶è¿›ç¨‹ä¸­å¯¹å­è¿›ç¨‹è¿›è¡Œå¦‚ä¸‹å…¶ä»–çš„æ“ä½œï¼š</p>
<ul>
<li>obj.poll()  æ£€æŸ¥å­è¿›ç¨‹çš„çŠ¶æ€</li>
<li>obj.kill() ç»ˆæ­¢å­è¿›ç¨‹</li>
<li>obj.sent_signal() å‘å­è¿›ç¨‹å‘é€ä¿¡å·</li>
<li>obj.terminate() ç»ˆæ­¢å­è¿›ç¨‹</li>
<li>obj.pid æŸ¥çœ‹å­è¿›ç¨‹çš„pid</li>
<li>obj.args æŸ¥çœ‹shellå‘½ä»¤</li>
</ul>
<h2 id="å­è¿›ç¨‹çš„æ–‡æœ¬æµæ§åˆ¶"><a href="#å­è¿›ç¨‹çš„æ–‡æœ¬æµæ§åˆ¶" class="headerlink" title="å­è¿›ç¨‹çš„æ–‡æœ¬æµæ§åˆ¶"></a>å­è¿›ç¨‹çš„æ–‡æœ¬æµæ§åˆ¶</h2><ul>
<li>obj.stdin æ ‡å‡†è¾“å…¥</li>
<li>obj.stdout æ ‡å‡†è¾“å‡º</li>
<li>obj.stderr æ ‡å‡†é”™è¯¯</li>
</ul>
<p>å¯ä»¥åœ¨Popenå»ºç«‹å­è¿›ç¨‹çš„æ—¶å€™æ”¹å˜å­è¿›ç¨‹çš„æ ‡å‡†è¾“å…¥ã€æ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯ã€‚å¹¶å¯ä»¥åˆ©ç”¨subprocess.PIPEå°†å¤šä¸ªå­è¿›ç¨‹çš„è¾“å…¥è¾“å‡ºè¿æ¥åœ¨ä¸€èµ·ï¼Œæ„æˆç®¡é“</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line">obj = subprocess.Popen(<span class="string">"df -h"</span>, shell=<span class="literal">True</span>, stdout=subprocess.PIPE)</span><br><span class="line">print(obj.stdout.read())</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨äº†subprocessæä¾›çš„ç®¡é“ï¼Œå­è¿›ç¨‹æ‰§è¡Œå‘½ä»¤åçš„è¾“å‡ºä¸ä¼šå†é»˜è®¤è¾“å‡ºåˆ°å±å¹•ä¸Šäº†ï¼Œè€Œæ˜¯æ”¾åˆ°äº†ç®¡é“é‡Œï¼Œç­‰å¾…ç”¨æˆ·æå–ç®¡é“ä¸­çš„æ•°æ®</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line">obj = subprocess.Popen(<span class="string">"df -h"</span>, shell=<span class="literal">True</span>, stdout=subprocess.PIPE)</span><br><span class="line">print(obj.communicate())</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">(<span class="string">b'Filesystem      Size  Used Avail Use% Mounted on\n/dev/disk1      233G  107G  127G  46% /\n/dev/disk2s1     58G   36G   22G  63% /Volumes/SanDisk\n'</span>, <span class="literal">None</span>)</span><br></pre></td></tr></table></figure>

<p>communicate()ä¼šè¿”å›æ‰§è¡Œå‘½ä»¤çš„ç»“æœå’Œæ ‡å‡†é”™è¯¯ï¼Œä½†æ˜¯ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘åªæ˜¯å°†å­è¿›ç¨‹çš„æ ‡å‡†è¾“å‡ºæ”¾åˆ°çš„subprocessçš„ç®¡é“ä¸­ï¼Œå¹¶æ²¡æœ‰å¯¹æ ‡å‡†é”™è¯¯åº”ç”¨subprocessçš„ç®¡é“ï¼Œæ‰€ä»¥ï¼Œä¸ç®¡æœ‰æ²¡æœ‰æŠ¥é”™ï¼Œè¿™é‡Œçš„è¿”å›å€¼è¿”å›çš„æ ‡å‡†é”™è¯¯æ°¸è¿œæ˜¯Noneã€‚ä¸‹é¢æ¥éªŒè¯ä¸€ä¸‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line">obj = subprocess.Popen(<span class="string">"df -y"</span>, shell=<span class="literal">True</span>, stdout=subprocess.PIPE)</span><br><span class="line">print(obj.communicate())</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">df: invalid option -- <span class="string">'y'</span></span><br><span class="line">Try <span class="string">'df --help'</span> <span class="keyword">for</span> more information.</span><br><span class="line">(<span class="string">b''</span>, <span class="literal">None</span>)</span><br></pre></td></tr></table></figure>

<p>æœç„¶ï¼ŒæŠ¥é”™é»˜è®¤æ‰“åœ¨äº†å±å¹•ä¸Šï¼Œè€Œcommunicateçš„è¿”å›å€¼ä¸­çš„æ ‡å‡†é”™è¯¯ä¾ç„¶æ˜¯None</p>
<p><strong>å®ç°Linuxä¸­ | ç®¡é“çš„æ•ˆæœ</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line">obj1 = subprocess.Popen(<span class="string">"cat /etc/passwd"</span>, shell=<span class="literal">True</span>, stdout=subprocess.PIPE, stdin=subprocess.PIPE, stderr=subprocess.PIPE)</span><br><span class="line">obj2 = subprocess.Popen(<span class="string">"grep root"</span>, shell=<span class="literal">True</span>, stdin=obj1.stdout, stdout=subprocess.PIPE, stderr=subprocess.PIPE)</span><br><span class="line">out = obj2.communicate()</span><br><span class="line">print(out)</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">(<span class="string">b'root:*:0:0:System Administrator:/var/root:/bin/sh\ndaemon:*:1:1:System Services:/var/root:/usr/bin/false\n_cvmsroot:*:212:212:CVMS Root:/var/empty:/usr/bin/false\n'</span>, <span class="string">b''</span>)</span><br></pre></td></tr></table></figure>

<p>ç¬¬3è¡Œï¼šåˆ›å»ºäº†ä¸€ä¸ªå­è¿›ç¨‹å»æ‰§è¡Œå‘½ä»¤ï¼Œå¹¶å°†æ ‡å‡†è¾“å…¥è¾“å‡ºå’Œé”™è¯¯æ”¾åˆ°äº†subprocessæä¾›çš„ç®¡é“ä¸­ã€‚</p>
<p>ç¬¬4è¡Œï¼šåˆ›å»ºäº†å¦ä¸€ä¸ªå­è¿›ç¨‹å»æ‰§è¡Œå‘½ä»¤ï¼Œå‘½ä»¤çš„æ ‡å‡†è¾“å…¥æ˜¯ä¸Šä¸€æ¡å‘½ä»¤çš„æ ‡å‡†è¾“å‡ºï¼Œæ‰€ä»¥æŠŠobj1ä¸­çš„æ ‡å‡†è¾“å‡ºä»subprocessçš„ç®¡é“ä¸­å–å‡ºå½“åšæ ‡å‡†è¾“å…¥ä¼ é€’ç»™ç¬¬äºŒä¸ªå­è¿›ç¨‹</p>
<p>ä½ å¯èƒ½ä¼šæƒ³ï¼Œåœ¨ä¹‹å‰çš„ä¾‹å­ä¸­ï¼Œå¦‚æœä¸åŠ waitçš„è¯ï¼Œçˆ¶è¿›ç¨‹ä¸ç®¡å­è¿›ç¨‹æœ‰æ²¡æœ‰æ‰§è¡Œå®Œéƒ½ä¼šå¾€ä¸‹æ‰§è¡Œï¼Œé‚£ä¹ˆå‡å¦‚ç¬¬ä¸€æ¡å‘½ä»¤æ‰§è¡Œæ—¶é—´æ¯”è¾ƒé•¿ï¼Œçˆ¶è¿›ç¨‹å¦‚æœç»§ç»­å‘ä¸‹èµ°ï¼Œæ‰§è¡Œç¬¬äºŒæ¡å‘½ä»¤æ—¶ï¼Œè¿˜æ²¡æœ‰æ‹¿åˆ°ç¬¬ä¸€æ¡çš„æ ‡å‡†è¾“å‡ºï¼Œä¼šä¸ä¼šæŠ¥é”™å‘¢ï¼Ÿé¦–å…ˆï¼Œè¿™æ˜¯ä¸ªå¥½é—®é¢˜ï¼ä¸‹é¢è¯¦ç»†åˆ†æä¸€ä¸‹</p>
<ul>
<li>ç¨‹åºä¼šç»§ç»­å‘ä¸‹æ‰§è¡Œï¼Œä½†æ˜¯ä¼šåˆ†ä¸¤ç§æƒ…å†µï¼Œä¸€ç§æƒ…å†µæ˜¯ç¬¬äºŒæ¡å‘½ä»¤æ˜¯é˜»å¡çš„å‘½ä»¤ï¼Œç¬¬äºŒç§æƒ…å†µæ˜¯éé˜»å¡çš„å‘½ä»¤ã€‚<ul>
<li>å‡å¦‚ç¬¬äºŒæ¡æ˜¯é˜»å¡çš„å‘½ä»¤ï¼Œè¿›ç¨‹ä¼šä¸€ç›´å¡ä½ï¼Œç­‰å¾…æ¥æ”¶è¾“å…¥ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œç¨‹åºä¼šä¸€ç›´ç­‰ä¸‹å»ï¼Œç­‰åˆ°ç¬¬ä¸€æ¡å‘½ä»¤æ‰§è¡Œç»“æŸï¼ŒæŠŠæ ‡å‡†è¾“å‡ºæ”¾åˆ°ç®¡é“ä¸ºæ­¢ã€‚</li>
<li>å‡å¦‚ç¬¬äºŒæ¡å‘½ä»¤æ˜¯éé˜»å¡çš„å‘½ä»¤ï¼Œçˆ¶è¿›ç¨‹ä¼šç«‹å³å‘ä¸‹æ‰§è¡Œï¼Œè™½ç„¶ç¬¬ä¸€æ¡å‘½ä»¤è¿˜æ²¡æœ‰æŠŠæ ‡å‡†è¾“å‡ºæ”¾åˆ°ç®¡é“ä¸­ï¼Œç¬¬äºŒæ¡å‘½ä»¤ä¼šè®¤ä¸ºä½ è¦ç»™æˆ‘ä¼ çš„å°±æ˜¯ç©ºï¼Œæ‰€ä»¥ç¬¬äºŒæ¡å‘½ä»¤ä¼šè¢«è¿…é€Ÿæ‰§è¡Œå®Œæ¯•ï¼Œè€Œä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œè°ƒç”¨äº†ç¬¬äºŒæ¡å‘½ä»¤å¯¹è±¡çš„communicateæ–¹æ³•ï¼Œåªä¼šç­‰å¾…ç¬¬äºŒæ¡å‘½ä»¤æ‰§è¡Œå®Œæ¯•ï¼Œä¸€æ—¦ç¬¬äºŒæ¡å‘½ä»¤æ‰§è¡Œå®Œæ¯•ï¼Œä¸ç®¡ç¬¬ä¸€æ¡æœ‰æ²¡æœ‰æ‰§è¡Œå®Œéƒ½ä¼šç«‹å³é€€å‡º</li>
</ul>
</li>
</ul>
<p>subprocess.PIPEå®é™…ä¸Šä¸ºæ–‡æœ¬æµæä¾›ä¸€ä¸ªç¼“å­˜åŒºã€‚child1çš„stdoutå°†æ–‡æœ¬è¾“å‡ºåˆ°ç¼“å­˜åŒºï¼Œéšåchild2çš„stdinä»è¯¥PIPEä¸­å°†æ–‡æœ¬è¯»å–èµ°ã€‚child2çš„è¾“å‡ºæ–‡æœ¬ä¹Ÿè¢«å­˜æ”¾åœ¨PIPEä¸­ï¼Œç›´åˆ°communicate()æ–¹æ³•ä»PIPEä¸­è¯»å–å‡ºPIPEä¸­çš„æ–‡æœ¬ã€‚<br>æ³¨æ„ï¼šcommunicate()æ˜¯Popenå¯¹è±¡çš„ä¸€ä¸ªæ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šé˜»å¡çˆ¶è¿›ç¨‹ï¼Œç›´åˆ°å­è¿›ç¨‹å®Œæˆ</p>
<h2 id="å®ç°ç±»ä¼¼pexpectçš„äº¤äº’å¼å‘½ä»¤"><a href="#å®ç°ç±»ä¼¼pexpectçš„äº¤äº’å¼å‘½ä»¤" class="headerlink" title="å®ç°ç±»ä¼¼pexpectçš„äº¤äº’å¼å‘½ä»¤"></a>å®ç°ç±»ä¼¼pexpectçš„äº¤äº’å¼å‘½ä»¤</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line">obj = subprocess.Popen(<span class="string">"passwd ps"</span>, shell=<span class="literal">True</span>, stdin=subprocess.PIPE, stdout=subprocess.PIPE, stderr=subprocess.PIPE, universal_newlines=<span class="literal">True</span>)</span><br><span class="line">obj.stdin.write(<span class="string">"123\n"</span>)</span><br><span class="line">obj.stdin.write(<span class="string">"123\n"</span>)</span><br><span class="line">obj.stdin.close()</span><br><span class="line"></span><br><span class="line">cmd_out = obj.stdout.read()</span><br><span class="line">obj.stdout.close()</span><br><span class="line">cmd_error = obj.stderr.read()</span><br><span class="line">obj.stderr.close()</span><br><span class="line"></span><br><span class="line">print(cmd_out)</span><br><span class="line">print(cmd_error)</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">Changing password <span class="keyword">for</span> user ps.</span><br><span class="line">passwd: all authentication tokens updated successfully.</span><br><span class="line"></span><br><span class="line">New password: BAD PASSWORD: it <span class="keyword">is</span> WAY too short</span><br><span class="line">BAD PASSWORD: <span class="keyword">is</span> too simple</span><br><span class="line">Retype new password:</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line">obj = subprocess.Popen(<span class="string">"passwd ps"</span>, shell=<span class="literal">True</span>, stdin=subprocess.PIPE, stdout=subprocess.PIPE, stderr=subprocess.PIPE, universal_newlines=<span class="literal">True</span>)</span><br><span class="line">obj.stdin.write(<span class="string">"123\n"</span>)</span><br><span class="line">obj.stdin.write(<span class="string">"123\n"</span>)</span><br><span class="line"></span><br><span class="line">cmd_out, cmd_error = obj.communicate()</span><br><span class="line">print(cmd_out)</span><br><span class="line">print(cmd_error)</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">Changing password <span class="keyword">for</span> user ps.</span><br><span class="line">passwd: all authentication tokens updated successfully.</span><br><span class="line"></span><br><span class="line">New password: BAD PASSWORD: it <span class="keyword">is</span> WAY too short</span><br><span class="line">BAD PASSWORD: <span class="keyword">is</span> too simple</span><br><span class="line">Retype new password:</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line">obj = subprocess.Popen(<span class="string">"passwd ps"</span>, shell=<span class="literal">True</span>, stdin=subprocess.PIPE, stdout=subprocess.PIPE, stderr=subprocess.PIPE, universal_newlines=<span class="literal">True</span>)</span><br><span class="line">cmd_out, cmd_error = obj.communicate(<span class="string">'123\n123\n'</span>)</span><br><span class="line">print(cmd_out)</span><br><span class="line">print(cmd_error)</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">Changing password <span class="keyword">for</span> user ps.</span><br><span class="line">passwd: all authentication tokens updated successfully.</span><br><span class="line"></span><br><span class="line">New password: BAD PASSWORD: it <span class="keyword">is</span> WAY too short</span><br><span class="line">BAD PASSWORD: <span class="keyword">is</span> too simple</span><br><span class="line">Retype new password:</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>æ¨¡å—</tag>
        <tag>subprocess</tag>
      </tags>
  </entry>
  <entry>
    <title>lvmçš„åˆ›å»ºå’Œæ‰©å®¹</title>
    <url>/2016/06/22/lvm%E7%9A%84%E5%88%9B%E5%BB%BA%E5%92%8C%E6%89%A9%E5%AE%B9/</url>
    <content><![CDATA[<h1 id="åˆ›å»ºLVM"><a href="#åˆ›å»ºLVM" class="headerlink" title="åˆ›å»ºLVM"></a>åˆ›å»ºLVM</h1><p>æŸ¥çœ‹ç£ç›˜ä¿¡æ¯</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; fdisk -l</span><br><span class="line"></span><br><span class="line">Disk /dev/sdb: 2147 MB, 2147483648 bytes, 4194304 sectors</span><br><span class="line">Units = sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Disk /dev/sda: 21.5 GB, 21474836480 bytes, 41943040 sectors</span><br><span class="line">Units = sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk label <span class="built_in">type</span>: dos</span><br><span class="line">Disk identifier: 0x000cd8ec</span><br><span class="line"></span><br><span class="line">   Device Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/sda1   *        2048    41943039    20970496   83  Linux</span><br><span class="line"></span><br><span class="line">Disk /dev/sdc: 536.9 GB, 536870912000 bytes, 1048576000 sectors</span><br><span class="line">Units = sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br></pre></td></tr></table></figure>

<p>å¯¹æ–°ç£ç›˜åˆ†åŒº</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; fdisk /dev/sdc </span><br><span class="line">Welcome to fdisk (util-linux 2.23.2).</span><br><span class="line"></span><br><span class="line">Changes will remain <span class="keyword">in</span> memory only, until you decide to write them.</span><br><span class="line">Be careful before using the write <span class="built_in">command</span>.</span><br><span class="line"></span><br><span class="line">Device does not contain a recognized partition table</span><br><span class="line">Building a new DOS disklabel with disk identifier 0xe80f8142.</span><br><span class="line"></span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): n</span><br><span class="line">Partition <span class="built_in">type</span>:</span><br><span class="line">   p   primary (0 primary, 0 extended, 4 free)</span><br><span class="line">   e   extended</span><br><span class="line">Select (default p): p</span><br><span class="line">Partition number (1-4, default 1): 1</span><br><span class="line">First sector (2048-1048575999, default 2048): </span><br><span class="line">Using default value 2048</span><br><span class="line">Last sector, +sectors or +size&#123;K,M,G&#125; (2048-1048575999, default 1048575999): </span><br><span class="line">Using default value 1048575999</span><br><span class="line">Partition 1 of <span class="built_in">type</span> Linux and of size 500 GiB is <span class="built_in">set</span></span><br><span class="line"></span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): t</span><br><span class="line">Selected partition 1</span><br><span class="line">Hex code (<span class="built_in">type</span> L to list all codes): 8e</span><br><span class="line">Changed <span class="built_in">type</span> of partition <span class="string">'Linux'</span> to <span class="string">'Linux LVM'</span></span><br><span class="line"></span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): w</span><br><span class="line">The partition table has been altered!</span><br><span class="line"></span><br><span class="line">Calling ioctl() to re-read partition table.</span><br><span class="line">Syncing disks.</span><br></pre></td></tr></table></figure>

<p>æ›´æ–°åˆ†åŒºè¡¨</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; partprobe</span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºPV</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; pvcreate /dev/sdc1 </span><br><span class="line">  Physical volume <span class="string">"/dev/sdc1"</span> successfully created</span><br><span class="line">&gt; pvdisplay </span><br><span class="line">  <span class="string">"/dev/sdc1"</span> is a new physical volume of <span class="string">"500.00 GiB"</span></span><br><span class="line">  --- NEW Physical volume ---</span><br><span class="line">  PV Name               /dev/sdc1</span><br><span class="line">  VG Name               </span><br><span class="line">  PV Size               500.00 GiB</span><br><span class="line">  Allocatable           NO</span><br><span class="line">  PE Size               0   </span><br><span class="line">  Total PE              0</span><br><span class="line">  Free PE               0</span><br><span class="line">  Allocated PE          0</span><br><span class="line">  PV UUID               tBxBUK-gOTa-bdtK-1kbZ-01KQ-ASwQ-fuIwLi</span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºVG</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; vgcreate VolGroup00 /dev/sdc1 </span><br><span class="line">  Volume group <span class="string">"VolGroup00"</span> successfully created</span><br><span class="line">&gt; vgdisplay </span><br><span class="line">  --- Volume group ---</span><br><span class="line">  VG Name               VolGroup00</span><br><span class="line">  System ID             </span><br><span class="line">  Format                lvm2</span><br><span class="line">  Metadata Areas        1</span><br><span class="line">  Metadata Sequence No  1</span><br><span class="line">  VG Access             <span class="built_in">read</span>/write</span><br><span class="line">  VG Status             resizable</span><br><span class="line">  MAX LV                0</span><br><span class="line">  Cur LV                0</span><br><span class="line">  Open LV               0</span><br><span class="line">  Max PV                0</span><br><span class="line">  Cur PV                1</span><br><span class="line">  Act PV                1</span><br><span class="line">  VG Size               500.00 GiB</span><br><span class="line">  PE Size               4.00 MiB</span><br><span class="line">  Total PE              127999</span><br><span class="line">  Alloc PE / Size       0 / 0   </span><br><span class="line">  Free  PE / Size       127999 / 500.00 GiB</span><br><span class="line">  VG UUID               xjcgUh-oZ1N-Fytd-qGCa-9otf-YV4S-Jpjc7W</span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºLV</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; lvcreate -l 127999 -n lvData VolGroup00</span><br><span class="line">  Logical volume <span class="string">"lvData"</span> created.</span><br><span class="line">&gt; lvdisplay </span><br><span class="line">  --- Logical volume ---</span><br><span class="line">  LV Path                /dev/VolGroup00/lvData</span><br><span class="line">  LV Name                lvData</span><br><span class="line">  VG Name                VolGroup00</span><br><span class="line">  LV UUID                pVPwru-Eu7W-3lOp-JUKc-qQYF-c3DM-vQ39g1</span><br><span class="line">  LV Write Access        <span class="built_in">read</span>/write</span><br><span class="line">  LV Creation host, time 3-9, 2016-06-22 15:47:18 +0800</span><br><span class="line">  LV Status              available</span><br><span class="line">  <span class="comment"># open                 0</span></span><br><span class="line">  LV Size                500.00 GiB</span><br><span class="line">  Current LE             127999</span><br><span class="line">  Segments               1</span><br><span class="line">  Allocation             inherit</span><br><span class="line">  Read ahead sectors     auto</span><br><span class="line">  - currently <span class="built_in">set</span> to     256</span><br><span class="line">  Block device           253:0</span><br></pre></td></tr></table></figure>

<p><code>lvcreate -l æŒ‡å®šPEæ•°é‡åˆ›å»ºï¼ˆç²¾ç¡®ï¼‰</code></p>
<p><code>lvcreate -L 500G æŒ‰å•ä½å¤§å°åˆ›å»ºï¼ˆå¯èƒ½ä¼šæœ‰å‰©ä½™PEï¼‰</code></p>
<p>æ ¼å¼åŒ–ç£ç›˜</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; mkfs.ext4 /dev/VolGroup00/lvData </span><br><span class="line">mke2fs 1.42.9 (28-Dec-2013)</span><br><span class="line">Discarding device blocks: <span class="keyword">done</span>                            </span><br><span class="line">Filesystem label=</span><br><span class="line">OS <span class="built_in">type</span>: Linux</span><br><span class="line">Block size=4096 (<span class="built_in">log</span>=2)</span><br><span class="line">Fragment size=4096 (<span class="built_in">log</span>=2)</span><br><span class="line">Stride=0 blocks, Stripe width=0 blocks</span><br><span class="line">32768000 inodes, 131070976 blocks</span><br><span class="line">6553548 blocks (5.00%) reserved <span class="keyword">for</span> the super user</span><br><span class="line">First data block=0</span><br><span class="line">Maximum filesystem blocks=2279604224</span><br><span class="line">4000 block groups</span><br><span class="line">32768 blocks per group, 32768 fragments per group</span><br><span class="line">8192 inodes per group</span><br><span class="line">Superblock backups stored on blocks: </span><br><span class="line">        32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208, </span><br><span class="line">        4096000, 7962624, 11239424, 20480000, 23887872, 71663616, 78675968, </span><br><span class="line">        102400000</span><br><span class="line"></span><br><span class="line">Allocating group tables: <span class="keyword">done</span>                            </span><br><span class="line">Writing inode tables: <span class="keyword">done</span>                            </span><br><span class="line">Creating journal (32768 blocks): <span class="keyword">done</span></span><br><span class="line">Writing superblocks and filesystem accounting information: <span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>æŒ‚è½½ä½¿ç”¨</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; mount /dev/VolGroup00/lvData /apps/</span><br><span class="line">&gt; df -h</span><br><span class="line">Filesystem                     Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/sda1                       20G  2.8G   16G  15% /</span><br><span class="line">devtmpfs                       912M     0  912M   0% /dev</span><br><span class="line">tmpfs                          920M     0  920M   0% /dev/shm</span><br><span class="line">tmpfs                          920M  8.4M  912M   1% /run</span><br><span class="line">tmpfs                          920M     0  920M   0% /sys/fs/cgroup</span><br><span class="line">tmpfs                          184M     0  184M   0% /run/user/0</span><br><span class="line">tmpfs                          184M     0  184M   0% /run/user/1000</span><br><span class="line">/dev/mapper/VolGroup00-lvData  493G   73M  467G   1% /apps</span><br></pre></td></tr></table></figure>

<h1 id="LVMæ‰©å®¹"><a href="#LVMæ‰©å®¹" class="headerlink" title="LVMæ‰©å®¹"></a>LVMæ‰©å®¹</h1><ol>
<li>åˆ†åŒº <code>fdisk /dev/sdd</code></li>
<li>åˆ›å»ºPV <code>pvcreate /dev/sdd1 &amp;&amp; partprob</code></li>
<li>æ‰©å±•VG <code>vgextend VolGroup00 /dev/sdd1</code></li>
<li>æ‰©å±•LV <code>lvextend -L +59G /dev/VolGroup00/lvData</code></li>
<li>æ£€æŸ¥LV <code>e2fsck -f /dev/VolGroup00/lvData</code></li>
<li>é‡æ–°å®šä¹‰åˆ†åŒºå¤§å° <code>resize2fs /dev/VolGroup00/lvData</code></li>
<li>æ£€æŸ¥å®¹é‡ <code>df -h</code></li>
</ol>
<p>æ³¨æ„ï¼š å¦‚æœæ˜¯xfsæ–‡ä»¶ç³»ç»Ÿï¼Œ<code>resize2fs</code>å‘½ä»¤è¦æ›¿æ¢æˆ<code>xfs_growfs</code></p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>lvm</tag>
      </tags>
  </entry>
  <entry>
    <title>pythonå¤„ç†XMLæ–‡ä»¶</title>
    <url>/2016/06/22/python%E5%A4%84%E7%90%86XML%E6%96%87%E4%BB%B6/</url>
    <content><![CDATA[<h1 id="è§£æXML"><a href="#è§£æXML" class="headerlink" title="è§£æXML"></a>è§£æXML</h1><h2 id="åˆ©ç”¨ElementTree-XMLå°†å­—ç¬¦ä¸²è§£ææˆxmlå¯¹è±¡"><a href="#åˆ©ç”¨ElementTree-XMLå°†å­—ç¬¦ä¸²è§£ææˆxmlå¯¹è±¡" class="headerlink" title="åˆ©ç”¨ElementTree.XMLå°†å­—ç¬¦ä¸²è§£ææˆxmlå¯¹è±¡"></a>åˆ©ç”¨ElementTree.XMLå°†å­—ç¬¦ä¸²è§£ææˆxmlå¯¹è±¡</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> xml.etree <span class="keyword">import</span> ElementTree <span class="keyword">as</span> ET</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰“å¼€æ–‡ä»¶ï¼Œè¯»å–XMLå†…å®¹</span></span><br><span class="line">str_xml = open(<span class="string">'xo.xml'</span>, <span class="string">'r'</span>).read()</span><br><span class="line">print(str_xml, type(str_xml))</span><br><span class="line"><span class="comment"># å°†å­—ç¬¦ä¸²è§£ææˆxmlç‰¹æ®Šå¯¹è±¡ï¼Œrootä»£æŒ‡xmlæ–‡ä»¶çš„æ ¹èŠ‚ç‚¹</span></span><br><span class="line">root = ET.XML(str_xml)</span><br><span class="line">print(root, type(root))</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">&lt;data&gt;</span><br><span class="line">    &lt;country name=<span class="string">"Liechtenstein"</span>&gt;</span><br><span class="line">        &lt;rank updated="yes"&gt;2&lt;/rank&gt;</span><br><span class="line">        &lt;year&gt;2023&lt;/year&gt;</span><br><span class="line">        &lt;gdppc&gt;141100&lt;/gdppc&gt;</span><br><span class="line">        &lt;neighbor direction=<span class="string">"E"</span> name=<span class="string">"Austria"</span> /&gt;</span><br><span class="line">        &lt;neighbor direction=<span class="string">"W"</span> name=<span class="string">"Switzerland"</span> /&gt;</span><br><span class="line">    &lt;/country&gt;</span><br><span class="line">    &lt;country name=<span class="string">"Singapore"</span>&gt;</span><br><span class="line">        &lt;rank updated="yes"&gt;5&lt;/rank&gt;</span><br><span class="line">        &lt;year&gt;2026&lt;/year&gt;</span><br><span class="line">        &lt;gdppc&gt;59900&lt;/gdppc&gt;</span><br><span class="line">        &lt;neighbor direction=<span class="string">"N"</span> name=<span class="string">"Malaysia"</span> /&gt;</span><br><span class="line">    &lt;/country&gt;</span><br><span class="line">    &lt;country name=<span class="string">"Panama"</span>&gt;</span><br><span class="line">        &lt;rank updated="yes"&gt;69&lt;/rank&gt;</span><br><span class="line">        &lt;year&gt;2026&lt;/year&gt;</span><br><span class="line">        &lt;gdppc&gt;13600&lt;/gdppc&gt;</span><br><span class="line">        &lt;neighbor direction=<span class="string">"W"</span> name=<span class="string">"Costa Rica"</span> /&gt;</span><br><span class="line">        &lt;neighbor direction=<span class="string">"E"</span> name=<span class="string">"Colombia"</span> /&gt;</span><br><span class="line">    &lt;/country&gt;</span><br><span class="line">&lt;/data&gt; &lt;class 'str'&gt;</span><br><span class="line">&lt;Element <span class="string">'data'</span> at <span class="number">0x101383cc8</span>&gt; &lt;<span class="class"><span class="keyword">class</span> '<span class="title">xml</span>.<span class="title">etree</span>.<span class="title">ElementTree</span>.<span class="title">Element</span>'&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä»ç»“æœä¸­å¯ä»¥çœ‹å‡ºï¼Œ<code>root</code>å˜é‡è·å–åˆ°äº†xmlæ–‡ä»¶çš„æ ¹èŠ‚ç‚¹ä¿¡æ¯ï¼Œä¸”æ•°æ®ç±»å‹ä¸º<code>xml.etree.ElementTree.Element</code></p>
<h2 id="åˆ©ç”¨ElementTree-parseå°†æ–‡ä»¶è§£ææˆxmlå¯¹è±¡"><a href="#åˆ©ç”¨ElementTree-parseå°†æ–‡ä»¶è§£ææˆxmlå¯¹è±¡" class="headerlink" title="åˆ©ç”¨ElementTree.parseå°†æ–‡ä»¶è§£ææˆxmlå¯¹è±¡"></a>åˆ©ç”¨ElementTree.parseå°†æ–‡ä»¶è§£ææˆxmlå¯¹è±¡</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> xml.etree <span class="keyword">import</span> ElementTree <span class="keyword">as</span> ET</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç›´æ¥è§£æxmlæ–‡ä»¶</span></span><br><span class="line">tree = ET.parse(<span class="string">"xo.xml"</span>)</span><br><span class="line">print(tree, type(tree)</span><br><span class="line"><span class="comment"># è·å–xmlæ–‡ä»¶çš„æ ¹èŠ‚ç‚¹</span></span><br><span class="line">root = tree.getroot()</span><br><span class="line">print(root, type(root))</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">&lt;xml.etree.ElementTree.ElementTree object at <span class="number">0x101178780</span>&gt; &lt;<span class="class"><span class="keyword">class</span> '<span class="title">xml</span>.<span class="title">etree</span>.<span class="title">ElementTree</span>.<span class="title">ElementTree</span>'&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">Element</span> '<span class="title">data</span>' <span class="title">at</span> 0<span class="title">x101283cc8</span>&gt; &lt;<span class="title">class</span> '<span class="title">xml</span>.<span class="title">etree</span>.<span class="title">ElementTree</span>.<span class="title">Element</span>'&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="ä¸¤ç§è§£ææ–¹å¼çš„åŒºåˆ«"><a href="#ä¸¤ç§è§£ææ–¹å¼çš„åŒºåˆ«" class="headerlink" title="ä¸¤ç§è§£ææ–¹å¼çš„åŒºåˆ«"></a>ä¸¤ç§è§£ææ–¹å¼çš„åŒºåˆ«</h2><p>è¯»å–å­—ç¬¦ä¸²å’Œè¯»å–æ–‡ä»¶çš„æ–¹å¼çš„åŒºåˆ«ï¼š</p>
<ul>
<li><p>è¯»å–å­—ç¬¦ä¸²çš„æ–¹å¼æ²¡æœ‰åˆ›å»ºtreeå¯¹è±¡</p>
</li>
<li><p>è¯»å–æ–‡ä»¶çš„æ–¹å¼è‡ªåŠ¨åˆ›å»ºäº†treeå¯¹è±¡</p>
</li>
</ul>
<p>è€Œå¦‚æœéœ€è¦å°†åœ¨å†…å­˜ä¿®æ”¹è¿‡çš„elementå¯¹è±¡ä¿å­˜æˆæ–‡ä»¶çš„æ—¶å€™ï¼Œå°±å¿…é¡»éœ€è¦ç”¨treeå¯¹è±¡çš„writeæ–¹æ³•æ¥å†™ã€‚</p>
<p>å¦‚æœç›´æ¥è¯»å–äº†å­—ç¬¦ä¸²ï¼Œé»˜è®¤æ²¡æœ‰åˆ›å»ºtreeå¯¹è±¡ï¼Œé‚£ä¹ˆåœ¨éœ€è¦å†™å…¥åˆ°æœ¬åœ°æ–‡ä»¶æ—¶ï¼Œå°±å¿…é¡»å…ˆåˆ›å»ºtreeå¯¹è±¡å†è¿›è¡Œå†™å…¥</p>
<h1 id="æ“ä½œXML"><a href="#æ“ä½œXML" class="headerlink" title="æ“ä½œXML"></a>æ“ä½œXML</h1><p>æ¯ä¸€ä¸ªèŠ‚ç‚¹å°±æ˜¯ä¸€ä¸ªelementå¯¹è±¡ï¼Œæ¯ä¸€ä¸ªelementå¯¹è±¡éƒ½æœ‰å¦‚ä¸‹æ–¹æ³•ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Element</span>:</span></span><br><span class="line">    <span class="string">"""An XML element.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    This class is the reference implementation of the Element interface.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    An element's length is its number of subelements.  That means if you</span></span><br><span class="line"><span class="string">    want to check if an element is truly empty, you should check BOTH</span></span><br><span class="line"><span class="string">    its length AND its text attribute.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    The element tag, attribute names, and attribute values can be either</span></span><br><span class="line"><span class="string">    bytes or strings.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    *tag* is the element name.  *attrib* is an optional dictionary containing</span></span><br><span class="line"><span class="string">    element attributes. *extra* are additional element attributes given as</span></span><br><span class="line"><span class="string">    keyword arguments.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Example form:</span></span><br><span class="line"><span class="string">        &lt;tag attrib&gt;text&lt;child/&gt;...&lt;/tag&gt;tail</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">    å½“å‰èŠ‚ç‚¹çš„æ ‡ç­¾å</span><br><span class="line">    tag = <span class="literal">None</span></span><br><span class="line">    <span class="string">"""The element's name."""</span></span><br><span class="line"></span><br><span class="line">    å½“å‰èŠ‚ç‚¹çš„å±æ€§</span><br><span class="line"></span><br><span class="line">    attrib = <span class="literal">None</span></span><br><span class="line">    <span class="string">"""Dictionary of the element's attributes."""</span></span><br><span class="line"></span><br><span class="line">    å½“å‰èŠ‚ç‚¹çš„å†…å®¹</span><br><span class="line">    text = <span class="literal">None</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Text before first subelement. This is either a string or the value None.</span></span><br><span class="line"><span class="string">    Note that if there is no text, this attribute may be either</span></span><br><span class="line"><span class="string">    None or the empty string, depending on the parser.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">    tail = <span class="literal">None</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Text after this element's end tag, but before the next sibling element's</span></span><br><span class="line"><span class="string">    start tag.  This is either a string or the value None.  Note that if there</span></span><br><span class="line"><span class="string">    was no text, this attribute may be either None or an empty string,</span></span><br><span class="line"><span class="string">    depending on the parser.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, tag, attrib=&#123;&#125;, **extra)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> isinstance(attrib, dict):</span><br><span class="line">            <span class="keyword">raise</span> TypeError(<span class="string">"attrib must be dict, not %s"</span> % (</span><br><span class="line">                attrib.__class__.__name__,))</span><br><span class="line">        attrib = attrib.copy()</span><br><span class="line">        attrib.update(extra)</span><br><span class="line">        self.tag = tag</span><br><span class="line">        self.attrib = attrib</span><br><span class="line">        self._children = []</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"&lt;%s %r at %#x&gt;"</span> % (self.__class__.__name__, self.tag, id(self))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">makeelement</span><span class="params">(self, tag, attrib)</span>:</span></span><br><span class="line">        åˆ›å»ºä¸€ä¸ªæ–°èŠ‚ç‚¹</span><br><span class="line">        <span class="string">"""Create a new element with the same type.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        *tag* is a string containing the element name.</span></span><br><span class="line"><span class="string">        *attrib* is a dictionary containing the element attributes.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Do not call this method, use the SubElement factory function instead.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">return</span> self.__class__(tag, attrib)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">copy</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""Return copy of current element.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        This creates a shallow copy. Subelements will be shared with the</span></span><br><span class="line"><span class="string">        original tree.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        elem = self.makeelement(self.tag, self.attrib)</span><br><span class="line">        elem.text = self.text</span><br><span class="line">        elem.tail = self.tail</span><br><span class="line">        elem[:] = self</span><br><span class="line">        <span class="keyword">return</span> elem</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__len__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> len(self._children)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__bool__</span><span class="params">(self)</span>:</span></span><br><span class="line">        warnings.warn(</span><br><span class="line">            <span class="string">"The behavior of this method will change in future versions.  "</span></span><br><span class="line">            <span class="string">"Use specific 'len(elem)' or 'elem is not None' test instead."</span>,</span><br><span class="line">            FutureWarning, stacklevel=<span class="number">2</span></span><br><span class="line">            )</span><br><span class="line">        <span class="keyword">return</span> len(self._children) != <span class="number">0</span> <span class="comment"># emulate old behaviour, for now</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getitem__</span><span class="params">(self, index)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self._children[index]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__setitem__</span><span class="params">(self, index, element)</span>:</span></span><br><span class="line">        <span class="comment"># if isinstance(index, slice):</span></span><br><span class="line">        <span class="comment">#     for elt in element:</span></span><br><span class="line">        <span class="comment">#         assert iselement(elt)</span></span><br><span class="line">        <span class="comment"># else:</span></span><br><span class="line">        <span class="comment">#     assert iselement(element)</span></span><br><span class="line">        self._children[index] = element</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__delitem__</span><span class="params">(self, index)</span>:</span></span><br><span class="line">        <span class="keyword">del</span> self._children[index]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">append</span><span class="params">(self, subelement)</span>:</span></span><br><span class="line">        ä¸ºå½“å‰èŠ‚ç‚¹è¿½åŠ ä¸€ä¸ªå­èŠ‚ç‚¹</span><br><span class="line">        <span class="string">"""Add *subelement* to the end of this element.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        The new element will appear in document order after the last existing</span></span><br><span class="line"><span class="string">        subelement (or directly after the text, if it's the first subelement),</span></span><br><span class="line"><span class="string">        but before the end tag for this element.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self._assert_is_element(subelement)</span><br><span class="line">        self._children.append(subelement)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">extend</span><span class="params">(self, elements)</span>:</span></span><br><span class="line">        ä¸ºå½“å‰èŠ‚ç‚¹æ‰©å±• n ä¸ªå­èŠ‚ç‚¹</span><br><span class="line">        <span class="string">"""Append subelements from a sequence.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        *elements* is a sequence with zero or more elements.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">for</span> element <span class="keyword">in</span> elements:</span><br><span class="line">            self._assert_is_element(element)</span><br><span class="line">        self._children.extend(elements)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">insert</span><span class="params">(self, index, subelement)</span>:</span></span><br><span class="line">        åœ¨å½“å‰èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ä¸­æ’å…¥æŸä¸ªèŠ‚ç‚¹ï¼Œå³ï¼šä¸ºå½“å‰èŠ‚ç‚¹åˆ›å»ºå­èŠ‚ç‚¹ï¼Œç„¶åæ’å…¥æŒ‡å®šä½ç½®</span><br><span class="line">        <span class="string">"""Insert *subelement* at position *index*."""</span></span><br><span class="line">        self._assert_is_element(subelement)</span><br><span class="line">        self._children.insert(index, subelement)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_assert_is_element</span><span class="params">(self, e)</span>:</span></span><br><span class="line">        <span class="comment"># Need to refer to the actual Python implementation, not the</span></span><br><span class="line">        <span class="comment"># shadowing C implementation.</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> isinstance(e, _Element_Py):</span><br><span class="line">            <span class="keyword">raise</span> TypeError(<span class="string">'expected an Element, not %s'</span> % type(e).__name__)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">remove</span><span class="params">(self, subelement)</span>:</span></span><br><span class="line">        åœ¨å½“å‰èŠ‚ç‚¹åœ¨å­èŠ‚ç‚¹ä¸­åˆ é™¤æŸä¸ªèŠ‚ç‚¹</span><br><span class="line">        <span class="string">"""Remove matching subelement.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Unlike the find methods, this method compares elements based on</span></span><br><span class="line"><span class="string">        identity, NOT ON tag value or contents.  To remove subelements by</span></span><br><span class="line"><span class="string">        other means, the easiest way is to use a list comprehension to</span></span><br><span class="line"><span class="string">        select what elements to keep, and then use slice assignment to update</span></span><br><span class="line"><span class="string">        the parent element.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        ValueError is raised if a matching element could not be found.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="comment"># assert iselement(element)</span></span><br><span class="line">        self._children.remove(subelement)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getchildren</span><span class="params">(self)</span>:</span></span><br><span class="line">        è·å–æ‰€æœ‰çš„å­èŠ‚ç‚¹ï¼ˆåºŸå¼ƒï¼‰</span><br><span class="line">        <span class="string">"""(Deprecated) Return all subelements.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Elements are returned in document order.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        warnings.warn(</span><br><span class="line">            <span class="string">"This method will be removed in future versions.  "</span></span><br><span class="line">            <span class="string">"Use 'list(elem)' or iteration over elem instead."</span>,</span><br><span class="line">            DeprecationWarning, stacklevel=<span class="number">2</span></span><br><span class="line">            )</span><br><span class="line">        <span class="keyword">return</span> self._children</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">find</span><span class="params">(self, path, namespaces=None)</span>:</span></span><br><span class="line">        è·å–ç¬¬ä¸€ä¸ªå¯»æ‰¾åˆ°çš„å­èŠ‚ç‚¹</span><br><span class="line">        <span class="string">"""Find first matching element by tag name or path.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        *path* is a string having either an element tag or an XPath,</span></span><br><span class="line"><span class="string">        *namespaces* is an optional mapping from namespace prefix to full name.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Return the first matching element, or None if no element was found.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">return</span> ElementPath.find(self, path, namespaces)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findtext</span><span class="params">(self, path, default=None, namespaces=None)</span>:</span></span><br><span class="line">        è·å–ç¬¬ä¸€ä¸ªå¯»æ‰¾åˆ°çš„å­èŠ‚ç‚¹çš„å†…å®¹</span><br><span class="line">        <span class="string">"""Find text for first matching element by tag name or path.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        *path* is a string having either an element tag or an XPath,</span></span><br><span class="line"><span class="string">        *default* is the value to return if the element was not found,</span></span><br><span class="line"><span class="string">        *namespaces* is an optional mapping from namespace prefix to full name.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Return text content of first matching element, or default value if</span></span><br><span class="line"><span class="string">        none was found.  Note that if an element is found having no text</span></span><br><span class="line"><span class="string">        content, the empty string is returned.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">return</span> ElementPath.findtext(self, path, default, namespaces)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findall</span><span class="params">(self, path, namespaces=None)</span>:</span></span><br><span class="line">        è·å–æ‰€æœ‰çš„å­èŠ‚ç‚¹</span><br><span class="line">        <span class="string">"""Find all matching subelements by tag name or path.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        *path* is a string having either an element tag or an XPath,</span></span><br><span class="line"><span class="string">        *namespaces* is an optional mapping from namespace prefix to full name.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Returns list containing all matching elements in document order.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">return</span> ElementPath.findall(self, path, namespaces)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">iterfind</span><span class="params">(self, path, namespaces=None)</span>:</span></span><br><span class="line">        è·å–æ‰€æœ‰æŒ‡å®šçš„èŠ‚ç‚¹ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªè¿­ä»£å™¨ï¼ˆå¯ä»¥è¢«<span class="keyword">for</span>å¾ªç¯ï¼‰</span><br><span class="line">        <span class="string">"""Find all matching subelements by tag name or path.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        *path* is a string having either an element tag or an XPath,</span></span><br><span class="line"><span class="string">        *namespaces* is an optional mapping from namespace prefix to full name.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Return an iterable yielding all matching elements in document order.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">return</span> ElementPath.iterfind(self, path, namespaces)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clear</span><span class="params">(self)</span>:</span></span><br><span class="line">        æ¸…ç©ºèŠ‚ç‚¹</span><br><span class="line">        <span class="string">"""Reset element.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        This function removes all subelements, clears all attributes, and sets</span></span><br><span class="line"><span class="string">        the text and tail attributes to None.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self.attrib.clear()</span><br><span class="line">        self._children = []</span><br><span class="line">        self.text = self.tail = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, key, default=None)</span>:</span></span><br><span class="line">        è·å–å½“å‰èŠ‚ç‚¹çš„å±æ€§å€¼</span><br><span class="line">        <span class="string">"""Get element attribute.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Equivalent to attrib.get, but some implementations may handle this a</span></span><br><span class="line"><span class="string">        bit more efficiently.  *key* is what attribute to look for, and</span></span><br><span class="line"><span class="string">        *default* is what to return if the attribute was not found.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Returns a string containing the attribute value, or the default if</span></span><br><span class="line"><span class="string">        attribute was not found.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">return</span> self.attrib.get(key, default)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">set</span><span class="params">(self, key, value)</span>:</span></span><br><span class="line">        ä¸ºå½“å‰èŠ‚ç‚¹è®¾ç½®å±æ€§å€¼</span><br><span class="line">        <span class="string">"""Set element attribute.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Equivalent to attrib[key] = value, but some implementations may handle</span></span><br><span class="line"><span class="string">        this a bit more efficiently.  *key* is what attribute to set, and</span></span><br><span class="line"><span class="string">        *value* is the attribute value to set it to.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self.attrib[key] = value</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">keys</span><span class="params">(self)</span>:</span></span><br><span class="line">        è·å–å½“å‰èŠ‚ç‚¹çš„æ‰€æœ‰å±æ€§çš„ key</span><br><span class="line"></span><br><span class="line">        <span class="string">"""Get list of attribute names.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Names are returned in an arbitrary order, just like an ordinary</span></span><br><span class="line"><span class="string">        Python dict.  Equivalent to attrib.keys()</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">return</span> self.attrib.keys()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">items</span><span class="params">(self)</span>:</span></span><br><span class="line">        è·å–å½“å‰èŠ‚ç‚¹çš„æ‰€æœ‰å±æ€§å€¼ï¼Œæ¯ä¸ªå±æ€§éƒ½æ˜¯ä¸€ä¸ªé”®å€¼å¯¹</span><br><span class="line">        <span class="string">"""Get element attributes as a sequence.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        The attributes are returned in arbitrary order.  Equivalent to</span></span><br><span class="line"><span class="string">        attrib.items().</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Return a list of (name, value) tuples.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">return</span> self.attrib.items()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">iter</span><span class="params">(self, tag=None)</span>:</span></span><br><span class="line">        åœ¨å½“å‰èŠ‚ç‚¹çš„å­å­™ä¸­æ ¹æ®èŠ‚ç‚¹åç§°å¯»æ‰¾æ‰€æœ‰æŒ‡å®šçš„èŠ‚ç‚¹ï¼Œå¹¶è¿”å›ä¸€ä¸ªè¿­ä»£å™¨ï¼ˆå¯ä»¥è¢«<span class="keyword">for</span>å¾ªç¯ï¼‰ã€‚</span><br><span class="line">        <span class="string">"""Create tree iterator.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        The iterator loops over the element and all subelements in document</span></span><br><span class="line"><span class="string">        order, returning all elements with a matching tag.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        If the tree structure is modified during iteration, new or removed</span></span><br><span class="line"><span class="string">        elements may or may not be included.  To get a stable set, use the</span></span><br><span class="line"><span class="string">        list() function on the iterator, and loop over the resulting list.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        *tag* is what tags to look for (default is to return all elements)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Return an iterator containing all the matching elements.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> tag == <span class="string">"*"</span>:</span><br><span class="line">            tag = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">if</span> tag <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> self.tag == tag:</span><br><span class="line">            <span class="keyword">yield</span> self</span><br><span class="line">        <span class="keyword">for</span> e <span class="keyword">in</span> self._children:</span><br><span class="line">            <span class="keyword">yield</span> <span class="keyword">from</span> e.iter(tag)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># compatibility</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getiterator</span><span class="params">(self, tag=None)</span>:</span></span><br><span class="line">        <span class="comment"># Change for a DeprecationWarning in 1.4</span></span><br><span class="line">        warnings.warn(</span><br><span class="line">            <span class="string">"This method will be removed in future versions.  "</span></span><br><span class="line">            <span class="string">"Use 'elem.iter()' or 'list(elem.iter())' instead."</span>,</span><br><span class="line">            PendingDeprecationWarning, stacklevel=<span class="number">2</span></span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">return</span> list(self.iter(tag))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">itertext</span><span class="params">(self)</span>:</span></span><br><span class="line">        åœ¨å½“å‰èŠ‚ç‚¹çš„å­å­™ä¸­æ ¹æ®èŠ‚ç‚¹åç§°å¯»æ‰¾æ‰€æœ‰æŒ‡å®šçš„èŠ‚ç‚¹çš„å†…å®¹ï¼Œå¹¶è¿”å›ä¸€ä¸ªè¿­ä»£å™¨ï¼ˆå¯ä»¥è¢«<span class="keyword">for</span>å¾ªç¯ï¼‰ã€‚</span><br><span class="line">        <span class="string">"""Create text iterator.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        The iterator loops over the element and all subelements in document</span></span><br><span class="line"><span class="string">        order, returning all inner text.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        tag = self.tag</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> isinstance(tag, str) <span class="keyword">and</span> tag <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> self.text:</span><br><span class="line">            <span class="keyword">yield</span> self.text</span><br><span class="line">        <span class="keyword">for</span> e <span class="keyword">in</span> self:</span><br><span class="line">            <span class="keyword">yield</span> <span class="keyword">from</span> e.itertext()</span><br><span class="line">            <span class="keyword">if</span> e.tail:</span><br><span class="line">                <span class="keyword">yield</span> e.tail</span><br></pre></td></tr></table></figure>

<h2 id="éå†XMLæ–‡æ¡£çš„æ‰€æœ‰å†…å®¹"><a href="#éå†XMLæ–‡æ¡£çš„æ‰€æœ‰å†…å®¹" class="headerlink" title="éå†XMLæ–‡æ¡£çš„æ‰€æœ‰å†…å®¹"></a>éå†XMLæ–‡æ¡£çš„æ‰€æœ‰å†…å®¹</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> xml.etree <span class="keyword">import</span> ElementTree <span class="keyword">as</span> ET</span><br><span class="line"> </span><br><span class="line"><span class="comment"># ç›´æ¥è§£æxmlæ–‡ä»¶</span></span><br><span class="line">tree = ET.parse(<span class="string">"xo.xml"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–xmlæ–‡ä»¶çš„æ ¹èŠ‚ç‚¹</span></span><br><span class="line">root = tree.getroot()</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–é¡¶å±‚æ ‡ç­¾</span></span><br><span class="line">print(root.tag)</span><br><span class="line"></span><br><span class="line"><span class="comment"># éå†xmlæ–‡æ¡£çš„ç¬¬äºŒå±‚</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> root:</span><br><span class="line">    <span class="comment"># ç¬¬äºŒå±‚èŠ‚ç‚¹çš„æ ‡ç­¾åç§°å’Œæ ‡ç­¾å±æ€§</span></span><br><span class="line">    print(i.tag, i.attrib)</span><br><span class="line">    <span class="comment"># éå†xmlæ–‡æ¡£çš„ç¬¬ä¸‰å±‚</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> i:</span><br><span class="line">        print(j.tag, j.text)</span><br><span class="line">        </span><br><span class="line"> ------------</span><br><span class="line">data</span><br><span class="line">country &#123;<span class="string">'name'</span>: <span class="string">'Liechtenstein'</span>&#125;</span><br><span class="line">rank <span class="number">2</span></span><br><span class="line">year <span class="number">2023</span></span><br><span class="line">gdppc <span class="number">141100</span></span><br><span class="line">neighbor <span class="literal">None</span></span><br><span class="line">neighbor <span class="literal">None</span></span><br><span class="line">country &#123;<span class="string">'name'</span>: <span class="string">'Singapore'</span>&#125;</span><br><span class="line">rank <span class="number">5</span></span><br><span class="line">year <span class="number">2026</span></span><br><span class="line">gdppc <span class="number">59900</span></span><br><span class="line">neighbor <span class="literal">None</span></span><br><span class="line">country &#123;<span class="string">'name'</span>: <span class="string">'Panama'</span>&#125;</span><br><span class="line">rank <span class="number">69</span></span><br><span class="line">year <span class="number">2026</span></span><br><span class="line">gdppc <span class="number">13600</span></span><br><span class="line">neighbor <span class="literal">None</span></span><br><span class="line">neighbor <span class="literal">None</span></span><br></pre></td></tr></table></figure>

<h2 id="éå†æŒ‡å®šèŠ‚ç‚¹"><a href="#éå†æŒ‡å®šèŠ‚ç‚¹" class="headerlink" title="éå†æŒ‡å®šèŠ‚ç‚¹"></a>éå†æŒ‡å®šèŠ‚ç‚¹</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> xml.etree <span class="keyword">import</span> ElementTree <span class="keyword">as</span> ET</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç›´æ¥è§£æxmlæ–‡ä»¶</span></span><br><span class="line">tree = ET.parse(<span class="string">"xo.xml"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–xmlæ–‡ä»¶çš„æ ¹èŠ‚ç‚¹</span></span><br><span class="line">root = tree.getroot()</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–é¡¶å±‚æ ‡ç­¾</span></span><br><span class="line">print(root.tag)</span><br><span class="line"></span><br><span class="line"><span class="comment"># root.iter()çš„å‚æ•°ä¸­å¯ä»¥å¡«å…¥ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹åç§°</span></span><br><span class="line"><span class="keyword">for</span> node <span class="keyword">in</span> root.iter(<span class="string">"gdppc"</span>):</span><br><span class="line">    <span class="comment"># èŠ‚ç‚¹çš„æ ‡ç­¾åç§°å’Œå†…å®¹</span></span><br><span class="line">    print(node.tag, node.text)</span><br><span class="line">    </span><br><span class="line">------------</span><br><span class="line">data</span><br><span class="line">gdppc <span class="number">141100</span></span><br><span class="line">gdppc <span class="number">59900</span></span><br><span class="line">gdppc <span class="number">13600</span></span><br></pre></td></tr></table></figure>

<h2 id="ä¿®æ”¹èŠ‚ç‚¹çš„å†…å®¹"><a href="#ä¿®æ”¹èŠ‚ç‚¹çš„å†…å®¹" class="headerlink" title="ä¿®æ”¹èŠ‚ç‚¹çš„å†…å®¹"></a>ä¿®æ”¹èŠ‚ç‚¹çš„å†…å®¹</h2><p>ç”±äºä¿®æ”¹èŠ‚ç‚¹æ—¶ï¼Œå‡æ˜¯åœ¨å†…å­˜ä¸­è¿›è¡Œï¼Œä¸ä¼šå½±å“åˆ°æ–‡ä»¶ä¸­çš„å†…å®¹ã€‚æ‰€ä»¥å¦‚æœæƒ³è¦ä¿®æ”¹ï¼Œåˆ™éœ€è¦é‡æ–°å°†å†…å­˜ä¸­çš„å†…å®¹å†™å…¥åˆ°æ–‡ä»¶ã€‚</p>
<ul>
<li>è§£æå­—ç¬¦åˆ›çš„æ–¹å¼æ¥ä¿®æ”¹å’Œä¿å­˜</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> xml.etree <span class="keyword">import</span> ElementTree <span class="keyword">as</span> ET</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰“å¼€æ–‡ä»¶,å°†æ–‡ä»¶çš„å†…å®¹è¯»åˆ°å†…å­˜ä¸­</span></span><br><span class="line">str_xml = open(<span class="string">"xo.xml"</span>, <span class="string">'r'</span>).read()</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†å­—ç¬¦ä¸²è§£ææˆxmlç‰¹æ®Šå¯¹è±¡,rootä»£æŒ‡xmlæ–‡ä»¶çš„æ ¹èŠ‚ç‚¹</span></span><br><span class="line">root = ET.XML(str_xml)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¼€å§‹æ“ä½œxmlå¯¹è±¡</span></span><br><span class="line"><span class="comment"># æ‰“å°ä¸€ä¸‹é¡¶å±‚çš„æ ‡ç­¾</span></span><br><span class="line">print(root.tag)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¾ªç¯æ‰€æœ‰çš„yearèŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">for</span> node <span class="keyword">in</span> root.iter(<span class="string">"year"</span>):</span><br><span class="line">    <span class="comment"># å°†yearèŠ‚ç‚¹ä¸­çš„å†…å®¹è‡ªå¢ä¸€</span></span><br><span class="line">    new_year = int(node.text) + <span class="number">1</span></span><br><span class="line">    node.text = str(new_year)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è®¾ç½®å±æ€§</span></span><br><span class="line">    node.set(<span class="string">"name"</span>, <span class="string">"polarsnow"</span>)</span><br><span class="line">    node.set(<span class="string">"age"</span>, <span class="string">"25"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># åˆ é™¤å±æ€§</span></span><br><span class="line">    <span class="keyword">del</span> node.attrib[<span class="string">"age"</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿å­˜æ–‡ä»¶</span></span><br><span class="line"><span class="comment">## ä½¿ç”¨è¯»å–å­—ç¬¦ä¸²çš„æ–¹å¼åœ¨ä¿å­˜ä¹‹å‰éœ€è¦å…ˆåˆ›å»ºElementTreeå¯¹è±¡</span></span><br><span class="line">tree = ET.ElementTree(root)</span><br><span class="line">tree.write(<span class="string">"newxo.xml"</span>, encoding=<span class="string">"utf-8"</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>è§£ææ–‡ä»¶çš„æ–¹å¼æ¥ä¿®æ”¹å’Œä¿å­˜</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> xml.etree <span class="keyword">import</span> ElementTree <span class="keyword">as</span> ET</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç›´æ¥è§£æxmlæ–‡ä»¶</span></span><br><span class="line">tree = ET.parse(<span class="string">"xo.xml"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–xmlæ–‡ä»¶çš„æ ¹èŠ‚ç‚¹</span></span><br><span class="line">root = tree.getroot()</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¼€å§‹æ“ä½œxmlå¯¹è±¡</span></span><br><span class="line"><span class="comment"># é¡¶å±‚æ ‡ç­¾</span></span><br><span class="line">print(root.tag)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¾ªç¯æ‰€æœ‰çš„yearèŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">for</span> node <span class="keyword">in</span> root.iter(<span class="string">"year"</span>):</span><br><span class="line">    <span class="comment"># å°†yearèŠ‚ç‚¹ä¸­çš„å†…å®¹è‡ªå¢ä¸€</span></span><br><span class="line">    new_year = int(node.text) + <span class="number">1</span></span><br><span class="line">    node.text = str(new_year)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è®¾ç½®å±æ€§</span></span><br><span class="line">    node.set(<span class="string">"name"</span>, <span class="string">"polarsnow"</span>)</span><br><span class="line">    node.set(<span class="string">"age"</span>, <span class="string">"25"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># åˆ é™¤å±æ€§</span></span><br><span class="line">    <span class="keyword">del</span> node.attrib[<span class="string">"age"</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿å­˜æ–‡ä»¶</span></span><br><span class="line"><span class="comment">## ä½¿ç”¨parseçš„æ–¹å¼ç›´æ¥è§£æxmlæ–‡ä»¶ï¼Œå·²ç»ç”Ÿæˆäº†ElementTreeå¯¹è±¡</span></span><br><span class="line"><span class="comment">## å¯ä»¥ç›´æ¥è°ƒç”¨å†™çš„æ–¹æ³•</span></span><br><span class="line">tree.write(<span class="string">"newxo.xml"</span>, encoding=<span class="string">"utf-8"</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li><code>xo.xml</code> </li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">data</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">country</span> <span class="attr">name</span>=<span class="string">"Liechtenstein"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rank</span> <span class="attr">updated</span>=<span class="string">"yes"</span>&gt;</span>2<span class="tag">&lt;/<span class="name">rank</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">year</span>&gt;</span>2023<span class="tag">&lt;/<span class="name">year</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">gdppc</span>&gt;</span>141100<span class="tag">&lt;/<span class="name">gdppc</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">neighbor</span> <span class="attr">direction</span>=<span class="string">"E"</span> <span class="attr">name</span>=<span class="string">"Austria"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">neighbor</span> <span class="attr">direction</span>=<span class="string">"W"</span> <span class="attr">name</span>=<span class="string">"Switzerland"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">country</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">country</span> <span class="attr">name</span>=<span class="string">"Singapore"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rank</span> <span class="attr">updated</span>=<span class="string">"yes"</span>&gt;</span>5<span class="tag">&lt;/<span class="name">rank</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">year</span>&gt;</span>2026<span class="tag">&lt;/<span class="name">year</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">gdppc</span>&gt;</span>59900<span class="tag">&lt;/<span class="name">gdppc</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">neighbor</span> <span class="attr">direction</span>=<span class="string">"N"</span> <span class="attr">name</span>=<span class="string">"Malaysia"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">country</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">country</span> <span class="attr">name</span>=<span class="string">"Panama"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rank</span> <span class="attr">updated</span>=<span class="string">"yes"</span>&gt;</span>69<span class="tag">&lt;/<span class="name">rank</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">year</span>&gt;</span>2026<span class="tag">&lt;/<span class="name">year</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">gdppc</span>&gt;</span>13600<span class="tag">&lt;/<span class="name">gdppc</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">neighbor</span> <span class="attr">direction</span>=<span class="string">"W"</span> <span class="attr">name</span>=<span class="string">"Costa Rica"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">neighbor</span> <span class="attr">direction</span>=<span class="string">"E"</span> <span class="attr">name</span>=<span class="string">"Colombia"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">country</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">data</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>newxo.xml</code></li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">data</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">country</span> <span class="attr">name</span>=<span class="string">"Liechtenstein"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rank</span> <span class="attr">updated</span>=<span class="string">"yes"</span>&gt;</span>2<span class="tag">&lt;/<span class="name">rank</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">year</span> <span class="attr">name</span>=<span class="string">"polarsnow"</span>&gt;</span>2024<span class="tag">&lt;/<span class="name">year</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">gdppc</span>&gt;</span>141100<span class="tag">&lt;/<span class="name">gdppc</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">neighbor</span> <span class="attr">direction</span>=<span class="string">"E"</span> <span class="attr">name</span>=<span class="string">"Austria"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">neighbor</span> <span class="attr">direction</span>=<span class="string">"W"</span> <span class="attr">name</span>=<span class="string">"Switzerland"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">country</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">country</span> <span class="attr">name</span>=<span class="string">"Singapore"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rank</span> <span class="attr">updated</span>=<span class="string">"yes"</span>&gt;</span>5<span class="tag">&lt;/<span class="name">rank</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">year</span> <span class="attr">name</span>=<span class="string">"polarsnow"</span>&gt;</span>2027<span class="tag">&lt;/<span class="name">year</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">gdppc</span>&gt;</span>59900<span class="tag">&lt;/<span class="name">gdppc</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">neighbor</span> <span class="attr">direction</span>=<span class="string">"N"</span> <span class="attr">name</span>=<span class="string">"Malaysia"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">country</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">country</span> <span class="attr">name</span>=<span class="string">"Panama"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rank</span> <span class="attr">updated</span>=<span class="string">"yes"</span>&gt;</span>69<span class="tag">&lt;/<span class="name">rank</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">year</span> <span class="attr">name</span>=<span class="string">"polarsnow"</span>&gt;</span>2027<span class="tag">&lt;/<span class="name">year</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">gdppc</span>&gt;</span>13600<span class="tag">&lt;/<span class="name">gdppc</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">neighbor</span> <span class="attr">direction</span>=<span class="string">"W"</span> <span class="attr">name</span>=<span class="string">"Costa Rica"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">neighbor</span> <span class="attr">direction</span>=<span class="string">"E"</span> <span class="attr">name</span>=<span class="string">"Colombia"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">country</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">data</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="åˆ é™¤èŠ‚ç‚¹"><a href="#åˆ é™¤èŠ‚ç‚¹" class="headerlink" title="åˆ é™¤èŠ‚ç‚¹"></a>åˆ é™¤èŠ‚ç‚¹</h2><ul>
<li>è§£æå­—ç¬¦ä¸²çš„æ–¹å¼æ¥åˆ é™¤èŠ‚ç‚¹</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> xml.etree <span class="keyword">import</span> ElementTree <span class="keyword">as</span> ET</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰“å¼€æ–‡ä»¶ï¼Œè¯»å–XMLå†…å®¹</span></span><br><span class="line">str_xml = open(<span class="string">'xo.xml'</span>, <span class="string">'r'</span>).read()</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†å­—ç¬¦ä¸²è§£ææˆxmlç‰¹æ®Šå¯¹è±¡ï¼Œrootä»£æŒ‡xmlæ–‡ä»¶çš„æ ¹èŠ‚ç‚¹</span></span><br><span class="line">root = ET.XML(str_xml)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¼€å§‹æ“ä½œxmlå¯¹è±¡</span></span><br><span class="line"><span class="comment"># é¡¶å±‚æ ‡ç­¾</span></span><br><span class="line">print(root.tag)</span><br><span class="line"></span><br><span class="line"><span class="comment"># éå†dataä¸‹çš„æ‰€æœ‰countryèŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">for</span> country <span class="keyword">in</span> root.findall(<span class="string">'country'</span>):</span><br><span class="line">    <span class="comment"># è·å–æ¯ä¸€ä¸ªcountryèŠ‚ç‚¹ä¸‹rankèŠ‚ç‚¹çš„å†…å®¹</span></span><br><span class="line">    rank = int(country.find(<span class="string">'rank'</span>).text)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> rank &gt; <span class="number">50</span>:</span><br><span class="line">        <span class="comment"># åˆ é™¤æŒ‡å®šcountryèŠ‚ç‚¹</span></span><br><span class="line">        root.remove(country)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿å­˜æ–‡ä»¶</span></span><br><span class="line">tree = ET.ElementTree(root)</span><br><span class="line">tree.write(<span class="string">"newxo.xml"</span>, encoding=<span class="string">'utf-8'</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>è§£ææ–‡ä»¶çš„æ–¹å¼æ¥åˆ é™¤èŠ‚ç‚¹</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> xml.etree <span class="keyword">import</span> ElementTree <span class="keyword">as</span> ET</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç›´æ¥è§£æxmlæ–‡ä»¶</span></span><br><span class="line">tree = ET.parse(<span class="string">"xo.xml"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–xmlæ–‡ä»¶çš„æ ¹èŠ‚ç‚¹</span></span><br><span class="line">root = tree.getroot()</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¼€å§‹æ“ä½œxmlå¯¹è±¡</span></span><br><span class="line"><span class="comment"># é¡¶å±‚æ ‡ç­¾</span></span><br><span class="line">print(root.tag)</span><br><span class="line"></span><br><span class="line"><span class="comment"># éå†dataä¸‹çš„æ‰€æœ‰countryèŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">for</span> country <span class="keyword">in</span> root.findall(<span class="string">'country'</span>):</span><br><span class="line">    <span class="comment"># è·å–æ¯ä¸€ä¸ªcountryèŠ‚ç‚¹ä¸‹rankèŠ‚ç‚¹çš„å†…å®¹</span></span><br><span class="line">    rank = int(country.find(<span class="string">'rank'</span>).text)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> rank &gt; <span class="number">50</span>:</span><br><span class="line">        <span class="comment"># åˆ é™¤æŒ‡å®šcountryèŠ‚ç‚¹</span></span><br><span class="line">        root.remove(country)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿å­˜æ–‡ä»¶</span></span><br><span class="line">tree.write(<span class="string">"newnew.xml"</span>, encoding=<span class="string">'utf-8'</span>)</span><br></pre></td></tr></table></figure>

<h1 id="åˆ›å»ºxmlæ–‡æ¡£"><a href="#åˆ›å»ºxmlæ–‡æ¡£" class="headerlink" title="åˆ›å»ºxmlæ–‡æ¡£"></a>åˆ›å»ºxmlæ–‡æ¡£</h1><ul>
<li>ç¬¬ä¸€ç§åˆ›å»ºæ–¹å¼</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> xml.etree <span class="keyword">import</span> ElementTree <span class="keyword">as</span> ET</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºæ ¹èŠ‚ç‚¹</span></span><br><span class="line">root = ET.Element(<span class="string">"World"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºäºŒçº§èŠ‚ç‚¹</span></span><br><span class="line">country1 = ET.Element(<span class="string">"country"</span>, &#123;<span class="string">"name"</span>: <span class="string">"China"</span>&#125;)</span><br><span class="line">country2 = ET.Element(<span class="string">"country"</span>, &#123;<span class="string">"name"</span>: <span class="string">"America"</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºä¸‰çº§èŠ‚ç‚¹</span></span><br><span class="line">city1 = ET.Element(<span class="string">"city"</span>, &#123;<span class="string">"name"</span>: <span class="string">"BeiJing"</span>&#125;)</span><br><span class="line">city2 = ET.Element(<span class="string">"city"</span>, &#123;<span class="string">"name"</span>: <span class="string">"TangShan"</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŠŠåˆ›å»ºçš„ä¸‰çº§èŠ‚ç‚¹æ·»åŠ åˆ°äºŒçº§èŠ‚ç‚¹ä¸‹é¢</span></span><br><span class="line">country1.append(city1)</span><br><span class="line">country1.append(city2)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å†æŠŠäºŒçº§èŠ‚ç‚¹æ·»åŠ åˆ°è·ŸèŠ‚ç‚¹ä¸­</span></span><br><span class="line">root.append(country1)</span><br><span class="line">root.append(country2)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºElementTreeå¯¹è±¡</span></span><br><span class="line">tree = ET.ElementTree(root)</span><br><span class="line">tree.write(<span class="string">"xxxx.xml"</span>, encoding=<span class="string">"utf-8"</span>, short_empty_elements=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>

<p><img src="http://oss.20150509.cn/QQ20160623-0@2x.png" alt=""></p>
<ul>
<li>ç¬¬äºŒç§åˆ›å»ºæ–¹å¼</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> xml.etree <span class="keyword">import</span> ElementTree <span class="keyword">as</span> ET</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºæ ¹èŠ‚ç‚¹</span></span><br><span class="line">root = ET.Element(<span class="string">"World"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºäºŒçº§èŠ‚ç‚¹</span></span><br><span class="line">country1 = root.makeelement(<span class="string">"country"</span>, &#123;<span class="string">"name"</span>: <span class="string">"China"</span>&#125;)</span><br><span class="line">country2 = root.makeelement(<span class="string">"country"</span>, &#123;<span class="string">"name"</span>: <span class="string">"America"</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºä¸‰çº§èŠ‚ç‚¹</span></span><br><span class="line">city1 = country1.makeelement(<span class="string">"city"</span>, &#123;<span class="string">"name"</span>: <span class="string">"BeiJing"</span>&#125;)</span><br><span class="line">city2 = country1.makeelement(<span class="string">"city"</span>, &#123;<span class="string">"name"</span>: <span class="string">"TangShan"</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŠŠåˆ›å»ºçš„ä¸‰çº§èŠ‚ç‚¹æ·»åŠ åˆ°äºŒçº§èŠ‚ç‚¹ä¸‹é¢</span></span><br><span class="line">country1.append(city1)</span><br><span class="line">country1.append(city2)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å†æŠŠäºŒçº§èŠ‚ç‚¹æ·»åŠ åˆ°è·ŸèŠ‚ç‚¹ä¸­</span></span><br><span class="line">root.append(country1)</span><br><span class="line">root.append(country2)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºElementTreeå¯¹è±¡</span></span><br><span class="line">tree = ET.ElementTree(root)</span><br><span class="line">tree.write(<span class="string">"xxxx.xml"</span>, encoding=<span class="string">"utf-8"</span>, short_empty_elements=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>ç¬¬ä¸‰ç§åˆ›å»ºæ–¹å¼</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> xml.etree <span class="keyword">import</span> ElementTree <span class="keyword">as</span> ET</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºæ ¹èŠ‚ç‚¹</span></span><br><span class="line">root = ET.Element(<span class="string">"World"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºäºŒçº§èŠ‚ç‚¹</span></span><br><span class="line">country1 = ET.SubElement(root, <span class="string">"country"</span>, attrib=&#123;<span class="string">"name"</span>: <span class="string">"China"</span>&#125;)</span><br><span class="line">country2 = ET.SubElement(root, <span class="string">"country"</span>, attrib=&#123;<span class="string">"name"</span>: <span class="string">"America"</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºä¸‰çº§èŠ‚ç‚¹</span></span><br><span class="line">city1 = ET.SubElement(country1, <span class="string">"city"</span>, attrib=&#123;<span class="string">"name"</span>: <span class="string">"BeiJing"</span>&#125;)</span><br><span class="line">city2 = ET.SubElement(country1, <span class="string">"city"</span>, attrib=&#123;<span class="string">"name"</span>: <span class="string">"TangShan"</span>&#125;)</span><br><span class="line"></span><br><span class="line">et = ET.ElementTree(root)  <span class="comment"># ç”Ÿæˆæ–‡æ¡£å¯¹è±¡</span></span><br><span class="line"><span class="comment"># xml_declaration æ·»åŠ xmlç‰ˆæœ¬ä¿¡æ¯æ³¨é‡Š</span></span><br><span class="line">et.write(<span class="string">"test.xml"</span>, encoding=<span class="string">"utf-8"</span>, xml_declaration=<span class="literal">True</span>, short_empty_elements=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸‰ç§æ–¹å¼ä¸åŒäºä¸Šé¢ä¸¤ç§æ–¹å¼çš„æ˜¯åœ¨åˆ›å»ºèŠ‚ç‚¹çš„æ—¶å€™ï¼Œå·²ç»æŒ‡å®šäº†è¯¥èŠ‚ç‚¹ä¸å…¶ä»–èŠ‚ç‚¹çš„å…³ç³»ã€‚</p>
<ul>
<li>ç¼©è¿›</li>
</ul>
<p>åŸç”Ÿä¿å­˜çš„XMLé»˜è®¤æ²¡æœ‰ç¼©è¿›ï¼Œå¦‚æœéœ€è¦ç¼©è¿›ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> xml.etree <span class="keyword">import</span> ElementTree <span class="keyword">as</span> ET</span><br><span class="line"><span class="keyword">from</span> xml.dom <span class="keyword">import</span> minidom</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">prettify</span><span class="params">(elem)</span>:</span></span><br><span class="line">    <span class="string">"""å°†èŠ‚ç‚¹è½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œå¹¶æ·»åŠ ç¼©è¿›"""</span></span><br><span class="line">    rough_string = ET.tostring(elem, <span class="string">'utf-8'</span>)</span><br><span class="line">    reparsed = minidom.parseString(rough_string)</span><br><span class="line">    <span class="keyword">return</span> reparsed.toprettyxml(indent=<span class="string">"\t"</span>)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># åˆ›å»ºæ ¹èŠ‚ç‚¹</span></span><br><span class="line">root = ET.Element(<span class="string">"World"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºäºŒçº§èŠ‚ç‚¹</span></span><br><span class="line">country1 = ET.SubElement(root, <span class="string">"country"</span>, attrib=&#123;<span class="string">"name"</span>: <span class="string">"China"</span>&#125;)</span><br><span class="line">country2 = ET.SubElement(root, <span class="string">"country"</span>, attrib=&#123;<span class="string">"name"</span>: <span class="string">"America"</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºä¸‰çº§èŠ‚ç‚¹</span></span><br><span class="line">city1 = ET.SubElement(country1, <span class="string">"city"</span>, attrib=&#123;<span class="string">"name"</span>: <span class="string">"BeiJing"</span>&#125;)</span><br><span class="line">city2 = ET.SubElement(country1, <span class="string">"city"</span>, attrib=&#123;<span class="string">"name"</span>: <span class="string">"TangShan"</span>&#125;)</span><br><span class="line"></span><br><span class="line">raw_str = prettify(root)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">"xxoo.xml"</span>, <span class="string">'w'</span>, encoding=<span class="string">"utf-8"</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(raw_str)</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>æ¨¡å—</tag>
        <tag>xml</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythoné…ç½®æ–‡ä»¶æ¨¡å—configparser</title>
    <url>/2016/06/22/Python%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E6%A8%A1%E5%9D%97configparser/</url>
    <content><![CDATA[<blockquote>
<p> Pythonä¸­çš„configparseræ¨¡å—ç”¨æ¥å¤„ç†ç‰¹å®šæ ¼å¼çš„æ–‡ä»¶ï¼Œå…¶æœ¬è´¨ä¸Šæ˜¯åˆ©ç”¨openæ¥æ“ä½œæ–‡ä»¶ã€‚</p>
<p>Python Version: 3.5+</p>
</blockquote>
<h1 id="configparseræŒ‡å®šçš„æ ¼å¼"><a href="#configparseræŒ‡å®šçš„æ ¼å¼" class="headerlink" title="configparseræŒ‡å®šçš„æ ¼å¼"></a>configparseræŒ‡å®šçš„æ ¼å¼</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># æ³¨é‡Š1</span><br><span class="line">;  æ³¨é‡Š2</span><br><span class="line"> </span><br><span class="line">[section1] # èŠ‚ç‚¹</span><br><span class="line">k1 &#x3D; v1    # å€¼</span><br><span class="line">k2:v2       # å€¼</span><br><span class="line"> </span><br><span class="line">[section2] # èŠ‚ç‚¹</span><br><span class="line">k1 &#x3D; v1    # å€¼</span><br></pre></td></tr></table></figure>

<h1 id="è·å–æ‰€æœ‰èŠ‚ç‚¹ä¿¡æ¯"><a href="#è·å–æ‰€æœ‰èŠ‚ç‚¹ä¿¡æ¯" class="headerlink" title="è·å–æ‰€æœ‰èŠ‚ç‚¹ä¿¡æ¯"></a>è·å–æ‰€æœ‰èŠ‚ç‚¹ä¿¡æ¯</h1><p>å®ä¾‹é…ç½®æ–‡ä»¶</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[mysql]</span><br><span class="line">version&#x3D;5.7</span><br><span class="line"></span><br><span class="line">[python]</span><br><span class="line">version:3.5</span><br></pre></td></tr></table></figure>

<p>ä»£ç </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> configparser</span><br><span class="line"></span><br><span class="line">config = configparser.ConfigParser()</span><br><span class="line">config.read(<span class="string">'test.conf'</span>, encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">ret = config.sections()</span><br><span class="line">print(ret)</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">[<span class="string">'mysql'</span>, <span class="string">'python'</span>]</span><br></pre></td></tr></table></figure>

<h2 id="è·å–æŒ‡å®šèŠ‚ç‚¹ä¸‹çš„æ‰€æœ‰é”®å€¼å¯¹"><a href="#è·å–æŒ‡å®šèŠ‚ç‚¹ä¸‹çš„æ‰€æœ‰é”®å€¼å¯¹" class="headerlink" title="è·å–æŒ‡å®šèŠ‚ç‚¹ä¸‹çš„æ‰€æœ‰é”®å€¼å¯¹"></a>è·å–æŒ‡å®šèŠ‚ç‚¹ä¸‹çš„æ‰€æœ‰é”®å€¼å¯¹</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> configparser</span><br><span class="line"></span><br><span class="line">config = configparser.ConfigParser()</span><br><span class="line">config.read(<span class="string">'test.conf'</span>, encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">ret = config.items(<span class="string">'mysql'</span>)</span><br><span class="line">print(ret)</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">[(<span class="string">'version'</span>, <span class="string">'5.7'</span>)]</span><br></pre></td></tr></table></figure>

<h2 id="è·å–æŒ‡å®šèŠ‚ç‚¹ä¸‹çš„æ‰€æœ‰é”®"><a href="#è·å–æŒ‡å®šèŠ‚ç‚¹ä¸‹çš„æ‰€æœ‰é”®" class="headerlink" title="è·å–æŒ‡å®šèŠ‚ç‚¹ä¸‹çš„æ‰€æœ‰é”®"></a>è·å–æŒ‡å®šèŠ‚ç‚¹ä¸‹çš„æ‰€æœ‰é”®</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> configparser</span><br><span class="line"></span><br><span class="line">config = configparser.ConfigParser()</span><br><span class="line">config.read(<span class="string">'test.conf'</span>, encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">ret = config.options(<span class="string">'mysql'</span>)</span><br><span class="line">print(ret)</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">[<span class="string">'version'</span>]</span><br></pre></td></tr></table></figure>

<h2 id="è·å–æŒ‡å®šèŠ‚ç‚¹ä¸‹çš„æ‰€æœ‰å€¼"><a href="#è·å–æŒ‡å®šèŠ‚ç‚¹ä¸‹çš„æ‰€æœ‰å€¼" class="headerlink" title="è·å–æŒ‡å®šèŠ‚ç‚¹ä¸‹çš„æ‰€æœ‰å€¼"></a>è·å–æŒ‡å®šèŠ‚ç‚¹ä¸‹çš„æ‰€æœ‰å€¼</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> configparser</span><br><span class="line"></span><br><span class="line">config = configparser.ConfigParser()</span><br><span class="line">config.read(<span class="string">'test.conf'</span>, encoding=<span class="string">'utf-8'</span>)</span><br><span class="line"><span class="comment"># ret = config.get('mysql', 'version')</span></span><br><span class="line"><span class="comment"># print(ret, type(ret))</span></span><br><span class="line"><span class="comment"># ret = config.getint('mysql', 'version')</span></span><br><span class="line"><span class="comment"># print(ret, type(ret))</span></span><br><span class="line">ret = config.getfloat(<span class="string">'mysql'</span>, <span class="string">'version'</span>)</span><br><span class="line">print(ret, type(ret))</span><br><span class="line"><span class="comment"># ret = config.getboolean('mysql', 'version')</span></span><br><span class="line"><span class="comment"># print(ret, type(ret))</span></span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line"><span class="number">5.7</span> &lt;<span class="class"><span class="keyword">class</span> '<span class="title">float</span>'&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="èŠ‚ç‚¹çš„å¢åˆ æŸ¥"><a href="#èŠ‚ç‚¹çš„å¢åˆ æŸ¥" class="headerlink" title="èŠ‚ç‚¹çš„å¢åˆ æŸ¥"></a>èŠ‚ç‚¹çš„å¢åˆ æŸ¥</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> configparser</span><br><span class="line"></span><br><span class="line">config = configparser.ConfigParser()</span><br><span class="line">config.read(<span class="string">'test.conf'</span>, encoding=<span class="string">'utf-8'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æŸ¥é…ç½®æ–‡ä»¶ä¸­æœ‰æ²¡æœ‰æŒ‡å®šçš„èŠ‚ç‚¹</span></span><br><span class="line">has_sec = config.has_section(<span class="string">'mysql'</span>)</span><br><span class="line">print(has_sec)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ æ–°çš„èŠ‚ç‚¹</span></span><br><span class="line">config.add_section(<span class="string">'java'</span>)</span><br><span class="line">config.write(open(<span class="string">'test.conf'</span>, <span class="string">'w'</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨é…ç½®æ–‡ä»¶ä¸­åˆ é™¤å·²æœ‰çš„èŠ‚ç‚¹</span></span><br><span class="line">config.remove_section(<span class="string">'python'</span>)</span><br><span class="line">config.write(open(<span class="string">'test.conf'</span>, <span class="string">'w'</span>))</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; cat test.conf</span><br><span class="line">[mysql]</span><br><span class="line">version = 5.7</span><br><span class="line"></span><br><span class="line">[java]</span><br></pre></td></tr></table></figure>

<h1 id="èŠ‚ç‚¹å†…é”®å€¼å¯¹çš„åˆ æ”¹æŸ¥"><a href="#èŠ‚ç‚¹å†…é”®å€¼å¯¹çš„åˆ æ”¹æŸ¥" class="headerlink" title="èŠ‚ç‚¹å†…é”®å€¼å¯¹çš„åˆ æ”¹æŸ¥"></a>èŠ‚ç‚¹å†…é”®å€¼å¯¹çš„åˆ æ”¹æŸ¥</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; cat test.conf</span><br><span class="line">[mysql]</span><br><span class="line">version = 5.7</span><br><span class="line">path = /usr/<span class="built_in">local</span>/mysql</span><br><span class="line"></span><br><span class="line">[java]</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> configparser</span><br><span class="line"></span><br><span class="line">config = configparser.ConfigParser()</span><br><span class="line">config.read(<span class="string">'test.conf'</span>, encoding=<span class="string">'utf-8'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æŸ¥é…ç½®æ–‡ä»¶ä¸­æœ‰æ²¡æœ‰æŒ‡å®šçš„èŠ‚ç‚¹</span></span><br><span class="line">has_opt = config.has_option(<span class="string">'mysql'</span>, <span class="string">'version'</span>)</span><br><span class="line">print(has_opt)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨é…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹èŠ‚ç‚¹</span></span><br><span class="line">config.set(<span class="string">'mysql'</span>, <span class="string">'path'</span>, <span class="string">'/usr/local/src/mysql'</span>)</span><br><span class="line">config.write(open(<span class="string">'test.conf'</span>, <span class="string">'w'</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤èŠ‚ç‚¹ä¸‹æŒ‡å®šçš„é”®å€¼å¯¹</span></span><br><span class="line">config.remove_option(<span class="string">'mysql'</span>, <span class="string">'version'</span>)</span><br><span class="line">config.write(open(<span class="string">'test.conf'</span>, <span class="string">'w'</span>))</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; cat test.conf</span><br><span class="line">[mysql]</span><br><span class="line">path = /usr/<span class="built_in">local</span>/src/mysql</span><br><span class="line"></span><br><span class="line">[java]</span><br></pre></td></tr></table></figure>

<p>configparseræ¨¡å—ä¸­ï¼Œ<strong>å¯¹èŠ‚ç‚¹æ²¡æœ‰ä¿®æ”¹çš„æ“ä½œ</strong>ï¼Œ<strong>å¯¹èŠ‚ç‚¹ä¸‹çš„é”®å€¼å¯¹æ²¡æœ‰å¢åŠ çš„æ“ä½œ</strong></p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>æ¨¡å—</tag>
        <tag>configparser</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonçš„æ­£åˆ™è¡¨è¾¾å¼æ¨¡å—re</title>
    <url>/2016/06/17/Python%E7%9A%84%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%A8%A1%E5%9D%97re/</url>
    <content><![CDATA[<blockquote>
<p>åœ¨Pythonä¸­<code>re</code>æ¨¡å—æä¾›äº†æ­£åˆ™è¡¨è¾¾å¼çš„ç›¸å…³æ“ä½œã€‚å…¶æœ¬è´¨ï¼ŒREæ˜¯ä¸€ç§å°å‹çš„ï¼Œé«˜åº¦ä¸“ä¸šåŒ–çš„ç¼–ç¨‹è¯­è¨€ï¼Œé€šè¿‡reæ¨¡å—æ¥å®ç°å…¶åŠŸèƒ½ã€‚æ­£åˆ™è¡¨è¾¾å¼è¢«ç¼–è¯‘æˆä¸€ç³»åˆ—å­—èŠ‚ç ï¼Œç„¶åç”±Cç¼–å†™çš„åŒ¹é…å¼•æ“æ‰§è¡Œã€‚</p>
<p>æˆ‘ä»¬å°†æ¶‰åŠä¸¤ä¸ªé‡è¦çš„åŠŸèƒ½ï¼Œè¿™å°†è¢«ç”¨äºå¤„ç†çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚ä½†æ˜¯é¦–å…ˆï¼šæœ‰å„ç§å„æ ·çš„å­—ç¬¦ï¼Œå½“å®ƒä»¬åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­ä½¿ç”¨ï¼Œå°†æœ‰ç‰¹æ®Šçš„æ„ä¹‰ã€‚ä¸ºäº†é¿å…åœ¨å¤„ç†æ­£åˆ™è¡¨è¾¾å¼çš„ä»»ä½•å›°æƒ‘ï¼Œå°†ä½¿ç”¨åŸå§‹å­—ç¬¦ä¸²ä½œä¸ºrâ€™expressionâ€œã€‚</p>
<p>Python Versionï¼š3.5+</p>
</blockquote>
<h1 id="åŒ¹é…"><a href="#åŒ¹é…" class="headerlink" title="åŒ¹é…"></a>åŒ¹é…</h1><h2 id="å­—ç¬¦åŒ¹é…"><a href="#å­—ç¬¦åŒ¹é…" class="headerlink" title="å­—ç¬¦åŒ¹é…"></a>å­—ç¬¦åŒ¹é…</h2><ul>
<li>.        é»˜è®¤åŒ¹é…é™¤æ¢è¡Œç¬¦ä»¥å¤–çš„ä»»æ„å­—ç¬¦</li>
<li>^        åŒ¹é…å­—ç¬¦ä¸²çš„å¼€å§‹</li>
<li>$        åŒ¹é…å­—ç¬¦ä¸²çš„ç»“æŸ</li>
<li>[]    æŒ‡å®šå­—ç¬¦èŒƒå›´åŒ¹é…</li>
<li>|        æˆ–</li>
<li>\        è½¬ä¹‰å­—ç¬¦ï¼Œåæ–œæ æœ¬èº«éœ€è¦åæ–œæ å»è½¬ä¹‰</li>
<li>()    åˆ†ç»„ï¼Œå»å·²ç»åŒ¹é…åˆ°çš„æ•°æ®ä¸­å†å»æå–æ•°æ®</li>
<li>\d  åŒ¹é…ä»»ä½•åè¿›åˆ¶æ•°ï¼›å®ƒç›¸å½“äºç±» [0-9]ã€‚</li>
<li>\D  åŒ¹é…ä»»ä½•éæ•°å­—å­—ç¬¦ï¼›å®ƒç›¸å½“äºç±» [^0-9]ã€‚</li>
<li>\s  åŒ¹é…ä»»ä½•ç©ºç™½å­—ç¬¦ï¼›å®ƒç›¸å½“äºç±»  [ \t\n\r\f\v]ã€‚</li>
<li>\S  åŒ¹é…ä»»ä½•éç©ºç™½å­—ç¬¦ï¼›å®ƒç›¸å½“äºç±» [^ \t\n\r\f\v]ã€‚</li>
<li>\w  åŒ¹é…ä»»ä½•å­—æ¯æ•°å­—å­—ç¬¦ï¼›å®ƒç›¸å½“äºç±» [a-zA-Z0-9_]ã€‚</li>
<li>\W  åŒ¹é…ä»»ä½•éå­—æ¯æ•°å­—å­—ç¬¦ï¼›å®ƒç›¸å½“äºç±» [^a-zA-Z0-9_]</li>
<li>\b    åŒ¹é…ä¸€ä¸ªå•è¯è¾¹ç•Œï¼Œä¹Ÿå°±æ˜¯æŒ‡å•è¯å’Œç©ºæ ¼é—´çš„ä½ç½®ã€‚ä¾‹å¦‚ï¼Œ â€˜er\bâ€™ å¯ä»¥åŒ¹é…â€neverâ€ ä¸­çš„ â€˜erâ€™ï¼Œä½†ä¸èƒ½åŒ¹é… â€œverbâ€ ä¸­çš„ â€˜erâ€™ã€‚</li>
<li>\B    åŒ¹é…éå•è¯è¾¹ç•Œã€‚â€™er\Bâ€™ èƒ½åŒ¹é… â€œverbâ€ ä¸­çš„ â€˜erâ€™ï¼Œä½†ä¸èƒ½åŒ¹é… â€œneverâ€ ä¸­çš„ â€˜erâ€™ã€‚</li>
</ul>
<h2 id="æ¬¡æ•°åŒ¹é…"><a href="#æ¬¡æ•°åŒ¹é…" class="headerlink" title="æ¬¡æ•°åŒ¹é…"></a>æ¬¡æ•°åŒ¹é…</h2><ul>
<li><ul>
<li>é‡å¤0æ¬¡æˆ–å¤šæ¬¡</li>
</ul>
</li>
<li><ul>
<li>é‡å¤1æ¬¡æˆ–å¤šæ¬¡</li>
</ul>
</li>
<li>?        é‡å¤0æ¬¡æˆ–1æ¬¡</li>
<li>{n}    é‡å¤næ¬¡</li>
<li>{n,}    é‡å¤næ¬¡æˆ–å¤šæ¬¡</li>
<li>{n, m}    é‡å¤næ¬¡åˆ°mæ¬¡</li>
</ul>
<h2 id="ä¿®é¥°ç¬¦"><a href="#ä¿®é¥°ç¬¦" class="headerlink" title="ä¿®é¥°ç¬¦"></a>ä¿®é¥°ç¬¦</h2><ul>
<li>re.I    ä½¿åŒ¹é…å¯¹å¤§å°å†™ä¸æ•æ„Ÿ</li>
<li>re.L    åšæœ¬åœ°åŒ–è¯†åˆ«ï¼ˆlocale-awareï¼‰åŒ¹é…</li>
<li>re.M    å¤šè¡ŒåŒ¹é…ï¼Œå½±å“ ^ å’Œ $</li>
<li>re.S    ä½¿ . åŒ¹é…åŒ…æ‹¬æ¢è¡Œåœ¨å†…çš„æ‰€æœ‰å­—ç¬¦</li>
<li>re.U    æ ¹æ®Unicodeå­—ç¬¦é›†è§£æå­—ç¬¦ã€‚è¿™ä¸ªæ ‡å¿—å½±å“ \w, \W, \b, \B.</li>
<li>re.X    è¯¥æ ‡å¿—é€šè¿‡ç»™äºˆä½ æ›´çµæ´»çš„æ ¼å¼ä»¥ä¾¿ä½ å°†æ­£åˆ™è¡¨è¾¾å¼å†™å¾—æ›´æ˜“äºç†è§£ã€‚</li>
</ul>
<h1 id="æ­£åˆ™è¡¨è¾¾å¼å®ä¾‹"><a href="#æ­£åˆ™è¡¨è¾¾å¼å®ä¾‹" class="headerlink" title="æ­£åˆ™è¡¨è¾¾å¼å®ä¾‹"></a>æ­£åˆ™è¡¨è¾¾å¼å®ä¾‹</h1><h2 id="æ™®é€šå­—ç¬¦åŒ¹é…"><a href="#æ™®é€šå­—ç¬¦åŒ¹é…" class="headerlink" title="æ™®é€šå­—ç¬¦åŒ¹é…"></a>æ™®é€šå­—ç¬¦åŒ¹é…</h2><ul>
<li><code>python</code>    åŒ¹é… <code>python</code></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>re.findall(<span class="string">r"python"</span>, <span class="string">"Pythonpythoner"</span>, re.I)</span><br><span class="line">[<span class="string">'Python'</span>, <span class="string">'python'</span>]</span><br></pre></td></tr></table></figure>

<h2 id="é”šç‚¹åŒ¹é…"><a href="#é”šç‚¹åŒ¹é…" class="headerlink" title="é”šç‚¹åŒ¹é…"></a>é”šç‚¹åŒ¹é…</h2><ul>
<li><code>^python$</code>     åŒ¹é…ä»¥<code>python</code>å¼€å¤´ç»“å°¾çš„å­—ç¬¦ä¸²</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>re.findall(<span class="string">r"^python$"</span>, <span class="string">"Pythonpythoner"</span>, re.I)</span><br><span class="line">[]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>re.findall(<span class="string">r"^python$"</span>, <span class="string">"Python"</span>, re.I)</span><br><span class="line">[<span class="string">'Python'</span>]</span><br></pre></td></tr></table></figure>

<h2 id="èŒƒå›´åŒ¹é…"><a href="#èŒƒå›´åŒ¹é…" class="headerlink" title="èŒƒå›´åŒ¹é…"></a>èŒƒå›´åŒ¹é…</h2><ul>
<li>[Pp]ython    åŒ¹é… â€œPythonâ€ æˆ– â€œpythonâ€</li>
<li>rub[ye]    åŒ¹é… â€œrubyâ€ æˆ– â€œrubeâ€</li>
<li>[aeiou]    åŒ¹é…ä¸­æ‹¬å·å†…çš„ä»»æ„ä¸€ä¸ªå­—æ¯</li>
<li>[0-9]    åŒ¹é…ä»»ä½•æ•°å­—ã€‚ç±»ä¼¼äº [0123456789]</li>
<li>[a-z]    åŒ¹é…ä»»ä½•å°å†™å­—æ¯</li>
<li>[A-Z]    åŒ¹é…ä»»ä½•å¤§å†™å­—æ¯</li>
<li>[a-zA-Z0-9]    åŒ¹é…ä»»ä½•å­—æ¯åŠæ•°å­—</li>
<li>[^aeiou]    é™¤äº†aeiouå­—æ¯ä»¥å¤–çš„æ‰€æœ‰å­—ç¬¦</li>
<li>[^0-9]    åŒ¹é…é™¤äº†æ•°å­—å¤–çš„å­—ç¬¦</li>
</ul>
<h2 id="æˆ–åŒ¹é…"><a href="#æˆ–åŒ¹é…" class="headerlink" title="æˆ–åŒ¹é…"></a>æˆ–åŒ¹é…</h2><ul>
<li><code>python|java</code>        åŒ¹é…<code>python</code>æˆ–<code>java</code></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>re.findall(<span class="string">r"python|java"</span>, <span class="string">"Python and java"</span>, re.I)</span><br><span class="line">[<span class="string">'Python'</span>, <span class="string">'java'</span>]</span><br></pre></td></tr></table></figure>

<h2 id="åŒ¹é…åæ–œæ "><a href="#åŒ¹é…åæ–œæ " class="headerlink" title="åŒ¹é…åæ–œæ "></a>åŒ¹é…åæ–œæ </h2><ul>
<li><code>\\</code> åŒ¹é…<code>\</code></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>re.findall(<span class="string">r"\\"</span>, <span class="string">"Python\ and java"</span>, re.I)</span><br><span class="line">[<span class="string">'\\'</span>]</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼šåœ¨åŒ¹é…çš„ä½¿ç”¨ï¼Œå¦‚æœæƒ³åŒ¹é…å­—ç¬¦ä¸²ä¸­çš„ä¸€ä¸ªåæ–œæ ï¼Œéœ€è¦åœ¨åŸç”Ÿå­—ç¬¦ä¸²ä¸­å†™ä¸¤ä¸ªåæ–œæ ã€‚åœ¨åŒ¹é…ç»“æœä¸­ï¼Œreä¸­åŒ¹é…åˆ°äº†ä¸€ä¸ª<code>\</code>ä½†æ˜¯è¿”å›çš„å´æ˜¯<code>\\</code>ï¼Œæ˜¯å› ä¸ºPythonä¸­ä¹Ÿéœ€è¦ä½¿ç”¨ä¸¤ä¸ªåæ–œæ æ¥è¡¨ç¤ºä¸€ä¸ªåæ–œæ </p>
<p>è¿™é‡Œéœ€è¦è¯¦ç»†è§£é‡Šä¸€ä¸‹ï¼š<strong>Pythonä¸reä¹‹é—´çš„è½¬ä¹‰</strong></p>
<p>åœ¨ä¹‹å‰çš„ç¬”è®°ä¸­ï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“<code>åŸç”Ÿå­—ç¬¦ä¸²</code>çš„æ¦‚å¿µï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯æˆ‘åœ¨pythonä¸­ä¸€æ—¦åœ¨å­—ç¬¦ä¸²å‰é¢åŠ äº†<code>r</code>å°±è¡¨ç¤ºåé¢è¿™ä¸²å­—ç¬¦ä¸²ä¸­æ‰€æœ‰çš„å­—ç¬¦éƒ½å½“åšæ™®é€šå­—ç¬¦æ¥å¤„ç†ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å·²ç»ä½¿ç”¨äº†åŸç”Ÿå­—ç¬¦ä¸²çš„å†™æ³•ï¼Œå£°æ˜å­—ç¬¦ä¸²ä¸­çš„<code>\</code>å·²ç»æ˜¯æ™®é€šå­—ç¬¦äº†ï¼Œä¸ºä»€ä¹ˆåˆ°äº†reä¸­ï¼Œéœ€è¦pythonç»™å‡º<code>\\</code>æ‰èƒ½åŒ¹é…åˆ°<code>\</code>å‘¢ï¼Ÿ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(<span class="string">'\\'</span>)</span><br><span class="line">\</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(<span class="string">r'\\'</span>)</span><br><span class="line">\\</span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯å› ä¸ºï¼Œreå’ŒPythonå…¶å®æ˜¯ä¸¤å¥—ç³»ç»Ÿï¼Œåœ¨Pythonä¸­è™½ç„¶æ˜ç¡®ç»™å‡ºäº†è®©reå»åŒ¹é…<code>\</code>ï¼Œä½†æ˜¯è¿™ä¸€ä¸ª<code>\</code>ä¼ é€’ç»™reæ—¶ï¼Œåœ¨reä¸­ä¸€ä¸ª<code>\</code>ä¹Ÿæ˜¯ç‰¹æ®Šå­—ç¬¦ï¼Œè¡¨ç¤ºè½¬ä¹‰ï¼Œæ‰€ä»¥ä¸èƒ½æ­£ç¡®åœ¨å­—ç¬¦ä¸²ä¸­åŒ¹é…åˆ°å­—ç¬¦<code>\</code>ï¼Œä¸ºäº†æŠµæ¶ˆæ‰reä¸­<code>\</code>çš„ç‰¹æ®Šå«ä¹‰ï¼Œéœ€è¦ä½¿ç”¨<code>\\</code>æ¥åŒ¹é…åˆ°ä¸€ä¸ª<code>\</code>,æ‰€ä»¥ä»reçš„è§’åº¦æ¥è¯´ï¼Œå°±è¦æ±‚Pythonä¼ é€’è¿‡å»çš„æ˜¯<code>\\</code>æ‰èƒ½è®©reåœ¨å­—ç¬¦ä¸²ä¸­åŒ¹é…åˆ°<code>\</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>re.findall(<span class="string">"\\\\"</span>, <span class="string">"Python\ and java"</span>, re.I)</span><br><span class="line">[<span class="string">'\\'</span>]</span><br></pre></td></tr></table></figure>

<p>å¯¹æ¯”ä¸€ä¸‹ï¼Œå¦‚æœä¸ä½¿ç”¨åŸç”Ÿå­—ç¬¦ä¸²çš„è¯ï¼Œreä»ç„¶éœ€è¦Pythonä¼ é€’è¿‡å»<code>\\</code>æ‰èƒ½åŒ¹é…åˆ°<code>\</code>ï¼Œä½†æ˜¯Pythonä¸­çš„å­—ç¬¦ä¸²å¦‚æœæ²¡æœ‰å£°æ˜æ˜¯åŸç”Ÿå­—ç¬¦ä¸²çš„è¯éœ€è¦ä½¿ç”¨<code>\\\\</code>æ‰èƒ½è¡¨ç¤º<code>\\</code></p>
<h1 id="reæ¨¡å—"><a href="#reæ¨¡å—" class="headerlink" title="reæ¨¡å—"></a>reæ¨¡å—</h1><p>ä¸Šé¢ç®€å•çš„ä»‹ç»å®Œreçš„åŸºæœ¬è¡¨è¾¾å¼ï¼Œä¸‹é¢å°±å¯ä»¥å®é™…ä½¿ç”¨reçš„å‡½æ•°æ¥æ“ä½œåŒ¹é…å­—ç¬¦ä¸²å•¦</p>
<h2 id="match"><a href="#match" class="headerlink" title="match"></a>match</h2><p>matchï¼Œä»èµ·å§‹ä½ç½®å¼€å§‹åŒ¹é…ï¼ŒåŒ¹é…æˆåŠŸè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼ŒæœªåŒ¹é…æˆåŠŸè¿”å›None</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">match</span><span class="params">(pattern, string, flags=<span class="number">0</span>)</span>:</span></span><br><span class="line">    <span class="string">"""Try to apply the pattern at the start of the string, returning</span></span><br><span class="line"><span class="string">    a match object, or None if no match was found."""</span></span><br><span class="line">    <span class="keyword">return</span> _compile(pattern, flags).match(string)</span><br></pre></td></tr></table></figure>

<p><strong>å‚æ•°</strong></p>
<ul>
<li>pattern    æ­£åˆ™è¡¨è¾¾å¼</li>
<li>string    å­—ç¬¦ä¸²</li>
<li>flags    ç¼–è¯‘æ ‡å¿—ä½ï¼Œç”¨äºä¿®æ”¹æ­£åˆ™è¡¨è¾¾å¼çš„åŒ¹é…æ–¹å¼ï¼Œå¦‚ï¼šæ˜¯å¦åŒºåˆ†å¤§å°å†™ï¼Œå¤šè¡ŒåŒ¹é…ç­‰ç­‰ã€‚</li>
</ul>
<p><strong>åŒ¹é…å¯¹è±¡æ–¹æ³•</strong></p>
<ul>
<li>group()    è·å–åŒ¹é…åˆ°çš„æ‰€æœ‰ç»“æœ</li>
<li>groups()    è·å–æ¨¡å‹ä¸­åŒ¹é…åˆ°çš„åˆ†ç»„ç»“æœ</li>
<li>groupdict() è·å–æ¨¡å‹ä¸­åŒ¹é…åˆ°çš„åˆ†ç»„ç»“æœ</li>
<li>start()    è¿”å›åŒ¹é…å¼€å§‹çš„ä½ç½®</li>
<li>end()    è¿”å›åŒ¹é…ç»“æŸçš„ä½ç½®</li>
<li>span()    è¿”å›ä¸€ä¸ªå…ƒç»„åŒ…å«åŒ¹é… (å¼€å§‹,ç»“æŸ) çš„ä½ç½®</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ— åˆ†ç»„</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">r = re.match(<span class="string">'com'</span>, <span class="string">'comwww.runcomoob'</span>)</span><br><span class="line">print(r.group())</span><br><span class="line">print(r.groups())</span><br><span class="line">print(r.groupdict())</span><br><span class="line"></span><br><span class="line">r = re.match(<span class="string">'com'</span>, <span class="string">'Comwww.runComoob'</span>, re.I)</span><br><span class="line">print(r.group())</span><br><span class="line">print(r.groups())</span><br><span class="line">print(r.groupdict())</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">com</span><br><span class="line">()</span><br><span class="line">&#123;&#125;</span><br><span class="line">Com</span><br><span class="line">()</span><br><span class="line">&#123;&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æœ‰åˆ†ç»„</span></span><br><span class="line"><span class="comment"># ä¸ºä½•è¦æœ‰åˆ†ç»„ï¼Ÿæå–åŒ¹é…æˆåŠŸçš„æŒ‡å®šå†…å®¹ï¼ˆå…ˆåŒ¹é…æˆåŠŸå…¨éƒ¨æ­£åˆ™ï¼Œå†åŒ¹é…æˆåŠŸçš„å±€éƒ¨å†…å®¹æå–å‡ºæ¥ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">r = re.match(<span class="string">'c(..)'</span>, <span class="string">'comwww.runcomoob'</span>)</span><br><span class="line">print(r.group())</span><br><span class="line">print(r.groups())</span><br><span class="line">print(r.groupdict())</span><br><span class="line"></span><br><span class="line">r = re.match(<span class="string">'c(..)'</span>, <span class="string">'Comwww.runComoob'</span>, re.I)</span><br><span class="line">print(r.group())</span><br><span class="line">print(r.groups())</span><br><span class="line">print(r.groupdict())</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">com</span><br><span class="line">(<span class="string">'om'</span>,)</span><br><span class="line">&#123;&#125;</span><br><span class="line">Com</span><br><span class="line">(<span class="string">'om'</span>,)</span><br><span class="line">&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>è§‚å¯Ÿå–å‡ºæ¥çš„ç»“æœï¼Œ<code>groups()</code>ä¸­æœ‰äº†åŒ¹é…ç»“æœï¼ŒåŒ¹é…çš„æ˜¯<code>group()</code>ä¸­çš„ç»“æœã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä½¿ç”¨åˆ†ç»„ï¼Œæ„å‘³ç€åœ¨åŒ¹é…åˆ°æ•´ä¸ªå­—ç¬¦ä¸²ä¸­å†æ¬¡è¿›è¡ŒåŒ¹é…å¹¶å–å€¼(å–æ‹¬å·ä¸­çš„å€¼)</p>
<h2 id="search"><a href="#search" class="headerlink" title="search"></a>search</h2><p>search,æµè§ˆæ•´ä¸ªå­—ç¬¦ä¸²å»åŒ¹é…ç¬¬ä¸€ä¸ªï¼ŒæœªåŒ¹é…æˆåŠŸè¿”å›None</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">search</span><span class="params">(pattern, string, flags=<span class="number">0</span>)</span>:</span></span><br><span class="line">    <span class="string">"""Scan through string looking for a match to the pattern, returning</span></span><br><span class="line"><span class="string">    a match object, or None if no match was found."""</span></span><br><span class="line">    <span class="keyword">return</span> _compile(pattern, flags).search(string)</span><br></pre></td></tr></table></figure>

<p><strong>å‚æ•°</strong></p>
<ul>
<li>pattern    æ­£åˆ™è¡¨è¾¾å¼</li>
<li>string    å­—ç¬¦ä¸²</li>
<li>flags    ç¼–è¯‘æ ‡å¿—ä½ï¼Œç”¨äºä¿®æ”¹æ­£åˆ™è¡¨è¾¾å¼çš„åŒ¹é…æ–¹å¼ï¼Œå¦‚ï¼šæ˜¯å¦åŒºåˆ†å¤§å°å†™ï¼Œå¤šè¡ŒåŒ¹é…ç­‰ç­‰ã€‚</li>
</ul>
<p><strong>åŒ¹é…å¯¹è±¡æ–¹æ³•</strong></p>
<ul>
<li>group()    è·å–åŒ¹é…åˆ°çš„æ‰€æœ‰ç»“æœ</li>
<li>groups()    è·å–æ¨¡å‹ä¸­åŒ¹é…åˆ°çš„åˆ†ç»„ç»“æœ</li>
<li>groupdict() è·å–æ¨¡å‹ä¸­åŒ¹é…åˆ°çš„åˆ†ç»„ç»“æœ</li>
<li>start()    è¿”å›åŒ¹é…å¼€å§‹çš„ä½ç½®</li>
<li>end()    è¿”å›åŒ¹é…ç»“æŸçš„ä½ç½®</li>
<li>span()    è¿”å›ä¸€ä¸ªå…ƒç»„åŒ…å«åŒ¹é… (å¼€å§‹,ç»“æŸ) çš„ä½ç½®</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">r = re.search(<span class="string">'\dcom'</span>, <span class="string">'www.4comrunoob.5com'</span>)</span><br><span class="line">print(r.group())</span><br><span class="line">print(r.groups())</span><br><span class="line">print(r.groupdict())</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line"><span class="number">4</span>com</span><br><span class="line">()</span><br><span class="line">&#123;&#125;</span><br></pre></td></tr></table></figure>

<h1 id="re-matchä¸re-searchçš„åŒºåˆ«"><a href="#re-matchä¸re-searchçš„åŒºåˆ«" class="headerlink" title="re.matchä¸re.searchçš„åŒºåˆ«"></a>re.matchä¸re.searchçš„åŒºåˆ«</h1><p>re.matchåªåŒ¹é…å­—ç¬¦ä¸²çš„å¼€å§‹ï¼Œå¦‚æœå­—ç¬¦ä¸²å¼€å§‹ä¸ç¬¦åˆæ­£åˆ™è¡¨è¾¾å¼ï¼Œåˆ™åŒ¹é…å¤±è´¥ï¼Œå‡½æ•°è¿”å›Noneï¼›è€Œre.searchåŒ¹é…æ•´ä¸ªå­—ç¬¦ä¸²ï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªåŒ¹é…ã€‚</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">line = <span class="string">"Cats are smarter than dogs"</span></span><br><span class="line"></span><br><span class="line">matchObj = re.match(<span class="string">r'dogs'</span>, line, re.M | re.I)</span><br><span class="line"><span class="keyword">if</span> matchObj:</span><br><span class="line">    print(<span class="string">"match --&gt; matchObj.group() : "</span>, matchObj.group())</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">"No match!!"</span>)</span><br><span class="line"></span><br><span class="line">matchObj = re.search(<span class="string">r'dogs'</span>, line, re.M | re.I)</span><br><span class="line"><span class="keyword">if</span> matchObj:</span><br><span class="line">    print(<span class="string">"search --&gt; matchObj.group() : "</span>, matchObj.group())</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">"No match!!"</span>)</span><br><span class="line">    </span><br><span class="line">------------</span><br><span class="line">No match!!</span><br><span class="line">search --&gt; matchObj.group() :  dogs</span><br></pre></td></tr></table></figure>

<h2 id="findall"><a href="#findall" class="headerlink" title="findall"></a>findall</h2><p>findallï¼Œæ‰¾åˆ° RE åŒ¹é…çš„æ‰€æœ‰å­ä¸²ï¼Œå¹¶æŠŠå®ƒä»¬ä½œä¸ºä¸€ä¸ªåˆ—è¡¨è¿”å›</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">findall</span><span class="params">(pattern, string, flags=<span class="number">0</span>)</span>:</span></span><br><span class="line">    <span class="string">"""Return a list of all non-overlapping matches in the string.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    If one or more capturing groups are present in the pattern, return</span></span><br><span class="line"><span class="string">    a list of groups; this will be a list of tuples if the pattern</span></span><br><span class="line"><span class="string">    has more than one group.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Empty matches are included in the result."""</span></span><br><span class="line">    <span class="keyword">return</span> _compile(pattern, flags).findall(string)</span><br></pre></td></tr></table></figure>

<p><strong>å‚æ•°</strong></p>
<ul>
<li>pattern    æ­£åˆ™è¡¨è¾¾å¼</li>
<li>string    å­—ç¬¦ä¸²</li>
<li>flags    ç¼–è¯‘æ ‡å¿—ä½ï¼Œç”¨äºä¿®æ”¹æ­£åˆ™è¡¨è¾¾å¼çš„åŒ¹é…æ–¹å¼ï¼Œå¦‚ï¼šæ˜¯å¦åŒºåˆ†å¤§å°å†™ï¼Œå¤šè¡ŒåŒ¹é…ç­‰ç­‰ã€‚</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ— åˆ†ç»„</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">r = re.findall(<span class="string">r'\d+'</span>, <span class="string">'1one1two2three3four4'</span>)</span><br><span class="line">print(r)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æœ‰åˆ†ç»„</span></span><br><span class="line">r = re.findall(<span class="string">r'\d+(..)'</span>, <span class="string">'1one1two2three3four4'</span>)</span><br><span class="line">print(r)</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">[<span class="string">'1'</span>, <span class="string">'1'</span>, <span class="string">'2'</span>, <span class="string">'3'</span>, <span class="string">'4'</span>]</span><br><span class="line">[<span class="string">'on'</span>, <span class="string">'tw'</span>, <span class="string">'th'</span>, <span class="string">'fo'</span>]</span><br></pre></td></tr></table></figure>

<h2 id="finditer"><a href="#finditer" class="headerlink" title="finditer"></a>finditer</h2><p>æ‰¾åˆ° RE åŒ¹é…çš„æ‰€æœ‰å­ä¸²ï¼Œå¹¶æŠŠå®ƒä»¬ä½œä¸ºä¸€ä¸ªè¿­ä»£å™¨è¿”å›</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span></span><br><span class="line"></span><br><span class="line">r = re.finditer(<span class="string">r'\d+'</span>, <span class="string">'1one1two2three3four4'</span>)</span><br><span class="line">print(r)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> r:</span><br><span class="line">    print(i.span(), i.group(), i.groupdict())</span><br><span class="line">    </span><br><span class="line">------------</span><br><span class="line">&lt;callable_iterator object at <span class="number">0x101178748</span>&gt;</span><br><span class="line">(<span class="number">0</span>, <span class="number">1</span>) <span class="number">1</span> &#123;&#125;</span><br><span class="line">(<span class="number">4</span>, <span class="number">5</span>) <span class="number">1</span> &#123;&#125;</span><br><span class="line">(<span class="number">8</span>, <span class="number">9</span>) <span class="number">2</span> &#123;&#125;</span><br><span class="line">(<span class="number">14</span>, <span class="number">15</span>) <span class="number">3</span> &#123;&#125;</span><br><span class="line">(<span class="number">19</span>, <span class="number">20</span>) <span class="number">4</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="sub"><a href="#sub" class="headerlink" title="sub"></a>sub</h2><p>subï¼Œæ›¿æ¢åŒ¹é…æˆåŠŸçš„æŒ‡å®šä½ç½®å­—ç¬¦ä¸²</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sub</span><span class="params">(pattern, repl, string, count=<span class="number">0</span>, flags=<span class="number">0</span>)</span>:</span></span><br><span class="line">    <span class="string">"""Return the string obtained by replacing the leftmost</span></span><br><span class="line"><span class="string">    non-overlapping occurrences of the pattern in string by the</span></span><br><span class="line"><span class="string">    replacement repl.  repl can be either a string or a callable;</span></span><br><span class="line"><span class="string">    if a string, backslash escapes in it are processed.  If it is</span></span><br><span class="line"><span class="string">    a callable, it's passed the match object and must return</span></span><br><span class="line"><span class="string">    a replacement string to be used."""</span></span><br><span class="line">    <span class="keyword">return</span> _compile(pattern, flags).sub(repl, string, count)</span><br></pre></td></tr></table></figure>

<p><strong>å‚æ•°</strong></p>
<ul>
<li>patternï¼š æ­£åˆ™æ¨¡å‹</li>
<li>repl   ï¼š è¦æ›¿æ¢çš„å­—ç¬¦ä¸²æˆ–å¯æ‰§è¡Œå¯¹è±¡</li>
<li>string ï¼š è¦åŒ¹é…çš„å­—ç¬¦ä¸²</li>
<li>count  ï¼š æŒ‡å®šåŒ¹é…ä¸ªæ•°</li>
<li>flags  ï¼š åŒ¹é…æ¨¡å¼</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä¸åˆ†ç»„æ— å…³</span></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">r = re.sub(<span class="string">"a\w+"</span>, <span class="string">"18"</span>, <span class="string">"hello ps bcd ps lge ps acd 25"</span>, <span class="number">2</span>)</span><br><span class="line">print(r)</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">hello ps bcd ps lge ps <span class="number">18</span> <span class="number">25</span></span><br></pre></td></tr></table></figure>


<h2 id="split"><a href="#split" class="headerlink" title="split"></a>split</h2><p>splitï¼Œæ ¹æ®æ­£åˆ™åŒ¹é…åˆ†å‰²å­—ç¬¦ä¸²</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">split</span><span class="params">(pattern, string, maxsplit=<span class="number">0</span>, flags=<span class="number">0</span>)</span>:</span></span><br><span class="line">    <span class="string">"""Split the source string by the occurrences of the pattern,</span></span><br><span class="line"><span class="string">    returning a list containing the resulting substrings.  If</span></span><br><span class="line"><span class="string">    capturing parentheses are used in pattern, then the text of all</span></span><br><span class="line"><span class="string">    groups in the pattern are also returned as part of the resulting</span></span><br><span class="line"><span class="string">    list.  If maxsplit is nonzero, at most maxsplit splits occur,</span></span><br><span class="line"><span class="string">    and the remainder of the string is returned as the final element</span></span><br><span class="line"><span class="string">    of the list."""</span></span><br><span class="line">    <span class="keyword">return</span> _compile(pattern, flags).split(string, maxsplit)</span><br></pre></td></tr></table></figure>

<ul>
<li>patternï¼š æ­£åˆ™æ¨¡å‹</li>
<li>string ï¼š è¦åŒ¹é…çš„å­—ç¬¦ä¸²</li>
<li>maxsplitï¼šæŒ‡å®šåˆ†å‰²ä¸ªæ•°</li>
<li>flags  ï¼š åŒ¹é…æ¨¡å¼</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ— åˆ†ç»„</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">origin = <span class="string">"hello ps bcd ps lge ps acd 25"</span></span><br><span class="line">r = re.split(<span class="string">"ps"</span>, <span class="string">"hello ps bcd ps lge ps acd 25"</span>, <span class="number">1</span>)</span><br><span class="line">print(r)</span><br><span class="line">r = re.split(<span class="string">"ps"</span>, <span class="string">"hello ps bcd ps lge ps acd 25"</span>, <span class="number">2</span>)</span><br><span class="line">print(r)</span><br><span class="line">r = re.split(<span class="string">"ps"</span>, <span class="string">"hello ps bcd ps lge ps acd 25"</span>, <span class="number">3</span>)</span><br><span class="line">print(r)</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">[<span class="string">'hello '</span>, <span class="string">' bcd ps lge ps acd 25'</span>]</span><br><span class="line">[<span class="string">'hello '</span>, <span class="string">' bcd '</span>, <span class="string">' lge ps acd 25'</span>]</span><br><span class="line">[<span class="string">'hello '</span>, <span class="string">' bcd '</span>, <span class="string">' lge '</span>, <span class="string">' acd 25'</span>]</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æœ‰åˆ†ç»„</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">origin = <span class="string">"hello ps bcd ps lge ps acd 25"</span></span><br><span class="line">r = re.split(<span class="string">"(ps)"</span>, <span class="string">"hello ps bcd ps lge ps acd 25"</span>, <span class="number">1</span>)</span><br><span class="line">print(r)</span><br><span class="line">r = re.split(<span class="string">"p(s)"</span>, <span class="string">"hello ps bcd ps lge ps acd 25"</span>, <span class="number">1</span>)</span><br><span class="line">print(r)</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">[<span class="string">'hello '</span>, <span class="string">'ps'</span>, <span class="string">' bcd ps lge ps acd 25'</span>]</span><br><span class="line">[<span class="string">'hello '</span>, <span class="string">'s'</span>, <span class="string">' bcd ps lge ps acd 25'</span>]</span><br></pre></td></tr></table></figure>

<p>ä»ä¸Šé¢çš„å®ä¾‹ä¸­å¯ä»¥çœ‹å‡ºï¼Œåœ¨ä¸åˆ†ç»„çš„æƒ…å†µä¸‹ï¼Œåˆ—è¡¨çš„é•¿åº¦=maxsplit+1ï¼ŒåŒ¹é…åˆ°çš„åˆ†å‰²å­—ç¬¦ä¸²å¹¶ä¸ä¼šè¿”å›å›æ¥ï¼›è€Œåœ¨åˆ†ç»„çš„æƒ…å†µä¸‹ï¼Œåˆ—è¡¨çš„é•¿åº¦=maxsplit+2ï¼ŒåŒ¹é…åˆ°çš„å­—ç¬¦ä¸²ä¹Ÿä¼šè¿”å›åˆ°åˆ—è¡¨ä¸­</p>
<h2 id="compile"><a href="#compile" class="headerlink" title="compile"></a>compile</h2><p>compile,ç¼–è¯‘æ­£åˆ™è¡¨è¾¾å¼</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">compile</span><span class="params">(pattern, flags=<span class="number">0</span>)</span>:</span></span><br><span class="line">    <span class="string">"Compile a regular expression pattern, returning a pattern object."</span></span><br><span class="line">    <span class="keyword">return</span> _compile(pattern, flags)</span><br></pre></td></tr></table></figure>

<p><strong>å‚æ•°</strong></p>
<ul>
<li>patternï¼š æ­£åˆ™æ¨¡å‹</li>
<li>flags  ï¼š åŒ¹é…æ¨¡å¼</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">p = re.compile(<span class="string">r'\d+(...)'</span>)</span><br><span class="line">print(p.findall(<span class="string">'123one134two256three378four469'</span>))</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">[<span class="string">'one'</span>, <span class="string">'two'</span>, <span class="string">'thr'</span>, <span class="string">'fou'</span>]</span><br></pre></td></tr></table></figure>

<p>å…ˆæŠŠæ­£åˆ™è¡¨è¾¾å¼ç¼–è¯‘å†åŒ¹é…ï¼Œåœ¨éå†åŒ¹é…å¤§å‹æ–‡ä»¶æ—¶ï¼Œæ•ˆç‡ä¼šæé«˜å¾ˆå¤šï¼Œå…å»äº†æ¯æ¬¡è¿˜è¦ç¼–è¯‘æ­£åˆ™è¡¨è¾¾å¼</p>
<h1 id="å¸¸ç”¨æ­£åˆ™è¡¨è¾¾å¼"><a href="#å¸¸ç”¨æ­£åˆ™è¡¨è¾¾å¼" class="headerlink" title="å¸¸ç”¨æ­£åˆ™è¡¨è¾¾å¼"></a>å¸¸ç”¨æ­£åˆ™è¡¨è¾¾å¼</h1><ul>
<li>IPï¼š<code>^(25[0-5]|2[0-4]\d|[0-1]?\d?\d)(\.(25[0-5]|2[0-4]\d|[0-1]?\d?\d)){3}$</code></li>
<li>æ‰‹æœºå·ï¼š<code>^1[3|4|5|8][0-9]\d{8}$</code></li>
<li>é‚®ç®±ï¼š<code>[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+</code></li>
</ul>
<h1 id="æ­£åˆ™è¡¨è¾¾å¼è®¡ç®—å™¨å®ä¾‹"><a href="#æ­£åˆ™è¡¨è¾¾å¼è®¡ç®—å™¨å®ä¾‹" class="headerlink" title="æ­£åˆ™è¡¨è¾¾å¼è®¡ç®—å™¨å®ä¾‹"></a>æ­£åˆ™è¡¨è¾¾å¼è®¡ç®—å™¨å®ä¾‹</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="comment"># test_expression = '12+33*(11.5+22.5)*44/2+59-(2*3)+(8*5-(10/2))'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">qukuohao</span><span class="params">(s)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    å°†è¡¨è¾¾å¼ä¸­æ‰€æœ‰æ‹¬å·ä¸­çš„å†…å®¹è®¡ç®—æˆæ•°å€¼,å»æ‰è¡¨è¾¾å¼ä¸­æ‰€æœ‰çš„æ‹¬å·</span></span><br><span class="line"><span class="string">    :param s: è®¡ç®—è¡¨è¾¾å¼[str]</span></span><br><span class="line"><span class="string">    :return: æ²¡æœ‰æ‹¬å·çš„è®¡ç®—è¡¨è¾¾å¼[str]</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">'('</span> <span class="keyword">in</span> s:</span><br><span class="line">            r = re.split(<span class="string">r'\(([^()]*)\)'</span>, s, <span class="number">1</span>)</span><br><span class="line">            <span class="comment"># ret = eval(r[1])</span></span><br><span class="line">            ret = cal(r[<span class="number">1</span>])</span><br><span class="line">            s = r[<span class="number">0</span>] + str(ret) + r[<span class="number">2</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fuhao</span><span class="params">(s)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    å¤„ç†ç¬¦å·çš„é—®é¢˜</span></span><br><span class="line"><span class="string">    :param s: è®¡ç®—è¡¨è¾¾å¼</span></span><br><span class="line"><span class="string">    :return: è®¡ç®—è¡¨è¾¾å¼</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    ss = s.replace(<span class="string">'+-'</span>, <span class="string">'-'</span>)</span><br><span class="line">    sss = ss.replace(<span class="string">'--'</span>, <span class="string">'+'</span>)</span><br><span class="line">    <span class="keyword">return</span> sss</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">chengshufajisuan</span><span class="params">(s)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    ä¸“é—¨ç”¨æ¥è®¡ç®—ä¸å¸¦æ‹¬å·çš„è®¡ç®—è¡¨è¾¾å¼ä¸­çš„ä¹˜é™¤æ³•</span></span><br><span class="line"><span class="string">    :param s: ä¸å¸¦æ‹¬å·çš„è®¡ç®—è¡¨è¾¾å¼</span></span><br><span class="line"><span class="string">    :return: åªæœ‰åŠ å‡æ³•çš„è®¡ç®—è¡¨è¾¾å¼(å¦‚æœä¸å†æœ‰åŠ å‡æ³•,ç›´æ¥è¿”å›è®¡ç®—ç»“æœ)</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">'*'</span> <span class="keyword">in</span> s <span class="keyword">or</span> <span class="string">'/'</span> <span class="keyword">in</span> s:</span><br><span class="line">            r = re.split(<span class="string">r'(\d+\.?\d*[*|/]-?\d+\.?\d*)'</span>, s, <span class="number">1</span>)</span><br><span class="line">            ss = eval(r[<span class="number">1</span>])</span><br><span class="line">            s = r[<span class="number">0</span>] + str(ss) + r[<span class="number">2</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">jiajianfajisuan</span><span class="params">(s)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    ä¸“é—¨ç”¨æ¥è®¡ç®—ä¸å¸¦æ‹¬å·çš„è®¡ç®—è¡¨ç¤ºå¼ä¸­çš„åŠ å‡æ³•</span></span><br><span class="line"><span class="string">    :param s: ä¸å¸¦æ‹¬å·ä¸”åªæœ‰åŠ å‡æ³•çš„è¡¨è¾¾å¼</span></span><br><span class="line"><span class="string">    :return: æœ€ç»ˆçš„è®¡ç®—ç»“æœ</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    s = fuhao(s)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    	<span class="comment"># 5-9çš„æƒ…å†µï¼›-5-9çš„æƒ…å†µéƒ½éœ€è¦é¢å¤–è€ƒè™‘</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">'+'</span> <span class="keyword">in</span> s <span class="keyword">or</span> s.count(<span class="string">'-'</span>) &gt; <span class="number">1</span> <span class="keyword">or</span> (s.count(<span class="string">'-'</span>) == <span class="number">1</span> <span class="keyword">and</span> <span class="keyword">not</span> s.startswith(<span class="string">'-'</span>)):</span><br><span class="line">            r = re.split(<span class="string">r'(-?\d+\.?\d*[+|-]\d+\.?\d*)'</span>, s, <span class="number">1</span>)</span><br><span class="line">            ss = eval(r[<span class="number">1</span>])</span><br><span class="line">            s = r[<span class="number">0</span>]+str(ss)+r[<span class="number">2</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cal</span><span class="params">(s)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    + - * / æ··åˆè¿ç®—</span></span><br><span class="line"><span class="string">    :param s:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">'*'</span> <span class="keyword">in</span> s <span class="keyword">or</span> <span class="string">'/'</span> <span class="keyword">in</span> s:</span><br><span class="line">        s = chengshufajisuan(s)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">'+'</span> <span class="keyword">in</span> s <span class="keyword">or</span> s.count(<span class="string">'-'</span>) &gt; <span class="number">1</span>:</span><br><span class="line">            s = jiajianfajisuan(s)</span><br><span class="line">            <span class="keyword">return</span> s</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> s</span><br><span class="line">    <span class="keyword">elif</span> <span class="string">'+'</span> <span class="keyword">in</span> s <span class="keyword">or</span> s.count(<span class="string">'-'</span>) &gt; <span class="number">1</span> <span class="keyword">or</span> (s.count(<span class="string">'-'</span>) == <span class="number">1</span> <span class="keyword">and</span> <span class="keyword">not</span> s.startswith(<span class="string">'-'</span>)):</span><br><span class="line">        s = jiajianfajisuan(s)</span><br><span class="line">        <span class="keyword">return</span> s</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># print(cal(qukuohao(test_expression)))</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            e = input(<span class="string">'è¾“å…¥è®¡ç®—è¡¨è¾¾å¼&gt; '</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">'('</span> <span class="keyword">in</span> e:</span><br><span class="line">                print(cal(qukuohao(e)))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                print(cal(e))</span><br><span class="line">    <span class="keyword">except</span> KeyboardInterrupt:</span><br><span class="line">        print(<span class="string">'Bye'</span>)</span><br></pre></td></tr></table></figure>

<hr>
<p>å‚è€ƒæ–‡æ¡£ï¼š</p>
<ul>
<li><a href="http://wiki.ubuntu.org.cn/Pythonæ­£åˆ™è¡¨è¾¾å¼æ“ä½œæŒ‡å—" target="_blank" rel="noopener">http://wiki.ubuntu.org.cn/Pythonæ­£åˆ™è¡¨è¾¾å¼æ“ä½œæŒ‡å—</a></li>
<li><a href="http://www.cnblogs.com/wupeiqi/articles/5501365.html" target="_blank" rel="noopener">http://www.cnblogs.com/wupeiqi/articles/5501365.html</a></li>
</ul>
<p>åœ¨çº¿æ­£åˆ™åŒ¹é…å·¥å…·ï¼š</p>
<ul>
<li><a href="http://tool.chinaz.com/regex?jdfwkey=6iptw" target="_blank" rel="noopener">http://tool.chinaz.com/regex?jdfwkey=6iptw</a></li>
</ul>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>æ¨¡å—</tag>
        <tag>re</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonåå°„è¯¦è§£</title>
    <url>/2016/06/16/Python%E5%8F%8D%E5%B0%84%E8%AF%A6%E8%A7%A3/</url>
    <content><![CDATA[<blockquote>
<p>åå°„ï¼Œå¯ä»¥ç†è§£ä¸ºåˆ©ç”¨å­—ç¬¦ä¸²çš„å½¢å¼å»å¯¹è±¡ä¸­æ“ä½œæˆå‘˜å±æ€§å’Œæ–¹æ³•</p>
<p>åå°„çš„è¿™ç‚¹ç‰¹æ€§è®©æˆ‘è”æƒ³åˆ°äº†<code>exec</code>å‡½æ•°ï¼Œä¹Ÿæ˜¯æŠŠåˆ©ç”¨å­—ç¬¦ä¸²çš„å½¢å¼å»è®©Pythonè§£é‡Šå™¨å»æ‰§è¡Œå‘½ä»¤</p>
<p>Python Version: 3.5+</p>
</blockquote>
<p>è§£é‡ŠPythonçš„åå°„ï¼Œå…ˆæä¸€ä¸ªç®€å•çš„éœ€æ±‚ï¼Œç°åœ¨æˆ‘æœ‰ä¸€ä¸ªç®€æ˜“çš„ç½‘ç«™ï¼Œç”±ä¸¤ä¸ªæ–‡ä»¶ç»„æˆï¼Œä¸€ä¸ªæ˜¯å…·ä½“æ‰§è¡Œæ“ä½œçš„<code>commons.py</code>æ–‡ä»¶ï¼Œä¸€ä¸ªæ˜¯å…¥å£æ–‡ä»¶<code>index.py</code>ï¼Œç°åœ¨æˆ‘éœ€è¦åœ¨å…¥å£æ–‡ä»¶ä¸­è®¾ç½®ï¼Œè®©ç”¨æˆ·è¾“å…¥urlï¼Œæ ¹æ®ç”¨æˆ·è¾“å…¥çš„urlå»åç«¯æ‰§è¡Œç›¸åº”çš„æ“ä½œï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># commons.py</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'ç™»å½•é¡µé¢!'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">logout</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'é€€å‡ºé¡µé¢!'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'ä¸»é¡µé¢'</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># index.py</span></span><br><span class="line"><span class="keyword">import</span> commons</span><br><span class="line"></span><br><span class="line">inp = input(<span class="string">'url &gt; '</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> inp == <span class="string">'login'</span>:</span><br><span class="line">    commons.login()</span><br><span class="line"><span class="keyword">elif</span> inp == <span class="string">'logout'</span>:</span><br><span class="line">    commons.logout()</span><br><span class="line"><span class="keyword">elif</span> inp == <span class="string">'index'</span>:</span><br><span class="line">    commons.index()</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">'404'</span>)</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">url &gt; login</span><br><span class="line">ç™»å½•é¡µé¢!</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢æˆ‘ä½¿ç”¨äº†ifåˆ¤æ–­ï¼Œæ ¹æ®æ¯ä¸€ä¸ªurlè¯·æ±‚å»åç«¯æ‰§è¡ŒæŒ‡å®šçš„å‡½æ•°ã€‚é‚£ç°åœ¨æˆ‘çš„ç½‘ç«™å†…å®¹å˜å¤šäº†ï¼Œåœ¨<code>commons.py</code>ä¸­æœ‰100ä¸ªé¡µé¢æ“ä½œï¼Œé‚£ä¹ˆç›¸å¯¹åº”çš„æˆ‘åœ¨<code>index.py</code>ä¸­ä¹Ÿè¦ä½¿ç”¨if else å¯¹è¿™100ä¸ªé¡µé¢å‡½æ•°è¿›è¡Œæ‰‹åŠ¨æŒ‡å®šã€‚</p>
<p>æœ‰äº†PythonğŸåå°„çš„ç‰¹æ€§ï¼Œè¿™ä¸ªéœ€æ±‚å°±å˜å¾—å¼‚å¸¸ç®€å•äº†ï¼Œå…ˆä¸å¤šè§£é‡Šï¼Œå…ˆçœ‹ä»£ç (commons.pyä¿æŒæ–‡ä»¶ä¸å˜ï¼Œè¿˜æ˜¯æ‹¿ä¸‰ä¸ªé¡µé¢çš„æ“ä½œä¸¾ä¾‹ğŸŒ°)ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># index.py</span></span><br><span class="line"><span class="keyword">import</span> commons</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">()</span>:</span></span><br><span class="line">    inp = input(<span class="string">'url &gt; '</span>)</span><br><span class="line">    <span class="keyword">if</span> hasattr(commons, inp):</span><br><span class="line">        func = getattr(commons, inp)</span><br><span class="line">        func()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">'404'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    run()</span><br><span class="line">    </span><br><span class="line">------------</span><br><span class="line">url &gt; logout</span><br><span class="line">é€€å‡ºé¡µé¢!</span><br></pre></td></tr></table></figure>

<p>Look! Pythonçš„åå°„ç«‹äº†å¤§åŠŸï¼Œä½¿ç”¨è¿™å‡ è¡Œä»£ç ï¼Œå¯ä»¥åº”å¯¹<code>commons.py</code>æ–‡ä»¶ä¸­ä»»æ„å¤šä¸ªé¡µé¢å‡½æ•°çš„è°ƒç”¨ï¼æ¥ä¸‹æ¥æˆ‘ä»¬æ¥è¯¦ç»†ä»‹ç»Pythonåå°„ä¸­ç”¨åˆ°çš„å†…å»ºå‡½æ•°</p>
<h1 id="getattr"><a href="#getattr" class="headerlink" title="getattr()"></a>getattr()</h1><p>å…ˆçœ‹ä¸‹æºç ä¸­çš„è§£é‡Š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getattr</span><span class="params">(object, name, default=None)</span>:</span> <span class="comment"># known special case of getattr</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    getattr(object, name[, default]) -&gt; value</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    Get a named attribute from an object; getattr(x, 'y') is equivalent to x.y.</span></span><br><span class="line"><span class="string">    When a default argument is given, it is returned when the attribute doesn't</span></span><br><span class="line"><span class="string">    exist; without it, an exception is raised in that case.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<p><code>getattr()</code>å‡½æ•°æ‰§è¡ŒæˆåŠŸåä¼šå°†å‚æ•°ä¸­å¯¹è±¡ä¸­çš„æ–¹æ³•èµ‹å€¼ç»™æ–°çš„å˜é‡ï¼ˆä¼šè¿”å›å‚æ•°ä¸­æŒ‡å®šçš„å¯¹è±¡ä¸­çš„æ–¹æ³•ï¼‰ç›¸å½“äºå‚æ•°ä¸­çš„æ–¹æ³•åˆå¤šäº†ä¸€ä¸ªæ ˆåŒºçš„å˜é‡å»å¼•ç”¨</p>
<p><code>getattr()</code>å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°éœ€è¦æ˜¯ä¸ªå¯¹è±¡ï¼Œä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘å¯¼å…¥äº†è‡ªå®šä¹‰çš„commonsæ¨¡å—ï¼Œcommonså°±æ˜¯ä¸ªå¯¹è±¡ï¼›ç¬¬äºŒä¸ªå‚æ•°æ˜¯æŒ‡å®šå‰é¢å¯¹è±¡ä¸­çš„ä¸€ä¸ªæ–¹æ³•åç§°ã€‚<code>getattr(x, &#39;y&#39;)</code> ç­‰ä»·äºæ‰§è¡Œäº† <code>x.y</code>ã€‚å‡å¦‚ç¬¬äºŒä¸ªå‚æ•°è¾“å…¥äº†å‰é¢å¯¹è±¡ä¸­ä¸å­˜åœ¨çš„æ–¹æ³•ï¼Œè¯¥å‡½æ•°ä¼šæŠ›å‡ºå¼‚å¸¸å¹¶é€€å‡ºã€‚æ‰€ä»¥è¿™ä¸ªæ—¶å€™ï¼Œä¸ºäº†ç¨‹åºçš„å¥å£®æ€§ï¼Œæˆ‘ä»¬éœ€è¦å…ˆåˆ¤æ–­ä¸€ä¸‹è¯¥å¯¹è±¡ä¸­æœ‰æ²¡æœ‰è¿™ä¸ªæ–¹æ³•ï¼Œäºæ˜¯<code>hasattr()</code>å‡½æ•°ç™»åœºäº†~~</p>
<h1 id="hasattr"><a href="#hasattr" class="headerlink" title="hasattr()"></a>hasattr()</h1><p>è¿˜æ˜¯å…ˆçœ‹ä¸‹æºç çš„è§£é‡Š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hasattr</span><span class="params">(*args, **kwargs)</span>:</span> <span class="comment"># real signature unknown</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Return whether the object has an attribute with the given name.</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    This is done by calling getattr(obj, name) and catching AttributeError.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<p><code>hasattr()</code>å‡½æ•°è¿”å›å¯¹è±¡æ˜¯å¦æ‹¥æœ‰æŒ‡å®šåç§°çš„å±æ€§ï¼Œç®€å•çš„è¯´å°±æ˜¯æ£€æŸ¥åœ¨ç¬¬ä¸€ä¸ªå‚æ•°çš„å¯¹è±¡ä¸­ï¼Œèƒ½å¦æ‰¾åˆ°ä¸ç¬¬äºŒå‚æ•°åç›¸åŒçš„æ–¹æ³•ã€‚æºç çš„è§£é‡Šè¿˜è¯´ï¼Œè¯¥å‡½æ•°çš„å®ç°å…¶å®å°±æ˜¯è°ƒç”¨äº†<code>getattr()</code>å‡½æ•°ï¼Œåªä¸è¿‡å®ƒæ•è·äº†å¼‚å¸¸è€Œå·²ã€‚æ‰€ä»¥é€šè¿‡è¿™ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆå»åˆ¤æ–­å¯¹è±¡ä¸­æœ‰æ²¡æœ‰è¿™ä¸ªæ–¹æ³•ï¼Œæœ‰åˆ™ä½¿ç”¨<code>getattr()</code>æ¥è·å–è¯¥æ–¹æ³•ã€‚</p>
<h1 id="delattr"><a href="#delattr" class="headerlink" title="delattr()"></a>delattr()</h1><p>åˆ é™¤æŒ‡å®šå¯¹è±¡ä¸­çš„æŒ‡å®šæ–¹æ³•ï¼Œç‰¹åˆ«æç¤ºï¼šåªæ˜¯åœ¨æœ¬æ¬¡è¿è¡Œç¨‹åºçš„å†…å­˜ä¸­å°†è¯¥æ–¹æ³•åˆ é™¤ï¼Œå¹¶æ²¡æœ‰å½±å“åˆ°æ–‡ä»¶çš„å†…å®¹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> commons</span><br><span class="line"></span><br><span class="line">print(dir(commons))</span><br><span class="line">delattr(commons, <span class="string">'index'</span>)</span><br><span class="line">print(dir(commons))</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">[<span class="string">'__builtins__'</span>, <span class="string">'__cached__'</span>, <span class="string">'__doc__'</span>, <span class="string">'__file__'</span>, <span class="string">'__loader__'</span>, <span class="string">'__name__'</span>, <span class="string">'__package__'</span>, <span class="string">'__spec__'</span>, <span class="string">'index'</span>, <span class="string">'login'</span>, <span class="string">'logout'</span>]</span><br><span class="line">[<span class="string">'__builtins__'</span>, <span class="string">'__cached__'</span>, <span class="string">'__doc__'</span>, <span class="string">'__file__'</span>, <span class="string">'__loader__'</span>, <span class="string">'__name__'</span>, <span class="string">'__package__'</span>, <span class="string">'__spec__'</span>, <span class="string">'login'</span>, <span class="string">'logout'</span>]</span><br></pre></td></tr></table></figure>

<h1 id="setattr"><a href="#setattr" class="headerlink" title="setattr()"></a>setattr()</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">setattr</span><span class="params">(x, y, v)</span>:</span> <span class="comment"># real signature unknown; restored from __doc__</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Sets the named attribute on the given object to the specified value.</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    setattr(x, 'y', v) is equivalent to ``x.y = v''</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<p><code>setattr()</code>å‡½æ•°ç”¨æ¥ç»™æŒ‡å®šå¯¹è±¡ä¸­çš„æ–¹æ³•é‡æ–°èµ‹å€¼ï¼ˆå°†æ–°çš„å‡½æ•°ä½“/æ–¹æ³•ä½“èµ‹å€¼ç»™æŒ‡å®šçš„å¯¹è±¡åï¼‰ä»…åœ¨æœ¬æ¬¡ç¨‹åºè¿è¡Œçš„å†…å­˜ä¸­ç”Ÿæ•ˆã€‚<code>setattr(x, &#39;y&#39;, v)</code> ç­‰ä»·äº <code>x.y = v</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> commons</span><br><span class="line"></span><br><span class="line">commons.index()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">newindex</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'new ä¸»é¡µé¢!'</span>)</span><br><span class="line"></span><br><span class="line">setattr(commons, <span class="string">'index'</span>, newindex)</span><br><span class="line"></span><br><span class="line">commons.index()</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">ä¸»é¡µé¢</span><br><span class="line">new ä¸»é¡µé¢!</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="import"><a href="#import" class="headerlink" title="__import__"></a>__import__</h1><p>å¥½çš„ï¼Œç½‘ç«™å‘å±•è‡³ä»Šï¼ŒåŠŸèƒ½æœ‰äº†å¾ˆå¤šçš„æ‰©å±•ï¼Œç°åœ¨ä¸€ä¸ªåå°æ–‡ä»¶å·²ç»ä¸èƒ½æ»¡è¶³æˆ‘çš„éœ€æ±‚ï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦æ ¹æ®èŒèƒ½åˆ’åˆ†åå°æ–‡ä»¶ï¼Œç°åœ¨æˆ‘åˆæ–°å¢äº†ä¸€ä¸ª<code>account.py</code>è¿™ä¸ªç”¨æˆ·ç®¡ç†ç±»çš„æ–‡ä»¶ï¼Œä¹Ÿéœ€è¦å¯¼å…¥åˆ°é¦–é¡µä»¥å¤‡è°ƒç”¨ã€‚</p>
<p>è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘çš„é¦–é¡µé€šè¿‡åå°„ï¼Œåªèƒ½æŒ‡å®š<code>commons</code>æ¨¡å—çš„æ–¹æ³•ä»»æ„è°ƒç”¨ï¼Œç°åœ¨æ–°å¢äº†<code>account</code>æ¨¡å—ï¼Œæ˜¯ä¸æ˜¯æˆ‘åˆè¦åŠ å…¥ifå»åˆ¤æ–­å•¦ï¼Ÿä¸ç”¨ï¼Pythonå·²ç»å¸®æˆ‘ä»¬æƒ³åˆ°è¿™ä¸€ç‚¹äº†ï¼æœ€åæ¬å‡º<code>__import__</code>è¿™ä¸ªå¤§æ•‘æ˜Ÿã€‚</p>
<p>ç”±äºæ¨¡å—çš„å¯¼å…¥ä¹Ÿéœ€è¦ä½¿ç”¨Pythonåå°„çš„ç‰¹æ€§ï¼Œæ‰€ä»¥æ¨¡å—åä¹Ÿè¦åŠ å…¥åˆ°urlä¸­ï¼Œæ‰€ä»¥ç°åœ¨urlè¯·æ±‚å˜æˆäº†ç±»ä¼¼äº<code>commons/index</code>çš„å½¢å¼</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># account.py</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_user</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'æ·»åŠ ç”¨æˆ·'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">del_user</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'åˆ é™¤ç”¨æˆ·'</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># commons.py</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'ç™»å½•é¡µé¢!'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">logout</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'é€€å‡ºé¡µé¢!'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'ä¸»é¡µé¢'</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># index.py</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">()</span>:</span></span><br><span class="line">    inp = input(<span class="string">'url &gt; '</span>)</span><br><span class="line">    m, f = inp.split(<span class="string">'/'</span>)</span><br><span class="line">    obj_module = __import__(m)</span><br><span class="line">    <span class="keyword">if</span> hasattr(obj_module, f):</span><br><span class="line">        func = getattr(obj_module, f)</span><br><span class="line">        func()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">'404'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    run()</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ‰§è¡Œ</span></span><br><span class="line"><span class="comment"># python3 index.py</span></span><br><span class="line">url &gt; account/add_user</span><br><span class="line">æ·»åŠ ç”¨æˆ·</span><br><span class="line"></span><br><span class="line"><span class="comment"># python3 index.py</span></span><br><span class="line">url &gt; commons/login</span><br><span class="line">ç™»å½•é¡µé¢!</span><br></pre></td></tr></table></figure>

<p>èƒ½ä½“ä¼šåˆ°<code>__import__</code>çš„ä½œç”¨äº†å—ï¼Œå°±æ˜¯æŠŠå­—ç¬¦ä¸²å½“åšæ¨¡å—å»å¯¼å…¥ã€‚<code>import &#39;sys&#39;</code> å’Œ <code>import sys</code> æ˜¯ä¸ä¸€æ ·çš„ï¼Œä¸ä¿¡ä½ æ‰§è¡Œä¸€ä¸‹~~è¦æƒ³å¯¼å…¥å­—ç¬¦ä¸²<code>&#39;sys&#39;</code>åªèƒ½é€šè¿‡<code>__import__(&#39;sys&#39;)</code>çš„æ–¹å¼å¯¼å…¥</p>
<p>ç­‰ç­‰ï¼Œè¿˜æ²¡å®Œï¼Œæˆ‘çš„ç½‘ç«™è¿›ä¸€æ­¥ç»†åŒ–åˆ†å·¥ï¼Œç°åœ¨åˆå¤šäº†ä¸€å±‚ç›®å½•ç»“æ„ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">|- index.py</span><br><span class="line">|- commons.py</span><br><span class="line">|- account.py</span><br><span class="line">|- lib</span><br><span class="line">	|- __init__.py</span><br><span class="line">	|- connectdb.py</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æˆ‘æƒ³åœ¨<code>index</code>é¡µé¢ä¸­è°ƒç”¨<code>lib</code>åŒ…ä¸‹<code>connectdb</code>æ¨¡å—ä¸­çš„æ–¹æ³•ï¼Œè¿˜æ˜¯ç”¨ä¹‹å‰çš„æ–¹å¼è°ƒç”¨å¯ä»¥å—ï¼Ÿæˆ‘ä»¬è¯•ä¸€ä¸‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">()</span>:</span></span><br><span class="line">    inp = input(<span class="string">'url &gt; '</span>)</span><br><span class="line">    m, f = inp.split(<span class="string">'/'</span>)</span><br><span class="line">    obj_module = __import__(<span class="string">'lib.'</span> + m)</span><br><span class="line">    <span class="keyword">if</span> hasattr(obj_module, f):</span><br><span class="line">        func = getattr(obj_module, f)</span><br><span class="line">        func()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">'404'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    run()</span><br><span class="line">    </span><br><span class="line">------------</span><br><span class="line"><span class="number">404</span></span><br></pre></td></tr></table></figure>

<p>å“å‘¦ï¼Œä¸è¡Œå•Šã€‚ä¸Šé¢æˆ‘ä¸ºäº†æµ‹è¯•è°ƒç”¨libä¸‹çš„æ¨¡å—ï¼ŒæŠ›å¼ƒäº†å¯¹æ‰€æœ‰åŒçº§ç›®å½•æ¨¡å—çš„æ”¯æŒï¼Œå¯è¿˜æ˜¯ä¸è¡Œï¼Œå±…ç„¶æ‰¾ä¸åˆ°è¿™ä¸ªè¿™ä¸ªæ¨¡å—çš„è¿™ä¸ªæ–¹æ³•ã€‚è¿˜æ˜¯æ¥çœ‹ä¸‹æºç æ˜¯æ€ä¹ˆè¯´çš„ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__import__</span><span class="params">(name, globals=None, locals=None, fromlist=<span class="params">()</span>, level=<span class="number">0</span>)</span>:</span> <span class="comment"># real signature unknown; restored from __doc__</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    __import__(name, globals=None, locals=None, fromlist=(), level=0) -&gt; module</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    Import a module. Because this function is meant for use by the Python</span></span><br><span class="line"><span class="string">    interpreter and not for general use it is better to use</span></span><br><span class="line"><span class="string">    importlib.import_module() to programmatically import a module.</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    The globals argument is only used to determine the context;</span></span><br><span class="line"><span class="string">    they are not modified.  The locals argument is unused.  The fromlist</span></span><br><span class="line"><span class="string">    should be a list of names to emulate ``from name import ...'', or an</span></span><br><span class="line"><span class="string">    empty list to emulate ``import name''.</span></span><br><span class="line"><span class="string">    When importing a module from a package, note that __import__('A.B', ...)</span></span><br><span class="line"><span class="string">    returns package A when fromlist is empty, but its submodule B when</span></span><br><span class="line"><span class="string">    fromlist is not empty.  Level is used to determine whether to perform </span></span><br><span class="line"><span class="string">    absolute or relative imports. 0 is absolute while a positive number</span></span><br><span class="line"><span class="string">    is the number of parent directories to search relative to the current module.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<p><code>__import__</code>å‡½æ•°ä¸­æœ‰ä¸€ä¸ª<code>fromlist</code>å‚æ•°ï¼Œæºç è§£é‡Šè¯´ï¼Œå¦‚æœåœ¨ä¸€ä¸ªåŒ…ä¸­å¯¼å…¥ä¸€ä¸ªæ¨¡å—ï¼Œè¿™ä¸ªå‚æ•°å¦‚æœä¸ºç©ºï¼Œåˆ™returnè¿™ä¸ªåŒ…å¯¹è±¡ï¼Œå¦‚æœè¿™ä¸ªå‚æ•°ä¸ä¸ºç©ºï¼Œåˆ™è¿”å›åŒ…ä¸‹é¢æŒ‡å®šçš„æ¨¡å—å¯¹è±¡ï¼Œäºæ˜¯åšå‡ºå¦‚ä¸‹ä¿®æ”¹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">()</span>:</span></span><br><span class="line">    inp = input(<span class="string">'url &gt; '</span>)</span><br><span class="line">    m, f = inp.split(<span class="string">'/'</span>)</span><br><span class="line">    obj_module = __import__(<span class="string">'lib.'</span> + m, fromlist=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">if</span> hasattr(obj_module, f):</span><br><span class="line">        func = getattr(obj_module, f)</span><br><span class="line">        func()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">'404'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    run()</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">url &gt; connectdb/mysql</span><br><span class="line">å·²è¿æ¥mysql</span><br></pre></td></tr></table></figure>

<p>æˆåŠŸäº†~~ ä½†æ˜¯ä¸ºäº†è¿™æ¬¡æˆåŠŸï¼Œæˆ‘å†™æ­»äº†libå‰ç¼€ï¼Œç›¸å½“äºæŠ›å¼ƒäº†commonså’Œaccountä¸¤ä¸ªå¯¼å…¥çš„åŠŸèƒ½ï¼Œæ‰€ä»¥ä»¥ä¸Šä»£ç å¹¶ä¸å®Œå–„ï¼Œéœ€æ±‚å¤æ‚åï¼Œè¿˜æ˜¯éœ€è¦å¯¹è¯·æ±‚çš„urlåšä¸€ä¸‹åˆ¤æ–­</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">()</span>:</span></span><br><span class="line">    inp = input(<span class="string">'url &gt; '</span>)</span><br><span class="line">    <span class="keyword">if</span> len(inp.split(<span class="string">'/'</span>)) == <span class="number">2</span>:</span><br><span class="line">        m, f = inp.split(<span class="string">'/'</span>)</span><br><span class="line">        obj_module = __import__(m)</span><br><span class="line">        <span class="keyword">if</span> hasattr(obj_module, f):</span><br><span class="line">            func = getattr(obj_module, f)</span><br><span class="line">            func()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">'404'</span>)</span><br><span class="line">    <span class="keyword">elif</span> len(inp.split(<span class="string">'/'</span>)) == <span class="number">3</span>:</span><br><span class="line">        p, m, f = inp.split(<span class="string">'/'</span>)</span><br><span class="line">        obj_module = __import__(p + <span class="string">'.'</span> + m, fromlist=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">if</span> hasattr(obj_module, f):</span><br><span class="line">            func = getattr(obj_module, f)</span><br><span class="line">            func()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">'404'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    run()</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ‰§è¡Œ</span></span><br><span class="line"><span class="comment"># python3 index.py</span></span><br><span class="line">url &gt; lib/connectdb/mysql</span><br><span class="line">å·²è¿æ¥mysql</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># python3 index.py</span></span><br><span class="line">url &gt; account/del_user</span><br><span class="line">åˆ é™¤ç”¨æˆ·</span><br></pre></td></tr></table></figure>

<p>è™½ç„¶é‡å¤ä»£ç é‡ä¸é«˜ï¼Œä½†æˆ‘ä»¬ä»è¦æœ‰ä¸€é¢—æ¶ˆé™¤é‡å¤ä»£ç çš„â¤ï¸</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">if</span> len(inp.split(<span class="string">'/'</span>)) == <span class="number">2</span>:</span><br><span class="line">        m, f = inp.split(<span class="string">'/'</span>)</span><br><span class="line">        obj_module = __import__(m)</span><br><span class="line">        getf(obj_module, f)</span><br><span class="line">    <span class="keyword">elif</span> len(inp.split(<span class="string">'/'</span>)) == <span class="number">3</span>:</span><br><span class="line">        p, m, f = inp.split(<span class="string">'/'</span>)</span><br><span class="line">        obj_module = __import__(p + <span class="string">'.'</span> + m, fromlist=<span class="literal">True</span>)</span><br><span class="line">        getf(obj_module, f)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getf</span><span class="params">(m, f)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> hasattr(m, f):</span><br><span class="line">        func = getattr(m, f)</span><br><span class="line">        func()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">'404'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    inp = input(<span class="string">'url &gt; '</span>)</span><br><span class="line">    run()</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>åå°„</tag>
      </tags>
  </entry>
  <entry>
    <title>PythonåŠ å¯†æ¨¡å—</title>
    <url>/2016/06/15/Python%E5%8A%A0%E5%AF%86%E6%A8%A1%E5%9D%97hashlibx/</url>
    <content><![CDATA[<blockquote>
<p>Pythonä¸­çš„hashlibå’ŒhmacåŠ å¯†æ¨¡å—éƒ½æ˜¯å†…ç½®æ¨¡å—ï¼Œå¯ä»¥æ–¹ä¾¿çš„è¿›è¡Œå­—ç¬¦ä¸²åŠ å¯†ï¼Œè¿™äº›åŠ å¯†éƒ½æ˜¯å•å‘çš„ï¼ŒåŠ å¯†åçš„å­—ç¬¦ä¸²ä¸å¯åè§£æˆåŸå­—ç¬¦ä¸²ã€‚ä½†æ˜¯ç”±äºæŸä¸ªå›ºå®šçš„å­—ç¬¦ä¸²ä½¿ç”¨æŸä¸ªå›ºå®šçš„ç®—æ³•å¾—å‡ºçš„åŠ å¯†ä¸²æ˜¯å›ºå®šçš„ï¼Œæ‰€ä»¥æœ‰é€šè¿‡æ’åº“æ¥åè§£å‡ºå¯†ç çš„å±é™©</p>
<p>Python Version: 3.5+</p>
</blockquote>
<h1 id="hashlibæ¨¡å—"><a href="#hashlibæ¨¡å—" class="headerlink" title="hashlibæ¨¡å—"></a>hashlibæ¨¡å—</h1><h2 id="md5"><a href="#md5" class="headerlink" title="md5"></a>md5</h2><p>hashlibæ¨¡å—ç”¨äºåŠ å¯†ç›¸å…³çš„æ“ä½œï¼Œä»£æ›¿äº†md5æ¨¡å—å’Œshaæ¨¡å—ï¼Œä¸»è¦æä¾› SHA1, SHA224, SHA256, SHA384, SHA512 ï¼ŒMD5 ç®—æ³•</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"><span class="comment"># md5</span></span><br><span class="line"><span class="comment"># åˆ›å»ºmd5å¯¹è±¡</span></span><br><span class="line">hash = hashlib.md5()</span><br><span class="line"><span class="comment"># updateæ–¹æ³•æ¥æ”¶ä¸€ä¸ªå­—èŠ‚ç±»å‹çš„æ•°æ®æ˜¯Python3+ä¸­çš„å¼ºåˆ¶è¦æ±‚</span></span><br><span class="line">hash.update(bytes(<span class="string">'polarsnow'</span>, encoding=<span class="string">'utf8'</span>))</span><br><span class="line"><span class="comment"># è¿”å›ä¸€ä¸ªåå…­è¿›åˆ¶çš„å­—ç¬¦ä¸²</span></span><br><span class="line">print(hash.hexdigest())</span><br><span class="line"><span class="comment"># è¿”å›ä¸€ä¸ªäºŒè¿›åˆ¶çš„å­—ç¬¦ä¸²</span></span><br><span class="line">print(hash.digest())</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line"><span class="number">72</span>c5c8f4fcfeb39c1ebce3be56ebb9f8</span><br><span class="line"><span class="string">b'r\xc5\xc8\xf4\xfc\xfe\xb3\x9c\x1e\xbc\xe3\xbeV\xeb\xb9\xf8'</span></span><br></pre></td></tr></table></figure>

<h2 id="sha1"><a href="#sha1" class="headerlink" title="sha1"></a>sha1</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"><span class="comment"># sha1</span></span><br><span class="line"><span class="comment"># åˆ›å»ºsha1å¯¹è±¡</span></span><br><span class="line">hash = hashlib.sha1()</span><br><span class="line"><span class="comment"># æŒ‰ç…§æŒ‡å®šçš„å­—ç¬¦ç¼–ç åŠ å¯†å­—ç¬¦ä¸²</span></span><br><span class="line">hash.update(bytes(<span class="string">'polarsnow'</span>, encoding=<span class="string">'utf8'</span>))</span><br><span class="line">print(hash.hexdigest())</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line"><span class="number">299</span>a06d4672c5a57facee0cf132593132084a3c0</span><br></pre></td></tr></table></figure>

<h2 id="sha256"><a href="#sha256" class="headerlink" title="sha256"></a>sha256</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"><span class="comment"># sha256</span></span><br><span class="line">hash = hashlib.sha256()</span><br><span class="line">hash.update(bytes(<span class="string">'polarsnow'</span>, encoding=<span class="string">'utf8'</span>))</span><br><span class="line">print(hash.hexdigest())</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">f379eefa6d3a0447d807d679dbd02f0593e8b3c3377da53dd909d98b4dcac9ad</span><br></pre></td></tr></table></figure>

<h2 id="sha384"><a href="#sha384" class="headerlink" title="sha384"></a>sha384</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"><span class="comment"># sha384</span></span><br><span class="line">hash = hashlib.sha384()</span><br><span class="line">hash.update(bytes(<span class="string">'polarsnow'</span>, encoding=<span class="string">'utf8'</span>))</span><br><span class="line">print(hash.hexdigest())</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line"><span class="number">768e16</span>e89a691905e7e2413fc67ba2846a39a3d2dd064a7930eb54c36e58a2694b5bf57ca7bb52cea0ad33feaf718ad6</span><br></pre></td></tr></table></figure>

<h2 id="sha512"><a href="#sha512" class="headerlink" title="sha512"></a>sha512</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"><span class="comment"># sha512</span></span><br><span class="line">hash = hashlib.sha512()</span><br><span class="line">hash.update(bytes(<span class="string">'polarsnow'</span>, encoding=<span class="string">'utf8'</span>))</span><br><span class="line">print(hash.hexdigest())</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">ef510ae0c752261359b87e8260b1a8d90a1d9bc373fd5a107e091e9340d60877909b1e7996c32ecb5a571378815aa524e284a65d7d91d33b8fe29f1376ff048e</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="è‡ªå®šä¹‰keyåŠ å¯†"><a href="#è‡ªå®šä¹‰keyåŠ å¯†" class="headerlink" title="è‡ªå®šä¹‰keyåŠ å¯†"></a>è‡ªå®šä¹‰keyåŠ å¯†</h2><p>ä¸Šé¢çš„åŠ å¯†ç®—æ³•è™½ç„¶å·²ç»è¶³å¤Ÿå¼ºå¤§ï¼Œä½†æ˜¯è¿˜æ˜¯å­˜åœ¨ç¼ºé™·ï¼Œå³å¯ä»¥é€šè¿‡æ’åº“åè§£å¯†ç ã€‚æ‰€ä»¥ï¼Œæœ‰å¿…è¦å¯¹åŠ å¯†ç®—æ³•ä¸­æ·»åŠ è‡ªå®šä¹‰keyå†æ¥åšåŠ å¯†ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"><span class="comment"># md5</span></span><br><span class="line">hash = hashlib.md5(bytes(<span class="string">'9ol4rfv'</span>, encoding=<span class="string">'utf8'</span>))</span><br><span class="line">hash.update(bytes(<span class="string">'polarsnow'</span>, encoding=<span class="string">'utf8'</span>))</span><br><span class="line"><span class="comment"># è¿”å›ä¸€ä¸ªåå…­è¿›åˆ¶çš„å­—ç¬¦ä¸²</span></span><br><span class="line">print(hash.hexdigest()</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line"><span class="number">6e4257</span>d3855aaf563ce5c8d499156137</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="hmacæ¨¡å—"><a href="#hmacæ¨¡å—" class="headerlink" title="hmacæ¨¡å—"></a>hmacæ¨¡å—</h1><p>hmac æ¨¡å—ï¼Œå®ƒå†…éƒ¨å¯¹æˆ‘ä»¬åˆ›å»º key å’Œ å†…å®¹ è¿›è¡Œè¿›ä¸€æ­¥çš„å¤„ç†ç„¶åå†åŠ å¯†</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> hmac</span><br><span class="line"></span><br><span class="line">h = hmac.new(bytes(<span class="string">'9ol4rfv'</span>, encoding=<span class="string">"utf-8"</span>))</span><br><span class="line">h.update(bytes(<span class="string">'polarsnow'</span>, encoding=<span class="string">"utf-8"</span>))</span><br><span class="line">print(h.hexdigest())</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line"><span class="number">2</span>d7acf84247e563213d0ec8e325831ba</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>æ¨¡å—</tag>
        <tag>hashlib</tag>
        <tag>hmac</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonç³»ç»Ÿæ¨¡å—</title>
    <url>/2016/06/15/Python%E7%B3%BB%E7%BB%9F%E6%A8%A1%E5%9D%97/</url>
    <content><![CDATA[<blockquote>
<p>Pythonä¸‹æœ‰ä¸¤ä¸ªç³»ç»Ÿæ¨¡å—<code>sys</code> <code>os</code>ï¼Œ<code>sys</code>æ¨¡å—ç”¨äºæä¾›å¯¹Pythonè§£é‡Šå™¨ç›¸å…³çš„æ“ä½œï¼›<code>os</code>æ¨¡å—ç”¨äºæä¾›ç³»ç»Ÿçº§åˆ«çš„æ“ä½œ</p>
<p>Python Version: 3.5+</p>
</blockquote>
<h1 id="sys"><a href="#sys" class="headerlink" title="sys"></a>sys</h1><p>sysæ¨¡å—ä¸­å¸¸ç”¨çš„å‡½æ•°</p>
<ul>
<li>sys.argv           å‘½ä»¤è¡Œå‚æ•°Listï¼Œç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯ç¨‹åºæœ¬èº«è·¯å¾„</li>
<li>sys.exit(n)        é€€å‡ºç¨‹åºï¼Œæ­£å¸¸é€€å‡ºæ—¶exit(0)</li>
<li>sys.version        è·å–Pythonè§£é‡Šç¨‹åºçš„ç‰ˆæœ¬ä¿¡æ¯</li>
<li>sys.maxint         æœ€å¤§çš„Intå€¼</li>
<li>sys.path           è¿”å›æ¨¡å—çš„æœç´¢è·¯å¾„ï¼Œåˆå§‹åŒ–æ—¶ä½¿ç”¨PYTHONPATHç¯å¢ƒå˜é‡çš„å€¼</li>
<li>sys.platform       è¿”å›æ“ä½œç³»ç»Ÿå¹³å°åç§°</li>
<li>sys.stdin          è¾“å…¥ç›¸å…³</li>
<li>sys.stdout         è¾“å‡ºç›¸å…³</li>
<li>sys.stderror       é”™è¯¯ç›¸å…³</li>
</ul>
<h1 id="os"><a href="#os" class="headerlink" title="os"></a>os</h1><ul>
<li>os.getcwd()                 è·å–å½“å‰å·¥ä½œç›®å½•ï¼Œå³å½“å‰pythonè„šæœ¬å·¥ä½œçš„ç›®å½•è·¯å¾„</li>
<li>os.chdir(â€œdirnameâ€)         æ”¹å˜å½“å‰è„šæœ¬å·¥ä½œç›®å½•ï¼›ç›¸å½“äºshellä¸‹cd</li>
<li>os.curdir                   è¿”å›å½“å‰ç›®å½•: (â€˜.â€™)</li>
<li>os.pardir                   è·å–å½“å‰ç›®å½•çš„çˆ¶ç›®å½•å­—ç¬¦ä¸²åï¼š(â€˜..â€™)</li>
<li>os.makedirs(â€˜dir1/dir2â€™)    å¯ç”Ÿæˆå¤šå±‚é€’å½’ç›®å½•</li>
<li>os.removedirs(â€˜dirname1â€™)   è‹¥ç›®å½•ä¸ºç©ºï¼Œåˆ™åˆ é™¤ï¼Œå¹¶é€’å½’åˆ°ä¸Šä¸€çº§ç›®å½•ï¼Œå¦‚è‹¥ä¹Ÿä¸ºç©ºï¼Œåˆ™åˆ é™¤ï¼Œä¾æ­¤ç±»æ¨</li>
<li>os.mkdir(â€˜dirnameâ€™)         ç”Ÿæˆå•çº§ç›®å½•ï¼›ç›¸å½“äºshellä¸­mkdir dirname</li>
<li>os.rmdir(â€˜dirnameâ€™)         åˆ é™¤å•çº§ç©ºç›®å½•ï¼Œè‹¥ç›®å½•ä¸ä¸ºç©ºåˆ™æ— æ³•åˆ é™¤ï¼ŒæŠ¥é”™ï¼›ç›¸å½“äºshellä¸­rmdir dirname</li>
<li>os.listdir(â€˜dirnameâ€™)       åˆ—å‡ºæŒ‡å®šç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å’Œå­ç›®å½•ï¼ŒåŒ…æ‹¬éšè—æ–‡ä»¶ï¼Œå¹¶ä»¥åˆ—è¡¨æ–¹å¼æ‰“å°</li>
<li>os.remove()                 åˆ é™¤ä¸€ä¸ªæ–‡ä»¶</li>
<li>os.rename(â€œoldnameâ€,â€newâ€)  é‡å‘½åæ–‡ä»¶/ç›®å½•</li>
<li>os.stat(â€˜path/filenameâ€™)    è·å–æ–‡ä»¶/ç›®å½•ä¿¡æ¯</li>
<li>os.sep                      æ“ä½œç³»ç»Ÿç‰¹å®šçš„è·¯å¾„åˆ†éš”ç¬¦ï¼Œwinä¸‹ä¸ºâ€\â€œ,Linuxä¸‹ä¸ºâ€/â€œ</li>
<li>os.linesep                  å½“å‰å¹³å°ä½¿ç”¨çš„è¡Œç»ˆæ­¢ç¬¦ï¼Œwinä¸‹ä¸ºâ€\t\nâ€,Linuxä¸‹ä¸ºâ€\nâ€</li>
<li>os.pathsep                  ç”¨äºåˆ†å‰²æ–‡ä»¶è·¯å¾„çš„å­—ç¬¦ä¸²</li>
<li>os.name                     å­—ç¬¦ä¸²æŒ‡ç¤ºå½“å‰ä½¿ç”¨å¹³å°ã€‚win-&gt;â€™ntâ€™; Linux-&gt;â€™posixâ€™</li>
<li>os.system(â€œbash commandâ€)   è¿è¡Œshellå‘½ä»¤ï¼Œç›´æ¥æ˜¾ç¤º</li>
<li>os.environ                  è·å–ç³»ç»Ÿç¯å¢ƒå˜é‡</li>
<li>os.path.abspath(path)       è¿”å›pathè§„èŒƒåŒ–çš„ç»å¯¹è·¯å¾„</li>
<li>os.path.split(path)         å°†pathåˆ†å‰²æˆç›®å½•å’Œæ–‡ä»¶åäºŒå…ƒç»„è¿”å›</li>
<li>os.path.dirname(path)       è¿”å›pathçš„ç›®å½•ã€‚å…¶å®å°±æ˜¯os.path.split(path)çš„ç¬¬ä¸€ä¸ªå…ƒç´ </li>
<li>os.path.basename(path)      è¿”å›pathæœ€åçš„æ–‡ä»¶åã€‚å¦‚ä½•pathä»¥ï¼æˆ–\ç»“å°¾ï¼Œé‚£ä¹ˆå°±ä¼šè¿”å›ç©ºå€¼ã€‚å³os.path.split(path)çš„ç¬¬äºŒä¸ªå…ƒç´ </li>
<li>os.path.exists(path)        å¦‚æœpathå­˜åœ¨ï¼Œè¿”å›Trueï¼›å¦‚æœpathä¸å­˜åœ¨ï¼Œè¿”å›False</li>
<li>os.path.isabs(path)         å¦‚æœpathæ˜¯ç»å¯¹è·¯å¾„ï¼Œè¿”å›True</li>
<li>os.path.isfile(path)        å¦‚æœpathæ˜¯ä¸€ä¸ªå­˜åœ¨çš„æ–‡ä»¶ï¼Œè¿”å›Trueã€‚å¦åˆ™è¿”å›False</li>
<li>os.path.isdir(path)         å¦‚æœpathæ˜¯ä¸€ä¸ªå­˜åœ¨çš„ç›®å½•ï¼Œåˆ™è¿”å›Trueã€‚å¦åˆ™è¿”å›False</li>
<li>os.path.join(path1[, path2[, â€¦]])  å°†å¤šä¸ªè·¯å¾„ç»„åˆåè¿”å›ï¼Œç¬¬ä¸€ä¸ªç»å¯¹è·¯å¾„ä¹‹å‰çš„å‚æ•°å°†è¢«å¿½ç•¥</li>
<li>os.path.getatime(path)      è¿”å›pathæ‰€æŒ‡å‘çš„æ–‡ä»¶æˆ–è€…ç›®å½•çš„æœ€åå­˜å–æ—¶é—´</li>
<li>os.path.getmtime(path)      è¿”å›pathæ‰€æŒ‡å‘çš„æ–‡ä»¶æˆ–è€…ç›®å½•çš„æœ€åä¿®æ”¹æ—¶é—´</li>
</ul>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>æ¨¡å—</tag>
        <tag>os</tag>
        <tag>sys</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonå®ç°ç»ˆç«¯ä¸‹çš„è¿›åº¦æ¡</title>
    <url>/2016/06/15/Python%E5%AE%9E%E7%8E%B0%E7%BB%88%E7%AB%AF%E4%B8%8B%E7%9A%84%E8%BF%9B%E5%BA%A6%E6%9D%A1/</url>
    <content><![CDATA[<blockquote>
<p>æœ¬ç¯‡æ–‡ç« ä»‹ç»åœ¨Pythonä¸‹å®ç°è¿›åº¦æ¡çš„å‡ ç§æ–¹æ³•</p>
<p>Python Version: 3.5+</p>
</blockquote>
<h1 id="ç¬¬ä¸€ç§ï¼šç®€å•çš„å­—ç¬¦æ‹¼æ¥"><a href="#ç¬¬ä¸€ç§ï¼šç®€å•çš„å­—ç¬¦æ‹¼æ¥" class="headerlink" title="ç¬¬ä¸€ç§ï¼šç®€å•çš„å­—ç¬¦æ‹¼æ¥"></a>ç¬¬ä¸€ç§ï¼šç®€å•çš„å­—ç¬¦æ‹¼æ¥</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–ç»ˆç«¯çš„å®½åº¦</span></span><br><span class="line">w = os.get_terminal_size().columns</span><br><span class="line"><span class="comment"># -5ä¸ªå­—ç¬¦æ˜¯ä¸ºäº†ä¸ºåé¢'&gt;100%'ç•™åœ°æ–¹</span></span><br><span class="line"><span class="comment"># æ‰€ä»¥'-'æ‰€å ç”¨çš„æœ€å¤§å®½åº¦ä¸ºæ€»ç»ˆç«¯å®½åº¦-5</span></span><br><span class="line"><span class="comment"># ç„¶åè®¡ç®—å‡ºæ¯å¢é•¿1%éœ€è¦å¢é•¿å‡ ä¸ª'-'å­—ç¬¦</span></span><br><span class="line">item = (w - <span class="number">5</span>) / <span class="number">100</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">view_bar</span><span class="params">(num, total)</span>:</span></span><br><span class="line">	<span class="comment"># è®¡ç®—å‡ºè¿›åº¦ç™¾åˆ†æ¯”</span></span><br><span class="line">    rate = num / total</span><br><span class="line">    rate_num = int(rate * <span class="number">100</span>)</span><br><span class="line">    <span class="comment"># int(rate_num*item) æ ¹æ®å½“å‰è¿›åº¦è®¡ç®—å‡ºéœ€è¦å¤šå°‘ä¸ª'-'å­—ç¬¦ï¼ˆå–æ•´æ•°ï¼‰å­—ç¬¦ä¸²ä¸­çš„\ræ˜¯å¿…é¡»å­˜åœ¨çš„</span></span><br><span class="line">    r1 = <span class="string">'\r%s&gt;%d%%'</span> %(<span class="string">"-"</span> * int(rate_num*item), rate_num)</span><br><span class="line">    <span class="comment"># åœ¨ç»ˆç«¯ä¸­è¾“å‡ºï¼ˆä¸æ¢è¡Œï¼‰</span></span><br><span class="line">    sys.stdout.write(r1)</span><br><span class="line">    sys.stdout.flush()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">101</span>):</span><br><span class="line">    time.sleep(<span class="number">0.1</span>)</span><br><span class="line">    view_bar(i, <span class="number">100</span>)</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œç‰¹åˆ«è¯´æ˜ä¸‹ï¼Œä¸Šé¢çš„ä»£ç ä¸­ï¼Œè·å–ç»ˆç«¯å®½åº¦çš„æ–¹æ³•<code>os.get_terminal_size().columns</code>æ˜¯Python3+ç‰ˆæœ¬ä¸­çš„æ–°åŠŸèƒ½ï¼Œå¦‚æœæ˜¯2+çš„Pythonï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è·å–ç»ˆç«¯å®½åº¦</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> curses</span><br><span class="line">screen = curses.initscr()</span><br><span class="line">height, width = screen.getmaxyx()</span><br></pre></td></tr></table></figure>

<h1 id="ç¬¬äºŒç§ï¼šä½¿ç”¨ç¬¬ä¸‰æ–¹æ¨¡å—"><a href="#ç¬¬äºŒç§ï¼šä½¿ç”¨ç¬¬ä¸‰æ–¹æ¨¡å—" class="headerlink" title="ç¬¬äºŒç§ï¼šä½¿ç”¨ç¬¬ä¸‰æ–¹æ¨¡å—"></a>ç¬¬äºŒç§ï¼šä½¿ç”¨ç¬¬ä¸‰æ–¹æ¨¡å—</h1><p>æ„Ÿå—ä¸‹<del>~ æ˜¯ä¸æ˜¯ç¬é—´ä¸æƒ³é‡å¤é€ è½®å­äº†</del></p>
<h2 id="progressive"><a href="#progressive" class="headerlink" title="progressive"></a>progressive</h2><p><img src="http://20150509.oss-cn-qingdao.aliyuncs.com/20160615171759.gif" alt=""></p>
<h2 id="progressbar"><a href="#progressbar" class="headerlink" title="progressbar"></a>progressbar</h2><p><img src="http://20150509.oss-cn-qingdao.aliyuncs.com/20160615173459.png" alt=""></p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>è¿›åº¦æ¡</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonå¯¼å…¥æ¨¡å—</title>
    <url>/2016/06/15/Python%E5%AF%BC%E5%85%A5%E6%A8%A1%E5%9D%97/</url>
    <content><![CDATA[<blockquote>
<p>æ¨¡å—ï¼Œå³æŸä¸ªåŠŸèƒ½ä»£ç çš„é›†åˆ</p>
</blockquote>
<h1 id="å¯¼å…¥æ¨¡å—çš„åŸºæœ¬æ–¹æ³•"><a href="#å¯¼å…¥æ¨¡å—çš„åŸºæœ¬æ–¹æ³•" class="headerlink" title="å¯¼å…¥æ¨¡å—çš„åŸºæœ¬æ–¹æ³•"></a>å¯¼å…¥æ¨¡å—çš„åŸºæœ¬æ–¹æ³•</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> module</span><br><span class="line"><span class="keyword">from</span> module.xx.xx <span class="keyword">import</span> xx</span><br><span class="line"><span class="keyword">from</span> module.xx.xx <span class="keyword">import</span> xx <span class="keyword">as</span> rename </span><br><span class="line"><span class="keyword">from</span> module.xx.xx <span class="keyword">import</span> *</span><br></pre></td></tr></table></figure>

<p>å¯¼å…¥æ¨¡å—å…¶å®å°±æ˜¯å‘Šè¯‰Pythonè§£é‡Šå™¨å»è§£é‡Šé‚£ä¸ªpyæ–‡ä»¶</p>
<ul>
<li>å¯¼å…¥ä¸€ä¸ªpyæ–‡ä»¶ï¼Œè§£é‡Šå™¨è§£é‡Šè¯¥pyæ–‡ä»¶</li>
<li>å¯¼å…¥ä¸€ä¸ªåŒ…ï¼Œè§£é‡Šå™¨è§£é‡Šè¯¥åŒ…ä¸‹çš„ <code>__init__.py</code> æ–‡ä»¶</li>
</ul>
<h1 id="å¯¼å…¥æ¨¡å—çš„è·¯å¾„"><a href="#å¯¼å…¥æ¨¡å—çš„è·¯å¾„" class="headerlink" title="å¯¼å…¥æ¨¡å—çš„è·¯å¾„"></a>å¯¼å…¥æ¨¡å—çš„è·¯å¾„</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> sys</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sys.path</span><br><span class="line">[<span class="string">''</span>, <span class="string">'/Library/Frameworks/Python.framework/Versions/3.5/lib/python35.zip'</span>, <span class="string">'/Library/Frameworks/Python.framework/Versions/3.5/lib/python3.5'</span>, <span class="string">'/Library/Frameworks/Python.framework/Versions/3.5/lib/python3.5/plat-darwin'</span>, <span class="string">'/Library/Frameworks/Python.framework/Versions/3.5/lib/python3.5/lib-dynload'</span>, <span class="string">'/Library/Frameworks/Python.framework/Versions/3.5/lib/python3.5/site-packages'</span>]</span><br></pre></td></tr></table></figure>

<h1 id="å¯¼å…¥æŒ‡å®šè·¯å¾„çš„æ¨¡å—"><a href="#å¯¼å…¥æŒ‡å®šè·¯å¾„çš„æ¨¡å—" class="headerlink" title="å¯¼å…¥æŒ‡å®šè·¯å¾„çš„æ¨¡å—"></a>å¯¼å…¥æŒ‡å®šè·¯å¾„çš„æ¨¡å—</h1><p>åŠ å…¥éœ€è¦å¯¼å…¥sys.pathä¸­ä¸å­˜åœ¨çš„è·¯å¾„ä¸‹çš„æ¨¡å—ï¼Œæ­¤æ—¶å¯ä»¥æ‰‹åŠ¨æ·»åŠ æŒ‡å®šè·¯å¾„åˆ°sys.pathä¸­ï¼ˆä»…å½“æ¬¡ç”Ÿæ•ˆï¼‰</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ·»åŠ ä¸Šä¸Šçº§ç›®å½•åˆ°pathä¸­</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">project_path = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))</span><br><span class="line">sys.path.append(project_path)</span><br></pre></td></tr></table></figure>

<ul>
<li><code>__file__</code> è·å–ä»¥å½“å‰è·¯å¾„ä¸ºåŸºå‡†çš„æ–‡ä»¶ç›¸å¯¹è·¯å¾„</li>
<li><code>os.path.abspath(__file__)</code> è·å–å½“å‰æ–‡ä»¶çš„ç»å¯¹è·¯å¾„</li>
<li><code>os.path.dirname(os.path.abspath(__file__))</code> è·å–å½“å‰æ–‡ä»¶æ‰€åœ¨æ–‡ä»¶å¤¹çš„ç»å¯¹è·¯å¾„ï¼ˆä¸Šçº§ç›®å½•ï¼‰</li>
<li><code>os.path.dirname(os.path.dirname(os.path.abspath(__file__)))</code> è·å–å½“å‰æ–‡ä»¶çš„ä¸Šä¸Šçº§ç›®å½•</li>
</ul>
<h1 id="æ¨¡å—ä¸­çš„ç‰¹æ®Šå˜é‡"><a href="#æ¨¡å—ä¸­çš„ç‰¹æ®Šå˜é‡" class="headerlink" title="æ¨¡å—ä¸­çš„ç‰¹æ®Šå˜é‡"></a>æ¨¡å—ä¸­çš„ç‰¹æ®Šå˜é‡</h1><ul>
<li><p>__doc__ è·å–æ¨¡å—å®ç°åŠŸèƒ½çš„ç®€å•æè¿°</p>
</li>
<li><p>__file__ è·å–ä»¥å½“å‰è·¯å¾„ä¸ºåŸºå‡†çš„æ–‡ä»¶ç›¸å¯¹è·¯å¾„</p>
</li>
<li><p>__package__ è·å–è¯¥æ–‡ä»¶çš„ä¸Šå±‚åŒ…å</p>
</li>
<li><p>__cached__ å®é™…è¢«å¯¼å…¥çš„ç¼“å­˜æ–‡ä»¶ç»å¯¹è·¯å¾„</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> maopao</span><br><span class="line"></span><br><span class="line">print(maopao.__cached__)</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">/Users/lvrui/PycharmProjects/untitled/<span class="number">6</span>/c/__pycache__/maopao.cpython<span class="number">-35.</span>pyc</span><br></pre></td></tr></table></figure>

<ul>
<li>__name__ è·å–æ¨¡å—/æ–‡ä»¶çš„è°ƒç”¨è€…</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># maopao.py</span></span><br><span class="line">print(__name__)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># test.py</span></span><br><span class="line"><span class="keyword">import</span> maopao</span><br><span class="line"></span><br><span class="line">print(__name__)</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">maopao</span><br><span class="line">__main__</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>import</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonå†’æ³¡ é€‰æ‹© æ’å…¥æ’åºç®—æ³•è¯¦è§£</title>
    <url>/2016/06/13/Python%E5%86%92%E6%B3%A1-%E9%80%89%E6%8B%A9-%E6%8F%92%E5%85%A5%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95%E8%AF%A6%E8%A7%A3/</url>
    <content><![CDATA[<h1 id="å†’æ³¡æ’åº"><a href="#å†’æ³¡æ’åº" class="headerlink" title="å†’æ³¡æ’åº"></a>å†’æ³¡æ’åº</h1><p>å†’æ³¡æ’åºçš„åŸç†æ˜¯ä¸¤ä¸ªå…ƒç´ ç›¸é‚»çš„å…ƒç´ è¿›è¡Œæ¯”è¾ƒï¼Œå°çš„æ•°æ”¾åœ¨å‰é¢ï¼Œå¤§çš„æ•°æ”¾åœ¨åé¢ã€‚</p>
<p>ç¬¬ä¸€æ¬¡æ’åºï¼šé¦–å…ˆæ¯”è¾ƒç¬¬1ä¸ªæ•°å­—å’Œç¬¬2ä¸ªæ•°å­—ï¼Œå°æ•°æ”¾å‰ï¼Œå¤§æ•°æ”¾åï¼›ç„¶åæ¯”è¾ƒç¬¬2ä¸ªæ•°å’Œç¬¬3ä¸ªæ•°ï¼Œå°æ•°æ”¾å‰ï¼Œå¤§æ•°æ”¾åâ€¦â€¦ä»¥æ­¤ç±»æ¨ï¼Œæ‰¾åˆ°å€’æ•°ç¬¬äºŒä¸ªæ•°å­—å’Œæœ€åä¸€ä¸ªæ•°å­—è¿›è¡Œæ¯”è¾ƒï¼Œé¦–æ¬¡æ’åºä¼šå°†é˜Ÿåˆ—ä¸­æœ€å¤§çš„æ•°å­—æ”¾åœ¨æœ€åä¸€ä½</p>
<p>ç¬¬äºŒæ¬¡æ’åºï¼šè¿˜æ˜¯ä»ç¬¬1ä½å¼€å§‹å’Œç¬¬2ä½æ¯”è¾ƒï¼Œå°æ•°æ”¾å‰ï¼Œå¤§æ•°æ”¾åâ€¦â€¦ä¸€ç›´æ¯”åˆ°å€’æ•°ç¬¬äºŒä¸ªæ•°ï¼ˆå› ä¸ºå€’æ•°ç¬¬ä¸€ä¸ªæ•°åœ¨ç¬¬ä¸€æ¬¡æ’åºä¸­å·²ç»ç¡®å®šæ˜¯æœ€å¤§å€¼äº†ï¼‰</p>
<p>ä»¥æ­¤ç±»æ¨ï¼Œé‡å¤ä»¥ä¸Šè¿‡ç¨‹ï¼Œç›´åˆ°æœ€ç»ˆæ’åºå®Œæ¯•ã€‚</p>
<p>ç”±äºæ’åºè¿‡ç¨‹ä¸­ï¼Œæ°¸è¿œæ˜¯å°æ•°å¾€å‰æ”¾ï¼Œå¤§æ•°å¾€åæ”¾ï¼Œç±»ä¼¼äºæ°”æ³¡ä¸Šå‡ï¼Œæ‰€ä»¥è¢«ç§°ä¹‹ä¸ºå†’æ³¡æ’åºï¼Œæ¥ä¸‹æ¥é€šè¿‡Pythonä»£ç æ¥æ¼”ç¤ºå†’æ³¡æ’åºçš„è¿‡ç¨‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é¦–å…ˆæ¥ç›´è§‚æ„Ÿå—ä¸€ä¸‹å†’æ³¡æ’åºçš„ä»£ç </span></span><br><span class="line">l = [<span class="number">34</span>, <span class="number">16</span>, <span class="number">78</span>, <span class="number">2</span>, <span class="number">37</span>, <span class="number">56</span>, <span class="number">5</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> range(len(l) - <span class="number">1</span>, <span class="number">0</span>, <span class="number">-1</span>):</span><br><span class="line">   <span class="keyword">for</span> i <span class="keyword">in</span> range(j):</span><br><span class="line">        <span class="keyword">if</span> l[i] &gt; l[i+<span class="number">1</span>]:</span><br><span class="line">            l[i], l[i+<span class="number">1</span>] = l[i+<span class="number">1</span>], l[i]</span><br><span class="line">            </span><br><span class="line">print(l)</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">[<span class="number">2</span>, <span class="number">5</span>, <span class="number">16</span>, <span class="number">34</span>, <span class="number">37</span>, <span class="number">56</span>, <span class="number">78</span>]</span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥ä¸€æ­¥ä¸€æ­¥å®ç°ä¸Šé¢çš„ä»£ç </p>
<h2 id="é¦–æ¬¡å¾ªç¯"><a href="#é¦–æ¬¡å¾ªç¯" class="headerlink" title="é¦–æ¬¡å¾ªç¯"></a>é¦–æ¬¡å¾ªç¯</h2><p>éœ€è¦ç›¸é‚»ä¸¤ä¸ªæ•°è¿›è¡Œæ¯”è¾ƒï¼Œå°å€¼æ”¾å‰ï¼Œå¤§å€¼æ”¾åã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é¦–å…ˆéœ€è¦ç¡®å®šå¾ªç¯å¤šå°‘æ¬¡</span></span><br><span class="line"><span class="comment"># å¾ªç¯åˆ°æ¯ä¸ªå…ƒç´ éœ€è¦ len(l) æ¬¡, å¯¹åº”éå†çš„ç´¢å¼•ä¸‹æ ‡æ˜¯ range(len(l))</span></span><br><span class="line"><span class="comment"># ç”±äºæ˜¯ä¸¤ä¸¤æ¯”è¾ƒï¼Œæœ€åä¸€æ¬¡æ¯”è¾ƒï¼Œå–å¾—çš„æ˜¯å€’æ•°ç¬¬äºŒä¸ª len(l) - 2 è¿™ä¸ªå…ƒç´ ï¼Œå»å’Œæœ€åä¸€ä¸ªå…ƒç´  len(l) - 1 è¿›è¡Œæ¯”è¾ƒ</span></span><br><span class="line"><span class="comment"># æ‰€ä»¥å®é™…éœ€è¦éå†çš„æ¬¡æ•°æ¯”è¿™ä¸ªåˆ—è¡¨çš„æ€»é•¿åº¦è¦å°‘1</span></span><br><span class="line"><span class="comment"># è€Œrangeæœ‰ä»0å¼€å§‹ä¸”å·¦é—­å³å¼€çš„ç‰¹æ€§ï¼Œæ‰€ä»¥åœ¨rangeä¸­åªéœ€-1ï¼Œè‡³æ­¤å¯ä»¥ç¡®å®šéœ€è¦éå†ä¸‹è¡¨çš„ç´¢å¼•å°±æ˜¯ range(len(l) - 1)</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(l) - <span class="number">1</span>):</span><br><span class="line">	<span class="comment"># é‡Œé¢çš„åˆ¤æ–­å¾ˆç®€å•ï¼Œæ ¹æ®å†’æ³¡ç®—æ³•çš„æ ¸å¿ƒåŸç†</span></span><br><span class="line">	<span class="comment"># åˆ¤æ–­å½“å‰å…ƒç´ å’Œä¸‹ä¸€ä¸ªå…ƒç´ çš„å¤§å°ï¼Œå°æ”¾å‰ï¼Œå¤§æ”¾å</span></span><br><span class="line">    <span class="keyword">if</span> l[i] &gt; l[i + <span class="number">1</span>]:</span><br><span class="line">    	<span class="comment"># å¦‚æœå½“å‰å…ƒç´ å¤§äºä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œåˆ™äº¤æ¢ä¸¤ä¸ªå€¼å¾—ä½ç½®</span></span><br><span class="line">        l[i], l[i + <span class="number">1</span>] = l[i + <span class="number">1</span>], l[i]</span><br><span class="line"></span><br><span class="line"><span class="comment"># è‡³æ­¤ï¼Œå®Œæˆäº†å†’æ³¡æ’åºçš„ç¬¬ä¸€æ¬¡å¾ªç¯</span></span><br><span class="line"><span class="comment"># låˆ—è¡¨ä¸­æœ‰7ä¸ªå…ƒç´ ï¼Œåˆ™len(l) == 7</span></span><br><span class="line"><span class="comment"># å®é™…åªéœ€éå†6ä¸ªå…ƒç´ å³å¯ len(l) - 1 == 6</span></span><br><span class="line"><span class="comment"># æ ¹æ®å¾—åˆ°çš„éœ€è¦éå†çš„æ€»å…ƒç´ ä¸ªæ•°ï¼Œå»ç”Ÿæˆä¸€ä¸²ç´¢å¼•éå†æ•°ç»„</span></span><br><span class="line"><span class="comment"># range(6) --&gt; 0 1 2 3 4 5 ä»0å¼€å§‹ä¸”å·¦é—­å³å¼€</span></span><br><span class="line"><span class="comment"># è¿™æ ·å°±å–åˆ°äº†éœ€è¦éå†å…ƒç´ çš„ç´¢å¼•</span></span><br><span class="line">print(l)</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">[<span class="number">16</span>, <span class="number">34</span>, <span class="number">2</span>, <span class="number">37</span>, <span class="number">56</span>, <span class="number">5</span>, <span class="number">78</span>]</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å†æ¥çœ‹ä¸ªè¯¦ç»†è¾“å‡ºæ¯æ¬¡äº¤æ¢ä¿¡æ¯çš„ç‰ˆæœ¬</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(l) - <span class="number">1</span>): </span><br><span class="line">    print(<span class="string">'æ¯”è¾ƒ:'</span>, l[i], l[i+<span class="number">1</span>])</span><br><span class="line">    <span class="keyword">if</span> l[i] &gt; l[i + <span class="number">1</span>]: </span><br><span class="line">        l[i], l[i + <span class="number">1</span>] = l[i + <span class="number">1</span>], l[i]</span><br><span class="line">        print(<span class="string">'äº¤æ¢åçš„æ•°ç»„:'</span>, l)</span><br><span class="line">        </span><br><span class="line">print(l)</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">æ¯”è¾ƒ: <span class="number">34</span> <span class="number">16</span></span><br><span class="line">äº¤æ¢åçš„æ•°ç»„: [<span class="number">16</span>, <span class="number">34</span>, <span class="number">78</span>, <span class="number">2</span>, <span class="number">37</span>, <span class="number">56</span>, <span class="number">5</span>]</span><br><span class="line">æ¯”è¾ƒ: <span class="number">34</span> <span class="number">78</span></span><br><span class="line">æ¯”è¾ƒ: <span class="number">78</span> <span class="number">2</span></span><br><span class="line">äº¤æ¢åçš„æ•°ç»„: [<span class="number">16</span>, <span class="number">34</span>, <span class="number">2</span>, <span class="number">78</span>, <span class="number">37</span>, <span class="number">56</span>, <span class="number">5</span>]</span><br><span class="line">æ¯”è¾ƒ: <span class="number">78</span> <span class="number">37</span></span><br><span class="line">äº¤æ¢åçš„æ•°ç»„: [<span class="number">16</span>, <span class="number">34</span>, <span class="number">2</span>, <span class="number">37</span>, <span class="number">78</span>, <span class="number">56</span>, <span class="number">5</span>]</span><br><span class="line">æ¯”è¾ƒ: <span class="number">78</span> <span class="number">56</span></span><br><span class="line">äº¤æ¢åçš„æ•°ç»„: [<span class="number">16</span>, <span class="number">34</span>, <span class="number">2</span>, <span class="number">37</span>, <span class="number">56</span>, <span class="number">78</span>, <span class="number">5</span>]</span><br><span class="line">æ¯”è¾ƒ: <span class="number">78</span> <span class="number">5</span></span><br><span class="line">äº¤æ¢åçš„æ•°ç»„: [<span class="number">16</span>, <span class="number">34</span>, <span class="number">2</span>, <span class="number">37</span>, <span class="number">56</span>, <span class="number">5</span>, <span class="number">78</span>]</span><br><span class="line">[<span class="number">16</span>, <span class="number">34</span>, <span class="number">2</span>, <span class="number">37</span>, <span class="number">56</span>, <span class="number">5</span>, <span class="number">78</span>]</span><br></pre></td></tr></table></figure>

<h1 id="ä¾æ¬¡å¾ªç¯"><a href="#ä¾æ¬¡å¾ªç¯" class="headerlink" title="ä¾æ¬¡å¾ªç¯"></a>ä¾æ¬¡å¾ªç¯</h1><p>é¦–æ¬¡å¾ªç¯ä¹‹åï¼Œå·²ç»é€‰å‡ºäº†åˆ—è¡¨ä¸­çš„æœ€å¤§å€¼å¹¶æ”¾åˆ°äº†æœ€åä¸€ä½ï¼Œæ¥ä¸‹æ¥è¦åšçš„æ˜¯å†æ¬¡å¾ªç¯ï¼Œé€‰æ‹©ç¬¬äºŒå¤§çš„æ•°å­—æ”¾åœ¨å€’æ•°ç¬¬äºŒä½</p>
<p>è€Œä¸Šé¢å·²ç»å®ç°äº†é¦–æ¬¡å¾ªç¯ï¼Œç°åœ¨æˆ‘éœ€è¦åœ¨è¿™æ¬¡åŸºæœ¬å¾ªç¯å¤–ï¼Œå†å¥—ä¸Šä¸€å±‚å¾ªç¯ï¼Œç”±å¤–å±‚å¾ªç¯æ§åˆ¶å†…å±‚çš„å¾ªç¯æ€»å…±å¾ªç¯6æ¬¡ã€‚è¿™ä¸ªè¡¨è¾¾å¼å¾ˆå¥½å†™<code>range(len(l) - 1)</code> å°±èƒ½å¾—åˆ°6æ¬¡å¾ªç¯ï¼Œå¾—åˆ°çš„ç»“æœæ˜¯<code>0 1 2 3 4 5</code>, so, æˆ‘å¯ä»¥å¯¹ä»£ç åšå‡ºå¦‚ä¸‹ä¿®æ”¹å³å¯å®Œæˆå†’æ³¡æ’åº</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> range(len(l) - <span class="number">1</span>): </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(l) - <span class="number">1</span>): </span><br><span class="line">        <span class="keyword">if</span> l[i] &gt; l[i + <span class="number">1</span>]: </span><br><span class="line">            l[i], l[i + <span class="number">1</span>] = l[i + <span class="number">1</span>], l[i]</span><br><span class="line">            </span><br><span class="line">print(l)</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">[<span class="number">2</span>, <span class="number">5</span>, <span class="number">16</span>, <span class="number">34</span>, <span class="number">37</span>, <span class="number">56</span>, <span class="number">78</span>]</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ¥æ„Ÿå—ä¸‹å¸¦è¯¦ç»†è¾“å‡ºçš„ç‰ˆæœ¬</span></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> range(len(l) - <span class="number">1</span>): </span><br><span class="line">    print(<span class="string">'---ç¬¬'</span>, j, <span class="string">'æ¬¡å¾ªç¯---'</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(l) - <span class="number">1</span>): </span><br><span class="line">        print(<span class="string">'æ¯”è¾ƒ:'</span>, l[i], l[i+<span class="number">1</span>])</span><br><span class="line">        <span class="keyword">if</span> l[i] &gt; l[i + <span class="number">1</span>]: </span><br><span class="line">            l[i], l[i + <span class="number">1</span>] = l[i + <span class="number">1</span>], l[i]</span><br><span class="line">            print(<span class="string">'äº¤æ¢åçš„æ•°ç»„:'</span>, l)</span><br><span class="line">            </span><br><span class="line">print(l)</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">---ç¬¬ <span class="number">0</span> æ¬¡å¾ªç¯---</span><br><span class="line">æ¯”è¾ƒ: <span class="number">34</span> <span class="number">16</span></span><br><span class="line">äº¤æ¢åçš„æ•°ç»„: [<span class="number">16</span>, <span class="number">34</span>, <span class="number">78</span>, <span class="number">2</span>, <span class="number">37</span>, <span class="number">56</span>, <span class="number">5</span>]</span><br><span class="line">æ¯”è¾ƒ: <span class="number">34</span> <span class="number">78</span></span><br><span class="line">æ¯”è¾ƒ: <span class="number">78</span> <span class="number">2</span></span><br><span class="line">äº¤æ¢åçš„æ•°ç»„: [<span class="number">16</span>, <span class="number">34</span>, <span class="number">2</span>, <span class="number">78</span>, <span class="number">37</span>, <span class="number">56</span>, <span class="number">5</span>]</span><br><span class="line">æ¯”è¾ƒ: <span class="number">78</span> <span class="number">37</span></span><br><span class="line">äº¤æ¢åçš„æ•°ç»„: [<span class="number">16</span>, <span class="number">34</span>, <span class="number">2</span>, <span class="number">37</span>, <span class="number">78</span>, <span class="number">56</span>, <span class="number">5</span>]</span><br><span class="line">æ¯”è¾ƒ: <span class="number">78</span> <span class="number">56</span></span><br><span class="line">äº¤æ¢åçš„æ•°ç»„: [<span class="number">16</span>, <span class="number">34</span>, <span class="number">2</span>, <span class="number">37</span>, <span class="number">56</span>, <span class="number">78</span>, <span class="number">5</span>]</span><br><span class="line">æ¯”è¾ƒ: <span class="number">78</span> <span class="number">5</span></span><br><span class="line">äº¤æ¢åçš„æ•°ç»„: [<span class="number">16</span>, <span class="number">34</span>, <span class="number">2</span>, <span class="number">37</span>, <span class="number">56</span>, <span class="number">5</span>, <span class="number">78</span>]</span><br><span class="line">---ç¬¬ <span class="number">1</span> æ¬¡å¾ªç¯---</span><br><span class="line">æ¯”è¾ƒ: <span class="number">16</span> <span class="number">34</span></span><br><span class="line">æ¯”è¾ƒ: <span class="number">34</span> <span class="number">2</span></span><br><span class="line">äº¤æ¢åçš„æ•°ç»„: [<span class="number">16</span>, <span class="number">2</span>, <span class="number">34</span>, <span class="number">37</span>, <span class="number">56</span>, <span class="number">5</span>, <span class="number">78</span>]</span><br><span class="line">æ¯”è¾ƒ: <span class="number">34</span> <span class="number">37</span></span><br><span class="line">æ¯”è¾ƒ: <span class="number">37</span> <span class="number">56</span></span><br><span class="line">æ¯”è¾ƒ: <span class="number">56</span> <span class="number">5</span></span><br><span class="line">äº¤æ¢åçš„æ•°ç»„: [<span class="number">16</span>, <span class="number">2</span>, <span class="number">34</span>, <span class="number">37</span>, <span class="number">5</span>, <span class="number">56</span>, <span class="number">78</span>]</span><br><span class="line">æ¯”è¾ƒ: <span class="number">56</span> <span class="number">78</span></span><br><span class="line">---ç¬¬ <span class="number">2</span> æ¬¡å¾ªç¯---</span><br><span class="line">æ¯”è¾ƒ: <span class="number">16</span> <span class="number">2</span></span><br><span class="line">äº¤æ¢åçš„æ•°ç»„: [<span class="number">2</span>, <span class="number">16</span>, <span class="number">34</span>, <span class="number">37</span>, <span class="number">5</span>, <span class="number">56</span>, <span class="number">78</span>]</span><br><span class="line">æ¯”è¾ƒ: <span class="number">16</span> <span class="number">34</span></span><br><span class="line">æ¯”è¾ƒ: <span class="number">34</span> <span class="number">37</span></span><br><span class="line">æ¯”è¾ƒ: <span class="number">37</span> <span class="number">5</span></span><br><span class="line">äº¤æ¢åçš„æ•°ç»„: [<span class="number">2</span>, <span class="number">16</span>, <span class="number">34</span>, <span class="number">5</span>, <span class="number">37</span>, <span class="number">56</span>, <span class="number">78</span>]</span><br><span class="line">æ¯”è¾ƒ: <span class="number">37</span> <span class="number">56</span></span><br><span class="line">æ¯”è¾ƒ: <span class="number">56</span> <span class="number">78</span></span><br><span class="line">---ç¬¬ <span class="number">3</span> æ¬¡å¾ªç¯---</span><br><span class="line">æ¯”è¾ƒ: <span class="number">2</span> <span class="number">16</span></span><br><span class="line">æ¯”è¾ƒ: <span class="number">16</span> <span class="number">34</span></span><br><span class="line">æ¯”è¾ƒ: <span class="number">34</span> <span class="number">5</span></span><br><span class="line">äº¤æ¢åçš„æ•°ç»„: [<span class="number">2</span>, <span class="number">16</span>, <span class="number">5</span>, <span class="number">34</span>, <span class="number">37</span>, <span class="number">56</span>, <span class="number">78</span>]</span><br><span class="line">æ¯”è¾ƒ: <span class="number">34</span> <span class="number">37</span></span><br><span class="line">æ¯”è¾ƒ: <span class="number">37</span> <span class="number">56</span></span><br><span class="line">æ¯”è¾ƒ: <span class="number">56</span> <span class="number">78</span></span><br><span class="line">---ç¬¬ <span class="number">4</span> æ¬¡å¾ªç¯---</span><br><span class="line">æ¯”è¾ƒ: <span class="number">2</span> <span class="number">16</span></span><br><span class="line">æ¯”è¾ƒ: <span class="number">16</span> <span class="number">5</span></span><br><span class="line">äº¤æ¢åçš„æ•°ç»„: [<span class="number">2</span>, <span class="number">5</span>, <span class="number">16</span>, <span class="number">34</span>, <span class="number">37</span>, <span class="number">56</span>, <span class="number">78</span>]</span><br><span class="line">æ¯”è¾ƒ: <span class="number">16</span> <span class="number">34</span></span><br><span class="line">æ¯”è¾ƒ: <span class="number">34</span> <span class="number">37</span></span><br><span class="line">æ¯”è¾ƒ: <span class="number">37</span> <span class="number">56</span></span><br><span class="line">æ¯”è¾ƒ: <span class="number">56</span> <span class="number">78</span></span><br><span class="line">---ç¬¬ <span class="number">5</span> æ¬¡å¾ªç¯---</span><br><span class="line">æ¯”è¾ƒ: <span class="number">2</span> <span class="number">5</span></span><br><span class="line">æ¯”è¾ƒ: <span class="number">5</span> <span class="number">16</span></span><br><span class="line">æ¯”è¾ƒ: <span class="number">16</span> <span class="number">34</span></span><br><span class="line">æ¯”è¾ƒ: <span class="number">34</span> <span class="number">37</span></span><br><span class="line">æ¯”è¾ƒ: <span class="number">37</span> <span class="number">56</span></span><br><span class="line">æ¯”è¾ƒ: <span class="number">56</span> <span class="number">78</span></span><br><span class="line">[<span class="number">2</span>, <span class="number">5</span>, <span class="number">16</span>, <span class="number">34</span>, <span class="number">37</span>, <span class="number">56</span>, <span class="number">78</span>]</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢å·²ç»å®ç°äº†å¯¹ä¸€ä¸ªæ•°ç»„è¿›è¡Œå†’æ³¡æ’åºï¼Œä½†æ˜¯è¿˜æœ‰ä¸€ä¸ªç¼ºé™·ï¼Œå°±æ˜¯æ¯æ¬¡å†…éƒ¨å¾ªç¯éƒ½æ¢å¾ªç¯6æ¬¡ï¼Œè€Œé€šè¿‡å†’æ³¡ç®—æ³•çš„æ ¸å¿ƒåŸç†æˆ‘ä»¬å·²ç»å¾—çŸ¥ï¼Œåœ¨æ¯æ¬¡å¾ªç¯ä¸­éƒ½ä¼šé€‰å‡ºæœ€å¤§çš„æ•°å­—ä¾æ¬¡ä»åå¾€å‰æ”¾ç½®ï¼Œé‚£ä¹ˆï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå†…ä¾§å¾ªç¯çš„å¾ªç¯è§„å¾‹åªè¦æ»¡è¶³åˆ†åˆ«range<code>6 5 4 3 2 1</code>å³å¯æ‹¿åˆ°æœ€ç»ˆçš„æ’åºç»“æœï¼Œè¯·æ¥ç€å¾€ä¸‹çœ‹</p>
<h2 id="ä¼˜åŒ–è°ƒæ•´"><a href="#ä¼˜åŒ–è°ƒæ•´" class="headerlink" title="ä¼˜åŒ–è°ƒæ•´"></a>ä¼˜åŒ–è°ƒæ•´</h2><p>å‰é¢çš„åˆ†æå¾—å‡ºï¼Œé¦–æ¬¡éå†ä¸éœ€è¦éå†åˆ°æœ€åä¸€ä½ï¼Œå› ä¸ºæ˜¯å‰ä¸€ä½å’Œåä¸€ä½å»æ¯”ï¼Œæ‰€ä»¥åªéœ€éå†åˆ°<code>å€’æ•°ç¬¬äºŒä½</code>ï¼Œä¸<code>å€’æ•°ç¬¬äºŒä½+1</code>çš„å…ƒç´ è¿›è¡Œæ¯”è¾ƒå°±è¡Œå•¦</p>
<p>å½“é¦–æ¬¡å¾ªç¯ç»“æŸåï¼Œæœ€åä¸€ä½å·²ç»ç¡®å®šæ˜¯æœ€å¤§ï¼Œä¸éœ€è¦éå†ï¼Œæ ¹æ®å‰é¢çš„è§„å¾‹ï¼Œé¦–æ¬¡æ’åºåçš„æ•°ç»„å€’æ•°ç¬¬äºŒä½ä¹Ÿä¸éœ€è¦éå†ï¼Œå› ä¸ºä¼šæœ‰å€’æ•°ç¬¬ä¸‰ä½ä¸»åŠ¨ä¸ä¹‹æ¯”è¾ƒï¼Œæ‰€ä»¥æ‹¿ä¸Šé¢çš„æ•°ç»„ä¸¾ä¾‹ğŸŒ°ï¼Œå¾—åˆ°çš„è§„å¾‹æ˜¯ï¼Œæ•°ç»„é•¿åº¦ä¸º7ï¼Œå†…å±‚å¾ªç¯ç¬¬ä¸€æ¬¡éœ€è¦å¾ªç¯6æ¬¡ï¼Œç¬¬äºŒæ¬¡éœ€è¦å¾ªç¯5æ¬¡ï¼Œç¬¬ä¸‰æ¬¡éœ€è¦å¾ªç¯4æ¬¡ï¼Œç¬¬å››æ¬¡éœ€è¦å¾ªç¯3æ¬¡ï¼Œç¬¬äº”æ¬¡éœ€è¦å¾ªç¯2æ¬¡ï¼Œç¬¬å…­æ¬¡éœ€è¦å¾ªç¯1æ¬¡ï¼Œé€€å‡ºã€‚</p>
<p>æˆ‘ä»¬å†æ¥æ‰¾ä¸€ä¸‹è§„å¾‹ï¼ˆæ‹¿é¦–æ¬¡å¾ªç¯çš„æƒ…å†µä¸¾ä¾‹ğŸŒ°ï¼‰ï¼š</p>
<ul>
<li><p>å†…å±‚å¾ªç¯éœ€è¦çš„<code>range</code>å‚æ•°æ˜¯<code>6</code>, ç”±<code>len(l) - 1</code>å¾—å‡º<code>0 1 2 3 4 5</code></p>
</li>
<li><p>å¤–å±‚å¾ªç¯éœ€è¦çš„<code>range</code>å‚æ•°ä¹Ÿæ˜¯<code>6</code>ï¼Œä¹Ÿç”±<code>len(l) - 1</code>å¾—å‡º<code>0 1 2 3 4 5</code></p>
</li>
</ul>
<p>å†…å±‚å¾ªç¯éœ€è¦6ï¼Œä½†æ˜¯å¤–å±‚å¾ªç¯<code>range(6)</code>ä¹‹åå¾—åˆ°çš„é˜Ÿåˆ—æ˜¯<code>0 1 2 3 4 5</code>,æˆ‘ä»¬åªéœ€è®©rangeä»å¤§å¾€å°å–å€¼å³å¯<code>range(6, 0, -1)</code>å–åˆ°å¾—å€¼å³ä¸º<code>6 5 4 3 2 1</code>,æ­£å¥½å¯ä»¥æ‹¿åˆ°å†…å±‚å¾ªç¯ç”¨ï¼Œäºæ˜¯ï¼Œå¯ä»¥åšå‡ºå¦‚ä¸‹ä¿®æ”¹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ç¬¬ä¸€æ¬¡å¾ªç¯</span><br><span class="line">å¤–å±‚ for j in 6 5 4 3 2 1</span><br><span class="line">	å†…å±‚ range(6) ---&gt; 0 1 2 3 4 5</span><br><span class="line">ç¬¬äºŒæ¬¡å¾ªç¯</span><br><span class="line">å¤–å±‚ for j in 5 4 3 2 1</span><br><span class="line">	å†…å±‚ range(5) ---&gt; 0 1 2 3 4</span><br><span class="line">ç¬¬ä¸‰æ¬¡å¾ªç¯</span><br><span class="line">å¤–å±‚ for j in 4 3 2 1</span><br><span class="line">	å†…å­˜ range(4) ---&gt; 0 1 2 3</span><br><span class="line">...</span><br><span class="line">ä»¥æ­¤ç±»æ¨</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æœ€ç»ˆä»£ç å®ç°</span></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> range(len(l) - <span class="number">1</span>, <span class="number">0</span>, <span class="number">-1</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(j):</span><br><span class="line">        <span class="keyword">if</span> l[i] &gt; l[i+<span class="number">1</span>]:</span><br><span class="line">            l[i], l[i+<span class="number">1</span>] = l[i+<span class="number">1</span>], l[i]</span><br><span class="line"></span><br><span class="line">print(l)</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">[<span class="number">2</span>, <span class="number">5</span>, <span class="number">16</span>, <span class="number">34</span>, <span class="number">37</span>, <span class="number">56</span>, <span class="number">78</span>]</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è¯¦ç»†è¾“å‡ºç‰ˆ</span></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> range(len(l) - <span class="number">1</span>, <span class="number">0</span>, <span class="number">-1</span>):</span><br><span class="line">    print(<span class="string">'---ç¬¬'</span>, j, <span class="string">'æ¬¡å¾ªç¯---'</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(j):</span><br><span class="line">        print(<span class="string">'æ¯”è¾ƒ:'</span>, l[i], l[i+<span class="number">1</span>])</span><br><span class="line">        <span class="keyword">if</span> l[i] &gt; l[i+<span class="number">1</span>]:</span><br><span class="line">            l[i], l[i+<span class="number">1</span>] = l[i+<span class="number">1</span>], l[i]</span><br><span class="line">            print(<span class="string">'äº¤æ¢åçš„æ•°ç»„:'</span>, l)</span><br><span class="line"></span><br><span class="line">print(l)</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">---ç¬¬ <span class="number">6</span> æ¬¡å¾ªç¯---</span><br><span class="line">æ¯”è¾ƒ: <span class="number">34</span> <span class="number">16</span></span><br><span class="line">äº¤æ¢åçš„æ•°ç»„: [<span class="number">16</span>, <span class="number">34</span>, <span class="number">78</span>, <span class="number">2</span>, <span class="number">37</span>, <span class="number">56</span>, <span class="number">5</span>]</span><br><span class="line">æ¯”è¾ƒ: <span class="number">34</span> <span class="number">78</span></span><br><span class="line">æ¯”è¾ƒ: <span class="number">78</span> <span class="number">2</span></span><br><span class="line">äº¤æ¢åçš„æ•°ç»„: [<span class="number">16</span>, <span class="number">34</span>, <span class="number">2</span>, <span class="number">78</span>, <span class="number">37</span>, <span class="number">56</span>, <span class="number">5</span>]</span><br><span class="line">æ¯”è¾ƒ: <span class="number">78</span> <span class="number">37</span></span><br><span class="line">äº¤æ¢åçš„æ•°ç»„: [<span class="number">16</span>, <span class="number">34</span>, <span class="number">2</span>, <span class="number">37</span>, <span class="number">78</span>, <span class="number">56</span>, <span class="number">5</span>]</span><br><span class="line">æ¯”è¾ƒ: <span class="number">78</span> <span class="number">56</span></span><br><span class="line">äº¤æ¢åçš„æ•°ç»„: [<span class="number">16</span>, <span class="number">34</span>, <span class="number">2</span>, <span class="number">37</span>, <span class="number">56</span>, <span class="number">78</span>, <span class="number">5</span>]</span><br><span class="line">æ¯”è¾ƒ: <span class="number">78</span> <span class="number">5</span></span><br><span class="line">äº¤æ¢åçš„æ•°ç»„: [<span class="number">16</span>, <span class="number">34</span>, <span class="number">2</span>, <span class="number">37</span>, <span class="number">56</span>, <span class="number">5</span>, <span class="number">78</span>]</span><br><span class="line">---ç¬¬ <span class="number">5</span> æ¬¡å¾ªç¯---</span><br><span class="line">æ¯”è¾ƒ: <span class="number">16</span> <span class="number">34</span></span><br><span class="line">æ¯”è¾ƒ: <span class="number">34</span> <span class="number">2</span></span><br><span class="line">äº¤æ¢åçš„æ•°ç»„: [<span class="number">16</span>, <span class="number">2</span>, <span class="number">34</span>, <span class="number">37</span>, <span class="number">56</span>, <span class="number">5</span>, <span class="number">78</span>]</span><br><span class="line">æ¯”è¾ƒ: <span class="number">34</span> <span class="number">37</span></span><br><span class="line">æ¯”è¾ƒ: <span class="number">37</span> <span class="number">56</span></span><br><span class="line">æ¯”è¾ƒ: <span class="number">56</span> <span class="number">5</span></span><br><span class="line">äº¤æ¢åçš„æ•°ç»„: [<span class="number">16</span>, <span class="number">2</span>, <span class="number">34</span>, <span class="number">37</span>, <span class="number">5</span>, <span class="number">56</span>, <span class="number">78</span>]</span><br><span class="line">---ç¬¬ <span class="number">4</span> æ¬¡å¾ªç¯---</span><br><span class="line">æ¯”è¾ƒ: <span class="number">16</span> <span class="number">2</span></span><br><span class="line">äº¤æ¢åçš„æ•°ç»„: [<span class="number">2</span>, <span class="number">16</span>, <span class="number">34</span>, <span class="number">37</span>, <span class="number">5</span>, <span class="number">56</span>, <span class="number">78</span>]</span><br><span class="line">æ¯”è¾ƒ: <span class="number">16</span> <span class="number">34</span></span><br><span class="line">æ¯”è¾ƒ: <span class="number">34</span> <span class="number">37</span></span><br><span class="line">æ¯”è¾ƒ: <span class="number">37</span> <span class="number">5</span></span><br><span class="line">äº¤æ¢åçš„æ•°ç»„: [<span class="number">2</span>, <span class="number">16</span>, <span class="number">34</span>, <span class="number">5</span>, <span class="number">37</span>, <span class="number">56</span>, <span class="number">78</span>]</span><br><span class="line">---ç¬¬ <span class="number">3</span> æ¬¡å¾ªç¯---</span><br><span class="line">æ¯”è¾ƒ: <span class="number">2</span> <span class="number">16</span></span><br><span class="line">æ¯”è¾ƒ: <span class="number">16</span> <span class="number">34</span></span><br><span class="line">æ¯”è¾ƒ: <span class="number">34</span> <span class="number">5</span></span><br><span class="line">äº¤æ¢åçš„æ•°ç»„: [<span class="number">2</span>, <span class="number">16</span>, <span class="number">5</span>, <span class="number">34</span>, <span class="number">37</span>, <span class="number">56</span>, <span class="number">78</span>]</span><br><span class="line">---ç¬¬ <span class="number">2</span> æ¬¡å¾ªç¯---</span><br><span class="line">æ¯”è¾ƒ: <span class="number">2</span> <span class="number">16</span></span><br><span class="line">æ¯”è¾ƒ: <span class="number">16</span> <span class="number">5</span></span><br><span class="line">äº¤æ¢åçš„æ•°ç»„: [<span class="number">2</span>, <span class="number">5</span>, <span class="number">16</span>, <span class="number">34</span>, <span class="number">37</span>, <span class="number">56</span>, <span class="number">78</span>]</span><br><span class="line">---ç¬¬ <span class="number">1</span> æ¬¡å¾ªç¯---</span><br><span class="line">æ¯”è¾ƒ: <span class="number">2</span> <span class="number">5</span></span><br><span class="line">[<span class="number">2</span>, <span class="number">5</span>, <span class="number">16</span>, <span class="number">34</span>, <span class="number">37</span>, <span class="number">56</span>, <span class="number">78</span>]</span><br></pre></td></tr></table></figure>

<p>æ‰“å®Œæ”¶å·¥~~</p>
<h2 id="æ•ˆç‡åˆ†æ"><a href="#æ•ˆç‡åˆ†æ" class="headerlink" title="æ•ˆç‡åˆ†æ"></a>æ•ˆç‡åˆ†æ</h2><ul>
<li>ç¨³å®š </li>
<li>ç©ºé—´å¤æ‚åº¦<code>O(1)</code> </li>
<li>æ—¶é—´å¤æ‚åº¦<code>O(n2)</code> </li>
<li>æœ€å·®æƒ…å†µï¼šååºï¼Œéœ€è¦äº¤æ¢<code>n*(n-1)/2</code>ä¸ªå…ƒç´  </li>
<li>æœ€å¥½æƒ…å†µï¼šæ­£åºï¼Œä¸éœ€è¦äº¤æ¢å…ƒç´ <code>O(n)</code></li>
</ul>
<h1 id="æ’å…¥æ’åº"><a href="#æ’å…¥æ’åº" class="headerlink" title="æ’å…¥æ’åº"></a>æ’å…¥æ’åº</h1><p>æ’å…¥æ’åºå’Œå†’æ³¡æ’åºéå¸¸åƒï¼Œå’Œå†’æ³¡çš„åŒºåˆ«åœ¨äºï¼Œåœ¨å†’æ³¡ä¸­ï¼Œç›¸é‚»ä¸¤ä¸ªå€¼è¿›è¡Œæ¯”è¾ƒï¼Œåªè¦åé¢çš„æ•°æ¯”å‰é¢çš„æ•°å¤§å°±äº¤æ¢ä½ç½®ï¼›è€Œæ’å…¥æ’åºæ¯æ¬¡å‡è®¾ç¬¬0ç´¢å¼•çš„å…ƒç´ æ˜¯æœ€å¤§å€¼ï¼Œå»å’Œé˜Ÿåˆ—ä¸­å‰©ä½™æ‰€æœ‰çš„å…ƒç´ è¿›è¡Œæ¯”è¾ƒï¼Œä½†æ˜¯æ’å…¥æ’åºä¸ä¼šå®é™…å»äº¤æ¢ä¸¤ä¸ªæ•°çš„ä½ç½®ï¼Œè€Œæ˜¯ä¼šä¿å­˜æœ€å¤§çš„é‚£ä¸ªå€¼å¾—ç´¢å¼•ï¼Œæ¯”åˆ°æœ€åæ—¶ï¼Œå°†æœ€å¤§å€¼æ’å…¥åˆ°åˆ—è¡¨çš„æœ€åé¢ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å…ˆæ„Ÿå—ä¸‹ä»£ç </span></span><br><span class="line">l = [<span class="number">34</span>, <span class="number">16</span>, <span class="number">78</span>, <span class="number">2</span>, <span class="number">34</span>, <span class="number">56</span>, <span class="number">5</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(l) - <span class="number">1</span>, <span class="number">0</span>, <span class="number">-1</span>):</span><br><span class="line">    maxindex = <span class="number">0</span> </span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>, i+<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">if</span> l[j] &gt; l[maxindex]:</span><br><span class="line">            maxindex = j </span><br><span class="line">    l[i], l[maxindex] = l[maxindex], l[i]</span><br><span class="line">    </span><br><span class="line">print(l)</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">[<span class="number">2</span>, <span class="number">5</span>, <span class="number">16</span>, <span class="number">34</span>, <span class="number">34</span>, <span class="number">56</span>, <span class="number">78</span>]</span><br></pre></td></tr></table></figure>

<ul>
<li>å¤–å±‚å¾ªç¯å’Œå†’æ³¡çš„æ²¡æœ‰ä»»ä½•åŒºåˆ«ï¼Œé‚£æ­¤ä¾‹æ¥è¯´éƒ½æ˜¯å–åˆ°äº†<code>6 5 4 3 2 1</code>è¿™ä¸ªé˜Ÿåˆ—</li>
<li>ç¬¬4è¡Œä»£ç è®¾ç½®äº†ä¸€ä¸ªæœ€å¤§å€¼çš„ç´¢å¼•ï¼Œæˆ‘å‡è®¾æ¯æ¬¡ç¬¬0ä¸ªå…ƒç´ éƒ½æ˜¯æœ€å¤§å€¼ï¼Œè¿™ä¸€æ­¥æ˜¯æ’å…¥æ’åºçš„æ ¸å¿ƒï¼Œç”¨æ¥ä¿å­˜æœ€å¤§å€¼çš„ç´¢å¼•ä½ç½®</li>
<li>ç¬¬5è¡Œå†…å­˜å¾ªç¯å’Œå†’æ³¡çš„æœ‰äº›å·®åˆ«<ul>
<li>ä¸ºä»€ä¹ˆå†’æ³¡ä»0å¼€å§‹ï¼Œè€Œæ’å…¥è¦æŒ‡å®šä»1å¼€å§‹ï¼Ÿå› ä¸ºæ’å…¥æ’åºå·²ç»æŒ‡å®šäº†æœ€å¤§å€¼çš„ç´¢å¼•çš„æ˜¯0ï¼Œæ’å…¥æ’åºä¼šæ‹¿è¿™ä¸ªâ€œæœ€å¤§å€¼â€å»å’Œæ¯ä¸€ä¸ªå…ƒç´ æ¯”è¾ƒï¼Œæ‰€ä»¥å½“ç„¶è¦ä»1å¼€å§‹å•¦ï¼ï¼</li>
<li>ä¸ºä»€ä¹ˆä»¥<code>i+1</code>ç»“æŸï¼Ÿä¸Šé¢ä¹Ÿè¯´åˆ°äº†ï¼Œå‡è®¾çš„æœ€å¤§å€¼ç´¢å¼•0ï¼Œè¦å’Œå‰©ä½™çš„æ‰€æœ‰çš„å…ƒç´ è¿›è¡Œæ¯”è¾ƒï¼ŒåŒ…æ‹¬å–æœ€åä¸€ä¸ªå…ƒç´ çš„ç´¢å¼•è¿›è¡Œæ¯”è¾ƒï¼Œè€Œrangeæœ‰å·¦é—­å³å¼€çš„ç‰¹æ€§ï¼Œä¸åŒ…å«å³è¾¹çš„å€¼ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œè¦<code>+1</code>ä¸€ä¸‹ï¼Œæ‰èƒ½å–åˆ°æœ€åä¸€ä¸ªå€¼çš„ç´¢å¼•ã€‚</li>
</ul>
</li>
<li>ç¬¬6è¡Œï¼Œæ‹¿åˆ—è¡¨ä¸­çš„å…¶ä»–å…ƒç´ ä¸â€œæœ€å¤§å€¼â€è¿›è¡Œæ¯”è¾ƒ</li>
<li>ç¬¬7è¡Œï¼Œå¦‚æœæˆç«‹ï¼Œåˆ™ä¿å­˜æœ€å¤§å€¼çš„ç´¢å¼•</li>
<li>ç¬¬8è¡Œï¼Œåœ¨æ•´ä¸ªåˆ—è¡¨éå†ä¸€æ¬¡è¿‡åï¼Œ<code>maxindex</code>çš„ç´¢å¼•å°±æ˜¯æœ€å¤§å€¼ï¼Œæ•…å°†é˜Ÿåˆ—ä¸­æœ€åä¸€ä¸ªå…ƒç´ ä¸<code>maxindex</code>å¯¹åº”çš„å…ƒç´ è¿›è¡Œè°ƒæ¢ï¼Œè¿™æ ·ä¸€æ¥ï¼Œæ¯æ¬¡éƒ½ä¼šæŠŠæœ€å¤§å€¼ä¾æ¬¡ä»åå¾€å‰æ”¾ç½®ã€‚</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä½“éªŒä¸‹è¯¦ç»†çš„ä¿¡æ¯è¾“å‡º</span></span><br><span class="line">l = [<span class="number">34</span>, <span class="number">16</span>, <span class="number">78</span>, <span class="number">2</span>, <span class="number">34</span>, <span class="number">56</span>, <span class="number">5</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(l) - <span class="number">1</span>, <span class="number">0</span>, <span class="number">-1</span>):</span><br><span class="line">    maxindex = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>, i+<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">if</span> l[j] &gt; l[maxindex]:</span><br><span class="line">            maxindex = j</span><br><span class="line">    l[i], l[maxindex] = l[maxindex], l[i]</span><br><span class="line">    print(l, i)</span><br><span class="line">    </span><br><span class="line">print(l)</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">[<span class="number">34</span>, <span class="number">16</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">34</span>, <span class="number">56</span>, <span class="number">78</span>] <span class="number">6</span></span><br><span class="line">[<span class="number">34</span>, <span class="number">16</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">34</span>, <span class="number">56</span>, <span class="number">78</span>] <span class="number">5</span></span><br><span class="line">[<span class="number">34</span>, <span class="number">16</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">34</span>, <span class="number">56</span>, <span class="number">78</span>] <span class="number">4</span></span><br><span class="line">[<span class="number">2</span>, <span class="number">16</span>, <span class="number">5</span>, <span class="number">34</span>, <span class="number">34</span>, <span class="number">56</span>, <span class="number">78</span>] <span class="number">3</span></span><br><span class="line">[<span class="number">2</span>, <span class="number">5</span>, <span class="number">16</span>, <span class="number">34</span>, <span class="number">34</span>, <span class="number">56</span>, <span class="number">78</span>] <span class="number">2</span></span><br><span class="line">[<span class="number">2</span>, <span class="number">5</span>, <span class="number">16</span>, <span class="number">34</span>, <span class="number">34</span>, <span class="number">56</span>, <span class="number">78</span>] <span class="number">1</span></span><br><span class="line">[<span class="number">2</span>, <span class="number">5</span>, <span class="number">16</span>, <span class="number">34</span>, <span class="number">34</span>, <span class="number">56</span>, <span class="number">78</span>]</span><br></pre></td></tr></table></figure>

<p>æ’å…¥æ’åºç›¸å¯¹äºå†’æ³¡æ’åºçš„å¥½å¤„æ˜¯ï¼Œæ¯æ¬¡å†…å±‚å¾ªç¯ç»“æŸåï¼Œä¸ç®¡é˜Ÿåˆ—çš„æ•°å€¼æ€æ ·åˆ†å¸ƒï¼Œéƒ½åªä¼šæœ‰ä¸€æ¬¡å®é™…çš„æ¢å€¼æ“ä½œã€‚</p>
<h2 id="æ•ˆç‡åˆ†æ-1"><a href="#æ•ˆç‡åˆ†æ-1" class="headerlink" title="æ•ˆç‡åˆ†æ"></a>æ•ˆç‡åˆ†æ</h2><ul>
<li>ç¨³å®š </li>
<li>ç©ºé—´å¤æ‚åº¦O(1) </li>
<li>æ—¶é—´å¤æ‚åº¦O(n2) </li>
<li>æœ€å·®æƒ…å†µï¼šååºï¼Œéœ€è¦ç§»åŠ¨n*(n-1)/2ä¸ªå…ƒç´  </li>
<li>æœ€å¥½æƒ…å†µï¼šæ­£åºï¼Œä¸éœ€è¦ç§»åŠ¨å…ƒç´ </li>
</ul>
<h1 id="é€‰æ‹©æ’åº"><a href="#é€‰æ‹©æ’åº" class="headerlink" title="é€‰æ‹©æ’åº"></a>é€‰æ‹©æ’åº</h1><p>é€‰æ‹©æ’åºçš„æ ¸å¿ƒæ€æƒ³æ˜¯å§‹ç»ˆç»´æŠ¤ä¸€ä¸ªæœ‰åºçš„é˜Ÿåˆ—ï¼Œä¾æ¬¡ç”¨é˜Ÿåˆ—ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ ä¸åé¢çš„æ‰€æœ‰å…ƒç´ è¿›è¡Œå¯¹æ¯”ï¼Œå°æ”¾å‰ï¼Œå¤§æ”¾å</p>
<p>ä¾‹å¦‚ç°æœ‰å¦‚ä¸‹åˆ—è¡¨ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">l = [<span class="number">34</span>, <span class="number">16</span>, <span class="number">78</span>, <span class="number">2</span>, <span class="number">34</span>, <span class="number">56</span>, <span class="number">5</span>]</span><br></pre></td></tr></table></figure>

<p>é€‰æ‹©æ’åºç®—æ³•å®ç°ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ç”¨ç¬¬<span class="number">1</span>ä¸ªå…ƒç´ å’Œç¬¬<span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span>çš„å…ƒç´ è¿›è¡Œå¯¹æ¯”</span><br><span class="line">ç”¨ç¬¬<span class="number">2</span>ä¸ªå…ƒç´ å’Œç¬¬<span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span>çš„å…ƒç´ è¿›è¡Œå¯¹æ¯”</span><br><span class="line">ç”¨ç¬¬<span class="number">3</span>ä¸ªå…ƒç´ å’Œç¬¬<span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span>çš„å…ƒç´ è¿›è¡Œå¯¹æ¯”</span><br><span class="line">......</span><br><span class="line">ä¾æ¬¡ç±»æ¨</span><br></pre></td></tr></table></figure>

<p>æ¯æ¬¡å¯¹æ¯”å®Œåï¼Œæ‹¿æ¥å¯¹æ¯”çš„é‚£ä¸ªåŸºå‡†å€¼éƒ½ä¼šè¢«æ¢æˆ<strong>å½“æ¬¡å¾ªç¯</strong>çš„æœ€å°å€¼ï¼Œä»è¿™é‡Œå¯ä»¥å¯¹æ¯”å†’æ³¡å’Œæ’åº</p>
<ul>
<li>å†’æ³¡æ˜¯ç›¸é‚»ä¸¤ä¸¤æ¯”è¾ƒï¼Œåªè¦æ¯”å‰é¢çš„å€¼å°å°±äº¤æ¢ä½ç½®ï¼Œå±äºä»å¤§å¾€å°æ’</li>
<li>æ’å…¥æ’åºä¹Ÿæ˜¯ç›¸é‚»ä¸¤ä¸¤æ¯”è¾ƒï¼Œæ¯æ¬¡éƒ½å‡è®¾ç´¢å¼•0ä¸ºæœ€å¤§å€¼ï¼Œä¸å‰©ä½™çš„æ‰€æœ‰å…ƒç´ è¿›è¡Œæ¯”è¾ƒï¼Œè®°å½•æœ€å¤§å€¼çš„ç´¢å¼•ï¼ŒæŠŠæœ€åä¸€ä¸ªå€¼ä¸æœ€å¤§å€¼è¿›è¡Œäº¤æ¢ï¼Œå±äºä»å¤§å¾€å°æ’</li>
<li>é€‰æ‹©æ’åºæ˜¯ä»å°å¾€å¤§æ’ï¼Œç¬¬ä¸€æ¬¡å–ç¬¬0ç´¢å¼•å»å’Œæ‰€æœ‰å…ƒç´ æ¯”è¾ƒï¼Œæ¢å¾—æœ€å°å€¼æ”¾åˆ°äº†æœ€å‰é¢ï¼Œç¬¬äºŒæ¬¡å–ç¬¬1ç´¢å¼•å»å’Œæ‰€æœ‰å…ƒç´ æ¯”è¾ƒï¼Œæ¢å¾—çš„æœ€å°å€¼ä¾æ¬¡ä»å‰å¾€åæ’</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">l = [<span class="number">34</span>, <span class="number">16</span>, <span class="number">78</span>, <span class="number">2</span>, <span class="number">34</span>, <span class="number">56</span>, <span class="number">5</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(l)<span class="number">-1</span>):</span><br><span class="line">    print(<span class="string">'------'</span> * <span class="number">9</span>)</span><br><span class="line">    print(<span class="string">'å¾…æ“ä½œçš„åˆ—è¡¨---&gt;'</span>, l, <span class="string">'æ“ä½œç´¢å¼•---&gt;'</span>, i)</span><br><span class="line">    print(<span class="string">'------'</span> * <span class="number">9</span>)</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(i+<span class="number">1</span>, len(l)):</span><br><span class="line">        print(l[i], l[j])</span><br><span class="line">        <span class="keyword">if</span> l[i] &gt; l[j]:</span><br><span class="line">            print(<span class="string">'è°ƒæ¢ä½ç½®%s, %s'</span> %(l[j], l[i]))</span><br><span class="line">            l[i], l[j] = l[j], l[i]</span><br><span class="line">            print(<span class="string">'è°ƒæ¢å®Œä½ç½®çš„åˆ—è¡¨---&gt;'</span>, l)</span><br><span class="line"></span><br><span class="line">print(l)</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">------------------------------------------------------</span><br><span class="line">å¾…æ“ä½œçš„åˆ—è¡¨---&gt; [34, 16, 78, 2, 34, 56, 5] æ“ä½œç´¢å¼•---&gt; 0</span><br><span class="line">------------------------------------------------------</span><br><span class="line"><span class="number">34</span> <span class="number">16</span></span><br><span class="line">è°ƒæ¢ä½ç½®<span class="number">16</span>, <span class="number">34</span></span><br><span class="line">è°ƒæ¢å®Œä½ç½®çš„åˆ—è¡¨---&gt; [16, 34, 78, 2, 34, 56, 5]</span><br><span class="line"><span class="number">16</span> <span class="number">78</span></span><br><span class="line"><span class="number">16</span> <span class="number">2</span></span><br><span class="line">è°ƒæ¢ä½ç½®<span class="number">2</span>, <span class="number">16</span></span><br><span class="line">è°ƒæ¢å®Œä½ç½®çš„åˆ—è¡¨---&gt; [2, 34, 78, 16, 34, 56, 5]</span><br><span class="line"><span class="number">2</span> <span class="number">34</span></span><br><span class="line"><span class="number">2</span> <span class="number">56</span></span><br><span class="line"><span class="number">2</span> <span class="number">5</span></span><br><span class="line">------------------------------------------------------</span><br><span class="line">å¾…æ“ä½œçš„åˆ—è¡¨---&gt; [2, 34, 78, 16, 34, 56, 5] æ“ä½œç´¢å¼•---&gt; 1</span><br><span class="line">------------------------------------------------------</span><br><span class="line"><span class="number">34</span> <span class="number">78</span></span><br><span class="line"><span class="number">34</span> <span class="number">16</span></span><br><span class="line">è°ƒæ¢ä½ç½®<span class="number">16</span>, <span class="number">34</span></span><br><span class="line">è°ƒæ¢å®Œä½ç½®çš„åˆ—è¡¨---&gt; [2, 16, 78, 34, 34, 56, 5]</span><br><span class="line"><span class="number">16</span> <span class="number">34</span></span><br><span class="line"><span class="number">16</span> <span class="number">56</span></span><br><span class="line"><span class="number">16</span> <span class="number">5</span></span><br><span class="line">è°ƒæ¢ä½ç½®<span class="number">5</span>, <span class="number">16</span></span><br><span class="line">è°ƒæ¢å®Œä½ç½®çš„åˆ—è¡¨---&gt; [2, 5, 78, 34, 34, 56, 16]</span><br><span class="line">------------------------------------------------------</span><br><span class="line">å¾…æ“ä½œçš„åˆ—è¡¨---&gt; [2, 5, 78, 34, 34, 56, 16] æ“ä½œç´¢å¼•---&gt; 2</span><br><span class="line">------------------------------------------------------</span><br><span class="line"><span class="number">78</span> <span class="number">34</span></span><br><span class="line">è°ƒæ¢ä½ç½®<span class="number">34</span>, <span class="number">78</span></span><br><span class="line">è°ƒæ¢å®Œä½ç½®çš„åˆ—è¡¨---&gt; [2, 5, 34, 78, 34, 56, 16]</span><br><span class="line"><span class="number">34</span> <span class="number">34</span></span><br><span class="line"><span class="number">34</span> <span class="number">56</span></span><br><span class="line"><span class="number">34</span> <span class="number">16</span></span><br><span class="line">è°ƒæ¢ä½ç½®<span class="number">16</span>, <span class="number">34</span></span><br><span class="line">è°ƒæ¢å®Œä½ç½®çš„åˆ—è¡¨---&gt; [2, 5, 16, 78, 34, 56, 34]</span><br><span class="line">------------------------------------------------------</span><br><span class="line">å¾…æ“ä½œçš„åˆ—è¡¨---&gt; [2, 5, 16, 78, 34, 56, 34] æ“ä½œç´¢å¼•---&gt; 3</span><br><span class="line">------------------------------------------------------</span><br><span class="line"><span class="number">78</span> <span class="number">34</span></span><br><span class="line">è°ƒæ¢ä½ç½®<span class="number">34</span>, <span class="number">78</span></span><br><span class="line">è°ƒæ¢å®Œä½ç½®çš„åˆ—è¡¨---&gt; [2, 5, 16, 34, 78, 56, 34]</span><br><span class="line"><span class="number">34</span> <span class="number">56</span></span><br><span class="line"><span class="number">34</span> <span class="number">34</span></span><br><span class="line">------------------------------------------------------</span><br><span class="line">å¾…æ“ä½œçš„åˆ—è¡¨---&gt; [2, 5, 16, 34, 78, 56, 34] æ“ä½œç´¢å¼•---&gt; 4</span><br><span class="line">------------------------------------------------------</span><br><span class="line"><span class="number">78</span> <span class="number">56</span></span><br><span class="line">è°ƒæ¢ä½ç½®<span class="number">56</span>, <span class="number">78</span></span><br><span class="line">è°ƒæ¢å®Œä½ç½®çš„åˆ—è¡¨---&gt; [2, 5, 16, 34, 56, 78, 34]</span><br><span class="line"><span class="number">56</span> <span class="number">34</span></span><br><span class="line">è°ƒæ¢ä½ç½®<span class="number">34</span>, <span class="number">56</span></span><br><span class="line">è°ƒæ¢å®Œä½ç½®çš„åˆ—è¡¨---&gt; [2, 5, 16, 34, 34, 78, 56]</span><br><span class="line">------------------------------------------------------</span><br><span class="line">å¾…æ“ä½œçš„åˆ—è¡¨---&gt; [2, 5, 16, 34, 34, 78, 56] æ“ä½œç´¢å¼•---&gt; 5</span><br><span class="line">------------------------------------------------------</span><br><span class="line"><span class="number">78</span> <span class="number">56</span></span><br><span class="line">è°ƒæ¢ä½ç½®<span class="number">56</span>, <span class="number">78</span></span><br><span class="line">è°ƒæ¢å®Œä½ç½®çš„åˆ—è¡¨---&gt; [2, 5, 16, 34, 34, 56, 78]</span><br><span class="line">[<span class="number">2</span>, <span class="number">5</span>, <span class="number">16</span>, <span class="number">34</span>, <span class="number">34</span>, <span class="number">56</span>, <span class="number">78</span>]</span><br></pre></td></tr></table></figure>

<h2 id="æ•ˆç‡åˆ†æ-2"><a href="#æ•ˆç‡åˆ†æ-2" class="headerlink" title="æ•ˆç‡åˆ†æ"></a>æ•ˆç‡åˆ†æ</h2><ul>
<li>ä¸ç¨³å®š</li>
<li>ç©ºé—´å¤æ‚åº¦ï¼šO(1)</li>
<li>æ—¶é—´å¤æ‚åº¦ï¼šO(n2)</li>
<li>æœ€åæƒ…å†µï¼šO(n2) ç¬¬ä¸€ä¸ªå…ƒç´ ä¸ºæœ€å¤§å…ƒç´ ï¼Œå…¶ä½™å…ƒç´ æ­£åºï¼Œéœ€è¦äº¤æ¢n-1ä¸ªå…ƒç´ </li>
<li>æœ€å¥½æƒ…å†µï¼šO(n2) æ­£åºï¼Œä¸éœ€è¦äº¤æ¢å…ƒç´ </li>
</ul>
]]></content>
      <categories>
        <category>ç®—æ³•</category>
        <category>Python</category>
      </categories>
      <tags>
        <tag>å†’æ³¡æ’åº</tag>
        <tag>é€‰æ‹©æ’åº</tag>
        <tag>æ’å…¥æ’åº</tag>
        <tag>ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonæ—¥å¿—æ¨¡å—-logging</title>
    <url>/2016/06/08/Python%E6%97%A5%E5%BF%97%E6%A8%A1%E5%9D%97-logging/</url>
    <content><![CDATA[<blockquote>
<p>Pythonçš„loggingæ¨¡å—æä¾›äº†æ ‡å‡†çš„æ—¥å¿—æ¥å£ï¼Œä½ å¯ä»¥é€šè¿‡å®ƒä¾¿æ·åœ°è®°å½•å’Œå­˜å‚¨å„ç§æ ¼å¼çš„æ—¥å¿—ã€‚</p>
<p>Python Version: 3.5+</p>
</blockquote>
<h1 id="æ—¥å¿—çš„ç­‰çº§"><a href="#æ—¥å¿—çš„ç­‰çº§" class="headerlink" title="æ—¥å¿—çš„ç­‰çº§"></a>æ—¥å¿—çš„ç­‰çº§</h1><ol>
<li><strong>DEBUG</strong>    <em>Detailed information, typically of interest only when diagnosing problems.</em></li>
<li><strong>INFO</strong>    <em>Confirmation that things are working as expected.</em></li>
<li><strong>WARNING</strong>    <em>An indication that something unexpected happened, or indicative of some problem in the near future (e.g. â€˜disk space lowâ€™). The software is still working as expected.</em></li>
<li><strong>ERROR</strong>    <em>Due to a more serious problem, the software has not been able to perform some function.</em></li>
<li><strong>CRITICAL</strong>    <em>A serious error, indicating that the program itself may be unable to continue running.</em></li>
</ol>
<h1 id="logging"><a href="#logging" class="headerlink" title="logging"></a>logging</h1><h2 id="æœ€ç®€å•çš„ç”¨æ³•"><a href="#æœ€ç®€å•çš„ç”¨æ³•" class="headerlink" title="æœ€ç®€å•çš„ç”¨æ³•"></a>æœ€ç®€å•çš„ç”¨æ³•</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line">logging.warning(<span class="string">"user [ps] attempted wrong password more than 3 times"</span>)</span><br><span class="line">logging.critical(<span class="string">"server is down"</span>)</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">WARNING:root:user [ps] attempted wrong password more than <span class="number">3</span> times</span><br><span class="line">CRITICAL:root:server <span class="keyword">is</span> down</span><br></pre></td></tr></table></figure>


<h2 id="logging-basicConfig"><a href="#logging-basicConfig" class="headerlink" title="logging.basicConfig()"></a>logging.basicConfig()</h2><h3 id="filename"><a href="#filename" class="headerlink" title="filename"></a>filename</h3><p>Specifies that a FileHandler be created, using the specified<br>filename, rather than a StreamHandler</p>
<p>æ—¥å¿—å†™å…¥åˆ°æ–‡ä»¶ï¼Œæä¾›çš„æ–‡ä»¶åç§°</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line">logging.basicConfig(filename=<span class="string">'example.log'</span>)</span><br><span class="line">logging.debug(<span class="string">'This message should go to the log file'</span>)</span><br><span class="line">logging.info(<span class="string">'So should this'</span>)</span><br><span class="line">logging.warning(<span class="string">'And this, too'</span>)</span><br></pre></td></tr></table></figure>

<p><code>example.log</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">DEBUG:root:This message should go to the log file</span><br><span class="line">INFO:root:So should this</span><br><span class="line">WARNING:root:And this, too</span><br></pre></td></tr></table></figure>

<h3 id="level"><a href="#level" class="headerlink" title="level"></a>level</h3><p>Set the root logger level to the specified level.</p>
<p>è®¾ç½®æ—¥å¿—çº§åˆ«</p>
<p><code>bash cmd</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rm -fr example.log</span><br></pre></td></tr></table></figure>

<p><code>Python Code</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line">logging.basicConfig(filename=<span class="string">'example.log'</span>,level=logging.INFO)</span><br><span class="line">logging.debug(<span class="string">'This message should go to the log file'</span>)</span><br><span class="line">logging.info(<span class="string">'So should this'</span>)</span><br><span class="line">logging.warning(<span class="string">'And this, too'</span>)</span><br></pre></td></tr></table></figure>

<p><code>example.log</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">INFO:root:So should this</span><br><span class="line">WARNING:root:And this, too</span><br></pre></td></tr></table></figure>

<p>æ˜æ˜å†™äº†ä¸‰æ¡æ—¥å¿—ï¼Œæ€ä¹ˆä¼šåªæœ‰ä¸¤æ¡å†™å…¥äº†å‘¢ï¼Ÿ</p>
<p>åœ¨basicConfigä¸­è®¾ç½®äº†<code>level=logging.INFO</code>ï¼ŒPythonç¨‹åºä¸­ï¼Œåªæœ‰ä¸¥é‡çº§åˆ«å¤§äºç­‰äºINFOçº§åˆ«çš„æ—¥å¿—æ‰ä¼šè¢«å†™å…¥åˆ°æ—¥å¿—ä¸­</p>
<h3 id="filemode"><a href="#filemode" class="headerlink" title="filemode"></a>filemode</h3><p>Specifies the mode to open the file, if filename is specified(if filemode is unspecified, it defaults to â€˜aâ€™)</p>
<p>è®¾ç½®æ–‡ä»¶æ‰“å¼€çš„é»˜è®¤ï¼Œå¦‚æœä¸è®¾ç½®ï¼Œé»˜è®¤ä¸ºè¿½åŠ </p>
<p>åœ¨ä¸Šé¢çš„å°ä¾‹å­ä¹‹å‰ï¼Œæˆ‘æ‰‹åŠ¨åˆ é™¤äº†ä¹‹å‰å·²ç»ç”Ÿæˆçš„æ—¥å¿—æ–‡ä»¶ï¼Œç°åœ¨æˆ‘åœ¨ä¸åˆ é™¤æ–‡ä»¶çš„æƒ…å†µä¸‹ï¼Œå†æ¬¡æ‰§è¡Œä¸€éä¸Šé¢çš„ä»£ç ï¼Œæ—¥å¿—æ–‡ä»¶ä¼šè¢«è¿½åŠ </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">INFO:root:So should this</span><br><span class="line">WARNING:root:And this, too</span><br><span class="line">INFO:root:So should this</span><br><span class="line">WARNING:root:And this, too</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæ”¹æˆ<code>w</code>æ¯æ¬¡å†™å…¥æ—¥å¿—å‰ï¼Œè¯¥æ–‡ä»¶å†…å®¹éƒ½ä¼šè¢«æ¸…ç©º</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line">logging.basicConfig(filename=<span class="string">'example.log'</span>,filemode=<span class="string">'w'</span>, level=logging.INFO)</span><br><span class="line">logging.warning(<span class="string">"filemode='w'"</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">WARNING:root:filemode&#x3D;&#39;w&#39;</span><br></pre></td></tr></table></figure>

<h3 id="datefmt"><a href="#datefmt" class="headerlink" title="datefmt"></a>datefmt</h3><p>Use the specified date/time format.</p>
<p>ä½¿ç”¨timeæ¨¡å—çš„æ—¥æœŸæ ¼å¼æ¥æ ¼å¼åŒ–æ—¥æœŸæˆ–æ—¶é—´çš„æ˜¾ç¤º</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line">logging.basicConfig(format=<span class="string">'%(asctime)s %(message)s'</span>, datefmt=<span class="string">'%m/%d/%Y %I:%M:%S %p'</span>)</span><br><span class="line">logging.warning(<span class="string">'is when this event was logged.'</span>)</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line"><span class="number">12</span>/<span class="number">12</span>/<span class="number">2010</span> <span class="number">11</span>:<span class="number">46</span>:<span class="number">36</span> AM <span class="keyword">is</span> when this event was logged.</span><br></pre></td></tr></table></figure>

<h3 id="format"><a href="#format" class="headerlink" title="format"></a>format</h3><p>Use the specified format string for the handler.</p>
<p>æ—¥å¿—çš„æ ¼å¼è®¾ç½®</p>
<p>ä¸Šé¢çš„ä¾‹å­å·²ç»ç”¨åˆ°çš„æ—¶é—´çš„æ ¼å¼è¾“å‡ºåˆ°logï¼Œloggingæ¨¡å—ä¸­ï¼Œæœ‰å¦‚ä¸‹ä¿¡æ¯å¯ä»¥è¢«å†™å…¥åˆ°æ—¥å¿—</p>
<p><img src="http://oss.20150509.cn/20160608030759.png" alt=""></p>
<h3 id="å…¶ä»–å‚æ•°"><a href="#å…¶ä»–å‚æ•°" class="headerlink" title="å…¶ä»–å‚æ•°"></a>å…¶ä»–å‚æ•°</h3><ul>
<li><strong>stream</strong> <em>Use the specified stream to initialize the StreamHandler. Note that this argument is incompatible with â€˜filenameâ€™ - if both are present, â€˜streamâ€™ is ignored.</em></li>
<li><strong>handlers</strong> <em>If specified, this should be an iterable of already created handlers, which will be added to the root handler. Any handler in the list which does not have a formatter assigned will be assigned the formatter created in this function.</em></li>
</ul>
<p>ä»¥ä¸Šè¿™ä¸¤ä¸ªå‚æ•°ï¼Œåœ¨loggingå¯¹è±¡ä¸­ä½¿ç”¨çš„æƒ…å†µæ¯”è¾ƒå¤šï¼Œå°†åœ¨åé¢loggingå¯¹è±¡ä¸­ä»‹ç»å’Œä½¿ç”¨</p>
<h2 id="åŒæ—¶åœ¨ç»ˆç«¯å’Œæ—¥å¿—æ–‡ä»¶ä¸­è®°å½•æ—¥å¿—"><a href="#åŒæ—¶åœ¨ç»ˆç«¯å’Œæ—¥å¿—æ–‡ä»¶ä¸­è®°å½•æ—¥å¿—" class="headerlink" title="åŒæ—¶åœ¨ç»ˆç«¯å’Œæ—¥å¿—æ–‡ä»¶ä¸­è®°å½•æ—¥å¿—"></a>åŒæ—¶åœ¨ç»ˆç«¯å’Œæ—¥å¿—æ–‡ä»¶ä¸­è®°å½•æ—¥å¿—</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line"><span class="comment">#create logger</span></span><br><span class="line">logger = logging.getLogger(<span class="string">'TEST-LOG'</span>)</span><br><span class="line">logger.setLevel(logging.DEBUG)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># create console handler and set level to debug</span></span><br><span class="line">ch = logging.StreamHandler()</span><br><span class="line">ch.setLevel(logging.DEBUG)</span><br><span class="line"></span><br><span class="line"><span class="comment"># create file handler and set level to warning</span></span><br><span class="line">fh = logging.FileHandler(<span class="string">"access.log"</span>)</span><br><span class="line">fh.setLevel(logging.WARNING)</span><br><span class="line"><span class="comment"># create formatter</span></span><br><span class="line">formatter = logging.Formatter(<span class="string">'%(asctime)s - %(name)s - %(levelname)s - %(message)s'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># add formatter to ch and fh</span></span><br><span class="line">ch.setFormatter(formatter)</span><br><span class="line">fh.setFormatter(formatter)</span><br><span class="line"></span><br><span class="line"><span class="comment"># add ch and fh to logger</span></span><br><span class="line">logger.addHandler(ch)</span><br><span class="line">logger.addHandler(fh)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 'application' code</span></span><br><span class="line">logger.debug(<span class="string">'debug message'</span>)</span><br><span class="line">logger.info(<span class="string">'info message'</span>)</span><br><span class="line">logger.warn(<span class="string">'warn message'</span>)</span><br><span class="line">logger.error(<span class="string">'error message'</span>)</span><br><span class="line">logger.critical(<span class="string">'critical message'</span>)</span><br></pre></td></tr></table></figure>

<hr>
<p>é¦–å…ˆéœ€è¦åˆ›å»ºä¸€ä¸ªæ—¥å¿—å¯¹è±¡<code>logger = logging.getLogger(&#39;TEST-LOG&#39;)</code></p>
<p>æŸ¥çœ‹<code>getLogger</code>æºç </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getLogger</span><span class="params">(name=None)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Return a logger with the specified name, creating it if necessary.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    If no name is specified, return the root logger.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">if</span> name:</span><br><span class="line">        <span class="keyword">return</span> Logger.manager.getLogger(name)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> root</span><br></pre></td></tr></table></figure>

<p>æ­£å¸¸æƒ…å†µä¸‹returnäº†<code>Logger.manager.getLogger(name)</code></p>
<p>å†å»æ‰¾<code>manager</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Logger.manager = Manager(Logger.root)</span><br></pre></td></tr></table></figure>

<p><code>Logger.manager</code>æ˜¯<code>Manager</code>çš„å®ä¾‹åŒ–å¯¹è±¡ï¼Œå†å»æ‰¾<code>Manager</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Manager</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    There is [under normal circumstances] just one Manager instance, which</span></span><br><span class="line"><span class="string">    holds the hierarchy of loggers.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, rootnode)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Initialize the manager with the root node of the logger hierarchy.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self.root = rootnode</span><br><span class="line">        self.disable = <span class="number">0</span></span><br><span class="line">        self.emittedNoHandlerWarning = <span class="literal">False</span></span><br><span class="line">        self.loggerDict = &#123;&#125;</span><br><span class="line">        self.loggerClass = <span class="literal">None</span></span><br><span class="line">        self.logRecordFactory = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getLogger</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Get a logger with the specified name (channel name), creating it</span></span><br><span class="line"><span class="string">        if it doesn't yet exist. This name is a dot-separated hierarchical</span></span><br><span class="line"><span class="string">        name, such as "a", "a.b", "a.b.c" or similar.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        If a PlaceHolder existed for the specified name [i.e. the logger</span></span><br><span class="line"><span class="string">        didn't exist but a child of it did], replace it with the created</span></span><br><span class="line"><span class="string">        logger and fix up the parent/child references which pointed to the</span></span><br><span class="line"><span class="string">        placeholder to now point to the logger.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        rv = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> isinstance(name, str):</span><br><span class="line">            <span class="keyword">raise</span> TypeError(<span class="string">'A logger name must be a string'</span>)</span><br><span class="line">        _acquireLock()</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> name <span class="keyword">in</span> self.loggerDict:</span><br><span class="line">                rv = self.loggerDict[name]</span><br><span class="line">                <span class="keyword">if</span> isinstance(rv, PlaceHolder):</span><br><span class="line">                    ph = rv</span><br><span class="line">                    rv = (self.loggerClass <span class="keyword">or</span> _loggerClass)(name)</span><br><span class="line">                    rv.manager = self</span><br><span class="line">                    self.loggerDict[name] = rv</span><br><span class="line">                    self._fixupChildren(ph, rv)</span><br><span class="line">                    self._fixupParents(rv)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                rv = (self.loggerClass <span class="keyword">or</span> _loggerClass)(name)</span><br><span class="line">                rv.manager = self</span><br><span class="line">                self.loggerDict[name] = rv</span><br><span class="line">                self._fixupParents(rv)</span><br><span class="line">        <span class="keyword">finally</span>:</span><br><span class="line">            _releaseLock()</span><br><span class="line">        <span class="keyword">return</span> rv</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setLoggerClass</span><span class="params">(self, klass)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Set the class to be used when instantiating a logger with this Manager.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> klass != Logger:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> issubclass(klass, Logger):</span><br><span class="line">                <span class="keyword">raise</span> TypeError(<span class="string">"logger not derived from logging.Logger: "</span></span><br><span class="line">                                + klass.__name__)</span><br><span class="line">        self.loggerClass = klass</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setLogRecordFactory</span><span class="params">(self, factory)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Set the factory to be used when instantiating a log record with this</span></span><br><span class="line"><span class="string">        Manager.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self.logRecordFactory = factory</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_fixupParents</span><span class="params">(self, alogger)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Ensure that there are either loggers or placeholders all the way</span></span><br><span class="line"><span class="string">        from the specified logger to the root of the logger hierarchy.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        name = alogger.name</span><br><span class="line">        i = name.rfind(<span class="string">"."</span>)</span><br><span class="line">        rv = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">while</span> (i &gt; <span class="number">0</span>) <span class="keyword">and</span> <span class="keyword">not</span> rv:</span><br><span class="line">            substr = name[:i]</span><br><span class="line">            <span class="keyword">if</span> substr <span class="keyword">not</span> <span class="keyword">in</span> self.loggerDict:</span><br><span class="line">                self.loggerDict[substr] = PlaceHolder(alogger)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                obj = self.loggerDict[substr]</span><br><span class="line">                <span class="keyword">if</span> isinstance(obj, Logger):</span><br><span class="line">                    rv = obj</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">assert</span> isinstance(obj, PlaceHolder)</span><br><span class="line">                    obj.append(alogger)</span><br><span class="line">            i = name.rfind(<span class="string">"."</span>, <span class="number">0</span>, i - <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> rv:</span><br><span class="line">            rv = self.root</span><br><span class="line">        alogger.parent = rv</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_fixupChildren</span><span class="params">(self, ph, alogger)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Ensure that children of the placeholder ph are connected to the</span></span><br><span class="line"><span class="string">        specified logger.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        name = alogger.name</span><br><span class="line">        namelen = len(name)</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> ph.loggerMap.keys():</span><br><span class="line">            <span class="comment">#The if means ... if not c.parent.name.startswith(nm)</span></span><br><span class="line">            <span class="keyword">if</span> c.parent.name[:namelen] != name:</span><br><span class="line">                alogger.parent = c.parent</span><br><span class="line">                c.parent = alogger</span><br><span class="line"></span><br><span class="line"><span class="comment">#---------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#   Logger classes and functions</span></span><br><span class="line"><span class="comment">#---------------------------------------------------------------------------</span></span><br></pre></td></tr></table></figure>

<p>ç»ˆäºæ‰¾åˆ°äº†ï¼æ˜¯åœ¨ä¸Šé¢é‚£é‡Œåˆ›å»ºäº†ä¸€ä¸ªloggerå¯¹è±¡</p>
<p>ä»¥åä»£ç éƒ½æ˜¯ä½¿ç”¨è¿™ä¸ªloggerå¯¹è±¡æ¥æ“ä½œçš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¥çœ‹çœ‹ï¼Œè¿™ä¸ªloggerå¯¹è±¡é‡Œé¢éƒ½ç»™æˆ‘æä¾›äº†å“ªäº›ä¸œè¥¿~~</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Logger</span><span class="params">(Filterer)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Instances of the Logger class represent a single logging channel. A</span></span><br><span class="line"><span class="string">    "logging channel" indicates an area of an application. Exactly how an</span></span><br><span class="line"><span class="string">    "area" is defined is up to the application developer. Since an</span></span><br><span class="line"><span class="string">    application can have any number of areas, logging channels are identified</span></span><br><span class="line"><span class="string">    by a unique string. Application areas can be nested (e.g. an area</span></span><br><span class="line"><span class="string">    of "input processing" might include sub-areas "read CSV files", "read</span></span><br><span class="line"><span class="string">    XLS files" and "read Gnumeric files"). To cater for this natural nesting,</span></span><br><span class="line"><span class="string">    channel names are organized into a namespace hierarchy where levels are</span></span><br><span class="line"><span class="string">    separated by periods, much like the Java or Python package namespace. So</span></span><br><span class="line"><span class="string">    in the instance given above, channel names might be "input" for the upper</span></span><br><span class="line"><span class="string">    level, and "input.csv", "input.xls" and "input.gnu" for the sub-levels.</span></span><br><span class="line"><span class="string">    There is no arbitrary limit to the depth of nesting.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, level=NOTSET)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Initialize the logger with a name and an optional level.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        Filterer.__init__(self)</span><br><span class="line">        self.name = name</span><br><span class="line">        self.level = _checkLevel(level)</span><br><span class="line">        self.parent = <span class="literal">None</span></span><br><span class="line">        self.propagate = <span class="literal">True</span></span><br><span class="line">        self.handlers = []</span><br><span class="line">        self.disabled = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setLevel</span><span class="params">(self, level)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Set the logging level of this logger.  level must be an int or a str.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self.level = _checkLevel(level)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">debug</span><span class="params">(self, msg, *args, **kwargs)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Log 'msg % args' with severity 'DEBUG'.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        To pass exception information, use the keyword argument exc_info with</span></span><br><span class="line"><span class="string">        a true value, e.g.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        logger.debug("Houston, we have a %s", "thorny problem", exc_info=1)</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> self.isEnabledFor(DEBUG):</span><br><span class="line">            self._log(DEBUG, msg, args, **kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">info</span><span class="params">(self, msg, *args, **kwargs)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Log 'msg % args' with severity 'INFO'.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        To pass exception information, use the keyword argument exc_info with</span></span><br><span class="line"><span class="string">        a true value, e.g.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        logger.info("Houston, we have a %s", "interesting problem", exc_info=1)</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> self.isEnabledFor(INFO):</span><br><span class="line">            self._log(INFO, msg, args, **kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">warning</span><span class="params">(self, msg, *args, **kwargs)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Log 'msg % args' with severity 'WARNING'.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        To pass exception information, use the keyword argument exc_info with</span></span><br><span class="line"><span class="string">        a true value, e.g.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        logger.warning("Houston, we have a %s", "bit of a problem", exc_info=1)</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> self.isEnabledFor(WARNING):</span><br><span class="line">            self._log(WARNING, msg, args, **kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">warn</span><span class="params">(self, msg, *args, **kwargs)</span>:</span></span><br><span class="line">        warnings.warn(<span class="string">"The 'warn' method is deprecated, "</span></span><br><span class="line">            <span class="string">"use 'warning' instead"</span>, DeprecationWarning, <span class="number">2</span>)</span><br><span class="line">        self.warning(msg, *args, **kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">error</span><span class="params">(self, msg, *args, **kwargs)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Log 'msg % args' with severity 'ERROR'.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        To pass exception information, use the keyword argument exc_info with</span></span><br><span class="line"><span class="string">        a true value, e.g.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        logger.error("Houston, we have a %s", "major problem", exc_info=1)</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> self.isEnabledFor(ERROR):</span><br><span class="line">            self._log(ERROR, msg, args, **kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">exception</span><span class="params">(self, msg, *args, exc_info=True, **kwargs)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Convenience method for logging an ERROR with exception information.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self.error(msg, *args, exc_info=exc_info, **kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">critical</span><span class="params">(self, msg, *args, **kwargs)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Log 'msg % args' with severity 'CRITICAL'.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        To pass exception information, use the keyword argument exc_info with</span></span><br><span class="line"><span class="string">        a true value, e.g.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        logger.critical("Houston, we have a %s", "major disaster", exc_info=1)</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> self.isEnabledFor(CRITICAL):</span><br><span class="line">            self._log(CRITICAL, msg, args, **kwargs)</span><br><span class="line"></span><br><span class="line">    fatal = critical</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">log</span><span class="params">(self, level, msg, *args, **kwargs)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Log 'msg % args' with the integer severity 'level'.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        To pass exception information, use the keyword argument exc_info with</span></span><br><span class="line"><span class="string">        a true value, e.g.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        logger.log(level, "We have a %s", "mysterious problem", exc_info=1)</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> isinstance(level, int):</span><br><span class="line">            <span class="keyword">if</span> raiseExceptions:</span><br><span class="line">                <span class="keyword">raise</span> TypeError(<span class="string">"level must be an integer"</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> self.isEnabledFor(level):</span><br><span class="line">            self._log(level, msg, args, **kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findCaller</span><span class="params">(self, stack_info=False)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Find the stack frame of the caller so that we can note the source</span></span><br><span class="line"><span class="string">        file name, line number and function name.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        f = currentframe()</span><br><span class="line">        <span class="comment">#On some versions of IronPython, currentframe() returns None if</span></span><br><span class="line">        <span class="comment">#IronPython isn't run with -X:Frames.</span></span><br><span class="line">        <span class="keyword">if</span> f <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            f = f.f_back</span><br><span class="line">        rv = <span class="string">"(unknown file)"</span>, <span class="number">0</span>, <span class="string">"(unknown function)"</span>, <span class="literal">None</span></span><br><span class="line">        <span class="keyword">while</span> hasattr(f, <span class="string">"f_code"</span>):</span><br><span class="line">            co = f.f_code</span><br><span class="line">            filename = os.path.normcase(co.co_filename)</span><br><span class="line">            <span class="keyword">if</span> filename == _srcfile:</span><br><span class="line">                f = f.f_back</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            sinfo = <span class="literal">None</span></span><br><span class="line">            <span class="keyword">if</span> stack_info:</span><br><span class="line">                sio = io.StringIO()</span><br><span class="line">                sio.write(<span class="string">'Stack (most recent call last):\n'</span>)</span><br><span class="line">                traceback.print_stack(f, file=sio)</span><br><span class="line">                sinfo = sio.getvalue()</span><br><span class="line">                <span class="keyword">if</span> sinfo[<span class="number">-1</span>] == <span class="string">'\n'</span>:</span><br><span class="line">                    sinfo = sinfo[:<span class="number">-1</span>]</span><br><span class="line">                sio.close()</span><br><span class="line">            rv = (co.co_filename, f.f_lineno, co.co_name, sinfo)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">return</span> rv</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">makeRecord</span><span class="params">(self, name, level, fn, lno, msg, args, exc_info,</span></span></span><br><span class="line"><span class="function"><span class="params">                   func=None, extra=None, sinfo=None)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        A factory method which can be overridden in subclasses to create</span></span><br><span class="line"><span class="string">        specialized LogRecords.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        rv = _logRecordFactory(name, level, fn, lno, msg, args, exc_info, func,</span><br><span class="line">                             sinfo)</span><br><span class="line">        <span class="keyword">if</span> extra <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">for</span> key <span class="keyword">in</span> extra:</span><br><span class="line">                <span class="keyword">if</span> (key <span class="keyword">in</span> [<span class="string">"message"</span>, <span class="string">"asctime"</span>]) <span class="keyword">or</span> (key <span class="keyword">in</span> rv.__dict__):</span><br><span class="line">                    <span class="keyword">raise</span> KeyError(<span class="string">"Attempt to overwrite %r in LogRecord"</span> % key)</span><br><span class="line">                rv.__dict__[key] = extra[key]</span><br><span class="line">        <span class="keyword">return</span> rv</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_log</span><span class="params">(self, level, msg, args, exc_info=None, extra=None, stack_info=False)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Low-level logging routine which creates a LogRecord and then calls</span></span><br><span class="line"><span class="string">        all the handlers of this logger to handle the record.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        sinfo = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">if</span> _srcfile:</span><br><span class="line">            <span class="comment">#IronPython doesn't track Python frames, so findCaller raises an</span></span><br><span class="line">            <span class="comment">#exception on some versions of IronPython. We trap it here so that</span></span><br><span class="line">            <span class="comment">#IronPython can use logging.</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                fn, lno, func, sinfo = self.findCaller(stack_info)</span><br><span class="line">            <span class="keyword">except</span> ValueError: <span class="comment"># pragma: no cover</span></span><br><span class="line">                fn, lno, func = <span class="string">"(unknown file)"</span>, <span class="number">0</span>, <span class="string">"(unknown function)"</span></span><br><span class="line">        <span class="keyword">else</span>: <span class="comment"># pragma: no cover</span></span><br><span class="line">            fn, lno, func = <span class="string">"(unknown file)"</span>, <span class="number">0</span>, <span class="string">"(unknown function)"</span></span><br><span class="line">        <span class="keyword">if</span> exc_info:</span><br><span class="line">            <span class="keyword">if</span> isinstance(exc_info, BaseException):</span><br><span class="line">                exc_info = (type(exc_info), exc_info, exc_info.__traceback__)</span><br><span class="line">            <span class="keyword">elif</span> <span class="keyword">not</span> isinstance(exc_info, tuple):</span><br><span class="line">                exc_info = sys.exc_info()</span><br><span class="line">        record = self.makeRecord(self.name, level, fn, lno, msg, args,</span><br><span class="line">                                 exc_info, func, extra, sinfo)</span><br><span class="line">        self.handle(record)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle</span><span class="params">(self, record)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Call the handlers for the specified record.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        This method is used for unpickled records received from a socket, as</span></span><br><span class="line"><span class="string">        well as those created locally. Logger-level filtering is applied.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">not</span> self.disabled) <span class="keyword">and</span> self.filter(record):</span><br><span class="line">            self.callHandlers(record)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">addHandler</span><span class="params">(self, hdlr)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Add the specified handler to this logger.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        _acquireLock()</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> (hdlr <span class="keyword">in</span> self.handlers):</span><br><span class="line">                self.handlers.append(hdlr)</span><br><span class="line">        <span class="keyword">finally</span>:</span><br><span class="line">            _releaseLock()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">removeHandler</span><span class="params">(self, hdlr)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Remove the specified handler from this logger.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        _acquireLock()</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> hdlr <span class="keyword">in</span> self.handlers:</span><br><span class="line">                self.handlers.remove(hdlr)</span><br><span class="line">        <span class="keyword">finally</span>:</span><br><span class="line">            _releaseLock()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">hasHandlers</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        See if this logger has any handlers configured.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Loop through all handlers for this logger and its parents in the</span></span><br><span class="line"><span class="string">        logger hierarchy. Return True if a handler was found, else False.</span></span><br><span class="line"><span class="string">        Stop searching up the hierarchy whenever a logger with the "propagate"</span></span><br><span class="line"><span class="string">        attribute set to zero is found - that will be the last logger which</span></span><br><span class="line"><span class="string">        is checked for the existence of handlers.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        c = self</span><br><span class="line">        rv = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">while</span> c:</span><br><span class="line">            <span class="keyword">if</span> c.handlers:</span><br><span class="line">                rv = <span class="literal">True</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> c.propagate:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                c = c.parent</span><br><span class="line">        <span class="keyword">return</span> rv</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">callHandlers</span><span class="params">(self, record)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Pass a record to all relevant handlers.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Loop through all handlers for this logger and its parents in the</span></span><br><span class="line"><span class="string">        logger hierarchy. If no handler was found, output a one-off error</span></span><br><span class="line"><span class="string">        message to sys.stderr. Stop searching up the hierarchy whenever a</span></span><br><span class="line"><span class="string">        logger with the "propagate" attribute set to zero is found - that</span></span><br><span class="line"><span class="string">        will be the last logger whose handlers are called.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        c = self</span><br><span class="line">        found = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> c:</span><br><span class="line">            <span class="keyword">for</span> hdlr <span class="keyword">in</span> c.handlers:</span><br><span class="line">                found = found + <span class="number">1</span></span><br><span class="line">                <span class="keyword">if</span> record.levelno &gt;= hdlr.level:</span><br><span class="line">                    hdlr.handle(record)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> c.propagate:</span><br><span class="line">                c = <span class="literal">None</span>    <span class="comment">#break out</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                c = c.parent</span><br><span class="line">        <span class="keyword">if</span> (found == <span class="number">0</span>):</span><br><span class="line">            <span class="keyword">if</span> lastResort:</span><br><span class="line">                <span class="keyword">if</span> record.levelno &gt;= lastResort.level:</span><br><span class="line">                    lastResort.handle(record)</span><br><span class="line">            <span class="keyword">elif</span> raiseExceptions <span class="keyword">and</span> <span class="keyword">not</span> self.manager.emittedNoHandlerWarning:</span><br><span class="line">                sys.stderr.write(<span class="string">"No handlers could be found for logger"</span></span><br><span class="line">                                 <span class="string">" \"%s\"\n"</span> % self.name)</span><br><span class="line">                self.manager.emittedNoHandlerWarning = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getEffectiveLevel</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Get the effective level for this logger.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Loop through this logger and its parents in the logger hierarchy,</span></span><br><span class="line"><span class="string">        looking for a non-zero logging level. Return the first one found.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        logger = self</span><br><span class="line">        <span class="keyword">while</span> logger:</span><br><span class="line">            <span class="keyword">if</span> logger.level:</span><br><span class="line">                <span class="keyword">return</span> logger.level</span><br><span class="line">            logger = logger.parent</span><br><span class="line">        <span class="keyword">return</span> NOTSET</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">isEnabledFor</span><span class="params">(self, level)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Is this logger enabled for level 'level'?</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> self.manager.disable &gt;= level:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">return</span> level &gt;= self.getEffectiveLevel()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getChild</span><span class="params">(self, suffix)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Get a logger which is a descendant to this one.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        This is a convenience method, such that</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        logging.getLogger('abc').getChild('def.ghi')</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        is the same as</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        logging.getLogger('abc.def.ghi')</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        It's useful, for example, when the parent logger is named using</span></span><br><span class="line"><span class="string">        __name__ rather than a literal string.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> self.root <span class="keyword">is</span> <span class="keyword">not</span> self:</span><br><span class="line">            suffix = <span class="string">'.'</span>.join((self.name, suffix))</span><br><span class="line">        <span class="keyword">return</span> self.manager.getLogger(suffix)</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢å®ä¾‹ä¸­ç”¨åˆ°çš„<code>logger.setLevel</code> <code>logger.addHandler</code> <code>logger.debug</code> <code>logger.info</code> <code>logger.warn</code> <code>logger.error</code> <code>logger.critical</code> éƒ½æ˜¯è¿™é‡Œæä¾›çš„åŠŸèƒ½ï¼Œè¿™äº›éƒ½æ˜¯å¯¹è±¡æ–¹æ³•ï¼Œè®¾ç½®çš„å‚æ•°å’Œæ‰“å°çš„æ—¥å¿—éƒ½æ˜¯å¯¹è±¡çš„è¡Œä¸ºï¼Œä¸loggingç±»ä¸€å®šè¦åŒºåˆ†å¼€ï¼ˆlogging.basicConfigæ˜¯ç±»æ–¹æ³•ï¼Œlogger.setLevelæ˜¯å¯¹è±¡æ–¹æ³•ï¼‰</p>
<p><code>formatter = logging.Formatter(&#39;%(asctime)s - %(name)s - %(levelname)s - %(message)s&#39;)</code>ï¼Œè¿™å¥çš„æ„æ€æ˜¯ç”Ÿæˆäº†ä¸€ä¸ªformatterå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡ä¿å­˜äº†æ—¥å¿—è¾“å‡ºçš„æ ¼å¼ï¼Œå®ä¾‹ä¸­ï¼Œè¿™ä¸ªå¯¹è±¡è¢«å½“åšå‚æ•°ä¼ é€’åˆ°äº†<code>logging.StreamHandler()</code>å’Œ<code>logging.FileHandler(&quot;access.log&quot;)</code>å¯¹è±¡ä¸­ï¼Œæ„æ€æ˜¯å£°æ˜è®©è¿™ä¸¤ä¸ªæ—¥å¿—è¾“å‡ºå½¢å¼ä»¥<code>formatter</code>å¯¹è±¡æŒ‡å®šçš„æ ¼å¼è¿›è¡Œè¾“å‡º</p>
<p>æœ€åéœ€è¦è¯´æ˜çš„æ˜¯<code>logger.addHandler</code>, Handleræ˜¯è¾“å‡ºæ–¹å¼ï¼Œ<code>logging.StreamHandler()</code>æ˜¯è¾“å‡ºåˆ°å±å¹•çš„å¯¹è±¡ï¼ˆå¥æŸ„ï¼‰ï¼Œ<code>logging.FileHandler(&quot;access.log&quot;)</code>æ˜¯è¾“å‡ºåˆ°æ–‡ä»¶çš„å¯¹è±¡ï¼ˆå¥æŸ„ï¼‰ï¼Œä¸Šé¢çš„å®ä¾‹ä¸­ï¼Œå°†è¿™ä¸¤ä¸ªå¯¹è±¡éƒ½æ·»åŠ åˆ°äº†loggerå¯¹è±¡ä¸­ï¼Œæ‰€ä»¥ä½¿loggeræ‹¥æœ‰äº†æ—¢è¾“å‡ºåˆ°å±å¹•åˆå†™å…¥åˆ°æ—¥å¿—çš„èƒ½åŠ›ã€‚</p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Pythonæ¨¡å—</tag>
        <tag>logging</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonæ—¶é—´æ¨¡å—è¯¦è§£</title>
    <url>/2016/06/08/Python%E6%97%B6%E9%97%B4%E6%A8%A1%E5%9D%97%E8%AF%A6%E8%A7%A3/</url>
    <content><![CDATA[<blockquote>
<p>Pythonå¸¸ç”¨çš„è·Ÿæ—¶é—´ç›¸å…³çš„æ¨¡å—æœ‰ä¸¤ä¸ª<code>time</code>å’Œ<code>datetime</code></p>
<p>å…¶ä¸­<code>datetime</code>æ˜¯<code>time</code>æ¨¡å—æ›´é«˜å±‚æ¬¡çš„å°è£…ï¼Œåœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œä¸¤ä¸ªæ¨¡å—å„æœ‰åƒç§‹</p>
<p>Python Version: 3.5+</p>
</blockquote>
<h1 id="time"><a href="#time" class="headerlink" title="time"></a>time</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> time</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>time.time()  <span class="comment">#è·å–æ—¶é—´æˆ³ï¼Œä»1970å¹´1æœˆ1æ—¥0ï¼š00åˆ°ç°åœ¨çš„ç§’æ•°</span></span><br><span class="line"><span class="number">1465321187.56645</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>time.time() - <span class="number">86400</span>  <span class="comment">#å¯ä»¥æŒ‰éœ€ + - ç§’æ•°</span></span><br><span class="line"><span class="number">1465234811.8091</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>time.ctime()  <span class="comment">#è¿”å›'Wed Jun  8 01:42:41 2016'æ ¼å¼çš„æ—¥æœŸæ—¶é—´å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="string">'Wed Jun  8 01:42:41 2016'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>time.ctime() - <span class="number">86400</span>  <span class="comment">#æŠ¥é”™ï¼ctimeè¿”å›çš„å­—ç¬¦ä¸²ï¼Œæ˜¯ä¸èƒ½ + - çš„ </span></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;input&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">TypeError: unsupported operand type(s) <span class="keyword">for</span> -: <span class="string">'str'</span> <span class="keyword">and</span> <span class="string">'int'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>time.ctime(time.time() - <span class="number">86400</span>)  <span class="comment">#ctimeå¯ä»¥æ¥æ”¶æ—¶é—´æˆ³å‚æ•°å¹¶è½¬åŒ–ä¸ºæ—¥æœŸæ—¶é—´å­—ç¬¦ä¸²ï¼Œé€šè¿‡è¿™ä¸ªåŠŸèƒ½ï¼Œå¯ä»¥æŠŠæ—¶é—´æˆ³çš„æ—¶é—´è¿›è¡Œ + - åä¼ é€’ç»™ctimeè¿›è¡Œè½¬æ¢</span></span><br><span class="line"><span class="string">'Tue Jun  7 01:45:09 2016'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>time.gmtime() <span class="comment">#è¿”å›ä¸€ä¸ªæ ¼å¼åŒ–çš„æ—¶é—´å¯¹è±¡</span></span><br><span class="line">time.struct_time(tm_year=<span class="number">2016</span>, tm_mon=<span class="number">6</span>, tm_mday=<span class="number">7</span>, tm_hour=<span class="number">17</span>, tm_min=<span class="number">47</span>, tm_sec=<span class="number">1</span>, tm_wday=<span class="number">1</span>, tm_yday=<span class="number">159</span>, tm_isdst=<span class="number">0</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>type(time.gmtime())</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">time</span>.<span class="title">struct_time</span>'&gt;</span></span><br><span class="line"><span class="class">&gt;&gt;&gt; <span class="title">time</span>.<span class="title">gmtime</span><span class="params">(time.time<span class="params">()</span> - <span class="number">86400</span>)</span>  #ä¹Ÿå¯ä»¥é€šè¿‡ä¼ é€’æ—¶é—´æˆ³æ¥æ›´æ”¹æ—¶é—´</span></span><br><span class="line"><span class="class"><span class="title">time</span>.<span class="title">struct_time</span><span class="params">(tm_year=<span class="number">2016</span>, tm_mon=<span class="number">6</span>, tm_mday=<span class="number">6</span>, tm_hour=<span class="number">17</span>, tm_min=<span class="number">48</span>, tm_sec=<span class="number">27</span>, tm_wday=<span class="number">0</span>, tm_yday=<span class="number">158</span>, tm_isdst=<span class="number">0</span>)</span></span></span><br><span class="line"><span class="class">&gt;&gt;&gt; <span class="title">time</span>.<span class="title">gmtime</span><span class="params">()</span>[0]  #å¯ä»¥é€šè¿‡ç´¢å¼•çš„æ–¹å¼å»å–å€¼</span></span><br><span class="line"><span class="class">2016</span></span><br><span class="line"><span class="class">&gt;&gt;&gt; <span class="title">time</span>.<span class="title">gmtime</span><span class="params">()</span>[1]</span></span><br><span class="line"><span class="class">6</span></span><br><span class="line"><span class="class">&gt;&gt;&gt; <span class="title">time</span>.<span class="title">gmtime</span><span class="params">()</span>[2]  #é—®é¢˜æ¥äº†ï¼Œç°åœ¨å·²ç»æ˜¯8å·äº†å´è¿˜æ˜¾ç¤º7ï¼Œæ˜¯å› ä¸ºè¿™é‡Œæ˜¾ç¤ºçš„æ˜¯æ ¼æ—å¨æ²»æ—¶é—´ï¼Œä¸æ˜¯æœ¬åœ°æ—¶é—´</span></span><br><span class="line"><span class="class">7</span></span><br><span class="line"><span class="class">&gt;&gt;&gt; </span></span><br><span class="line"><span class="class">&gt;&gt;&gt; <span class="title">time</span>.<span class="title">localtime</span><span class="params">()</span>  #æœ¬åœ°æ—¶é—´æ¥äº†ï¼è¿™ä¸ªæ–¹æ³•æ˜¾ç¤ºçš„æ˜¯æœ¬åœ°æ—¶åŒºçš„æ—¶é—´ï¼è¿”å›çš„æ ¼å¼ä¸<span class="title">gmtime</span>æ˜¯ä¸€æ ·çš„ï¼Œç”¨æ³•ä¹Ÿä¸€æ ·</span></span><br><span class="line"><span class="class"><span class="title">time</span>.<span class="title">struct_time</span><span class="params">(tm_year=<span class="number">2016</span>, tm_mon=<span class="number">6</span>, tm_mday=<span class="number">8</span>, tm_hour=<span class="number">1</span>, tm_min=<span class="number">56</span>, tm_sec=<span class="number">5</span>, tm_wday=<span class="number">2</span>, tm_yday=<span class="number">160</span>, tm_isdst=<span class="number">0</span>)</span></span></span><br><span class="line"><span class="class">&gt;&gt;&gt; </span></span><br><span class="line"><span class="class">&gt;&gt;&gt; <span class="title">time</span>.<span class="title">mktime</span><span class="params">(time.localtime<span class="params">()</span>)</span>  #è¯¥æ–¹æ³•æ¥æ”¶ä¸€ä¸ª<span class="title">tuple</span>ç±»å‹çš„å‚æ•°ï¼Œå¯æ¥æ”¶<span class="title">struct_time</span>å¯¹è±¡å¹¶å°†å…¶è½¬åŒ–ä¸ºæ—¶é—´æˆ³</span></span><br><span class="line"><span class="class">1465322289.0</span></span><br><span class="line"><span class="class">&gt;&gt;&gt; </span></span><br><span class="line"><span class="class">&gt;&gt;&gt; <span class="title">time</span>.<span class="title">strftime</span><span class="params">(<span class="string">"%Y-%m-%d"</span>, time.localtime<span class="params">()</span>)</span>  #å°†<span class="title">struct_time</span>å¯¹è±¡ä»¥æŒ‡å®šçš„æ ¼å¼æ˜¾ç¤º</span></span><br><span class="line"><span class="class">'2016-06-08'</span></span><br><span class="line"><span class="class">&gt;&gt;&gt; <span class="title">time</span>.<span class="title">strptime</span><span class="params">(<span class="string">'2016-06-08'</span>, <span class="string">"%Y-%m-%d"</span>)</span>  #å°†æ—¥æœŸå­—ç¬¦ä¸²ä»¥æŒ‡å®šçš„æ ¼å¼è½¬åŒ–ä¸º<span class="title">struct_time</span>å¯¹è±¡</span></span><br><span class="line"><span class="class"><span class="title">time</span>.<span class="title">struct_time</span><span class="params">(tm_year=<span class="number">2016</span>, tm_mon=<span class="number">6</span>, tm_mday=<span class="number">8</span>, tm_hour=<span class="number">0</span>, tm_min=<span class="number">0</span>, tm_sec=<span class="number">0</span>, tm_wday=<span class="number">2</span>, tm_yday=<span class="number">160</span>, tm_isdst=<span class="number">-1</span>)</span></span></span><br><span class="line"><span class="class">&gt;&gt;&gt; </span></span><br><span class="line"><span class="class">&gt;&gt;&gt; <span class="title">time</span>.<span class="title">sleep</span><span class="params">(<span class="number">4</span>)</span> </span></span><br><span class="line"><span class="class">&gt;&gt;&gt; </span></span><br><span class="line"><span class="class">&gt;&gt;&gt; <span class="title">time</span>.<span class="title">clock</span><span class="params">()</span>  #åœ¨<span class="title">Unix</span>ç³»ç»Ÿä¸Šè¡¨ç¤ºè¿›ç¨‹æ—¶é—´ã€‚åœ¨<span class="title">Windows</span>ä¸Šç¬¬ä¸€æ¬¡è¿”å›è¿›ç¨‹æ—¶é—´ï¼Œç¬¬äºŒæ¬¡è¿”å›ç¬¬ä¸€æ¬¡åˆ°ç¬¬äºŒæ¬¡ä¹‹é—´çš„æ—¶é—´</span></span><br><span class="line"><span class="class">29.472588</span></span><br></pre></td></tr></table></figure>

<h1 id="datetime"><a href="#datetime" class="headerlink" title="datetime"></a>datetime</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>datetime.date.today()  <span class="comment">#2016-06-08</span></span><br><span class="line">datetime.date(<span class="number">2016</span>, <span class="number">6</span>, <span class="number">8</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(datetime.date.today())</span><br><span class="line"><span class="number">2016</span><span class="number">-06</span><span class="number">-08</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>datetime.date.fromtimestamp(time.time())  <span class="comment">#å°†æ—¶é—´æˆ³è½¬ä¸ºæ—¥æœŸæ ¼å¼</span></span><br><span class="line">datetime.date(<span class="number">2016</span>, <span class="number">6</span>, <span class="number">8</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>datetime.datetime.now() <span class="comment">#è¿”å›å½“å‰æ—¶é—´</span></span><br><span class="line">datetime.datetime(<span class="number">2016</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">2</span>, <span class="number">18</span>, <span class="number">57</span>, <span class="number">453874</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(datetime.datetime.now())</span><br><span class="line"><span class="number">2016</span><span class="number">-06</span><span class="number">-08</span> <span class="number">02</span>:<span class="number">19</span>:<span class="number">08.895585</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>datetime.datetime.now().timetuple()  <span class="comment">#è½¬åŒ–ä¸ºstruct_timeå¯¹è±¡</span></span><br><span class="line">time.struct_time(tm_year=<span class="number">2016</span>, tm_mon=<span class="number">6</span>, tm_mday=<span class="number">8</span>, tm_hour=<span class="number">2</span>, tm_min=<span class="number">20</span>, tm_sec=<span class="number">17</span>, tm_wday=<span class="number">2</span>, tm_yday=<span class="number">160</span>, tm_isdst=<span class="number">-1</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>datetime.datetime.now().replace(<span class="number">2015</span>, <span class="number">5</span>, <span class="number">9</span>)   <span class="comment">#æ›¿æ¢æŒ‡å®šçš„æ—¥æœŸæˆ–æ—¶é—´</span></span><br><span class="line">datetime.datetime(<span class="number">2015</span>, <span class="number">5</span>, <span class="number">9</span>, <span class="number">2</span>, <span class="number">21</span>, <span class="number">39</span>, <span class="number">897457</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>datetime.datetime.strptime(<span class="string">"09/05/15 7:56"</span>, <span class="string">"%d/%m/%y %H:%M"</span>)  <span class="comment">#å°†æ—¥æœŸæ—¶é—´å­—ç¬¦ä¸²è½¬ä¸ºæ—¶é—´æ ¼å¼ï¼Œå¹¶ä»¥æŒ‡å®šçš„æ ¼å¼è¿›è¡Œæ˜¾ç¤º</span></span><br><span class="line">datetime.datetime(<span class="number">2015</span>, <span class="number">5</span>, <span class="number">9</span>, <span class="number">7</span>, <span class="number">56</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>datetime.datetime.now() + datetime.timedelta(days=<span class="number">10</span>) <span class="comment">#æ¯”ç°åœ¨åŠ 10å¤©</span></span><br><span class="line">datetime.datetime(<span class="number">2016</span>, <span class="number">6</span>, <span class="number">18</span>, <span class="number">2</span>, <span class="number">26</span>, <span class="number">46</span>, <span class="number">45019</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>datetime.datetime.now() + datetime.timedelta(days=<span class="number">-10</span>) <span class="comment">#æ¯”ç°åœ¨å‡10å¤©</span></span><br><span class="line">datetime.datetime(<span class="number">2016</span>, <span class="number">5</span>, <span class="number">29</span>, <span class="number">2</span>, <span class="number">26</span>, <span class="number">53</span>, <span class="number">536217</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>datetime.datetime.now() + datetime.timedelta(hours=<span class="number">-10</span>) <span class="comment">#æ¯”ç°åœ¨å‡10å°æ—¶</span></span><br><span class="line">datetime.datetime(<span class="number">2016</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">16</span>, <span class="number">27</span>, <span class="number">0</span>, <span class="number">717995</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>datetime.datetime.now() + datetime.timedelta(seconds=<span class="number">120</span>) <span class="comment">#æ¯”ç°åœ¨+120s</span></span><br><span class="line">datetime.datetime(<span class="number">2016</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">2</span>, <span class="number">29</span>, <span class="number">7</span>, <span class="number">456727</span>)</span><br></pre></td></tr></table></figure>

<hr>
<ul>
<li>é™„å½•1ï¼š</li>
</ul>
<table>
<thead>
<tr>
<th>ç´¢å¼•ï¼ˆIndexï¼‰</th>
<th>å±æ€§ï¼ˆAttributeï¼‰</th>
<th>å€¼ï¼ˆValuesï¼‰</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>tm_yearï¼ˆå¹´ï¼‰</td>
<td>æ¯”å¦‚2011</td>
</tr>
<tr>
<td>1</td>
<td>tm_monï¼ˆæœˆï¼‰</td>
<td>1 - 12</td>
</tr>
<tr>
<td>2</td>
<td>tm_mdayï¼ˆæ—¥ï¼‰</td>
<td>1 - 31</td>
</tr>
<tr>
<td>3</td>
<td>tm_hourï¼ˆæ—¶ï¼‰</td>
<td>0 - 23</td>
</tr>
<tr>
<td>4</td>
<td>tm_minï¼ˆåˆ†ï¼‰</td>
<td>0 - 59</td>
</tr>
<tr>
<td>5</td>
<td>tm_secï¼ˆç§’ï¼‰</td>
<td>0 - 61</td>
</tr>
<tr>
<td>6</td>
<td>tm_wdayï¼ˆweekdayï¼‰</td>
<td>0 - 6ï¼ˆ0è¡¨ç¤ºå‘¨æ—¥ï¼‰</td>
</tr>
<tr>
<td>7</td>
<td>tm_ydayï¼ˆä¸€å¹´ä¸­çš„ç¬¬å‡ å¤©ï¼‰</td>
<td>1 - 366</td>
</tr>
<tr>
<td>8</td>
<td>tm_isdstï¼ˆæ˜¯å¦æ˜¯å¤ä»¤æ—¶ï¼‰</td>
<td>é»˜è®¤ä¸º-1</td>
</tr>
</tbody></table>
<ul>
<li>é™„å½•2ï¼š</li>
</ul>
<table>
<thead>
<tr>
<th>æ ¼å¼</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td>%a</td>
<td>æœ¬åœ°ï¼ˆlocaleï¼‰ç®€åŒ–æ˜ŸæœŸåç§°</td>
</tr>
<tr>
<td>%A</td>
<td>æœ¬åœ°å®Œæ•´æ˜ŸæœŸåç§°</td>
</tr>
<tr>
<td>%b</td>
<td>æœ¬åœ°ç®€åŒ–æœˆä»½åç§°</td>
</tr>
<tr>
<td>%B</td>
<td>æœ¬åœ°å®Œæ•´æœˆä»½åç§°</td>
</tr>
<tr>
<td>%c</td>
<td>æœ¬åœ°ç›¸åº”çš„æ—¥æœŸå’Œæ—¶é—´è¡¨ç¤º</td>
</tr>
<tr>
<td>%d</td>
<td>ä¸€ä¸ªæœˆä¸­çš„ç¬¬å‡ å¤©ï¼ˆ01 - 31ï¼‰</td>
</tr>
<tr>
<td>%H</td>
<td>ä¸€å¤©ä¸­çš„ç¬¬å‡ ä¸ªå°æ—¶ï¼ˆ24å°æ—¶åˆ¶ï¼Œ00 - 23ï¼‰</td>
</tr>
<tr>
<td>%I</td>
<td>ç¬¬å‡ ä¸ªå°æ—¶ï¼ˆ12å°æ—¶åˆ¶ï¼Œ01 - 12ï¼‰</td>
</tr>
<tr>
<td>%j</td>
<td>ä¸€å¹´ä¸­çš„ç¬¬å‡ å¤©ï¼ˆ001 - 366ï¼‰</td>
</tr>
<tr>
<td>%m</td>
<td>æœˆä»½ï¼ˆ01 - 12ï¼‰</td>
</tr>
<tr>
<td>%M</td>
<td>åˆ†é’Ÿæ•°ï¼ˆ00 - 59ï¼‰</td>
</tr>
<tr>
<td>%p</td>
<td>æœ¬åœ°amæˆ–è€…pmçš„ç›¸åº”ç¬¦</td>
</tr>
<tr>
<td>%S</td>
<td>ç§’ï¼ˆ01 - 61ï¼‰</td>
</tr>
<tr>
<td>%U</td>
<td>ä¸€å¹´ä¸­çš„æ˜ŸæœŸæ•°ã€‚ï¼ˆ00 - 53æ˜ŸæœŸå¤©æ˜¯ä¸€ä¸ªæ˜ŸæœŸçš„å¼€å§‹ã€‚ï¼‰ç¬¬ä¸€ä¸ªæ˜ŸæœŸå¤©ä¹‹å‰çš„æ‰€æœ‰å¤©æ•°éƒ½æ”¾åœ¨ç¬¬0å‘¨ã€‚</td>
</tr>
<tr>
<td>%w</td>
<td>ä¸€ä¸ªæ˜ŸæœŸä¸­çš„ç¬¬å‡ å¤©ï¼ˆ0 - 6ï¼Œ0æ˜¯æ˜ŸæœŸå¤©ï¼‰</td>
</tr>
<tr>
<td>%W</td>
<td>å’Œ%UåŸºæœ¬ç›¸åŒï¼Œä¸åŒçš„æ˜¯%Wä»¥æ˜ŸæœŸä¸€ä¸ºä¸€ä¸ªæ˜ŸæœŸçš„å¼€å§‹</td>
</tr>
<tr>
<td>%x</td>
<td>æœ¬åœ°ç›¸åº”æ—¥æœŸ</td>
</tr>
<tr>
<td>%X</td>
<td>æœ¬åœ°ç›¸åº”æ—¶é—´</td>
</tr>
<tr>
<td>%y</td>
<td>å»æ‰ä¸–çºªçš„å¹´ä»½ï¼ˆ00 - 99ï¼‰</td>
</tr>
<tr>
<td>%Y</td>
<td>å®Œæ•´çš„å¹´ä»½</td>
</tr>
<tr>
<td>%Z</td>
<td>æ—¶åŒºçš„åå­—ï¼ˆå¦‚æœä¸å­˜åœ¨ä¸ºç©ºå­—ç¬¦ï¼‰</td>
</tr>
<tr>
<td>%%</td>
<td>â€˜%â€™å­—ç¬¦</td>
</tr>
</tbody></table>
<ul>
<li>é™„å½•3ï¼štimeæ¨¡å—ï¼Œæ—¶é—´ä¹‹é—´çš„è½¬æ¢å…³ç³»</li>
</ul>
<p><img src="http://20150509.oss-cn-qingdao.aliyuncs.com/20160608021359.jpg" alt=""></p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Pythonæ¨¡å—</tag>
        <tag>time</tag>
        <tag>datetime</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonçš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–</title>
    <url>/2016/06/07/Python%E7%9A%84%E5%BA%8F%E5%88%97%E5%8C%96%E5%92%8C%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/</url>
    <content><![CDATA[<blockquote>
<p>åºåˆ—åŒ–ï¼ˆSerialzationï¼‰å°†å¯¹è±¡çš„çŠ¶æ€ä¿¡æ¯è½¬æ¢ä¸ºå¯ä»¥å­˜å‚¨æˆ–ä¼ è¾“çš„å½¢å¼çš„è¿‡ç¨‹å«åšåºåˆ—åŒ–ã€‚åä¹‹å°†è¯»å–åˆ°çš„æ–‡æœ¬ä¿¡æ¯è½¬æ¢ä¸ºå¯¹è±¡å«åšååºåˆ—åŒ–ã€‚æœ¬ç¯‡æ–‡ç« ä»‹ç»ä¸‰ç§Pythonä¸‹åºåˆ—åŒ–çš„æ–¹æ³•</p>
<p>Python Version: 3.5+</p>
</blockquote>
<h1 id="json"><a href="#json" class="headerlink" title="json"></a>json</h1><p>jsonæ˜¯å½“ä»Šæœ€æµè¡Œçš„åºåˆ—åŒ–æ ¼å¼ä¹‹ä¸€ï¼Œæ‹¥æœ‰è¶…è½»é‡çº§çš„æ•°æ®äº¤æ¢æ ¼å¼ã€‚ç”±äºjsonçš„è·¨å¹³å°ï¼Œè·¨è¯­è¨€äº¤æ¢ä¿¡æ¯çš„ç‰¹æ€§ï¼Œåœ¨jsonä¸­çš„å­—ç¬¦ä¸²å¿…é¡»ä½¿ç”¨åŒå¼•å·å¼•èµ·æ¥ï¼Œåœ¨æœ‰çš„è¯­è¨€ä¸­æœ‰æ˜ç¡®çš„å®šä¹‰ï¼Œå•å¼•å·åªèƒ½è¡¨ç¤ºå•ä¸ªå­—ç¬¦ï¼Œæ‰€ä»¥åœ¨jsonä¸­ä½¿ç”¨å•å¼•å·ä¼šäº§ç”Ÿæ„æƒ³ä¸åˆ°çš„æ•ˆæœ~~</p>
<p>jsonå¯ä»¥è½¬åŒ–çš„Pythonå¯¹è±¡æœ‰ï¼š</p>
<ul>
<li>list</li>
<li>dict</li>
</ul>
<p>æœ¬ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»jsonçš„4ä¸ªæ–¹æ³•ï¼š</p>
<ul>
<li>dumps() ç›´æ¥æ“ä½œPythonçš„æ•°æ®ç±»å‹è½¬æ¢æˆjsonå­—ç¬¦ä¸²</li>
<li>loads() ç›´æ¥å°†jsonå­—ç¬¦ä¸²è½¬æ¢ä¸ºPythonçš„æ•°æ®ç±»å‹</li>
<li>dump() å…ˆå°†Pythonçš„æ•°æ®ç±»å‹è½¬æ¢æˆjsonå­—ç¬¦ä¸²ï¼Œå†å†™å…¥æ–‡ä»¶</li>
<li>load() å…ˆä»æ–‡ä»¶ä¸­è¯»å–jsonå­—ç¬¦ä¸²ï¼Œå†è£…æ¢ä¸ºPythonçš„æ•°æ®ç±»å‹</li>
</ul>
<h2 id="dumps"><a href="#dumps" class="headerlink" title="dumps()"></a>dumps()</h2><p>å°†listæˆ–dictå¯¹è±¡åºåˆ—åŒ–æˆjsonæ ¼å¼çš„å­—ç¬¦ä¸²</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">d = &#123;<span class="string">'k1'</span>: <span class="string">'v1'</span>&#125;</span><br><span class="line">print(d, type(d))</span><br><span class="line"></span><br><span class="line">result = json.dumps(d)</span><br><span class="line">print(result, type(result))</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">&#123;<span class="string">'k1'</span>: <span class="string">'v1'</span>&#125; &lt;<span class="class"><span class="keyword">class</span> '<span class="title">dict</span>'&gt;</span></span><br><span class="line">&#123;"k1": "v1"&#125; &lt;class 'str'&gt;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼šä¸Šé¢å·²ç»å¼ºè°ƒäº†ï¼Œåœ¨jsonä¸­çš„å­—ç¬¦ä¸²å¿…é¡»ä½¿ç”¨åŒå¼•å·ã€‚åœ¨ä¸Šé¢çš„å°ä¾‹å­ä¸­ï¼Œæˆ‘åœ¨åˆ›å»ºPythonå­—å…¸çš„æ—¶å€™ä½¿ç”¨äº†å•å¼•å·ï¼Œä½†æ˜¯åœ¨åºåˆ—åŒ–æˆjsonæ ¼å¼æ—¶ï¼Œjsonè‡ªåŠ¨å¸®æˆ‘ä»¬æ¢ä¸Šäº†åŒå¼•å·ã€‚</p>
<h2 id="loads"><a href="#loads" class="headerlink" title="loads()"></a>loads()</h2><p>å°†jsonæ ¼å¼çš„å­—ç¬¦ä¸²ååºåˆ—åŒ–æˆlistæˆ–dictå¯¹è±¡</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">s = <span class="string">'&#123;"k1": "v1"&#125;'</span></span><br><span class="line">print(s, type(s))</span><br><span class="line"></span><br><span class="line">d = json.loads(s)</span><br><span class="line">print(d, type(d))</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">&#123;<span class="string">"k1"</span>: <span class="string">"v1"</span>&#125; &lt;<span class="class"><span class="keyword">class</span> '<span class="title">str</span>'&gt;</span></span><br><span class="line">&#123;'k1': 'v1'&#125; &lt;class 'dict'&gt;</span><br></pre></td></tr></table></figure>

<h2 id="dump"><a href="#dump" class="headerlink" title="dump()"></a>dump()</h2><p>å°†listæˆ–dictå¯¹è±¡è½¬æ¢ä¸ºjsonæ ¼å¼çš„å­—ç¬¦ä¸²å¹¶å†™å…¥åˆ°æ–‡ä»¶ä¸­</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">d = &#123;<span class="string">'k1'</span>: <span class="string">'v1'</span>&#125;</span><br><span class="line">print(d, type(d))</span><br><span class="line"></span><br><span class="line">result = json.dump(d, open(<span class="string">'a.json'</span>, <span class="string">'w'</span>))</span><br><span class="line">print(result, type(result))</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">&#123;<span class="string">'k1'</span>: <span class="string">'v1'</span>&#125; &lt;<span class="class"><span class="keyword">class</span> '<span class="title">dict</span>'&gt;</span></span><br><span class="line"><span class="class"><span class="title">None</span> &lt;<span class="title">class</span> '<span class="title">NoneType</span>'&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨dumpå†™å…¥æ–‡ä»¶åï¼Œä¸å†æœ‰è¿”å›å€¼</p>
<p><code>cat a.json</code></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;<span class="attr">"k1"</span>: <span class="string">"v1"</span>&#125;</span><br></pre></td></tr></table></figure>

<h2 id="load"><a href="#load" class="headerlink" title="load()"></a>load()</h2><p>å°†æ–‡ä»¶ä¸­jsonæ ¼å¼çš„å­—ç¬¦ä¸²è½¬åŒ–ä¸ºPythonçš„listæˆ–dictå¯¹è±¡</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">d = json.load(open(<span class="string">'a.json'</span>, <span class="string">'r'</span>))</span><br><span class="line">print(d, type(d))</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">&#123;<span class="string">'k1'</span>: <span class="string">'v1'</span>&#125; &lt;<span class="class"><span class="keyword">class</span> '<span class="title">dict</span>'&gt;</span></span><br></pre></td></tr></table></figure>



<h1 id="pickle"><a href="#pickle" class="headerlink" title="pickle"></a>pickle</h1><p>pickleæ˜¯Pythonè¯­è¨€è‡ªå·±çš„åºåˆ—åŒ–æ–¹å¼ï¼Œå…¶ä¼˜ç‚¹æ˜¯å¯ä»¥åºåˆ—åŒ–ä»»ä½•Pythonå¯¹è±¡ï¼Œä¸ä»…é™äºjsonçš„listå’Œdictã€‚æˆ‘ä»¬è¯´Pythonæ˜¯é¢å‘å¯¹è±¡è¯­è¨€ï¼Œä¸‡ç‰©çš†å¯¹è±¡ï¼Œé‚£ä¹ˆå¯¹äºpickleæ¥è¯´å°±æ˜¯Pythonçš„ä¸‡ç‰©çš†å¯åºåˆ—åŒ–ã€‚è¿™æ—¢æ˜¯å®ƒçš„ä¼˜ç‚¹ï¼Œä¹Ÿæ˜¯å®ƒçš„ç¼ºç‚¹ï¼Œç”±äºpickleæ˜¯Pythonè‡ªå·±çš„åºåˆ—åŒ–æ–¹å¼ï¼Œå®ƒä¸æ”¯æŒä¸å…¶ä»–è¯­è¨€çš„ä¿¡æ¯äº¤æ¢ã€‚jsonå¯ä»¥è·¨è¯­è¨€è¿›è¡Œä¿¡æ¯äº¤æ¢ï¼Œä½†æ˜¯pickleä¸è¡Œï¼Œpickleåªèƒ½åœ¨Pythonè¯­è¨€ä¸‹è¿›è¡Œä¿¡æ¯çš„äº¤æ¢ï¼Œè€Œä¸”Pythonçš„ç‰ˆæœ¬ä¸åŒï¼Œå¯¹pickleæ¥è¯´å¯èƒ½è¿˜ä¼šæœ‰å…¼å®¹æ€§çš„é—®é¢˜ã€‚</p>
<p>æœ¬ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»pickleçš„4ä¸ªæ–¹æ³•ï¼š</p>
<ul>
<li>dumps()</li>
<li>loads()</li>
<li>dump()</li>
<li>load()</li>
</ul>
<h2 id="dumps-1"><a href="#dumps-1" class="headerlink" title="dumps()"></a>dumps()</h2><p>å°†ä»»ä½•Pythonå¯¹è±¡è½¬åŒ–æˆäºŒè¿›åˆ¶å­—èŠ‚ç±»å‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">u = User()</span><br><span class="line">ret = pickle.dumps(u)</span><br><span class="line">print(ret, type(ret))</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line"><span class="string">b'\x80\x03c__main__\nUser\nq\x00)\x81q\x01.'</span> &lt;<span class="class"><span class="keyword">class</span> '<span class="title">bytes</span>'&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="loads-1"><a href="#loads-1" class="headerlink" title="loads()"></a>loads()</h2><p>å°†äºŒè¿›åˆ¶å­—èŠ‚ç±»å‹çš„æ•°æ®è½¬åŒ–ä¸ºPythonå¯¹è±¡</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">u = User()</span><br><span class="line">ret = pickle.dumps(u)</span><br><span class="line">print(ret, type(ret))</span><br><span class="line"></span><br><span class="line">o = pickle.loads(ret)</span><br><span class="line">print(o, type(o))</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line"><span class="string">b'\x80\x03c__main__\nUser\nq\x00)\x81q\x01.'</span> &lt;<span class="class"><span class="keyword">class</span> '<span class="title">bytes</span>'&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">__main__</span>.<span class="title">User</span> <span class="title">object</span> <span class="title">at</span> 0<span class="title">x101b78a90</span>&gt; &lt;<span class="title">class</span> '<span class="title">__main__</span>.<span class="title">User</span>'&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="dump-1"><a href="#dump-1" class="headerlink" title="dump()"></a>dump()</h2><p>å°†Pythonå¯¹è±¡è½¬åŒ–æˆäºŒè¿›åˆ¶å­—èŠ‚ï¼Œå†å†™å…¥åˆ°æ–‡ä»¶</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"></span><br><span class="line">u = (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">ret = pickle.dump(u, open(<span class="string">'a.pkl'</span>, <span class="string">'wb'</span>))</span><br><span class="line">print(ret, type(ret))</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line"><span class="literal">None</span> &lt;<span class="class"><span class="keyword">class</span> '<span class="title">NoneType</span>'&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼šç”±äºpickleæŠŠå¯¹è±¡è½¬åŒ–æˆäº†äºŒè¿›åˆ¶çš„å­—èŠ‚ï¼Œæ‰€ä»¥åœ¨å†™å…¥æ–‡ä»¶çš„æ—¶å€™ï¼Œä¸€å®šè¦åŠ ä¸Š<code>b</code></p>
<h2 id="load-1"><a href="#load-1" class="headerlink" title="load()"></a>load()</h2><p>è¯»å–æ–‡ä»¶ä¸­çš„äºŒè¿›åˆ¶å­—èŠ‚ï¼Œå°†å…¶è½¬åŒ–ä¸ºPythonå¯¹è±¡</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"></span><br><span class="line">o = pickle.load(open(<span class="string">'a.pkl'</span>, <span class="string">'rb'</span>))</span><br><span class="line">print(o, type(o))</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>) &lt;<span class="class"><span class="keyword">class</span> '<span class="title">tuple</span>'&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼šè¯»å–çš„æ—¶å€™ä¹Ÿè¦åŠ ä¸Š<code>b</code></p>
<h1 id="YAML"><a href="#YAML" class="headerlink" title="YAML"></a>YAML</h1><p>YAMLæ ¼å¼æ˜¯æœ€è¿‘å‡ å¹´å¤§çº¢å¤§ç´«çš„äº¤æ¢æ ¼å¼ï¼Œä½œä¸ºè¿ç»´ï¼Œæœ€ç›´è§‚çš„æ„Ÿè§‰å°±æ˜¯ä»è¿ç»´è‡ªåŠ¨åŒ–æ¦‚å¿µçš„å¼€å§‹ï¼Œåˆ°å®¹å™¨æŠ€æœ¯çš„æ™®åŠï¼Œè®©YAMLçš„ä½¿ç”¨é¢‘ç‡ä¸€é«˜å†é«˜ã€‚YAMLæ‹¥æœ‰æ¯”jsonæ›´é«˜çš„å¯è¯»æ€§ï¼Œå°¤å…¶ç”¨åœ¨é…ç½®æ–‡ä»¶ï¼ˆå¦‚saltstackï¼Œdockeræè¿°æ–‡ä»¶ç­‰ï¼‰åœ¨åˆé€‚ä¸è¿‡äº†ï¼</p>
<p>æœ¬ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»YAMLçš„ä¸¤ä¸ªæ–¹æ³•ï¼š</p>
<ul>
<li>dump()</li>
<li>load()</li>
</ul>
<p>ç”±äºYAMLç»å¤§éƒ¨åˆ†çš„æ˜¯å¯¹æ–‡ä»¶æ¥æ“ä½œï¼Œæ‰€ä»¥è¿™é‡Œä»‹ç»æ—¶è°ƒæ¢ä¸€ä¸‹é¡ºåºï¼Œå…ˆä»‹ç»load()</p>
<p>é¦–å…ˆå†™ä¸€ä¸ªYAMLçš„é…ç½®æ–‡ä»¶å‡ºæ¥<code>conf.yml</code></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="attr">host1:</span></span><br><span class="line">  <span class="attr">IP:</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line">  <span class="attr">app:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">httpd</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">mysql</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">php</span></span><br><span class="line">  <span class="attr">memory:</span> <span class="string">16G</span></span><br><span class="line"></span><br><span class="line"><span class="attr">host2:</span></span><br><span class="line">  <span class="attr">IP:</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.2</span></span><br><span class="line">  <span class="attr">app:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">logstash</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">kibana</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">elasticsearch</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">kafka</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">zookeeper</span></span><br><span class="line">  <span class="attr">memory:</span> <span class="string">128G</span></span><br></pre></td></tr></table></figure>

<h2 id="load-2"><a href="#load-2" class="headerlink" title="load()"></a>load()</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> yaml</span><br><span class="line"></span><br><span class="line">o = yaml.load(open(<span class="string">'conf.yml'</span>))</span><br><span class="line">print(o, type(o))</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">&#123;<span class="string">'host1'</span>: &#123;<span class="string">'app'</span>: [<span class="string">'httpd'</span>, <span class="string">'mysql'</span>, <span class="string">'php'</span>], <span class="string">'IP'</span>: <span class="string">'192.168.1.1'</span>, <span class="string">'memory'</span>: <span class="string">'16G'</span>&#125;, <span class="string">'host2'</span>: &#123;<span class="string">'app'</span>: [<span class="string">'logstash'</span>, <span class="string">'kibana'</span>, <span class="string">'elasticsearch'</span>, <span class="string">'kafka'</span>, <span class="string">'zookeeper'</span>], <span class="string">'IP'</span>: <span class="string">'192.168.1.2'</span>, <span class="string">'memory'</span>: <span class="string">'128G'</span>&#125;&#125; &lt;<span class="class"><span class="keyword">class</span> '<span class="title">dict</span>'&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="dump-2"><a href="#dump-2" class="headerlink" title="dump()"></a>dump()</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> yaml</span><br><span class="line"></span><br><span class="line">o = yaml.load(open(<span class="string">'conf.yml'</span>))</span><br><span class="line"></span><br><span class="line">o[<span class="string">'host3'</span>] = &#123;<span class="string">'app'</span>: [<span class="string">'docker'</span>, <span class="string">'jenkins'</span>], <span class="string">'IP'</span>: <span class="string">'192.168.1.3'</span>, <span class="string">'memory'</span>: <span class="string">'64G'</span>&#125;</span><br><span class="line">yaml.dump(o, open(<span class="string">'conf.yml'</span>, <span class="string">'w'</span>))</span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">host1:</span></span><br><span class="line">  <span class="attr">IP:</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line">  <span class="attr">app:</span> <span class="string">[httpd,</span> <span class="string">mysql,</span> <span class="string">php]</span></span><br><span class="line">  <span class="attr">memory:</span> <span class="string">16G</span></span><br><span class="line"><span class="attr">host2:</span></span><br><span class="line">  <span class="attr">IP:</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.2</span></span><br><span class="line">  <span class="attr">app:</span> <span class="string">[logstash,</span> <span class="string">kibana,</span> <span class="string">elasticsearch,</span> <span class="string">kafka,</span> <span class="string">zookeeper]</span></span><br><span class="line">  <span class="attr">memory:</span> <span class="string">128G</span></span><br><span class="line"><span class="attr">host3:</span></span><br><span class="line">  <span class="attr">IP:</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.3</span></span><br><span class="line">  <span class="attr">app:</span> <span class="string">[docker,</span> <span class="string">jenkins]</span></span><br><span class="line">  <span class="attr">memory:</span> <span class="string">64G</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥ä½¿ç”¨<code>default_flow_style=False</code>æ¥ä¿è¯é«˜å¯è¯»æ€§</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> yaml</span><br><span class="line"></span><br><span class="line">o = yaml.load(open(<span class="string">'conf.yml'</span>))</span><br><span class="line"></span><br><span class="line">o[<span class="string">'host3'</span>] = &#123;<span class="string">'app'</span>: [<span class="string">'docker'</span>, <span class="string">'jenkins'</span>], <span class="string">'IP'</span>: <span class="string">'192.168.1.3'</span>, <span class="string">'memory'</span>: <span class="string">'64G'</span>&#125;</span><br><span class="line"><span class="comment">#yaml.dump(o, open('conf.yml', 'w'))</span></span><br><span class="line">yaml.dump(o, open(<span class="string">'conf.yml'</span>, <span class="string">'w'</span>), default_flow_style=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">host1:</span></span><br><span class="line">  <span class="attr">IP:</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line">  <span class="attr">app:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">httpd</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">mysql</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">php</span></span><br><span class="line">  <span class="attr">memory:</span> <span class="string">16G</span></span><br><span class="line"><span class="attr">host2:</span></span><br><span class="line">  <span class="attr">IP:</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.2</span></span><br><span class="line">  <span class="attr">app:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">logstash</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">kibana</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">elasticsearch</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">kafka</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">zookeeper</span></span><br><span class="line">  <span class="attr">memory:</span> <span class="string">128G</span></span><br><span class="line"><span class="attr">host3:</span></span><br><span class="line">  <span class="attr">IP:</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.3</span></span><br><span class="line">  <span class="attr">app:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">docker</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">jenkins</span></span><br><span class="line">  <span class="attr">memory:</span> <span class="string">64G</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>YAML</tag>
        <tag>Pythonæ¨¡å—</tag>
        <tag>åºåˆ—åŒ–</tag>
        <tag>ååºåˆ—åŒ–</tag>
        <tag>pickle</tag>
        <tag>json</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonçš„è¿­ä»£å™¨å’Œç”Ÿæˆå™¨</title>
    <url>/2016/06/07/Python%E7%9A%84%E8%BF%AD%E4%BB%A3%E5%99%A8%E5%92%8C%E7%94%9F%E6%88%90%E5%99%A8/</url>
    <content><![CDATA[<blockquote>
<p>Python Versionï¼š3.5+</p>
</blockquote>
<h1 id="ç”Ÿæˆå™¨"><a href="#ç”Ÿæˆå™¨" class="headerlink" title="ç”Ÿæˆå™¨"></a>ç”Ÿæˆå™¨</h1><p>ä¸€ä¸ªå‡½æ•°è°ƒç”¨æ—¶è¿”å›ä¸€ä¸ªè¿­ä»£å™¨ï¼ˆå¯è¿­ä»£çš„å¯¹è±¡ï¼‰ï¼Œé‚£è¿™ä¸ªå‡½æ•°å°±å«åšç”Ÿæˆå™¨ï¼ˆgeneratorï¼‰ï¼›å¦‚æœå‡½æ•°ä¸­åŒ…å«yieldè¯­æ³•ï¼Œé‚£è¿™ä¸ªå‡½æ•°å°±ä¼šå˜æˆç”Ÿæˆå™¨ï¼›</p>
<p>åœ¨å‡½æ•°ä¸­ï¼Œæœ‰returnè¯­å¥ï¼Œåœ¨æ‰§è¡Œå‡½æ•°çš„æ—¶å€™ï¼Œä¸€æ—¦æ‰§è¡Œåˆ°returnè¯­å¥ï¼Œå‡½æ•°ä¼šç«‹å³è¿”å›ç»“æœå¹¶é€€å‡ºå‡½æ•°ï¼›è€Œå¦‚æœä½¿ç”¨äº†yieldè¯­å¥ï¼Œå½“å‡½æ•°æ‰§è¡Œåˆ°yieldæ—¶ï¼Œä¼šç«‹å³å°†yieldåçš„å€¼è¿”å›ï¼Œå¹¶ç­‰å¾…ä¸‹ä¸€æ¬¡è°ƒç”¨ã€‚</p>
<p>å½¢è±¡ç‚¹æ¥è¯´ï¼Œreturnç›¸å½“äºæŒ‰ä¸‹äº†åœæ­¢é”®ï¼›è€Œyieldç›¸å½“äºæŒ‰ä¸‹äº†æš‚åœé”®ã€‚ä»–ä»¬ä¹‹é—´çš„åŒºåˆ«å°±åœ¨äºï¼Œæš‚åœé”®æ˜¯å¯ä»¥ç»§ç»­æ’­æ”¾çš„ï¼Œè€Œåœæ­¢äº†ä¹‹åå†æ’­æ”¾éœ€è¦ä»å¤´æ’­æ”¾ã€‚</p>
<p><strong>æ„Ÿå—ä¸€ä¸‹ç”Ÿæˆå™¨</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="number">2</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="number">3</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="number">4</span></span><br><span class="line"></span><br><span class="line">f = func()</span><br><span class="line"></span><br><span class="line">print(type(f))</span><br><span class="line">print(f.__next__())</span><br><span class="line">print(f.__next__())</span><br><span class="line">print(f.__next__())</span><br><span class="line">print(f.__next__())</span><br><span class="line">print(f.__next__())</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"/Users/lvrui/PycharmProjects/untitled/5/test.py"</span>, line <span class="number">85</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    print(f.__next__())</span><br><span class="line">StopIteration</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„<code>f.__next__()</code>å°±ç›¸å½“äºâ€œæ’­æ”¾â€é”®ï¼Œæ¯æ‰§è¡Œä¸€æ¬¡ï¼Œéƒ½ä¼šè®©å‡½æ•°ä»ä¸Šæ¬¡åœæ­¢çš„ä½ç½®ç»§ç»­æ‰§è¡Œã€‚å‡½æ•°ä¸­ï¼Œå®šä¹‰äº†ä¸€å…±å¯ä»¥æœ‰å››æ¬¡æš‚åœé”®ï¼Œè€Œæˆ‘åœ¨è°ƒç”¨æ—¶ï¼ŒæŒ‰äº†äº”æ¬¡æ’­æ”¾é”®ï¼Œåˆ°æœ€åï¼ŒæŠ›å‡ºäº†StopIterationå¼‚å¸¸ï¼Œè¯´æ˜è¯¥è¿­ä»£å¯¹è±¡å·²ç»éå†å®Œæ¯•ã€‚</p>
<p>å®ä¾‹ï¼šå°†åˆ—è¡¨è¿›è¡Œæ‹†åˆ†ï¼Œä¾‹å¦‚[1, 2, 3]æ‹†åˆ†æˆ[1, 2] [2, 3]</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mylist</span><span class="params">(li)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(li) - <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">yield</span> (li[i], li[i + <span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">li = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]</span><br><span class="line"></span><br><span class="line">generator_list = mylist(li)</span><br><span class="line">print(generator_list)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> generator_list:</span><br><span class="line">    print(i)</span><br><span class="line">    </span><br><span class="line">------------</span><br><span class="line">&lt;generator object mylist at <span class="number">0x101380888</span>&gt;</span><br><span class="line">(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">(<span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">(<span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line">(<span class="number">4</span>, <span class="number">5</span>)</span><br><span class="line">(<span class="number">5</span>, <span class="number">6</span>)</span><br></pre></td></tr></table></figure>

<h1 id="è¿­ä»£å™¨"><a href="#è¿­ä»£å™¨" class="headerlink" title="è¿­ä»£å™¨"></a>è¿­ä»£å™¨</h1><p>è¿­ä»£å™¨æ˜¯è®¿é—®é›†åˆå…ƒç´ çš„ä¸€ç§æ–¹å¼ã€‚è¿­ä»£å™¨å¯¹è±¡ä»é›†åˆçš„ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹è®¿é—®ï¼Œç›´åˆ°æ‰€æœ‰çš„å…ƒç´ è¢«è®¿é—®å®Œç»“æŸã€‚è¿­ä»£å™¨åªèƒ½å¾€å‰ä¸ä¼šåé€€ï¼Œä¸è¿‡è¿™ä¹Ÿæ²¡ä»€ä¹ˆï¼Œå› ä¸ºäººä»¬å¾ˆå°‘åœ¨è¿­ä»£é€”ä¸­å¾€åé€€ã€‚å¦å¤–ï¼Œè¿­ä»£å™¨çš„ä¸€å¤§ä¼˜ç‚¹æ˜¯ä¸è¦æ±‚äº‹å…ˆå‡†å¤‡å¥½æ•´ä¸ªè¿­ä»£è¿‡ç¨‹ä¸­æ‰€æœ‰çš„å…ƒç´ ã€‚è¿­ä»£å™¨ä»…ä»…åœ¨è¿­ä»£åˆ°æŸä¸ªå…ƒç´ æ—¶æ‰è®¡ç®—è¯¥å…ƒç´ ï¼Œè€Œåœ¨è¿™ä¹‹å‰æˆ–ä¹‹åï¼Œå…ƒç´ å¯ä»¥ä¸å­˜åœ¨æˆ–è€…è¢«é”€æ¯ã€‚è¿™ä¸ªç‰¹ç‚¹ä½¿å¾—å®ƒç‰¹åˆ«é€‚åˆç”¨äºéå†ä¸€äº›å·¨å¤§çš„æˆ–æ˜¯æ— é™çš„é›†åˆï¼Œæ¯”å¦‚å‡ ä¸ªGçš„æ–‡ä»¶</p>
<p><strong>ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li>è®¿é—®è€…ä¸éœ€è¦å…³å¿ƒè¿­ä»£å™¨å†…éƒ¨çš„ç»“æ„ï¼Œä»…éœ€é€šè¿‡next()æ–¹æ³•ä¸æ–­å»å–ä¸‹ä¸€ä¸ªå†…å®¹</li>
<li>ä¸èƒ½éšæœºè®¿é—®é›†åˆä¸­çš„æŸä¸ªå€¼ ï¼Œåªèƒ½ä»å¤´åˆ°å°¾ä¾æ¬¡è®¿é—®</li>
<li>è®¿é—®åˆ°ä¸€åŠæ—¶ä¸èƒ½å¾€å›é€€</li>
<li>ä¾¿äºå¾ªç¯æ¯”è¾ƒå¤§çš„æ•°æ®é›†åˆï¼ŒèŠ‚çœå†…å­˜</li>
</ul>
<h2 id="å¦‚ä½•åˆ¤æ–­æ˜¯å¦æ˜¯å¯è¿­ä»£å¯¹è±¡"><a href="#å¦‚ä½•åˆ¤æ–­æ˜¯å¦æ˜¯å¯è¿­ä»£å¯¹è±¡" class="headerlink" title="å¦‚ä½•åˆ¤æ–­æ˜¯å¦æ˜¯å¯è¿­ä»£å¯¹è±¡"></a>å¦‚ä½•åˆ¤æ–­æ˜¯å¦æ˜¯å¯è¿­ä»£å¯¹è±¡</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>i = iter([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>i</span><br><span class="line">&lt;list_iterator object at <span class="number">0x1032fa390</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>dir(i)</span><br><span class="line">[<span class="string">'__class__'</span>, <span class="string">'__delattr__'</span>, <span class="string">'__dir__'</span>, <span class="string">'__doc__'</span>, <span class="string">'__eq__'</span>, <span class="string">'__format__'</span>, <span class="string">'__ge__'</span>, <span class="string">'__getattribute__'</span>, <span class="string">'__gt__'</span>, <span class="string">'__hash__'</span>, <span class="string">'__init__'</span>, <span class="string">'__iter__'</span>, <span class="string">'__le__'</span>, <span class="string">'__length_hint__'</span>, <span class="string">'__lt__'</span>, <span class="string">'__ne__'</span>, <span class="string">'__new__'</span>, <span class="string">'__next__'</span>, <span class="string">'__reduce__'</span>, <span class="string">'__reduce_ex__'</span>, <span class="string">'__repr__'</span>, <span class="string">'__setattr__'</span>, <span class="string">'__setstate__'</span>, <span class="string">'__sizeof__'</span>, <span class="string">'__str__'</span>, <span class="string">'__subclasshook__'</span>]</span><br></pre></td></tr></table></figure>

<p>ä¸€ä¸ªå¯¹è±¡ä¸­ï¼ŒåŒæ—¶æ‹¥æœ‰<code>__iter__</code> <code>__next__</code>è¿™ä¸¤ä¸ªæ–¹æ³•çš„å¯¹è±¡å°±æ˜¯å¯è¿­ä»£å¯¹è±¡ã€‚</p>
<p>è¿­ä»£å¯¹è±¡é ä»€ä¹ˆè¿­ä»£ï¼Ÿé <code>__next__</code>æ–¹æ³•è¿›è¡Œè¿­ä»£ã€‚è€ŒPythonä¸­çš„forå¾ªç¯è¯­å¥ï¼Œå†…éƒ¨å¸®æˆ‘ä»¬è°ƒç”¨äº†å¯¹è±¡çš„<code>__next__</code>æ–¹æ³•ï¼Œè€Œä¸”å¸®æˆ‘ä»¬è‡ªåŠ¨æ•è·äº†StopIterationå¼‚å¸¸ã€‚So <code>for</code>å¾ªç¯å°±æ˜¯Pythonä¸­çš„è¿­ä»£å™¨</p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>ç”Ÿæˆå™¨</tag>
        <tag>è¿­ä»£å™¨</tag>
      </tags>
  </entry>
  <entry>
    <title>Python for é€’å½’</title>
    <url>/2016/06/07/Python-for-%E9%80%92%E5%BD%92/</url>
    <content><![CDATA[<blockquote>
<p>é€’å½’ï¼šç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œè°ƒåŠ¨è‡ªèº«çš„ç¼–ç¨‹æŠ€å·§ç§°ä¹‹ä¸ºé€’å½’ï¼Œå¦‚æœä½ éœ€è¦äº†è§£æ›´å¤šå…³äºé€’å½’çš„è¯´æ˜ï¼Œå¯ä»¥ç§»æ­¥ä¸‹é¢çš„é“¾æ¥æŸ¥çœ‹ç™¾åº¦ç™¾ç§‘ã€‚å¥½å§ï¼Œæˆ‘ä»¬è¿™é‡Œä¸è°ˆé€’å½’çš„æ¦‚å¿µï¼Œåªè°ˆå®ç°</p>
</blockquote>
<p><a href="http://baike.baidu.com/link?url=XwtAqR--kKYDNpBVGDColI-LJjrm8Pz1kL2-VO0oB5RYs0pIF_sgxmc8AT15IGHjJqC80vnHhuYaSs_eIRx6m_" target="_blank" rel="noopener">ç™¾åº¦ç™¾ç§‘ï¼šé€’å½’</a></p>
<p>åœ¨å»å®ç°é€’å½’ä¹‹å‰ï¼Œå…ˆæ¥çœ‹ä¸€ä¸ªå°ğŸŒ°ä¾‹å­ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">a</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'Polar Snow'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">b</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> a()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">c</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> b()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">d</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> c()</span><br><span class="line"></span><br><span class="line">d()</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">Polar Snow</span><br></pre></td></tr></table></figure>

<p>å¦‚ä»£ç æ‰€ç¤ºï¼Œæˆ‘æ‰§è¡Œäº†<code>d()</code>ï¼Œä½†æ˜¯åœ¨dçš„å†…éƒ¨åˆæ‰§è¡Œäº†<code>c()</code>,åœ¨cçš„å†…éƒ¨åˆæ‰§è¡Œäº†<code>b()</code>,åœ¨bçš„å†…éƒ¨æ‰§è¡Œäº†<code>a()</code>ï¼Œè°ƒç”¨å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="http://oss.20150509.cn/20160607014959.png" alt=""></p>
<p>æ‰§è¡Œ<code>d()</code>çš„æ—¶å€™ï¼Œå…ˆèµ°çº¢è‰²çº¿çš„è°ƒç”¨ï¼Œåˆ°<code>a()</code>åï¼Œèµ°è“è‰²çº¿çš„è¿”å›å€¼ï¼Œæœ€åçš„<code>print(r)</code>å®é™…ä¸Šå°±æ˜¯<code>a()</code>å‡½æ•°çš„è¿”å›å€¼</p>
<h1 id="é€’å½’"><a href="#é€’å½’" class="headerlink" title="é€’å½’"></a>é€’å½’</h1><p>äº†è§£äº†ä¸Šé¢çš„ä¾‹å­åï¼Œä¼šæ›´å®¹æ˜“é€’å½’çš„å®ç°ï¼Œç°æœ‰å¦‚ä¸‹é€’å½’å®ä¾‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(n)</span>:</span></span><br><span class="line">    n += <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> n &gt;= <span class="number">4</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'end'</span></span><br><span class="line">    <span class="keyword">return</span> func(n)</span><br><span class="line"></span><br><span class="line">r = func(<span class="number">1</span>)</span><br><span class="line">print(r)</span><br><span class="line"></span><br><span class="line">------</span><br><span class="line">end</span><br></pre></td></tr></table></figure>

<p><img src="http://oss.20150509.cn/20160607021259.png" alt=""></p>
<p>çº¢è‰²çš„çº¿æ˜¯è°ƒç”¨çº¿ï¼Œè“è‰²çš„çº¿æ˜¯è¿”å›çº¿ã€‚å¯ä»¥çœ‹åˆ°ï¼Œé€’å½’æ˜¯é€å±‚è°ƒç”¨ï¼Œå½“æ¡ä»¶æ»¡è¶³æ—¶ç»“æŸè°ƒç”¨è‡ªå·±ï¼Œå¹¶é€å±‚å°†å€¼è¿”å›ã€‚ä¸Šé¢çš„æ¡ˆä¾‹ä¸­ï¼Œæ¯å±‚çš„å€¼éƒ½æ˜¯æŒ‰ç…§åŸå€¼è¿›è¡Œè¿”å›ï¼Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œå¯ä»¥å¯¹æ¯ä¸‹ä¸€å±‚è¿”å›çš„å€¼è¿›è¡Œè®¡ç®—åå†è¿”å›ç»™ä¸Šä¸€å±‚ã€‚</p>
<p><strong>æ€è€ƒé¢˜</strong></p>
<ul>
<li>ä½¿ç”¨é€’å½’çš„æ–¹å¼è®¡ç®—ï¼š<code>7çš„é˜¶ä¹˜</code></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cal</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> n * cal(n<span class="number">-1</span>)</span><br><span class="line"></span><br><span class="line">print(cal(<span class="number">7</span>))</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line"><span class="number">5040</span></span><br></pre></td></tr></table></figure>

<p><img src="http://oss.20150509.cn/20160607024859.png" alt=""></p>
<ul>
<li>ä½¿ç”¨é€’å½’çš„æ–¹å¼è®¡ç®—ï¼š<code>1*2*3*4*5*6*7</code></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cal</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">7</span>:</span><br><span class="line">        <span class="keyword">return</span> n</span><br><span class="line">    <span class="keyword">return</span> n * cal(n+<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">print(cal(<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line"><span class="number">5040</span></span><br></pre></td></tr></table></figure>

<p><img src="http://20150509.oss-cn-qingdao.aliyuncs.com/20160607024959.png" alt=""></p>
<p><strong>æ€»ç»“</strong>ï¼šä»ä»¥ä¸Šä¸¤ç§å¯¹é€’å½’çš„ä½¿ç”¨æ¥çœ‹ï¼Œå¯ä»¥æ€»ç»“å‡ºï¼Œé€’å½’è®¡ç®—çš„ä¸¤ä¸ªå…³é”®ç‚¹</p>
<ul>
<li>returnç‚¹ï¼šé€’å½’åˆ°ç¬¬å‡ å±‚çš„æ—¶å€™å¼€å§‹è¿”å›ï¼Œè¿”å›ä»€ä¹ˆï¼Ÿ</li>
<li>è®¡ç®—ç‚¹ï¼šå½“ä¸‹ä¸€å±‚çš„å‡½æ•°è¿”å›æ•°æ®çš„æ—¶å€™ï¼Œéœ€è¦å¯¹æ•°æ®åšä»€ä¹ˆæ ·çš„è®¡ç®—ï¼Ÿ</li>
</ul>
<p>ç¬¬ä¸€ç§è®¡ç®—é˜¶ä¹˜çš„æ€è·¯æ˜¯ä¼ é€’ä¸€ä¸ªæœ€å¤§å€¼ï¼Œè®©å‡½æ•°å¸®æˆ‘ä»å¤§å¾€å°ä¹˜ã€‚æœ‰äº†è¿™ä¸ªä¿¡æ¯å°±ç¡®å®šäº†<code>è®¡ç®—ç‚¹</code>çš„æ–¹å¼ï¼æ˜¯ä»å¤§å¾€å°ä¹˜ï¼Œå¤§çš„å€¼å°±æ˜¯åŸå‚æ•°çš„å€¼ï¼Œå°çš„å€¼æ˜¯é€šè¿‡ä¸‹ä¸€å±‚è®¡ç®—å¾—æ¥çš„ï¼Œæ‰€ä»¥å°±ç¡®å®šäº†è®¡ç®—ç‚¹çš„è¡¨è¾¾å¼<code>n * cal(n-1)</code>ã€‚æœ€åè¿˜éœ€è¦ç¡®å®šé€’å½’çš„ç¬¬ä¸€ä¸ªè¿”å›å€¼ï¼Œä¹Ÿå°±æ˜¯<code>returnç‚¹</code>ï¼Œæ—¢ç„¶æ˜¯ä»å¤§å¾€å°ä¹˜ï¼Œreturnç‚¹å°±æ˜¯æœ€å°å€¼1ï¼Œé˜¶ä¹˜ç®—åˆ°1å°±ä¸ç”¨å¾€ä¸‹ç®—äº†ï¼Œæ‰€ä»¥åœ¨é€’å½’ä¸­åŠ å…¥åˆ¤æ–­ï¼Œå½“å€¼=1æ—¶ï¼Œè¿”å›1.</p>
<p>ç¬¬äºŒç§è®¡ç®—é˜¶ä¹˜çš„æ€è·¯æ˜¯ä¼ é€’ä¸€ä¸ªæœ€å°å€¼ï¼Œåœ¨é€’å½’å†…éƒ¨ï¼Œå†™æ­»äº†è®¡ç®—åˆ°7çš„é˜¶ä¹˜ï¼Œé€’å½’åˆ°æœ€æ·±å±‚çš„æ—¶å€™è¿”å›7åˆ°ä¸Šä¸€å±‚ï¼Œäº¤ç»™ä¸Šä¸€å±‚çš„<code>n * 7</code>è¡¨è¾¾å¼æ¥å¤„ç†ï¼Œç”±äºå‡½æ•°ä¸­ï¼Œæ¯å±‚çš„è°ƒç”¨néƒ½åŠ äº†1ï¼Œé‚£ä¹ˆæ­¤æ—¶çš„nè‚¯å®šæ˜¯6ï¼Œæ‰€ä»¥è¡¨è¾¾å¼ä¼šè®¡ç®—<code>6 * 7</code>,å¹¶å°†ç»“æœ42è¿”å›ç»™ä¸Šä¸€å±‚ã€‚è€Œå†ä¸Šä¸€å±‚çš„nè‚¯å®šæ˜¯5ï¼Œæ‰€ä»¥åˆä¼šå»è®¡ç®—<code>5 * 42</code>å¹¶å°†ç»“æœè¿”å›è‡³ä¸Šå±‚</p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>é€’å½’</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonå­—ç¬¦ä¸²æ ¼å¼åŒ–</title>
    <url>/2016/06/06/Python%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%A0%BC%E5%BC%8F%E5%8C%96/</url>
    <content><![CDATA[<blockquote>
<p>Pythonä¸­æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„æ–¹å¼æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯ä½¿ç”¨ç™¾åˆ†å·çš„æ–¹å¼ï¼›ä¸€ç§æ˜¯ä½¿ç”¨formatæ–¹å¼ã€‚ä½¿ç”¨ç™¾åˆ†å·çš„æ–¹å¼æ¯”è¾ƒå¤è€ï¼Œè€Œä½¿ç”¨formatåˆ™æ˜¯æ¯”è¾ƒâ€œå…ˆè¿›â€çš„æ–¹å¼ï¼Œç›®å‰ä¸¤è€…å¹¶å­˜</p>
<p>Python Version: 3.5+</p>
</blockquote>
<h1 id="ç™¾åˆ†å·çš„æ–¹å¼æ ¼å¼åŒ–å­—ç¬¦ä¸²"><a href="#ç™¾åˆ†å·çš„æ–¹å¼æ ¼å¼åŒ–å­—ç¬¦ä¸²" class="headerlink" title="ç™¾åˆ†å·çš„æ–¹å¼æ ¼å¼åŒ–å­—ç¬¦ä¸²"></a>ç™¾åˆ†å·çš„æ–¹å¼æ ¼å¼åŒ–å­—ç¬¦ä¸²</h1><p><strong>è¯­æ³•æ ¼å¼ï¼š</strong></p>
<p><code>%[(name)][flags][width].[precision]typecode</code></p>
<p>åœ¨å­¦ä¹ æ›´å¤šå‚æ•°ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥å›é¡¾ä»¥ä¸‹ï¼Œä½¿ç”¨ç™¾åˆ†å·çš„æœ€ç®€å•çš„ç”¨æ³•ï¼Œæ˜¯æ€ä¹ˆå®ç°çš„</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">'My name is %s, I am %d.'</span> % (<span class="string">'Polar Snow'</span>, <span class="number">25</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s</span><br><span class="line"><span class="string">'My name is Polar Snow, I am 25.'</span></span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ç§å¤šå ä½ç¬¦çš„æƒ…å†µä¸‹ï¼Œåé¢çš„æ‹¬å·ä¸­ä¼ å…¥çš„æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œæ ¹æ®ç´¢å¼•ï¼Œåˆ†åˆ«å¯¹åº”å‰é¢å­—ç¬¦ä¸²å ä½ç¬¦çš„ç¬¬0ä¸ªå’Œç¬¬1ä¸ªã€‚</p>
<h2 id="name"><a href="#name" class="headerlink" title="(name)"></a>(name)</h2><p>å¯é€‰ï¼Œç”¨äºé€‰æ‹©æŒ‡å®šçš„key</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">'My name is %(name)s, I am %(age)d.'</span> % &#123;<span class="string">'name'</span>: <span class="string">'Polar Snow'</span>, <span class="string">'age'</span>: <span class="number">25</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s</span><br><span class="line"><span class="string">'My name is Polar Snow, I am 25.'</span></span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨è¿™ç§æ–¹å¼çš„å¥½å¤„æ˜¯æ˜¾è€Œæ˜“è§çš„ï¼Œå¦‚æœä¸€é•¿ä¸²å­—ç¬¦ä¸²ä¸­æœ‰Nå¤šä¸ªå ä½ç¬¦ï¼Œææœ‰å¯èƒ½æ— æ³•ä¿è¯ä¸€ä¸€å¯¹åº”ï¼Œè€Œä¸”å ä½ç¬¦å¤šäº†ï¼Œå¾ˆå®¹æ˜“è®°æ··ç¬¬å‡ ä¸ªå ä½ç¬¦æ˜¯å¹²å˜›çš„ã€‚ä½¿ç”¨è¿™ç§â€œå­—å…¸â€çš„æ–¹å¼ï¼Œç»™æ¯ä¸ªå ä½ç¬¦èµ·åå­—ï¼Œèµ‹å€¼çš„æ—¶å€™æ ¹æ®åå­—èµ‹å€¼ï¼Œä¼ é€’çš„ä½ç½®ä¸éœ€è¦ä¸€ä¸€å¯¹åº”ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">'My name is %(name)s, Hello %(name)s.'</span> % &#123;<span class="string">'name'</span>: <span class="string">'Polar Snow'</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s</span><br><span class="line"><span class="string">'My name is Polar Snow, Hello Polar Snow.'</span></span><br></pre></td></tr></table></figure>

<h2 id="flags"><a href="#flags" class="headerlink" title="flags"></a>flags</h2><p>å¯é€‰ï¼Œæä¾›ä»¥ä¸‹çš„å€¼å¯ä»¥é€‰æ‹©ï¼š</p>
<table>
<thead>
<tr>
<th>ç¬¦å·</th>
<th>å¯¹é½</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>+</td>
<td>å³å¯¹é½</td>
<td>æ­£æ•°å‰åŠ <code>+</code>ï¼Œè´Ÿæ•°å‰åŠ <code>-</code></td>
</tr>
<tr>
<td>-</td>
<td>å·¦å¯¹é½</td>
<td>æ­£æ•°å‰æ— ç¬¦å·ï¼Œè´Ÿæ•°å‰åŠ <code>-</code></td>
</tr>
<tr>
<td>ç©ºæ ¼</td>
<td>å³å¯¹é½</td>
<td>æ­£æ•°å‰åŠ ç©ºæ ¼ï¼Œè´Ÿæ•°å‰åŠ <code>-</code></td>
</tr>
<tr>
<td>0</td>
<td>å³å¯¹é½</td>
<td>æ­£æ•°å‰æ— ç¬¦å·ï¼Œè´Ÿæ•°å‰åŠ <code>-</code>ï¼Œç”¨0å¡«å……ç©ºç™½å¤„</td>
</tr>
</tbody></table>
<p>å¯¹é½çš„ç‰¹æ€§éœ€è¦<code>width</code>å‚æ•°çš„æ”¯æŒ</p>
<ul>
<li>+</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">'My name is %(name)s, I am %(age)+d.'</span> % &#123;<span class="string">'name'</span>: <span class="string">'Polar Snow'</span>, <span class="string">'age'</span>: <span class="number">25</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s</span><br><span class="line"><span class="string">'My name is Polar Snow, I am +25.'</span></span><br><span class="line">------</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">'My name is %(name)s, I am %(age)+d.'</span> % &#123;<span class="string">'name'</span>: <span class="string">'Polar Snow'</span>, <span class="string">'age'</span>: <span class="number">-25</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s</span><br><span class="line"><span class="string">'My name is Polar Snow, I am -25.'</span></span><br></pre></td></tr></table></figure>

<ul>
<li>-</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">'My name is %(name)s, I am %(age)-d.'</span> % &#123;<span class="string">'name'</span>: <span class="string">'Polar Snow'</span>, <span class="string">'age'</span>: <span class="number">25</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s</span><br><span class="line"><span class="string">'My name is Polar Snow, I am 25.'</span></span><br><span class="line">------</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">'My name is %(name)s, I am %(age)-d.'</span> % &#123;<span class="string">'name'</span>: <span class="string">'Polar Snow'</span>, <span class="string">'age'</span>: <span class="number">-25</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s</span><br><span class="line"><span class="string">'My name is Polar Snow, I am -25.'</span></span><br></pre></td></tr></table></figure>

<ul>
<li>ç©ºæ ¼</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">'My name is %(name)s, I am [%(age) d].'</span> % &#123;<span class="string">'name'</span>: <span class="string">'Polar Snow'</span>, <span class="string">'age'</span>: <span class="number">25</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s</span><br><span class="line"><span class="string">'My name is Polar Snow, I am [ 25].'</span></span><br><span class="line">------</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">'My name is %(name)s, I am [%(age) d].'</span> % &#123;<span class="string">'name'</span>: <span class="string">'Polar Snow'</span>, <span class="string">'age'</span>: <span class="number">-25</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s</span><br><span class="line"><span class="string">'My name is Polar Snow, I am [-25].'</span></span><br></pre></td></tr></table></figure>

<ul>
<li>0</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">'My name is %(name)s, I am %(age)0d.'</span> % &#123;<span class="string">'name'</span>: <span class="string">'Polar Snow'</span>, <span class="string">'age'</span>: <span class="number">25</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s</span><br><span class="line"><span class="string">'My name is Polar Snow, I am 25.'</span></span><br><span class="line">------</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">'My name is %(name)s, I am %(age)0d.'</span> % &#123;<span class="string">'name'</span>: <span class="string">'Polar Snow'</span>, <span class="string">'age'</span>: <span class="number">-25</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s</span><br><span class="line"><span class="string">'My name is Polar Snow, I am -25.'</span></span><br></pre></td></tr></table></figure>

<h2 id="width"><a href="#width" class="headerlink" title="width"></a>width</h2><p>å¯é€‰ï¼Œå ä½ç¬¦çš„å®½åº¦</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">'My name is %(name)s, I am [%(age)05d].'</span> % &#123;<span class="string">'name'</span>: <span class="string">'Polar Snow'</span>, <span class="string">'age'</span>: <span class="number">-25</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s</span><br><span class="line"><span class="string">'My name is Polar Snow, I am [-0025].'</span></span><br><span class="line">------</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">'My name is %(name)s, I am [%(age)05d].'</span> % &#123;<span class="string">'name'</span>: <span class="string">'Polar Snow'</span>, <span class="string">'age'</span>: <span class="number">25</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s</span><br><span class="line"><span class="string">'My name is Polar Snow, I am [00025].'</span></span><br></pre></td></tr></table></figure>

<p>æœ‰ä¸ªå®½åº¦çš„è®¾ç½®ï¼Œä¸Šé¢çš„å¯¹é½æ‰èƒ½çœ‹å‡ºæ•ˆæœ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">'My name is %(name)s, I am [%(age)+5d].'</span> % &#123;<span class="string">'name'</span>: <span class="string">'Polar Snow'</span>, <span class="string">'age'</span>: <span class="number">25</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s</span><br><span class="line"><span class="string">'My name is Polar Snow, I am [  +25].'</span></span><br><span class="line">------</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">'My name is %(name)s, I am [%(age) 5d].'</span> % &#123;<span class="string">'name'</span>: <span class="string">'Polar Snow'</span>, <span class="string">'age'</span>: <span class="number">25</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s</span><br><span class="line"><span class="string">'My name is Polar Snow, I am [   25].'</span></span><br></pre></td></tr></table></figure>

<h2 id="precision"><a href="#precision" class="headerlink" title=".precision"></a>.precision</h2><p>å¯é€‰ï¼Œå°æ•°ç‚¹åä¿ç•™çš„ä½æ•°(è¿˜æœ‰å››èˆäº”å…¥å“¦ï¼)</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">'My name is %(name)s, I am [%(age) 9.3f].'</span> % &#123;<span class="string">'name'</span>: <span class="string">'Polar Snow'</span>, <span class="string">'age'</span>: <span class="number">25.2525252525</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s</span><br><span class="line"><span class="string">'My name is Polar Snow, I am [   25.253].'</span></span><br></pre></td></tr></table></figure>

<h2 id="typecode"><a href="#typecode" class="headerlink" title="typecode"></a>typecode</h2><ul>
<li>sï¼Œè·å–ä¼ å…¥å¯¹è±¡çš„<strong>str</strong>æ–¹æ³•çš„è¿”å›å€¼ï¼Œå¹¶å°†å…¶æ ¼å¼åŒ–åˆ°æŒ‡å®šä½ç½®</li>
<li>rï¼Œè·å–ä¼ å…¥å¯¹è±¡çš„<strong>repr</strong>æ–¹æ³•çš„è¿”å›å€¼ï¼Œå¹¶å°†å…¶æ ¼å¼åŒ–åˆ°æŒ‡å®šä½ç½®</li>
<li>cï¼Œæ•´æ•°ï¼šå°†æ•°å­—è½¬æ¢æˆå…¶unicodeå¯¹åº”çš„å€¼ï¼Œ10è¿›åˆ¶èŒƒå›´ä¸º 0 &lt;= i &lt;= 1114111ï¼ˆpy27åˆ™åªæ”¯æŒ0-255ï¼‰ï¼›å­—ç¬¦ï¼šå°†å­—ç¬¦æ·»åŠ åˆ°æŒ‡å®šä½ç½®</li>
<li>oï¼Œå°†æ•´æ•°è½¬æ¢æˆ å…«  è¿›åˆ¶è¡¨ç¤ºï¼Œå¹¶å°†å…¶æ ¼å¼åŒ–åˆ°æŒ‡å®šä½ç½®</li>
<li>xï¼Œå°†æ•´æ•°è½¬æ¢æˆåå…­è¿›åˆ¶è¡¨ç¤ºï¼Œå¹¶å°†å…¶æ ¼å¼åŒ–åˆ°æŒ‡å®šä½ç½®</li>
<li>dï¼Œå°†æ•´æ•°ã€æµ®ç‚¹æ•°è½¬æ¢æˆ å è¿›åˆ¶è¡¨ç¤ºï¼Œå¹¶å°†å…¶æ ¼å¼åŒ–åˆ°æŒ‡å®šä½ç½®</li>
<li>eï¼Œå°†æ•´æ•°ã€æµ®ç‚¹æ•°è½¬æ¢æˆç§‘å­¦è®¡æ•°æ³•ï¼Œå¹¶å°†å…¶æ ¼å¼åŒ–åˆ°æŒ‡å®šä½ç½®ï¼ˆå°å†™eï¼‰</li>
<li>Eï¼Œå°†æ•´æ•°ã€æµ®ç‚¹æ•°è½¬æ¢æˆç§‘å­¦è®¡æ•°æ³•ï¼Œå¹¶å°†å…¶æ ¼å¼åŒ–åˆ°æŒ‡å®šä½ç½®ï¼ˆå¤§å†™Eï¼‰</li>
<li>fï¼Œ å°†æ•´æ•°ã€æµ®ç‚¹æ•°è½¬æ¢æˆæµ®ç‚¹æ•°è¡¨ç¤ºï¼Œå¹¶å°†å…¶æ ¼å¼åŒ–åˆ°æŒ‡å®šä½ç½®ï¼ˆé»˜è®¤ä¿ç•™å°æ•°ç‚¹å6ä½ï¼‰<br>Fï¼ŒåŒä¸Š</li>
<li>gï¼Œè‡ªåŠ¨è°ƒæ•´å°†æ•´æ•°ã€æµ®ç‚¹æ•°è½¬æ¢æˆ æµ®ç‚¹å‹æˆ–ç§‘å­¦è®¡æ•°æ³•è¡¨ç¤ºï¼ˆè¶…è¿‡6ä½æ•°ç”¨ç§‘å­¦è®¡æ•°æ³•ï¼‰ï¼Œå¹¶å°†å…¶æ ¼å¼åŒ–åˆ°æŒ‡å®šä½ç½®ï¼ˆå¦‚æœæ˜¯ç§‘å­¦è®¡æ•°åˆ™æ˜¯eï¼›ï¼‰</li>
<li>Gï¼Œè‡ªåŠ¨è°ƒæ•´å°†æ•´æ•°ã€æµ®ç‚¹æ•°è½¬æ¢æˆ æµ®ç‚¹å‹æˆ–ç§‘å­¦è®¡æ•°æ³•è¡¨ç¤ºï¼ˆè¶…è¿‡6ä½æ•°ç”¨ç§‘å­¦è®¡æ•°æ³•ï¼‰ï¼Œå¹¶å°†å…¶æ ¼å¼åŒ–åˆ°æŒ‡å®šä½ç½®ï¼ˆå¦‚æœæ˜¯ç§‘å­¦è®¡æ•°åˆ™æ˜¯Eï¼›ï¼‰</li>
<li>%ï¼Œå½“å­—ç¬¦ä¸²ä¸­å­˜åœ¨æ ¼å¼åŒ–æ ‡å¿—æ—¶ï¼Œéœ€è¦ç”¨ %%è¡¨ç¤ºä¸€ä¸ªç™¾åˆ†å·</li>
</ul>
<p>è™½ç„¶ä¸Šé¢åˆ—ä¸¾è¾£ä¹ˆå¤šå­—ç¬¦ç±»å‹ï¼Œä½†æ˜¯æœ€å¸¸ç”¨çš„å‰é¢çš„ä¾‹å­ä¸­éƒ½å·²ç»ä½¿ç”¨è¿‡äº†ï¼æ²¡é”™ï¼Œå°±æ˜¯<code>s</code> <code>d</code> <code>f</code>è¿™ä¸‰ä¸ªè´§ï¼Œç‰¹åˆ«æç¤ºä¸€ä¸‹ï¼Œå½“ä½ éœ€è¦åœ¨å­—ç¬¦ä¸²ä¸­æ‰“å°<code>%</code>æ—¶ï¼Œéœ€è¦è¾“å…¥<code>%%</code>æ‰èƒ½æ˜¾ç¤ºä¸€ä¸ª<code>%</code></p>
<hr>
<h1 id="formatæ–¹å¼æ ¼å¼åŒ–å­—ç¬¦ä¸²"><a href="#formatæ–¹å¼æ ¼å¼åŒ–å­—ç¬¦ä¸²" class="headerlink" title="formatæ–¹å¼æ ¼å¼åŒ–å­—ç¬¦ä¸²"></a>formatæ–¹å¼æ ¼å¼åŒ–å­—ç¬¦ä¸²</h1><p><strong>è¯­æ³•æ ¼å¼ï¼š</strong></p>
<p><code>[[fill]align][sign][#][0][width][,][.precision][type]</code></p>
<p>ä½¿ç”¨formatçš„æœ€ç®€å•æ–¹å¼æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">'My name is &#123;&#125;, I am &#123;&#125;.'</span>.format(<span class="string">'Polar Snow'</span>, <span class="number">25.2525252525</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s</span><br><span class="line"><span class="string">'My name is Polar Snow, I am 25.2525252525.'</span></span><br><span class="line">------</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">'My name is &#123;&#125;, I am &#123;&#125;.'</span>.format(<span class="string">'Polar Snow'</span>, <span class="number">25</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s</span><br><span class="line"><span class="string">'My name is Polar Snow, I am 25.'</span></span><br><span class="line">------</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">'My name is &#123;name&#125;, I am &#123;age&#125;.'</span>.format(name=<span class="string">'Polar Snow'</span>, age=<span class="number">25</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s</span><br><span class="line"><span class="string">'My name is Polar Snow, I am 25.'</span></span><br></pre></td></tr></table></figure>

<p>åœ¨ä¹‹å‰çš„Pythonç¬”è®°ä¸­ï¼Œè®²åˆ°å‚æ•°çš„æ—¶å€™ï¼Œæåˆ°è¿‡ä½¿ç”¨<code>*args, **kwargs</code>æ¥å½“ä¸‡èƒ½å‚æ•°ï¼ŒåŒ…ç½—ä¸‡è±¡~ è€Œå½“å‚æ•°ä¸ºä¸€ä¸ªåˆ—è¡¨ï¼Œè€Œå¸Œæœ›åˆ—è¡¨ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ å»å……å½“å‚æ•°æ—¶ï¼Œæˆ‘ä»¬åŠ ä¸Šäº†<code>*</code>è¿™ä¸ªå…³é”®ç¬¦å·ã€‚åŒºåˆ«å°±æ˜¯å¦‚æœä¼ å…¥å‚æ•°çš„æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œå¦‚æœä¸åŠ <code>*</code>ï¼Œé‚£ä¹ˆæ„å‘³ç€æ•´ä¸ªåˆ—è¡¨æ˜¯ä¸€ä¸ªå‚æ•°ï¼›è€ŒåŠ ä¸Šäº†<code>*</code>ï¼Œåˆ™æ„å‘³ç€å°†åˆ—è¡¨ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ å–å‡ºå……å½“å‚æ•°ã€‚è¿™ä¸ªåŸç†åŒæ ·é€‚ç”¨äºå­—ç¬¦ä¸²æ ¼å¼åŒ–ï¼Œä¸‹é¢æˆ‘ä»¬å°±ç”¨è¿™ç§æ–¹æ³•å®ç°ä¸Šé¢åŒæ ·çš„æ•ˆæœã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">'My name is &#123;&#125;, I am &#123;&#125;.'</span>.format(*[<span class="string">'Polar Snow'</span>, <span class="number">25</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s</span><br><span class="line"><span class="string">'My name is Polar Snow, I am 25.'</span></span><br><span class="line">------</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">'My name is &#123;name&#125;, I am &#123;age&#125;.'</span>.format(**&#123;<span class="string">'name'</span>: <span class="string">'Polar Snow'</span>, <span class="string">'age'</span>: <span class="number">25</span>&#125;)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s</span><br><span class="line"><span class="string">'My name is Polar Snow, I am 25.'</span></span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼šåªæœ‰formatçš„æ–¹å¼æ”¯æŒåŠ <code>*</code> <code>**</code>å…³é”®å­—ç¬¦ï¼Œä½¿ç”¨%çš„æ–¹å¼ä¸æ”¯æŒï¼</p>
<h2 id="fill"><a href="#fill" class="headerlink" title="fill"></a>fill</h2><p>å¯é€‰ï¼Œç©ºç™½å¤„å¡«å……çš„å­—ç¬¦ï¼Œéœ€è¦é…åˆwidthæ‰èƒ½çœ‹å‡ºæ•ˆæœ</p>
<h2 id="align"><a href="#align" class="headerlink" title="align"></a>align</h2><p>å¯é€‰ï¼Œå¯¹é½æ–¹å¼ï¼Œéœ€è¦é…åˆwidthæ‰èƒ½çœ‹å‡ºæ•ˆæœ</p>
<ul>
<li>&lt;ï¼Œå†…å®¹å·¦å¯¹é½</li>
<li><blockquote>
<p>ï¼Œå†…å®¹å³å¯¹é½(é»˜è®¤)</p>
</blockquote>
</li>
<li>ï¼ï¼Œå†…å®¹å³å¯¹é½ï¼Œå°†ç¬¦å·æ”¾ç½®åœ¨å¡«å……å­—ç¬¦çš„å·¦ä¾§ï¼Œä¸”åªå¯¹æ•°å­—ç±»å‹æœ‰æ•ˆã€‚ å³ä½¿ï¼šç¬¦å·+å¡«å……ç‰©+æ•°å­—</li>
<li>^ï¼Œå†…å®¹å±…ä¸­</li>
</ul>
<h2 id="sign"><a href="#sign" class="headerlink" title="sign"></a>sign</h2><p>å¯é€‰ï¼Œæ•°å­—å‰çš„ç¬¦å·</p>
<ul>
<li>+ï¼Œæ­£å·åŠ æ­£ï¼Œè´Ÿå·åŠ è´Ÿï¼›</li>
<li>-ï¼Œæ­£å·ä¸å˜ï¼Œè´Ÿå·åŠ è´Ÿï¼›</li>
<li>ç©ºæ ¼ ï¼Œæ­£å·ç©ºæ ¼ï¼Œè´Ÿå·åŠ è´Ÿï¼›</li>
</ul>
<h2 id=""><a href="#" class="headerlink" title="#"></a><code>#</code></h2><p>å¯é€‰ï¼Œå¯¹äºäºŒè¿›åˆ¶ã€å…«è¿›åˆ¶ã€åå…­è¿›åˆ¶ï¼Œå¦‚æœåŠ ä¸Š#ï¼Œä¼šæ˜¾ç¤º 0b/0o/0xï¼Œå¦åˆ™ä¸æ˜¾ç¤º</p>
<h2 id="-1"><a href="#-1" class="headerlink" title=","></a><code>,</code></h2><p>å¯é€‰ï¼Œä¸ºæ•°å­—æ·»åŠ åˆ†éš”ç¬¦ï¼Œå¦‚ï¼š1,000,000</p>
<h2 id="width-1"><a href="#width-1" class="headerlink" title="width"></a>width</h2><p>å¯é€‰ï¼Œæ ¼å¼åŒ–å ä½ç¬¦æ‰€å çš„å®½åº¦</p>
<h2 id="precision-1"><a href="#precision-1" class="headerlink" title=".precision"></a>.precision</h2><p>å¯é€‰ï¼Œå°æ•°ä½ä¿ç•™ç²¾åº¦</p>
<h2 id="type"><a href="#type" class="headerlink" title="type"></a>type</h2><p>å¯é€‰ï¼Œæ ¼å¼åŒ–ç±»å‹</p>
<ul>
<li>ä¼ å…¥â€ å­—ç¬¦ä¸²ç±»å‹ â€œçš„å‚æ•°<ul>
<li>sï¼Œæ ¼å¼åŒ–å­—ç¬¦ä¸²ç±»å‹æ•°æ®</li>
<li>ç©ºç™½ï¼ŒæœªæŒ‡å®šç±»å‹ï¼Œåˆ™é»˜è®¤æ˜¯Noneï¼ŒåŒs</li>
</ul>
</li>
<li>ä¼ å…¥â€œ æ•´æ•°ç±»å‹ â€çš„å‚æ•°<ul>
<li>bï¼Œå°†10è¿›åˆ¶æ•´æ•°è‡ªåŠ¨è½¬æ¢æˆ2è¿›åˆ¶è¡¨ç¤ºç„¶åæ ¼å¼åŒ–</li>
<li>cï¼Œå°†10è¿›åˆ¶æ•´æ•°è‡ªåŠ¨è½¬æ¢ä¸ºå…¶å¯¹åº”çš„unicodeå­—ç¬¦</li>
<li>dï¼Œåè¿›åˆ¶æ•´æ•°</li>
<li>oï¼Œå°†10è¿›åˆ¶æ•´æ•°è‡ªåŠ¨è½¬æ¢æˆ8è¿›åˆ¶è¡¨ç¤ºç„¶åæ ¼å¼åŒ–ï¼›</li>
<li>xï¼Œå°†10è¿›åˆ¶æ•´æ•°è‡ªåŠ¨è½¬æ¢æˆ16è¿›åˆ¶è¡¨ç¤ºç„¶åæ ¼å¼åŒ–ï¼ˆå°å†™xï¼‰</li>
<li>Xï¼Œå°†10è¿›åˆ¶æ•´æ•°è‡ªåŠ¨è½¬æ¢æˆ16è¿›åˆ¶è¡¨ç¤ºç„¶åæ ¼å¼åŒ–ï¼ˆå¤§å†™Xï¼‰</li>
</ul>
</li>
<li>ä¼ å…¥â€œ æµ®ç‚¹å‹æˆ–å°æ•°ç±»å‹ â€çš„å‚æ•°<ul>
<li>eï¼Œ è½¬æ¢ä¸ºç§‘å­¦è®¡æ•°æ³•ï¼ˆå°å†™eï¼‰è¡¨ç¤ºï¼Œç„¶åæ ¼å¼åŒ–ï¼›</li>
<li>Eï¼Œ è½¬æ¢ä¸ºç§‘å­¦è®¡æ•°æ³•ï¼ˆå¤§å†™Eï¼‰è¡¨ç¤ºï¼Œç„¶åæ ¼å¼åŒ–;</li>
<li>f ï¼Œ è½¬æ¢ä¸ºæµ®ç‚¹å‹ï¼ˆé»˜è®¤å°æ•°ç‚¹åä¿ç•™6ä½ï¼‰è¡¨ç¤ºï¼Œç„¶åæ ¼å¼åŒ–ï¼›</li>
<li>Fï¼Œ è½¬æ¢ä¸ºæµ®ç‚¹å‹ï¼ˆé»˜è®¤å°æ•°ç‚¹åä¿ç•™6ä½ï¼‰è¡¨ç¤ºï¼Œç„¶åæ ¼å¼åŒ–ï¼›</li>
<li>gï¼Œ è‡ªåŠ¨åœ¨eå’Œfä¸­åˆ‡æ¢</li>
<li>Gï¼Œ è‡ªåŠ¨åœ¨Eå’ŒFä¸­åˆ‡æ¢</li>
<li>%ï¼Œæ˜¾ç¤ºç™¾åˆ†æ¯”ï¼ˆé»˜è®¤æ˜¾ç¤ºå°æ•°ç‚¹å6ä½ï¼‰</li>
</ul>
</li>
</ul>
<h2 id="formatä¸­å¸¸ç”¨çš„æ ¼å¼åŒ–"><a href="#formatä¸­å¸¸ç”¨çš„æ ¼å¼åŒ–" class="headerlink" title="formatä¸­å¸¸ç”¨çš„æ ¼å¼åŒ–"></a>formatä¸­å¸¸ç”¨çš„æ ¼å¼åŒ–</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é¦–å…ˆä»æœ€ç®€å•çš„å¼€å§‹</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">'My name is &#123;&#125;, I am &#123;&#125;.'</span>.format(<span class="string">'Polar Snow'</span>, <span class="number">25</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s</span><br><span class="line"><span class="string">'My name is Polar Snow, I am 25.'</span></span><br><span class="line"><span class="comment"># åˆ—è¡¨çš„å½¢å¼ä¼ å€¼</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">'My name is &#123;&#125;, I am &#123;&#125;.'</span>.format(*[<span class="string">'Polar Snow'</span>, <span class="number">25</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s</span><br><span class="line"><span class="string">'My name is Polar Snow, I am 25.'</span></span><br><span class="line"><span class="comment"># æŒ‡å®šå€¼åˆ—è¡¨çš„ç´¢å¼•</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">'My name is &#123;0&#125;, I am &#123;1&#125;.'</span>.format(<span class="string">'Polar Snow'</span>, <span class="number">25</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s</span><br><span class="line"><span class="string">'My name is Polar Snow, I am 25.'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">'My name is &#123;0&#125;, I am &#123;0&#125;.'</span>.format(<span class="string">'Polar Snow'</span>, <span class="number">25</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s</span><br><span class="line"><span class="string">'My name is Polar Snow, I am Polar Snow.'</span></span><br><span class="line"><span class="comment"># ç”šè‡³å¯ä»¥åœ¨åµŒå¥—ä¸­å–å€¼</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">'My name is &#123;0[0]&#125;, I am &#123;0[1]&#125;.'</span>.format([<span class="string">'Polar Snow'</span>, <span class="string">'Larry'</span>], <span class="number">25</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s</span><br><span class="line"><span class="string">'My name is Polar Snow, I am Larry.'</span></span><br><span class="line">------</span><br><span class="line"><span class="comment"># è®¾ç½®å ä½ç¬¦åç§°</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">'My name is &#123;name&#125;, I am &#123;age&#125;.'</span>.format(name=<span class="string">'Polar Snow'</span>, age=<span class="number">25</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s</span><br><span class="line"><span class="string">'My name is Polar Snow, I am 25.'</span></span><br><span class="line"><span class="comment"># å­—å…¸çš„å½¢å¼ä¼ å€¼</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">'My name is &#123;name&#125;, I am &#123;age&#125;.'</span>.format(**&#123;<span class="string">'name'</span>: <span class="string">'Polar Snow'</span>, <span class="string">'age'</span>: <span class="number">25</span>&#125;)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s</span><br><span class="line"><span class="string">'My name is Polar Snow, I am 25.'</span></span><br><span class="line">------</span><br><span class="line"><span class="comment"># formatæœ€çœå¿ƒçš„æ˜¯ä¸éœ€è¦æŒ‡å®šå­—ç¬¦ä¸²ç±»å‹ï¼Œä½†æ˜¯ä½ ä¹Ÿå¯ä»¥é€‰æ‹©å»æŒ‡å®š</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">"i am &#123;:s&#125;, age &#123;:d&#125;, money &#123;:f&#125;"</span>.format(<span class="string">"seven"</span>, <span class="number">25</span>, <span class="number">88888.1</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s</span><br><span class="line"><span class="string">'i am seven, age 25, money 88888.100000'</span></span><br><span class="line"><span class="comment"># ä¿ç•™ä¸¤ä½å°æ•°</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">"i am &#123;:s&#125;, age &#123;:d&#125;, money &#123;:.2f&#125;"</span>.format(<span class="string">"seven"</span>, <span class="number">25</span>, <span class="number">88888.1</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s</span><br><span class="line"><span class="string">'i am seven, age 25, money 88888.10'</span></span><br><span class="line"><span class="comment"># ä¿ç•™ä¸¤ä½å°æ•°å¹¶åœ¨æ•°å­—ä¸­ç”¨,åˆ†éš”</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">"i am &#123;:s&#125;, age &#123;:d&#125;, money &#123;:,.2f&#125;"</span>.format(<span class="string">"seven"</span>, <span class="number">25</span>, <span class="number">88888.1</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s</span><br><span class="line"><span class="string">'i am seven, age 25, money 88,888.10'</span></span><br><span class="line">------</span><br><span class="line"><span class="comment"># å±…ä¸­æ˜¾ç¤ºï¼Œæ’å…¥[]æ˜¯ä¸ºäº†å±•ç¤ºå±…ä¸­çš„æ•ˆæœæ›´ç›´è§‚</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">"i am &#123;:s&#125;, age [&#123;:^10d&#125;], money &#123;:,.2f&#125;"</span>.format(<span class="string">"seven"</span>, <span class="number">25</span>, <span class="number">88888.1</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s</span><br><span class="line"><span class="string">'i am seven, age [    25    ], money 88,888.10'</span></span><br><span class="line">------</span><br><span class="line"><span class="comment"># æ•°å­—çš„å±•ç¤º</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">"numbers: &#123;0:b&#125;,&#123;0:o&#125;,&#123;0:d&#125;,&#123;0:x&#125;,&#123;0:X&#125;, &#123;0:%&#125;"</span>.format(<span class="number">15</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s</span><br><span class="line"><span class="string">'numbers: 1111,17,15,f,F, 1500.000000%'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">"numbers: &#123;num:b&#125;,&#123;num:o&#125;,&#123;num:d&#125;,&#123;num:x&#125;,&#123;num:X&#125;, &#123;num:%&#125;"</span>.format(num=<span class="number">15</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s</span><br><span class="line"><span class="string">'numbers: 1111,17,15,f,F, 1500.000000%'</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœä»¥ä¸Šè¿™äº›è¿˜ä¸èƒ½æ»¡è¶³ä½ çš„éœ€æ±‚ï¼Œè¯·ç§»æ­¥Pythonå®˜æ–¹æ–‡æ¡£ï¼š<a href="https://docs.python.org/3/library/string.html" target="_blank" rel="noopener">Python Docs 4 String Format</a></p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>format</tag>
        <tag>å­—ç¬¦ä¸²æ ¼å¼åŒ–</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonå†…ç½®å‡½æ•°è¯¦è§£</title>
    <url>/2016/06/03/Python%E5%86%85%E7%BD%AE%E5%87%BD%E6%95%B0%E8%AF%A6%E8%A7%A3/</url>
    <content><![CDATA[<p><img src="http://oss.20150509.cn/Snip20160603_1.png" alt=""></p>
<h1 id="abs-x"><a href="#abs-x" class="headerlink" title="abs(x)"></a>abs(x)</h1><p>abså‡½æ•°ç”¨æ¥è¿”å›å‚æ•°çš„ç»å¯¹å€¼</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>abs(<span class="number">-59</span>)</span><br><span class="line"><span class="number">59</span></span><br></pre></td></tr></table></figure>

<hr>
<h1 id="all-iterable"><a href="#all-iterable" class="headerlink" title="all(iterable)"></a>all(iterable)</h1><p>allå‡½æ•°æ¥æ”¶ä¸€ä¸ªå¯è¿­ä»£çš„å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œæ‰€æœ‰å…ƒç´ å‡ä¸ºçœŸåˆ™è¿”å›çœŸ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">l1 = [<span class="number">1</span>, <span class="string">'1'</span>, <span class="literal">True</span>]</span><br><span class="line">print(all(l1))</span><br><span class="line"></span><br><span class="line">l2 = [<span class="number">0</span>, <span class="string">'1'</span>, <span class="literal">True</span>]</span><br><span class="line">print(all(l2))</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="literal">False</span></span><br><span class="line"><span class="comment">#0ä¸ºå‡ï¼Œå¯è¿­ä»£å¯¹è±¡ä¸­åªè¦å…¨ä¸ºçœŸæ‰è¿”å›ä¸ºçœŸ</span></span><br></pre></td></tr></table></figure>

<p>ç›¸å½“äºåšäº†å¦‚ä¸‹æ“ä½œï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">all</span><span class="params">(iterable)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> element <span class="keyword">in</span> iterable:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> element:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure>


<h1 id="any-iterable"><a href="#any-iterable" class="headerlink" title="any(iterable)"></a>any(iterable)</h1><p>anyå‡½æ•°æ¥æ”¶ä¸€ä¸ªå¯è¿­ä»£çš„å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œåªè¦æœ‰ä¸€ä¸ªå…ƒç´ ä¸ºçœŸå³è¿”å›ä¸ºçœŸ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">l1 = [<span class="number">1</span>, <span class="string">'1'</span>, <span class="literal">True</span>]</span><br><span class="line">print(any(l1))</span><br><span class="line"></span><br><span class="line">l2 = [<span class="number">0</span>, <span class="string">'1'</span>, <span class="literal">True</span>]</span><br><span class="line">print(any(l2))</span><br><span class="line"></span><br><span class="line">l3 = [<span class="number">0</span>, <span class="string">''</span>, <span class="literal">False</span>]</span><br><span class="line">print(any(l3))</span><br><span class="line"></span><br><span class="line">-----------</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="literal">False</span></span><br></pre></td></tr></table></figure>
<p>ç›¸å½“äºåšäº†å¦‚ä¸‹æ“ä½œï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">any</span><span class="params">(iterable)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> element <span class="keyword">in</span> iterable:</span><br><span class="line">        <span class="keyword">if</span> element:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure>

<h2 id="all-iterable-ä¸-any-iterable-çš„åŒºåˆ«"><a href="#all-iterable-ä¸-any-iterable-çš„åŒºåˆ«" class="headerlink" title="all(iterable) ä¸ any(iterable) çš„åŒºåˆ«"></a>all(iterable) ä¸ any(iterable) çš„åŒºåˆ«</h2><ul>
<li>all(iterable) å¯è¿­ä»£çš„å‚æ•°å¯¹è±¡ä¸­ï¼Œåªè¦æœ‰ä¸€ä¸ªå€¼ä¸ºå‡ï¼Œåˆ™ç«‹å³è¿”å›<code>False</code>ï¼Œæ‰€æœ‰å€¼éƒ½ä¸ºçœŸæ‰è¿”å›ä¸º<code>True</code></li>
<li>any(iterable) å¯è¿­ä»£çš„å‚æ•°å¯¹è±¡ä¸­ï¼Œåªè¦æœ‰ä¸€ä¸ªå€¼ä¸ºçœŸï¼Œåˆ™ç«‹å³è¿”å›<code>True</code>ï¼Œæ‰€æœ‰å€¼éƒ½ä¸ºå‡æ‰è¿”å›<code>False</code></li>
</ul>
<hr>
<h1 id="ascii-object"><a href="#ascii-object" class="headerlink" title="ascii(object)"></a>ascii(object)</h1><p>ascii è‡ªåŠ¨æ‰§è¡Œå¯¹è±¡çš„<code>__repr__</code>æ–¹æ³•</p>
<p>è¿™ä¸ªå‡½æ•°è·Ÿ<code>repr()</code>å‡½æ•°ä¸€æ ·ï¼Œè¿”å›ä¸€ä¸ªå¯æ‰“å°çš„å¯¹è±¡å­—ç¬¦ä¸²æ–¹å¼è¡¨ç¤ºã€‚</p>
<p>å½“é‡åˆ°éASCIIç æ—¶ï¼Œå°±ä¼šè¾“å‡º<code>\x</code> <code>\u</code>æˆ–<code>\U</code>ç­‰å­—ç¬¦æ¥è¡¨ç¤ºã€‚</p>
<p>ä¸Python 2ç‰ˆæœ¬é‡Œçš„repr()æ˜¯ç­‰æ•ˆçš„å‡½æ•°</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">c</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'repr'</span></span><br><span class="line"></span><br><span class="line">print(ascii(c()))</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">repr</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>ascii(<span class="string">'æåœ°ç‘é›ª'</span>)</span><br><span class="line"><span class="string">"'\\u6781\\u5730\\u745e\\u96ea'"</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ascii(<span class="string">'Polar Snow'</span>)</span><br><span class="line"><span class="string">"'Polar Snow'"</span></span><br></pre></td></tr></table></figure>

<h1 id="repr-object"><a href="#repr-object" class="headerlink" title="repr(object)"></a>repr(object)</h1><p>è€Œrepr(object)è½¬åŒ–ä¸ºä¾›<code>è§£é‡Šå™¨</code>è¯»å–çš„å­—ç¬¦ä¸²å½¢å¼</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>repr(<span class="string">'æåœ°ç‘é›ª'</span>)</span><br><span class="line"><span class="string">"'æåœ°ç‘é›ª'"</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>repr(<span class="string">'Polar Snow'</span>)</span><br><span class="line"><span class="string">"'Polar Snow'"</span></span><br></pre></td></tr></table></figure>


<h1 id="str-object-â€™â€™"><a href="#str-object-â€™â€™" class="headerlink" title="str(object=â€™â€™)"></a>str(object=â€™â€™)</h1><p><strong>class str(object=bâ€™â€™, encoding=â€™utf-8â€™, errors=â€™strictâ€™)</strong></p>
<p>å‡½æ•°str(object=â€™â€™)ç”¨äºå°†å€¼è½¬åŒ–ä¸ºé€‚äº<code>äºº</code>é˜…è¯»çš„<code>å­—ç¬¦ä¸²</code>å½¢å¼</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>str(<span class="string">'æåœ°ç‘é›ª'</span>)</span><br><span class="line"><span class="string">'æåœ°ç‘é›ª'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>str(<span class="string">'Polar Snow'</span>)</span><br><span class="line"><span class="string">'Polar Snow'</span></span><br></pre></td></tr></table></figure>

<h2 id="ascii-object-ä¸-repr-object-çš„åŒºåˆ«"><a href="#ascii-object-ä¸-repr-object-çš„åŒºåˆ«" class="headerlink" title="ascii(object) ä¸ repr(object) çš„åŒºåˆ«"></a>ascii(object) ä¸ repr(object) çš„åŒºåˆ«</h2><blockquote>
<p>ä¸¤è€…çš„ä½œç”¨éƒ½æ˜¯å°†å¯¹è±¡è½¬åŒ–ä¸ºå­—ç¬¦ä¸²</p>
</blockquote>
<ul>
<li>ascii()æ–¹æ³•è¿”å›çš„å­—ç¬¦ä¸²ä¸ºéasciiç èƒ½è¡¨ç¤ºçš„å­—ç¬¦æ—¶ï¼Œä½¿ç”¨\x, \u or \Uæ¥è¡¨ç¤º</li>
<li>repr()æ–¹æ³•è¿”å›å¯¹<code>Pythonè§£é‡Šå™¨</code>å‹å¥½çš„å­—ç¬¦ä¸²æ ¼å¼</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>ascii(<span class="string">'æåœ°ç‘é›ª'</span>)</span><br><span class="line"><span class="string">"'\\u6781\\u5730\\u745e\\u96ea'"</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ascii(<span class="string">'Polar Snow'</span>)</span><br><span class="line"><span class="string">"'Polar Snow'"</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ascii(<span class="number">59</span>)</span><br><span class="line"><span class="string">'59'</span></span><br><span class="line">------------</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>repr(<span class="string">'æåœ°ç‘é›ª'</span>)</span><br><span class="line"><span class="string">"'æåœ°ç‘é›ª'"</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>repr(<span class="string">'Polar Snow'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">"'Polar Snow'"</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>repr(<span class="number">59</span>)</span><br><span class="line"><span class="string">'59'</span></span><br></pre></td></tr></table></figure>

<h2 id="repr-object-ä¸-str-object-â€™â€™-çš„åŒºåˆ«"><a href="#repr-object-ä¸-str-object-â€™â€™-çš„åŒºåˆ«" class="headerlink" title="repr(object) ä¸ str(object=â€™â€™) çš„åŒºåˆ«"></a>repr(object) ä¸ str(object=â€™â€™) çš„åŒºåˆ«</h2><blockquote>
<p>ä¸¤è€…çš„ä½œç”¨éƒ½æ˜¯å°†å¯¹è±¡è½¬åŒ–ä¸ºå­—ç¬¦ä¸²</p>
</blockquote>
<ul>
<li>repr()æ–¹æ³•è¿”å›å¯¹<code>Pythonè§£é‡Šå™¨</code>å‹å¥½çš„å­—ç¬¦ä¸²æ ¼å¼</li>
<li>str()æ–¹æ³•è¿”å›å¯¹<code>äººé˜…è¯»</code>å‹å¥½çš„å­—ç¬¦ä¸²æ ¼å¼</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>repr(<span class="string">'æåœ°ç‘é›ª'</span>)</span><br><span class="line"><span class="string">"'æåœ°ç‘é›ª'"</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>repr(<span class="string">'Polar Snow'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">"'Polar Snow'"</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>repr(<span class="number">59</span>)</span><br><span class="line"><span class="string">'59'</span></span><br><span class="line">------------</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>str(<span class="string">'æåœ°ç‘é›ª'</span>)</span><br><span class="line"><span class="string">'æåœ°ç‘é›ª'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>str(<span class="string">'Polar Snow'</span>)</span><br><span class="line"><span class="string">'Polar Snow'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>str(<span class="number">59</span>)</span><br><span class="line"><span class="string">'59'</span></span><br></pre></td></tr></table></figure>

<ul>
<li><a href="http://www.oschina.net/translate/difference-between-str-and-repr-in-python" target="_blank" rel="noopener">æ›´è¯¦ç»†çš„åŒºåˆ«å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« </a></li>
</ul>
<hr>
<h1 id="bin-x"><a href="#bin-x" class="headerlink" title="bin(x)"></a>bin(x)</h1><p>bin(x) æ¥æ”¶ä¸€ä¸ªåè¿›åˆ¶,è¿”å›äºŒè¿›åˆ¶ 0b</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>bin(<span class="number">59</span>)</span><br><span class="line"><span class="string">'0b111011'</span></span><br></pre></td></tr></table></figure>

<h1 id="oct-x"><a href="#oct-x" class="headerlink" title="oct(x)"></a>oct(x)</h1><p>oct(x) æ¥æ”¶ä¸€ä¸ªåè¿›åˆ¶,è¿”å›å…«è¿›åˆ¶ 0o</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>oct(<span class="number">59</span>)</span><br><span class="line"><span class="string">'0o73'</span></span><br></pre></td></tr></table></figure>

<h1 id="hex-x"><a href="#hex-x" class="headerlink" title="hex(x)"></a>hex(x)</h1><p>hex(x) æ¥æ”¶ä¸€ä¸ªåè¿›åˆ¶,è¿”å›åå…­è¿›åˆ¶ 0x</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>hex(<span class="number">59</span>)</span><br><span class="line"><span class="string">'0x3b'</span></span><br></pre></td></tr></table></figure>

<hr>
<h1 id="bool-x"><a href="#bool-x" class="headerlink" title="bool([x])"></a>bool([x])</h1><p>bool([x]) åˆ¤æ–­å…ƒç´ çœŸå‡, ä»¥ä¸‹å…ƒç´ ä¸ºå¸¸å‡ºç°çš„å‡å…ƒç´ ï¼š</p>
<ul>
<li>0</li>
<li>â€˜â€™</li>
<li>[]</li>
<li>()</li>
<li>{}</li>
<li>set()</li>
<li>False</li>
</ul>
<hr>
<h1 id="bytes"><a href="#bytes" class="headerlink" title="bytes"></a>bytes</h1><p>betes() æŠŠæŒ‡å®šçš„å­—ç¬¦ä¸²è½¬æ¢ä¸ºå­—èŠ‚ç±»å‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>bytes(<span class="string">'æåœ°ç‘é›ª'</span>, encoding=<span class="string">'utf-8'</span>)</span><br><span class="line"><span class="string">b'\xe6\x9e\x81\xe5\x9c\xb0\xe7\x91\x9e\xe9\x9b\xaa'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>str(<span class="string">b'\xe6\x9e\x81\xe5\x9c\xb0\xe7\x91\x9e\xe9\x9b\xaa'</span>, encoding=<span class="string">'utf-8'</span>)</span><br><span class="line"><span class="string">'æåœ°ç‘é›ª'</span></span><br><span class="line">------------</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>bytes(<span class="string">'æåœ°ç‘é›ª'</span>, encoding=<span class="string">'gbk'</span>)</span><br><span class="line"><span class="string">b'\xbc\xab\xb5\xd8\xc8\xf0\xd1\xa9'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>str(<span class="string">b'\xbc\xab\xb5\xd8\xc8\xf0\xd1\xa9'</span>, encoding=<span class="string">'gbk'</span>)</span><br><span class="line"><span class="string">'æåœ°ç‘é›ª'</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>ä¸€ä¸ªæ±‰å­—ä½¿ç”¨utf-8ç¼–ç çš„è¯å ç”¨ä¸‰ä¸ªå­—èŠ‚,ä½¿ç”¨gbkç¼–ç çš„è¯å ç”¨ä¸¤ä¸ªå­—èŠ‚</p>
</blockquote>
<ul>
<li>æ‰“å¼€æ–‡ä»¶ä¹±ç å®å†µå†ç°:</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">u = bytes(<span class="string">'å•ç‘'</span>, encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">s = str(u, encoding=<span class="string">'gbk'</span>)</span><br><span class="line">print(s)</span><br><span class="line"></span><br><span class="line"><span class="comment">######è¿è¡Œç»“æœ</span></span><br><span class="line">éšæ› æ†º</span><br></pre></td></tr></table></figure>

<p><strong>å¦‚æœä¸€ä¸ªæ–‡ä»¶æ˜¯ä»¥utf-8çš„ç¼–ç æ–¹å¼ä¿å­˜,æ¯ä¸‰ä¸ªå­—èŠ‚æ˜¯ä¸€ä¸ªæ±‰å­—,å†åŒæ ·ä»¥utf-8çš„æ–¹å¼è¯»å–,ä¼šæ­£ç¡®çš„æŒ‰ç…§3ä¸ªå­—èŠ‚ä¸€ä¸ªæ±‰å­—å»è¯»å–æ–‡ä»¶,è€Œå¦‚æœä»¥gbkçš„æ–¹å¼è¯»å–æ–‡ä»¶,ä¼šæŒ‰ç…§ä¸¤ä¸ªå­—èŠ‚ä¸€ä¸ªæ±‰å­—çš„æ–¹å¼è¯»å–,æ‰€ä»¥ä¼šäº§ç”Ÿä¹±ç çš„æƒ…å†µ</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">                        æåœ°ç‘é›ª(UTF-8)</span><br><span class="line">äºŒè¿›åˆ¶:    11100110 10011110 10000001 11100101 10011100 10110000 11100111 10010001 10011110 11101001 10011011 10101010</span><br><span class="line">åè¿›åˆ¶:    230 158 129 229 156 176 231 145 158 233 155 170</span><br><span class="line">åå…­è¿›åˆ¶:   e6 9e 81 e5 9c b0 e7 91 9e e9 9b aa</span><br><span class="line"></span><br><span class="line">æ³¨æ„ï¼šäºŒè¿›åˆ¶çš„è¡¨ç°å½¢å¼ä¸ºå­—èŠ‚</span><br></pre></td></tr></table></figure>

<ul>
<li>ç”¨é¦™æ¥è¡¨ç¤ºç²¾ç¡®æ•°å­—çš„å°æ•…äº‹(äºŒè¿›åˆ¶è½¬åè¿›åˆ¶)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ä¸€æ”¯é¦™æœ‰ä¸¤ç§çŠ¶æ€,ç‚¹ç‡ƒçš„æƒ…å†µå’Œç†„ç­çš„æƒ…å†µ</span><br><span class="line">ç°åœ¨å®šä¹‰:é¦™ç†„ç­[I]çš„çŠ¶æ€è¡¨ç¤º0,ç‚¹ç‡ƒ[i]çš„æƒ…å†µè¡¨ç¤ºä¸º1</span><br><span class="line">0:  é‚£ä¹ˆæˆ‘ç°åœ¨è¦è¡¨ç¤º0,å¾ˆç®€å•,ä¸€æ”¯é¦™è¶³å¤Ÿ,ç†„ç­å°±è¡Œäº†--[I]</span><br><span class="line">                                               0</span><br><span class="line">1:  ä¸€æ”¯é¦™è¶³å¤Ÿ,ç‚¹ç‡ƒå³å¯--[i]</span><br><span class="line">                       1</span><br><span class="line">2:  ä¸€æ”¯é¦™æœ€å¤šåªèƒ½è¡¨ç¤ºåˆ°1,å¦‚æœè¦è¡¨ç¤º2,éœ€è¦åœ¨å‰é¢åŠ ä¸€æ”¯é¦™æ¥è¡¨ç¤º2,è¿™æ ·æˆ‘åªéœ€ç‚¹ç‡ƒå¤´ä¸€æ”¯é¦™å³å¯è¡¨ç¤º2--[iI]</span><br><span class="line">                                                                                      10</span><br><span class="line">3: ä¸¤æ”¯é¦™çš„è¯,ç¬¬ä¸€æ”¯è¡¨ç¤º2,ç¬¬ä¸€æ”¯æœ€å¤šè¡¨ç¤º1,åªéœ€å°†ç¬¬äºŒæ”¯ç‚¹ç‡ƒå³å¯è¡¨ç¤º3--[ii]</span><br><span class="line">                                                              11</span><br><span class="line">4: ä¸¤æ”¯é¦™æœ€å¤§å¯è¡¨ç¤ºåˆ°3,ç°åœ¨éœ€è¦åŠ ç¬¬ä¸‰æ”¯é¦™æ¥è¡¨ç¤º4--[iII]</span><br><span class="line">                                             100</span><br><span class="line">5: ä»¥æ­¤ç±»æ¨--[iIi]</span><br><span class="line">             101</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">å…³ç³»å›¾:</span><br><span class="line">        æœ€å¤§è¡¨ç¤º:1</span><br><span class="line">0:             [I]</span><br><span class="line">           çŠ¶æ€:0</span><br><span class="line">-------------------</span><br><span class="line">        æœ€å¤§è¡¨ç¤º:1</span><br><span class="line">1:             [i]</span><br><span class="line">           çŠ¶æ€:1</span><br><span class="line">-------------------</span><br><span class="line">        æœ€å¤§è¡¨ç¤º:2 1</span><br><span class="line">2:             [i I]</span><br><span class="line">           çŠ¶æ€:1 0</span><br><span class="line">-------------------</span><br><span class="line">        æœ€å¤§è¡¨ç¤º:2 1</span><br><span class="line">3:             [i i]</span><br><span class="line">           çŠ¶æ€:1 1</span><br><span class="line">-------------------</span><br><span class="line">        æœ€å¤§è¡¨ç¤º:4 2 1</span><br><span class="line">4:             [i I I]</span><br><span class="line">           çŠ¶æ€:1 0 0</span><br><span class="line">-------------------</span><br><span class="line">        æœ€å¤§è¡¨ç¤º:4 2 1</span><br><span class="line">5:             [i I i]</span><br><span class="line">           çŠ¶æ€:1 0 1</span><br><span class="line">-------------------</span><br><span class="line">        æœ€å¤§è¡¨ç¤º:4 2 1</span><br><span class="line">6:             [i i I]</span><br><span class="line">           çŠ¶æ€:1 1 0</span><br><span class="line">-------------------</span><br><span class="line">        æœ€å¤§è¡¨ç¤º:4 2 1</span><br><span class="line">7:             [i i i]</span><br><span class="line">           çŠ¶æ€:1 1 1</span><br><span class="line">-------------------</span><br><span class="line">        æœ€å¤§è¡¨ç¤º:8 4 2 1</span><br><span class="line">8:             [i I I I]</span><br><span class="line">           çŠ¶æ€:1 0 0 0</span><br><span class="line">-------------------</span><br><span class="line">        æœ€å¤§è¡¨ç¤º:8 4 2 1</span><br><span class="line">9:             [i I I i]</span><br><span class="line">           çŠ¶æ€:1 0 0 1</span><br><span class="line">-------------------</span><br><span class="line">        æœ€å¤§è¡¨ç¤º:8 4 2 1</span><br><span class="line">10:            [i I i I]</span><br><span class="line">           çŠ¶æ€:1 0 1 0</span><br><span class="line">-------------------</span><br><span class="line">        æœ€å¤§è¡¨ç¤º:8 4 2 1</span><br><span class="line">11:            [i I i i]</span><br><span class="line">           çŠ¶æ€:1 0 1 1</span><br><span class="line">-------------------</span><br><span class="line">        æœ€å¤§è¡¨ç¤º:8 4 2 1</span><br><span class="line">12:            [i i I I]</span><br><span class="line">           çŠ¶æ€:1 1 0 0</span><br><span class="line">-------------------</span><br><span class="line">        æœ€å¤§è¡¨ç¤º:8 4 2 1</span><br><span class="line">13:            [i i I i]</span><br><span class="line">           çŠ¶æ€:1 1 0 1</span><br><span class="line">-------------------</span><br><span class="line">        æœ€å¤§è¡¨ç¤º:8 4 2 1</span><br><span class="line">14:            [i i i I]</span><br><span class="line">           çŠ¶æ€:1 1 1 0</span><br><span class="line">-------------------</span><br><span class="line">        æœ€å¤§è¡¨ç¤º:8 4 2 1</span><br><span class="line">15:            [i i i i]</span><br><span class="line">           çŠ¶æ€:1 1 1 1</span><br><span class="line">-------------------</span><br><span class="line">        æœ€å¤§è¡¨ç¤º:16 8 4 2 1</span><br><span class="line">16:             [i I I I I]</span><br><span class="line">            çŠ¶æ€:1 0 0 0 0</span><br><span class="line">-------------------</span><br><span class="line">â€¦â€¦ä»¥æ­¤ç±»æ¨</span><br><span class="line">ä»2å¼€å§‹,æ¯ç¿»ä¸€ç•ªå°±å¤šä¸€æ”¯é¦™æ¥è¡¨ç¤º</span><br><span class="line">4(2æ”¯),8(3æ”¯),16(4æ”¯)éƒ½å¢åŠ äº†ä¸€æ”¯é¦™ç±»è¡¨ç¤º</span><br><span class="line">32(5æ”¯),64(6æ”¯),128(7æ”¯),256(8æ”¯),512(9æ”¯),1024(10æ”¯)</span><br><span class="line">ä¹Ÿå¯ä»¥æŠŠ&quot;æ”¯&quot;æ¢æˆ&quot;2çš„xæ¬¡æ–¹&quot;--&gt; 2çš„10æ¬¡æ–¹&#x3D;1024</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="callable-object"><a href="#callable-object" class="headerlink" title="callable(object)"></a>callable(object)</h1><p>callable(object) æ£€æŸ¥å¯¹è±¡æ˜¯å¦å¯ä»¥è¢«æ‰§è¡Œè°ƒç”¨</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f1</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"><span class="comment"># f1()</span></span><br><span class="line"></span><br><span class="line">f2 = <span class="number">123</span></span><br><span class="line"><span class="comment"># f2()</span></span><br><span class="line"></span><br><span class="line">print(callable(f1))</span><br><span class="line">print(callable(f2))</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="literal">False</span></span><br></pre></td></tr></table></figure>

<hr>
<h1 id="chr-i"><a href="#chr-i" class="headerlink" title="chr(i)"></a>chr(i)</h1><p>chr(i) å°†æ•°å­—è½¬æ¢ä¸ºå­—ç¬¦</p>
<p>Python3ä¸­ï¼Œchr() ä¸ä»…åŒ…å«asciiçš„å¯¹ç…§è¡¨ï¼Œè¿˜åŒ…å«äº†Unicodeå¯¹ç…§è¡¨</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>chr(<span class="number">59</span>)</span><br><span class="line"><span class="string">';'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>chr(<span class="number">8364</span>)</span><br><span class="line"><span class="string">'â‚¬'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>chr(<span class="number">201559</span>)</span><br><span class="line"><span class="string">'\U00031357'</span></span><br></pre></td></tr></table></figure>

<hr>
<h1 id="classmethod-function"><a href="#classmethod-function" class="headerlink" title="classmethod(function)"></a>classmethod(function)</h1><p>classmethod(function) æ˜¯ä¸€ä¸ªè£…é¥°å™¨å‡½æ•°ï¼Œä¸€èˆ¬ä¼šä½¿ç”¨<code>@classmethod</code>çš„æ–¹å¼æ¥è°ƒç”¨ï¼Œç”¨æ¥è¡¨ç¤ºä¸‹é¢çš„æ–¹æ³•æ˜¯<code>ç±»æ–¹æ³•</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span>:</span></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(cls, arg1, arg2, ...)</span>:</span> ...</span><br></pre></td></tr></table></figure>

<p>ä»£ç å®ä¾‹ï¼š<a href="http://www.pythontab.com/html/2013/hanshu_0129/186.html" target="_blank" rel="noopener">å‚è€ƒè‡ªPythontab</a></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">C</span>:</span></span><br><span class="line"><span class="meta">... </span>    @classmethod</span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(cls)</span>:</span></span><br><span class="line"><span class="meta">... </span>            <span class="keyword">print</span> <span class="string">"This is a class method"</span></span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>C.f()</span><br><span class="line">This <span class="keyword">is</span> a <span class="class"><span class="keyword">class</span> <span class="title">method</span></span></span><br><span class="line">&gt;&gt;&gt; c = C()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>c.f()</span><br><span class="line">This <span class="keyword">is</span> a <span class="class"><span class="keyword">class</span> <span class="title">method</span></span></span><br><span class="line"><span class="class">&gt;&gt;&gt; <span class="title">class</span> <span class="title">D</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(self)</span>:</span></span><br><span class="line"><span class="meta">... </span>            <span class="keyword">print</span> <span class="string">" This is not a class method "</span></span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>D.f()</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">TypeError: unbound method f() must be called <span class="keyword">with</span> D instance <span class="keyword">as</span> first argument (got nothing instead)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d = D()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d.f()</span><br><span class="line">This <span class="keyword">is</span> <span class="keyword">not</span> a <span class="class"><span class="keyword">class</span> <span class="title">method</span></span></span><br></pre></td></tr></table></figure>

<h1 id="staticmethod-function"><a href="#staticmethod-function" class="headerlink" title="staticmethod(function)"></a>staticmethod(function)</h1><p>staticmethod(function) æ˜¯ä¸€ä¸ªè£…é¥°å™¨å‡½æ•°ï¼Œ ä¸€èˆ¬ä¼šä½¿ç”¨<code>@staticmethod</code>çš„æ–¹å¼æ¥è°ƒç”¨ï¼Œç”¨æ¥è¡¨ç¤ºä¸‹é¢çš„æ–¹æ³•çš„<code>é™æ€æ–¹æ³•</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span>:</span></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(arg1, arg2, ...)</span>:</span> ...</span><br></pre></td></tr></table></figure>

<h2 id="classmethod-function-staticmethod-function-å’Œå®ä¾‹æ–¹æ³•çš„åŒºåˆ«"><a href="#classmethod-function-staticmethod-function-å’Œå®ä¾‹æ–¹æ³•çš„åŒºåˆ«" class="headerlink" title="classmethod(function) / staticmethod(function) å’Œå®ä¾‹æ–¹æ³•çš„åŒºåˆ«"></a>classmethod(function) / staticmethod(function) å’Œå®ä¾‹æ–¹æ³•çš„åŒºåˆ«</h2><blockquote>
<p>å®ä¾‹çš„æ–¹æ³•é’ˆå¯¹çš„æ˜¯å…·ä½“æŸä¸€å®ä¾‹åŒ–å¯¹è±¡çš„æ–¹æ³•ï¼›ç±»æ–¹æ³•é’ˆå¯¹çš„æ˜¯æŸä¸€ç±»çš„æ–¹æ³•ï¼›é™æ€æ–¹æ³•å¯ä»¥ä¸ç±»æˆ–å®ä¾‹åŒ–æ— å…³</p>
</blockquote>
<ul>
<li>ç±»æ–¹æ³•ï¼š<ul>
<li>ç±»æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯<code>class</code></li>
<li>ç±»æ–¹æ³•å¯ä»¥é€šè¿‡ç±»ç›´æ¥è°ƒç”¨ï¼Œä¸éœ€è¦ä¼ é€’å®ä¾‹çš„å¼•ç”¨</li>
<li>é»˜è®¤å°†è¯¥classå¯¹è±¡ï¼ˆä¸æ˜¯classå®ä¾‹åŒ–å¯¹è±¡ï¼‰éšå¼çš„ä¼ é€’ç»™æ–¹æ³•</li>
</ul>
</li>
<li>é™æ€æ–¹æ³•ï¼š<ul>
<li>é™æ€æ–¹æ³•å¯ä»¥è®¤ä¸ºæ˜¯å…¨å±€å‡½æ•°</li>
<li>é™æ€æ–¹æ³•å¯ä»¥ç”¨ç±»è°ƒç”¨ï¼Œä¹Ÿå¯ä»¥ç”¨å¯¹è±¡è°ƒç”¨</li>
<li>ä¸ä¼šéšå¼çš„ä¼ å…¥ä»»ä½•å‚æ•°</li>
</ul>
</li>
<li>å®ä¾‹æ–¹æ³•ï¼š<ul>
<li>å®ä¾‹æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯<code>self</code></li>
<li>å®ä¾‹æ–¹æ³•å¿…é¡»é€šè¿‡å®ä¾‹åŒ–çš„å¯¹è±¡å»è°ƒç”¨ï¼ˆPython3å¯ä»¥ä¼ é€’ä»»æ„å¯¹è±¡ï¼ŒPython2ä¸­ä¼šæŠ¥é”™ï¼‰</li>
<li>é»˜è®¤å°†è¯¥å®ä¾‹åŒ–å¯¹è±¡éšå¼çš„ä¼ é€’ç»™æ–¹æ³•</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">(self)</span>:</span>    <span class="comment">#å®šä¹‰äº†å®ä¾‹æ–¹æ³•</span></span><br><span class="line">        print(<span class="string">"object"</span>)</span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test2</span><span class="params">(clss)</span>:</span>    <span class="comment">#å®šä¹‰äº†ç±»æ–¹æ³•</span></span><br><span class="line">        print(<span class="string">"class"</span>)</span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test3</span><span class="params">()</span>:</span>    <span class="comment">#å®šä¹‰äº†é™æ€æ–¹æ³•</span></span><br><span class="line">        print(<span class="string">"static"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®ä¾‹æ–¹æ³•çš„è°ƒç”¨æ–¹å¼</span></span><br><span class="line"><span class="comment"># ç¬¬ä¸€ç§æ–¹å¼ï¼Œå…ˆç”Ÿæˆå¯¹è±¡ï¼ˆå…ˆå®ä¾‹åŒ–ï¼‰å†è°ƒç”¨</span></span><br><span class="line">f1 = Foo()</span><br><span class="line">f1.test()</span><br><span class="line"><span class="comment"># ç¬¬äºŒç§æ–¹å¼ï¼Œè‡ªå·±ä¼ é€’å®ä¾‹çš„å¼•ç”¨</span></span><br><span class="line">Foo.test(f1)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç±»æ–¹æ³•çš„è°ƒç”¨æ–¹å¼</span></span><br><span class="line"><span class="comment"># å¯ä»¥ç›´æ¥ä½¿ç”¨ç±»æ¥è°ƒç”¨,ä¸éœ€è¦ä¼ é€’å®ä¾‹çš„å¼•ç”¨</span></span><br><span class="line">Foo.test2()</span><br><span class="line"></span><br><span class="line"><span class="comment"># é™æ€æ–¹æ³•çš„è°ƒç”¨æ–¹å¼</span></span><br><span class="line"><span class="comment"># ç¬¬ä¸€ç§æ–¹å¼,ä½¿ç”¨å®ä¾‹åŒ–å¯¹è±¡æ¥è°ƒç”¨é™æ€æ–¹æ³•</span></span><br><span class="line">f3 = Foo()</span><br><span class="line">f3.test3()</span><br><span class="line"><span class="comment"># ç¬¬äºŒç§æ–¹å¼,ä½¿ç”¨ç±»æ¥è°ƒç”¨é™æ€æ–¹æ³•</span></span><br><span class="line">Foo.test3()</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">object</span><br><span class="line">object</span><br><span class="line"><span class="class"><span class="keyword">class</span></span></span><br><span class="line"><span class="class"><span class="title">static</span></span></span><br><span class="line"><span class="class"><span class="title">static</span></span></span><br></pre></td></tr></table></figure>




<p>ä»£ç å®ä¾‹ï¼š<a href="http://genggeng.iteye.com/blog/1290458" target="_blank" rel="noopener">å‚è€ƒè‡ªITEYE</a></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span>  </span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span>  </span><br><span class="line">        <span class="keyword">print</span> <span class="string">"init"</span>  </span><br><span class="line"> </span><br><span class="line"><span class="meta">    @staticmethod  </span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sayHello</span><span class="params">(hello)</span>:</span>  </span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> hello:  </span><br><span class="line">            hello=<span class="string">'hello'</span>  </span><br><span class="line">        <span class="keyword">print</span> <span class="string">"i will sya %s"</span> %hello  </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="meta">    @classmethod  </span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">introduce</span><span class="params">(clazz,hello)</span>:</span>  </span><br><span class="line">        clazz.sayHello(hello)  </span><br><span class="line">        <span class="keyword">print</span> <span class="string">"from introduce method"</span>  </span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">(self,hello)</span>:</span>  </span><br><span class="line">        self.sayHello(hello)  </span><br><span class="line">        <span class="keyword">print</span> <span class="string">"from hello method"</span>         </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span>  </span><br><span class="line">    Person.sayHello(<span class="string">"haha"</span>)  </span><br><span class="line">    Person.introduce(<span class="string">"hello world!"</span>)  </span><br><span class="line">    <span class="comment">#Person.hello("self.hello") #TypeError: unbound method hello() must be called with Person instance as first argument (got str instance instead)  </span></span><br><span class="line">      </span><br><span class="line">    <span class="keyword">print</span> <span class="string">"*"</span> * <span class="number">20</span>  </span><br><span class="line">    p = Person()  </span><br><span class="line">    p.sayHello(<span class="string">"haha"</span>)  </span><br><span class="line">    p.introduce(<span class="string">"hello world!"</span>)  </span><br><span class="line">    p.hello(<span class="string">"self.hello"</span>)  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">'__main__'</span>:  </span><br><span class="line">    main() </span><br><span class="line">    </span><br><span class="line">------------</span><br><span class="line">i will sya haha  </span><br><span class="line">i will sya hello world!  </span><br><span class="line"><span class="keyword">from</span> introduce method  </span><br><span class="line">********************  </span><br><span class="line">init  </span><br><span class="line">i will sya haha  </span><br><span class="line">i will sya hello world!  </span><br><span class="line"><span class="keyword">from</span> introduce method  </span><br><span class="line">i will sya self.hello  </span><br><span class="line"><span class="keyword">from</span> hello method </span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line"><span class="comment"># compile(source, filename, mode, flags=0, dont_inherit=False, optimize=-1)</span></span><br><span class="line"></span><br><span class="line">compile(source, filename, mode, flags=<span class="number">0</span>, dont_inherit=<span class="literal">False</span>, optimize=<span class="number">-1</span>) æŠŠå­—ç¬¦ä¸²ç¼–è¯‘æˆPythontabä»£ç ï¼Œç¼–è¯‘åå¯ä»¥é€šè¿‡`eval()`æˆ–`exec()`æ¥æ‰§è¡Œ</span><br><span class="line"></span><br><span class="line">```python</span><br><span class="line">s = <span class="string">"print(123)"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¼–è¯‘ï¼Œsingleï¼Œevalï¼Œexec</span></span><br><span class="line"><span class="comment"># å°†å­—ç¬¦ä¸²ç¼–è¯‘æˆpythonä»£ç </span></span><br><span class="line">r = compile(s, <span class="string">"&lt;string&gt;"</span>, <span class="string">"exec"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰§è¡Œpythonä»£ç </span></span><br><span class="line">exec(r)</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line"><span class="number">123</span></span><br></pre></td></tr></table></figure>

<p><code>print(123)</code>å’Œ<code>&#39;print(123)&#39;</code>çš„åŒºåˆ«æ˜¯ï¼Œå‰è€…å¯ä»¥è¢«Pythonè§£é‡Šå™¨è‡ªåŠ¨ç¼–è¯‘æ‰§è¡Œï¼Œè€Œåè€…åªæ˜¯ä¸ªå­—ç¬¦ä¸²è€Œå·²ã€‚å¦‚æœæƒ³è®©åé¢çš„å­—ç¬¦ä¸²å»å•è¿‡Pythonçš„å‘½ä»¤çš„å»æ‰§è¡Œï¼Œç¬¬ä¸€æ­¥å°±æ˜¯å…ˆæ‰‹åŠ¨å°†è¯¥å­—ç¬¦ä¸²è¿›è¡Œç¼–è¯‘ï¼Œç¼–è¯‘åçš„å¯¹è±¡ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œå¯ä»¥è¢«<code>eval()</code>æˆ–<code>exec()</code>æ¥æ‰§è¡Œ</p>
<p><strong>modeå‚æ•°æœ‰ä¸‰ä¸ªï¼š</strong></p>
<ul>
<li>single: æ‰§è¡Œå•æ¡è¯­å¥  â€”&gt; exec()</li>
<li>exec: å¯ä»¥æ‰§è¡Œå¤šæ¡è¯­å¥  â€”&gt; exec()</li>
<li>evel: è¿›è¡Œè¡¨è¾¾å¼è®¡ç®—  â€”&gt; evel()</li>
</ul>
<h1 id="eval-expression-globals-None-locals-None"><a href="#eval-expression-globals-None-locals-None" class="headerlink" title="eval(expression, globals=None, locals=None)"></a>eval(expression, globals=None, locals=None)</h1><p>eval(expression, globals=None, locals=None) æ‰§è¡Œå‚æ•°ä¸­çš„è¡¨è¾¾å¼å¹¶è¿”å›ç»“æœ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>x = <span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>eval(<span class="string">'x+1'</span>)</span><br><span class="line"><span class="number">2</span></span><br></pre></td></tr></table></figure>

<p>eval() å‡½æ•°åŒæ ·å¯ä»¥å¤„ç†compile()å‡½æ•°ç”Ÿæˆçš„å¯¹è±¡</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(eval(<span class="string">'5 * 9'</span>))</span><br><span class="line"></span><br><span class="line">s = <span class="string">'5 * 9'</span></span><br><span class="line">ret = compile(s, <span class="string">"&lt;string&gt;"</span>, <span class="string">'eval'</span>)</span><br><span class="line">print(eval(ret))</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line"><span class="number">45</span></span><br><span class="line"><span class="number">45</span></span><br></pre></td></tr></table></figure>

<h1 id="exec-object-globals-locals"><a href="#exec-object-globals-locals" class="headerlink" title="exec(object[, globals[, locals]])"></a>exec(object[, globals[, locals]])</h1><p>exec(object[, globals[, locals]]) æ‰§è¡Œå‚æ•°ä¸­çš„å‘½ä»¤ï¼Œè¿”å›å€¼ä¸ºNoneï¼ˆåŒºåˆ«äºevalï¼Œevalæ˜¯è®¡ç®—ï¼Œè®¡ç®—å°±éœ€è¦æœ‰è¿”å›å€¼è¿”å›è®¡ç®—ç»“æœï¼‰</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ret = exec(<span class="string">'print(123)'</span>)</span><br><span class="line">print(ret)</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line"><span class="literal">None</span></span><br></pre></td></tr></table></figure>

<p>exec() å‡½æ•°å¤„ç†compile()å‡½æ•°ç”Ÿæˆçš„å¯¹è±¡â€”mod:singleâ€”å¤„ç†å•è¡Œå‘½ä»¤</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">s = <span class="string">'print(123)'</span></span><br><span class="line">ret = compile(s, <span class="string">"&lt;string&gt;"</span>, <span class="string">'single'</span>)</span><br><span class="line">print(exec(ret))    <span class="comment">#è¿”å›å€¼ä¸ºNone</span></span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line"><span class="number">123</span></span><br><span class="line"><span class="literal">None</span></span><br></pre></td></tr></table></figure>

<p>exec() å‡½æ•°å¤„ç†compile()å‡½æ•°ç”Ÿæˆçš„å¯¹è±¡â€”mod:singleâ€”å¤„ç†å¤šè¡Œå‘½ä»¤</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">s = <span class="string">'for i in range(5): print(i)'</span></span><br><span class="line">ret = compile(s, <span class="string">"&lt;string&gt;"</span>, <span class="string">'single'</span>)</span><br><span class="line">print(exec(ret))</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"/Users/lvrui/PycharmProjects/untitled/4/test.py"</span>, line <span class="number">43</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    ret = compile(s, <span class="string">"&lt;string&gt;"</span>, <span class="string">'single'</span>)</span><br><span class="line">  File <span class="string">"&lt;string&gt;"</span>, line <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>): print(i)</span><br><span class="line">                              ^</span><br><span class="line">SyntaxError: unexpected EOF <span class="keyword">while</span> parsing</span><br><span class="line"><span class="comment"># single æ¨¡å¼æ— æ³•å¤„ç†å¤šè¡Œå‘½ä»¤ï¼Œåº”è¯¥ä½¿ç”¨ execæ¨¡å¼</span></span><br></pre></td></tr></table></figure>

<p>exec() å‡½æ•°å¤„ç†compile()å‡½æ•°ç”Ÿæˆçš„å¯¹è±¡â€”mod:execâ€”å¤„ç†å¤šè¡Œå‘½ä»¤</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">s = <span class="string">'for i in range(5): print(i)'</span></span><br><span class="line">ret = compile(s, <span class="string">"&lt;string&gt;"</span>, <span class="string">'exec'</span>)</span><br><span class="line">print(exec(ret))    <span class="comment">#è¿”å›å€¼ä¸ºNone</span></span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="literal">None</span></span><br></pre></td></tr></table></figure>

<p>ä»£ç å®ä¾‹ï¼š<a href="http://www.pythoner.com/56.html" target="_blank" rel="noopener">å‚è€ƒPythoner</a></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>eval_code = compile( <span class="string">'1+2'</span>, <span class="string">''</span>, <span class="string">'eval'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>eval_code</span><br><span class="line">&lt;code object &lt;module&gt; at <span class="number">0142</span>ABF0, file <span class="string">""</span>, line <span class="number">1</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>eval(eval_code)</span><br><span class="line"><span class="number">3</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>single_code = compile( <span class="string">'print "pythoner.com"'</span>, <span class="string">''</span>, <span class="string">'single'</span> )</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>single_code</span><br><span class="line">&lt;code object &lt;module&gt; at <span class="number">01</span>C68848, file <span class="string">""</span>, line <span class="number">1</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>exec(single_code)</span><br><span class="line">pythoner.com</span><br><span class="line"> </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>exec_code = compile( <span class="string">"""for i in range(5):</span></span><br><span class="line"><span class="string"><span class="meta">... </span>  print "iter time: %d" % i"""</span>, <span class="string">''</span>, <span class="string">'exec'</span> )</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>exec_code</span><br><span class="line">&lt;code object &lt;module&gt; at <span class="number">01</span>C68968, file <span class="string">""</span>, line <span class="number">1</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>exec(exec_code)</span><br><span class="line">iter time: <span class="number">0</span></span><br><span class="line">iter time: <span class="number">1</span></span><br><span class="line">iter time: <span class="number">2</span></span><br><span class="line">iter time: <span class="number">3</span></span><br><span class="line">iter time: <span class="number">4</span></span><br></pre></td></tr></table></figure>

<h1 id="Pythonåå°„ç›¸å…³"><a href="#Pythonåå°„ç›¸å…³" class="headerlink" title="Pythonåå°„ç›¸å…³"></a>Pythonåå°„ç›¸å…³</h1><ul>
<li>delattr()</li>
<li>hasattr()</li>
<li>getattr()</li>
<li>setattr()</li>
<li>__import__()</li>
</ul>
<p>è¯¦ç»†ä»‹ç»è¯·<a href="http://docs.20150509.cn/2016/06/16/Pythonåå°„è¯¦è§£/" target="_blank" rel="noopener">ç‚¹å‡»è¿™é‡ŒæŸ¥çœ‹</a></p>
<h1 id="æœªæ•´ç†å®Œçš„å†…å»ºå‡½æ•°"><a href="#æœªæ•´ç†å®Œçš„å†…å»ºå‡½æ•°" class="headerlink" title="æœªæ•´ç†å®Œçš„å†…å»ºå‡½æ•°"></a>æœªæ•´ç†å®Œçš„å†…å»ºå‡½æ•°</h1><ol>
<li>bytearray()</li>
<li>complex()</li>
<li>dict()</li>
<li>dir()</li>
<li>divmod()</li>
<li>enumerate()</li>
<li>filter()</li>
<li>float()</li>
<li>format()</li>
<li>frozenset()</li>
<li>globals()</li>
<li>hash()</li>
<li>help()</li>
<li>id()</li>
<li>input()</li>
<li>int()</li>
<li>isinstance()</li>
<li>issubclass()</li>
<li>iter()</li>
<li>len()</li>
<li>list()</li>
<li>locals()</li>
<li>map()</li>
<li>max()</li>
<li>memoryview()</li>
<li>min()</li>
<li>next()</li>
<li>object()</li>
<li>open()</li>
<li>pow()</li>
<li>print()</li>
<li>property()</li>
<li>range()</li>
<li>reversed()</li>
<li>round()</li>
<li>set()</li>
<li>slice()</li>
<li>sorted()</li>
<li>sum()</li>
<li>super()</li>
<li>tuple()</li>
<li>type()</li>
<li>vars()</li>
<li>zip()</li>
</ol>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>Pythonæ ‡å‡†åº“</tag>
        <tag>Pythonå†…å»ºå‡½æ•°</tag>
      </tags>
  </entry>
  <entry>
    <title>Kuberneteså…¥é—¨ç®€ä»‹</title>
    <url>/2016/05/31/Kubernetes%E5%85%A5%E9%97%A8%E7%AE%80%E4%BB%8B/</url>
    <content><![CDATA[<blockquote>
<p>Kubernetesæ˜¯è°·æ­Œå¼€æºçš„ä¸€æ¬¾å¤§è§„æ¨¡å®¹å™¨ç®¡ç†å¹³å°ï¼Œåœ¨ä»‹ç»è¿™ä¸€å¹³å°ä¹‹å‰ï¼Œå…ˆè·Ÿå¤§å®¶è®¨è®ºä¸€ä¸‹è¿™ä¸ªå•è¯çš„è¯»æ³•ï¼å®é™…ä¸Šï¼Œè¿™ä¸ªå•è¯ä½ åœ¨è‹±æ–‡è¯å…¸ä¸Šæ ¹æœ¬æŸ¥ä¸ç€ï¼Œå› ä¸ºå®ƒä¸æ˜¯ä¸€ä¸ªâ€œè‹±æ–‡å•è¯â€ï¼ŒKubernetesï¼Œå¤å¸Œè…Šè¯­æ˜¯èˆµæ‰‹çš„æ„æ€ï¼Œæ˜¯Cyberçš„è¯æºã€‚æ ¹æ®å…¶æ‹¼å†™ï¼Œæˆ‘ä¹ æƒ¯ç§°å‘¼å®ƒä¸ºâ€œk8sâ€</p>
</blockquote>
<h1 id="å›½å†…å“ªäº›å…¬å¸åœ¨å¤§è§„æ¨¡çš„ä½¿ç”¨Kubernetes"><a href="#å›½å†…å“ªäº›å…¬å¸åœ¨å¤§è§„æ¨¡çš„ä½¿ç”¨Kubernetes" class="headerlink" title="å›½å†…å“ªäº›å…¬å¸åœ¨å¤§è§„æ¨¡çš„ä½¿ç”¨Kubernetes"></a>å›½å†…å“ªäº›å…¬å¸åœ¨å¤§è§„æ¨¡çš„ä½¿ç”¨Kubernetes</h1><ul>
<li><p>æ»´æ»´</p>
</li>
<li><p>ç½‘å®¿</p>
</li>
</ul>
<h1 id="Kubernetesæ˜¯ä»€ä¹ˆ"><a href="#Kubernetesæ˜¯ä»€ä¹ˆ" class="headerlink" title="Kubernetesæ˜¯ä»€ä¹ˆ"></a>Kubernetesæ˜¯ä»€ä¹ˆ</h1><p>Kubernetesæ˜¯Googleå¼€æºçš„å®¹å™¨é›†ç¾¤ç®¡ç†ç³»ç»Ÿã€‚å®ƒæ„å»ºåœ¨Dockerä¹‹ä¸Šï¼Œä¸ºå®¹å™¨è¯çš„åº”ç”¨æä¾›èµ„æºè°ƒåº¦ã€éƒ¨ç½²è¿è¡Œã€æœåŠ¡å‘ç°ã€æ‰©å®¹ç¼©å®¹ç­‰ä¸€æ•´å¥—åŠŸèƒ½ï¼Œæœ¬è´¨ä¸Šå¯ä»¥çœ‹åšæ˜¯åŸºäºå®¹å™¨æŠ€æœ¯çš„Micro-PaaSå¹³å°ï¼Œæ˜¯ç¬¬ä¸‰ä»£PaaSæŠ€æœ¯çš„ä»£è¡¨ä¹‹ä½œã€‚</p>
<p>Googleä»2004å¹´å¼€å§‹å°±å·²ç»å¼€å§‹åœ¨ä½¿ç”¨å®¹å™¨æŠ€æœ¯äº†ï¼Œäº2006å¹´å‘å¸ƒäº†Cgroupï¼Œè€Œä¸”å†…éƒ¨å¼€å‘çš„å¼ºå¤§çš„é›†ç¾¤èµ„æºç®¡ç†å¹³å°Borgå’ŒOmegaï¼Œè¿™äº›éƒ½å·²ç»å¹¿æ³›ç”¨åœ¨Googleçš„å„ä¸ªåŸºç¡€è®¾æ–½ä¸­ï¼Œè€ŒKuberneteså¾—çµæ„Ÿæ¥æºäºGoogleå†…éƒ¨çš„Borgç³»ç»Ÿï¼Œæ›´æ˜¯å¸æ”¶äº†åŒ…æ‹¬Omegaåœ¨å†…çš„å®¹å™¨ç®¡ç†å™¨çš„ç»éªŒå’Œæ•™è®­ã€‚</p>
<p>Kubernetesæœ‰ç€ä»¥ä¸‹ä¼˜ç§€çš„ç‰¹æ€§ï¼š</p>
<ul>
<li><p>å¼ºå¤§çš„å®¹å™¨ç¼–æ’èƒ½åŠ›</p>
<p>Kuberneteså¯ä»¥è¯´æ˜¯åŒDockerä¸€èµ·å‘å±•èµ·æ¥çš„ï¼Œæ·±åº¦é›†æˆäº†Dockerï¼Œå¤©ç„¶é€‚åº”å®¹å™¨çš„ç‰¹ç‚¹ï¼Œè®¾è®¡å‡ºå¼ºå¤§çš„å®¹å™¨ç¼–æ’èƒ½åŠ›ï¼Œæ¯”å¦‚å®¹å™¨ç»„åˆã€æ ‡ç­¾é€‰æ‹©å’ŒæœåŠ¡å‘ç°ç­‰ï¼Œå¯ä»¥æ»¡è¶³ä¼ä¸šçº§çš„éœ€æ±‚</p>
</li>
<li><p>è½»é‡çº§</p>
<p>Kuberneteséµå¾ªå¾®æœåŠ¡æ¶æ„ç†è®ºï¼Œæ•´ä¸ªç³»ç»Ÿåˆ’åˆ†å‡ºå„ä¸ªåŠŸèƒ½ç‹¬ç«‹çš„ç»„ä»¶ï¼Œç»„ä»¶ä¹‹é—´è¾¹ç•Œæ¸…æ™°ï¼Œéƒ¨ç½²ç®€å•ï¼Œå¯ä»¥è½»æ˜“åœ°è¿è¡Œåœ¨å„ç§ç³»ç»Ÿå’Œç¯å¢ƒä¸­ã€‚åŒæ—¶Kubernetesä¸­çš„è®¸å¤šåŠŸèƒ½éƒ½å®ç°äº†æ’ä»¶åŒ–ï¼Œå¯ä»¥éå¸¸æ–¹ä¾¿åœ°è¿›è¡Œæ‰©å±•å’Œæ›¿æ¢ã€‚</p>
</li>
<li><p>å¼€æ”¾ å¼€æº</p>
<p>Kubernetesé¡ºåº”äº†å¼€æ”¾å¼€æºçš„è¶‹åŠ¿ï¼Œå¸å¼•äº†å¤§æ‰¹å¼€å‘è€…å’Œå…¬å¸å‚ä¸å…¶ä¸­ï¼ŒååŒå·¥ä½œï¼Œå…±åŒæ„å»ºç”Ÿæ€åœˆã€‚åŒæ—¶ï¼ŒKubernetesåŒOpenstackã€Dockerç­‰å¼€æºç¤¾åŒºç§¯æåˆä½œã€å…±åŒå‘å±•</p>
</li>
</ul>
<h1 id="Kubernetesçš„å‘å±•å²"><a href="#Kubernetesçš„å‘å±•å²" class="headerlink" title="Kubernetesçš„å‘å±•å²"></a>Kubernetesçš„å‘å±•å²</h1><p>Kubernetesè‡ªæ¨å‡ºä¹‹åå°±è¿…é€Ÿè·å¾—æé«˜çš„å…³æ³¨ä¸å‚ä¸ï¼Œ2015å¹´7æœˆç»è¿‡400å¤šä½è´¡çŒ®è€…ä¸€å¹´çš„åŠªåŠ›ï¼Œå¤šè¾¾14000æ¬¡ä»£ç çš„æäº¤ï¼ŒGoogleæ­£å¼å¯¹å¤–å‘å¸ƒäº†Kubernetes v1.0ï¼Œæ„å‘³ç€è¿™ä¸ªå¼€æºå®¹å™¨ç¼–æ’ç³»ç»Ÿå¯ä»¥æ­£å¼åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ã€‚</p>
<ul>
<li><p>2014å¹´6æœˆï¼šè°·æ­Œå®£å¸ƒKuberneteså¼€æº</p>
</li>
<li><p>2014å¹´7æœˆï¼šMicroSoftã€RedHatã€IBMã€Dockerã€CoreOSã€Mesosphereã€SaltstackåŠ å…¥åˆ°Kubernetesç¤¾åŒº</p>
</li>
<li><p>2014å¹´8æœˆï¼šMesosphereå®£å¸ƒå°†Kubernetesä½œä¸ºæ¡†æ¶æ•´åˆåˆ°Mesosphereç”Ÿæ€ç³»ç»Ÿä¸­ï¼Œç”¨äºDockerå®¹å™¨é›†ç¾¤çš„è°ƒåº¦ã€éƒ¨ç½²å’Œç®¡ç†</p>
</li>
<li><p>2014å¹´8æœˆï¼šVMwareåŠ å…¥Kubernetesç¤¾åŒº</p>
</li>
<li><p>2014å¹´11æœˆï¼šHPåŠ å…¥Kubernetesç¤¾åŒº</p>
</li>
<li><p>2014å¹´11æœˆï¼šGoogleå®¹å™¨å¼•æ“Alphaå¯åŠ¨</p>
</li>
<li><p>2015å¹´1æœˆï¼šKubernetesè¢«å¼•å…¥åˆ°Openstack</p>
</li>
<li><p>2015å¹´4æœˆï¼šGoogleå’ŒCoreOSè”åˆå‘å¸ƒTectonicï¼Œå®ƒå°†Kuberneteså’ŒCoreOSè½¯ä»¶æ ˆæ•´åˆåˆ°äº†ä¸€èµ·</p>
</li>
<li><p>2015å¹´5æœˆï¼šIntelåŠ å…¥åˆ°Kubernetesç¤¾åŒº</p>
</li>
<li><p>2015å¹´6æœˆï¼šGoogleå®¹å™¨è¿›å…¥åˆ°betaç‰ˆ</p>
</li>
<li><p>2015å¹´7æœˆï¼šKubernetes v1.0ç‰ˆæœ¬æ­£å¼å‘å¸ƒ</p>
</li>
</ul>
<h1 id="Kubernetesçš„æ ¸å¿ƒæ¦‚å¿µ"><a href="#Kubernetesçš„æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="Kubernetesçš„æ ¸å¿ƒæ¦‚å¿µ"></a>Kubernetesçš„æ ¸å¿ƒæ¦‚å¿µ</h1><h2 id="Pod"><a href="#Pod" class="headerlink" title="Pod"></a>Pod</h2><p>Podæ˜¯è‹¥å¹²ç›¸å…³å®¹å™¨çš„ç»„åˆï¼ŒPodåŒ…å«çš„å®¹å™¨è¿è¡Œåœ¨åŒä¸€å°å®¿ä¸»æœºä¸Šï¼Œè¿™äº›å®¹å™¨ä½¿ç”¨ç›¸åŒçš„ç½‘ç»œå‘½åç©ºé—´ã€IPåœ°å€å’Œç«¯å£ï¼Œç›¸äº’ä¹‹é—´èƒ½é€šè¿‡localhostæ¥å‘ç°å’Œé€šä¿¡ã€‚è¿™äº›å®¹å™¨è¿˜å¯ä»¥å…±äº«ä¸€å—å­˜å‚¨å·ç©ºé—´ã€‚åœ¨Kubernetesä¸­åˆ›å»ºã€è°ƒåº¦å’Œç®¡ç†çš„æœ€å°å•å…ƒå°±æ˜¯Podï¼Œè€Œä¸æ˜¯å®¹å™¨ï¼ŒPodé€šè¿‡æ›´é«˜å±‚æ¬¡çš„æŠ½è±¡ï¼Œæä¾›äº†æ›´åŠ çµæ´»çš„éƒ¨ç½²å’Œç®¡ç†æ¨¡å¼ã€‚</p>
<h2 id="Replication-Controller"><a href="#Replication-Controller" class="headerlink" title="Replication Controller"></a>Replication Controller</h2><p>Replication Controllerç”¨æ¥æ§åˆ¶ç®¡ç†Podå‰¯æœ¬ï¼Œå®ƒç¡®ä¿ä»»ä½•æ—¶å€™Kubernetesé›†ç¾¤ä¸­æœ‰æŒ‡å®šæ•°é‡çš„Podå‰¯æœ¬åœ¨è¿è¡Œã€‚å¦‚æœå°‘äºæŒ‡å®šæ•°é‡çš„Podå‰¯æœ¬ï¼Œå®ƒä¼šå¯åŠ¨æ–°çš„Podå‰¯æœ¬ï¼Œåä¹‹å®ƒä¼šæ€æ­»å¤šä½™çš„å‰¯æœ¬ä»¥ä¿è¯æ•°é‡ä¸å˜ã€‚è€Œä¸”ï¼ŒReplication Controlleræ˜¯å¼¹æ€§ä¼¸ç¼©ã€æ»šåŠ¨å‡çº§çš„å®ç°æ ¸å¿ƒ</p>
<h2 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h2><p>Serviceæ˜¯çœŸå®åº”ç”¨æœåŠ¡çš„æŠ½è±¡ï¼Œå®šä¹‰äº†Podçš„é€»è¾‘é›†åˆå’Œè®¿é—®è¿™ä¸ªPodé›†åˆçš„ç­–ç•¥ã€‚Serviceå°†ä»£ç†Podå¯¹å¤–è¡¨ç°ä¸ºä¸€ä¸ªå•ä¸€çš„è®¿é—®æ¥å£ï¼Œå¤–éƒ¨ä¸éœ€è¦äº†è§£åç«¯Podæ˜¯å¦‚ä½•è¿è¡Œçš„ï¼Œè¿™ç»™æ‰©å±•å’Œç»´æŠ¤å¸¦æ¥å¾ˆå¤šå¥½å¤„ï¼Œæä¾›äº†ä¸€å¥—ç®€åŒ–çš„æœåŠ¡ä»£ç†å’Œå‘ç°æœºåˆ¶</p>
<h2 id="Label"><a href="#Label" class="headerlink" title="Label"></a>Label</h2><p>Labelæ˜¯ç”¨äºåŒºåˆ†Podã€Serviceã€Replication Controllerå’ŒKey/Valueå¯¹ï¼Œå®é™…ä¸Šï¼ŒKubernetesä¸­çš„ä»»æ„APIå¯¹è±¡éƒ½å¯ä»¥é€šè¿‡Labelè¿›è¡Œæ ‡è¯†ã€‚æ¯ä¸ªAPIå¯¹è±¡å¯ä»¥æœ‰å¤šä¸ªLabelï¼Œä½†æ˜¯æ¯ä¸ªLabelçš„Keyåªèƒ½å¯¹åº”ä¸€ä¸ªValueã€‚Labelæ˜¯Serviceå’ŒReplication Controllerè¿è¡Œçš„åŸºç¡€ï¼Œä»–ä»¬éƒ½é€šè¿‡Labelæ¥å…³è”Podï¼Œç›¸æ¯”äºå¼ºç»‘å®šæ¨¡å‹ï¼Œè¿™æ˜¯ä¸€ç§éå¸¸å¥½çš„æ¾è€¦åˆå…³ç³»ã€‚</p>
<h2 id="Node"><a href="#Node" class="headerlink" title="Node"></a>Node</h2><p>Kuberneteså±äºä¸»ä»åˆ†å¸ƒå¼é›†ç¾¤æ¶æ„ï¼ŒKubernetes Nodeè¿è¡Œå¹¶ç®¡ç†å®¹å™¨ã€‚Nodeä½œä¸ºKubernetesçš„æ“ä½œå•å…ƒï¼Œç”¨æ¥åˆ†é…ç»™Podè¿›è¡Œç»‘å®šï¼ŒPodæœ€ç»ˆè¿è¡Œåœ¨Nodeä¸Šï¼ŒNodeå¯ä»¥è®¤ä¸ºæ˜¯Podçš„å®¿ä¸»æœº</p>
<hr>
<p><strong>åœ¨æ¥ä¸‹æ¥çš„ç« èŠ‚ä¸­ï¼Œæˆ‘å°†ä»¥ã€ŠKubernetesçš„å®˜æ–¹æ–‡æ¡£ã€‹ä»¥åŠã€ŠKuberneteså®æˆ˜ã€‹ä¸ºä¾æ®ï¼Œè·Ÿå¤§å®¶åˆ†äº«Kubernetesçš„æ¶æ„ã€éƒ¨ç½²å’Œåº”ç”¨</strong></p>
<p><a href="http://kubernetes.io" target="_blank" rel="noopener">Kuberneteså®˜æ–¹ç½‘ç«™ï¼šhttp://kubernetes.io</a></p>
]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>Kubernetes</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonè£…é¥°å™¨è¯¦è§£</title>
    <url>/2016/05/31/Python%E8%A3%85%E9%A5%B0%E5%99%A8%E8%AF%A6%E8%A7%A3/</url>
    <content><![CDATA[<blockquote>
<p>æœ¬ç¯‡æ–‡ç« è®¨è®ºPythonçš„è£…é¥°å™¨ï¼ŒPythonè£…é¥°å™¨å¸®åŠ©æˆ‘ä»¬åœ¨ä¸æ”¹å˜å‡½æ•°å†…éƒ¨ç»“æ„çš„æƒ…å†µä¸‹ï¼Œå¯¹å‡½æ•°åŠŸèƒ½è¿›è¡Œæ‰©å±•ï¼Œæ¥ä¸‹æ¥è¿›å…¥æ­£é¢˜ï¼Œåœ¨è®¨è®ºè£…é¥°å™¨ä¹‹å‰ï¼Œå…ˆæ‹¿å‡½æ•°å®šä¹‰çš„åŸç†æŠ›ç –å¼•ç‰</p>
<p>Python version: 3.5+</p>
</blockquote>
<h1 id="å‡½æ•°å®šä¹‰çš„åŸç†"><a href="#å‡½æ•°å®šä¹‰çš„åŸç†" class="headerlink" title="å‡½æ•°å®šä¹‰çš„åŸç†"></a>å‡½æ•°å®šä¹‰çš„åŸç†</h1><p>åœ¨Pythonä¸­é€šè¿‡<code>def fun_name(): pass</code>æ¥å®šä¹‰ä¸€ä¸ªå‡½æ•°ã€‚é‚£ä¹ˆåœ¨è¿™ä¸ªå°å‡½æ•°ä¸­ï¼Œ<code>fun_name</code>æ˜¯å‡½æ•°çš„åå­—ï¼Œ<code>pass</code>æ˜¯å‡½æ•°ä½“ã€‚æˆ‘ä»¬é€šå¸¸ä¼šè¯´ï¼ŒPythonåœ¨è§£é‡Šä»£ç æ—¶ï¼Œä¼šæŠŠ<code>pass</code>å‡½æ•°ä½“æ”¾åœ¨å†…å­˜ä¸­ï¼Œå¹¶åœ¨å†…å­˜ä¸­ç”¨<code>fun_name</code>å»æŒ‡å‘<code>pass</code>å‡½æ•°ä½“ã€‚</p>
<p>è¯æ˜¯è¿™ä¹ˆè¯´æ²¡é”™ï¼Œä½†å¯¹äºåˆå­¦è€…æ¥è¯´ï¼ŒåŒæ ·éƒ½æ˜¯æ”¾åœ¨å†…å­˜ä¸­ï¼Œä¸ºå•¥è¿˜è¦æŒ‡æ¥æŒ‡å»çš„å‘¢ï¼Ÿå…·ä½“æ¥è¯´ï¼Œå‡½æ•°ååœ¨å†…å­˜å­˜æ”¾çš„åœ°åŒºæ˜¯<code>æ ˆåŒº</code>ï¼Œå‡½æ•°ä½“åœ¨å†…å­˜ä¸­å­˜æ”¾çš„åœ°åŒºæ˜¯<code>å †åŒº</code>ï¼Œå­˜åœ¨æ ˆåŒºçš„å‡½æ•°åä¼šæŒ‡å‘å­˜åœ¨å †åŒºçš„å‡½æ•°ä½“ã€‚åœ¨å‰é¢çš„Pythonå­¦ä¹ ç¬”è®°ä¸­ï¼Œæåˆ°çš„ä¸¤å¤§æ•°æ®ç±»å‹çš„åˆ†ç±»ï¼Œä¸€ä¸ªæ˜¯<code>åŸºæœ¬æ•°æ®ç±»å‹</code>ï¼Œä¸€ä¸ªæ˜¯<code>å¼•ç”¨æ•°æ®ç±»å‹</code>ï¼Œæ‰€æœ‰çš„<code>å¼•ç”¨æ•°æ®ç±»å‹</code>çš„åå­—éƒ½æ˜¯å‹åœ¨äº†<code>æ ˆåŒº</code>ï¼Œå…¶å¯¹åº”çš„å¯¹è±¡,éƒ½æ˜¯å­˜åœ¨äº†<code>å †åŒº</code>ã€‚æ‰€ä»¥å…³äºæŒ‡å‘çš„é—®é¢˜ï¼Œå¹¶ä¸åœ¨å†…å­˜ä¸­èƒ¡ä¹±å»æŒ‡çš„~~</p>
<p><img src="http://oss.20150509.cn/QQ20160530-0@2x.png" alt=""></p>
<h1 id="è£…é¥°å™¨"><a href="#è£…é¥°å™¨" class="headerlink" title="è£…é¥°å™¨"></a>è£…é¥°å™¨</h1><h2 id="è£…é¥°å™¨å‰ä¼ "><a href="#è£…é¥°å™¨å‰ä¼ " class="headerlink" title="è£…é¥°å™¨å‰ä¼ "></a>è£…é¥°å™¨å‰ä¼ </h2><p>ç°æœ‰å¦‚ä¸‹ç¨‹åºçŒ¿ä»£ç ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f1</span><span class="params">()</span>:</span></span><br><span class="line">  print(<span class="string">'f1 func'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f2</span><span class="params">()</span>:</span></span><br><span class="line">  print(<span class="string">'f2 func'</span>)</span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f3</span><span class="params">()</span>:</span></span><br><span class="line">  print(<span class="string">'f3 func'</span>)</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨è€æ¿éœ€æ±‚æ˜¯ï¼šåœ¨æ‰“å°è¾“å‡ºå‰ï¼Œå…ˆè¾“å‡º<code>loading...</code></p>
<p>äºæ˜¯ç¨‹åºçŒ¿åšå‡ºå¦‚ä¸‹ä¿®æ”¹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f1</span><span class="params">()</span>:</span></span><br><span class="line">  print(<span class="string">'loading...'</span>)</span><br><span class="line">  print(<span class="string">'f1 func'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f2</span><span class="params">()</span>:</span></span><br><span class="line">  print(<span class="string">'loading...'</span>)</span><br><span class="line">  print(<span class="string">'f2 func'</span>)</span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f3</span><span class="params">()</span>:</span></span><br><span class="line">  print(<span class="string">'loading...'</span>)</span><br><span class="line">  print(<span class="string">'f3 func'</span>)</span><br></pre></td></tr></table></figure>

<p>è€æ¿è§‰å¾—ï¼Œæ‰“å°è¾“å…¥åè¾“å‡º<code>Done</code>æ›´å¥½</p>
<p>äºæ˜¯ç¨‹åºçŒ¿åˆå»ä¿®æ”¹ä»£ç äº†~~</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f1</span><span class="params">()</span>:</span></span><br><span class="line">  print(<span class="string">'loading...'</span>)</span><br><span class="line">  print(<span class="string">'f1 func'</span>)</span><br><span class="line">  print(<span class="string">'Done'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f2</span><span class="params">()</span>:</span></span><br><span class="line">  print(<span class="string">'loading...'</span>)</span><br><span class="line">  print(<span class="string">'f2 func'</span>)</span><br><span class="line">  print(<span class="string">'Done'</span>)</span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f3</span><span class="params">()</span>:</span></span><br><span class="line">  print(<span class="string">'loading...'</span>)</span><br><span class="line">  print(<span class="string">'f3 func'</span>)</span><br><span class="line">  print(<span class="string">'Done'</span>)</span><br></pre></td></tr></table></figure>

<p>ä¹‹åè€æ¿åˆè§‰å¾—â€¦â€¦</p>
<hr>
<p><strong>æœ‰äº†è£…é¥°å™¨å</strong></p>
<p>è¿˜æ˜¯ä¸Šé¢çš„ä»£ç ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f1</span><span class="params">()</span>:</span></span><br><span class="line">  print(<span class="string">'f1 func'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f2</span><span class="params">()</span>:</span></span><br><span class="line">  print(<span class="string">'f2 func'</span>)</span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f3</span><span class="params">()</span>:</span></span><br><span class="line">  print(<span class="string">'f3 func'</span>)</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½¿ç”¨äº†è£…é¥°å™¨å®ç°loadingçš„éœ€æ±‚ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">outer</span><span class="params">(func)</span>:</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">inner</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'loading...'</span>)</span><br><span class="line">    func()</span><br><span class="line">  <span class="keyword">return</span> inner</span><br><span class="line"></span><br><span class="line"><span class="meta">@outer</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f1</span><span class="params">()</span>:</span></span><br><span class="line">  print(<span class="string">'f1 func'</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@outer</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f2</span><span class="params">()</span>:</span></span><br><span class="line">  print(<span class="string">'f2 func'</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@outer  </span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f3</span><span class="params">()</span>:</span></span><br><span class="line">  print(<span class="string">'f3 func'</span>)</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨è£…é¥°å™¨å®ç°Doneçš„éœ€æ±‚ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">outer</span><span class="params">(func)</span>:</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">inner</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'loading...'</span>)</span><br><span class="line">    func()</span><br><span class="line">    print(<span class="string">'Done'</span>)</span><br><span class="line">  <span class="keyword">return</span> inner</span><br><span class="line"></span><br><span class="line"><span class="meta">@outer</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f1</span><span class="params">()</span>:</span></span><br><span class="line">  print(<span class="string">'f1 func'</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@outer</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f2</span><span class="params">()</span>:</span></span><br><span class="line">  print(<span class="string">'f2 func'</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@outer  </span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f3</span><span class="params">()</span>:</span></span><br><span class="line">  print(<span class="string">'f3 func'</span>)</span><br></pre></td></tr></table></figure>

<p>ä»ä¸Šé¢ç®€å•çš„ä¾‹å­å¯ä»¥çœ‹å‡ºï¼Œä½¿ç”¨<code>è£…é¥°å™¨</code>å¯ä»¥åœ¨ä¸æ”¹å˜åŸå‡½æ•°çš„æƒ…å†µä¸‹ï¼Œå¯¹åŸå‡½æ•°çš„åŠŸèƒ½è¿›è¡Œæ‰©å±•ï¼</p>
<h2 id="è£…é¥°å™¨é¢„çƒ­"><a href="#è£…é¥°å™¨é¢„çƒ­" class="headerlink" title="è£…é¥°å™¨é¢„çƒ­"></a>è£…é¥°å™¨é¢„çƒ­</h2><p>åœ¨è¯¦è§£è£…é¥°å™¨å‰ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å¼ºè°ƒä¸€ä¸ªå¾ˆé‡è¦çš„æ¦‚å¿µï¼Œå°±æ˜¯å‡½æ•°çš„è°ƒç”¨ï¼</p>
<p>å‡½æ•°æ€ä¹ˆè°ƒç”¨ï¼Ÿå‡½æ•°ååé¢è·Ÿäº†å°æ‹¬å·å°±æ˜¯è°ƒç”¨ï¼Œä¸åŠ æ‹¬å·å°±ä¸è°ƒç”¨ï¼</p>
<p>é‡è¦çš„äº‹æƒ…è¯´ä¸‰éï¼ï¼ï¼</p>
<ol>
<li>å‡½æ•°ååé¢è·Ÿäº†å°æ‹¬å·å°±æ˜¯è°ƒç”¨ï¼Œä¸åŠ æ‹¬å·å°±ä¸è°ƒç”¨ï¼</li>
<li>å‡½æ•°ååé¢è·Ÿäº†å°æ‹¬å·å°±æ˜¯è°ƒç”¨ï¼Œä¸åŠ æ‹¬å·å°±ä¸è°ƒç”¨ï¼</li>
<li>å‡½æ•°ååé¢è·Ÿäº†å°æ‹¬å·å°±æ˜¯è°ƒç”¨ï¼Œä¸åŠ æ‹¬å·å°±ä¸è°ƒç”¨ï¼</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">()</span>:</span></span><br><span class="line">  print(<span class="string">'æˆ‘è¢«è°ƒç”¨äº†'</span>)</span><br><span class="line"></span><br><span class="line">func()</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">æˆ‘è¢«è°ƒç”¨äº†</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">()</span>:</span></span><br><span class="line">  print(<span class="string">'æˆ‘è¢«è°ƒç”¨äº†'</span>)</span><br><span class="line"></span><br><span class="line">func</span><br><span class="line"></span><br><span class="line">------------</span><br></pre></td></tr></table></figure>
<p>ä¸‹é¢çš„å°ç¨‹åºåªå†™äº†å‡½æ•°åï¼Œåæ²¡æœ‰è·Ÿæ‹¬å·ï¼Œè¯¥å‡½æ•°è¢«åŠ è½½åˆ°å†…å­˜ï¼Œä½†æ˜¯æ²¡æœ‰è¢«è°ƒç”¨ï¼åœ¨å­¦ä¹ è£…é¥°å™¨ä¹‹å‰ï¼Œä¸€å®šè¦æ¸…æ¥šä»€ä¹ˆæ—¶å€™åŠ æ‹¬å·ä»€ä¹ˆæ—¶å€™ä¸åŠ æ‹¬å·</p>
<h2 id="è£…é¥°å™¨è§£æ"><a href="#è£…é¥°å™¨è§£æ" class="headerlink" title="è£…é¥°å™¨è§£æ"></a>è£…é¥°å™¨è§£æ</h2><h3 id="è£…é¥°å™¨çš„åˆ›å»º"><a href="#è£…é¥°å™¨çš„åˆ›å»º" class="headerlink" title="è£…é¥°å™¨çš„åˆ›å»º"></a>è£…é¥°å™¨çš„åˆ›å»º</h3><p>åˆ›å»ºè£…é¥°å™¨ï¼Œæœ€å°‘éœ€è¦åµŒå¥—ä¸€å±‚å‡½æ•°ï¼Œä¸”åœ¨å†…å±‚å‡½æ•°åŠ è½½åˆ°å†…å­˜ä¹‹åè¿”å›å†…å­˜å‡½æ•°</p>
<p><img src="http://oss.20150509.cn/QQ20160530-1@2x.png" alt=""></p>
<h3 id="è£…é¥°å™¨çš„ä½¿ç”¨"><a href="#è£…é¥°å™¨çš„ä½¿ç”¨" class="headerlink" title="è£…é¥°å™¨çš„ä½¿ç”¨"></a>è£…é¥°å™¨çš„ä½¿ç”¨</h3><p>ä½¿ç”¨è£…é¥°å™¨çš„æ–¹æ³•å¾ˆç®€å•ï¼Œåªéœ€è¦åœ¨è¢«è£…é¥°çš„å‡½æ•°ä¸Šé¢ç”¨<code>@</code>ç¬¦å·å¼•ç”¨è£…é¥°å™¨åå³å¯</p>
<p><img src="http://oss.20150509.cn/QQ20160530-2@2x.png" alt=""></p>
<h3 id="è£…é¥°å™¨çš„åŠŸèƒ½"><a href="#è£…é¥°å™¨çš„åŠŸèƒ½" class="headerlink" title="è£…é¥°å™¨çš„åŠŸèƒ½"></a>è£…é¥°å™¨çš„åŠŸèƒ½</h3><p>è£…é¥°å™¨æœ‰ä¸¤å¤§åŠŸèƒ½ï¼š</p>
<ul>
<li>è‡ªåŠ¨æ‰§è¡Œè£…é¥°å™¨å‡½æ•°,ä¸”å°†ä¸‹é¢çš„å‡½æ•°åå½“åšå‚æ•°ä¼ é€’ç»™è£…é¥°å™¨å‡½æ•°</li>
<li>å°†è£…é¥°å™¨å‡½æ•°çš„è¿”å›å€¼,é‡æ–°èµ‹å€¼ç»™å‡½æ•°</li>
</ul>
<p>ç¬¬ä¸€å¤§åŠŸèƒ½ï¼Œå½“Pythonåœ¨é‡åˆ°<code>@è£…é¥°å™¨å</code>æ—¶ï¼Œä¼šå»æ‰§è¡Œè¯¥è£…é¥°å™¨ï¼›æˆ‘ä»¬æ¥è¯´è¯´ç¬¬äºŒå¤§åŠŸèƒ½ï¼Œè£…é¥°å™¨å‡½æ•°çš„è¿”å›å€¼ä¼šé‡æ–°èµ‹å€¼ç»™å‡½æ•°ï¼</p>
<p><img src="http://oss.20150509.cn/QQ20160530-3@2x.png" alt=""></p>
<p>æ‰€æœ‰è£…é¥°å™¨å‡½æ•°çš„è¿”å›å€¼éƒ½æ˜¯å…¶å†…å±‚å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå†…å±‚å‡½æ•°ä¼šé‡æ–°èµ‹å€¼ç»™åŸå‡½æ•°ã€‚è¯´åˆ°è¿™é‡Œæ—¶ï¼Œå°±éœ€è¦å¼•å…¥å¼€ç¯‡æåˆ°çš„<code>å‡½æ•°å®šä¹‰åŸç†</code>,ä¸‹é¢æˆ‘ä»¬å‡è®¾ç¨‹åºè°ƒç”¨äº†<code>f1()</code>.æˆ‘ä»¬æ¥çœ‹çœ‹åœ¨Pythonçš„å†…éƒ¨éƒ½å‘ç”Ÿäº†ä»€ä¹ˆã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">outer</span><span class="params">(func)</span>:</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">inner</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'loading...'</span>)</span><br><span class="line">    func()</span><br><span class="line">    print(<span class="string">'Done'</span>)</span><br><span class="line">  <span class="keyword">return</span> inner</span><br><span class="line"></span><br><span class="line"><span class="meta">@outer</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f1</span><span class="params">()</span>:</span></span><br><span class="line">  print(<span class="string">'f1 func'</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@outer</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f2</span><span class="params">()</span>:</span></span><br><span class="line">  print(<span class="string">'f2 func'</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@outer  </span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f3</span><span class="params">()</span>:</span></span><br><span class="line">  print(<span class="string">'f3 func'</span>)</span><br><span class="line">  </span><br><span class="line">f1()</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">loading...</span><br><span class="line">f1 func</span><br><span class="line">Done</span><br></pre></td></tr></table></figure>

<ol>
<li>åœ¨è¯¥ç¨‹åºä¸­ï¼Œf1çš„å‡½æ•°è¢«outerè£…é¥°å™¨æ‰€è£…é¥°</li>
<li>Pythonåœ¨ä»ä¸Šè‡³ä¸‹è§£é‡Šä»£ç æ—¶ï¼Œå…ˆå°†outerè£…é¥°å™¨åŠ è½½åˆ°å†…å­˜ä¸­</li>
<li>å½“æ‰§è¡Œåˆ°@outeræ—¶ï¼Œè§¦å‘äº†Pythonè£…é¥°å™¨çš„ç¬¬ä¸€å¤§åŠŸèƒ½ï¼Œä»–å°†å¸®åŠ©æˆ‘ä»¬å»æ‰§è¡Œè£…é¥°å™¨å‡½æ•°ï¼Œä¸Šä¸€æ¡ï¼Œouterè£…é¥°å™¨å·²ç»åŠ è½½åˆ°å†…å­˜ï¼Œè¿˜æ²¡æœ‰è¢«è°ƒç”¨æ‰§è¡Œã€‚é‡åˆ°@outeråï¼Œä¼šè§¦å‘<code>outer()</code>æ“ä½œï¼Œå½“outerå‡½æ•°è¢«æ‰§è¡Œåï¼Œå…¶å†…å±‚å‡½æ•°å°†è¢«åŠ è½½åˆ°å†…å­˜ä¸­ç­‰å¾…è°ƒç”¨ï¼Œouterçš„æœ€åï¼Œè¿”å›äº†å†…å±‚innerå‡½æ•°</li>
<li>è£…é¥°å™¨å¤–å±‚å‡½æ•°çš„è°ƒç”¨è¿”å›å†…å±‚å‡½æ•°åï¼Œè§¦å‘äº†Pythonè£…é¥°å™¨çš„ç¬¬äºŒå¤§åŠŸèƒ½ï¼Œä»–å°†è‡ªåŠ¨å¸®æˆ‘ä»¬æŠŠè¿”å›çš„å†…å­˜çš„å‡½æ•°é‡æ–°èµ‹å€¼ç»™è¢«è£…é¥°çš„å‡½æ•°f1</li>
<li>æœ€åï¼Œå½“f1è¢«è°ƒç”¨æ—¶ï¼Œå®é™…æŒ‡å‘çš„æ˜¯innerå‡½æ•°çš„å‡½æ•°ä½“ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“f1å‡½æ•°è¢«è£…é¥°å™¨æ‰€è£…é¥°åï¼Œè°ƒç”¨æ—¶æ‰€è¿è¡Œçš„å‡½æ•°ä½“ï¼Œå®é™…ä¸Šæ˜¯è£…é¥°å™¨å‡½æ•°ä¸­çš„å†…å±‚å‡½æ•°ã€‚</li>
</ol>
<p>å¦‚æœä¸Šé¢çš„æ–‡å­—æè¿°ä½ è¿˜æ²¡æœ‰çœ‹æ‡‚çš„è¯ï¼Œæ²¡å…³ç³»ï¼Œä¸‹é¢è¿˜æœ‰å›¾æ–‡å¹¶èŒ‚çš„<del>~</del></p>
<ul>
<li>Pythonè§£é‡Šå™¨ä»ä¸Šè‡³ä¸‹è§£é‡Šï¼Œå…ˆå°†<code>outer</code>è¿™ä¸ªå‡½æ•°åå­—æ”¾å…¥æ ˆåŒºï¼Œouterçš„æ•´ä¸ªå‡½æ•°ä½“å°†è¢«å®Œæ•´çš„åŠ è½½åˆ°å†…å­˜çš„å †åŒºä¸­ï¼Œå†…å­˜çŠ¶æ€å¦‚ä¸‹ï¼š</li>
</ul>
<p><img src="http://oss.20150509.cn/QQ20160530-4@2x.png" alt=""></p>
<ul>
<li>æ¥ä¸‹æ¥ï¼ŒPythonè§£é‡Šå™¨é‡åˆ°<code>@outer</code>æ—¶ï¼ŒPythonå†…éƒ¨æ§åˆ¶å°†å»è‡ªåŠ¨å°†ä¸‹ä¸€è¡Œå‡½æ•°çš„åå­—ï¼ˆf1ï¼‰ä½œä¸ºå‚æ•°ä¼ å…¥åˆ°<code>outer</code>è£…é¥°å™¨å‡½æ•°ä¸­ï¼Œå¹¶è‡ªåŠ¨æ‰§è¡Œ<code>outer</code>å‡½æ•°ï¼Œæ­¤æ—¶outerå‡½æ•°çš„å½¢å¼å‚æ•°<code>func</code>åœ¨æ ˆåŒºæŒ‡å‘äº†å †åŒºçš„<code>f1</code>å‡½æ•°ä½“ï¼Œå†…å­˜çŠ¶æ€å¦‚ä¸‹ï¼š</li>
</ul>
<p><img src="http://oss.20150509.cn/QQ20160530-5@2x.png" alt=""></p>
<ul>
<li>outerå‡½æ•°æ‰§è¡Œå®Œåï¼Œä¼šå°†å†…å±‚å‡½æ•°çš„è¿”å›å€¼é‡æ–°å¤åˆ¶ç»™åŸå‡½æ•°ï¼ˆf1ï¼‰æƒ³å½“äºæ‰§è¡Œäº†<code>f1 = outer(f1)</code></li>
</ul>
<p><img src="http://oss.20150509.cn/QQ20160530-6@2x.png" alt=""></p>
<ul>
<li>æœ€åï¼Œå½“f1è¢«è¢«è°ƒç”¨æ—¶ï¼Œå¯ä»¥é€šè¿‡ä¸Šå›¾çœ‹å‡ºï¼Œå®é™…è°ƒç”¨çš„æ˜¯è£…é¥°çš„å†…å±‚å‡½æ•°ï¼Œè€Œè£…é¥°å™¨ä¸­çš„å†…å­˜å‡½æ•°ä½“é‡Œåˆå¼•ç”¨äº†åŸf1çš„å‡½æ•°ä½“ï¼ˆå·²ç»å°†f1å‡½æ•°ä½“å †åŒºåœ°å€å¼•ç”¨ç»™äº†æ ˆåŒºçš„funcï¼‰</li>
</ul>
<p>æ€»ç»“ï¼šé€šè¿‡ä¸Šé¢å‰–æçš„å°ä¾‹å­å¯ä»¥çœ‹å‡ºï¼Œè™½ç„¶<code>print(&#39;f1 func&#39;)</code>æ˜¯f1çš„å‡½æ•°ä½“ï¼Œä½†æ˜¯f1åªæœ‰ä¸€ç¬é—´æ‹¥æœ‰è¯¥å‡½æ•°ä½“ã€‚åœ¨é‡åˆ°<code>@outer</code>ä¹‹åï¼Œf1å°±è¢«å½“åšå‚æ•°ä¼ é€’ç»™äº†outerè£…é¥°å™¨ï¼Œfuncä¸f1åŒæ—¶æŒ‡å‘æ”¾åœ¨å †åŒºçš„å‡½æ•°ä½“ã€‚åœ¨outerå‡½æ•°æ‰§è¡Œåï¼Œå†…å±‚å‡½æ•°è¢«é‡æ–°èµ‹å€¼ç»™äº†f1ï¼Œæ­¤æ—¶f1å¤±å»äº†å¯¹åŸå‡½æ•°ä½“çš„æ§åˆ¶è€ŒæŒ‡å‘äº†innerçš„å †åŒºåœ°å€ï¼Œfuncç‹¬è‡ªæ§åˆ¶äº†<code>print(&#39;f1 func&#39;)</code>è¯¥å‡½æ•°ä½“ã€‚</p>
<hr>
<h2 id="åŸå‡½æ•°æœ‰è¿”å›å€¼çš„è£…é¥°å™¨"><a href="#åŸå‡½æ•°æœ‰è¿”å›å€¼çš„è£…é¥°å™¨" class="headerlink" title="åŸå‡½æ•°æœ‰è¿”å›å€¼çš„è£…é¥°å™¨"></a>åŸå‡½æ•°æœ‰è¿”å›å€¼çš„è£…é¥°å™¨</h2><p>ç°åœ¨æˆ‘çš„åŸºç¡€å‡½æ•°æœ‰è¿”å›å€¼çš„éœ€æ±‚ï¼Œæ”¹æˆäº†å¦‚ä¸‹ä»£ç ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f1</span><span class="params">()</span>:</span></span><br><span class="line">  print(<span class="string">'f1 func'</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f2</span><span class="params">()</span>:</span></span><br><span class="line">  print(<span class="string">'f2 func'</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f3</span><span class="params">()</span>:</span></span><br><span class="line">  print(<span class="string">'f3 func'</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœæ˜¯è¿™æ ·çš„å‡½æ•°è¢«è£…é¥°ï¼Œå‡½æ•°ä½“ä¸­ä¸ä»…æœ‰è®¡ç®—å’Œè¾“å‡ºï¼Œè€Œä¸”æœ‰è¿”å›å€¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦åœ¨è£…é¥°å™¨ä¸­ï¼Œæ¥æ”¶åŸå‡½æ•°çš„è¿”å›å€¼ï¼Œå¹¶è¿›è¡Œè¿”å›ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">outer</span><span class="params">(func)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inner</span><span class="params">()</span>:</span></span><br><span class="line">        print(<span class="string">'loading...'</span>)</span><br><span class="line">        ret = func()   <span class="comment"># å› ä¸ºåŸå‡½æ•°æœ‰è¿”å›å€¼ï¼Œåœ¨è¿™é‡Œè°ƒç”¨æ—¶å»æ¥æ”¶åŸå‡½æ•°çš„è¿”å›å€¼</span></span><br><span class="line">        print(<span class="string">'Done'</span>)</span><br><span class="line">        <span class="keyword">return</span> ret    <span class="comment"># åœ¨æ–°å‡½æ•°çš„ç»“å°¾ï¼Œè¿”å›åŸå‡½æ•°çš„è¿”å›å€¼</span></span><br><span class="line">    <span class="keyword">return</span> inner</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@outer</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f1</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'f1 func'</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@outer</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f2</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'f2 func'</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@outer</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f3</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'f3 func'</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">f1()</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">loading...</span><br><span class="line">f1 func</span><br><span class="line">Done</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="å¸¦å‚æ•°çš„å‡½æ•°è¢«è£…é¥°-å‚æ•°ä¸ªæ•°ç¡®å®š"><a href="#å¸¦å‚æ•°çš„å‡½æ•°è¢«è£…é¥°-å‚æ•°ä¸ªæ•°ç¡®å®š" class="headerlink" title="å¸¦å‚æ•°çš„å‡½æ•°è¢«è£…é¥°(å‚æ•°ä¸ªæ•°ç¡®å®š)"></a>å¸¦å‚æ•°çš„å‡½æ•°è¢«è£…é¥°(å‚æ•°ä¸ªæ•°ç¡®å®š)</h2><p>ç°åœ¨æˆ‘çš„ä»£ç å˜æˆäº†å¸¦å‚æ•°çš„å‡½æ•°ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f1</span><span class="params">(arg1)</span>:</span></span><br><span class="line">  print(<span class="string">'f1 func'</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f2</span><span class="params">(arg1)</span>:</span></span><br><span class="line">  print(<span class="string">'f2 func'</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f3</span><span class="params">(arg1)</span>:</span></span><br><span class="line">  print(<span class="string">'f3 func'</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure>

<p>ç›¸åº”çš„ï¼Œæˆ‘çš„è£…é¥°å™¨ä¹Ÿåº”è¯¥åšå‡ºæ”¹å˜ã€‚æƒ³æƒ³ä¸Šé¢è£…é¥°å™¨çš„åŸç†â€”&gt;<code>è£…é¥°å™¨çš„å†…å±‚å‡½æ•°è¢«è¿”å›å¹¶é‡æ–°èµ‹å€¼ç»™åŸå‡½æ•°</code> ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœåŸå‡½æ•°æœ‰å‚æ•°çš„è¯ï¼Œç›¸å¯¹åº”çš„ï¼Œè£…é¥°å™¨ä¸­çš„å†…å±‚å‡½æ•°ä¹Ÿåº”è¯¥æœ‰å‚æ•°ï¼Œæ•…åšå‡ºå¦‚ä¸‹ä¿®æ”¹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">outer</span><span class="params">(func)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inner</span><span class="params">(arg)</span>:</span></span><br><span class="line">        print(<span class="string">'loading...'</span>)</span><br><span class="line">        ret = func(arg)</span><br><span class="line">        print(<span class="string">'Done'</span>)</span><br><span class="line">        <span class="keyword">return</span> ret</span><br><span class="line">    <span class="keyword">return</span> inner</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@outer</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f1</span><span class="params">(arg1)</span>:</span></span><br><span class="line">    print(<span class="string">'f1 func'</span> + arg1)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@outer</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f2</span><span class="params">(arg1)</span>:</span></span><br><span class="line">    print(<span class="string">'f2 func'</span> + arg1)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@outer</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f3</span><span class="params">(arg1)</span>:</span></span><br><span class="line">    print(<span class="string">'f3 func'</span> + arg1)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">f1(<span class="string">'123'</span>)</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">loading...</span><br><span class="line">f1 func123</span><br><span class="line">Done</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="å¸¦å‚æ•°çš„å‡½æ•°è¢«è£…é¥°-å‚æ•°ä¸ªæ•°ä¸ç¡®å®š"><a href="#å¸¦å‚æ•°çš„å‡½æ•°è¢«è£…é¥°-å‚æ•°ä¸ªæ•°ä¸ç¡®å®š" class="headerlink" title="å¸¦å‚æ•°çš„å‡½æ•°è¢«è£…é¥°(å‚æ•°ä¸ªæ•°ä¸ç¡®å®š)"></a>å¸¦å‚æ•°çš„å‡½æ•°è¢«è£…é¥°(å‚æ•°ä¸ªæ•°ä¸ç¡®å®š)</h2><p>ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œåœ¨è£…é¥°å™¨çš„å†…å±‚å‡½æ•°åŠ å…¥å‚æ•°ï¼Œè§£å†³äº†è¢«è£…é¥°å‡½æ•°å¸¦å‚æ•°çš„é—®é¢˜ï¼Œé‚£ä¹ˆï¼Œå¦‚æœè¢«è£…é¥°çš„å‡½æ•°å¦‚æœå‚æ•°ä¸ç¡®å®šï¼Œå¦‚ä½•ä¿è¯è£…é¥°å™¨ä»ç„¶å¯ç”¨å‘¢ï¼Ÿå‚è€ƒå¦‚ä¸‹ä»£ç ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">outer</span><span class="params">(func)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inner</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">        print(<span class="string">'loading...'</span>)</span><br><span class="line">        ret = func(*args, **kwargs)</span><br><span class="line">        print(<span class="string">'Done'</span>)</span><br><span class="line">        <span class="keyword">return</span> ret</span><br><span class="line">    <span class="keyword">return</span> inner</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@outer</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f1</span><span class="params">(arg1)</span>:</span></span><br><span class="line">    print(<span class="string">'f1 func'</span> + arg1)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@outer</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f2</span><span class="params">(arg1, arg2)</span>:</span></span><br><span class="line">    print(<span class="string">'f2 func'</span> + arg1 + arg2)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@outer</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f3</span><span class="params">(arg1, arg2, arg3)</span>:</span></span><br><span class="line">    print(<span class="string">'f3 func'</span> + arg1 + arg2 + arg3)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">f1(<span class="string">'123'</span>)</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">loading...</span><br><span class="line">f1 func123</span><br><span class="line">Done</span><br></pre></td></tr></table></figure>

<p><strong>å¥½çš„ï¼Œè‡³æ­¤Pythonè£…é¥°å™¨çš„å¸¸ç”¨ç”¨æ³•å°±å·²ç»ä»‹ç»å®Œäº†ï¼Œä»¥ä¸Šè£…é¥°å™¨çš„çŸ¥è¯†è¶³å¤Ÿè§£å†³Pythoner 80%çš„è£…é¥°é—®é¢˜å•¦ï¼Œå¦‚æœä½ æœ‰æ›´é«˜æ›´å¤æ‚çš„éœ€æ±‚ï¼Œå¯ä»¥å‚è€ƒä»¥ä¸‹è£…é¥°å™¨çš„ç”¨æ³•</strong></p>
<hr>
<h2 id="å¸¦å‚æ•°çš„è£…é¥°å™¨"><a href="#å¸¦å‚æ•°çš„è£…é¥°å™¨" class="headerlink" title="å¸¦å‚æ•°çš„è£…é¥°å™¨"></a>å¸¦å‚æ•°çš„è£…é¥°å™¨</h2><p>åº”ç”¨åœºæ™¯ï¼šä¸Šé¢çš„è£…é¥°å™¨ï¼Œå‰ç¯‡ä¸€å¾‹ï¼Œç±»ä¼¼äºJavaä¸­çš„å·¥å‚æ–¹æ³•æ¨¡å¼ï¼Œå„ç±»å¯¹è±¡ï¼Œä¸ç®¡ä½ æ˜¯æ–¹çš„åœ†çš„ä¸‰è§’çš„ï¼Œä¸€è¿›å·¥å‚ï¼Œå‡ºæ¥éƒ½æ˜¯ä¸€ä¸ªæ¨¡æ ·çš„~~ é‚£å¸¦å‚æ•°çš„è£…é¥°å™¨è¦è§£å†³çš„å°±æ˜¯â€œä¸ªæ€§åŒ–å·¥å‚æ–¹æ³•â€çš„åŠŸèƒ½ã€‚è™½ç„¶éƒ½ä¼šè¿›è£…é¥°å™¨çš„â€œç†”ç‚‰â€ï¼Œä½†æ˜¯é€šè¿‡ç»™è£…é¥°å™¨ä¼ é€’çš„ä¸åŒå‚æ•°ï¼Œå¯ä»¥å®ç°å¯¹æ¯ä¸ªå‡½æ•°çš„ä¸ªæ€§åŒ–è£…é¥°</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">xxx</span><span class="params">(arg)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">outer</span><span class="params">(func)</span>:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">inner</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">            print(<span class="string">'loading...%s'</span> % (arg))</span><br><span class="line">            ret = func(*args, **kwargs)</span><br><span class="line">            print(<span class="string">'Done'</span>)</span><br><span class="line">            <span class="keyword">return</span> ret</span><br><span class="line">        <span class="keyword">return</span> inner</span><br><span class="line">    <span class="keyword">return</span> outer</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@xxx('f1f1f1')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f1</span><span class="params">(arg1)</span>:</span></span><br><span class="line">    print(<span class="string">'f1 func'</span>+ arg1)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@xxx('f2f2f2')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f2</span><span class="params">(arg1, arg2)</span>:</span></span><br><span class="line">    print(<span class="string">'f2 func'</span> + arg1 + arg2)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@xxx('f3f3f3')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f3</span><span class="params">(arg1, arg2, arg3)</span>:</span></span><br><span class="line">    print(<span class="string">'f3 func'</span> + arg1 + arg2 + arg3)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">f1(<span class="string">'123'</span>)</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">loading...f1f1f1</span><br><span class="line">f1 func123</span><br><span class="line">Done</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ä½¿ç”¨è°ƒè¯•æ¨¡å¼æ¥è¾…åŠ©ç†è§£å¸¦å‚æ•°çš„è£…é¥°å™¨æ˜¯æ€ä¹ˆæ‰§è¡Œçš„</p>
<p>Pythonè§£é‡Šå™¨åŠ è½½xxxå‡½æ•°åˆ°å†…å­˜ä¸­</p>
<p><img src="http://oss.20150509.cn/QQ20160531-1@2x.png" alt=""></p>
<p>æ‰§è¡Œäº†xxxå‡½æ•°ï¼Œå¹¶å°†å‚æ•°ä¼ é€’ç»™äº†xxx <code>ç›¸å½“äºæ‰§è¡Œäº†xxx(&#39;f1f1f1&#39;)</code></p>
<p><img src="http://oss.20150509.cn/QQ20160531-2@2x.png" alt=""></p>
<p>è§£é‡Šå™¨èµ°åˆ°xxxå‡½æ•°çš„å†…éƒ¨ï¼Œå¼€å§‹æ‰§è¡Œxxxçš„å‡½æ•°ä½“ï¼Œå‘ç°åˆæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œäºæ˜¯å°†ä»£ç å®Œæ•´çš„è½½å…¥åˆ°å†…å­˜ä¸­ä»¥å¤‡è°ƒç”¨</p>
<p><img src="http://oss.20150509.cn/QQ20160531-3@2x.png" alt=""></p>
<p>xxxæ‰§è¡Œå®Œæ¯•åï¼ŒæŠŠåŠ è½½åˆ°å†…å­˜ä¸­çš„outerè¿”å›</p>
<p><img src="http://oss.20150509.cn/QQ20160531-4@2x.png" alt=""></p>
<p>outerè¿”å›åè¢«ç«‹å³æ‰§è¡Œï¼ˆå‰é¢æåˆ°è¿‡ï¼Œè£…é¥°å™¨çš„ä¸¤ä¸ªåŠŸèƒ½ï¼Œç¬¬ä¸€å¤§åŠŸèƒ½å°±æ‹¿åˆ°ä¸‹ä¸€è¡Œçš„å‡½æ•°åå½“åšå‚æ•°ä¼ é€’ç»™è£…é¥°å™¨ã€‚åœ¨å¸¦å‚çš„è£…é¥°å™¨ä¸­ï¼Œè°ƒç”¨è£…é¥°å™¨æ—¶ï¼Œå…¶è‡ªèº«å·²ç»å¸¦æœ‰å‚æ•°ï¼Œä¸ä¼šç›´æ¥å»æ‰¾ä¸‹ä¸€è¡Œçš„å‡½æ•°è¿›è¡Œä¼ å‚æ“ä½œï¼Œè€Œæ˜¯ä¼šå…ˆç”¨è‡ªå·±å·²æœ‰çš„å‚æ•°å»æ‰§è¡Œè‡ªå·±ï¼Œè¿”å›outeråï¼Œouterå‘ç°è‡ªå·±éœ€è¦å‚æ•°ï¼Œäºæ˜¯å»ä¸‹ä¸€è¡Œæ‰¾å‡½æ•°åå¹¶ä¼ å‚ï¼Œæ¥ä¸‹æ¥å‘ç”Ÿçš„äº‹æƒ…å°±å’Œä¸Šé¢ä»‹ç»çš„ä¸å¸¦å‚çš„è£…é¥°å™¨çš„æµç¨‹æ˜¯ä¸€æ ·çš„äº†ï¼‰</p>
<p><img src="http://oss.20150509.cn/QQ20160531-5@2x.png" alt=""></p>
<p>outerå‡½æ•°è¢«æ‰§è¡Œï¼Œå°†innerå‡½æ•°ä½“åŠ è½½åˆ°å†…å­˜ä¸­</p>
<p><img src="http://oss.20150509.cn/QQ20160531-6@2x.png" alt=""></p>
<p>å°†innerè¿”å›ï¼ˆè¿™æ˜¯è¿™é‡Œæ˜¯å°†innerå‡½æ•°è¿”å›ï¼Œä¸è¦åœ¨inneråé¢åŠ æ‹¬å·ï¼åŠ äº†æ‹¬å·è¡¨ç¤ºæŠŠinneræ‰§è¡Œç»“æœçš„è¿”å›å€¼è¿”å›ç»™åŸå‡½æ•°f1ï¼‰</p>
<p><img src="http://oss.20150509.cn/QQ20160531-7@2x.png" alt=""></p>
<p>è£…é¥°å™¨å†…çš„æ“ä½œæ‰§è¡Œå®Œåï¼Œè·³å›åˆ°è°ƒç”¨è£…é¥°å™¨çš„åœ°æ–¹ï¼ˆå› ä¸ºPythonå†…éƒ¨å·²ç»å°†åŸf1å‡½æ•°ä½“çš„å¼•ç”¨é€šè¿‡ä¼ å‚çš„æ–¹å¼æŒ‡ç»™äº†outerå‡½æ•°çš„funcå½¢å‚ï¼Œæ‰€ä»¥Pythonè§£é‡Šå™¨ä¸ä¼šå†å»è¯»f1çš„å‡½æ•°ä½“äº†ï¼‰</p>
<p><img src="http://oss.20150509.cn/QQ20160531-8@2x.png" alt=""></p>
<p>è·³è¿‡f1çš„å‡½æ•°ä½“ä¹‹åè¿›å…¥åˆ°å¯¹ä¸‹ä¸€ä¸ªå‡½æ•°çš„è£…é¥° â€¦</p>
<p><img src="http://oss.20150509.cn/QQ20160531-9@2x.png" alt=""></p>
<p>æœ€åPythonè§£é‡Šå™¨è¯»åˆ°äº†ç¨‹åºçš„å…¥å£ç‚¹ï¼ˆç»ˆäºå¯ä»¥å¹²æ´»äº†ï¼ï¼‰</p>
<p><img src="http://oss.20150509.cn/QQ20160531-10@2x.png" alt=""></p>
<p>lookï¼ç›´æ¥è·³åˆ°äº†innerå‡½æ•°çš„å†…éƒ¨å»æ‰§è¡Œå•¦ï¼çœ‹æ¥ä¹‹å‰åˆ†æçš„æ²¡æœ‰é”™ï¼Œè£…é¥°å™¨åœ¨è¿”å›çš„æ—¶å€™ï¼Œå°†innerå‡½æ•°é‡æ–°èµ‹å€¼ç»™äº†f1</p>
<p><img src="http://oss.20150509.cn/QQ20160531-11@2x.png" alt=""></p>
<p>åœ¨è¿è¡Œåˆ°innerä¸­çš„<code>func(*args, **kwargs)</code>çš„æ—¶å€™ï¼Œç¨‹åºè·³åˆ°äº†f1åŸæœ‰çš„å‡½æ•°ä½“ã€‚è¿™ä¹Ÿè¯æ˜äº†ä¸Šé¢çš„åˆ†æï¼Œfuncæˆä¸ºäº†å”¯ä¸€æŒ‡å‘åŸå‡½æ•°ä½“çš„å˜é‡</p>
<hr>
<h2 id="å‚æ•°ä¸ºå‡½æ•°çš„è£…é¥°å™¨"><a href="#å‚æ•°ä¸ºå‡½æ•°çš„è£…é¥°å™¨" class="headerlink" title="å‚æ•°ä¸ºå‡½æ•°çš„è£…é¥°å™¨"></a>å‚æ•°ä¸ºå‡½æ•°çš„è£…é¥°å™¨</h2><p>è¿™æ ·çš„éœ€æ±‚ä¹Ÿæ˜¯æœ‰çš„ï¼Œçœ‹è¿‡äº†ä¸Šé¢çš„ä¸ªæ€§åŒ–å®šåˆ¶ä¹‹åï¼Œç°åœ¨åˆæœ‰äº†æ–°çš„éœ€æ±‚ï¼Œå°±æ˜¯è£…é¥°å™¨æœ‰å¯èƒ½ä¼šç»å¸¸å˜ï¼Œè€æ¿è¯´äº†ï¼Œæ—¶é—´é•¿äº†ä¼šå®¡ç¾ç–²åŠ³~~</p>
<p>åº”å¯¹è¿™æ ·çš„éœ€æ±‚ï¼Œè£…é¥°å™¨ä¹Ÿæ˜¯å¯ä»¥åšçš„ï¼Œé‚£å°±æ˜¯è®©è£…é¥°å™¨ä¼ é€’ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°ä»£æ›¿äº†ä¹‹å‰å†™æ­»åœ¨è£…é¥°å™¨é‡Œçš„ä»£ç ï¼Œå¯ä»¥çµæ´»æ”¹å˜ï¼Œè€Œä¸”æ›´å‰å®³çš„æ˜¯ï¼Œè¢«è£…é¥°å™¨å½“åšå‚æ•°çš„å‡½æ•°ä¾ç„¶å¯ä»¥æœ‰å‚æ•°~~</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">before</span><span class="params">(arg)</span>:</span></span><br><span class="line">    print(<span class="string">'before'</span> + arg)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">after</span><span class="params">(arg)</span>:</span></span><br><span class="line">    print(<span class="string">'after'</span> + arg)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">xxx</span><span class="params">(func_before, func_after)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">outer</span><span class="params">(func)</span>:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">inner</span><span class="params">(arg)</span>:</span></span><br><span class="line">            func_before(arg)</span><br><span class="line">            ret = func(arg)</span><br><span class="line">            func_after(arg)</span><br><span class="line">            <span class="keyword">return</span> ret</span><br><span class="line">        <span class="keyword">return</span> inner</span><br><span class="line">    <span class="keyword">return</span> outer</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@xxx(before, after)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f1</span><span class="params">(arg1)</span>:</span></span><br><span class="line">    print(<span class="string">'f1 func'</span>+ arg1)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@xxx(before, after)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f2</span><span class="params">(arg1, arg2)</span>:</span></span><br><span class="line">    print(<span class="string">'f2 func'</span> + arg1 + arg2)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@xxx(before, after)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f3</span><span class="params">(arg1, arg2, arg3)</span>:</span></span><br><span class="line">    print(<span class="string">'f3 func'</span> + arg1 + arg2 + arg3)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">f1(<span class="string">'123'</span>)</span><br><span class="line"></span><br><span class="line">------</span><br><span class="line">before123</span><br><span class="line">f1 func123</span><br><span class="line">after123</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡ä¸Šé¢è¿™ç§æ–¹æ³•å®ç°åï¼Œåœ¨åŸæœ‰å‡½æ•°çš„åŸºç¡€ä¸Šï¼Œå¯ä»¥éšæ—¶æ–¹ä¾¿çš„æ›´æ”¹è£…é¥°å†…å®¹~~</p>
<hr>
<h1 id="å¤šå±‚è£…é¥°å™¨"><a href="#å¤šå±‚è£…é¥°å™¨" class="headerlink" title="å¤šå±‚è£…é¥°å™¨"></a>å¤šå±‚è£…é¥°å™¨</h1><p>æ˜ç™½äº†å•å±‚è£…é¥°ï¼Œå¤šå±‚è£…é¥°å™¨å°±å¾ˆå®¹æ˜“ç†è§£å•¦~~</p>
<p>ç°å¯¹ä¸šåŠ¡çš„å…·ä½“åŠŸèƒ½æœ‰å¦‚ä¸‹éœ€æ±‚ï¼š</p>
<ul>
<li>é¦–å…ˆéªŒè¯ç”¨æˆ·æ˜¯å¦ç™»å½•</li>
<li>å†éªŒè¯ç™»å½•çš„ç”¨æˆ·æ˜¯å¦æ‹¥æœ‰æƒé™</li>
</ul>
<p>ç°åœ¨æˆ‘æœ‰å¤§é‡çš„ä¸šåŠ¡é€»è¾‘æ–¹æ³•ï¼Œæ¯ä¸ªæ–¹æ³•åœ¨è¢«è°ƒç”¨å‰éƒ½éœ€è¦å»éªŒè¯å‰ä¸¤é¡¹ï¼Œåœ¨è¿™æ ·ä¸€ä¸ªé¡¹ç›®éœ€æ±‚ä¸­ï¼Œå¤šå±‚è£…é¥°å™¨å°±å¯ä»¥è¢«å‘æŒ¥çš„æ·‹æ¼“å°½è‡´</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">login_status = <span class="literal">True</span></span><br><span class="line">permission = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check_login</span><span class="params">(func)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inner</span><span class="params">()</span>:</span></span><br><span class="line">        <span class="keyword">if</span> login_status:</span><br><span class="line">            print(<span class="string">'---&gt;Login success'</span>)</span><br><span class="line">            <span class="keyword">return</span> func()</span><br><span class="line">    <span class="keyword">return</span> inner</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check_permission</span><span class="params">(func)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inner</span><span class="params">()</span>:</span></span><br><span class="line">        <span class="keyword">if</span> permission:</span><br><span class="line">            print(<span class="string">'---&gt;Authorized'</span>)</span><br><span class="line">            <span class="keyword">return</span> func()</span><br><span class="line">    <span class="keyword">return</span> inner</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@check_login</span></span><br><span class="line"><span class="meta">@check_permission</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">xxx</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'rm -fr /'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    xxx()</span><br><span class="line">    </span><br><span class="line">------------</span><br><span class="line">---&gt;Login success</span><br><span class="line">---&gt;Authorized</span><br><span class="line">rm -fr /</span><br></pre></td></tr></table></figure>

<p>ä»ä¸Šé¢çš„ä»£ç ä¸­å¯ä»¥çœ‹å‡ºï¼Œåœ¨ä¸€ä¸ªå‡½æ•°ä½¿ç”¨äº†å¤šä¸ªè£…é¥°å™¨ä¹‹åï¼Œä»£ç æ˜¯ä»ç¬¬ä¸€ä¸ªè£…é¥°å™¨çš„å†…éƒ¨å‡½æ•°ï¼ˆinnerï¼‰å¼€å§‹é¡ºåºå‘ä¸‹æ‰§è¡Œï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨å¤šä¸ªè£…é¥°å™¨æ—¶ï¼Œä¸€å®šè¦æ³¨æ„é¡ºåºé—®é¢˜ï¼ä¸€å®šè¦åœ¨æœ€ä¸Šé¢å…ˆéªŒè¯ç™»å½•ï¼Œå†éªŒè¯æƒé™ï¼æ¥ä¸‹æ¥æˆ‘ä»¬æ¥å…·ä½“åˆ†æä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆä¸æ˜¯ç¦»è¢«è£…é¥°å‡½æ•°æœ€è¿‘çš„è£…é¥°å™¨å…ˆæ‰§è¡Œï¼</p>
<p>å¦‚æœä½¿ç”¨Debugæ¨¡å¼æ¥è§‚å¯Ÿæ‰§è¡Œè¿‡ç¨‹ï¼Œå¯ä»¥å¾ˆæ¸…æ¥šçš„çœ‹åˆ°å¦‚ä¸‹è¿‡ç¨‹ï¼š</p>
<ol>
<li>é¦–å…ˆPythonè§£é‡Šå™¨å°†ä»£ç çš„å‰ä¸¤è¡Œæ”¾å…¥åˆ°å†…å­˜ä¸­</li>
<li>é‡åˆ°<code>check_login</code>å‡½æ•°ï¼Œå°†å…¶å‡½æ•°åæ”¾å…¥æ ˆåŒºï¼Œå‡½æ•°ä½“æ”¾å…¥å †åŒº</li>
<li>é‡åˆ°<code>check_permission</code>å‡½æ•°ï¼Œå°†å…¶å‡½æ•°åæ”¾å…¥æ ˆåŒºï¼Œå‡½æ•°ä½“æ”¾å…¥å †åŒº</li>
<li>æ‰§è¡Œåˆ°<code>@check_login</code>æ—¶ï¼Œå°†è·å–ä¸‹ä¸€è¡Œçš„å‡½æ•°ä½œä¸ºå‚æ•°ï¼Œä½†æ˜¯ä¸‹ä¸€è¡Œä¸æ˜¯å‡½æ•°ï¼Œæ‰€ä»¥ç»§ç»­å‘ä¸‹æ‰§è¡Œ</li>
<li>æ‰§è¡Œåˆ°<code>@check_permission</code>æ—¶ï¼Œè·å–ä¸‹ä¸€è¡Œå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›<code>check_permission</code>è£…é¥°å™¨å†…çš„<code>inner</code>å‡½æ•°è¿”å›é‡æ–°èµ‹å€¼ç»™<code>xxx</code></li>
<li>æ­¤æ—¶ä¹‹å‰è·³è¿‡çš„<code>@check_login</code>è£…é¥°å™¨ç»ˆäºå¾—åˆ°äº†ä¸€ä¸ªæ–°å‡½æ•°ä½œä¸ºå‚æ•°ï¼ˆ@check_loginè·å¾—çš„å‡½æ•°æ˜¯@check_permissionå†…éƒ¨çš„innerå‡½æ•°ï¼‰æ•…ï¼Œå°†è¯¥å‡½æ•°ä¼ å…¥åˆ°loginè£…é¥°å™¨ä¸­ï¼Œå¹¶è¿”å›<code>@check_login</code>å†…éƒ¨çš„<code>inner</code>å‡½æ•°ã€‚</li>
<li>å½“xxxå‡½æ•°è¢«æ‰§è¡Œçš„æ—¶å€™ï¼Œå…ˆæ‰§è¡Œçš„æ˜¯<code>@check_login</code>ä¸­è¿”å›çš„<code>inner</code>å‡½æ•°ï¼Œè€Œåœ¨<code>@check_login</code>ä¸­çš„<code>inner</code>å‡½æ•°é‡åˆ°<code>fun()</code>æ—¶ï¼Œå…¶å®è¯¥å‡½æ•°æ˜¯<code>@check_permission</code>å‡½æ•°è¿”å›çš„<code>inner</code>å‡½æ•°ï¼Œæ‰€ä»¥åœ¨éªŒè¯å®Œç™»å½•åï¼Œä¼šç«‹å³å»permissionå‡½æ•°ä¸­å»éªŒè¯æƒé™ï¼Œæƒé™éªŒè¯é€šè¿‡åå†æ‰§è¡Œçš„<code>fun()</code>å°±æ˜¯<code>xxx</code>å‡½æ•°è‡ªå·±åŸå§‹çš„å‡½æ•°ä½“äº†</li>
</ol>
<p><strong>æ€»ç»“ï¼š</strong>é¡ºåºå¾ˆé‡è¦ï¼å¤šé‡åµŒå¥—çš„è£…é¥°ä¸€å®šè¦è®°ä½ä»¥ä¸‹ä¸¤ç‚¹ï¼š</p>
<ul>
<li>Pythonè§£é‡Šä»£ç æ—¶æ˜¯ä»ä¸‹å¾€ä¸Šè¿”å›å‡½æ•°</li>
<li>è€Œç¨‹åºæ‰§è¡Œæ—¶ï¼ŒåŠŸèƒ½æ˜¯ä»ä¸Šå¾€ä¸‹æ‰§è¡Œ</li>
</ul>
<p><img src="http://oss.20150509.cn/20150607012559.png" alt=""></p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>è£…é¥°å™¨</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonå­¦ä¹ ç¬”è®°[3]</title>
    <url>/2016/05/25/Python%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-3/</url>
    <content><![CDATA[<blockquote>
<p>ä¸‰å…ƒè¿ç®—</p>
<p>é›†åˆ(set)</p>
<p>æ·±æµ…æ‹·è´</p>
<p>å‡½æ•°(def)</p>
<p>æ–‡ä»¶çš„æ“ä½œ</p>
</blockquote>
<p>** é»˜è®¤è¿è¡Œç¯å¢ƒä¸ºPython3.5+ **</p>
<hr>
<h1 id="ä¸‰å…ƒè¿ç®—"><a href="#ä¸‰å…ƒè¿ç®—" class="headerlink" title="ä¸‰å…ƒè¿ç®—"></a>ä¸‰å…ƒè¿ç®—</h1><p>ä¸‰å…ƒè¿ç®—åˆç§°ä¹‹ä¸ºä¸‰ç›®è¿ç®—ï¼Œæ˜¯å¯¹ç®€å•æ¡ä»¶è¯­å¥çš„ç¼©å†™ï¼Œæ²¡æœ‰çœ‹é”™ï¼Œç®€å•çš„è¯­å¥ä¹Ÿè¦ç®€å†™ï¼</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># éœ€è¦è¢«ç®€å†™çš„æƒ…å†µ</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> æ¡ä»¶è¡¨è¾¾å¼:</span><br><span class="line">    result = value1</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    result = value2</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸‰å…ƒè¿ç®—è¯­æ³•</span></span><br><span class="line"></span><br><span class="line">result = value1 <span class="keyword">if</span> æ¡ä»¶è¡¨è¾¾å¼ <span class="keyword">else</span> value2</span><br><span class="line"></span><br><span class="line"><span class="comment">#resultæœ€åçš„ç»“æœå–å†³äºåé¢çš„æ¡ä»¶è¡¨è¾¾å¼æ˜¯å¦æˆç«‹</span></span><br><span class="line"><span class="comment">#å¦‚æœæ¡ä»¶è¡¨è¾¾å¼æˆç«‹,åˆ™value1å°†èµ‹å€¼ç»™result,åä¹‹,å¦‚æœæ¡ä»¶è¡¨è¾¾å¼ä¸æˆç«‹,åˆ™å°†value2èµ‹å€¼ç»™result</span></span><br><span class="line"></span><br><span class="line">num = <span class="number">5</span></span><br><span class="line">result = <span class="string">'ç¬¬ä¸€ä¸ªå€¼'</span> <span class="keyword">if</span> num &lt; <span class="number">9</span> <span class="keyword">else</span> <span class="string">'ç¬¬äºŒä¸ªå€¼'</span></span><br><span class="line">print(result)</span><br><span class="line"></span><br><span class="line"><span class="comment">######è¿è¡Œç»“æœ</span></span><br><span class="line">ç¬¬ä¸€ä¸ªå€¼</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">num = <span class="number">59</span></span><br><span class="line">result = <span class="string">'ç¬¬ä¸€ä¸ªå€¼'</span> <span class="keyword">if</span> num &lt; <span class="number">9</span> <span class="keyword">else</span> <span class="string">'ç¬¬äºŒä¸ªå€¼'</span></span><br><span class="line">print(result)</span><br><span class="line"></span><br><span class="line"><span class="comment">######è¿è¡Œç»“æœ</span></span><br><span class="line">ç¬¬äºŒä¸ªå€¼</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="é›†åˆ"><a href="#é›†åˆ" class="headerlink" title="é›†åˆ"></a>é›†åˆ</h1><h2 id="é›†åˆçš„ç‰¹æ€§"><a href="#é›†åˆçš„ç‰¹æ€§" class="headerlink" title="é›†åˆçš„ç‰¹æ€§"></a>é›†åˆçš„ç‰¹æ€§</h2><p>seté›†åˆ,æ˜¯ä¸€ä¸ª<code>æ— åº</code>ä¸”<code>ä¸é‡å¤</code>çš„å…ƒç´ çš„é›†åˆ<br>åˆ©ç”¨é›†åˆä¸é‡å¤çš„ç‰¹ç‚¹,å¯ä»¥è½»æ¾å®ç°åˆ—è¡¨å…ƒç´ çš„å»é‡</p>
<h2 id="åˆ›å»ºé›†åˆ"><a href="#åˆ›å»ºé›†åˆ" class="headerlink" title="åˆ›å»ºé›†åˆ"></a>åˆ›å»ºé›†åˆ</h2><p>åˆ›å»ºé›†åˆçš„æ“ä½œä¸åˆ›å»ºå­—å…¸çš„æ–¹å¼å¾ˆåƒ,å­—å…¸æ˜¯é”®å€¼å¯¹,æ¯ä¸ªå…ƒç´ ç”±ä¸¤ä¸ªå€¼ç»„æˆ,é›†åˆç”±ä¸€ä¸ªå…ƒç´ ç»„æˆ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">set_apple = &#123;<span class="string">'iPhone'</span>, <span class="string">'iPad'</span>, <span class="string">'iMac'</span>&#125;</span><br><span class="line">print(set_apple, type(set_apple))</span><br><span class="line"></span><br><span class="line"><span class="comment">######è¿è¡Œç»“æœ</span></span><br><span class="line">&#123;<span class="string">'iPhone'</span>, <span class="string">'iMac'</span>, <span class="string">'iPad'</span>&#125; &lt;<span class="class"><span class="keyword">class</span> '<span class="title">set</span>'&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">#åˆ›å»ºé›†åˆéœ€è¦æ³¨æ„çš„æ˜¯åˆ›å»ºç©ºé›†åˆ</span></span><br><span class="line"><span class="class">#åˆ›å»ºä¸€ä¸ªç©ºåˆ—è¡¨</span></span><br><span class="line">list_null = []</span><br><span class="line"><span class="comment">#åˆ›å»ºä¸€ä¸ªç©ºå­—å…¸</span></span><br><span class="line">dict_null = &#123;&#125;</span><br><span class="line"><span class="comment">#åˆ›å»ºä¸€ä¸ªç©ºé›†åˆ</span></span><br><span class="line">set_null = set()</span><br></pre></td></tr></table></figure>

<h2 id="æ“ä½œé›†åˆ"><a href="#æ“ä½œé›†åˆ" class="headerlink" title="æ“ä½œé›†åˆ"></a>æ“ä½œé›†åˆ</h2><ul>
<li>add å‘é›†åˆä¸­æ·»åŠ å…ƒç´ </li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">set_apple = set()</span><br><span class="line">print(set_apple)</span><br><span class="line">set_apple.add(<span class="string">'iPhone'</span>)</span><br><span class="line">print(set_apple)</span><br><span class="line">set_apple.add(<span class="string">'iMac'</span>)</span><br><span class="line">print(set_apple)</span><br><span class="line"></span><br><span class="line"><span class="comment">######è¿è¡Œç»“æœ</span></span><br><span class="line">set()</span><br><span class="line">&#123;<span class="string">'iPhone'</span>&#125;</span><br><span class="line">&#123;<span class="string">'iPhone'</span>, <span class="string">'iMac'</span>&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>clear æ¸…ç©ºé›†åˆä¸­çš„æ‰€æœ‰å…ƒç´ </li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">set_apple = &#123;<span class="string">'iPhone'</span>, <span class="string">'iPad'</span>, <span class="string">'iMac'</span>&#125;</span><br><span class="line">print(set_apple)</span><br><span class="line">set_apple.clear()</span><br><span class="line">print(set_apple)</span><br><span class="line"></span><br><span class="line"><span class="comment">######è¿è¡Œç»“æœ</span></span><br><span class="line">&#123;<span class="string">'iPad'</span>, <span class="string">'iPhone'</span>, <span class="string">'iMac'</span>&#125;</span><br><span class="line">set()</span><br></pre></td></tr></table></figure>

<ul>
<li>copy æµ…æ‹·è´</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#æµ…æ‹·è´,é¡¾åè¯ä¹‰,è¯¥æ‹·è´æ“ä½œåªä¼šå¯¹å¤´å±‚çš„å…ƒç´ èµ·ä½œç”¨</span></span><br><span class="line"><span class="comment">#ä¹‹å‰åœ¨æ•°æ®ç±»å‹çš„ä»‹ç»ä¸­è¯´è¿‡,æ•°æ®ç±»å‹åˆ†ä¸ºä¸¤ç±»</span></span><br><span class="line"><span class="comment">#   |- åŸºæœ¬æ•°æ®ç±»å‹</span></span><br><span class="line"><span class="comment">#   |- å¼•ç”¨æ•°æ®ç±»å‹</span></span><br><span class="line"><span class="comment">#åœ¨æµ…æ‹·è´ä¸­,æ‰§è¡Œæ‹·è´åŠ¨ä½œçš„æ˜¯åŸºæœ¬æ•°æ®ç±»å‹,å¼•ç”¨æ•°æ®ç±»å‹ä¸ä¼šè¢«æ‹·è´</span></span><br><span class="line"></span><br><span class="line">set_apple = &#123;<span class="string">'iPhone'</span>, <span class="string">'iPad'</span>, <span class="string">'iMac'</span>&#125;</span><br><span class="line">print(set_apple)</span><br><span class="line">set_apple_II = set_apple.copy()</span><br><span class="line">print(set_apple_II)</span><br><span class="line"></span><br><span class="line"><span class="comment">######è¿è¡Œç»“æœ</span></span><br><span class="line">&#123;<span class="string">'iPad'</span>, <span class="string">'iPhone'</span>, <span class="string">'iMac'</span>&#125;</span><br><span class="line">&#123;<span class="string">'iPad'</span>, <span class="string">'iPhone'</span>, <span class="string">'iMac'</span>&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>difference å·¦è¿æ¥</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#é›†åˆä¸­çš„è¿™ä¸ªæ–¹æ³•,å¾ˆåƒT-SQLä¸­çš„å·¦è¿æ¥</span></span><br><span class="line"><span class="comment">#æ„æ€å°±æ˜¯ä»¥å·¦è¾¹é›†åˆå…ƒç´ ä¸ºåŸºå‡†,åˆ—å‡ºå·¦è¾¹é›†åˆæ¯”å³è¾¹é›†åˆå¤šå‡ºæ¥çš„å…ƒç´ </span></span><br><span class="line">set_apple_I = &#123;<span class="string">'iPhone'</span>, <span class="string">'iPad'</span>, <span class="string">'iMac'</span>&#125;</span><br><span class="line">set_apple_II = &#123;<span class="string">'iPhone'</span>, <span class="string">'iPad'</span>, <span class="string">'MacBook'</span>&#125;</span><br><span class="line">diff = set_apple_I.difference(set_apple_II)</span><br><span class="line">print(diff)</span><br><span class="line"></span><br><span class="line"><span class="comment">######è¿è¡Œç»“æœ</span></span><br><span class="line">&#123;<span class="string">'iMac'</span>&#125;</span><br><span class="line"><span class="comment">#è™½ç„¶é›†åˆIIä¸­ä¹Ÿæœ‰Ié‡Œæ²¡æœ‰çš„å…ƒç´ ,ä½†æ˜¯åˆ«å¿˜äº†,è¿™æ˜¯"å·¦è¿æ¥",ä¸€åˆ‡ä»¥ç¬¬ä¸€ä¸ªé›†åˆçš„å…ƒç´ ä¸ºåŸºå‡†</span></span><br></pre></td></tr></table></figure>

<ul>
<li>difference_update å·¦è¿æ¥æ›´æ–°</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#åŸè°…æˆ‘è¿™å¾ˆä¸ä¸“ä¸šçš„å‘½å O(âˆ©_âˆ©)Oå“ˆå“ˆ~</span></span><br><span class="line"><span class="comment">#è¿™ä¸ªæ–¹æ³•çš„æ„æ€æ˜¯: ä»è°ƒç”¨è¿™ä¸ªæ–¹æ³•çš„é›†åˆä¸­åˆ é™¤ä¸å¦ä¸€ä¸ªé›†åˆä¸­ç›¸åŒçš„å…ƒç´ </span></span><br><span class="line"></span><br><span class="line">set_apple_I = &#123;<span class="string">'iPhone'</span>, <span class="string">'iPad'</span>, <span class="string">'iMac'</span>&#125;</span><br><span class="line">set_apple_II = &#123;<span class="string">'iPhone'</span>, <span class="string">'iPad'</span>, <span class="string">'MacBook'</span>&#125;</span><br><span class="line">diff = set_apple_I.difference_update(set_apple_II)</span><br><span class="line">print(diff)</span><br><span class="line">print(<span class="string">'set_apple_I: '</span>, set_apple_I)</span><br><span class="line">print(<span class="string">'set_apple_II: '</span>, set_apple_II)</span><br><span class="line"></span><br><span class="line"><span class="comment">######è¿è¡Œç»“æœ</span></span><br><span class="line"><span class="literal">None</span></span><br><span class="line">set_apple_I:  &#123;<span class="string">'iMac'</span>&#125;</span><br><span class="line">set_apple_II:  &#123;<span class="string">'iPad'</span>, <span class="string">'MacBook'</span>, <span class="string">'iPhone'</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯ä»¥çœ‹å‡º,è°ƒç”¨è¿™ä¸ªæ–¹æ³•æ˜¯æ²¡æœ‰è¿”å›å€¼çš„</span></span><br><span class="line"><span class="comment">#å…¶æ¬¡,é›†åˆIä¸­åˆ é™¤äº†ä¸é›†åˆIIä¸­ç›¸åŒçš„å…ƒç´ ,ä»…ä»…ç•™ä¸‹äº†Iä¸­æœ‰è€ŒIIä¸­æ²¡æœ‰çš„å…ƒç´ </span></span><br></pre></td></tr></table></figure>

<ul>
<li>discard ç§»é™¤æŒ‡å®šå…ƒç´ </li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">set_apple = &#123;<span class="string">'iPhone'</span>, <span class="string">'iPad'</span>, <span class="string">'iMac'</span>&#125;</span><br><span class="line">set_apple.discard(<span class="string">'iPad'</span>)</span><br><span class="line">print(set_apple)</span><br><span class="line"></span><br><span class="line"><span class="comment">######è¿è¡Œç»“æœ</span></span><br><span class="line">&#123;<span class="string">'iPhone'</span>, <span class="string">'iMac'</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#æœ€çˆ½çš„æ˜¯ä¸‹é¢çš„ä¾‹å­</span></span><br><span class="line">set_apple = &#123;<span class="string">'iPhone'</span>, <span class="string">'iPad'</span>, <span class="string">'iMac'</span>&#125;</span><br><span class="line">set_apple.discard(<span class="string">'MacBook'</span>)</span><br><span class="line">print(set_apple)</span><br><span class="line"></span><br><span class="line"><span class="comment">######è¿è¡Œç»“æœ</span></span><br><span class="line">&#123;<span class="string">'iMac'</span>, <span class="string">'iPad'</span>, <span class="string">'iPhone'</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#çœ‹åˆ°æ²¡,æŒ‡å®šä¸€ä¸ªé›†åˆä¸­æ²¡æœ‰çš„å…ƒç´ ç§»é™¤,æ²¡æœ‰æŠ¥é”™!!!</span></span><br></pre></td></tr></table></figure>

<ul>
<li>intersection å–äº¤é›†</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">set_apple_I = &#123;<span class="string">'iPhone'</span>, <span class="string">'iPad'</span>, <span class="string">'iMac'</span>&#125;</span><br><span class="line">set_apple_II = &#123;<span class="string">'iPhone'</span>, <span class="string">'iPad'</span>, <span class="string">'MacBook'</span>&#125;</span><br><span class="line">intersection = set_apple_I.intersection(set_apple_II)</span><br><span class="line">print(intersection)</span><br><span class="line"></span><br><span class="line"><span class="comment">######è¿è¡Œç»“æœ</span></span><br><span class="line">&#123;<span class="string">'iPad'</span>, <span class="string">'iPhone'</span>&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>intersection_update å–äº¤é›†å¹¶æ›´æ–°åˆ°è°ƒç”¨é›†åˆä¸­</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">set_apple_I = &#123;<span class="string">'iPhone'</span>, <span class="string">'iPad'</span>, <span class="string">'iMac'</span>&#125;</span><br><span class="line">set_apple_II = &#123;<span class="string">'iPhone'</span>, <span class="string">'iPad'</span>, <span class="string">'MacBook'</span>&#125;</span><br><span class="line">set_apple_I.intersection_update(set_apple_II)</span><br><span class="line">print(<span class="string">'set_apple_I'</span>, set_apple_I)</span><br><span class="line">print(<span class="string">'set_apple_II'</span>, set_apple_II)</span><br><span class="line"></span><br><span class="line"><span class="comment">######è¿è¡Œç»“æœ</span></span><br><span class="line">set_apple_I &#123;<span class="string">'iPad'</span>, <span class="string">'iPhone'</span>&#125;</span><br><span class="line">set_apple_II &#123;<span class="string">'iPad'</span>, <span class="string">'iPhone'</span>, <span class="string">'MacBook'</span>&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>isdisjoint æ£€æŸ¥ä¸¤ä¸ªé›†åˆæ˜¯å¦å­˜åœ¨äº¤é›†</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">set_apple_I = &#123;<span class="string">'iPhone'</span>, <span class="string">'iPad'</span>, <span class="string">'iMac'</span>&#125;</span><br><span class="line">set_apple_II = &#123;<span class="string">'iPhone'</span>, <span class="string">'iPad'</span>, <span class="string">'MacBook'</span>&#125;</span><br><span class="line">ret = set_apple_I.isdisjoint(set_apple_II)</span><br><span class="line">print(ret)</span><br><span class="line"></span><br><span class="line">set_apple_III = &#123;<span class="string">'MacBookAir'</span>, <span class="string">'MacBookPro'</span>&#125;</span><br><span class="line">ret2 = set_apple_I.isdisjoint(set_apple_III)</span><br><span class="line">print(ret2)</span><br><span class="line"></span><br><span class="line"><span class="comment">######è¿è¡Œç»“æœ</span></span><br><span class="line"><span class="literal">False</span></span><br><span class="line"><span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ³¨æ„è¿”å›è§„åˆ™,å¦‚æœæœ‰äº¤é›†è¿”å›False,å¦‚æœæ²¡æœ‰äº¤é›†è¿”å›True</span></span><br></pre></td></tr></table></figure>

<ul>
<li>issubset æ˜¯å¦æ˜¯å­åºåˆ— &amp; issuperset æ˜¯å¦æ˜¯çˆ¶åºåˆ—</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">set_apple_I = &#123;<span class="string">'iPhone'</span>, <span class="string">'iPad'</span>, <span class="string">'iMac'</span>&#125;</span><br><span class="line">set_apple_II = &#123;<span class="string">'iPhone'</span>&#125;</span><br><span class="line">ret1 = set_apple_I.issubset(set_apple_II)</span><br><span class="line">ret2 = set_apple_I.issuperset(set_apple_II)</span><br><span class="line">print(<span class="string">'I æ˜¯ II çš„å­åºåˆ—:'</span>, ret1)</span><br><span class="line">print(<span class="string">'I æ˜¯ II çš„çˆ¶åºåˆ—:'</span>, ret2)</span><br><span class="line"></span><br><span class="line"><span class="comment">######è¿è¡Œç»“æœ</span></span><br><span class="line">I æ˜¯ II çš„å­åºåˆ—: <span class="literal">False</span></span><br><span class="line">I æ˜¯ II çš„çˆ¶åºåˆ—: <span class="literal">True</span></span><br></pre></td></tr></table></figure>

<ul>
<li>pop éšæœºç§»é™¤å…ƒç´ </li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">set_apple = &#123;<span class="string">'iPhone'</span>, <span class="string">'iPad'</span>, <span class="string">'iMac'</span>&#125;</span><br><span class="line">ret = set_apple.pop()</span><br><span class="line">print(set_apple)</span><br><span class="line">print(ret)</span><br><span class="line"></span><br><span class="line"><span class="comment">######è¿è¡Œç»“æœ</span></span><br><span class="line">&#123;<span class="string">'iPhone'</span>, <span class="string">'iMac'</span>&#125;</span><br><span class="line">iPad</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä»ç»“æœä¸­å¯ä»¥çœ‹å‡º,popæ˜¯éšæœºå‰”é™¤é›†åˆä¸­çš„ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line"><span class="comment">#popçš„è¿”å›å€¼æ˜¯å‰”é™¤å…ƒç´ çš„å€¼</span></span><br></pre></td></tr></table></figure>

<ul>
<li>remove åˆ é™¤æŒ‡å®šå…ƒç´ </li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#å¯ä»¥å’Œä¸Šé¢ä»‹ç»çš„discardå¯¹æ¯”è®°å¿†</span></span><br><span class="line"><span class="comment">#removeå’Œdiscaardéƒ½æ˜¯åˆ é™¤æŒ‡å®šå…ƒç´ </span></span><br><span class="line"><span class="comment">#åŒºåˆ«æ˜¯removeåˆ é™¤çš„å…ƒç´ ä¸å­˜åœ¨æ—¶ä¼šæŠ¥é”™</span></span><br><span class="line">set_apple = &#123;<span class="string">'iPhone'</span>, <span class="string">'iPad'</span>, <span class="string">'iMac'</span>&#125;</span><br><span class="line">set_apple.remove(<span class="string">'iPhone'</span>)</span><br><span class="line">print(set_apple)</span><br><span class="line">set_apple.remove(<span class="string">'iPhone'</span>)</span><br><span class="line">print(set_apple)</span><br><span class="line"></span><br><span class="line"><span class="comment">######è¿è¡Œç»“æœ</span></span><br><span class="line">&#123;<span class="string">'iMac'</span>, <span class="string">'iPad'</span>&#125;</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"/Users/lvrui/PycharmProjects/untitled/3/code/test.py"</span>, line <span class="number">89</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    set_apple.remove(<span class="string">'iPhone'</span>)</span><br><span class="line">KeyError: <span class="string">'iPhone'</span></span><br></pre></td></tr></table></figure>

<ul>
<li>symmetric_difference å¯¹ç§°å·®é›†</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">set_apple_I = &#123;<span class="string">'iPhone'</span>, <span class="string">'iPad'</span>, <span class="string">'iMac'</span>&#125;</span><br><span class="line">set_apple_II = &#123;<span class="string">'iPhone'</span>, <span class="string">'iPad'</span>, <span class="string">'MacBook'</span>&#125;</span><br><span class="line">ret = set_apple_I.symmetric_difference(set_apple_II)</span><br><span class="line">print(ret)</span><br><span class="line"></span><br><span class="line"><span class="comment">######è¿è¡Œç»“æœ</span></span><br><span class="line">&#123;<span class="string">'iMac'</span>, <span class="string">'MacBook'</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ•°å­¦é‡Œçš„å·®é›†,æˆ‘ä¹Ÿä¸çŸ¥é“è¯¥æ€ä¹ˆè§£é‡Šå¥½äº†,ä½ å°±è®¤ä¸ºæ˜¯äº¤é›†çš„å–åå§,å“ˆå“ˆ</span></span><br></pre></td></tr></table></figure>

<ul>
<li>symmetric_difference_update å–å·®é›†å¹¶æ›´æ–°åˆ°è°ƒç”¨é›†åˆä¸­</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">set_apple_I = &#123;<span class="string">'iPhone'</span>, <span class="string">'iPad'</span>, <span class="string">'iMac'</span>&#125;</span><br><span class="line">set_apple_II = &#123;<span class="string">'iPhone'</span>, <span class="string">'iPad'</span>, <span class="string">'MacBook'</span>&#125;</span><br><span class="line">set_apple_I.symmetric_difference_update(set_apple_II)</span><br><span class="line">print(set_apple_I)</span><br><span class="line">print(set_apple_II)</span><br><span class="line"></span><br><span class="line"><span class="comment">######è¿è¡Œç»“æœ</span></span><br><span class="line">&#123;<span class="string">'iMac'</span>, <span class="string">'MacBook'</span>&#125;</span><br><span class="line">&#123;<span class="string">'MacBook'</span>, <span class="string">'iPad'</span>, <span class="string">'iPhone'</span>&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>union å¹¶é›†</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">set_apple_I = &#123;<span class="string">'iPhone'</span>, <span class="string">'iPad'</span>, <span class="string">'iMac'</span>&#125;</span><br><span class="line">set_apple_II = &#123;<span class="string">'iPhone'</span>, <span class="string">'iPad'</span>, <span class="string">'MacBook'</span>&#125;</span><br><span class="line">ret = set_apple_I.union(set_apple_II)</span><br><span class="line">print(ret)</span><br><span class="line"></span><br><span class="line"><span class="comment">######è¿è¡Œç»“æœ</span></span><br><span class="line">&#123;<span class="string">'iPad'</span>, <span class="string">'MacBook'</span>, <span class="string">'iMac'</span>, <span class="string">'iPhone'</span>&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>update æ›´æ–°é›†åˆ</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">set_apple_I = &#123;<span class="string">'iPhone'</span>, <span class="string">'iPad'</span>, <span class="string">'iMac'</span>&#125;</span><br><span class="line">set_apple_II = &#123;<span class="string">'iPhone'</span>, <span class="string">'iPad'</span>, <span class="string">'MacBook'</span>&#125;</span><br><span class="line">set_apple_I.update(set_apple_II)</span><br><span class="line">print(set_apple_I)</span><br><span class="line"></span><br><span class="line"><span class="comment">######è¿è¡Œç»“æœ</span></span><br><span class="line">&#123;<span class="string">'MacBook'</span>, <span class="string">'iPhone'</span>, <span class="string">'iMac'</span>, <span class="string">'iPad'</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç›¸å½“äºä½¿ç”¨å¹¶é›†å»æ›´æ–°è°ƒç”¨çš„é›†åˆ</span></span><br><span class="line"><span class="comment">#æŒ‰ç…§å‰é¢çš„å‘½åè§„å¾‹,è¿™ä¸ªä¹Ÿè®¸åº”è¯¥å«åš"union_update" ^_^</span></span><br></pre></td></tr></table></figure>

<h2 id="é›†åˆçš„åº”ç”¨-å»é‡"><a href="#é›†åˆçš„åº”ç”¨-å»é‡" class="headerlink" title="é›†åˆçš„åº”ç”¨(å»é‡)"></a>é›†åˆçš„åº”ç”¨(å»é‡)</h2><p>åœ¨å»é‡é¢†åŸŸ,é›†åˆæ˜¯éå¸¸å¥½ç”¨è€Œä¸”éå¸¸é«˜æ•ˆçš„æ–¹æ³•,å¦‚æœé¢è¯•æ—¶æœ‰äººé—®ä½ ,å¦‚æœé«˜æ•ˆçš„å»é™¤ä¸€ä¸ªå·¨å‹åˆ—è¡¨ä¸­é‡å¤çš„å…ƒç´ ,è¿™ä¸ªæ—¶å€™ä¸è¦è£…Xæ—¶å€™è‡ªå·±å†™ç®—æ³•äº†,è€è€å®å®çš„è¯´ç”¨setä½ å°±æ˜¯æ»¡åˆ†å•¦<del>~</del></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">list_test = [<span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">3</span>]</span><br><span class="line">print(list_test)</span><br><span class="line">set_test = set(list_test)</span><br><span class="line">print(set_test)</span><br><span class="line"></span><br><span class="line"><span class="comment">######è¿è¡Œç»“æœ</span></span><br><span class="line">[<span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">3</span>]</span><br><span class="line">&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="æ·±æµ…æ‹·è´"><a href="#æ·±æµ…æ‹·è´" class="headerlink" title="æ·±æµ…æ‹·è´"></a>æ·±æµ…æ‹·è´</h1><p>æ·±æµ…æ‹·è´çš„é—®é¢˜åº”è¯¥æ”¾åœ¨åˆ—è¡¨å’Œå­—å…¸ä¹‹åæœ€å¥½,æ— æ‰€è°“å•¦,å…ˆå¡åœ¨è¿™é‡Œå•¦~~</p>
<p>äº§ç”Ÿæ·±æµ…æ‹·è´çš„é—®é¢˜è¦è¿½æº¯åˆ°ä¹‹å‰ç¬”è®°æ–‡æ¡£ä¸­æ‰€è¯´çš„Pythonæ•°æ®ç±»å‹çš„åˆ†ç±»</p>
<ul>
<li><p>åœ¨Pythonä¸­,æ•°æ®ç±»å‹åˆ†ä¸ºä¸¤ç±»:</p>
<ol>
<li><p>åŸºæœ¬æ•°æ®ç±»å‹(string, int, float, boolean)</p>
</li>
<li><p>å¼•ç”¨æ•°æ®ç±»å‹(list, tuple, dict, set, class)</p>
</li>
</ol>
</li>
<li><p>åŸºæœ¬æ•°æ®ç±»å‹åœ¨ä¼ é€’çš„æ—¶å€™æ˜¯ä¼ å€¼,ä¹Ÿå°±æ˜¯å€¼å¾—æ‹·è´</p>
</li>
<li><p>å¼•ç”¨æ•°æ®ç±»å‹åœ¨ä¼ é€’çš„æ—¶å€™æ˜¯ä¼ å€,ä¹Ÿå°±æ˜¯å†…å­˜åœ°å€çš„é“¾æ¥</p>
</li>
</ul>
<p>çŸ¥é“äº†ä»¥ä¸Šä¸¤ç‚¹çŸ¥è¯†,å°±èƒ½å¾ˆå¥½çš„å¤„ç†Pythonä¸­æ·±æµ…æ‹·è´çš„é—®é¢˜.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">###########ç¬¬ä¸€ç§æƒ…å†µ: ç›´æ¥èµ‹å€¼</span></span><br><span class="line">list_apple = [<span class="string">'iPhone'</span>, <span class="string">'iPad'</span>, [<span class="string">'iMac'</span>, <span class="string">'MacBook'</span>]]</span><br><span class="line">print(list_apple)</span><br><span class="line">list_apple_II = list_apple</span><br><span class="line">print(list_apple_II)</span><br><span class="line">list_apple[<span class="number">2</span>].append(<span class="string">'MacBookPro'</span>)</span><br><span class="line">print(list_apple, id(list_apple))</span><br><span class="line">print(list_apple_II, id(list_apple_II))</span><br><span class="line"></span><br><span class="line"><span class="comment">######è¿è¡Œç»“æœ</span></span><br><span class="line">[<span class="string">'iPhone'</span>, <span class="string">'iPad'</span>, [<span class="string">'iMac'</span>, <span class="string">'MacBook'</span>]]</span><br><span class="line">[<span class="string">'iPhone'</span>, <span class="string">'iPad'</span>, [<span class="string">'iMac'</span>, <span class="string">'MacBook'</span>]]</span><br><span class="line">[<span class="string">'iPhone'</span>, <span class="string">'iPad'</span>, [<span class="string">'iMac'</span>, <span class="string">'MacBook'</span>, <span class="string">'MacBookPro'</span>]] <span class="number">4315400520</span></span><br><span class="line">[<span class="string">'iPhone'</span>, <span class="string">'iPad'</span>, [<span class="string">'iMac'</span>, <span class="string">'MacBook'</span>, <span class="string">'MacBookPro'</span>]] <span class="number">4315400520</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#è¿™ç§æ–¹å¼,å¯ä»¥çœ‹åˆ°Iå’ŒIIä¸¤ä¸ªå˜é‡å…¶å®æŒ‡å‘äº†åŒä¸€ä¸ªå†…å­˜åœ°å€</span></span><br><span class="line"><span class="comment">#æ‰€ä»¥ä»»ä½•ä¸€ä¸ªå˜é‡å¯¹è¯¥åˆ—è¡¨è¿›è¡Œä¿®æ”¹,éƒ½ä¼šå½±å“æ‰€æœ‰å¼•ç”¨è¯¥å†…å­˜åœ°å€çš„å˜é‡</span></span><br><span class="line"><span class="comment">#æ³¨æ„:è¿™é‡Œè¯´çš„æ˜¯ä¿®æ”¹,ä¸æ˜¯é‡æ–°èµ‹å€¼,èµ‹å€¼çš„è¯ä¼šé‡æ–°æŒ‡å‘å¦ä¸€ä¸ªå†…å­˜åœ°å€</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">###########ç¬¬äºŒç§æƒ…å†µ: ä½¿ç”¨åˆ—è¡¨è‡ªå¸¦çš„copyæ–¹æ³•</span></span><br><span class="line">list_apple = [<span class="string">'iPhone'</span>, <span class="string">'iPad'</span>, [<span class="string">'iMac'</span>, <span class="string">'MacBook'</span>]]</span><br><span class="line">print(list_apple)</span><br><span class="line">list_apple_II = list_apple.copy()</span><br><span class="line">print(list_apple_II)</span><br><span class="line">list_apple[<span class="number">2</span>].append(<span class="string">'MacBookPro'</span>)</span><br><span class="line">print(list_apple, id(list_apple))</span><br><span class="line">print(list_apple_II, id(list_apple_II))</span><br><span class="line"></span><br><span class="line"><span class="comment">######è¿è¡Œç»“æœ</span></span><br><span class="line">[<span class="string">'iPhone'</span>, <span class="string">'iPad'</span>, [<span class="string">'iMac'</span>, <span class="string">'MacBook'</span>]]</span><br><span class="line">[<span class="string">'iPhone'</span>, <span class="string">'iPad'</span>, [<span class="string">'iMac'</span>, <span class="string">'MacBook'</span>]]</span><br><span class="line">[<span class="string">'iPhone'</span>, <span class="string">'iPad'</span>, [<span class="string">'iMac'</span>, <span class="string">'MacBook'</span>, <span class="string">'MacBookPro'</span>]] <span class="number">4315525384</span></span><br><span class="line">[<span class="string">'iPhone'</span>, <span class="string">'iPad'</span>, [<span class="string">'iMac'</span>, <span class="string">'MacBook'</span>, <span class="string">'MacBookPro'</span>]] <span class="number">4315525448</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#è™½ç„¶è·Ÿä¸Šé¢çš„è¿è¡Œç»“æœæ˜¯ä¸€æ ·çš„,ä½†æ˜¯IIå¾—å†…å­˜åœ°å€å˜äº†,è¯´æ˜åœ¨å†…å­˜ç©ºé—´ä¸­,åˆ›å»ºäº†æ–°çš„å†…å­˜æ¥ä¿å­˜æ•°æ®,è€Œå½“æˆ‘ä¿®æ”¹åµŒå¥—çš„åˆ—è¡¨ä¸­çš„å€¼æ—¶,åˆ—è¡¨IIåŒæ ·å¾—åˆ°äº†æ›´æ–°,è¿™å°±æ˜¯å› ä¸ºåµŒå¥—çš„åˆ—è¡¨æ˜¯å¼•ç”¨æ•°æ®ç±»å‹,åœ¨copyå®Œç¬¬ä¸€å±‚çš„åŸºæœ¬æ•°æ®ç±»å‹å,ç¬¬äºŒå±‚çš„æ•°æ®åªæ˜¯å¼•ç”¨äº†ä¸€ä¸ªå†…å­˜åœ°å€è€Œå·²,åªè¦å…¶ä»–å˜é‡å¯¹è¯¥å—å†…å­˜åšå‡ºä¿®æ”¹,åˆ—è¡¨IIçš„åµŒå¥—åˆ—è¡¨è¿˜æ˜¯ä¼šåŒæ­¥æ›´æ–°</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ç„¶åæˆ‘ä»¬åšå¦‚ä¸‹å¯¹æ¯”è¯•éªŒ</span></span><br><span class="line"><span class="comment">#ä¸Šé¢çš„ä¾‹å­å¯¹åˆ—è¡¨Iä¸­çš„åµŒå¥—åˆ—è¡¨(å¼•ç”¨æ•°æ®ç±»å‹)åšå‡ºäº†ä¿®æ”¹,å¾—åˆ°çš„ç»“è®ºæ˜¯åˆ—è¡¨IIä¸­åŒæ­¥å¾—åˆ°æ›´æ”¹</span></span><br><span class="line"><span class="comment">#é‚£ä¹ˆæ¥ä¸‹æ¥çš„ä¾‹å­,æˆ‘å°†å¯¹åˆ—è¡¨Iè¿›è¡Œä¿®æ”¹,æ·»åŠ ä¸€ä¸ªåŸºæœ¬æ•°æ®ç±»å‹çš„å…ƒç´ ,çœ‹çœ‹ä¼šæ˜¯ä»€ä¹ˆæ•ˆæœ</span></span><br><span class="line">list_apple.append(<span class="string">'iPod'</span>)</span><br><span class="line">print(list_apple, id(list_apple))</span><br><span class="line">print(list_apple_II, id(list_apple_II))</span><br><span class="line"></span><br><span class="line"><span class="comment">######è¿è¡Œç»“æœ</span></span><br><span class="line">[<span class="string">'iPhone'</span>, <span class="string">'iPad'</span>, [<span class="string">'iMac'</span>, <span class="string">'MacBook'</span>, <span class="string">'MacBookPro'</span>], <span class="string">'iPod'</span>] <span class="number">4315533576</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ç¥å¥‡çš„äº‹æƒ…å‘ç”Ÿäº†!æˆ‘å¯¹åˆ—è¡¨Iæ·»åŠ åŸºæœ¬æ•°æ®ç±»å‹çš„ä¿®æ”¹å¹¶æ²¡æœ‰å½±å“åˆ°åˆ—è¡¨II,åœ¨idå†…å­˜åœ°å€ä¹Ÿå¯ä»¥çœ‹å‡º,ä»–ä»¬åˆ†å±ä¸¤å—å†…å­˜</span></span><br><span class="line"><span class="comment">#ä½†æ˜¯ä¸Šé¢æˆ‘å¯¹åˆ—è¡¨Iä¸­çš„å¼•ç”¨æ•°æ®ç±»å‹(åˆ—è¡¨)è¿›è¡Œäº†æ·»åŠ åŸºæœ¬æ•°æ®ç±»å‹('MacBook')çš„æ“ä½œ,å°±ä¼šå½±å“åˆ°åˆ—è¡¨IIçš„ç»“æœ</span></span><br><span class="line"><span class="comment">#çœ‹æ˜ç™½äº†å—?</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">###########ç¬¬ä¸‰ç§æƒ…å†µ: ä½¿ç”¨copyæ¨¡å—è¿›è¡Œæµ…copy</span></span><br><span class="line"><span class="comment">#è¿™ç§æ–¹æ³•å’Œä½¿ç”¨åˆ—è¡¨æˆ–å­—å…¸å†…ç½®çš„copyæ–¹æ³•ä¸€æ ·,åªèƒ½copyå¤´å±‚çš„åŸºæœ¬æ•°æ®ç±»å‹</span></span><br><span class="line"><span class="keyword">import</span> copy</span><br><span class="line">list_apple = [<span class="string">'iPhone'</span>, <span class="string">'iPad'</span>, [<span class="string">'iMac'</span>, <span class="string">'MacBook'</span>]]</span><br><span class="line">print(list_apple)</span><br><span class="line">list_apple_II = copy.copy(list_apple)</span><br><span class="line">print(list_apple_II)</span><br><span class="line">list_apple[<span class="number">2</span>].append(<span class="string">'MacBookPro'</span>)</span><br><span class="line">print(list_apple, id(list_apple))</span><br><span class="line">print(list_apple_II, id(list_apple_II))</span><br><span class="line"></span><br><span class="line">list_apple.append(<span class="string">'iPod'</span>)</span><br><span class="line">print(list_apple, id(list_apple))</span><br><span class="line">print(list_apple_II, id(list_apple_II))</span><br><span class="line"></span><br><span class="line"><span class="comment">######è¿è¡Œç»“æœ</span></span><br><span class="line">[<span class="string">'iPhone'</span>, <span class="string">'iPad'</span>, [<span class="string">'iMac'</span>, <span class="string">'MacBook'</span>]]</span><br><span class="line">[<span class="string">'iPhone'</span>, <span class="string">'iPad'</span>, [<span class="string">'iMac'</span>, <span class="string">'MacBook'</span>]]</span><br><span class="line">[<span class="string">'iPhone'</span>, <span class="string">'iPad'</span>, [<span class="string">'iMac'</span>, <span class="string">'MacBook'</span>, <span class="string">'MacBookPro'</span>]] <span class="number">4314775176</span></span><br><span class="line">[<span class="string">'iPhone'</span>, <span class="string">'iPad'</span>, [<span class="string">'iMac'</span>, <span class="string">'MacBook'</span>, <span class="string">'MacBookPro'</span>]] <span class="number">4314393224</span></span><br><span class="line">[<span class="string">'iPhone'</span>, <span class="string">'iPad'</span>, [<span class="string">'iMac'</span>, <span class="string">'MacBook'</span>, <span class="string">'MacBookPro'</span>], <span class="string">'iPod'</span>] <span class="number">4314775176</span></span><br><span class="line">[<span class="string">'iPhone'</span>, <span class="string">'iPad'</span>, [<span class="string">'iMac'</span>, <span class="string">'MacBook'</span>, <span class="string">'MacBookPro'</span>]] <span class="number">4314393224</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å’Œlist.copy()çš„æ•ˆæœæ˜¯ä¸€æ ·çš„</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">###########ç¬¬å››ç§æƒ…å†µ: ä½¿ç”¨copyæ¨¡å—è¿›è¡Œæ·±copy</span></span><br><span class="line"><span class="comment">#æ·±copyçš„è¯,æ— è®ºæ˜¯åŸºæœ¬æ•°æ®ç±»å‹è¿˜æ˜¯å¼•ç”¨æ•°æ®ç±»å‹,éƒ½ä¼šç›¸åº”çš„copyä¸€ä»½å€¼è¿‡å»</span></span><br><span class="line"><span class="keyword">import</span> copy</span><br><span class="line">list_apple = [<span class="string">'iPhone'</span>, <span class="string">'iPad'</span>, [<span class="string">'iMac'</span>, <span class="string">'MacBook'</span>]]</span><br><span class="line">print(list_apple)</span><br><span class="line">list_apple_II = copy.deepcopy(list_apple)</span><br><span class="line">print(list_apple_II)</span><br><span class="line">list_apple[<span class="number">2</span>].append(<span class="string">'MacBookPro'</span>)</span><br><span class="line">print(list_apple, id(list_apple))</span><br><span class="line">print(list_apple_II, id(list_apple_II))</span><br><span class="line"></span><br><span class="line">list_apple.append(<span class="string">'iPod'</span>)</span><br><span class="line">print(list_apple, id(list_apple))</span><br><span class="line">print(list_apple_II, id(list_apple_II))</span><br><span class="line"></span><br><span class="line"><span class="comment">######è¿è¡Œç»“æœ</span></span><br><span class="line">[<span class="string">'iPhone'</span>, <span class="string">'iPad'</span>, [<span class="string">'iMac'</span>, <span class="string">'MacBook'</span>]]</span><br><span class="line">[<span class="string">'iPhone'</span>, <span class="string">'iPad'</span>, [<span class="string">'iMac'</span>, <span class="string">'MacBook'</span>]]</span><br><span class="line">[<span class="string">'iPhone'</span>, <span class="string">'iPad'</span>, [<span class="string">'iMac'</span>, <span class="string">'MacBook'</span>, <span class="string">'MacBookPro'</span>]] <span class="number">4315823688</span></span><br><span class="line">[<span class="string">'iPhone'</span>, <span class="string">'iPad'</span>, [<span class="string">'iMac'</span>, <span class="string">'MacBook'</span>]] <span class="number">4315823368</span></span><br><span class="line">[<span class="string">'iPhone'</span>, <span class="string">'iPad'</span>, [<span class="string">'iMac'</span>, <span class="string">'MacBook'</span>, <span class="string">'MacBookPro'</span>], <span class="string">'iPod'</span>] <span class="number">4315823688</span></span><br><span class="line">[<span class="string">'iPhone'</span>, <span class="string">'iPad'</span>, [<span class="string">'iMac'</span>, <span class="string">'MacBook'</span>]] <span class="number">4315823368</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#çœ‹å§!ä¸ç®¡æ˜¯å¯¹ç¬¬ä¸€å±‚ä¿®æ”¹,è¿˜æ˜¯å¯¹ç¬¬äºŒå±‚ä¿®æ”¹,éƒ½ä¸ä¼šå½±å“åˆ—è¡¨IIçš„å€¼</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ç»“è®º: ä¸Šé¢å–å†…å­˜åœ°å€åªå–äº†ç¬¬ä¸€å±‚çš„å†…å­˜åœ°å€,å…¶å®å¦‚æœå†åŠ ä¸ŠåµŒå¥—çš„å†…å­˜åœ°å€,å°±ä¼šæ›´æ¸…æ¥š,ç¬¬äºŒç¬¬ä¸‰ç§æƒ…å†µ,åµŒå¥—listçš„å†…å­˜åœ°å€æ˜¯ç›¸åŒçš„,è€Œç¬¬å››ç§æƒ…å†µåµŒå¥—listçš„å†…å­˜åœ°å€æ˜¯ä¸åŒçš„,æ‰€ä»¥ä¸ä¼šäº’ç›¸å½±å“</span></span><br></pre></td></tr></table></figure>

<hr>
<h1 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h1><p>å‡½æ•°ä½“ç°äº†é¢å‘å¯¹è±¡ç¼–ç¨‹è¯­è¨€å°è£…çš„ç‰¹æ€§,é¢å‘å¯¹è±¡è¯­è¨€çš„ç»ˆæç›®æ ‡å°±æ˜¯<code>æ¶ˆé™¤é‡å¤ä»£ç </code>,ä¸”ä½¿ç”¨äº†<code>å°è£…</code> <code>ç»§æ‰¿</code> <code>å¤šæ€</code> ä¸‰ç§ç‰¹æ€§å®ç°äº†è¿™ä¸€ä¼Ÿå¤§çš„ç›®æ ‡.ç°åœ¨æ‰€ä»‹ç»çš„å‡½æ•°,æ°æ°æ˜¯Pythonå°è£…ç‰¹æ€§çš„ä¸€ä¸ªå…¸å‹ä½“ç°(æœ‰äººäº‰è®ºPythonæœ‰æ²¡æœ‰å¤šæ€,æˆ‘è§‰å¾—è®¨è®ºè¿™ç‚¹å®Œå…¨æ²¡æœ‰æ„ä¹‰,å› ä¸ºPythonæœ¬èº«æ˜¯åŠ¨æ€è¯­è¨€,Pythonçš„æœ¬èº«å°±æ˜¯å¤šæ€,ä¸éœ€è¦åƒJava/C#é‚£æ ·æœ‰å¤šæ€çš„ç‰¹å®šè¯­æ³•,Pythonåœ¨æ­£å¸¸ä½¿ç”¨ä¸­,å°±æ˜¯å¤šæ€çš„!)</p>
<h2 id="å®šä¹‰å‡½æ•°çš„è¯­æ³•"><a href="#å®šä¹‰å‡½æ•°çš„è¯­æ³•" class="headerlink" title="å®šä¹‰å‡½æ•°çš„è¯­æ³•"></a>å®šä¹‰å‡½æ•°çš„è¯­æ³•</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> å‡½æ•°å<span class="params">(å‚æ•°)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    è¯´æ˜</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    å‡½æ•°ä½“</span><br><span class="line">    <span class="keyword">return</span> è¿”å›å€¼</span><br></pre></td></tr></table></figure>

<h3 id="è¿”å›å€¼"><a href="#è¿”å›å€¼" class="headerlink" title="è¿”å›å€¼"></a>è¿”å›å€¼</h3><ul>
<li><p>åœ¨å‡½æ•°æ‰§è¡Œå®Œæ¯•å,ä¼šè¿”å›ä¸€ä¸ªå€¼,è¿™å°±æ˜¯å‡½æ•°çš„è¿”å›å€¼.å¦‚æœæ²¡æœ‰æ‰‹åŠ¨å»æŒ‡å®šå‡½æ•°çš„è¿”å›å€¼,é‚£ä¹ˆPythonå°†è‡ªåŠ¨è¿”å›ä¸€ä¸ªNone</p>
</li>
<li><p>è¿”å›å€¼å¯ä»¥è¿”å›ä»»ä½•æ•°æ®ç±»å‹(æƒ³æƒ³å‰é¢æåˆ°çš„åŸºæœ¬æ•°æ®ç±»å‹å’Œå¼•ç”¨æ•°æ®ç±»å‹),ä½†æ˜¯åªèƒ½è¿”å›ä¸€æ¬¡ä¸”åªèƒ½æ˜¯ä¸€ä¸ªå…ƒç´ </p>
</li>
<li><p>è¿”å›çš„ä¸€ä¸ªå…ƒç´ ä¸­å¯ä»¥åŒ…å«å¤šä¸ªå…ƒç´ ,æ¯”å¦‚è¿”å›ä¸€ä¸ªåˆ—è¡¨</p>
</li>
</ul>
<h2 id="å‡½æ•°çš„å‚æ•°"><a href="#å‡½æ•°çš„å‚æ•°" class="headerlink" title="å‡½æ•°çš„å‚æ•°"></a>å‡½æ•°çš„å‚æ•°</h2><p>å‡½æ•°å¯ä»¥åˆ†ä¸ºå››ä¸ªä¸åŒçš„å‚æ•°</p>
<ul>
<li><p>æ™®é€šå‚æ•°(æŒ‰é»˜è®¤é¡ºåºèµ‹å€¼)</p>
</li>
<li><p>æŒ‡å®šå‚æ•°(æŒ‡å®šä¸ºæŸä¸€å‚æ•°èµ‹å€¼,å¯ä»¥ä¹±åº)</p>
</li>
<li><p>é»˜è®¤å‚æ•°(ä¸èµ‹å€¼æ—¶å¯ä»¥ä½¿ç”¨é»˜è®¤å€¼)</p>
</li>
<li><p>åŠ¨æ€å‚æ•°(æ¥æ”¶ä»»æ„å¤šçš„å‚æ•°)</p>
</li>
</ul>
<p>å‡½æ•°åœ¨æ¥æ”¶åˆ°å‚æ•°å,ä¼šè‡ªåŠ¨å°†å…¶ç»„æˆä¸€ä¸ª<code>å…ƒç»„</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fun_apple</span><span class="params">(prod)</span>:</span></span><br><span class="line">    print(prod)</span><br><span class="line"></span><br><span class="line"><span class="comment">#def: å‡½æ•°å…³é”®å­—</span></span><br><span class="line"><span class="comment">#fun_apple: å‡½æ•°å</span></span><br><span class="line"><span class="comment">#prod: å‡½æ•°appleçš„å½¢å¼å‚æ•°,ç®€ç§°å½¢å‚</span></span><br><span class="line"></span><br><span class="line">fun_apple(<span class="string">'iPhone'</span>)</span><br><span class="line"><span class="comment">#iPhone: fun_appleçš„å®é™…å‚æ•°,ç®€ç§°å®å‚</span></span><br></pre></td></tr></table></figure>

<h3 id="æ™®é€šå‚æ•°"><a href="#æ™®é€šå‚æ•°" class="headerlink" title="æ™®é€šå‚æ•°"></a>æ™®é€šå‚æ•°</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fun_apple</span><span class="params">(prod)</span>:</span></span><br><span class="line">    print(prod)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fun_apple_II</span><span class="params">(prod, num)</span>:</span></span><br><span class="line">    print(prod, num)</span><br><span class="line"></span><br><span class="line">fun_apple(<span class="string">'iPhone'</span>)</span><br><span class="line">fun_apple_II(<span class="string">'iPhone'</span>, <span class="number">59</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">######è¿è¡Œç»“æœ</span></span><br><span class="line">iPhone</span><br><span class="line">iPhone <span class="number">59</span></span><br></pre></td></tr></table></figure>

<h3 id="æŒ‡å®šå‚æ•°"><a href="#æŒ‡å®šå‚æ•°" class="headerlink" title="æŒ‡å®šå‚æ•°"></a>æŒ‡å®šå‚æ•°</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fun_apple_II</span><span class="params">(prod, num)</span>:</span></span><br><span class="line">    print(prod, num)</span><br><span class="line"></span><br><span class="line">fun_apple_II(num=<span class="number">59</span>, prod=<span class="string">'iPhone'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">######è¿è¡Œç»“æœ</span></span><br><span class="line">iPhone <span class="number">59</span></span><br></pre></td></tr></table></figure>

<h3 id="é»˜è®¤å‚æ•°"><a href="#é»˜è®¤å‚æ•°" class="headerlink" title="é»˜è®¤å‚æ•°"></a>é»˜è®¤å‚æ•°</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fun_apple_II</span><span class="params">(prod, num=<span class="number">59</span>)</span>:</span></span><br><span class="line">    print(prod, num)</span><br><span class="line"></span><br><span class="line">fun_apple_II(<span class="string">'iPhone'</span>)</span><br><span class="line">fun_apple_II(<span class="string">'iPhone'</span>, <span class="number">15</span>)</span><br><span class="line">fun_apple_II(<span class="string">'iPhone'</span>, num= <span class="number">1559</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">######è¿è¡Œç»“æœ</span></span><br><span class="line">iPhone <span class="number">59</span></span><br><span class="line">iPhone <span class="number">15</span></span><br><span class="line">iPhone <span class="number">1559</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ²¡æœ‰é»˜è®¤å€¼çš„æƒ…å†µä¸‹,å¦‚æœè°ƒç”¨è¯¥å‡½æ•°æ²¡æœ‰ä¸ºå…¶èµ‹å€¼ä¼šæŠ¥é”™</span></span><br></pre></td></tr></table></figure>

<h3 id="åŠ¨æ€å‚æ•°"><a href="#åŠ¨æ€å‚æ•°" class="headerlink" title="åŠ¨æ€å‚æ•°"></a>åŠ¨æ€å‚æ•°</h3><p>åŠ¨æ€å‚æ•°,é¡¾åè¯ä¹‰,å¯ä»¥åŠ¨æ€çš„ç»“æœä»»æ„ä¸ªå‚æ•°,åˆ†ä¸¤ç§æƒ…å†µ,ä¸€ç§æ˜¯<code>é”®å€¼å¯¹</code>,ä¸€ç§æ˜¯<code>éé”®å€¼å¯¹</code>â€¦â€¦ ^_^</p>
<h4 id="éé”®å€¼å¯¹"><a href="#éé”®å€¼å¯¹" class="headerlink" title="éé”®å€¼å¯¹ *"></a>éé”®å€¼å¯¹ *</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#è¯­æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(*args)</span>:</span></span><br><span class="line">    print(args)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(*args)</span>:</span></span><br><span class="line">    print(args)</span><br><span class="line"></span><br><span class="line">li = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line">func(li)</span><br><span class="line">func(*li)</span><br><span class="line"></span><br><span class="line"><span class="comment">######è¿è¡Œç»“æœ</span></span><br><span class="line">([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>],)</span><br><span class="line">(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#è§£é‡Šå¦‚ä¸‹:</span></span><br><span class="line"><span class="comment">#li: æ˜¯ä¸€ä¸ªåˆ—è¡¨</span></span><br><span class="line"><span class="comment">#func(li): è¿™ç§ä¼ å‚æ–¹å¼,æ˜¯å°†åˆ—è¡¨liä½œä¸ºä¸€ä¸ªå…ƒç´ ä¼ å…¥å‡½æ•°ä¸­,é€šè¿‡ç»“æœå¯ä»¥çœ‹å‡º,liåªæ˜¯å‚æ•°å…ƒç»„ä¸­çš„ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line"><span class="comment">#func(*li): åœ¨åˆ—è¡¨çš„å‰é¢åŠ å…¥ä¸€ä¸ª*å·,ä½¿ç”¨è¿™ç§æ–¹å¼ä¼ å‚,æ„æ€æ˜¯å°†åˆ—è¡¨liä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ å½“åšä¸€ä¸ªå€¼ä¼ é€’åˆ°å‡½æ•°ä¸­,å†…éƒ¨ç›¸å½“äºåšäº†forå¾ªç¯çš„æ“ä½œ</span></span><br></pre></td></tr></table></figure>

<h4 id="é”®å€¼å¯¹"><a href="#é”®å€¼å¯¹" class="headerlink" title="é”®å€¼å¯¹ **"></a>é”®å€¼å¯¹ **</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#è¯­æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(**kwargs)</span>:</span></span><br><span class="line">    print(kwargs)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(**kwargs)</span>:</span></span><br><span class="line">    print(kwargs)</span><br><span class="line"></span><br><span class="line">di = &#123;<span class="string">'name'</span>: <span class="string">'polarsnow'</span>, <span class="string">'age'</span>: <span class="number">25</span>&#125;</span><br><span class="line">func(di)</span><br><span class="line"></span><br><span class="line"><span class="comment">######è¿è¡Œç»“æœ</span></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"/Users/lvrui/PycharmProjects/untitled/3/code/test.py"</span>, line <span class="number">202</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    func(di)</span><br><span class="line">TypeError: func() takes <span class="number">0</span> positional arguments but <span class="number">1</span> was given</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¸Šé¢æåˆ°è¿‡äº†,è¿™é‡Œåªæ¥æ”¶é”®å€¼å¯¹çš„å€¼,è™½ç„¶diæ˜¯ä¸ªå­—å…¸,ä½†æ˜¯è¿™æ ·æ•´ä¸ªä¼ å…¥çš„è¯,ä¼šè¢«å‡½æ•°å½“åšä¸€ä¸ªå…ƒç´ æ¥å¤„ç†,å½“ç„¶ä¼šæŠ¥é”™!</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(**kwargs)</span>:</span></span><br><span class="line">    print(kwargs)</span><br><span class="line"></span><br><span class="line">di = &#123;<span class="string">'name'</span>: <span class="string">'polarsnow'</span>, <span class="string">'age'</span>: <span class="number">25</span>&#125;</span><br><span class="line">func(**di)</span><br><span class="line"></span><br><span class="line"><span class="comment">######è¿è¡Œç»“æœ</span></span><br><span class="line">&#123;<span class="string">'name'</span>: <span class="string">'polarsnow'</span>, <span class="string">'age'</span>: <span class="number">25</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#åªéœ€åœ¨å­—å…¸diå‰é¢åŠ ä¸Š**ç¬¦å·å³å¯,æ„æ€æ˜¯å°†diå­—å…¸ä¸­çš„æ¯ä¸€å¯¹å„¿é”®å€¼å¯¹å–å‡ºåå½“åšå‚æ•°ä¼ å…¥åˆ°å‡½æ•°ä¸­</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(**kwargs)</span>:</span></span><br><span class="line">    print(kwargs)</span><br><span class="line"></span><br><span class="line">func(name=<span class="string">'polarsnow'</span>, age=<span class="number">25</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">######è¿è¡Œç»“æœ</span></span><br><span class="line">&#123;<span class="string">'age'</span>: <span class="number">25</span>, <span class="string">'name'</span>: <span class="string">'polarsnow'</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç›´æ¥å†™æˆè¿™ç§é”®å€¼å¯¹çš„æ–¹å¼ä¹Ÿæ˜¯å¯ä»¥çš„</span></span><br></pre></td></tr></table></figure>

<h3 id="ä¸‡èƒ½å‚æ•°"><a href="#ä¸‡èƒ½å‚æ•°" class="headerlink" title="ä¸‡èƒ½å‚æ•°"></a>ä¸‡èƒ½å‚æ•°</h3><p>ä¸Šé¢æåˆ°çš„åŠ¨æ€å‚æ•°ä¸­</p>
<ul>
<li><p>ä¸€ä¸ªæ˜Ÿ<code>*</code>çš„åªèƒ½æ¥æ”¶éé”®å€¼å¯¹çš„ä»»æ„å¤šä¸ªå‚æ•°</p>
</li>
<li><p>ä¸¤ä¸ªæ˜Ÿ<code>**</code>çš„åªèƒ½æ¥æ”¶é”®å€¼å¯¹çš„ä»»æ„å¤šä¸ªå‚æ•°</p>
</li>
</ul>
<p>ä¸¤è€…ç»“åˆåˆ°ä¸€èµ·å°±å¯ä»¥æ¥æ”¶ä»»æ„ç±»å‹çš„ä»»æ„å¤šä¸ªå‚æ•°å•¦</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">    print(args)</span><br><span class="line">    print(kwargs)</span><br></pre></td></tr></table></figure>

<h2 id="å•è¡Œå‡½æ•°"><a href="#å•è¡Œå‡½æ•°" class="headerlink" title="å•è¡Œå‡½æ•°"></a>å•è¡Œå‡½æ•°</h2><p>åœ¨Pythonçš„é¡¹ç›®ä¸­,å¯èƒ½ä¼šé‡åˆ°lambdaçš„å­—çœ¼,lambdaå°±æ˜¯å•è¡Œå‡½æ•°çš„å…³é”®å­—</p>
<p>å•è¡Œå‡½æ•°ç”¨æ¥è§£å†³ç®€å•çš„å‡½æ•°è¿ç®—,ä¾‹å¦‚ä¸€ä¸ªå‡½æ•°ä¸­åªæœ‰ä¸€è¡Œä»£ç å°±è¿”å›äº†çš„æƒ…å†µ</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f1</span><span class="params">(a1)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> a1 + <span class="number">100</span></span><br><span class="line"></span><br><span class="line">print(f1(<span class="number">59</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">######è¿è¡Œç»“æœ</span></span><br><span class="line"><span class="number">159</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#å•è¡Œå‡½æ•°å®ç°</span></span><br><span class="line">f2 = <span class="keyword">lambda</span> a2: a2 + <span class="number">100</span></span><br><span class="line"></span><br><span class="line">print(f2(<span class="number">59</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">######è¿è¡Œç»“æœ</span></span><br><span class="line"><span class="number">159</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#è§£é‡Š:</span></span><br><span class="line">f1 &lt;--- å‡½æ•°å ---&gt; f2</span><br><span class="line">a1 &lt;--- å‚æ•° ---&gt; a2</span><br><span class="line">a1 + 100 &lt;--- å‡½æ•°ä½“ ---&gt; a2 + 100</span><br><span class="line">return &lt;--- è¿”å›å€¼ ---&gt; é»˜è®¤è¿”å›</span><br></pre></td></tr></table></figure>

<p><em>æ³¨æ„: åœ¨Python PEP8 è§„åˆ™ä¸­æœ‰æ˜æ–‡è§„å®š(do not assign a lambda expression, use def) æ„æ€æ˜¯ä¸è¦ä½¿ç”¨lambdaè¡¨è¾¾å¼,æ¨è ä½¿ç”¨def. Pythonè¯­è¨€ä¸€å‘ä»¥é«˜é˜…è¯»æ€§è‘—ç§°,ä½¿ç”¨lambdaè¿èƒŒäº†ç®€å•æ˜“æ‡‚çš„é«˜é˜…è¯»æ€§åŸåˆ™</em></p>
<h2 id="å˜é‡ä½œç”¨åŸŸ"><a href="#å˜é‡ä½œç”¨åŸŸ" class="headerlink" title="å˜é‡ä½œç”¨åŸŸ"></a>å˜é‡ä½œç”¨åŸŸ</h2><p>æ¯ä¸ªå˜é‡éƒ½æœ‰å…¶ä½œç”¨èŒƒå›´,è¿™ç§ç‰¹æ€§è¢«ç§°ä¹‹ä¸ºå˜é‡ä½œç”¨åŸŸ,åœ¨æœ¬é˜¶æ®µ,åªä»‹ç»åœ¨ä¸€ä¸ªæ¨¡å—ä¸­,å˜é‡çš„ä½œç”¨èŒƒå›´</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#å‡½æ•°ä¸­å¯ä»¥è®¿é—®å…¨å±€å˜é‡</span></span><br><span class="line">str_var = <span class="string">'PolarSnow'</span></span><br><span class="line">list_var = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">()</span>:</span></span><br><span class="line">    print(str_var)</span><br><span class="line">    print(list_var)</span><br><span class="line"></span><br><span class="line">func()</span><br><span class="line"></span><br><span class="line"><span class="comment">######è¿è¡Œç»“æœ</span></span><br><span class="line">PolarSnow</span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">str_var = <span class="string">'PolarSnow'</span></span><br><span class="line">list_var = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">()</span>:</span></span><br><span class="line">    str_var = <span class="string">'Larry'</span></span><br><span class="line">    print(str_var)</span><br><span class="line"></span><br><span class="line">func()</span><br><span class="line">print(str_var)</span><br><span class="line"></span><br><span class="line"><span class="comment">######è¿è¡Œç»“æœ</span></span><br><span class="line">Larry</span><br><span class="line">PolarSnow</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç»“è®º: å‡½æ•°å†…å¯ä»¥è®¿é—®å…¨å±€å˜é‡,ä½†æ˜¯å¯¹äºåŸºæœ¬æ•°æ®ç±»å‹çš„å˜é‡åªèƒ½è¯»å–ä¸èƒ½é‡æ–°èµ‹å€¼(ä¿®æ”¹)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">str_var = <span class="string">'PolarSnow'</span></span><br><span class="line">list_var = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">()</span>:</span></span><br><span class="line">    list_var.append(<span class="number">4</span>)</span><br><span class="line">    print(list_var)</span><br><span class="line"></span><br><span class="line">func()</span><br><span class="line">print(list_var)</span><br><span class="line"></span><br><span class="line"><span class="comment">######è¿è¡Œç»“æœ</span></span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">str_var = <span class="string">'PolarSnow'</span></span><br><span class="line">list_var = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">()</span>:</span></span><br><span class="line">    list_var = [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]</span><br><span class="line">    print(list_var)</span><br><span class="line"></span><br><span class="line">func()</span><br><span class="line">print(list_var)</span><br><span class="line"></span><br><span class="line"><span class="comment">######è¿è¡Œç»“æœ</span></span><br><span class="line">[<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]</span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç»“è®º: å‡½æ•°å†…å¯ä»¥è®¿é—®å…¨å±€å˜é‡,ä¹Ÿå¯ä»¥å¯¹å¼•ç”¨æ•°æ®ç±»å‹çš„å…¨å±€å˜é‡åšä¿®æ”¹,ä½†ä¸èƒ½é‡æ–°èµ‹å€¼</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#å¦‚æœæƒ³åœ¨å‡½æ•°å†…å¯¹å…¨å±€å˜é‡é‡æ–°èµ‹å€¼,éœ€è¦åŠ ä¸Šglobalå…³é”®å­—å£°æ˜</span></span><br><span class="line">str_var = <span class="string">'PolarSnow'</span></span><br><span class="line">list_var = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">global</span> str_var</span><br><span class="line">    str_var = <span class="string">'Larry'</span></span><br><span class="line">    print(str_var)</span><br><span class="line"></span><br><span class="line">func()</span><br><span class="line">print(str_var)</span><br><span class="line"></span><br><span class="line"><span class="comment">######è¿è¡Œç»“æœ</span></span><br><span class="line">Larry</span><br><span class="line">Larry</span><br></pre></td></tr></table></figure>

<h2 id="å†…ç½®å‡½æ•°-buildins"><a href="#å†…ç½®å‡½æ•°-buildins" class="headerlink" title="å†…ç½®å‡½æ•°(buildins)"></a>å†…ç½®å‡½æ•°(buildins)</h2><ul>
<li>abs å–ç»å¯¹å€¼</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(abs(<span class="number">-59</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">######è¿è¡Œç»“æœ</span></span><br><span class="line"><span class="number">59</span></span><br></pre></td></tr></table></figure>

<h3 id="all-æ‰€æœ‰å…ƒç´ ä¸ºTrueå°±è¿”å›True"><a href="#all-æ‰€æœ‰å…ƒç´ ä¸ºTrueå°±è¿”å›True" class="headerlink" title="all æ‰€æœ‰å…ƒç´ ä¸ºTrueå°±è¿”å›True"></a>all æ‰€æœ‰å…ƒç´ ä¸ºTrueå°±è¿”å›True</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">li_I = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">0</span>]</span><br><span class="line">li_II = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">print(all(li_I))</span><br><span class="line">print(all(li_II))</span><br><span class="line"></span><br><span class="line"><span class="comment">######è¿è¡Œç»“æœ</span></span><br><span class="line"><span class="literal">False</span></span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure>

<p><em>Falseå€¼: 0 â€˜â€™ {} [] () False None</em></p>
<h3 id="any-ä»»ä¸€å…ƒç´ ä¸ºTrueå°±è¿”å›True"><a href="#any-ä»»ä¸€å…ƒç´ ä¸ºTrueå°±è¿”å›True" class="headerlink" title="any ä»»ä¸€å…ƒç´ ä¸ºTrueå°±è¿”å›True"></a>any ä»»ä¸€å…ƒç´ ä¸ºTrueå°±è¿”å›True</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">li_I = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">0</span>]</span><br><span class="line">li_II = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">print(any(li_I))</span><br><span class="line">print(any(li_II))</span><br><span class="line"></span><br><span class="line"><span class="comment">######è¿è¡Œç»“æœ</span></span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure>

<h3 id="ascii-è‡ªåŠ¨æ‰§è¡Œå¯¹è±¡çš„-repr-æ–¹æ³•"><a href="#ascii-è‡ªåŠ¨æ‰§è¡Œå¯¹è±¡çš„-repr-æ–¹æ³•" class="headerlink" title="ascii è‡ªåŠ¨æ‰§è¡Œå¯¹è±¡çš„__repr__æ–¹æ³•"></a>ascii è‡ªåŠ¨æ‰§è¡Œå¯¹è±¡çš„<code>__repr__</code>æ–¹æ³•</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">c</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'repr'</span></span><br><span class="line"></span><br><span class="line">print(ascii(c()))</span><br><span class="line"></span><br><span class="line"><span class="comment">######è¿è¡Œç»“æœ</span></span><br><span class="line">repr</span><br></pre></td></tr></table></figure>

<h3 id="bin-æ¥æ”¶ä¸€ä¸ªåè¿›åˆ¶-è¿”å›äºŒè¿›åˆ¶-0b"><a href="#bin-æ¥æ”¶ä¸€ä¸ªåè¿›åˆ¶-è¿”å›äºŒè¿›åˆ¶-0b" class="headerlink" title="bin æ¥æ”¶ä¸€ä¸ªåè¿›åˆ¶,è¿”å›äºŒè¿›åˆ¶ 0b"></a>bin æ¥æ”¶ä¸€ä¸ªåè¿›åˆ¶,è¿”å›äºŒè¿›åˆ¶ 0b</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(bin(<span class="number">59</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">######è¿è¡Œç»“æœ</span></span><br><span class="line"><span class="number">0b111011</span></span><br></pre></td></tr></table></figure>

<h3 id="oct-æ¥æ”¶ä¸€ä¸ªåè¿›åˆ¶-è¿”å›å…«è¿›åˆ¶-0o"><a href="#oct-æ¥æ”¶ä¸€ä¸ªåè¿›åˆ¶-è¿”å›å…«è¿›åˆ¶-0o" class="headerlink" title="oct æ¥æ”¶ä¸€ä¸ªåè¿›åˆ¶,è¿”å›å…«è¿›åˆ¶ 0o"></a>oct æ¥æ”¶ä¸€ä¸ªåè¿›åˆ¶,è¿”å›å…«è¿›åˆ¶ 0o</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(oct(<span class="number">59</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">######è¿è¡Œç»“æœ</span></span><br><span class="line"><span class="number">0o73</span></span><br></pre></td></tr></table></figure>

<h3 id="hex-æ¥æ”¶ä¸€ä¸ªåè¿›åˆ¶-è¿”å›åå…­è¿›åˆ¶-0x"><a href="#hex-æ¥æ”¶ä¸€ä¸ªåè¿›åˆ¶-è¿”å›åå…­è¿›åˆ¶-0x" class="headerlink" title="hex æ¥æ”¶ä¸€ä¸ªåè¿›åˆ¶,è¿”å›åå…­è¿›åˆ¶ 0x"></a>hex æ¥æ”¶ä¸€ä¸ªåè¿›åˆ¶,è¿”å›åå…­è¿›åˆ¶ 0x</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(hex(<span class="number">59</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">######è¿è¡Œç»“æœ</span></span><br><span class="line"><span class="number">0x3b</span></span><br></pre></td></tr></table></figure>

<h3 id="bool-åˆ¤æ–­å…ƒç´ çœŸå‡"><a href="#bool-åˆ¤æ–­å…ƒç´ çœŸå‡" class="headerlink" title="bool åˆ¤æ–­å…ƒç´ çœŸå‡"></a>bool åˆ¤æ–­å…ƒç´ çœŸå‡</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(bool(<span class="string">'t'</span>))</span><br><span class="line">print(bool(<span class="number">2</span> &gt; <span class="number">3</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">######è¿è¡Œç»“æœ</span></span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="literal">False</span></span><br></pre></td></tr></table></figure>

<h3 id="bytes-å­—ç¬¦ä¸²è½¬æˆå­—èŠ‚ç±»å‹"><a href="#bytes-å­—ç¬¦ä¸²è½¬æˆå­—èŠ‚ç±»å‹" class="headerlink" title="bytes å­—ç¬¦ä¸²è½¬æˆå­—èŠ‚ç±»å‹"></a>bytes å­—ç¬¦ä¸²è½¬æˆå­—èŠ‚ç±»å‹</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(bytes(<span class="string">'æåœ°ç‘é›ª'</span>, encoding=<span class="string">'utf-8'</span>))</span><br><span class="line">print(bytes(<span class="string">'æåœ°ç‘é›ª'</span>, encoding=<span class="string">'gbk'</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">######è¿è¡Œç»“æœ</span></span><br><span class="line"><span class="string">b'\xe6\x9e\x81\xe5\x9c\xb0\xe7\x91\x9e\xe9\x9b\xaa'</span></span><br><span class="line"><span class="string">b'\xbc\xab\xb5\xd8\xc8\xf0\xd1\xa9'</span></span><br></pre></td></tr></table></figure>

<p>ä¸€ä¸ªæ±‰å­—ä½¿ç”¨utf-8ç¼–ç çš„è¯å ç”¨ä¸‰ä¸ªå­—èŠ‚,ä½¿ç”¨gbkç¼–ç çš„è¯å ç”¨ä¸¤ä¸ªå­—èŠ‚</p>
<p>æ‰“å¼€æ–‡ä»¶ä¹±ç å®å†µå†ç°:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">u = bytes(<span class="string">'å•ç‘'</span>, encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">s = str(u, encoding=<span class="string">'gbk'</span>)</span><br><span class="line">print(s)</span><br><span class="line"></span><br><span class="line"><span class="comment">######è¿è¡Œç»“æœ</span></span><br><span class="line">éšæ› æ†º</span><br></pre></td></tr></table></figure>

<p><strong>å¦‚æœä¸€ä¸ªæ–‡ä»¶æ˜¯ä»¥utf-8çš„ç¼–ç æ–¹å¼ä¿å­˜,æ¯ä¸‰ä¸ªå­—èŠ‚æ˜¯ä¸€ä¸ªæ±‰å­—,å†åŒæ ·ä»¥utf-8çš„æ–¹å¼è¯»å–,ä¼šæ­£ç¡®çš„æŒ‰ç…§3ä¸ªå­—èŠ‚ä¸€ä¸ªæ±‰å­—å»è¯»å–æ–‡ä»¶,è€Œå¦‚æœä»¥gbkçš„æ–¹å¼è¯»å–æ–‡ä»¶,ä¼šæŒ‰ç…§ä¸¤ä¸ªå­—èŠ‚ä¸€ä¸ªæ±‰å­—çš„æ–¹å¼è¯»å–,æ‰€ä»¥ä¼šäº§ç”Ÿä¹±ç çš„æƒ…å†µ</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">                        æåœ°ç‘é›ª(UTF-8)</span><br><span class="line">äºŒè¿›åˆ¶:    11100110 10011110 10000001 11100101 10011100 10110000 11100111 10010001 10011110 11101001 10011011 10101010</span><br><span class="line">åè¿›åˆ¶:    230 158 129 229 156 176 231 145 158 233 155 170</span><br><span class="line">åå…­è¿›åˆ¶:   e6 9e 81 e5 9c b0 e7 91 9e e9 9b aa</span><br><span class="line"></span><br><span class="line">æ³¨æ„ï¼šäºŒè¿›åˆ¶çš„è¡¨ç°å½¢å¼ä¸ºå­—èŠ‚</span><br></pre></td></tr></table></figure>

<p>ç”¨é¦™æ¥è¡¨ç¤ºç²¾ç¡®æ•°å­—çš„å°æ•…äº‹(äºŒè¿›åˆ¶è½¬åè¿›åˆ¶)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ä¸€æ”¯é¦™æœ‰ä¸¤ç§çŠ¶æ€,ç‚¹ç‡ƒçš„æƒ…å†µå’Œç†„ç­çš„æƒ…å†µ</span><br><span class="line">ç°åœ¨å®šä¹‰:é¦™ç†„ç­[I]çš„çŠ¶æ€è¡¨ç¤º0,ç‚¹ç‡ƒ[i]çš„æƒ…å†µè¡¨ç¤ºä¸º1</span><br><span class="line">0:  é‚£ä¹ˆæˆ‘ç°åœ¨è¦è¡¨ç¤º0,å¾ˆç®€å•,ä¸€æ”¯é¦™è¶³å¤Ÿ,ç†„ç­å°±è¡Œäº†--[I]</span><br><span class="line">                                               0</span><br><span class="line">1:  ä¸€æ”¯é¦™è¶³å¤Ÿ,ç‚¹ç‡ƒå³å¯--[i]</span><br><span class="line">                       1</span><br><span class="line">2:  ä¸€æ”¯é¦™æœ€å¤šåªèƒ½è¡¨ç¤ºåˆ°1,å¦‚æœè¦è¡¨ç¤º2,éœ€è¦åœ¨å‰é¢åŠ ä¸€æ”¯é¦™æ¥è¡¨ç¤º2,è¿™æ ·æˆ‘åªéœ€ç‚¹ç‡ƒå¤´ä¸€æ”¯é¦™å³å¯è¡¨ç¤º2--[iI]</span><br><span class="line">                                                                                      10</span><br><span class="line">3: ä¸¤æ”¯é¦™çš„è¯,ç¬¬ä¸€æ”¯è¡¨ç¤º2,ç¬¬ä¸€æ”¯æœ€å¤šè¡¨ç¤º1,åªéœ€å°†ç¬¬äºŒæ”¯ç‚¹ç‡ƒå³å¯è¡¨ç¤º3--[ii]</span><br><span class="line">                                                              11</span><br><span class="line">4: ä¸¤æ”¯é¦™æœ€å¤§å¯è¡¨ç¤ºåˆ°3,ç°åœ¨éœ€è¦åŠ ç¬¬ä¸‰æ”¯é¦™æ¥è¡¨ç¤º4--[iII]</span><br><span class="line">                                             100</span><br><span class="line">5: ä»¥æ­¤ç±»æ¨--[iIi]</span><br><span class="line">             101</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">å…³ç³»å›¾:</span><br><span class="line">        æœ€å¤§è¡¨ç¤º:1</span><br><span class="line">0:             [I]</span><br><span class="line">           çŠ¶æ€:0</span><br><span class="line">-------------------</span><br><span class="line">        æœ€å¤§è¡¨ç¤º:1</span><br><span class="line">1:             [i]</span><br><span class="line">           çŠ¶æ€:1</span><br><span class="line">-------------------</span><br><span class="line">        æœ€å¤§è¡¨ç¤º:2 1</span><br><span class="line">2:             [i I]</span><br><span class="line">           çŠ¶æ€:1 0</span><br><span class="line">-------------------</span><br><span class="line">        æœ€å¤§è¡¨ç¤º:2 1</span><br><span class="line">3:             [i i]</span><br><span class="line">           çŠ¶æ€:1 1</span><br><span class="line">-------------------</span><br><span class="line">        æœ€å¤§è¡¨ç¤º:4 2 1</span><br><span class="line">4:             [i I I]</span><br><span class="line">           çŠ¶æ€:1 0 0</span><br><span class="line">-------------------</span><br><span class="line">        æœ€å¤§è¡¨ç¤º:4 2 1</span><br><span class="line">5:             [i I i]</span><br><span class="line">           çŠ¶æ€:1 0 1</span><br><span class="line">-------------------</span><br><span class="line">        æœ€å¤§è¡¨ç¤º:4 2 1</span><br><span class="line">6:             [i i I]</span><br><span class="line">           çŠ¶æ€:1 1 0</span><br><span class="line">-------------------</span><br><span class="line">        æœ€å¤§è¡¨ç¤º:4 2 1</span><br><span class="line">7:             [i i i]</span><br><span class="line">           çŠ¶æ€:1 1 1</span><br><span class="line">-------------------</span><br><span class="line">        æœ€å¤§è¡¨ç¤º:8 4 2 1</span><br><span class="line">8:             [i I I I]</span><br><span class="line">           çŠ¶æ€:1 0 0 0</span><br><span class="line">-------------------</span><br><span class="line">        æœ€å¤§è¡¨ç¤º:8 4 2 1</span><br><span class="line">9:             [i I I i]</span><br><span class="line">           çŠ¶æ€:1 0 0 1</span><br><span class="line">-------------------</span><br><span class="line">        æœ€å¤§è¡¨ç¤º:8 4 2 1</span><br><span class="line">10:            [i I i I]</span><br><span class="line">           çŠ¶æ€:1 0 1 0</span><br><span class="line">-------------------</span><br><span class="line">        æœ€å¤§è¡¨ç¤º:8 4 2 1</span><br><span class="line">11:            [i I i i]</span><br><span class="line">           çŠ¶æ€:1 0 1 1</span><br><span class="line">-------------------</span><br><span class="line">        æœ€å¤§è¡¨ç¤º:8 4 2 1</span><br><span class="line">12:            [i i I I]</span><br><span class="line">           çŠ¶æ€:1 1 0 0</span><br><span class="line">-------------------</span><br><span class="line">        æœ€å¤§è¡¨ç¤º:8 4 2 1</span><br><span class="line">13:            [i i I i]</span><br><span class="line">           çŠ¶æ€:1 1 0 1</span><br><span class="line">-------------------</span><br><span class="line">        æœ€å¤§è¡¨ç¤º:8 4 2 1</span><br><span class="line">14:            [i i i I]</span><br><span class="line">           çŠ¶æ€:1 1 1 0</span><br><span class="line">-------------------</span><br><span class="line">        æœ€å¤§è¡¨ç¤º:8 4 2 1</span><br><span class="line">15:            [i i i i]</span><br><span class="line">           çŠ¶æ€:1 1 1 1</span><br><span class="line">-------------------</span><br><span class="line">        æœ€å¤§è¡¨ç¤º:16 8 4 2 1</span><br><span class="line">16:             [i I I I I]</span><br><span class="line">            çŠ¶æ€:1 0 0 0 0</span><br><span class="line">-------------------</span><br><span class="line">â€¦â€¦ä»¥æ­¤ç±»æ¨</span><br><span class="line">ä»2å¼€å§‹,æ¯ç¿»ä¸€ç•ªå°±å¤šä¸€æ”¯é¦™æ¥è¡¨ç¤º</span><br><span class="line">4(2æ”¯),8(3æ”¯),16(4æ”¯)éƒ½å¢åŠ äº†ä¸€æ”¯é¦™ç±»è¡¨ç¤º</span><br><span class="line">32(5æ”¯),64(6æ”¯),128(7æ”¯),256(8æ”¯),512(9æ”¯),1024(10æ”¯)</span><br><span class="line">ä¹Ÿå¯ä»¥æŠŠ&quot;æ”¯&quot;æ¢æˆ&quot;2çš„xæ¬¡æ–¹&quot;--&gt; 2çš„10æ¬¡æ–¹&#x3D;1024</span><br></pre></td></tr></table></figure>

<h3 id="str-å­—èŠ‚è½¬æˆå­—ç¬¦ä¸²"><a href="#str-å­—èŠ‚è½¬æˆå­—ç¬¦ä¸²" class="headerlink" title="str å­—èŠ‚è½¬æˆå­—ç¬¦ä¸²"></a>str å­—èŠ‚è½¬æˆå­—ç¬¦ä¸²</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">u = bytes(<span class="string">'æåœ°ç‘é›ª'</span>, encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">s = str(u, encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">print(s)</span><br><span class="line"></span><br><span class="line"><span class="comment">######è¿è¡Œç»“æœ</span></span><br><span class="line">æåœ°ç‘é›ª</span><br></pre></td></tr></table></figure>

<h3 id="open-æ‰“å¼€æ–‡ä»¶"><a href="#open-æ‰“å¼€æ–‡ä»¶" class="headerlink" title="open æ‰“å¼€æ–‡ä»¶"></a>open æ‰“å¼€æ–‡ä»¶</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#ä½¿ç”¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨æ¥æ‰“å¼€æ–‡ä»¶</span><br><span class="line">#è¿™æ ·æ“ä½œçš„å¥½å¤„æ˜¯å¯ä»¥ä¸ç”¨æ‰‹åŠ¨å»å…³é—­æ–‡ä»¶</span><br><span class="line">with open(&#39;readme.md&#39;, &#39;r&#39;) as f:</span><br><span class="line">    for line in f:</span><br><span class="line">        print line</span><br><span class="line"></span><br><span class="line">#Python2.7+ç‰ˆæœ¬ä¸­,æ”¯æŒä½¿ç”¨ä¸Šä¸‹æ–‡ç®¡ç†åŒæ—¶æ‰“å¼€å¤šä¸ªæ–‡ä»¶</span><br><span class="line">with open(&#39;readme.md&#39;, &#39;r&#39;) as f1, open(&#39;copy.md&#39;, &#39;w&#39;) as f2:</span><br><span class="line">    for line in f1:</span><br><span class="line">        f2.write(line)</span><br><span class="line">#ä»f1æ–‡ä»¶ä¸­è¯»å–ä¸€è¡Œ,åœ¨f2æ–‡ä»¶ä¸­å†™å…¥ä¸€è¡Œ</span><br></pre></td></tr></table></figure>

<ul>
<li><p>ä½¿ç”¨openæ‰“å¼€æ–‡ä»¶æ—¶,å¯ä»¥æŒ‡å®š<code>encoding</code>å‚æ•°,è¿™ä¸ªå‚æ•°çš„ä½œç”¨æ˜¯:è®©Pythonå¸®åŠ©æˆ‘ä»¬æŠŠå­—ç¬¦ä¸²å’ŒäºŒè¿›åˆ¶ä»¥æŒ‡å®šçš„ç¼–ç è½¬äº’ç›¸è½¬æ¢</p>
</li>
<li><p><code>open(&#39;db&#39;, &#39;r&#39;, encoding=&#39;GBK&#39;)</code>ä¸ºä¾‹,Pythonä»ç£ç›˜ä¸­è¯»å–<code>äºŒè¿›åˆ¶</code>å¹¶è‡ªåŠ¨ä»¥<code>GBK</code>ç¼–ç çš„æ–¹å¼è½¬æ¢æˆå­—ç¬¦ä¸²å±•ç¤ºç»™è°ƒç”¨è€…</p>
</li>
<li><p>ä¹‹æ‰€ä»¥ä¼šæœ‰ä¹±ç çš„å‡ºç°,å°±æ˜¯å› ä¸ºå†™å…¥çš„ç¼–ç ä¸è¯»å–çš„ç¼–ç ä¸ç¬¦å¯¼è‡´çš„,ä¾‹å¦‚ä½¿ç”¨<code>utf-8</code>ç¼–ç æ¥ä¿å­˜æ–‡ä»¶,å´ä»¥<code>gbk</code>ç¼–ç æ¥è¯»å–å°±ä¼šé€ æˆä¹±ç </p>
</li>
</ul>
<p>ä»¥<code>r</code>çš„æ–¹å¼è¯»å–æ–‡ä»¶,å¤„ç†æµç¨‹ä¸º:  Pythonå»ç£ç›˜è¯»å–äºŒè¿›åˆ¶ä»£ç ,åœ¨å†…éƒ¨è½¬æ¢æˆå­—ç¬¦ä¸²å±•ç¤ºç»™æˆ‘ä»¬<br>ä»¥<code>w</code> <code>x</code> <code>a</code>çš„æ–¹å¼å†™å…¥æ–‡ä»¶,å¤„ç†æµç¨‹ä¸º: æˆ‘ä»¬å°†å­—ç¬¦ä¸²äº¤ç»™Python,Pythonåœ¨å†…éƒ¨è½¬æ¢æˆäºŒè¿›åˆ¶ä»£ç ä¿å­˜åˆ°ç£ç›˜ä¸­</p>
<p>å¦‚æœä»¥<code>b</code>çš„æ–¹å¼è¯»å†™å–æ–‡ä»¶,å¤„ç†æµç¨‹ä¸º:<code>b</code>ç›¸å½“äºå‘Pythonå£°æ˜,ä¸éœ€è¦å†ä¸ºæˆ‘åšä»»ä½•è½¬æ¢çš„æ“ä½œ,æˆ‘ç›´æ¥ä¸ç£ç›˜çš„äºŒè¿›åˆ¶ä»£ç è¿›è¡Œè¯»å†™,<br>è€Œ<code>äºŒè¿›åˆ¶å­—ç¬¦</code>ä¼šä»¥<code>å­—èŠ‚</code>çš„æ–¹å¼è¿›è¡Œå±•ç¤º,å› ä¸ºæˆ‘ä»¬å·²ç»å£°æ˜ä¸éœ€è¦Pythonä»‹å…¥å¸®å¿™è½¬æ¢ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿéœ€è¦æ‰‹åŠ¨å»æŠŠå­—ç¬¦ä¸²è½¬æ¢æˆå­—èŠ‚åœ¨å»ä¿å­˜</p>
<hr>
<h1 id="æ–‡ä»¶çš„æ“ä½œ"><a href="#æ–‡ä»¶çš„æ“ä½œ" class="headerlink" title="æ–‡ä»¶çš„æ“ä½œ"></a>æ–‡ä»¶çš„æ“ä½œ</h1><p>Pythonä¸­ä½¿ç”¨openå†…å»ºå‡½æ•°æ¥æ‰“å¼€æ–‡ä»¶,Python3ä¸­,openå‡½æ•°æ”¯æŒä¸€ä¸‹æ‰“å¼€æ¨¡å¼:</p>
<ul>
<li><p>â€œ+â€ è¡¨ç¤ºå¯ä»¥åŒæ—¶è¯»å†™æŸä¸ªæ–‡ä»¶</p>
<ul>
<li>r+ï¼Œ è¯»å†™ã€å¯è¯»ï¼Œå¯å†™ã€‘</li>
<li>w+ï¼Œå†™è¯»ã€å¯è¯»ï¼Œå¯å†™ã€‘</li>
<li>x+ ï¼Œå†™è¯»ã€å¯è¯»ï¼Œå¯å†™ã€‘</li>
<li>a+ï¼Œ å†™è¯»ã€å¯è¯»ï¼Œå¯å†™ã€‘</li>
</ul>
</li>
<li><p>â€œbâ€è¡¨ç¤ºä»¥å­—èŠ‚çš„æ–¹å¼æ“ä½œ</p>
<ul>
<li>rb  æˆ– r+b</li>
<li>wb æˆ– w+b</li>
<li>xb æˆ– w+b</li>
<li>ab æˆ– a+b</li>
</ul>
</li>
</ul>
<h2 id="æ‰“å¼€æ–‡ä»¶"><a href="#æ‰“å¼€æ–‡ä»¶" class="headerlink" title="æ‰“å¼€æ–‡ä»¶"></a>æ‰“å¼€æ–‡ä»¶</h2><h3 id="r-åªè¯»æ–¹å¼æ‰“å¼€"><a href="#r-åªè¯»æ–¹å¼æ‰“å¼€" class="headerlink" title="r åªè¯»æ–¹å¼æ‰“å¼€"></a>r åªè¯»æ–¹å¼æ‰“å¼€</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">f = open(<span class="string">'db'</span>, <span class="string">'r'</span>)</span><br><span class="line">print(<span class="string">'ä»¥ræ¨¡å¼æ‰“å¼€,æ˜¯å¦å¯è¯»? '</span>, f.readable())</span><br><span class="line">print(<span class="string">'ä»¥ræ¨¡å¼æ‰“å¼€,æ˜¯å¦å¯å†™?'</span>, f.writable())</span><br><span class="line">print(f, type(f))</span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line">    print(line)</span><br><span class="line">f.close()</span><br><span class="line"></span><br><span class="line"><span class="comment">######è¿è¡Œç»“æœ</span></span><br><span class="line">ä»¥ræ¨¡å¼æ‰“å¼€,æ˜¯å¦å¯è¯»?  True</span><br><span class="line">ä»¥ræ¨¡å¼æ‰“å¼€,æ˜¯å¦å¯å†™? False</span><br><span class="line">&lt;_io.TextIOWrapper name=<span class="string">'db'</span> mode=<span class="string">'r'</span> encoding=<span class="string">'UTF-8'</span>&gt; &lt;<span class="class"><span class="keyword">class</span> '<span class="title">_io</span>.<span class="title">TextIOWrapper</span>'&gt;</span></span><br><span class="line"><span class="class">123</span></span><br></pre></td></tr></table></figure>

<h3 id="w-åªå†™æ–¹å¼æ‰“å¼€"><a href="#w-åªå†™æ–¹å¼æ‰“å¼€" class="headerlink" title="w åªå†™æ–¹å¼æ‰“å¼€"></a>w åªå†™æ–¹å¼æ‰“å¼€</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">with</span> open(<span class="string">'db'</span>, <span class="string">'r'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line">        print(line)</span><br><span class="line"></span><br><span class="line">print(<span class="string">'---------'</span>)</span><br><span class="line"></span><br><span class="line">f2 = open(<span class="string">'db'</span>, <span class="string">'w'</span>)</span><br><span class="line">print(<span class="string">'ä»¥wæ¨¡å¼æ‰“å¼€,æ˜¯å¦å¯è¯»? '</span>, f2.readable())</span><br><span class="line">print(<span class="string">'ä»¥wæ¨¡å¼æ‰“å¼€,æ˜¯å¦å¯å†™?'</span>, f2.writable())</span><br><span class="line">string = <span class="string">'123456789'</span></span><br><span class="line">f2.write(string)</span><br><span class="line">f2.close()</span><br><span class="line"></span><br><span class="line">print(<span class="string">'---------'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'db'</span>, <span class="string">'r'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line">        print(line)</span><br><span class="line"></span><br><span class="line"><span class="comment">######è¿è¡Œç»“æœ</span></span><br><span class="line"><span class="number">123</span></span><br><span class="line">---------</span><br><span class="line">ä»¥wæ¨¡å¼æ‰“å¼€,æ˜¯å¦å¯è¯»?  False</span><br><span class="line">ä»¥wæ¨¡å¼æ‰“å¼€,æ˜¯å¦å¯å†™? True</span><br><span class="line">---------</span><br><span class="line"><span class="number">123456789</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯ä»¥çœ‹å‡ºæ¥,ä½¿ç”¨wæ¨¡å¼æ‰“å¼€æ–‡ä»¶æ—¶ä¼šå…ˆæ¸…ç©ºæ–‡ä»¶ä¸­çš„æ‰€æœ‰å†…å®¹å†ç­‰å¾…å†™å…¥</span></span><br></pre></td></tr></table></figure>

<h3 id="x-æ–‡ä»¶å­˜åœ¨åˆ™æŠ¥é”™-ä¸å­˜åœ¨åˆ™è¿›å…¥åªå†™æ¨¡å¼"><a href="#x-æ–‡ä»¶å­˜åœ¨åˆ™æŠ¥é”™-ä¸å­˜åœ¨åˆ™è¿›å…¥åªå†™æ¨¡å¼" class="headerlink" title="x æ–‡ä»¶å­˜åœ¨åˆ™æŠ¥é”™,ä¸å­˜åœ¨åˆ™è¿›å…¥åªå†™æ¨¡å¼"></a>x æ–‡ä»¶å­˜åœ¨åˆ™æŠ¥é”™,ä¸å­˜åœ¨åˆ™è¿›å…¥åªå†™æ¨¡å¼</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">f3 = open(<span class="string">'db'</span>, <span class="string">'x'</span>)</span><br><span class="line">f3.close()</span><br><span class="line"></span><br><span class="line"><span class="comment">######è¿è¡Œç»“æœ</span></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"/Users/lvrui/PycharmProjects/untitled/3/code/test.py"</span>, line <span class="number">327</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    f3 = open(<span class="string">'db'</span>, <span class="string">'x'</span>)</span><br><span class="line">FileExistsError: [Errno <span class="number">17</span>] File exists: <span class="string">'db'</span></span><br></pre></td></tr></table></figure>

<h3 id="a-ä»¥è¿½åŠ çš„æ–¹å¼æ‰“å¼€æ–‡ä»¶è¿›å…¥å†™å…¥æ¨¡å¼"><a href="#a-ä»¥è¿½åŠ çš„æ–¹å¼æ‰“å¼€æ–‡ä»¶è¿›å…¥å†™å…¥æ¨¡å¼" class="headerlink" title="a ä»¥è¿½åŠ çš„æ–¹å¼æ‰“å¼€æ–‡ä»¶è¿›å…¥å†™å…¥æ¨¡å¼"></a>a ä»¥è¿½åŠ çš„æ–¹å¼æ‰“å¼€æ–‡ä»¶è¿›å…¥å†™å…¥æ¨¡å¼</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">f4 = open(<span class="string">'db'</span>, <span class="string">'a'</span>)</span><br><span class="line">f4.write(<span class="string">'hahahaha'</span>)</span><br><span class="line">f4.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'db'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line">        print(line)</span><br><span class="line"></span><br><span class="line"><span class="comment">######è¿è¡Œç»“æœ</span></span><br><span class="line"><span class="number">123456789</span>hahahaha</span><br></pre></td></tr></table></figure>

<h3 id="r-æœ€å¸¸ç”¨çš„è¯»å†™æ¨¡å¼"><a href="#r-æœ€å¸¸ç”¨çš„è¯»å†™æ¨¡å¼" class="headerlink" title="r+ æœ€å¸¸ç”¨çš„è¯»å†™æ¨¡å¼"></a>r+ æœ€å¸¸ç”¨çš„è¯»å†™æ¨¡å¼</h3><p>ä¸ºä»€ä¹ˆr+æ˜¯æœ€å¸¸ç”¨çš„è¯»å†™æ¨¡å¼?</p>
<pre><code>- w+è™½ç„¶ä¹Ÿæ˜¯è¯»å†™æ¨¡å¼,ä½†æ˜¯wæ¨¡å¼ä¼šå…ˆæ¸…ç©ºæ–‡ä»¶ä¸­çš„æ‰€æœ‰å†…å®¹,ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬ä¸éœ€è¦æ¸…ç©ºæ–‡ä»¶</code></pre><figure class="highlight"><table><tr><td class="code"><pre><span class="line">f5 = open(<span class="string">'db'</span>, <span class="string">'r+'</span>)</span><br><span class="line">print(<span class="string">'ä»¥wæ¨¡å¼æ‰“å¼€,æ˜¯å¦å¯è¯»? '</span>, f5.readable())</span><br><span class="line">print(<span class="string">'ä»¥wæ¨¡å¼æ‰“å¼€,æ˜¯å¦å¯å†™?'</span>, f5.writable())</span><br><span class="line">f5.close()</span><br><span class="line"></span><br><span class="line"><span class="comment">######è¿è¡Œç»“æœ</span></span><br><span class="line">ä»¥wæ¨¡å¼æ‰“å¼€,æ˜¯å¦å¯è¯»?  True</span><br><span class="line">ä»¥wæ¨¡å¼æ‰“å¼€,æ˜¯å¦å¯å†™? True</span><br></pre></td></tr></table></figure>

<h3 id="b-ä»¥äºŒè¿›åˆ¶æ–¹å¼æ‰“å¼€æ–‡ä»¶"><a href="#b-ä»¥äºŒè¿›åˆ¶æ–¹å¼æ‰“å¼€æ–‡ä»¶" class="headerlink" title="b ä»¥äºŒè¿›åˆ¶æ–¹å¼æ‰“å¼€æ–‡ä»¶"></a>b ä»¥äºŒè¿›åˆ¶æ–¹å¼æ‰“å¼€æ–‡ä»¶</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">with</span> open(<span class="string">'db'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line">        print(line)</span><br><span class="line"></span><br><span class="line">print(<span class="string">'------'</span>)</span><br><span class="line"></span><br><span class="line">f6 = open(<span class="string">'db'</span>, <span class="string">'rb'</span>)</span><br><span class="line">print(f6.read())</span><br><span class="line">f6.close()</span><br><span class="line"></span><br><span class="line"><span class="comment">######è¿è¡Œç»“æœ</span></span><br><span class="line">å“ˆå“ˆ</span><br><span class="line">------</span><br><span class="line"><span class="string">b'\xe5\x93\x88\xe5\x93\x88'</span></span><br></pre></td></tr></table></figure>

<p><strong>å¦‚æœä½¿ç”¨<code>å¸¦b</code>çš„æ–¹å¼æ‰“å¼€æ–‡ä»¶,æ˜¯æŒ‰ç…§å­—èŠ‚æ¥è¯»å†™çš„</strong></p>
<p><strong>å¦‚æœä½¿ç”¨<code>ä¸å¸¦b</code>çš„æ–¹å¼æ‰“å¼€æ–‡ä»¶,æ˜¯æŒ‰ç…§å­—ç¬¦æ¥è¯»å†™çš„</strong></p>
<p><em>ä¾‹å¦‚: ä¸€ä¸ªæ±‰å­—ä½¿ç”¨<code>utf-8</code>ç¼–ç çš„è¯,å ç”¨ä¸‰ä¸ªå­—èŠ‚,ä½¿ç”¨<code>å¸¦b</code>æ–¹å¼è¦è¯»å–ä¸‰ä¸ªå­—èŠ‚æ‰æ˜¯æ­£ç¡®çš„æ±‰å­—,è€Œä½¿ç”¨<code>ä¸å¸¦b</code>çš„æ–¹å¼,è¯»å–ä¸€ä¸ªå­—ç¬¦å°±æ˜¯æ­£ç¡®çš„æ±‰å­—</em></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">f7 = open(<span class="string">'db'</span>, <span class="string">'r'</span>)</span><br><span class="line">print(f7.read(<span class="number">1</span>))</span><br><span class="line">f7.close()</span><br><span class="line"></span><br><span class="line">print(<span class="string">'------'</span>)</span><br><span class="line"></span><br><span class="line">f8 = open(<span class="string">'db'</span>, <span class="string">'rb'</span>)</span><br><span class="line">print(f8.read(<span class="number">1</span>))</span><br><span class="line">f8.seek(<span class="number">0</span>)</span><br><span class="line">print(f8.read(<span class="number">3</span>))</span><br><span class="line">f8.close()</span><br><span class="line"></span><br><span class="line"><span class="comment">######è¿è¡Œç»“æœ</span></span><br><span class="line">å“ˆ</span><br><span class="line">------</span><br><span class="line"><span class="string">b'\xe5'</span></span><br><span class="line"><span class="string">b'\xe5\x93\x88'</span></span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨äºŒè¿›åˆ¶çš„æ–¹å¼æ“ä½œæ–‡ä»¶çœå»äº†Pythonä¸ºæˆ‘ä»¬è½¬æ¢çš„æ“ä½œ</p>
<h2 id="éå†æ–‡ä»¶å†…å®¹"><a href="#éå†æ–‡ä»¶å†…å®¹" class="headerlink" title="éå†æ–‡ä»¶å†…å®¹"></a>éå†æ–‡ä»¶å†…å®¹</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">with</span> open(<span class="string">'db'</span>, <span class="string">'r'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line">        print(line)</span><br></pre></td></tr></table></figure>

<h2 id="æ–‡ä»¶çš„å…¶ä»–æ“ä½œ"><a href="#æ–‡ä»¶çš„å…¶ä»–æ“ä½œ" class="headerlink" title="æ–‡ä»¶çš„å…¶ä»–æ“ä½œ"></a>æ–‡ä»¶çš„å…¶ä»–æ“ä½œ</h2><h3 id="read-è¯»å–æ–‡ä»¶ï¼Œä¸åŠ å‚æ•°å³è¯»å–å…¨éƒ¨å†…å®¹ï¼ŒåŠ æ•°å­—ç±»å‹çš„å‚æ•°æœ‰ä¸¤ç§æƒ…å†µ"><a href="#read-è¯»å–æ–‡ä»¶ï¼Œä¸åŠ å‚æ•°å³è¯»å–å…¨éƒ¨å†…å®¹ï¼ŒåŠ æ•°å­—ç±»å‹çš„å‚æ•°æœ‰ä¸¤ç§æƒ…å†µ" class="headerlink" title="read() è¯»å–æ–‡ä»¶ï¼Œä¸åŠ å‚æ•°å³è¯»å–å…¨éƒ¨å†…å®¹ï¼ŒåŠ æ•°å­—ç±»å‹çš„å‚æ•°æœ‰ä¸¤ç§æƒ…å†µ"></a>read() è¯»å–æ–‡ä»¶ï¼Œä¸åŠ å‚æ•°å³è¯»å–å…¨éƒ¨å†…å®¹ï¼ŒåŠ æ•°å­—ç±»å‹çš„å‚æ•°æœ‰ä¸¤ç§æƒ…å†µ</h3><ul>
<li><p>ä»¥<code>ä¸å¸¦b</code>çš„æ–¹å¼è¿›è¡Œè¯»æ“ä½œï¼Œåˆ™è¯»çš„æ˜¯å­—ç¬¦</p>
</li>
<li><p>ä»¥<code>å¸¦b</code>çš„æ–¹å¼è¿›è¡Œè¯»æ“ä½œï¼Œåˆ™è¯»çš„æ˜¯å­—èŠ‚</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">f9 = open(<span class="string">'db'</span>, <span class="string">'r'</span>)</span><br><span class="line">print(type(f9.read()))</span><br><span class="line">f9.close()</span><br><span class="line"></span><br><span class="line">f10 = open(<span class="string">'db'</span>, <span class="string">'rb'</span>)</span><br><span class="line">print(type(f10.read()))</span><br><span class="line">f10.close()</span><br><span class="line"></span><br><span class="line"><span class="comment">######è¿è¡Œç»“æœ</span></span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">str</span>'&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">class</span> '<span class="title">bytes</span>'&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="seek-æ“ä½œæ–‡ä»¶æŒ‡é’ˆï¼ˆå­—èŠ‚ï¼‰"><a href="#seek-æ“ä½œæ–‡ä»¶æŒ‡é’ˆï¼ˆå­—èŠ‚ï¼‰" class="headerlink" title="seek() æ“ä½œæ–‡ä»¶æŒ‡é’ˆï¼ˆå­—èŠ‚ï¼‰"></a>seek() æ“ä½œæ–‡ä»¶æŒ‡é’ˆï¼ˆå­—èŠ‚ï¼‰</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#åŸæ–‡ä»¶å†…å®¹ï¼š</span></span><br><span class="line">å“ˆå“ˆ<span class="number">123456</span>å“ˆå“ˆ</span><br><span class="line">å˜¿å˜¿<span class="number">234567</span>å˜¿å˜¿</span><br><span class="line">å˜»å˜»<span class="number">567890</span>å˜»å˜»</span><br><span class="line"></span><br><span class="line">f11 = open(<span class="string">'db'</span>, <span class="string">'r+'</span>)</span><br><span class="line">f11.seek(<span class="number">1</span>)</span><br><span class="line">f11.write(<span class="string">'KKKKKK'</span>)</span><br><span class="line">f11.close()</span><br><span class="line"></span><br><span class="line"><span class="comment">######è¿è¡Œç»“æœ</span></span><br><span class="line">ï¿½KKKKKK23456å“ˆå“ˆ</span><br><span class="line">å˜¿å˜¿<span class="number">234567</span>å˜¿å˜¿</span><br><span class="line">å˜»å˜»<span class="number">567890</span>å˜»å˜»</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ€»ç»“ï¼šè¿™æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„ä¾‹å­ï¼Œå‰é¢æˆ‘ä»¬è¯´åˆ°ï¼Œå¦‚æœä½¿ç”¨å¸¦bçš„æ–¹å¼è¯»å–æ–‡ä»¶æ˜¯æŒ‰ç…§å­—èŠ‚çš„æ–¹å¼è¯»å–ï¼›ä½¿ç”¨ä¸å¸¦bçš„æ–¹å¼è¯»å–æ˜¯æŒ‰ç…§å­—ç¬¦çš„æ–¹å¼è¯»å–ã€‚</span></span><br><span class="line"><span class="comment">#è€Œseekä¸ç®¡æœ‰æ²¡æœ‰bçš„å­˜åœ¨ï¼Œéƒ½æ˜¯ä»¥å­—èŠ‚çš„æ–¹å¼å»ç§»åŠ¨æŒ‡é’ˆçš„ï¼ç”±äºå‰é¢çš„æ–‡ä»¶æˆ‘ä½¿ç”¨äº†utf-8çš„ç¼–ç æ–¹å¼è¿›è¡Œä¿å­˜ï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªâ€œå“ˆâ€å­—å ç”¨äº†ä¸‰ä¸ªå­—èŠ‚</span></span><br><span class="line"><span class="comment">#æ‰“å¼€æ–‡ä»¶åï¼ŒæŒ‡é’ˆé»˜è®¤åœ¨æ–‡ä»¶çš„å¼€å¤´ï¼ˆ0çš„ä½ç½®ï¼‰ï¼Œç„¶åæˆ‘æ“ä½œæŒ‡é’ˆå‘åç§»åŠ¨ä¸€ä¸ªå­—èŠ‚è¿›è¡Œå†™å…¥æ“ä½œï¼Œç”±äºç¬¬ä¸€ä¸ªæ±‰å­—ç”±ä¸‰ä¸ªå­—èŠ‚ç»„æˆï¼Œæ‰€ä»¥åå†™å…¥çš„æ•°æ®ä»ç¬¬äºŒä¸ªå­—èŠ‚å°±å¼€å§‹è¦†ç›–</span></span><br><span class="line"><span class="comment">#Pythonä¸­çš„å¯¹æ–‡æœ¬çš„æ’å…¥æ“ä½œï¼Œä¸ä¼šæŠŠåé¢æ‰€æœ‰çš„å­—èŠ‚éƒ½å‘åç§»åŠ¨ï¼Œè€Œæ˜¯ä¼šè¿›è¡Œè¦†ç›–ã€‚æˆ‘æŒ‡é’ˆ1çš„ä½ç½®å†™å…¥äº†6ä¸ªå­—èŠ‚ï¼Œå‰ä¸¤ä¸ªæ±‰å­—å äº†6ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥</span></span><br><span class="line"><span class="comment">#æ‰§è¡Œè¯¥æ“ä½œåï¼Œæ–°çš„å­—èŠ‚ä¼šè¦†ç›–ç¬¬2åˆ°7ä¸ªå­—èŠ‚ã€‚è€Œç”±äºç¬¬ä¸€ä¸ªæ±‰å­—çš„ä¸‰ä¸ªå­—èŠ‚è¢«æˆªæ–­ï¼Œæ‰€ä»¥äº§ç”Ÿäº†ä¹±ç </span></span><br></pre></td></tr></table></figure>

<p>è¿˜æœ‰ä¸€ç§æƒ…å†µæ˜¯ä½¿ç”¨<code>a+</code>çš„æ–¹å¼æ‰“å¼€æ–‡ä»¶åï¼Œæ“ä½œseek()æŒ‡å®šå†™å…¥ä½ç½®æ˜¯æ— æ•ˆçš„ï¼Œéƒ½ä¼šåœ¨æ–‡ä»¶æœ«å°¾è¿½åŠ </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#åŸæ–‡ä»¶å†…å®¹ï¼š</span></span><br><span class="line">å“ˆå“ˆ<span class="number">123456</span>å“ˆå“ˆ</span><br><span class="line">å˜¿å˜¿<span class="number">234567</span>å˜¿å˜¿</span><br><span class="line">å˜»å˜»<span class="number">567890</span>å˜»å˜»</span><br><span class="line"></span><br><span class="line">f13 = open(<span class="string">'db'</span>, <span class="string">'a+'</span>)</span><br><span class="line">f13.seek(<span class="number">1</span>)</span><br><span class="line">f13.write(<span class="string">'KKKKKK'</span>)</span><br><span class="line">f13.close()</span><br><span class="line"></span><br><span class="line"><span class="comment">######è¿è¡Œç»“æœ</span></span><br><span class="line">å“ˆå“ˆ<span class="number">123456</span>å“ˆå“ˆ</span><br><span class="line">å˜¿å˜¿<span class="number">234567</span>å˜¿å˜¿</span><br><span class="line">å˜»å˜»<span class="number">567890</span>å˜»å˜»KKKKKK</span><br></pre></td></tr></table></figure>

<h3 id="tell-æŠ¥å‘Šå½“å‰æ–‡ä»¶æŒ‡é’ˆçš„ä½ç½®ï¼ˆå­—èŠ‚ï¼‰"><a href="#tell-æŠ¥å‘Šå½“å‰æ–‡ä»¶æŒ‡é’ˆçš„ä½ç½®ï¼ˆå­—èŠ‚ï¼‰" class="headerlink" title="tell() æŠ¥å‘Šå½“å‰æ–‡ä»¶æŒ‡é’ˆçš„ä½ç½®ï¼ˆå­—èŠ‚ï¼‰"></a>tell() æŠ¥å‘Šå½“å‰æ–‡ä»¶æŒ‡é’ˆçš„ä½ç½®ï¼ˆå­—èŠ‚ï¼‰</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">f12 = open(<span class="string">'db'</span>, <span class="string">'r'</span>)</span><br><span class="line">print(f12.tell())</span><br><span class="line">f12.read(<span class="number">1</span>)</span><br><span class="line">print(f12.tell())</span><br><span class="line">f12.seek(<span class="number">0</span>)</span><br><span class="line">print(f12.tell())</span><br><span class="line">f12.close()</span><br><span class="line"></span><br><span class="line"><span class="comment">######è¿è¡Œç»“æœ</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ€»ç»“ï¼šå¯ä»¥çœ‹åˆ°ï¼Œå½“æ–‡ä»¶åˆšåˆšè¢«æ‰“å¼€æ—¶ï¼ŒæŒ‡é’ˆåœ¨0çš„ä½ç½®ï¼›</span></span><br><span class="line"><span class="comment">#æˆ‘ä»¥rçš„æ–¹å¼è¯»å–ï¼ˆå­—ç¬¦ï¼‰ï¼Œè¯»äº†1ä¸ªå­—ç¬¦ï¼Œç”±äºç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯ä¸ªæ±‰å­—ï¼Œå ç”¨äº†3ä¸ªå­—èŠ‚</span></span><br><span class="line"><span class="comment">#æ‰€ä»¥å½“è¯»å®Œç¬¬ä¸€ä¸ªå­—ç¬¦åï¼Œæˆ‘å†æŸ¥çœ‹æŒ‡é’ˆçš„ä½ç½®ï¼Œå‘ç°ç§»åŠ¨åˆ°äº†3çš„ä½ç½®</span></span><br><span class="line"><span class="comment">#æœ€åæˆ‘ä½¿ç”¨seekå»æ“ä½œæŒ‡é’ˆå½’é›¶</span></span><br></pre></td></tr></table></figure>

<h3 id="write-å‘æ–‡ä»¶ä¸­å†™å…¥æ•°æ®"><a href="#write-å‘æ–‡ä»¶ä¸­å†™å…¥æ•°æ®" class="headerlink" title="write() å‘æ–‡ä»¶ä¸­å†™å…¥æ•°æ®"></a>write() å‘æ–‡ä»¶ä¸­å†™å…¥æ•°æ®</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">with</span> open(<span class="string">'db'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(<span class="string">'haha'</span>)</span><br></pre></td></tr></table></figure>

<h3 id="flush-ç”¨åœ¨å…³é—­æ–‡ä»¶ä¹‹å‰ï¼Œå¼ºåˆ¶å°†å†™å…¥çš„æ“ä½œå†™åˆ°ç£ç›˜ä¸­"><a href="#flush-ç”¨åœ¨å…³é—­æ–‡ä»¶ä¹‹å‰ï¼Œå¼ºåˆ¶å°†å†™å…¥çš„æ“ä½œå†™åˆ°ç£ç›˜ä¸­" class="headerlink" title="flush() ç”¨åœ¨å…³é—­æ–‡ä»¶ä¹‹å‰ï¼Œå¼ºåˆ¶å°†å†™å…¥çš„æ“ä½œå†™åˆ°ç£ç›˜ä¸­"></a>flush() ç”¨åœ¨å…³é—­æ–‡ä»¶ä¹‹å‰ï¼Œå¼ºåˆ¶å°†å†™å…¥çš„æ“ä½œå†™åˆ°ç£ç›˜ä¸­</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">f14 = open(<span class="string">'db'</span>, <span class="string">'w'</span>)</span><br><span class="line">f14.write(<span class="string">'haha'</span>)</span><br><span class="line">f14.flush()</span><br><span class="line">f14.close()</span><br></pre></td></tr></table></figure>

<h3 id="truncate-æˆªæ–­æ–‡ä»¶ï¼ŒæŒ‡é’ˆä¹‹åçš„å†…å®¹å…¨éƒ¨æ¸…ç©º"><a href="#truncate-æˆªæ–­æ–‡ä»¶ï¼ŒæŒ‡é’ˆä¹‹åçš„å†…å®¹å…¨éƒ¨æ¸…ç©º" class="headerlink" title="truncate() æˆªæ–­æ–‡ä»¶ï¼ŒæŒ‡é’ˆä¹‹åçš„å†…å®¹å…¨éƒ¨æ¸…ç©º"></a>truncate() æˆªæ–­æ–‡ä»¶ï¼ŒæŒ‡é’ˆä¹‹åçš„å†…å®¹å…¨éƒ¨æ¸…ç©º</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#åŸæ–‡ä»¶å†…å®¹ï¼š</span></span><br><span class="line">å“ˆå“ˆ<span class="number">123456</span>å“ˆå“ˆ</span><br><span class="line">å˜¿å˜¿<span class="number">234567</span>å˜¿å˜¿</span><br><span class="line">å˜»å˜»<span class="number">567890</span>å˜»å˜»</span><br><span class="line"></span><br><span class="line">f15 = open(<span class="string">'db'</span>, <span class="string">'r+'</span>)</span><br><span class="line">f15.seek(<span class="number">6</span>)</span><br><span class="line">f15.truncate()</span><br><span class="line">f15.close()</span><br><span class="line"></span><br><span class="line"><span class="comment">######è¿è¡Œç»“æœ</span></span><br><span class="line">å“ˆå“ˆ</span><br></pre></td></tr></table></figure>

<h3 id="readable-amp-writable-æ˜¯å¦å¯è¯»-æ˜¯å¦å¯å†™"><a href="#readable-amp-writable-æ˜¯å¦å¯è¯»-æ˜¯å¦å¯å†™" class="headerlink" title="readable() &amp; writable() æ˜¯å¦å¯è¯» æ˜¯å¦å¯å†™"></a>readable() &amp; writable() æ˜¯å¦å¯è¯» æ˜¯å¦å¯å†™</h3><figure class="highlight"><table><tr><td class="code"><pre><span class="line">f16 = open(<span class="string">'db'</span>, <span class="string">'r+'</span>)</span><br><span class="line">print(<span class="string">'readable?'</span>, f16.readable())</span><br><span class="line">print(<span class="string">'writable?'</span>, f16.writable())</span><br><span class="line">f16.close()</span><br><span class="line"></span><br><span class="line"><span class="comment">######è¿è¡Œç»“æœ</span></span><br><span class="line">readable? True</span><br><span class="line">writable? True</span><br></pre></td></tr></table></figure>

<h3 id="readlines-æŠŠæ–‡ä»¶æ‰€æœ‰çš„å†…å®¹è¯»åˆ°å†…å­˜ä¸­ï¼ˆread-ä¹Ÿæ˜¯ä¸€æ¬¡æŠŠæ‰€æœ‰å†…å®¹è¯»åˆ°å†…å­˜ä¸­ï¼‰"><a href="#readlines-æŠŠæ–‡ä»¶æ‰€æœ‰çš„å†…å®¹è¯»åˆ°å†…å­˜ä¸­ï¼ˆread-ä¹Ÿæ˜¯ä¸€æ¬¡æŠŠæ‰€æœ‰å†…å®¹è¯»åˆ°å†…å­˜ä¸­ï¼‰" class="headerlink" title="readlines() æŠŠæ–‡ä»¶æ‰€æœ‰çš„å†…å®¹è¯»åˆ°å†…å­˜ä¸­ï¼ˆread()ä¹Ÿæ˜¯ä¸€æ¬¡æŠŠæ‰€æœ‰å†…å®¹è¯»åˆ°å†…å­˜ä¸­ï¼‰"></a>readlines() æŠŠæ–‡ä»¶æ‰€æœ‰çš„å†…å®¹è¯»åˆ°å†…å­˜ä¸­ï¼ˆread()ä¹Ÿæ˜¯ä¸€æ¬¡æŠŠæ‰€æœ‰å†…å®¹è¯»åˆ°å†…å­˜ä¸­ï¼‰</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">f17 = open(<span class="string">'db'</span>, <span class="string">'r'</span>)</span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> f17.readlines():</span><br><span class="line">    print(line)</span><br><span class="line">f17.close()</span><br><span class="line"></span><br><span class="line">print(<span class="string">'------'</span>)</span><br><span class="line"></span><br><span class="line">f18 = open(<span class="string">'db'</span>, <span class="string">'r'</span>)</span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> f18:</span><br><span class="line">    print(line)</span><br><span class="line">f18.close()</span><br><span class="line"></span><br><span class="line"><span class="comment">######è¿è¡Œç»“æœ</span></span><br><span class="line">å“ˆå“ˆ<span class="number">123456</span>å“ˆå“ˆ</span><br><span class="line"></span><br><span class="line">å˜¿å˜¿<span class="number">234567</span>å˜¿å˜¿</span><br><span class="line"></span><br><span class="line">å˜»å˜»<span class="number">567890</span>å˜»å˜»</span><br><span class="line">------</span><br><span class="line">å“ˆå“ˆ<span class="number">123456</span>å“ˆå“ˆ</span><br><span class="line"></span><br><span class="line">å˜¿å˜¿<span class="number">234567</span>å˜¿å˜¿</span><br><span class="line"></span><br><span class="line">å˜»å˜»<span class="number">567890</span>å˜»å˜»</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ€»ç»“ï¼šè™½ç„¶ä¸¤ç§æ–¹å¼çš„ç»“æœç›¸åŒï¼Œä½†æ˜¯ä½¿ç”¨readlines()ä¼šæŠŠæ–‡ä»¶ä¸­æ‰€æœ‰çš„å†…å®¹ä¸€æ¬¡æ€§è¯»åˆ°å†…å­˜ä¸­</span></span><br><span class="line"><span class="comment">#è€Œç¬¬äºŒç§æ–¹å¼æ˜¯æ“ä½œäº†ä¸€ä¸ªæ–‡ä»¶å¯¹è±¡ï¼Œè¯¥æ–‡ä»¶å¯¹è±¡æ˜¯ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ï¼Œæ¯æ¬¡åªè¿”å›ä¸€è¡Œï¼Œæ¯”è¾ƒèŠ‚çœå†…å­˜</span></span><br></pre></td></tr></table></figure>

<h3 id="readline-è¯»å–ä¸€è¡Œ"><a href="#readline-è¯»å–ä¸€è¡Œ" class="headerlink" title="readline() è¯»å–ä¸€è¡Œ"></a>readline() è¯»å–ä¸€è¡Œ</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">f19 = open(<span class="string">'db'</span>, <span class="string">'r'</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    line = f19.readline()</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> line:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(line)</span><br><span class="line">f19.close()</span><br><span class="line"></span><br><span class="line"><span class="comment">######è¿è¡Œç»“æœ</span></span><br><span class="line">å“ˆå“ˆ<span class="number">123456</span>å“ˆå“ˆ</span><br><span class="line"></span><br><span class="line">å˜¿å˜¿<span class="number">234567</span>å˜¿å˜¿</span><br><span class="line"></span><br><span class="line">å˜»å˜»<span class="number">567890</span>å˜»å˜»</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ€»ç»“ï¼šå’Œä¸Šé¢çš„ç»“æœä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œåªä¸è¿‡ä½¿ç”¨readline()æ˜¯æ¯æ¬¡åªè¯»å–ä¸€è¡Œåˆ°å†…å­˜ä¸­</span></span><br></pre></td></tr></table></figure>

<h2 id="æ–‡ä»¶æ“ä½œå®æˆ˜"><a href="#æ–‡ä»¶æ“ä½œå®æˆ˜" class="headerlink" title="æ–‡ä»¶æ“ä½œå®æˆ˜"></a>æ–‡ä»¶æ“ä½œå®æˆ˜</h2>]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>æ”¶è·ä¸æ­¢Oracle</title>
    <url>/2016/05/22/%E6%94%B6%E8%8E%B7%E4%B8%8D%E6%AD%A2Oracle/</url>
    <content><![CDATA[<blockquote>
<p>ä»Šå¤©è·Ÿå¤§å®¶åˆ†äº«çš„æ ‡é¢˜å«<code>ã€Šæ”¶è·ä¸æ­¢Oracleã€‹</code> ä¸‰å¹´å‰æˆ‘åœ¨ä¸€å®¶ä¹¦åº—â€œçº³å‡‰â€æ—¶å‘ç°äº†ä¸€æœ¬ä¹¦<code>ã€Šæ”¶è·ä¸æ­¢Oracleã€‹</code>  ä»Šå¤©æŠ›å¼€Oracleä¸è°ˆï¼Œæˆ‘ä»¬æ¥èŠèŠè¿™æœ¬ä¹¦æ˜¯æ€ä¹ˆâ€œæ”¶è·ä¸æ­¢Oracleâ€çš„</p>
</blockquote>
<p>ã€Šæ”¶è·ä¸æ­¢Oracleã€‹è¿™æœ¬ä¹¦ä¸­è®¨è®ºçš„æ˜¯Oracleæ•°æ®åº“è°ƒä¼˜çš„é—®é¢˜ï¼Œåˆ°åº•æ˜¯ä»€ä¹ˆä¸œè¥¿èƒ½è®©äººä»¬åœ¨æœ¬ä¹¦ä¸­çš„æ”¶è·ä¸æ­¢Oracleçš„ï¼Ÿè¿™ä¸ªé—®é¢˜è¦ä»å¦‚ä½•è§£å†³Oracleæ€§èƒ½ç“¶é¢ˆçš„é—®é¢˜æ¥å…¥æ‰‹ã€‚</p>
<p>ä¹¦ä¸­è§£å†³Oracleæ€§èƒ½ç“¶é¢ˆçš„é—®é¢˜éµå¾ªçš„å”¯ä¸€åŸåˆ™å°±æ˜¯<code>å°‘åšäº‹å„¿ï¼</code> ä½œè€…è‚¯å®šçš„è¯´ï¼Œå°‘åšäº‹å„¿ï¼Œå°±ä¸€å®šèƒ½æé«˜æ•ˆç‡ï¼é“ç†å¾ˆç®€å•ï¼Œä¸¾ä¸ªä¾‹å­æ¥è¯´~</p>
<ul>
<li><p>ä¸€ä¸ªæµç¨‹ï¼ŒåŸæ¥éœ€è¦èµ°6æ­¥æ‰èƒ½å®Œæˆï¼Œç°åœ¨åœ¨ä¸å¢åŠ é¢å¤–è´Ÿæ‹…çš„æƒ…å†µä¸‹æŠŠå®ƒä¼˜åŒ–æˆåªéœ€è¦5æ­¥ï¼Œé‚£æ•ˆç‡å°±ä¸€å®šæé«˜äº†ï¼</p>
</li>
<li><p>æ‹¿ç®—æ³•æ¥è¯´ï¼Œä¹Ÿå¯ä»¥ç®€å•çš„ç†è§£ä¸ºæ ¹æ®å…·ä½“æƒ…å†µï¼Œæ‰¾åˆ°è®©CPUè¿ç®—æ¬¡æ•°å°½å¯èƒ½å°‘çš„å¾—åˆ°ç»“æœçš„åŠæ³•</p>
</li>
</ul>
<p>å°‘åšäº‹å„¿çš„æ€æƒ³å¯ä»¥åº”ç”¨åˆ°å„è¡Œå„ä¸šï¼Œå½“ç„¶ä¸å±€é™äºOracleã€‚</p>
<p>å¦‚ä»Šå¤§ç«çš„<code>è¿ç»´è‡ªåŠ¨åŒ–</code>ã€<code>DevOps</code>ã€<code>CMDB</code>ç­‰æ¦‚å¿µéƒ½æ˜¯<code>å°‘åšäº‹å„¿</code>çš„æœ€ä½³ä½“ç°ï¼ä½†æ˜¯è¿™ä¸‰è€…æœ‰ä¸€ä¸ªå…±åŒç‚¹ï¼å‡ºå‘ç‚¹éƒ½æ˜¯<code>è®©äººå°‘åšäº‹å„¿</code>ï¼Œå°†äººå·¥çš„é‡å¤åŠ³åŠ¨åŠ ä»¥å½’ç±»æ•´åˆï¼Œè®©æœºå™¨è‡ªå·±å»å®Œæˆï¼Œä»è€Œå®ç°äº†é€šè¿‡å°‘åšäº‹å„¿æ¥æé«˜å·¥ä½œæ•ˆç‡ã€‚ä½†ä»¥ä¸Šè¿™äº›ç†å¿µå¹¶æ²¡æœ‰è§¦åŠåˆ°ä¸šåŠ¡çš„æ ¸å¿ƒé—®é¢˜ï¼å°±æ˜¯ä¸šåŠ¡ä¸Šæ˜¯å¦å­˜åœ¨ä¸å¿…è¦çš„å†—ä½™ï¼</p>
<p>ä¸Šé¢æåˆ°çš„æŠ€æœ¯ï¼Œè§£å†³äº†è®©äººå°‘åšäº‹å„¿æé«˜æ•ˆç‡çš„åŠæ³•ï¼Œé‚£ç¬¬äºŒä¸ªå±‚æ¬¡å°±æ˜¯è®©æœºå™¨ä¹Ÿå°‘åšäº‹å„¿ï¼Œå°±èƒ½å†ä¸€æ¬¡æ€èµ·æŠ€æœ¯é©å‘½ï¼Œæé«˜è¿è¡Œæ•ˆç‡ï¼è®©æœºå™¨å°‘åšäº‹å„¿ï¼Œä¹Ÿå¯ä»¥å½’åˆ°ä»¥ä¸‹ä¸¤ä¸ªå±‚é¢</p>
<ul>
<li><p>ä»£ç ï¼šè®©å•å°æœºå™¨ä¸Šçš„ä»£ç å°‘åšäº‹å„¿ï¼ˆå‡å°‘ä»£ç çº§åˆ«çš„å†—ä½™ï¼‰</p>
</li>
<li><p>æµç¨‹ï¼šç²¾ç®€ä¸šåŠ¡é›†ç¾¤çš„å·¥ä½œæµç¨‹ï¼ˆå‡å°‘ä¸å¿…è¦çš„æµç¨‹å’Œäº¤äº’ï¼‰</p>
</li>
</ul>
<p>é’ˆå¯¹ä¸Šé¢æåˆ°çš„ä»£ç çº§åˆ«çš„<code>å°‘åšäº‹å„¿</code>å®è·µä¸­ï¼Œæœ€å¸¸è§çš„å°±æ˜¯ä¼˜åŒ–ä¸šåŠ¡é€»è¾‘å’Œç®—æ³•ï¼Œæ¯”å¦‚è´­ç‰©å¹³å°çš„å•†å“æ¨èç®—æ³•ã€æœç´¢å¼•æ“é‡Œæ¨é€å¹¿å‘Šçš„ç®—æ³•ç­‰ç­‰ï¼›è¿˜æœ‰ä¸€ç§æƒ…å†µæ˜¯å¹²äº†é‡å¤çš„äº‹æƒ…ï¼Œéœ€è¦ç²¾ç®€</p>
<p>é’ˆå¯¹æµç¨‹çº§åˆ«çš„<code>å°‘åšäº‹å„¿</code>å®è·µä¸­ï¼Œæœ€å¸¸è§çš„ä¼˜åŒ–æ–¹æ³•æ˜¯è°ƒæ•´æŠ€æœ¯æ¶æ„ï¼Œç²¾ç®€ä¸å¿…è¦çš„æµç¨‹å’Œä¸šåŠ¡ç¯èŠ‚ã€‚ä¾‹å¦‚ï¼šæ•°æ®åº“å¾ˆæ…¢ï¼Œå°±ä¸è¦è®©æ•°æ®åº“å¹²é‚£ä¹ˆå¤šæ´»ï¼Œåœ¨æ•°æ®å±‚ä¹‹ä¸ŠåŠ å…¥ä¸­é—´ä»¶å°±æ˜¯è®©æ•°æ®åº“å°‘å¹²æ´»çš„ç»å…¸ä½“ç°ã€‚å†ä¾‹å¦‚ï¼šä¸šåŠ¡é€»è¾‘æ–¹é¢ï¼Œå¯ä»¥è®©ç”¨æˆ·ä¸€æ­¥æ“ä½œå°±å®Œæˆçš„äº‹å„¿ï¼Œå°±ä¸è¦å¼„å¾—é‚£ä¹ˆç¹çã€‚</p>
<p>ä»¥ä¸Šæ˜¯åŸºäº<code>å°‘åšäº‹å„¿</code>çš„ä¸ªäººç†è§£ã€‚æåˆ°ä»Šå¤©åˆ†äº«çš„å†…å®¹ï¼Œæˆ‘æƒ³èµ·åˆ˜é¾™å†›â€œå‰è¾ˆâ€å…³äºâ€œå¾®æœåŠ¡â€ç†å¿µçš„é‚£æ¬¡åˆ†äº«ï¼Œå¾®æœåŠ¡å…¶ä¸­è§£å†³çš„é—®é¢˜ä¹‹ä¸€å°±æ˜¯å†—ä½™é—®é¢˜ï¼Œæˆ‘è§‰å¾—æˆ‘ä»¬å¯ä»¥æŠŠå¾®æœåŠ¡ç†å¿µç†è§£æˆé¢å‘å¯¹è±¡ç¼–ç¨‹é‡Œçš„å°è£…è¿™ä¸ªæ¦‚å¿µï¼é¢å‘å¯¹è±¡çš„ç»ˆæç›®æ ‡æ˜¯å‡å°‘é‡å¤ä»£ç ï¼Œå®é™…ä¹Ÿæ˜¯å°‘åšäº‹å„¿çš„ä¸€ç§ä½“ç°ã€‚æ‰€ä»¥å¾®æœåŠ¡å½“ä»Šå¤§è¡Œå…¶é“æ˜¯å¤§åŠ¿æ‰€è¶‹ã€‚</p>
<hr>
<p>æœ€åå’Œå¤§å®¶åˆ†äº«ä¸¤ä¸ªæˆ‘ä¸ªäººå…³äº<code>å°‘åšäº‹å„¿</code>çš„å®è·µæ¡ˆä¾‹</p>
<blockquote>
<p>èƒŒæ™¯ï¼šæˆ‘ä¸Šå®¶å…¬å¸çš„æ—¥å¿—å¤„ç†æµç¨‹ï¼Œæ¯å¤©å‡Œæ™¨è„šæœ¬åœ¨clientç«¯æ”¶é›†æ˜¨å¤©çš„æ—¥å¿—ï¼Œå¤„ç†åæ‰“åŒ…ä¸Šä¼ åˆ°åˆ†æ±‡æ€»ï¼Œåˆ†æ±‡æ€»æ‹¿åˆ°æ‰€æœ‰æ•°æ®åå¯¹æ•°æ®è¿›è¡Œå¤„ç†åä¸Šä¼ åˆ°æ±‡æ€»ï¼Œæ±‡æ€»å¯¹æ•°æ®å¤„ç†åå°†æºæ•°æ®æ‰“åŒ…ä¸Šä¼ åˆ°å¤‡ä»½æœåŠ¡å™¨ã€‚å¤§è‡´æµç¨‹ï¼š clientâ€“&gt;åˆ†æ±‡æ€»â€“&gt;æ±‡æ€»â€“&gt;å¤‡ä»½</p>
</blockquote>
<ul>
<li><p><code>å°‘åšäº‹å„¿</code>ä»£ç çº§åˆ«çš„ä½“ç°ï¼šåœ¨clientç«¯ï¼ŒæœåŠ¡å™¨ä»¥åŠåº”ç”¨çš„ä¸€äº›å‚æ•°ç»å¸¸å˜åŒ–ï¼Œå¯¼è‡´è„šæœ¬ç»å¸¸å› ä¸ºå„ç§æƒ…å†µè€Œå´©æºƒã€‚ç»è¿‡é•¿æ—¶é—´çš„è€ƒå¯Ÿï¼Œæˆ‘å†³å®šæ¯”è¾ƒæ¿€è¿›çš„å°†clientç«¯çš„ç¯å¢ƒå˜é‡æ ¹æ®æ›´æ–°é¢‘ç‡çš„ä¸åŒåˆ†ä¸ºä¸‰ä¸ªç­‰çº§ï¼Œæ¯ä¸ªç­‰çº§çš„å˜é‡çš„åˆ·æ–°éƒ½æœ‰è‡ªå·±å¯¹åº”çš„æ–¹å¼ï¼Œå®ç°äº†<code>å°‘åšäº‹å„¿</code>çš„ç†å¿µ</p>
<ol>
<li><p>å˜é‡è¢«åˆ†çº§ï¼Œæ¯å¤©è„šæœ¬è‡ªåŠ¨åˆ·æ–°çš„å˜é‡åªæœ‰è·å–IPå’Œæ—¶é—´ï¼ˆä¹‹å‰æ˜¯æ¯å¤©éƒ½åˆ·æ–°æ‰€æœ‰çš„ç¯å¢ƒå˜é‡ï¼‰ï¼Œå‡å°‘å› ä¸ºäººå·¥è¯¯æ“ä½œä¿¡æ¯è¡¨ï¼Œè€Œè¯»å–åˆ°é”™è¯¯çš„åº”ç”¨é…ç½®ä¿¡æ¯</p>
</li>
<li><p>å¾—ç›Šäºå˜é‡åˆ·æ–°åˆ†çº§åˆ¶ï¼ŒåŸæ¥è„šæœ¬ä¸­å¯¹äºå„ç§å„æ ·æ„å¤–æƒ…å†µçš„tryä»£ç å—å¯ä»¥å®Œå…¨å‰”é™¤</p>
</li>
</ol>
</li>
<li><p><code>å°‘åšäº‹å„¿</code>æµç¨‹çº§åˆ«çš„ä½“ç°ï¼šåŸæ—¥å¿—å¤‡ä»½ä»clientç«¯åˆ°å¤‡ä»½æœåŠ¡å™¨ï¼Œéœ€è¦ç»è¿‡åˆ†æ±‡æ€»å’Œæ±‡æ€»ä¸¤é“å…³å¡ã€‚ç†Ÿæ‚‰ä¸šåŠ¡æµç¨‹å¹¶ä¿è¯æ—¥å¿—æœ‰è¶³å¤Ÿå¤šçš„å†—ä½™å¤‡ä»½åï¼Œå‰”é™¤æ‰äº†æ±‡æ€»è¿™ä¸€å±‚çš„å¤‡ä»½æµç¨‹ã€‚ç”±ï¼š clientâ€“&gt;åˆ†æ±‡æ€»â€“&gt;æ±‡æ€»â€“&gt;å¤‡ä»½  ç®€åŒ–ä¸ºï¼š clientâ€“&gt;åˆ†æ±‡æ€»&amp;å¤‡ä»½â€“&gt;æ±‡æ€»</p>
<ol>
<li>åˆ†æ±‡æ€»æ‹¿åˆ°æºæ•°æ®åŒ…åç›´æ¥å°†ä¸Šä¼ åˆ°å¤‡ä»½æœåŠ¡å™¨ï¼Œä¸å†ç»è¿‡æ±‡æ€»æœåŠ¡å™¨ï¼Œå‡å°‘äº†ä¸€ä¸ªæµç¨‹ï¼Œæ•ˆç‡å°±ä¸€å®šæœ‰æé«˜ï¼</li>
</ol>
</li>
</ul>
<p>ä¸Šé¢ä¸¾çš„ä¸¤ä¸ªå®é™…æ¡ˆä¾‹éƒ½æ˜¯<code>å°‘åšäº‹å„¿</code>çš„éå¸¸ç®€å•çš„åº”ç”¨ï¼Œå¸Œæœ›æŠ›ç –å¼•ç‰ï¼Œå¯ä»¥ç»™å¤§å®¶ä¸€ç‚¹å¯å‘<del>~</del></p>
]]></content>
      <categories>
        <category>Other</category>
      </categories>
  </entry>
  <entry>
    <title>Pythonå­¦ä¹ ç¬”è®°[2]</title>
    <url>/2016/05/22/Python%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-2/</url>
    <content><![CDATA[<blockquote>
<ol>
<li>å¸¸è§çš„æ•°æ®ç±»å‹</li>
<li>å­—ç¬¦ä¸²çš„å¸¸ç”¨æ“ä½œ</li>
<li>åˆ—è¡¨çš„è¯­æ³•å’Œä½¿ç”¨</li>
<li>å…ƒç»„çš„è¯­æ³•å’Œä½¿ç”¨</li>
<li>å­—å…¸çš„è¯­æ³•å’Œä½¿ç”¨</li>
</ol>
</blockquote>
<h1 id="å¸¸è§çš„æ•°æ®ç±»å‹"><a href="#å¸¸è§çš„æ•°æ®ç±»å‹" class="headerlink" title="å¸¸è§çš„æ•°æ®ç±»å‹"></a>å¸¸è§çš„æ•°æ®ç±»å‹</h1><p>Pythonä¸­çš„æ•°æ®ç±»å‹å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼Œä¸€ç±»æ˜¯ <code>åŸºæœ¬æ•°æ®ç±»å‹</code> ä¸€ç±»æ˜¯ <code>å¼•ç”¨æ•°æ®ç±»å‹</code> </p>
<h2 id="åŸºæœ¬æ•°æ®ç±»å‹"><a href="#åŸºæœ¬æ•°æ®ç±»å‹" class="headerlink" title="åŸºæœ¬æ•°æ®ç±»å‹"></a>åŸºæœ¬æ•°æ®ç±»å‹</h2><ul>
<li>å­—ç¬¦å‹ï¼š â€˜aâ€™, â€˜messageâ€™</li>
<li>æ•°å€¼å‹ï¼š 59, 1991.59</li>
<li>å¸ƒå°”ç±»å‹: True, False</li>
</ul>
<h2 id="å¼•ç”¨æ•°æ®ç±»å‹"><a href="#å¼•ç”¨æ•°æ®ç±»å‹" class="headerlink" title="å¼•ç”¨æ•°æ®ç±»å‹"></a>å¼•ç”¨æ•°æ®ç±»å‹</h2><ul>
<li>åˆ—è¡¨ï¼š [1, 2, 3], [â€˜abcâ€™, â€˜xyzâ€™]</li>
<li>å…ƒç»„ï¼š (1, 2, 3), (â€˜abcâ€™, â€˜xyzâ€™)</li>
<li>å­—å…¸ï¼š {â€˜nameâ€™=â€™larryâ€™, â€˜ageâ€™: 25}</li>
<li>ç±»</li>
</ul>
<p><strong>åŸºæœ¬æ•°æ®ç±»å‹ä¸å¼•ç”¨æ•°æ®ç±»å‹çš„åŒºåˆ«ï¼šå‰è€…ä¼ å€¼ï¼Œåè€…ä¼ å€</strong></p>
<h1 id="å­—ç¬¦ä¸²çš„å¸¸ç”¨æ“ä½œ"><a href="#å­—ç¬¦ä¸²çš„å¸¸ç”¨æ“ä½œ" class="headerlink" title="å­—ç¬¦ä¸²çš„å¸¸ç”¨æ“ä½œ"></a>å­—ç¬¦ä¸²çš„å¸¸ç”¨æ“ä½œ</h1><ul>
<li>ç§»é™¤å­—ç¬¦ä¸²çš„ä¸¤ç«¯ç©ºç™½å­—ç¬¦</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">In [<span class="number">12</span>]: a = <span class="string">'   aa   '</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">13</span>]: a</span><br><span class="line">Out[<span class="number">13</span>]: <span class="string">'   aa   '</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">14</span>]: a.strip()</span><br><span class="line">Out[<span class="number">14</span>]: <span class="string">'aa'</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">15</span>]: a.lstrip()</span><br><span class="line">Out[<span class="number">15</span>]: <span class="string">'aa   '</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">16</span>]: a.rstrip()</span><br><span class="line">Out[<span class="number">16</span>]: <span class="string">'   aa'</span></span><br></pre></td></tr></table></figure>

<ul>
<li>å°†å­—ç¬¦ä¸²ä»¥æŒ‡å®šçš„åˆ†å‰²ç¬¦åˆ†å‰²æˆåˆ—è¡¨</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">In [<span class="number">17</span>]: a = <span class="string">'a,b,c,d,e'</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">18</span>]: a.split(<span class="string">','</span>)</span><br><span class="line">Out[<span class="number">18</span>]: [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>]</span><br></pre></td></tr></table></figure>

<ul>
<li>ç»Ÿè®¡å­—ç¬¦ä¸²é•¿åº¦</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">In [<span class="number">19</span>]: a = <span class="string">'I am Chinese!'</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">20</span>]: len(a)</span><br><span class="line">Out[<span class="number">20</span>]: <span class="number">13</span></span><br></pre></td></tr></table></figure>

<ul>
<li>åœ¨å­—ç¬¦ä¸²ä¸­æ‰¾åˆ°æŒ‡å®šå­—ç¬¦çš„ä½ç½®</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">21</span>]: a = <span class="string">'polarsnow'</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">22</span>]: a.index(<span class="string">'o'</span>)</span><br><span class="line">Out[<span class="number">22</span>]: <span class="number">1</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">23</span>]: a.index(<span class="string">'o'</span>, <span class="number">2</span>)</span><br><span class="line">Out[<span class="number">23</span>]: <span class="number">7</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">24</span>]: a.index(<span class="string">'o'</span>, <span class="number">2</span>, <span class="number">6</span>)</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">ValueError                                Traceback (most recent call last)</span><br><span class="line">&lt;ipython-input<span class="number">-24</span><span class="number">-2</span>bb3a06d2fe6&gt; <span class="keyword">in</span> &lt;module&gt;()</span><br><span class="line">----&gt; 1 a.index('o', 2, 6)</span><br><span class="line"></span><br><span class="line">ValueError: substring <span class="keyword">not</span> found</span><br></pre></td></tr></table></figure>

<ul>
<li>åˆ‡ç‰‡</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">25</span>]: a = <span class="string">'polarsnow'</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">26</span>]: a[<span class="number">0</span>:<span class="number">5</span>]</span><br><span class="line">Out[<span class="number">26</span>]: <span class="string">'polar'</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">27</span>]: a[:<span class="number">5</span>] </span><br><span class="line">Out[<span class="number">27</span>]: <span class="string">'polar'</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">28</span>]: a[<span class="number">-1</span>]</span><br><span class="line">Out[<span class="number">28</span>]: <span class="string">'w'</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">29</span>]: a[<span class="number">-4</span>:]</span><br><span class="line">Out[<span class="number">29</span>]: <span class="string">'snow'</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">30</span>]: a[<span class="number">5</span>:] </span><br><span class="line">Out[<span class="number">30</span>]: <span class="string">'snow'</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">31</span>]: a[<span class="number">-4</span>:<span class="number">-1</span>]  <span class="comment">#æ³¨æ„Pythonä¸­çš„åˆ‡ç‰‡æ˜¯å·¦é—­å³å¼€</span></span><br><span class="line">Out[<span class="number">31</span>]: <span class="string">'sno'</span></span><br></pre></td></tr></table></figure>

<ul>
<li>ç»Ÿè®¡å­—ç¬¦ä¸²ä¸­æŒ‡å®šå­—ç¬¦çš„ä¸ªæ•°</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">In [32]: a &#x3D; &#39;polarsnow&#39;   </span><br><span class="line"></span><br><span class="line">In [33]: a.count(&#39;o&#39;)</span><br><span class="line">Out[33]: 2</span><br></pre></td></tr></table></figure>

<ul>
<li>å°†æŒ‡å®šå­—ç¬¦ä¸²ç½®äºä¸­å¤®</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">34</span>]: a = <span class="string">'polarsnow'</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">35</span>]: a.center(<span class="number">50</span>, <span class="string">'-'</span>)</span><br><span class="line">Out[<span class="number">35</span>]: <span class="string">'--------------------polarsnow---------------------'</span></span><br></pre></td></tr></table></figure>

<ul>
<li>åˆ¤æ–­æ˜¯å¦ä»¥æŒ‡å®šå­—ç¬¦ä¸²å¼€å¤´æˆ–ç»“å°¾</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">38</span>]: a = <span class="string">'polarsnow'</span>  </span><br><span class="line"></span><br><span class="line">In [<span class="number">39</span>]: a.endswith(<span class="string">'ow'</span>)</span><br><span class="line">Out[<span class="number">39</span>]: <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">40</span>]: a.startswith(<span class="string">'po'</span>)</span><br><span class="line">Out[<span class="number">40</span>]: <span class="literal">True</span></span><br></pre></td></tr></table></figure>

<ul>
<li>å­—ç¬¦ä¸²å¤§å°å†™æˆ–é¦–å­—æ¯å¤§å†™</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">41</span>]: a = <span class="string">'polarsnow'</span>   </span><br><span class="line"></span><br><span class="line">In [<span class="number">42</span>]: a.upper()</span><br><span class="line">Out[<span class="number">42</span>]: <span class="string">'POLARSNOW'</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">43</span>]: a.upper().lower()</span><br><span class="line">Out[<span class="number">43</span>]: <span class="string">'polarsnow'</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">44</span>]: a.capitalize()</span><br><span class="line">Out[<span class="number">44</span>]: <span class="string">'Polarsnow'</span></span><br></pre></td></tr></table></figure>

<ul>
<li>å­—ç¬¦ä¸²å±æ€§åˆ¤æ–­-isalnum-æ˜¯å¦åªå«æœ‰å­—æ¯å’Œæ•°å­—</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">46</span>]: a = <span class="string">'polarsnow'</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">47</span>]: a.isalnum()    </span><br><span class="line">Out[<span class="number">47</span>]: <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">48</span>]: a = <span class="string">'polarsnow%'</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">49</span>]: a.isalnum()     </span><br><span class="line">Out[<span class="number">49</span>]: <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">50</span>]: a = <span class="string">'polarsnow5'</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">51</span>]: a.isalnum()     </span><br><span class="line">Out[<span class="number">51</span>]: <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">52</span>]: a = <span class="string">'polar snow'</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">53</span>]: a.isalnum()     </span><br><span class="line">Out[<span class="number">53</span>]: <span class="literal">False</span></span><br></pre></td></tr></table></figure>

<ul>
<li>å­—ç¬¦ä¸²å±æ€§åˆ¤æ–­-isalpha-æ˜¯å¦åªå«æœ‰å­—æ¯</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">54</span>]: a = <span class="string">'polarsnow'</span> </span><br><span class="line"></span><br><span class="line">In [<span class="number">55</span>]: a.isalpha()</span><br><span class="line">Out[<span class="number">55</span>]: <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">56</span>]: a = <span class="string">'polarsnow%'</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">57</span>]: a.isalpha()     </span><br><span class="line">Out[<span class="number">57</span>]: <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">58</span>]: a = <span class="string">'polarsnow5'</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">59</span>]: a.isalpha()     </span><br><span class="line">Out[<span class="number">59</span>]: <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">60</span>]: a = <span class="string">'polar snow'</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">61</span>]: a.isalpha()     </span><br><span class="line">Out[<span class="number">61</span>]: <span class="literal">False</span></span><br></pre></td></tr></table></figure>

<ul>
<li>å­—ç¬¦ä¸²å±æ€§åˆ¤æ–­-isdigit-æ˜¯å¦åªåŒ…å«æ•°å­—</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">In [<span class="number">62</span>]: a = <span class="string">'123'</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">63</span>]: a.isdigit()</span><br><span class="line">Out[<span class="number">63</span>]: <span class="literal">True</span></span><br><span class="line">``</span><br><span class="line"></span><br><span class="line">- å­—ç¬¦ä¸²å±æ€§åˆ¤æ–­-isspace-æ˜¯å¦åªåŒ…å«ç©ºæ ¼</span><br><span class="line"></span><br><span class="line">```python</span><br><span class="line">In [<span class="number">71</span>]: a = <span class="string">' '</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">72</span>]: a.isspace()</span><br><span class="line">Out[<span class="number">72</span>]: <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">73</span>]: a = <span class="string">''</span>     </span><br><span class="line"></span><br><span class="line">In [<span class="number">74</span>]: a.isspace()</span><br><span class="line">Out[<span class="number">74</span>]: <span class="literal">False</span></span><br></pre></td></tr></table></figure>

<ul>
<li>å­—ç¬¦ä¸²å…¶ä»–å±æ€§åˆ¤æ–­</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">str.isupper()  <span class="comment">#æ£€æŸ¥å­—ç¬¦ä¸²æ‰€æœ‰çš„å­—æ¯æ˜¯å¦å…¨éƒ¨ä¸ºå¤§å†™</span></span><br><span class="line">str.islower()  <span class="comment">#æ£€æŸ¥å­—ç¬¦ä¸²çš„æ‰€æœ‰å­—æ¯æ˜¯å¦å…¨éƒ¨ä¸ºå°å†™</span></span><br><span class="line">str.istitle()  <span class="comment">#æ£€æŸ¥å­—ç¬¦ä¸²çš„æ‰€æœ‰å•è¯æ‹¼å†™æ˜¯å¦é¦–å­—æ¯å¤§å†™ï¼Œå…¶ä½™å°å†™</span></span><br></pre></td></tr></table></figure>

<ul>
<li>å­—ç¬¦ä¸²æ‹¼æ¥å¯è¿­ä»£å¯¹è±¡</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">l = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line">print(<span class="string">""</span>.join(l))</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"/Users/lvrui/PycharmProjects/untitled/4/test.py"</span>, line <span class="number">2</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    print(<span class="string">""</span>.join(l))</span><br><span class="line">TypeError: sequence item <span class="number">0</span>: expected str instance, int found</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨joinçš„æ–¹å¼æŠŠä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡è¿›è¡Œæ‹¼æ¥çš„åŸºæœ¬è¦æ±‚æ˜¯ï¼Œå¯è¿­ä»£å¯¹è±¡ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ å¿…é¡»æ˜¯å­—ç¬¦ä¸²ï¼ï¼ï¼</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">l = [<span class="string">'1'</span>, <span class="string">'2'</span>, <span class="string">'3'</span>, <span class="string">'4'</span>, <span class="string">'5'</span>]</span><br><span class="line">print(<span class="string">"+"</span>.join(l))</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line"><span class="number">1</span>+<span class="number">2</span>+<span class="number">3</span>+<span class="number">4</span>+<span class="number">5</span></span><br></pre></td></tr></table></figure>


<h1 id="åˆ—è¡¨çš„å¸¸ç”¨æ“ä½œ"><a href="#åˆ—è¡¨çš„å¸¸ç”¨æ“ä½œ" class="headerlink" title="åˆ—è¡¨çš„å¸¸ç”¨æ“ä½œ"></a>åˆ—è¡¨çš„å¸¸ç”¨æ“ä½œ</h1><ul>
<li>åˆ—è¡¨çš„å®šä¹‰</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">list_a = []  <span class="comment">#å®šä¹‰äº†ä¸€ä¸ªç©ºåˆ—è¡¨</span></span><br><span class="line">list_b = [<span class="number">1</span>, <span class="string">'a'</span>, [<span class="number">2</span>, <span class="string">'z'</span>]]  <span class="comment">#åµŒå¥—åˆ—è¡¨</span></span><br></pre></td></tr></table></figure>

<ul>
<li>åˆ—è¡¨çš„ç´¢å¼•/å–å€¼</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">75</span>]: a = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'a'</span>, <span class="string">'d'</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">76</span>]: a[<span class="number">0</span>]</span><br><span class="line">Out[<span class="number">76</span>]: <span class="string">'a'</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">77</span>]: a[<span class="number">1</span>]</span><br><span class="line">Out[<span class="number">77</span>]: <span class="string">'b'</span></span><br></pre></td></tr></table></figure>

<ul>
<li>åˆ—è¡¨çš„åˆ‡ç‰‡</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">78</span>]: a = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'a'</span>, <span class="string">'d'</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">79</span>]: a[<span class="number">2</span>:]</span><br><span class="line">Out[<span class="number">79</span>]: [<span class="string">'c'</span>, <span class="string">'a'</span>, <span class="string">'d'</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">80</span>]: a[<span class="number">-1</span>]</span><br><span class="line">Out[<span class="number">80</span>]: <span class="string">'d'</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">81</span>]: a[<span class="number">-2</span>:]  </span><br><span class="line">Out[<span class="number">81</span>]: [<span class="string">'a'</span>, <span class="string">'d'</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">82</span>]: a[<span class="number">1</span>:<span class="number">3</span>]</span><br><span class="line">Out[<span class="number">82</span>]: [<span class="string">'b'</span>, <span class="string">'c'</span>]  <span class="comment">#ä¸å­—ç¬¦ä¸²çš„åˆ‡ç‰‡ç›¸åŒï¼Œä¹Ÿè¦æ³¨æ„å·¦é—­å³å¼€</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">128</span>]: a = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'a'</span>, <span class="string">'d'</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">129</span>]: a[::<span class="number">2</span>]  <span class="comment">#è®¾ç½®æ­¥é•¿</span></span><br><span class="line">Out[<span class="number">129</span>]: [<span class="string">'a'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>]</span><br></pre></td></tr></table></figure>

<ul>
<li>åˆ—è¡¨çš„éå†</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">83</span>]: a = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'a'</span>, <span class="string">'d'</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">84</span>]: <span class="keyword">for</span> item <span class="keyword">in</span> a:</span><br><span class="line">   ....:     <span class="keyword">print</span> item</span><br><span class="line">   ....:     </span><br><span class="line">a</span><br><span class="line">b</span><br><span class="line">c</span><br><span class="line">a</span><br><span class="line">d</span><br></pre></td></tr></table></figure>

<ul>
<li>å‘åˆ—è¡¨ä¸­è¿½åŠ æ•°æ®</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">85</span>]: a = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'a'</span>, <span class="string">'d'</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">86</span>]: a.append(<span class="string">'xxx'</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">87</span>]: a</span><br><span class="line">Out[<span class="number">87</span>]: [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'a'</span>, <span class="string">'d'</span>, <span class="string">'xxx'</span>]</span><br></pre></td></tr></table></figure>

<ul>
<li>å‘åˆ—è¡¨ä¸­æ’å…¥æ•°æ®</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">107</span>]: a = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'a'</span>, <span class="string">'d'</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">108</span>]: a.insert(<span class="number">0</span>, <span class="string">'xxx'</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">109</span>]: a</span><br><span class="line">Out[<span class="number">109</span>]: [<span class="string">'xxx'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'a'</span>, <span class="string">'d'</span>]</span><br></pre></td></tr></table></figure>

<ul>
<li>åˆ é™¤åˆ—è¡¨ä¸­çš„å…ƒç´ </li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">88</span>]: a = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'a'</span>, <span class="string">'d'</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">89</span>]: <span class="keyword">del</span> a[<span class="number">0</span>]  <span class="comment">#ä¸‡èƒ½åˆ é™¤æ³• å¯ä»¥å°†æ•´ä¸ªå˜é‡åˆ é™¤</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">90</span>]: a</span><br><span class="line">Out[<span class="number">90</span>]: [<span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'a'</span>, <span class="string">'d'</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">91</span>]: a.pop()  <span class="comment">#å°†åˆ—è¡¨æœ€åä¸€ä¸ªå…ƒç´ åˆ é™¤</span></span><br><span class="line">Out[<span class="number">91</span>]: <span class="string">'d'</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">92</span>]: a</span><br><span class="line">Out[<span class="number">92</span>]: [<span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'a'</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">93</span>]: a.remove(<span class="string">'c'</span>)  <span class="comment">#åˆ é™¤åˆ—è¡¨ä¸­ï¼Œç¬¬ä¸€æ¬¡å‡ºç°çš„æŒ‡å®šå…ƒç´ ï¼ˆå³ä½¿æœ‰ä¸¤ä¸ªcï¼Œåªä¼šåˆ é™¤ç¬¬ä¸€ä¸ªï¼‰</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">94</span>]: a</span><br><span class="line">Out[<span class="number">94</span>]: [<span class="string">'b'</span>, <span class="string">'a'</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">95</span>]: a = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'a'</span>, <span class="string">'d'</span>]  <span class="comment">#é‡æ–°èµ‹å€¼</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">96</span>]: a</span><br><span class="line">Out[<span class="number">96</span>]: [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'a'</span>, <span class="string">'d'</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">97</span>]: <span class="keyword">del</span> a[<span class="number">1</span>:<span class="number">4</span>]  <span class="comment">#åˆ é™¤è¿ç»­çš„å…ƒç´  æ³¨æ„å·¦é—­å³å¼€</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">98</span>]: a</span><br><span class="line">Out[<span class="number">98</span>]: [<span class="string">'a'</span>, <span class="string">'d'</span>]</span><br></pre></td></tr></table></figure>

<ul>
<li>ä¿®æ”¹åˆ—è¡¨ä¸­çš„å…ƒç´ </li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">101</span>]: a = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'a'</span>, <span class="string">'d'</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">102</span>]: a[<span class="number">3</span>] = <span class="string">'d'</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">103</span>]: a[<span class="number">4</span>] = <span class="string">'e'</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">104</span>]: a</span><br><span class="line">Out[<span class="number">104</span>]: [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>]</span><br></pre></td></tr></table></figure>

<ul>
<li>åˆ—è¡¨çš„é•¿åº¦</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">105</span>]: a = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'a'</span>, <span class="string">'d'</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">106</span>]: len(a)</span><br><span class="line">Out[<span class="number">106</span>]: <span class="number">5</span>  <span class="comment">#é•¿åº¦ä¸º5 æ³¨æ„ç´¢å¼•åªåˆ°4</span></span><br></pre></td></tr></table></figure>

<ul>
<li>ç»Ÿè®¡åˆ—è¡¨ä¸­æŒ‡å®šå…ƒç´ çš„ä¸ªæ•°</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">110</span>]: a = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'a'</span>, <span class="string">'d'</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">111</span>]: a.count(<span class="string">'a'</span>)</span><br><span class="line">Out[<span class="number">111</span>]: <span class="number">2</span></span><br></pre></td></tr></table></figure>

<ul>
<li>å°†åˆ—è¡¨ä¸­çš„å…ƒç´ é¡ºåºåè½¬</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">112</span>]: a = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'a'</span>, <span class="string">'d'</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">113</span>]: a.reverse()</span><br><span class="line"></span><br><span class="line">In [<span class="number">114</span>]: a</span><br><span class="line">Out[<span class="number">114</span>]: [<span class="string">'d'</span>, <span class="string">'a'</span>, <span class="string">'c'</span>, <span class="string">'b'</span>, <span class="string">'a'</span>]</span><br></pre></td></tr></table></figure>

<ul>
<li>æ’åºï¼ˆæ ¹æ®asciiç ï¼‰</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">115</span>]: a = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'a'</span>, <span class="string">'d'</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">116</span>]: a.sort()</span><br><span class="line"></span><br><span class="line">In [<span class="number">117</span>]: a</span><br><span class="line">Out[<span class="number">117</span>]: [<span class="string">'a'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>]</span><br></pre></td></tr></table></figure>

<ul>
<li>åˆ—è¡¨çš„æ‰©å±•</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">120</span>]: a = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'a'</span>, <span class="string">'d'</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">121</span>]: b = [<span class="string">'xxx'</span>, <span class="string">'yyy'</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">122</span>]: a.extend(b)</span><br><span class="line"></span><br><span class="line">In [<span class="number">123</span>]: a</span><br><span class="line">Out[<span class="number">123</span>]: [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'a'</span>, <span class="string">'d'</span>, <span class="string">'xxx'</span>, <span class="string">'yyy'</span>]</span><br></pre></td></tr></table></figure>

<h1 id="å…ƒç»„çš„è¯­æ³•å’Œä½¿ç”¨ï¼ˆå…ƒç»„å°±æ˜¯ä¸å¯å˜çš„åˆ—è¡¨ï¼‰"><a href="#å…ƒç»„çš„è¯­æ³•å’Œä½¿ç”¨ï¼ˆå…ƒç»„å°±æ˜¯ä¸å¯å˜çš„åˆ—è¡¨ï¼‰" class="headerlink" title="å…ƒç»„çš„è¯­æ³•å’Œä½¿ç”¨ï¼ˆå…ƒç»„å°±æ˜¯ä¸å¯å˜çš„åˆ—è¡¨ï¼‰"></a>å…ƒç»„çš„è¯­æ³•å’Œä½¿ç”¨ï¼ˆå…ƒç»„å°±æ˜¯ä¸å¯å˜çš„åˆ—è¡¨ï¼‰</h1><p><strong>å…ƒç»„ä¸­ä¸å¯å¢ï¼Œåˆ ï¼Œæ”¹ã€‚åœ¨å–å€¼çš„æ—¶å€™ä¸åˆ—è¡¨æ“ä½œç±»ä¼¼ï¼Œæœ‰ä»¥ä¸‹å¸¸ç”¨æ–¹æ³•</strong></p>
<ul>
<li><p>tuple.count(): ç»Ÿè®¡æŒ‡å®šå…ƒç´ çš„ä¸ªæ•°</p>
</li>
<li><p>tuple.index(): æ‰¾åˆ°æŒ‡å®šå…ƒç´ çš„ç´¢å¼•</p>
</li>
</ul>
<h1 id="å­—å…¸çš„è¯­æ³•å’Œä½¿ç”¨"><a href="#å­—å…¸çš„è¯­æ³•å’Œä½¿ç”¨" class="headerlink" title="å­—å…¸çš„è¯­æ³•å’Œä½¿ç”¨"></a>å­—å…¸çš„è¯­æ³•å’Œä½¿ç”¨</h1><ul>
<li>å­—å…¸çš„å®šä¹‰</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">132</span>]: a = &#123;&#125;  <span class="comment">#å®šä¹‰äº†ä¸€ä¸ªç©ºå­—å…¸</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">133</span>]: a = &#123;<span class="string">'a'</span>:<span class="number">1</span>, <span class="string">'b'</span>:<span class="number">2</span>, <span class="string">'c'</span>:<span class="number">3</span>&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>å­—å…¸ä¸­å¢åŠ å…ƒç´ /ä¿®æ”¹å…ƒç´ </li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#å­—å…¸æ˜¯ä¸é‡å¤ä¸”æ— åºçš„ï¼Œå¢åŠ å…ƒç´ çš„æ“ä½œå’Œä¿®æ”¹ç±»ä¼¼ï¼Œå¦‚æœå…ƒç´ å­˜åœ¨å³ä¿®æ”¹ï¼Œå¦‚æœå…ƒç´ ä¸å­˜åœ¨å³æ·»åŠ </span></span><br><span class="line"></span><br><span class="line">In [<span class="number">133</span>]: a = &#123;<span class="string">'a'</span>:<span class="number">1</span>, <span class="string">'b'</span>:<span class="number">2</span>, <span class="string">'c'</span>:<span class="number">3</span>&#125;</span><br><span class="line"></span><br><span class="line">In [<span class="number">134</span>]: a[<span class="string">'d'</span>] = <span class="number">4</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">135</span>]: a</span><br><span class="line">Out[<span class="number">135</span>]: &#123;<span class="string">'a'</span>: <span class="number">1</span>, <span class="string">'b'</span>: <span class="number">2</span>, <span class="string">'c'</span>: <span class="number">3</span>, <span class="string">'d'</span>: <span class="number">4</span>&#125;</span><br><span class="line"></span><br><span class="line">In [<span class="number">136</span>]: a[<span class="string">'d'</span>] = <span class="number">59</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">137</span>]: a</span><br><span class="line">Out[<span class="number">137</span>]: &#123;<span class="string">'a'</span>: <span class="number">1</span>, <span class="string">'b'</span>: <span class="number">2</span>, <span class="string">'c'</span>: <span class="number">3</span>, <span class="string">'d'</span>: <span class="number">59</span>&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>åˆ é™¤å­—å…¸ä¸­çš„å…ƒç´ </li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">140</span>]: a = &#123;<span class="string">'a'</span>:<span class="number">1</span>, <span class="string">'b'</span>:<span class="number">2</span>, <span class="string">'c'</span>:<span class="number">3</span>&#125;</span><br><span class="line"></span><br><span class="line">In [<span class="number">141</span>]: a.pop(<span class="string">'b'</span>)  <span class="comment">#å› ä¸ºå­—å…¸æ˜¯æ— åºçš„ ä¸åˆ—è¡¨ä¸­çš„popåˆ é™¤æœ€åä¸€ä¸ªå…ƒç´ çš„æ¦‚å¿µåŒºåˆ†å¼€ è¿™é‡Œéœ€è¦æŒ‡å®šâ€œé”®â€</span></span><br><span class="line">Out[<span class="number">141</span>]: <span class="number">2</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">142</span>]: a</span><br><span class="line">Out[<span class="number">142</span>]: &#123;<span class="string">'a'</span>: <span class="number">1</span>, <span class="string">'c'</span>: <span class="number">3</span>&#125;</span><br><span class="line"></span><br><span class="line">In [<span class="number">143</span>]: <span class="keyword">del</span> a[<span class="string">'a'</span>]  <span class="comment">#ä¸‡èƒ½åˆ é™¤ä¾ç„¶å¥½ç”¨~~~</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">144</span>]: a</span><br><span class="line">Out[<span class="number">144</span>]: &#123;<span class="string">'c'</span>: <span class="number">3</span>&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>æŒ‡å®škeyå–å€¼</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">In [<span class="number">145</span>]: a = &#123;<span class="string">'a'</span>:<span class="number">1</span>, <span class="string">'b'</span>:<span class="number">2</span>, <span class="string">'c'</span>:<span class="number">3</span>&#125;</span><br><span class="line"></span><br><span class="line">In [<span class="number">146</span>]: a[<span class="string">'a'</span>]</span><br><span class="line">Out[<span class="number">146</span>]: <span class="number">1</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">147</span>]: a[<span class="string">'d'</span>]  <span class="comment">#è¿™ç§å–å€¼çš„æ–¹æ³•å¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™æŠ¥é”™</span></span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">KeyError                                  Traceback (most recent call last)</span><br><span class="line">&lt;ipython-input<span class="number">-147</span><span class="number">-0</span>b64a016a51f&gt; <span class="keyword">in</span> &lt;module&gt;()</span><br><span class="line">----&gt; 1 a['d']</span><br><span class="line"></span><br><span class="line">KeyError: <span class="string">'d'</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">148</span>]: a.get(<span class="string">'d'</span>)  <span class="comment">#ä½¿ç”¨getå¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™è¿”å›None</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">149</span>]: </span><br><span class="line"></span><br><span class="line">In [<span class="number">162</span>]: <span class="string">'a'</span> <span class="keyword">in</span> a  <span class="comment">#ä½¿ç”¨ä¸‡èƒ½çš„inè¯­æ³•</span></span><br><span class="line">Out[<span class="number">162</span>]: <span class="literal">True</span></span><br></pre></td></tr></table></figure>

<ul>
<li>æŸ¥æ‰¾æ‰€æœ‰çš„â€é”®â€å’Œæ‰€æœ‰çš„â€œå€¼â€</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">150</span>]: a = &#123;<span class="string">'a'</span>:<span class="number">1</span>, <span class="string">'b'</span>:<span class="number">2</span>, <span class="string">'c'</span>:<span class="number">3</span>&#125;</span><br><span class="line"></span><br><span class="line">In [<span class="number">151</span>]: a.keys()</span><br><span class="line">Out[<span class="number">151</span>]: [<span class="string">'a'</span>, <span class="string">'c'</span>, <span class="string">'b'</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">152</span>]: a.values()</span><br><span class="line">Out[<span class="number">152</span>]: [<span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">153</span>]: a = &#123;<span class="string">'a'</span>:<span class="number">1</span>, <span class="string">'b'</span>:<span class="number">2</span>, <span class="string">'c'</span>:<span class="number">3</span>&#125;</span><br><span class="line"></span><br><span class="line">In [<span class="number">154</span>]: a.items()</span><br><span class="line">Out[<span class="number">154</span>]: [(<span class="string">'a'</span>, <span class="number">1</span>), (<span class="string">'c'</span>, <span class="number">3</span>), (<span class="string">'b'</span>, <span class="number">2</span>)]</span><br><span class="line"></span><br><span class="line">In [<span class="number">155</span>]: <span class="keyword">for</span> k,v <span class="keyword">in</span> a.items():  <span class="comment">#æ‰§è¡Œæ•ˆç‡ä½ä¸‹ï¼ˆæœ‰dict2listçš„è½¬æ¢è¿‡ç¨‹ï¼‰ï¼Œæ•°æ®é‡å¤§ä¸æ¨èä½¿ç”¨</span></span><br><span class="line">   .....:     print(<span class="string">'key: '</span>, k, <span class="string">'value: '</span>, v)</span><br><span class="line">   .....:     </span><br><span class="line">(<span class="string">'key: '</span>, <span class="string">'a'</span>, <span class="string">'value: '</span>, <span class="number">1</span>)</span><br><span class="line">(<span class="string">'key: '</span>, <span class="string">'c'</span>, <span class="string">'value: '</span>, <span class="number">3</span>)</span><br><span class="line">(<span class="string">'key: '</span>, <span class="string">'b'</span>, <span class="string">'value: '</span>, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">170</span>]: <span class="keyword">for</span> key <span class="keyword">in</span> a:  <span class="comment">#é«˜æ•ˆçš„å­—å…¸éå†æ–¹æ³•</span></span><br><span class="line">   .....:     print(key, a[key])</span><br><span class="line">   .....:     </span><br><span class="line">(<span class="string">'a'</span>, <span class="number">1</span>)</span><br><span class="line">(<span class="string">'c'</span>, <span class="number">3</span>)</span><br><span class="line">(<span class="string">'b'</span>, <span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>ä½¿ç”¨å­åˆ—è¡¨æ›´æ–°ä¸»åˆ—è¡¨ä¸­çš„å…ƒç´ ï¼ˆè¦†ç›–ï¼‰</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">157</span>]: a</span><br><span class="line">Out[<span class="number">157</span>]: &#123;<span class="string">'a'</span>: <span class="number">1</span>, <span class="string">'b'</span>: <span class="number">2</span>, <span class="string">'c'</span>: <span class="number">3</span>&#125;</span><br><span class="line"></span><br><span class="line">In [<span class="number">158</span>]: b = &#123;<span class="string">'c'</span>: <span class="number">59</span>&#125;</span><br><span class="line"></span><br><span class="line">In [<span class="number">159</span>]: a.update(b)</span><br><span class="line"></span><br><span class="line">In [<span class="number">160</span>]: a</span><br><span class="line">Out[<span class="number">160</span>]: &#123;<span class="string">'a'</span>: <span class="number">1</span>, <span class="string">'b'</span>: <span class="number">2</span>, <span class="string">'c'</span>: <span class="number">59</span>&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>dict.setdefault(k,v)</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#æ ¹æ®kå»å–å€¼ï¼Œå¦‚æœæœ‰åˆ™è¿”å›vï¼Œå¦‚æœæ²¡æœ‰åˆ™æ·»åŠ è¿™ä¸ªå…ƒç´ </span></span><br><span class="line">In [<span class="number">164</span>]: a = &#123;<span class="string">'a'</span>:<span class="number">1</span>, <span class="string">'b'</span>:<span class="number">2</span>, <span class="string">'c'</span>:<span class="number">3</span>&#125;</span><br><span class="line"></span><br><span class="line">In [<span class="number">165</span>]: a.setdefault(<span class="string">'a'</span>)</span><br><span class="line">Out[<span class="number">165</span>]: <span class="number">1</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">166</span>]: a.setdefault(<span class="string">'a'</span>, <span class="number">59</span>)</span><br><span class="line">Out[<span class="number">166</span>]: <span class="number">1</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">167</span>]: a.setdefault(<span class="string">'d'</span>, <span class="number">59</span>) </span><br><span class="line">Out[<span class="number">167</span>]: <span class="number">59</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">168</span>]: a</span><br><span class="line">Out[<span class="number">168</span>]: &#123;<span class="string">'a'</span>: <span class="number">1</span>, <span class="string">'b'</span>: <span class="number">2</span>, <span class="string">'c'</span>: <span class="number">3</span>, <span class="string">'d'</span>: <span class="number">59</span>&#125;</span><br></pre></td></tr></table></figure>




]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>suEXEC mechanism enabled (wrapper: /usr/sbin/suexec)</title>
    <url>/2016/03/28/suEXEC-mechanism-enabled-wrapper-usr-sbin-suexec/</url>
    <content><![CDATA[<blockquote>
<p>å‰äº›æ—¥å¿—åœ¨ç ”ç©¶saltstackçš„apiï¼Œä½¿ç”¨äº†httpsçš„æ–¹å¼æ¥è®¿é—®apiï¼Œåˆ›å»ºä¸€å¯¹å„¿å¯†é’¥<code>/etc/pki/tls/certs/localhost.crt</code>å’Œ<code>/etc/pki/tls/certs/localhost.key</code> è¿‡äº†å‡ å¤©åå‘ç°æˆ‘å®éªŒçš„è¿™å°æœºå™¨çš„ApacheæœåŠ¡å®•æ‰äº†ï¼Œè€Œä¸”é‡å¯å¤±è´¥ï¼Œæ•…éšœä¿¡æ¯å¦‚ä¸‹</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">shell&gt; service httpd restart</span><br><span class="line">Stopping httpd:                                            [FAILED]</span><br><span class="line">Starting httpd:                                            [FAILED]</span><br><span class="line"></span><br><span class="line">shell&gt; tail /var/<span class="built_in">log</span>/httpd/error_log</span><br><span class="line">[Mon Mar 28 10:46:36 2016] [notice] suEXEC mechanism enabled (wrapper: /usr/sbin/suexec)</span><br><span class="line"></span><br><span class="line">shell&gt; tail /var/<span class="built_in">log</span>/httpd/ssl_error_log</span><br><span class="line">[Mon Mar 28 10:49:19 2016] [warn] RSA server certificate CommonName (CN) `localhost<span class="string">' does NOT match server name!?</span></span><br><span class="line"><span class="string">[Mon Mar 28 10:49:19 2016] [error] Unable to configure RSA server private key</span></span><br><span class="line"><span class="string">[Mon Mar 28 10:49:19 2016] [error] SSL Library Error: 185073780 error:0B080074:x509 certificate routines:X509_check_private_key:key values mismatch</span></span><br></pre></td></tr></table></figure>

<ul>
<li>å½“æˆ‘å‘ç°é‡å¯å¤±è´¥ä¸”ç»ˆç«¯æ²¡æœ‰æŠ¥é”™è¾“å‡ºæ—¶ï¼Œå½“æ—¶æ‰“å¼€äº†<code>/var/log/message</code>å’Œ<code>/var/log/httpd/error_log</code>ä¸¤ä¸ªlogï¼Œé‡æ–°é‡å¯ApacheæœåŠ¡ï¼Œå‘ç°messageæ²¡æœ‰è¾“å‡ºï¼Œè€Œhttpdçš„error_logæœ‰ä¸€è¡Œ<code>[notice] suEXEC mechanism enabled (wrapper: /usr/sbin/suexec)</code>è¾“å‡º</li>
<li>å‘ç°suEXECä¹‹åï¼Œæˆ‘ç™¾åº¦äº†è¯¥å…³é”®å­—ï¼Œå¾—çŸ¥æ˜¯è´Ÿè´£å¤„ç†CGIå’ŒSSIç¨‹åºçš„è¯·æ±‚ï¼Œå½“æˆ‘çœ‹åˆ°SSLçš„æ—¶å€™ï¼Œå°±çªç„¶æƒ³èµ·ä¹‹å‰åšè¿‡çš„salt-apiçš„å®éªŒï¼Œå½“æ—¶åˆ›å»ºäº†ä¸€å¯¹å„¿å¯†é’¥ï¼Œè¯¥å¯†é’¥è¿‡æœŸæ—¶é—´å¤§æ¦‚æ˜¯24å°æ—¶ï¼ŒçŒœæµ‹å¯èƒ½æ˜¯Apacheçš„é»˜è®¤é…ç½®æ–‡ä»¶åŠ è½½äº†mod_sslæ¨¡å—ï¼Œè€Œä¸”å¼•ç”¨äº†æˆ‘åˆ›å»ºå¯†é’¥å¯¹å„¿çš„é»˜è®¤ä½ç½®ï¼Œè€Œè¯¥å¯†é’¥å´å¤„äºå¤±æ•ˆçŠ¶æ€ï¼Œæ‰€ä»¥ApacheæœåŠ¡æ— æ³•å¯åŠ¨ï¼ˆè¿™æ˜¯å½“æ—¶çš„çŒœæµ‹ï¼‰</li>
<li>çŸ¥é“æ˜¯SSLç›¸å…³çš„é—®é¢˜ä¹‹åï¼Œé©¬ä¸Šæ‰“å¼€<code>/var/log/httpd/ssl_error_log</code>æŸ¥çœ‹æƒ…å†µï¼Œæœ‰å¦‚ä¸‹æŠ¥é”™<code>[warn] RSA server certificate CommonName (CN)</code>localhostâ€™ does NOT match server name!?` å½“çœ‹åˆ°è¿™ä¸€è¡ŒæŠ¥é”™çš„æ—¶å€™ï¼Œå·²ç»ç¡®è®¤ä¸Šé¢çŒœæµ‹çš„ç¬¬ä¸€ç‚¹ï¼Œå°±æ˜¯Apacheçš„é»˜è®¤é…ç½®æ–‡ä»¶åŠ è½½äº†mod_sslæ¨¡å—ï¼Œè€Œä¸”æŒ‡å®šå¯†é’¥å¯¹å„¿çš„ä½ç½®ï¼Œå°±æ˜¯æˆ‘æµ‹è¯•salt-apiæ—¶åˆ›å»ºå¯†é’¥å¯¹å„¿çš„ä½ç½®ã€‚è€Œä¸”è¿˜æœ‰ä¸€ä¸ªé”™è¯¯å°±æ˜¯æˆ‘å¯†é’¥å¯¹å„¿æŒ‡å®šçš„hostnameå’ŒApacheæŒ‡å®šçš„hostnameå¹¶ä¸ç›¸åŒï¼ŒåŸºäºå¯†é’¥å¯¹ä¸»æœºåä¸ç¬¦ä¸å¯†é’¥è¿‡æœŸä¸¤ç‚¹ï¼Œé€ æˆäº†Apacheæ— æ³•å¯åŠ¨çš„æ•…éšœã€‚</li>
<li>ç¡®å®šäº†é—®é¢˜ä¹‹åï¼Œè§£å†³æ–¹æ¡ˆæœ‰å¾ˆå¤šç§ï¼Œæ ¸å¿ƒæ€æƒ³å°±æ˜¯è®©Apacheçš„sslé…ç½®å¤±æ•ˆ<ul>
<li>ç¬¬ä¸€ç§åŠæ³•ï¼Œå¯ä»¥åœ¨Apacheçš„é…ç½®ä¸­ç¦ç”¨mod_sslæ¨¡å—<code>/etc/httpd/conf.d/ssl.conf</code></li>
<li>ç¬¬äºŒç§åŠæ³•ï¼Œåœ¨<code>/etc/httpd/conf.d/ssl.conf</code>é…ç½®æ–‡ä»¶ä¸­ï¼ŒæŒ‡å®šå…¶ä»–å¯†é’¥å¯¹å„¿çš„è·¯å¾„</li>
<li>ç¬¬ä¸‰ç§åŠæ³•ï¼Œæˆ‘çš„salt-apiå·²ç»æµ‹è¯•å®Œæ¯•ï¼Œå¯ä»¥æŠŠåˆ›å»ºçš„å¯†é’¥å¯¹å„¿åˆ é™¤æˆ–æ›´å</li>
</ul>
</li>
<li>æœ€ç»ˆæˆ‘æ˜¯é€‰æ‹©äº†ç¬¬ä¸‰ç§çš„æ–¹æ³•ï¼Œå°†åŸæœ‰çš„å¯†é’¥å¯¹å„¿åŠ äº†<code>.bak</code>åç¼€ï¼Œä¹‹åé‡å¯Apacheæ¢å¤æ­£å¸¸ï¼Œé—®é¢˜è§£å†³ï¼Œå›å¤´å†å»æŸ¥çœ‹<code>/etc/httpd/conf.d/ssl.conf</code>é…ç½®æ–‡ä»¶çš„æ—¶å€™ï¼Œå·²ç»è‡ªåŠ¨å˜æˆäº†<code>/etc/httpd/conf.d/ssl.conf.bak</code>ç›¸å½“äºApacheæ‰¾ä¸åˆ°é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šçš„å¯†é’¥å¯¹å„¿åï¼Œè‡ªåŠ¨ç¦ç”¨äº†mod_sslæ¨¡å—</li>
</ul>
<hr>
<p>å¦‚æœä½ æƒ³äº†è§£suexecæ–¹é¢çš„ä¸œè¥¿ï¼Œå¯ä»¥å‚è€ƒä»¥ä¸‹æ–‡ç« ï¼š</p>
<p><a href="http://blog.csdn.net/hulihong/article/details/5416056" target="_blank" rel="noopener">http://blog.csdn.net/hulihong/article/details/5416056</a></p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Apache</tag>
        <tag>SSL</tag>
      </tags>
  </entry>
  <entry>
    <title>SaltStack RESTful APIçš„è°ƒç”¨[salt-api]</title>
    <url>/2016/03/21/SaltStack-RESTful-API%E7%9A%84%E8%B0%83%E7%94%A8-salt-api/</url>
    <content><![CDATA[<blockquote>
<p>å¦‚æœéœ€è¦é€šè¿‡ç¬¬ä¸‰æ–¹æ¥è°ƒç”¨SaltStackæ—¶ï¼Œä½¿ç”¨SaltStackè‡ªå¸¦çš„Python APIå¹¶ä¸èƒ½å¾ˆå¥½çš„æ»¡è¶³éœ€æ±‚ã€‚å¯ä»¥é€šè¿‡ä½¿ç”¨SaltStackåŸºäºRESTfulé£æ ¼çš„HTTP APIã€‚è¯¥APIæ¨¡å—å¹¶ä¸æ˜¯å†…ç½®çš„ï¼Œéœ€è¦å•ç‹¬å®‰è£…ã€‚</p>
</blockquote>
<h1 id="Salt-REST-APIç®€ä»‹"><a href="#Salt-REST-APIç®€ä»‹" class="headerlink" title="Salt REST APIç®€ä»‹"></a>Salt REST APIç®€ä»‹</h1><p><em>è¿™é‡Œç®€å•çš„è¯´æ˜ä¸‹ï¼ŒSaltStackå®˜æ–¹æ”¯æŒä¸‰ç§REST APIï¼Œåˆ†åˆ«æ˜¯rest_cherry; rest_tonadoå’Œrest_wsgi</em></p>
<ul>
<li>rest_cherryå’Œrest_tonadoä¸¤ä¸ªæ¨¡å—æ”¯æŒç›‘å¬æ‰€æœ‰IPçš„æŒ‡å®šç«¯å£æ¥æ”¶è¯·æ±‚</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">shell&gt; lsof -i:1559</span><br><span class="line">COMMAND    PID USER   FD   TYPE   DEVICE SIZE/OFF NODE NAME</span><br><span class="line">salt-api 13443 root   14u  IPv4 21888585      0t0  TCP *:web2host (LISTEN)</span><br></pre></td></tr></table></figure>

<ul>
<li>rest_wsgiåªæ”¯æŒæœ¬æœºè®¿é—®ï¼Œåªç»‘å®šäº†127.0.0.1</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">shell&gt; lsof -i:1559</span><br><span class="line">COMMAND    PID USER   FD   TYPE   DEVICE SIZE/OFF NODE NAME</span><br><span class="line">salt-api 13443 root   14u  IPv4 21888585      0t0  TCP 127.0.0.1:web2host (LISTEN)</span><br></pre></td></tr></table></figure>

<p><img src="http://oss.20150509.cn/Snip20160321_1.png" alt="image"></p>
<p><strong>æœ¬æ–‡é€‰æ‹©ä½¿ç”¨rest_cherryæ¨¡å—æ¥å®ç°SaltStackçš„HTTP API</strong></p>
<h1 id="å®‰è£…Salt-APIæœåŠ¡"><a href="#å®‰è£…Salt-APIæœåŠ¡" class="headerlink" title="å®‰è£…Salt-APIæœåŠ¡"></a>å®‰è£…Salt-APIæœåŠ¡</h1><p><em>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œsalt-apiä¼šä½¿ç”¨HTTPSï¼Œé¦–æ¬¡é…ç½®æˆåŠŸåï¼Œä½¿ç”¨ç”¨æˆ·åå’Œå¯†ç ç™»é™†ï¼Œè·å¾—Tokenï¼ŒTokenåˆ›å»ºåï¼Œé»˜è®¤æœ‰æ•ˆæœŸæ˜¯12å°æ—¶ï¼Œåœ¨æœ‰æ•ˆæœŸä¹‹å†…ï¼Œä½¿ç”¨è¯¥Tokenå¯ä»¥ä»£æ›¿ä½¿ç”¨ç”¨æˆ·åå’Œå¯†ç æ¥è®¿é—®APIï¼ˆè¯¥æœ‰æ•ˆæ—¶é—´å¯åœ¨salt-masteré…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹ï¼‰</em></p>
<h2 id="å¿…å¤‡å®‰è£…åŒ…"><a href="#å¿…å¤‡å®‰è£…åŒ…" class="headerlink" title="å¿…å¤‡å®‰è£…åŒ…"></a>å¿…å¤‡å®‰è£…åŒ…</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">shell&gt; yum -y install gcc make python-devel libffi-devel</span><br><span class="line">shell&gt; pip install pyOpenSSL==0.15.1</span><br></pre></td></tr></table></figure>

<h2 id="å€ŸåŠ©saltå·¥å…·æ¥ç”Ÿæˆè¯ä¹¦"><a href="#å€ŸåŠ©saltå·¥å…·æ¥ç”Ÿæˆè¯ä¹¦" class="headerlink" title="å€ŸåŠ©saltå·¥å…·æ¥ç”Ÿæˆè¯ä¹¦"></a>å€ŸåŠ©saltå·¥å…·æ¥ç”Ÿæˆè¯ä¹¦</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">shell&gt; salt-call --<span class="built_in">local</span> tls.create_self_signed_cert</span><br><span class="line"><span class="built_in">local</span>:</span><br><span class="line">    Created Private Key: <span class="string">"/etc/pki/tls/certs/localhost.key."</span> Created Certificate: <span class="string">"/etc/pki/tls/certs/localhost.crt."</span></span><br></pre></td></tr></table></figure>

<p><em>salt-callæ˜¯salt-minionçš„å·¥å…·ï¼Œå¦‚æœæ²¡æœ‰è¿™ä¸ªå‘½ä»¤ï¼Œå¯ä»¥åœ¨masterç«¯å®‰è£…minionï¼Œç„¶åå†æ‰§è¡Œä»¥ä¸Šå‘½ä»¤</em></p>
<h2 id="å®‰è£…salt-api"><a href="#å®‰è£…salt-api" class="headerlink" title="å®‰è£…salt-api"></a>å®‰è£…salt-api</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">shell&gt; yum -y install salt-api</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="é…ç½®ç”¨æˆ·åŠæƒé™"><a href="#é…ç½®ç”¨æˆ·åŠæƒé™" class="headerlink" title="é…ç½®ç”¨æˆ·åŠæƒé™"></a>é…ç½®ç”¨æˆ·åŠæƒé™</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">shell&gt; useradd -M -s /sbin/nologin sa</span><br><span class="line">shell&gt; <span class="built_in">echo</span> <span class="string">"sapassword"</span> | passwd sa --stdin</span><br></pre></td></tr></table></figure>

<p>åœ¨salt-masterçš„é…ç½®æ–‡ä»¶æœ€åæ·»åŠ å¦‚ä¸‹é…ç½®</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">external_auth:</span><br><span class="line">  pam:  #è®¤è¯æ¨¡å¼ï¼ŒpamæŒ‡çš„æ˜¯ç”¨Linuxæœ¬èº«çš„ç”¨æˆ·è®¤è¯æ¨¡å¼</span><br><span class="line">    sa:  #Linuxç³»ç»Ÿä¸­çœŸå®å­˜åœ¨çš„ç”¨æˆ·å</span><br><span class="line">      - &#39;*&#39;:  #è®¾ç½®ç”¨æˆ·çš„æƒé™ï¼Œå…è®¸è¯¥ç”¨æˆ·æ“ä½œå“ªäº›ä¸»æœºï¼Œ*ä»£è¡¨å…¨éƒ¨</span><br><span class="line">        - test.*  #å…è®¸æ“ä½œçš„æ¨¡å—åŠæ–¹æ³•</span><br><span class="line">        - cmd.*</span><br></pre></td></tr></table></figure>

<p>å…¶ä»–è®¤è¯æ¨¡å¼å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š<a href="http://docs.saltstack.com/en/latest/topics/eauth/index.html" target="_blank" rel="noopener">http://docs.saltstack.com/en/latest/topics/eauth/index.html</a></p>
<h2 id="é…ç½®ç¤ºä¾‹ä¸€-å¤šç”¨æˆ·ï¼ˆå®˜æ–¹æ–‡æ¡£ï¼‰"><a href="#é…ç½®ç¤ºä¾‹ä¸€-å¤šç”¨æˆ·ï¼ˆå®˜æ–¹æ–‡æ¡£ï¼‰" class="headerlink" title="é…ç½®ç¤ºä¾‹ä¸€:å¤šç”¨æˆ·ï¼ˆå®˜æ–¹æ–‡æ¡£ï¼‰"></a>é…ç½®ç¤ºä¾‹ä¸€:å¤šç”¨æˆ·ï¼ˆå®˜æ–¹æ–‡æ¡£ï¼‰</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">external_auth:</span><br><span class="line">  pam:</span><br><span class="line">    thatch:</span><br><span class="line">      - &#39;web*&#39;:</span><br><span class="line">        - test.*</span><br><span class="line">        - network.*</span><br><span class="line">    steve:</span><br><span class="line">      - .*</span><br></pre></td></tr></table></figure>

<h2 id="é…ç½®ç¤ºä¾‹äºŒï¼šæŒ‡å®šç”¨æˆ·ç»„ï¼ˆå®˜æ–¹æ–‡æ¡£ï¼‰"><a href="#é…ç½®ç¤ºä¾‹äºŒï¼šæŒ‡å®šç”¨æˆ·ç»„ï¼ˆå®˜æ–¹æ–‡æ¡£ï¼‰" class="headerlink" title="é…ç½®ç¤ºä¾‹äºŒï¼šæŒ‡å®šç”¨æˆ·ç»„ï¼ˆå®˜æ–¹æ–‡æ¡£ï¼‰"></a>é…ç½®ç¤ºä¾‹äºŒï¼šæŒ‡å®šç”¨æˆ·ç»„ï¼ˆå®˜æ–¹æ–‡æ¡£ï¼‰</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">external_auth:</span><br><span class="line">  pam:</span><br><span class="line">    admins%:</span><br><span class="line">      - &#39;*&#39;:</span><br><span class="line">        - &#39;pkg.*&#39;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨<code>%</code>æ¥è¡¨ç¤ºç”¨æˆ·ç»„</p>
<h2 id="é…ç½®ç¤ºä¾‹ä¸‰ï¼šæ“ä½œæ¨¡å—ç»„ï¼ˆå®˜æ–¹æ–‡æ¡£ï¼‰"><a href="#é…ç½®ç¤ºä¾‹ä¸‰ï¼šæ“ä½œæ¨¡å—ç»„ï¼ˆå®˜æ–¹æ–‡æ¡£ï¼‰" class="headerlink" title="é…ç½®ç¤ºä¾‹ä¸‰ï¼šæ“ä½œæ¨¡å—ç»„ï¼ˆå®˜æ–¹æ–‡æ¡£ï¼‰"></a>é…ç½®ç¤ºä¾‹ä¸‰ï¼šæ“ä½œæ¨¡å—ç»„ï¼ˆå®˜æ–¹æ–‡æ¡£ï¼‰</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">external_auth:</span><br><span class="line">  pam:</span><br><span class="line">    thatch:</span><br><span class="line">      - &#39;@wheel&#39;   # to allow access to all wheel modules</span><br><span class="line">      - &#39;@runner&#39;  # to allow access to all runner modules</span><br><span class="line">      - &#39;@jobs&#39;    # to allow access to the jobs runner and&#x2F;or wheel module</span><br></pre></td></tr></table></figure>

<p><a href="https://docs.saltstack.com/en/latest/ref/wheel/all/index.html#all-salt-wheel" target="_blank" rel="noopener">ç‚¹æ­¤æŸ¥çœ‹wheel moduleså®Œæ•´åˆ—è¡¨</a></p>
<p><a href="https://docs.saltstack.com/en/latest/ref/runners/all/index.html#all-salt-runners" target="_blank" rel="noopener">ç‚¹æ­¤æŸ¥çœ‹runner moduleså®Œæ•´åˆ—è¡¨</a></p>
<hr>
<h1 id="é…ç½®salt-apiæœåŠ¡"><a href="#é…ç½®salt-apiæœåŠ¡" class="headerlink" title="é…ç½®salt-apiæœåŠ¡"></a>é…ç½®salt-apiæœåŠ¡</h1><p>åœ¨salt-masterçš„é…ç½®æ–‡ä»¶æœ€åæ·»åŠ å¦‚ä¸‹é…ç½®</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rest_cherrypy:</span><br><span class="line">  port: 1559  #é»˜è®¤ç›‘å¬æ‰€æœ‰IPçš„1559ç«¯å£</span><br><span class="line">  ssl_crt: &#x2F;etc&#x2F;pki&#x2F;tls&#x2F;certs&#x2F;localhost.crt  #å¼•ç”¨çš„æ­£æ˜¯å‰é¢åˆ›å»ºçš„è¯ä¹¦</span><br><span class="line">  ssl_key: &#x2F;etc&#x2F;pki&#x2F;tls&#x2F;certs&#x2F;localhost.key</span><br></pre></td></tr></table></figure>

<p>å…¶ä»–é…ç½®å‚æ•°å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š<a href="https://docs.saltstack.com/en/latest/ref/netapi/all/salt.netapi.rest_cherrypy.html" target="_blank" rel="noopener">https://docs.saltstack.com/en/latest/ref/netapi/all/salt.netapi.rest_cherrypy.html</a></p>
<hr>
<h1 id="å¯åŠ¨æœåŠ¡"><a href="#å¯åŠ¨æœåŠ¡" class="headerlink" title="å¯åŠ¨æœåŠ¡"></a>å¯åŠ¨æœåŠ¡</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">shell&gt; service salt-api start</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="ç™»é™†è·å¾—Token"><a href="#ç™»é™†è·å¾—Token" class="headerlink" title="ç™»é™†è·å¾—Token"></a>ç™»é™†è·å¾—Token</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl -sSk https://www.20150509.cn:1559/login \</span><br><span class="line">    -H <span class="string">'Accept: application/x-yaml'</span> \</span><br><span class="line">    -d username=sa \</span><br><span class="line">    -d password=sapassword \</span><br><span class="line">    -d eauth=pam</span><br></pre></td></tr></table></figure>

<p>å¤åˆ¶å¾—åˆ°çš„Token</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl -sSk https://localhost:8000 \</span><br><span class="line">    -H <span class="string">'Accept: application/x-yaml'</span> \</span><br><span class="line">    -H <span class="string">'X-Auth-Token: 697adbdc8fe971d09ae4c2a3add7248859c87079'</span>\</span><br><span class="line">    -d client=<span class="built_in">local</span> \</span><br><span class="line">    -d tgt=<span class="string">'*'</span> \</span><br><span class="line">    -d fun=test.ping</span><br></pre></td></tr></table></figure>

<p><em>é™¤äº†æ”¯æŒTokenä»¥å¤–è¿˜æ”¯æŒä½¿ç”¨cookies.txtæ–‡ä»¶æ¥è®¿é—®APIï¼Œè¯¦æƒ…å¯æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£</em></p>
<hr>
<h1 id="ä½¿ç”¨Pythonè„šæœ¬æ¥è®¿é—®API"><a href="#ä½¿ç”¨Pythonè„šæœ¬æ¥è®¿é—®API" class="headerlink" title="ä½¿ç”¨Pythonè„šæœ¬æ¥è®¿é—®API"></a>ä½¿ç”¨Pythonè„šæœ¬æ¥è®¿é—®API</h1><p><strong>åœ¨salt-apiå®˜æ–¹æ–‡æ¡£ä¸­ï¼Œå¯¹pythonè®¿é—®APIç»™å‡ºäº†å¦‚ä¸‹çš„æ ¼å¼è¦æ±‚</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[&#123;</span><br><span class="line">    <span class="string">"client"</span>: <span class="string">"local"</span>,</span><br><span class="line">    <span class="string">"tgt"</span>: <span class="string">"*"</span>,</span><br><span class="line">    <span class="string">"fun"</span>: <span class="string">"test.fib"</span>,</span><br><span class="line">    <span class="string">"arg"</span>: [<span class="string">"10"</span>]</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"client"</span>: <span class="string">"runner"</span>,</span><br><span class="line">    <span class="string">"fun"</span>: <span class="string">"jobs.lookup_jid"</span>,</span><br><span class="line">    <span class="string">"jid"</span>: <span class="string">"20130603122505459265"</span></span><br><span class="line">&#125;]</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šçš„JSONä»£ç ä¸­ï¼ŒæŒ‡å®šäº†APIå»æ‰§è¡Œä¸¤ä¸ªå‘½ä»¤ï¼Œä¸€ä¸ªæ¨¡å—å‘½ä»¤ï¼Œä¸€ä¸ªrunnerå‘½ä»¤ã€‚Pythonä»£ç å®ç°å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> urllib2</span><br><span class="line"></span><br><span class="line"> <span class="comment">#åœ¨python2.6xä¸­ï¼Œä»¥ä¸‹ä¸¤è¡Œä¸æ˜¯å¿…é¡»çš„</span></span><br><span class="line"><span class="keyword">import</span> ssl </span><br><span class="line">ssl._create_default_https_context = ssl._create_unverified_context</span><br><span class="line"></span><br><span class="line">url=<span class="string">'https://www.20150509.cn:1559'</span>  <span class="comment">#salt-apiæ‰€åœ¨çš„â€œåæ ‡â€</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">()</span>:</span></span><br><span class="line">  pre_data = [&#123;<span class="string">"client"</span>:<span class="string">"local"</span>, <span class="string">"tgt"</span>:<span class="string">"*"</span>, <span class="string">"fun"</span>:<span class="string">"test.ping"</span>&#125;]   <span class="comment">#æ ¹æ®ä¸Šé¢å®˜æ–¹æ–‡æ¡£çš„è¦æ±‚ç»„æˆæ•°ç»„åµŒå¥—å­—å…¸çš„å½¢å¼</span></span><br><span class="line">  json_data = json.dumps(pre_data)    <span class="comment">#å°†å…¶è½¬åŒ–ä¸ºjsonæ ¼å¼</span></span><br><span class="line">  </span><br><span class="line">  header = &#123;<span class="string">"Content-Type"</span>:<span class="string">"application/json"</span>, <span class="string">"Accept"</span>:<span class="string">"application/json"</span>, <span class="string">"X-Auth-Token"</span>:<span class="string">"697adbdc8fe971d09ae4c2a3add7248859c87079"</span>&#125;</span><br><span class="line">  <span class="comment">#è¿™é‡Œè¯´æ˜ä¸‹ï¼ŒContent-Typeæ˜¯å£°æ˜ä¼ é€’ç»™APIçš„æ•°æ®æ˜¯ä»€ä¹ˆæ ¼å¼çš„ï¼Œè¿™é‡ŒæŒ‡å®šäº†jsonï¼Œæ˜¯å› ä¸ºä¸Šé¢çš„pre_dataæ•°æ®è¢«æˆ‘è½¬åŒ–æˆäº†jsonæ ¼å¼</span></span><br><span class="line">  <span class="comment">#Acceptæ˜¯å£°æ˜è¿”å›ç»“æœä»¥ä»€ä¹ˆæ ·çš„æ ¼å¼æ˜¾ç¤ºï¼Œè¿™é‡Œä¹ŸæŒ‡å®šäº†jsonæ ¼å¼æ¥æ˜¾ç¤ºè¿”å›ç»“æœ</span></span><br><span class="line"></span><br><span class="line">  request = urllib2.Request(url, json_data, header)    <span class="comment">#æ„é€ ä¸€æ¬¡è¯·æ±‚</span></span><br><span class="line">  response = urllib2.urlopen(request)    <span class="comment">#æ„é€ ä¸€æ¬¡HTTPè®¿é—®</span></span><br><span class="line"></span><br><span class="line">  html = response.read()</span><br><span class="line">  <span class="keyword">print</span> html</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">"__main__"</span>:</span><br><span class="line">  test()</span><br></pre></td></tr></table></figure>

<p>æŒ‡å®š<code>Accept</code>ä¸º<code>application/json</code>æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">shell&gt; python sa.py </span><br><span class="line">&#123;<span class="string">"return"</span>: [&#123;<span class="string">"vm3.salt.com"</span>: <span class="literal">true</span>, <span class="string">"vm2.salt.com"</span>: <span class="literal">true</span>, <span class="string">"ph1.salt.com"</span>: <span class="literal">true</span>, <span class="string">"ph2.salt.com"</span>: <span class="literal">true</span>, <span class="string">"vm1.salt.com"</span>: <span class="literal">true</span>, <span class="string">"vm4.salt.com"</span>: <span class="literal">true</span>, <span class="string">"localhost"</span>: <span class="literal">true</span>, <span class="string">"vm7.salt.com"</span>: <span class="literal">true</span>&#125;]&#125;</span><br><span class="line"><span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>æŒ‡å®š<code>Accept</code>ä¸º<code>application/x-yaml</code>æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">shell&gt; python sa.py </span><br><span class="line"><span class="built_in">return</span>:</span><br><span class="line">- localhost: <span class="literal">true</span></span><br><span class="line">  ph1.salt.com: <span class="literal">true</span></span><br><span class="line">  ph2.salt.com: <span class="literal">true</span></span><br><span class="line">  vm1.salt.com: <span class="literal">true</span></span><br><span class="line">  vm2.salt.com: <span class="literal">true</span></span><br><span class="line">  vm3.salt.com: <span class="literal">true</span></span><br><span class="line">  vm4.salt.com: <span class="literal">true</span></span><br><span class="line">  vm7.salt.com: <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<hr>
<h1 id="é™„å½•"><a href="#é™„å½•" class="headerlink" title="é™„å½•"></a>é™„å½•</h1><h2 id="RESTful-APIçš„æ—¥å¸¸æ“ä½œ"><a href="#RESTful-APIçš„æ—¥å¸¸æ“ä½œ" class="headerlink" title="RESTful APIçš„æ—¥å¸¸æ“ä½œ"></a>RESTful APIçš„æ—¥å¸¸æ“ä½œ</h2><ul>
<li>è¿è¡Œè¿œç¨‹æ¨¡å—</li>
<li>æŸ¥è¯¢æŒ‡å®šjob</li>
<li>è¿è¡Œrunner</li>
</ul>
<p><strong>ç¨åæœ‰æ—¶é—´ä¼šåˆ†åˆ«è¯¦ç»†ä¸¾å‡ºå‡ ä¸ªä½¿ç”¨æ¡ˆä¾‹</strong></p>
<h2 id="REST-URI-å‚è€ƒ"><a href="#REST-URI-å‚è€ƒ" class="headerlink" title="REST URI å‚è€ƒ"></a>REST URI å‚è€ƒ</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;</span><br><span class="line">&#x2F;login</span><br><span class="line">&#x2F;logout</span><br><span class="line">&#x2F;minions</span><br><span class="line">&#x2F;jobs</span><br><span class="line">&#x2F;run</span><br><span class="line">&#x2F;events</span><br><span class="line">&#x2F;hook</span><br><span class="line">&#x2F;keys</span><br><span class="line">&#x2F;ws</span><br><span class="line">&#x2F;stats</span><br></pre></td></tr></table></figure>

<p><em>è¯¦ç»†ç”¨æ³•å¯å‚è€ƒsalt-api rest_cherryå®˜æ–¹æ–‡æ¡£</em></p>
<h1 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h1><p>salt-apiï¼š<a href="https://github.com/saltstack/salt-api" target="_blank" rel="noopener">https://github.com/saltstack/salt-api</a></p>
<p>rest_cherrypyï¼š<a href="https://docs.saltstack.com/en/latest/ref/netapi/all/salt.netapi.rest_cherrypy.html" target="_blank" rel="noopener">https://docs.saltstack.com/en/latest/ref/netapi/all/salt.netapi.rest_cherrypy.html</a></p>
<p>è®¤è¯æ¨¡å¼ï¼š<a href="http://docs.saltstack.com/en/latest/topics/eauth/index.html" target="_blank" rel="noopener">http://docs.saltstack.com/en/latest/topics/eauth/index.html</a></p>
]]></content>
      <categories>
        <category>SaltStack</category>
      </categories>
      <tags>
        <tag>SaltStack</tag>
        <tag>salt-api</tag>
        <tag>RESTful</tag>
        <tag>HTTPAPI</tag>
        <tag>API</tag>
      </tags>
  </entry>
  <entry>
    <title>urllib2æŠ¥é”™[SSL:CERTIFICATE_VERIFY_FAILED]</title>
    <url>/2016/03/21/urllib2%E6%8A%A5%E9%94%99-SSL-CERTIFICATE-VERIFY-FAILED/</url>
    <content><![CDATA[<blockquote>
<p>åœ¨pythonä¸­ä½¿ç”¨urllib2åº“å»è®¿é—®ä¸€ä¸ªè‡ªç­¾åçš„ç½‘ç«™æ—¶ï¼Œä¼šå‡ºç°å¦‚ä¸‹æŠ¥é”™ï¼š <code>urllib2.URLError: &lt;urlopen error [SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed (_ssl.c:590)&gt;</code></p>
</blockquote>
<p>å‡ºç°ä»¥ä¸Šé”™è¯¯çš„åŸå› æ˜¯å› ä¸ºpythonçš„ç‰ˆæœ¬é—®é¢˜ï¼Œåœ¨python2.6ï¼ˆå«2.6ï¼‰ä»¥ä¸‹ç‰ˆæœ¬ä¸­ï¼Œåœ¨è®¿é—®HTTPSçš„ç½‘ç«™æ—¶ï¼ŒTLSæ¡æ‰‹æœŸé—´ä¸ä¼šæ£€æŸ¥æœåŠ¡å™¨X509çš„è¯ä¹¦ç­¾åæ˜¯å¦æ˜¯CAçš„å¯ä¿¡ä»»æ ¹è¯ä¹¦ã€‚è¿™ç§å±€é¢åœ¨python2.7 3.4 å’Œ 3.5ç‰ˆæœ¬ä¸­å¾—åˆ°äº†ä¿®æ”¹ã€‚</p>
<h3 id="æ‰€ä»¥ï¼Œä»¥ä¸‹ä»£ç åœ¨python2-6ç‰ˆæœ¬ä¸­æµ‹è¯•æ˜¯å®Œå…¨æ²¡æœ‰é—®é¢˜çš„"><a href="#æ‰€ä»¥ï¼Œä»¥ä¸‹ä»£ç åœ¨python2-6ç‰ˆæœ¬ä¸­æµ‹è¯•æ˜¯å®Œå…¨æ²¡æœ‰é—®é¢˜çš„" class="headerlink" title="æ‰€ä»¥ï¼Œä»¥ä¸‹ä»£ç åœ¨python2.6ç‰ˆæœ¬ä¸­æµ‹è¯•æ˜¯å®Œå…¨æ²¡æœ‰é—®é¢˜çš„"></a>æ‰€ä»¥ï¼Œä»¥ä¸‹ä»£ç åœ¨python2.6ç‰ˆæœ¬ä¸­æµ‹è¯•æ˜¯å®Œå…¨æ²¡æœ‰é—®é¢˜çš„</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> urllib2</span><br><span class="line"></span><br><span class="line">url=<span class="string">'https://www.20150509.cn:1559'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">()</span>:</span></span><br><span class="line">  </span><br><span class="line">  pre_data = [&#123;<span class="string">"client"</span>:<span class="string">"local"</span>, <span class="string">"tgt"</span>:<span class="string">"*"</span>, <span class="string">"fun"</span>:<span class="string">"test.ping"</span>&#125;]</span><br><span class="line"></span><br><span class="line">  json_data = json.dumps(pre_data)</span><br><span class="line">  </span><br><span class="line">  header = &#123;<span class="string">"Content-Type"</span>:<span class="string">"application/json"</span>, <span class="string">"Accept"</span>:<span class="string">"application/json"</span>, <span class="string">"X-Auth-Token"</span>:<span class="string">"b91e7uj86g4f97cc**********b92778ujh4kedf"</span>&#125;</span><br><span class="line"></span><br><span class="line">  request = urllib2.Request(url, json_data, header)</span><br><span class="line"></span><br><span class="line">  response = urllib2.urlopen(request)</span><br><span class="line"></span><br><span class="line">  html = response.read()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">print</span> html</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">"__main__"</span>:</span><br><span class="line">  test()</span><br></pre></td></tr></table></figure>

<h4 id="è¿è¡Œæµ‹è¯•"><a href="#è¿è¡Œæµ‹è¯•" class="headerlink" title="è¿è¡Œæµ‹è¯•"></a>è¿è¡Œæµ‹è¯•</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">shell&gt; python sa.py </span><br><span class="line">&#123;<span class="string">"return"</span>: [&#123;<span class="string">"vm3.salt.com"</span>: <span class="literal">true</span>, <span class="string">"vm2.salt.com"</span>: <span class="literal">true</span>, <span class="string">"ph1.salt.com"</span>: <span class="literal">true</span>, <span class="string">"ph2.salt.com"</span>: <span class="literal">true</span>, <span class="string">"vm1.salt.com"</span>: <span class="literal">true</span>, <span class="string">"vm4.salt.com"</span>: <span class="literal">true</span>, <span class="string">"localhost"</span>: <span class="literal">true</span>, <span class="string">"vm7.salt.com"</span>: <span class="literal">true</span>&#125;]&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="åœ¨python2-7-ç‰ˆæœ¬å°±ä¼šæŠ¥ä¸Šè¿°é”™è¯¯"><a href="#åœ¨python2-7-ç‰ˆæœ¬å°±ä¼šæŠ¥ä¸Šè¿°é”™è¯¯" class="headerlink" title="åœ¨python2.7+ç‰ˆæœ¬å°±ä¼šæŠ¥ä¸Šè¿°é”™è¯¯"></a>åœ¨python2.7+ç‰ˆæœ¬å°±ä¼šæŠ¥ä¸Šè¿°é”™è¯¯</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">shell&gt; python sa.py </span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"sa.py"</span>, line 25, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    <span class="built_in">test</span>()</span><br><span class="line">  File <span class="string">"sa.py"</span>, line 17, <span class="keyword">in</span> <span class="built_in">test</span></span><br><span class="line">    response = urllib2.urlopen(request)</span><br><span class="line">  File <span class="string">"/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/urllib2.py"</span>, line 154, <span class="keyword">in</span> urlopen</span><br><span class="line">    <span class="built_in">return</span> opener.open(url, data, timeout)</span><br><span class="line">  File <span class="string">"/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/urllib2.py"</span>, line 431, <span class="keyword">in</span> open</span><br><span class="line">    response = self._open(req, data)</span><br><span class="line">  File <span class="string">"/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/urllib2.py"</span>, line 449, <span class="keyword">in</span> _open</span><br><span class="line">    <span class="string">'_open'</span>, req)</span><br><span class="line">  File <span class="string">"/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/urllib2.py"</span>, line 409, <span class="keyword">in</span> _call_chain</span><br><span class="line">    result = func(*args)</span><br><span class="line">  File <span class="string">"/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/urllib2.py"</span>, line 1240, <span class="keyword">in</span> https_open</span><br><span class="line">    context=self._context)</span><br><span class="line">  File <span class="string">"/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/urllib2.py"</span>, line 1197, <span class="keyword">in</span> do_open</span><br><span class="line">    raise URLError(err)</span><br><span class="line">urllib2.URLError: &lt;urlopen error [SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed (_ssl.c:590)&gt;</span><br></pre></td></tr></table></figure>

<h4 id="è§£å†³æ–¹æ³•ï¼š"><a href="#è§£å†³æ–¹æ³•ï¼š" class="headerlink" title="è§£å†³æ–¹æ³•ï¼š"></a>è§£å†³æ–¹æ³•ï¼š</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> urllib2</span><br><span class="line"><span class="keyword">import</span> ssl   <span class="comment">#add line 1</span></span><br><span class="line"></span><br><span class="line">ssl._create_default_https_context = ssl._create_unverified_context  <span class="comment">#add line 2</span></span><br><span class="line"></span><br><span class="line">url=<span class="string">'https://www.20150509.cn:1559'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">()</span>:</span></span><br><span class="line">  </span><br><span class="line">  pre_data = [&#123;<span class="string">"client"</span>:<span class="string">"local"</span>, <span class="string">"tgt"</span>:<span class="string">"*"</span>, <span class="string">"fun"</span>:<span class="string">"test.ping"</span>&#125;]</span><br><span class="line"></span><br><span class="line">  json_data = json.dumps(pre_data)</span><br><span class="line">  </span><br><span class="line">  header = &#123;<span class="string">"Content-Type"</span>:<span class="string">"application/json"</span>, <span class="string">"Accept"</span>:<span class="string">"application/json"</span>, <span class="string">"X-Auth-Token"</span>:<span class="string">"b91e7uj86g4f97cc**********b92778ujh4kedf"</span>&#125;</span><br><span class="line"></span><br><span class="line">  request = urllib2.Request(url, json_data, header)</span><br><span class="line"></span><br><span class="line">  response = urllib2.urlopen(request)</span><br><span class="line"></span><br><span class="line">  html = response.read()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">print</span> html</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">"__main__"</span>:</span><br><span class="line">  test()</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="å‚è€ƒæ–‡æ¡£ï¼š"><a href="#å‚è€ƒæ–‡æ¡£ï¼š" class="headerlink" title="å‚è€ƒæ–‡æ¡£ï¼š"></a>å‚è€ƒæ–‡æ¡£ï¼š</h3><p><a href="http://https://www.python.org/dev/peps/pep-0476/" target="_blank" rel="noopener">http://https://www.python.org/dev/peps/pep-0476/</a></p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>ssl</tag>
        <tag>urllib2</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQLé—®é¢˜æ±‡æ€»</title>
    <url>/2016/03/08/MySQL%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB/</url>
    <content><![CDATA[<blockquote>
<p>ä»¥ä¸‹å‡ºç°çš„MySQLé—®é¢˜å‡ä¸ºæœ¬äººäº²å†ï¼Œæ‰€ä»¥æœ¬æ–‡çš„â€œé—®é¢˜æ±‡æ€»â€å®é™…ä¸ºä¸ªäººç‰ˆæœ¬çš„â€œé—®é¢˜æ±‡æ€»â€ï¼Œå¦‚æœ‰å…¶å®ƒMySQLé—®é¢˜ï¼Œæ¬¢è¿Emailè”ç³»æˆ‘å…±åŒè®¨è®ºï¼</p>
</blockquote>
<p><strong>MySQLåˆå§‹åŒ–é—®é¢˜</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">shell&gt; mysql</span><br><span class="line">ERROR 2002 (HY000): Can<span class="string">'t connect to local MySQL server through socket '</span>/var/lib/mysql/mysql.sock<span class="string">' (2)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">shell&gt; service mysqld restart</span></span><br><span class="line"><span class="string">Stopping mysqld:                                           [  OK  ]</span></span><br><span class="line"><span class="string">MySQL Daemon failed to start.</span></span><br><span class="line"><span class="string">Starting mysqld:                                           [FAILED]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#æ—¥å¿—ä¸­æŠ¥é”™å¦‚ä¸‹ï¼š</span></span><br><span class="line"><span class="string">[ERROR] Fatal error: mysql.user table is damaged. Please run mysql_upgrade.</span></span><br><span class="line"><span class="string">[ERROR] Aborting</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#è¿™ç§æƒ…å†µæœ¬äººæ˜¯åœ¨MySQL5.1åˆ°5.7ç‰ˆæœ¬å‡çº§æ—¶é‡åˆ°çš„ï¼Œå‡çº§åˆ°5.7åï¼Œæ•°æ®åº“å¯åŠ¨å¤±è´¥</span></span><br><span class="line"><span class="string">#è§£å†³çš„åŠæ³•å°±æ˜¯é‡æ–°åˆå§‹åŒ–æ•°æ®åº“</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">shell&gt; rm -fr /var/lib/mysql</span></span><br><span class="line"><span class="string">shell&gt; mysqld --initialize --user=mysql</span></span><br><span class="line"><span class="string">shell&gt; service mysqld restart</span></span><br><span class="line"><span class="string">Stopping mysqld:                                           [  OK  ]</span></span><br><span class="line"><span class="string">Starting mysqld:                                           [  OK  ]</span></span><br></pre></td></tr></table></figure>

<hr>
<p><strong>mysql-filesæ–‡ä»¶é—®é¢˜</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#MySQLå¯åŠ¨å¤±è´¥ï¼Œæ—¥å¿—ä¸­æŠ¥é”™å¦‚ä¸‹ï¼š</span></span><br><span class="line">[ERROR] Failed to access directory <span class="keyword">for</span> --secure-file-priv. Please make sure that directory exists and is accessible by MySQL Server. Supplied value : /var/lib/mysql-files</span><br><span class="line"></span><br><span class="line"><span class="comment">#é€ æˆè¿™ç§æƒ…å†µå¯èƒ½æ˜¯å› ä¸ºmysql-filesæ–‡ä»¶å¤¹ä¸å­˜åœ¨æˆ–æƒé™é”™è¯¯</span></span><br><span class="line"><span class="comment">#è§£å†³åŠæ³•å¦‚ä¸‹ï¼š</span></span><br><span class="line">shell&gt; touch /var/lib/mysql-files</span><br><span class="line">shell&gt; chown mysql:mysql /var/lib/mysql-files</span><br><span class="line">shell&gt; service mysqld restart</span><br><span class="line">Stopping mysqld:                                           [  OK  ]</span><br><span class="line">Starting mysqld:                                           [  OK  ]</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
        <tag>Error</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS6ç³»åˆ—å®‰è£…MySQL5.7</title>
    <url>/2016/03/08/CentOS6%E7%B3%BB%E5%88%97%E5%AE%89%E8%A3%85MySQL5-7/</url>
    <content><![CDATA[<blockquote>
<p>CentOS6ç³»åˆ—ï¼Œè‡ªå¸¦çš„repoåº“ä¸­ï¼Œé»˜è®¤å®‰è£…çš„ä¾ç„¶æ˜¯MySQL5.1ç‰ˆæœ¬ï¼Œè¿‡äºè€æ—§ï¼Œè€Œ5.6+ç‰ˆæœ¬ç›¸æ¯”5.1ç‰ˆæœ¬åœ¨å„ä¸ªæ–¹é¢å‡æœ‰å…¨åçš„æå‡ï¼Œå¯¹æ€§èƒ½è¦æ±‚è¾ƒé«˜çš„åº”ç”¨ä¼˜å…ˆè€ƒè™‘5.6+ç‰ˆæœ¬ã€‚æœ¬ç¯‡æ–‡ç« ä»‹ç»ä½¿ç”¨MySQLå®˜æ–¹æºå®‰è£…MySQL5.7</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">shell&gt; <span class="built_in">cd</span> /usr/<span class="built_in">local</span>/src</span><br><span class="line">shell&gt; wget http://repo.mysql.com//mysql57-community-release-el6-7.noarch.rpm</span><br><span class="line">shell&gt; rpm -ivh mysql57-community-release-el6-7.noarch.rpm</span><br><span class="line">shell&gt; yum install mysql-server  <span class="comment">#è¿™é‡Œä¼šé»˜è®¤å®‰è£…mysql-community-serverå’Œå¯¹åº”ç‰ˆæœ¬çš„mysql-community-client</span></span><br></pre></td></tr></table></figure>

<hr>
<p><strong>å¦‚æœå·²ç»å®‰è£…æœ‰5.1çš„è€ç‰ˆæœ¬ï¼Œå¯ä»¥å…ˆå°†å…¶å¸è½½ï¼Œå†æ‰§è¡Œä¸Šé¢çš„å®‰è£…æ­¥éª¤</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">shell&gt; yum remove mysql</span><br><span class="line">Loaded plugins: fastestmirror</span><br><span class="line">Setting up Remove Process</span><br><span class="line">Resolving Dependencies</span><br><span class="line">--&gt; Running transaction check</span><br><span class="line">---&gt; Package mysql.x86_64 0:5.1.73-5.el6_6 will be erased</span><br><span class="line">--&gt; Processing Dependency: mysql = 5.1.73-5.el6_6 <span class="keyword">for</span> package: mysql-server-5.1.73-5.el6_6.x86_64</span><br><span class="line">--&gt; Running transaction check</span><br><span class="line">---&gt; Package mysql-server.x86_64 0:5.1.73-5.el6_6 will be erased</span><br><span class="line">--&gt; Finished Dependency Resolution</span><br><span class="line"></span><br><span class="line">Dependencies Resolved</span><br><span class="line"></span><br><span class="line">=====================================================================================</span><br><span class="line"> Package               Arch            Version                  Repository      Size</span><br><span class="line">=====================================================================================</span><br><span class="line">Removing:</span><br><span class="line"> mysql                 x86_64          5.1.73-5.el6_6           @base          2.4 M</span><br><span class="line">Removing <span class="keyword">for</span> dependencies:</span><br><span class="line"> mysql-server          x86_64          5.1.73-5.el6_6           @base           25 M</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">=====================================================================================</span><br><span class="line">Remove        2 Package(s)</span><br><span class="line"></span><br><span class="line">Installed size: 27 M</span><br><span class="line">Is this ok [y/N]:</span><br><span class="line"><span class="comment">#å¸è½½è€ç‰ˆæœ¬çš„MySQLï¼Œé»˜è®¤ä¼šåŒæ—¶å¸è½½æ‰å¯¹åº”çš„clientç«¯</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ‰§è¡Œä¸Šé¢çš„å®‰è£…éƒ¨åˆ†...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯åŠ¨æ•°æ®åº“å¯èƒ½ä¼šå‡ºç°ä¸‹é¢çš„é”™è¯¯</span></span><br><span class="line">shell&gt; service mysqld restart</span><br><span class="line">Stopping mysqld:                                           [  OK  ]</span><br><span class="line">MySQL Daemon failed to start.</span><br><span class="line">Starting mysqld:                                           [FAILED]</span><br><span class="line"></span><br><span class="line">shell&gt; mysql</span><br><span class="line">ERROR 2002 (HY000): Can<span class="string">'t connect to local MySQL server through socket '</span>/var/lib/mysql/mysql.sock<span class="string">' (2)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#æŸ¥çœ‹æ—¥å¿—å‡ºç°å¦‚ä¸‹æŠ¥é”™</span></span><br><span class="line"><span class="string">#[ERROR] Fatal error: mysql.user table is damaged. Please run mysql_upgrade.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#è§£å†³æ–¹æ³•æ˜¯é‡æ–°åˆå§‹åŒ–æ•°æ®åº“</span></span><br><span class="line"><span class="string">shell&gt; rm -fr /var/lib/mysql</span></span><br><span class="line"><span class="string">shell&gt; mysqld --initialize --user=mysql</span></span><br><span class="line"><span class="string">shell&gt; service mysqld restart</span></span><br><span class="line"><span class="string">Stopping mysqld:                                           [  OK  ]</span></span><br><span class="line"><span class="string">Starting mysqld:                                           [  OK  ]</span></span><br></pre></td></tr></table></figure>

<hr>
<p>å‡å¦‚è€ç‰ˆæœ¬çš„5.1ç”±äºæŸäº›åŸå› ï¼Œä¸èƒ½å¸è½½æˆ–ä¸å…è®¸å¸è½½ï¼Œé‚£ä¹ˆå®‰è£…5.7æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ç¼–è¯‘å®‰è£…çš„æ–¹å¼ï¼Œå°†æ–°æ•°æ®åº“å¯åŠ¨çš„ç«¯å£ç”±3306æ”¹æˆ3307ï¼Œå³å¯å®ç°ä¸¤ä¸ªMySQLç‰ˆæœ¬çš„æ•°æ®åº“è¿›ç¨‹å…±å­˜</p>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>Grafana2.6+Zabbix3.0ç›‘æ§ç³»ç»Ÿæ­å»º</title>
    <url>/2016/03/04/Grafana-2-6-Zabbix-3-0-%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F%E6%90%AD%E5%BB%BA/</url>
    <content><![CDATA[<blockquote>
<p>æœ¬æ–‡ä»‹ç»åœ¨CentOS6ç³»åˆ—ç³»ç»Ÿä¸­ï¼Œå®‰è£…zabbix 3.0ä¸grafana 2.5 æ­é…çš„ç›‘æ§ç³»ç»Ÿ<br>æ®äº†è§£åœ¨zabbix 3.0 LTSç‰ˆæœ¬æœ‰50ä½™é¡¹å‡çº§ï¼Œzabbixæ˜¯ç»“åˆäº†ä¼—å¤šç›‘æ§ç³»ç»Ÿçš„ä¼˜ç‚¹ï¼Œæ˜¯ä¸€æ¬¾æ¯”è¾ƒå…¨é¢åˆ†å¸ƒå¼ç›‘æ§ç³»ç»Ÿã€‚åœ¨ä¸Grafanaæ­ä¼™åï¼Œå®Œç¾è§£å†³äº†Zabbix GUIå®¡ç¾ç–²åŠ³çš„ç—›ç‚¹ï¼Œæ¥ä¸‹æ¥è¿›å…¥æ­£é¢˜ï¼ˆZabbix 3.0å®‰è£…éƒ¨åˆ†å®Œå…¨æŒ‰ç…§å®˜æ–¹æ–‡æ¡£çš„æ­¥éª¤å®ç°ï¼‰</p>
</blockquote>
<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><ol>
<li>æœ¬æ–‡çš„Zabbixéƒ¨åˆ†çŸ¥è¯†åªä»‹ç»å®ƒçš„åŸºç¡€å®‰è£…ï¼ŒZabbixçš„ä½¿ç”¨ä»¥åŠé…ç½®ä¼˜åŒ–å¹¶ä¸åœ¨æœ¬æ–‡çš„ä»‹ç»èŒƒå›´ä¹‹å†…ã€‚</li>
<li>æœ¬æ–‡åªä»‹ç»åœ¨CentOS6ç³»åˆ—ä¸‹çš„å®‰è£…å’Œéƒ¨ç½²ï¼Œå…¶ä»–å‘è¡Œç‰ˆä¸å…¶ä»–ç‰ˆæœ¬å·æš‚ä¸æ¶‰åŠ</li>
<li>æœ¬æ–‡é»˜è®¤ä½¿ç”¨MySQLä½œä¸ºåç«¯æ•°æ®åº“æ”¯æŒ</li>
</ol>
<hr>
<h1 id="CentOS-6-x-åŸºç¡€ç¯å¢ƒé…ç½®éƒ¨åˆ†"><a href="#CentOS-6-x-åŸºç¡€ç¯å¢ƒé…ç½®éƒ¨åˆ†" class="headerlink" title="CentOS 6.x åŸºç¡€ç¯å¢ƒé…ç½®éƒ¨åˆ†"></a>CentOS 6.x åŸºç¡€ç¯å¢ƒé…ç½®éƒ¨åˆ†</h1><h2 id="åŸºç¡€ç¯å¢ƒä»‹ç»"><a href="#åŸºç¡€ç¯å¢ƒä»‹ç»" class="headerlink" title="åŸºç¡€ç¯å¢ƒä»‹ç»"></a>åŸºç¡€ç¯å¢ƒä»‹ç»</h2><ul>
<li>CentOS 6.7 64bit</li>
<li>8CPU</li>
<li>1G Mem</li>
<li>MySQL InnoDB</li>
</ul>
<h2 id="åŸºç¡€ä¾èµ–ç¯å¢ƒé…ç½®"><a href="#åŸºç¡€ä¾èµ–ç¯å¢ƒé…ç½®" class="headerlink" title="åŸºç¡€ä¾èµ–ç¯å¢ƒé…ç½®"></a>åŸºç¡€ä¾èµ–ç¯å¢ƒé…ç½®</h2><h3 id="Apache"><a href="#Apache" class="headerlink" title="Apache"></a>Apache</h3><p><strong>1.Zabbixå®˜æ–¹æ–‡æ¡£è¦æ±‚Apacheçš„ç‰ˆæœ¬è¦åœ¨1.3.12ä¹‹å</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">shell&gt; yum install httpd -y</span><br><span class="line">Loaded plugins: fastestmirror, refresh-packagekit, security</span><br><span class="line">Setting up Install Process</span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line"> * base: mirrors.neusoft.edu.cn</span><br><span class="line"> * epel: mirrors.yun-idc.com</span><br><span class="line"> * extras: mirrors.btte.net</span><br><span class="line"> * remi-safe: mirror.innosol.asia</span><br><span class="line"> * rpmforge: mirrors.neusoft.edu.cn</span><br><span class="line"> * updates: mirrors.btte.net</span><br><span class="line">Package httpd-2.2.15-47.el6.centos.3.x86_64 already installed and latest version</span><br><span class="line">Nothing to <span class="keyword">do</span></span><br></pre></td></tr></table></figure>

<p> æˆ‘è¿™é‡Œå·²ç»å®‰è£…äº†<code>httpd 2.2</code>ç‰ˆæœ¬ï¼Œç¬¦åˆå®˜æ–¹æ–‡æ¡£ä¸­çš„è¦æ±‚</p>
<p><strong>2.å¯åŠ¨httpdæœåŠ¡ï¼Œå¹¶è®¾ç½®ä¸ºå¼€æœºè‡ªåŠ¨å¯åŠ¨</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">shell&gt; service httpd start</span><br><span class="line">shell&gt; chkconfig httpd on</span><br></pre></td></tr></table></figure>

<h3 id="PHP"><a href="#PHP" class="headerlink" title="PHP"></a>PHP</h3><p><strong>PHPçš„ç‰ˆæœ¬è¦æ±‚åœ¨5.4ä»¥ä¸Šï¼Œä½†Linux 6.xç³»ç»Ÿè‡ªå¸¦repoä¸­çš„PHPç‰ˆæœ¬æ˜¯5.3.3 ä¸ç¬¦åˆZabbixå®˜æ–¹æ–‡æ¡£çš„è¦æ±‚ï¼Œéœ€è¦ä½¿ç”¨Remi repoæ¥å®‰è£…æ›´é«˜ç‰ˆæœ¬çš„PHP</strong></p>
<h4 id="é…ç½®Remi-Repoæ¥å®‰è£…é«˜ç‰ˆæœ¬çš„PHP"><a href="#é…ç½®Remi-Repoæ¥å®‰è£…é«˜ç‰ˆæœ¬çš„PHP" class="headerlink" title="é…ç½®Remi Repoæ¥å®‰è£…é«˜ç‰ˆæœ¬çš„PHP"></a>é…ç½®Remi Repoæ¥å®‰è£…é«˜ç‰ˆæœ¬çš„PHP</h4><p><strong>1.ä¸‹è½½Remi</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">shell&gt; yum install http://rpms.famillecollet.com/enterprise/remi-release-6.rpm</span><br></pre></td></tr></table></figure>

<p><strong>2.é…ç½®Remi</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ä½¿ç”¨ä¹ æƒ¯çš„æ–‡æœ¬ç¼–è¾‘å™¨ï¼ˆå¦‚ vimï¼‰æ‰“å¼€ Remi æºé…ç½®æ–‡ä»¶ &#x2F;etc&#x2F;yum.repos.d&#x2F;remi.repo</span><br><span class="line">å¯ç”¨ Remi Repositoryä¿®æ”¹ enabled&#x3D;0 ä¸º enabled&#x3D;1</span><br><span class="line">ä¸º Remi Repository è®¾ç½®åˆé€‚çš„ä¼˜å…ˆçº§åœ¨ [remi] é‚£ä¸€èŠ‚çš„ç»“å°¾å¦èµ·ä¸€è¡Œæ·»åŠ ä¸‹é¢çš„ä»£ç ï¼špriority&#x3D;3</span><br></pre></td></tr></table></figure>

<p><strong>3.å®‰è£…PHP</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">shell&gt; yum install --enablerepo=remi php php-gd</span><br></pre></td></tr></table></figure>

<ul>
<li><p>å› ä¸ºphp-gdå’Œphpç‰ˆæœ¬å¯èƒ½æœ‰ä¾èµ–ï¼Œæ‰€ä»¥php-gdè¿™ä¸ªæ‰©å±•ä¹Ÿä½¿ç”¨remiè¿™ä¸ªrepoæ¥å®‰è£…</p>
</li>
<li><p>å¦‚æœå‡ºç°<code>Requires: libt1.so.5()(64bit)</code>è¿™ä¸ªæŠ¥é”™ï¼Œå¯ä»¥å‚è€ƒ <a href="http://docs.20150509.cn/2016/03/02/Requires-libt1-so-5-64bit/" target="_blank" rel="noopener">http://docs.20150509.cn/2016/03/02/Requires-libt1-so-5-64bit/</a> è¿™ç¯‡æ–‡ç« è§£å†³</p>
</li>
</ul>
<p><strong>4.æ ¹æ®Zabbixå®˜æ–¹æ–‡æ¡£éœ€æ±‚å®‰è£…PHPæ‰©å±•</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">shell&gt; yum install php-bcmath php-ctype php-xml php-xmlreader php-xmlwriter php-session php-net-socket php-gettext php-mbstring php-gettext php-ldap php-mysql</span><br></pre></td></tr></table></figure>

<h3 id="Server"><a href="#Server" class="headerlink" title="Server"></a>Server</h3><p><strong>æ ¹æ®å®˜æ–¹æ–‡æ¡£çš„è¦æ±‚ï¼Œéœ€è¦åœ¨æœåŠ¡å™¨ä¸­å®‰è£…ä¸€ä¸‹è½¯ä»¶æ”¯æŒ</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">shell&gt; yum install OpenIPMI OpenIPMI-devel libssh2 libssh2-devel fping libcurl libxml2 libxml2-devel net-snmp</span><br></pre></td></tr></table></figure>

<h3 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h3><p><strong>å®˜æ–¹æ–‡æ¡£è¦æ±‚MySQLçš„ç‰ˆæœ¬è¦åœ¨5.0.3ä»¥ä¸Šï¼ŒCentOS 6.7é»˜è®¤çš„repoé‡Œæä¾›çš„MySQLç‰ˆæœ¬ä¸º5.1.73 ç¬¦åˆå®˜æ–¹æ–‡æ¡£è¦æ±‚</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">shell&gt; yum install mysql mysql-server mysql-devel</span><br><span class="line">shell&gt; service mysqld start  <span class="comment">#é¦–æ¬¡å¯åŠ¨éœ€è¦åˆå§‹åŒ–</span></span><br><span class="line">shell&gt; chkconfig mysqld on  <span class="comment">#æ·»åŠ å¼€æœºè‡ªåŠ¨å¯åŠ¨</span></span><br></pre></td></tr></table></figure>

<hr>
<h1 id="Zabbixå®‰è£…éƒ¨åˆ†"><a href="#Zabbixå®‰è£…éƒ¨åˆ†" class="headerlink" title="Zabbixå®‰è£…éƒ¨åˆ†"></a>Zabbixå®‰è£…éƒ¨åˆ†</h1><p><strong>Zabbix 3.0çš„å®‰è£…å‚è€ƒäº†å®˜æ–¹æ–‡æ¡£ä¸­æºç ç¼–è¯‘å®‰è£…çš„æ–¹å¼ï¼Œè½¯ä»¶åŒ…çš„æ–¹å¼æ¯”è¾ƒç®€å•ï¼Œå¤§å®¶å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£è‡ªè¡Œè¯•éªŒï¼Œæ—¶é—´å…³ç³»ï¼Œè¿™é‡Œæš‚ä¸ä»‹ç»rpmåŒ…çš„å®‰è£…æ–¹å¼ï¼Œåç»­æœ‰æ—¶é—´ä¼šè¡¥å……æä¾›è¿™ç§å®‰è£…æ–¹å¼çš„è¯´æ˜</strong></p>
<h2 id="æºç å®‰è£…çš„æ–¹å¼"><a href="#æºç å®‰è£…çš„æ–¹å¼" class="headerlink" title="æºç å®‰è£…çš„æ–¹å¼"></a>æºç å®‰è£…çš„æ–¹å¼</h2><h3 id="ä¸‹è½½Zabbix-3-0æºç åŒ…å¹¶è§£å‹"><a href="#ä¸‹è½½Zabbix-3-0æºç åŒ…å¹¶è§£å‹" class="headerlink" title="ä¸‹è½½Zabbix 3.0æºç åŒ…å¹¶è§£å‹"></a>ä¸‹è½½Zabbix 3.0æºç åŒ…å¹¶è§£å‹</h3><p>Zabbix 3.0 æºç å®˜æ–¹ä¸‹è½½åœ°å€ï¼š <a href="http://www.zabbix.com/download.php" target="_blank" rel="noopener">http://www.zabbix.com/download.php</a><br>é€‰æ‹©<code>Zabbix Sources</code>ä¸‹çš„<code>Zabbix 3.0 LTS</code>è¿›è¡Œä¸‹è½½</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">shell&gt; tar -zxvf zabbix-3.0.0.tar.gz  <span class="comment">#è§£å‹ç¼©</span></span><br></pre></td></tr></table></figure>

<h3 id="åˆ›å»ºç”¨æˆ·åŠç»„"><a href="#åˆ›å»ºç”¨æˆ·åŠç»„" class="headerlink" title="åˆ›å»ºç”¨æˆ·åŠç»„"></a>åˆ›å»ºç”¨æˆ·åŠç»„</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">shell&gt; groupadd zabbix</span><br><span class="line">shell&gt; useradd -g zabbix zabbix</span><br></pre></td></tr></table></figure>

<h3 id="åˆ›å»ºZabbixæ•°æ®åº“"><a href="#åˆ›å»ºZabbixæ•°æ®åº“" class="headerlink" title="åˆ›å»ºZabbixæ•°æ®åº“"></a>åˆ›å»ºZabbixæ•°æ®åº“</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">shell&gt; mysql -uroot -p&lt;password&gt;</span><br><span class="line">mysql&gt; create database zabbix character <span class="built_in">set</span> utf8 collate utf8_bin;</span><br><span class="line">mysql&gt; grant all privileges on zabbix.* to zabbix@localhost identified by <span class="string">'&lt;password&gt;'</span>;</span><br><span class="line">mysql&gt; quit;</span><br><span class="line">shell&gt; <span class="built_in">cd</span> database/mysql  <span class="comment">#åœ¨è§£å‹ç¼©åçš„zabbix-3.0.0æ–‡ä»¶å¤¹ä¸­</span></span><br><span class="line">shell&gt; mysql -uzabbix -p&lt;password&gt; zabbix &lt; schema.sql</span><br><span class="line"><span class="comment">#å¦‚æœä½ æ˜¯ä¸ºZabbix Proxyæ¥åˆ›å»ºæ•°æ®åº“ï¼Œé‚£ä¹ˆåˆ°è¿™é‡Œå°±å¿…é¡»åœæ­¢äº†ï¼Œä¸‹é¢çš„ä¸éœ€è¦æ‰§è¡Œ</span></span><br><span class="line">shell&gt; mysql -uzabbix -p&lt;password&gt; zabbix &lt; images.sql</span><br><span class="line">shell&gt; mysql -uzabbix -p&lt;password&gt; zabbix &lt; data.sql</span><br></pre></td></tr></table></figure>

<h3 id="ç¼–è¯‘å®‰è£…Zabbix-Serverå’ŒZabbix-Agent"><a href="#ç¼–è¯‘å®‰è£…Zabbix-Serverå’ŒZabbix-Agent" class="headerlink" title="ç¼–è¯‘å®‰è£…Zabbix Serverå’ŒZabbix Agent"></a>ç¼–è¯‘å®‰è£…Zabbix Serverå’ŒZabbix Agent</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">shell&gt; ./configure --<span class="built_in">help</span> <span class="comment">#å¯ä»¥æŸ¥çœ‹ç¼–è¯‘çš„å‚æ•°é¡¹</span></span><br><span class="line">shell&gt; ./configure --<span class="built_in">enable</span>-server --<span class="built_in">enable</span>-agent --with-mysql --<span class="built_in">enable</span>-ipv6 --with-net-snmp --with-libcurl --with-libxml2  <span class="comment">#Zabbix Serverä¸Agentå®‰è£…å‚æ•°å‚è€ƒ</span></span><br><span class="line">shell&gt; make install</span><br></pre></td></tr></table></figure>

<p>å…¶ä»–ç»„ä»¶å®‰è£…å‚è€ƒï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">shell&gt; ./configure --prefix=/usr --<span class="built_in">enable</span>-proxy --with-net-snmp --with-sqlite3 --with-ssh2  <span class="comment">#Zabbix Proxyå®‰è£…å‚æ•°å‚è€ƒ</span></span><br><span class="line">shell&gt; ./configure --<span class="built_in">enable</span>-agent  <span class="comment">#Zabbix Agentå®‰è£…å‚æ•°å‚è€ƒ</span></span><br></pre></td></tr></table></figure>

<h3 id="ç¼–è¾‘é…ç½®æ–‡ä»¶"><a href="#ç¼–è¾‘é…ç½®æ–‡ä»¶" class="headerlink" title="ç¼–è¾‘é…ç½®æ–‡ä»¶"></a>ç¼–è¾‘é…ç½®æ–‡ä»¶</h3><p>å¦‚æœServerä¸Agenté‡‡ç”¨äº†AIOï¼ˆAll In Oneï¼‰çš„éƒ¨ç½²æ–¹å¼ï¼Œä½œä¸ºæµ‹è¯•ï¼ŒAgentçš„é…ç½®æ–‡ä»¶<code>å¯ä»¥ä¸ä¿®æ”¹</code></p>
<p>æ¥ä¸‹æ¥ä¿®æ”¹Serverçš„é…ç½®æ–‡ä»¶</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">shell&gt; vim /usr/<span class="built_in">local</span>/etc/zabbix_server.conf</span><br><span class="line"><span class="comment">#ä»¥ä¸‹ä¸ºä¿®æ”¹å®Œæˆåçš„é¡¹ç›®</span></span><br><span class="line"><span class="comment">#DBNameå’ŒDBUserä¿æŒä»¥ä¸‹é»˜è®¤å‚æ•°å³å¯ï¼Œåªéœ€è®¾ç½®DBPasswordä¸€é¡¹</span></span><br><span class="line">DBName=zabbix</span><br><span class="line">DBUser=zabbix</span><br><span class="line">DBPassword=zabbix  <span class="comment">#ä¸Šé¢é…ç½®æ•°æ®æ—¶ï¼Œæˆ‘è®¾ç½®zabbixç”¨æˆ·çš„å¯†ç ä¸ºzabbix</span></span><br></pre></td></tr></table></figure>

<h3 id="å¯åŠ¨æœåŠ¡"><a href="#å¯åŠ¨æœåŠ¡" class="headerlink" title="å¯åŠ¨æœåŠ¡"></a>å¯åŠ¨æœåŠ¡</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">shell&gt; zabbix_server  <span class="comment">#å¯åŠ¨Zabbix Server</span></span><br><span class="line">shell&gt; zabbix_agentd  <span class="comment">#å¯åŠ¨Zabbix Agent</span></span><br></pre></td></tr></table></figure>

<p>å¯åŠ¨å…¶ä»–æœåŠ¡ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">shell&gt; zabbix_proxy  <span class="comment">#å¯åŠ¨Zabbix Proxy</span></span><br></pre></td></tr></table></figure>

<h3 id="å®‰è£…Zabbixç½‘ç«™é¡µé¢æ¥å£"><a href="#å®‰è£…Zabbixç½‘ç«™é¡µé¢æ¥å£" class="headerlink" title="å®‰è£…Zabbixç½‘ç«™é¡µé¢æ¥å£"></a>å®‰è£…Zabbixç½‘ç«™é¡µé¢æ¥å£</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">shell&gt; mkdir /var/www/html/zabbix</span><br><span class="line">shell&gt; <span class="built_in">cd</span> frontends/php  <span class="comment">#åœ¨è§£å‹ç¼©åçš„zabbix-3.0.0æ–‡ä»¶å¤¹ä¸­</span></span><br><span class="line">shell&gt; cp -a . /var/www/html/zabbix</span><br></pre></td></tr></table></figure>

<h3 id="é…ç½®Zabbix"><a href="#é…ç½®Zabbix" class="headerlink" title="é…ç½®Zabbix"></a>é…ç½®Zabbix</h3><ul>
<li><p><strong>åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€å¦‚ä¸‹ç½‘å€ï¼š <a href="http://server_ip_or_name/zabbix" target="_blank" rel="noopener">http://server_ip_or_name/zabbix</a></strong></p>
</li>
<li><p>åœ¨æ‰“å¼€çš„é¡µé¢ä¸­çœ‹åˆ°â€œWelcome to Zabbix 3.0â€å‡ ä¸ªå¤§å­—å°±ç®—æˆåŠŸäº†ä¸€åŠäº†ï¼ç‚¹å‡»<code>Next step</code><img src="http://oss.20150509.cn/install_1.png" alt="Welcome"></p>
</li>
<li><p>ç¬¬äºŒä¸ªé¡µé¢<code>Check of pre-requisites</code> ä¼šæ£€æŸ¥PHPçš„ä¸€äº›é…ç½®å‚æ•°ï¼ˆç¬¬ä¸€åˆ—æ˜¯å˜é‡åï¼›ç¬¬äºŒåˆ—æ˜¯PHPé…ç½®æ–‡ä»¶å®é™…å€¼ï¼›ç¬¬ä¸‰é¡¹æ˜¯Zabbixå¼ºåˆ¶è¦æ±‚çš„æœ€ä½å€¼æˆ–å›ºå®šå€¼ï¼‰ï¼Œé»˜è®¤æƒ…å†µä¸‹è¿™ä¸ªé¡µé¢æ‰€æœ‰çš„æ£€æŸ¥é¡¹åº”è¯¥éƒ½æ˜¯â€œOKâ€çš„ï¼Œå¦‚æœæœ‰çº¢è‰²çš„é”™è¯¯é¡¹ï¼Œæ ¹æ®å‰é¢æç¤ºçš„å˜é‡åï¼Œå»æ‰¾PHPçš„é…ç½®æ–‡ä»¶ï¼Œä¿®æ”¹æˆâ€œREQUIREDâ€è¦æ±‚çš„å€¼å°±å¯ä»¥å•¦ï¼ˆé»˜è®¤PHPçš„é…ç½®æ–‡ä»¶<code>/etc/php.ini</code>ï¼‰<img src="http://oss.20150509.cn/install_2.png" alt="Check of pre-requisites"></p>
</li>
<li><p>ç¬¬ä¸‰ä¸ªé¡µé¢<code>Configure DB connection</code> è¿™ä¸€æ­¥éª¤ä¼šå»å°è¯•è¿æ¥æ•°æ®åº“ã€‚ç¬¬ä¸€é¡¹æ•°æ®åº“ç±»å‹é€‰æ‹©<code>MySQL</code>ï¼›DB Host ä¿æŒé»˜è®¤çš„<code>localhost</code>ï¼ˆå› ä¸ºè¿™é‡Œé‡‡ç”¨äº†AIOçš„å®‰è£…æ–¹å¼ï¼Œæ•°æ®åº“æ²¡æœ‰å•ç‹¬åˆ†ç¦»ï¼‰ï¼›DB Portä¿®æ”¹æˆ<code>3306</code>ï¼›DB Nameï¼š<code>zabbix</code>ï¼› Userï¼š<code>zabbix</code>ï¼›Passwordï¼š<code>zabbix</code>ã€‚ç‚¹å‡»<code>Next step</code>å¦‚æœå‡ºç°æŠ¥é”™ï¼Œæ ¹æ®æŠ¥é”™ä¿¡æ¯æ’æŸ¥æ˜¯å¦æ˜¯é…ç½®é”™è¯¯ï¼ˆè¿™äº›é…ç½®éƒ½æ˜¯åœ¨å‰é¢è®¾ç½®è¿‡çš„ï¼Œ3306æ˜¯MySQLé»˜è®¤çš„ç«¯å£å·ï¼‰<img src="http://oss.20150509.cn/install_3.png" alt="Configure DB connection"></p>
</li>
<li><p>ç¬¬å››ä¸ªé¡µé¢<code>Zabbix server details</code> ä¿æŒé»˜è®¤çš„Hostï¼š<code>localhost</code>å’ŒPortï¼š<code>10051</code>é…ç½®å³å¯ï¼ŒNameå¯ä»¥è‡ªå®šä¹‰è®¾ç½®ï¼Œä¸ºè¿™å¥—ç›‘æ§ç³»ç»Ÿèµ·ä¸ªåå­—<img src="http://oss.20150509.cn/install_4.png" alt="Zabbix server details"></p>
</li>
<li><p>ç¬¬äº”ä¸ªé¡µé¢<code>Pre-installation summary</code> æ€»è§ˆä¸€ä¸‹å‰é¢æ‰€æœ‰çš„é…ç½®<code>Next step</code><img src="http://oss.20150509.cn/install_5.png" alt="Pre-installation summary"></p>
</li>
<li><p>ç¬¬å…­ä¸ªé¡µé¢<code>Install</code> æˆ‘åœ¨è¿›å…¥åˆ°è¿™ä¸ªé¡µé¢åï¼Œå‡ºç°äº†æŠ¥é”™ï¼Œæç¤º<code>Can not create the configuration file</code> ä¸‹æ–¹å®˜æ–¹ä¹Ÿç»™å‡ºäº†æ‰‹åŠ¨è§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•ã€‚æŒ‰ç…§æç¤ºï¼Œç¬¬ä¸€æ­¥ç‚¹å‡»ç»™å‡ºçš„è¿æ¥ï¼Œä¸‹è½½zabbixå®˜æ–¹æä¾›çš„é…ç½®æ–‡ä»¶ï¼›ç¬¬äºŒæ­¥ï¼Œæ ¹æ®æç¤ºï¼Œæ”¾åœ¨æŒ‡å®šçš„ä½ç½®ä¿å­˜ä¸ºæŒ‡å®šçš„æ–‡ä»¶ï¼Œæˆ‘è¿™é‡Œæç¤ºä¿å­˜ä¸ºï¼š<code>/usr/share/zabbix/conf/zabbix.conf.php</code> æŒ‰ç…§æç¤ºæ“ä½œå®Œæˆåç‚¹å‡»<code>Finish</code><img src="http://oss.20150509.cn/install_6.png" alt="Install"></p>
</li>
<li><p>å¦‚æœä¸Šé¢é…ç½®çš„éƒ½æ²¡æœ‰é—®é¢˜ï¼Œç¬¬ä¸ƒä¸ªé¡µé¢å°†ä¼šå‡ºç°<code>congratulations! ...</code> ç‚¹å‡»<code>Finish</code><img src="http://oss.20150509.cn/install_7.png" alt="Install2"></p>
</li>
<li><p>ç¬¬å…«ä¸ªé¡µé¢å°†ä¼šå‡ºç°ç™»é™†é¡µé¢ï¼Œé»˜è®¤çš„ç™»é™†ç”¨æˆ·åä¸º<code>Admin</code> å¯†ç ä¸º<code>zabbix</code><img src="http://oss.20150509.cn/login.png" alt="login"></p>
</li>
</ul>
<h3 id="Zabbixçš„ä½¿ç”¨ç®€ä»‹"><a href="#Zabbixçš„ä½¿ç”¨ç®€ä»‹" class="headerlink" title="Zabbixçš„ä½¿ç”¨ç®€ä»‹"></a>Zabbixçš„ä½¿ç”¨ç®€ä»‹</h3><p>è¿›å…¥åˆ°Zabbixé¦–é¡µåï¼Œä¼šå‘ç°3.0ç‰ˆæœ¬ä¸ä¹‹å‰çš„2.xç‰ˆæœ¬çš„ç•Œé¢ç›¸æ¯”ç„•ç„¶ä¸€æ–°ï¼Œæ›´å…»çœ¼äº†ï¼Œå¯¹è§£å†³2.xç‰ˆæœ¬çš„å®¡ç¾ç–²åŠ³èµ·åˆ°äº†ä¸€å®šçš„ä½œç”¨ã€‚å½“ç„¶è¿™åªæ˜¯æœ€è‚¤æµ…çš„å¤–è²Œåä¼šæˆå‘˜çš„ç»“è®ºï¼Œé™¤äº†é¢œå€¼é«˜äº†ï¼ŒZabbixè¿˜æœ‰50ä½™é¡¹æŠ€æœ¯æ›´æ–°ï¼Œå˜å¾—æ„ˆå‘å¼ºå¤§äº†<del>~</del></p>
<ul>
<li>åœ¨<code>Configuation</code>â€“&gt;<code>Hosts</code>â€“&gt;<code>status</code>ä¸­ï¼Œå°†<code>Disabled</code>å˜æˆ<code>Enabled</code>çŠ¶æ€ï¼Œç¨ç­‰ç‰‡åˆ»ï¼Œå¦‚æœZabbix Agentå¯åŠ¨æ­£å¸¸çš„è¯ï¼Œ<code>ZBX</code>çš„å›¾æ ‡å°±ä¼šäº®èµ·ï¼Œè¡¨ç¤ºServerä¸Agentä¹‹é—´é€šä¿¡æ­£å¸¸<img src="http://oss.20150509.cn/Zabbix_1.jpg" alt="Enabled"></li>
<li>ç›‘æ§é¦–é¡µä¼šæ˜¯å¦‚ä¸‹çŠ¶æ€ï¼ˆå„ä¸ªæ¨¡å—å¯ä»¥æ‹–æ‹½ç§»åŠ¨å¸ƒå±€ï¼‰<img src="http://oss.20150509.cn/Zabbix_2.jpg" alt="Dashboard"></li>
<li>å†ç…ä¸€çœ¼ç›‘æ§å›¾è¡¨çš„æ•ˆæœ~<img src="http://oss.20150509.cn/Zabbix_3.jpg" alt="Graphs1"></li>
</ul>
<p><strong>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œè™½ç„¶3.0æ¢äº†ä¸€å±‚æ‰å¹³ç®€çº¦çš„å¤–è§‚ï¼Œä½†æ˜¯å›¾è¡¨å±•ç¤ºè¿˜æ˜¯ä¸€æ ·çš„ä¸‘â€¦â€¦ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒGrafanaå¯ä»¥å¸®ä¸Šå¤§å¿™ï¼Œæ¥ä¸‹æ¥çš„éƒ¨åˆ†å°±è¯¦ç»†ä»‹ç»å¦‚ä½•ä½¿ç”¨Grafanaç»™Zabbixç›‘æ§å›¾è¡¨æŠ«ä¸Šä¸€å±‚åä¸½çš„å¤–è¡£</strong></p>
<h2 id="RPMåŒ…å®‰è£…æ–¹å¼"><a href="#RPMåŒ…å®‰è£…æ–¹å¼" class="headerlink" title="RPMåŒ…å®‰è£…æ–¹å¼"></a>RPMåŒ…å®‰è£…æ–¹å¼</h2><p><em>ç•¥</em></p>
<hr>
<h1 id="Grafanaå®‰è£…éƒ¨åˆ†"><a href="#Grafanaå®‰è£…éƒ¨åˆ†" class="headerlink" title="Grafanaå®‰è£…éƒ¨åˆ†"></a>Grafanaå®‰è£…éƒ¨åˆ†</h1><p>æˆªæ­¢è‡³æˆ‘å†™è¿™ç¯‡æ–‡æ¡£çš„æ—¶å€™ï¼ŒGrafanaçš„æœ€æ–°ç‰ˆæœ¬æ˜¯<code>2.6.0</code> è€ŒGrafanaåŸç”Ÿæ˜¯ä¸æ”¯æŒè·å–Zabbixæ•°æ®çš„ï¼Œéœ€è¦é€šè¿‡grafana-zabbixæ’ä»¶æ¥å®ç°ï¼Œgrafana-zabbixæ’ä»¶çš„æœ€æ–°ç‰ˆæœ¬æ˜¯2.5.1ï¼Œgithubä¸Šå†™çš„å¾ˆæ¸…æ¥šï¼Œè¯¥æ’ä»¶æœåŠ¡äºGrafanaçš„2.5ç‰ˆæœ¬ã€‚ç»è¿‡æµ‹è¯•ï¼ŒæˆåŠŸåœ¨2.6.0çš„Grafanaä¸Šä½¿ç”¨äº†grafana-zabbixçš„2.5.1ç‰ˆæœ¬ã€‚æ‰€ä»¥è¿™é‡Œä½ å¯ä»¥ä»»æ„é€‰æ‹©2.5æˆ–2.6ç‰ˆæœ¬çš„Grafanaæ¥å®‰è£…ã€‚</p>
<h2 id="Grafanaçš„ä¸‹è½½åŠå®‰è£…"><a href="#Grafanaçš„ä¸‹è½½åŠå®‰è£…" class="headerlink" title="Grafanaçš„ä¸‹è½½åŠå®‰è£…"></a>Grafanaçš„ä¸‹è½½åŠå®‰è£…</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">shell&gt; yum install https://grafanarel.s3.amazonaws.com/builds/grafana-2.6.0-1.x86_64.rpm  <span class="comment">#è¿™é‡Œåªæä¾›äº†yumçš„å®‰è£…æ–¹å¼ï¼Œå…¶ä»–å®‰è£…æ–¹å¼å¯ä»¥å‚è€ƒé™„å½•ä¸­çš„Grafanaå®˜æ–¹å®‰è£…æ–‡æ¡£</span></span><br><span class="line">shell&gt; service grafana-server start  <span class="comment">#å¯åŠ¨GrafanaæœåŠ¡</span></span><br><span class="line">shell&gt; chkconfig grafana-server on  <span class="comment">#æ·»åŠ å¼€æœºè‡ªåŠ¨å¯åŠ¨</span></span><br></pre></td></tr></table></figure>

<h2 id="Grafana-Zabbixæ’ä»¶çš„ä¸‹è½½åŠå®‰è£…"><a href="#Grafana-Zabbixæ’ä»¶çš„ä¸‹è½½åŠå®‰è£…" class="headerlink" title="Grafana Zabbixæ’ä»¶çš„ä¸‹è½½åŠå®‰è£…"></a>Grafana Zabbixæ’ä»¶çš„ä¸‹è½½åŠå®‰è£…</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#https://github.com/alexanderzobnin/grafana-zabbix/releases/latest  #è¯·åˆ°è¯¥ç½‘å€ä¸‹è½½2.5.1ç‰ˆæœ¬çš„grafana-zabbixæ’ä»¶</span></span><br><span class="line">shell&gt; tar -xvzf grafana-zabbix-2.5.1.tar.gz</span><br><span class="line">shell&gt; cp -r grafana-zabbix-2.5.1/zabbix/  /usr/share/grafana/public/app/plugins/datasource/</span><br><span class="line">shell&gt; service grafana-server restart</span><br></pre></td></tr></table></figure>
<hr>
<h1 id="Grafana-Zabbixè”é€šéƒ¨åˆ†"><a href="#Grafana-Zabbixè”é€šéƒ¨åˆ†" class="headerlink" title="Grafana + Zabbixè”é€šéƒ¨åˆ†"></a>Grafana + Zabbixè”é€šéƒ¨åˆ†</h1><ul>
<li>åœ¨æµè§ˆå™¨åœ°å€æ è¾“å…¥ <code>http://IP:3000</code>å°±å¯ä»¥çœ‹åˆ°Grafanaçš„ç™»é™†é¡µé¢äº†ã€‚è¾“å…¥é»˜è®¤çš„ç”¨æˆ·å<code>admin</code> å¯†ç <code>admin</code>ç™»é™†</li>
<li>ç‚¹å‡»å·¦ä¾§çš„<code>Data Sourses</code>â€“&gt;<code>Add new</code><ul>
<li>Typeä¸‹æ‹‰æ¡†ä¸­é€‰æ‹©<code>Zabbix</code></li>
<li>Name å¯ä»¥è‡ªç”±å‘æŒ¥~~</li>
<li>Http settingsâ€“&gt;Url å¡«å…¥<code>http://zabbix-server-ip/zabbix/api_jsonrpc.php</code> è¿™é‡Œå¡«å…¥çš„æ˜¯Zabbix APIæ¥å£</li>
<li>Http settingsâ€“&gt;Access é€‰æ‹© <code>direct</code> ä½¿ç”¨ç›´æ¥è®¿é—®çš„æ–¹å¼</li>
<li>Zabbix API detailsâ€“&gt;User å¡«å…¥<code>Admin</code></li>
<li>Zabbix API detailsâ€“&gt;Password å¡«å…¥ <code>zabbix</code></li>
<li>ç‚¹<code>Save</code>ä¿å­˜åå†ç¼–è¾‘ï¼Œå‡ºç°<code>Test Connection</code>æŒ‰é’®ï¼Œç‚¹å‡»å¯æµ‹è¯•APIé…ç½®æ˜¯å¦æ­£ç¡®ã€‚å‡ºç°ï¼šSuccess Zabbix API version: 3.0.0 é…ç½®æˆåŠŸ<img src="http://oss.20150509.cn/grafana_1.jpg" alt="enter image description here"></li>
</ul>
</li>
</ul>
<hr>
<h1 id="Grafanaé…ç½®éƒ¨åˆ†"><a href="#Grafanaé…ç½®éƒ¨åˆ†" class="headerlink" title="Grafanaé…ç½®éƒ¨åˆ†"></a>Grafanaé…ç½®éƒ¨åˆ†</h1><p>è‡³æ­¤ä»…å·®æœ€åä¸€æ­¥ï¼Œå°†Zabbixçš„æ•°æ®è¯»å–åˆ°Grafanaæ¥ä»¥å›¾è¡¨å±•ç¤ºï¼Œå°±æ‰“å®Œæ”¶å·¥å•¦ï¼</p>
<ul>
<li>ç‚¹å‡»å·¦ä¾§çš„<code>Dashboards</code>â€“&gt;<code>Home</code>â€“&gt;åœ¨ä¸‹æ‹‰èœå•çš„åº•éƒ¨é€‰æ‹©<code>+ New</code>ã€‚è¿™æ—¶æ–°çš„é¡µé¢ä¸­é»˜è®¤å‡ºç°ä¸€ä¸ªç©ºçš„æ¨ªè¡Œå›¾è¡¨ï¼Œå·¦ä¸Šè§’æœ‰ç»¿è‰²çš„ç«–çº¿ï¼Œå³ä¸‹è§’æœ‰<code>+ ADD ROW</code>æ·»åŠ æ–°è¡Œçš„æŒ‰é’®ã€‚</li>
<li>é¼ æ ‡æ”¾åœ¨å·¦ä¸Šè§’çš„ç»¿è‰²ç«–çº¿ä¸Šï¼Œç‚¹å‡»åå¼¹å‡ºä¸€ä¸ªèœå•ï¼Œé€‰æ‹©<code>Add Panel</code>ã€‚ä¸‹é¢æœ‰äº”ä¸ªé€‰é¡¹ï¼Œä¸‹é¢é€‰æ‹©å››ä¸ªå¸¸ç”¨çš„åˆ†åˆ«ä»‹ç»</li>
<li>è®°å¾—ç‚¹å‡»ä¸Šé¢çš„<code>ä¿å­˜</code>æŒ‰é’®ä»¥ä¿å­˜æ–°å»ºçš„é¡µé¢</li>
</ul>
<h2 id="Graph"><a href="#Graph" class="headerlink" title="Graph"></a>Graph</h2><p>è¿™ä¸ªé€‰é¡¹æ˜¯åˆ›å»ºä¸€ä¸ªå›¾è¡¨ï¼Œç±»ä¼¼äºZabbixçš„ç›‘æ§å›¾è¡¨ï¼Œæ˜¯æœ€å¸¸ç”¨çš„ç±»å‹ä¹‹ä¸€ã€‚</p>
<ul>
<li>General-Titleï¼šè®¾ç½®è¯¥å›¾è¡¨çš„åç§°</li>
<li>Metricsï¼šåœ¨è¯¥é¡¹çš„å³ä¸‹è§’ï¼Œé€‰æ‹©æ­£ç¡®çš„æ•°æ®æºï¼ˆä¹‹å‰åœ¨Data Sourcesé…ç½®çš„Nameï¼‰</li>
<li>Metrics-Group/Host/Application/Itemï¼šè¿™äº›é¡¹ç›®æ˜¯å¿…å¡«é¡¹ç›®ï¼Œéœ€è¦ä¾æ¬¡ä¸‹æ‹‰é€‰æ‹©</li>
</ul>
<p><em>å¦‚æœä¸€å¼ å›¾éœ€è¦å±•ç°ä¸¤æ¡çº¿çš„æ•°æ®ï¼Œå¯ä»¥åœ¨å·¦ä¸‹è§’ç‚¹å‡»<code>+ Query</code></em></p>
<ul>
<li>Display Styles-Chart Optionsï¼šè¿™é‡Œå¯ä»¥é€‰æ‹©ä»¥<code>ç«–çº¿</code>å±•ç¤ºï¼Œä»¥<code>æŠ˜çº¿</code>å±•ç¤ºæˆ–ä»¥<code>ç‚¹</code>æ¥å±•ç¤ºæ•°æ®<br><img src="http://oss.20150509.cn/grafana_2.jpg" alt="Grafana-Graph"></li>
</ul>
<h2 id="Table"><a href="#Table" class="headerlink" title="Table"></a>Table</h2><p>è¡¨æ ¼å±•ç¤ºï¼Œç±»ä¼¼äºExcelè¡¨æ ¼çš„å±•ç°å½¢å¼<br><img src="http://oss.20150509.cn/grafana_3.jpg" alt="enter image description here"></p>
<ul>
<li>ç‚¹å‡» <code>- +</code> å·å¯ä»¥è°ƒæ•´è¯¥æ¨¡å—çš„å¤§å°ï¼ˆæ¨ªå‘ä¼¸ç¼©ï¼‰</li>
<li>ç‚¹å‡»<code>Edit</code>å¯ä»¥é‡æ–°ç¼–è¾‘è¯¥æ¨¡å—çš„æ•°æ®æº</li>
</ul>
<h2 id="Single-stat"><a href="#Single-stat" class="headerlink" title="Single stat"></a>Single stat</h2><p>å•ç»Ÿè®¡æ¨¡å—ï¼Œä»å­—é¢æ„æ€å°±å¯ä»¥çŸ¥é“ï¼Œè¯¥ç§æ¨¡å—ä»…å¯ä»¥å±•ç¤ºä¸€ç§æ•°æ®ï¼Œç»Ÿè®¡ä¸€ç§æ•°æ®ã€‚è¿™é‡Œéœ€è¦é‡ç‚¹è¯´æ˜å°±æ˜¯<code>Option</code>é€‰é¡¹ä¸‹çš„å‚æ•°</p>
<p>ä»¥ç»Ÿè®¡ç£ç›˜ä½¿ç”¨å¤§å°ä¸€é¡¹æ¥ä¸¾ä¾‹</p>
<ul>
<li>Unitï¼šè¦é€‰æ‹©<code>data</code>ä¸‹çš„<code>bytes</code>å•ä½æ¥ç»Ÿè®¡</li>
<li>Decimalsï¼šå°æ•°è®¾ç½®ä¿æŒé»˜è®¤çš„autoå³å¯</li>
<li>Coloringï¼šè¿™é‡Œå¯ä»¥é€‰æ‹©æ¸²æŸ“èƒŒæ™¯è‰²æˆ–å­—ä½“è‰²<ul>
<li>Colorsæ§åˆ¶ç€ä¸‰ä¸ªé¢œè‰²ï¼Œå¯ä»¥è‡ªç”±å‘æŒ¥ï¼Œä¸€èˆ¬ç»¿è‰²ä»£è¡¨æ­£å¸¸ï¼Œé»„è‰²ä»£è¡¨é¢„è­¦ï¼Œçº¢è‰²ä»£è¡¨è­¦å‘Š</li>
<li>Thresholdså¯ä»¥è®¾ç½®ä»¥é€—å·åˆ†éš”çš„ä¸‰ä¸ªæ•°å­—ï¼Œåˆ†åˆ«è¡¨ç¤ºä¸‰ä¸ªçŠ¶æ€çš„é˜ˆå€¼</li>
<li>Spark linesæœ‰ä¸¤ç§æ˜¾ç¤ºæ¨¡å¼ï¼Œ<code>Show</code>ä¼šåœ¨æ•°æ®çš„ä¸‹æ–¹å±•ç¤ºæŠ˜çº¿ï¼›<code>Background mode</code>ä¼šåœ¨æ•´ä¸ªæ¨¡å—çš„èƒŒæ™¯å±•ç¤ºæŠ˜çº¿</li>
</ul>
</li>
</ul>
<h2 id="Text"><a href="#Text" class="headerlink" title="Text"></a>Text</h2><p>è¿™ä¸ªæ¨¡å—å¾ˆå¥½ç†è§£ï¼Œå°±æ˜¯ä¸€ä¸ªç°å®æ–‡å­—çš„æ¨¡å—ï¼Œæ”¯æŒmarkdownè¯­æ³•ï¼Œå¯ä»¥æ”¾åœ¨æ¯ä¸ªé¡µé¢çš„å¤´éƒ¨ï¼Œæ ‡è®°å½“å‰å›¾è¡¨ä¿¡æ¯çš„å½’ç±»ã€‚</p>
<h2 id="Dashboards-list"><a href="#Dashboards-list" class="headerlink" title="Dashboards list"></a>Dashboards list</h2><p>è¿™ä¸ªæ¨¡å—æ˜¯ç”¨æ¥å±•ç¤ºé¡µé¢åˆ—è¡¨ç”¨çš„ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœä¸€ä¸ªç›‘æ§ç³»ç»Ÿä¸­ï¼Œæ¶‰åŠåˆ°äº†å¤šä¸ªé¡µé¢å±•ç¤ºç›‘æ§å›¾è¡¨ï¼Œå°±ä¼šç”¨åˆ°è¿™ä¸ªåŠŸèƒ½ï¼Œè¿™ä¸ªæ¨¡å—ä¼šåˆ—å‡ºä½ éœ€è¦å±•ç¤ºçš„é¡µé¢çš„åˆ—è¡¨ï¼Œæ–¹ä¾¿åœ¨å½“å‰é¡µé¢ä¸­ï¼Œå¿«é€Ÿçš„åˆ‡æ¢åˆ°å…¶ä»–ç›‘æ§é¡µé¢ã€‚</p>
<h2 id="æœ€ç»ˆæ•ˆæœå›¾"><a href="#æœ€ç»ˆæ•ˆæœå›¾" class="headerlink" title="æœ€ç»ˆæ•ˆæœå›¾"></a>æœ€ç»ˆæ•ˆæœå›¾</h2><p><img src="http://oss.20150509.cn/grafana_5.jpg" alt="Final"></p>
<h2 id="é¡µé¢è‡ªåŠ¨åˆ·æ–°"><a href="#é¡µé¢è‡ªåŠ¨åˆ·æ–°" class="headerlink" title="é¡µé¢è‡ªåŠ¨åˆ·æ–°"></a>é¡µé¢è‡ªåŠ¨åˆ·æ–°</h2><p>ç‚¹å‡»å³ä¸Šè§’<code>Last 6 hours</code>, åœ¨å¼¹å‡ºçš„ä¸‹æ‹‰æ¡†ä¸­ï¼Œé€‰æ‹©<code>Time range</code>ä¸‹çš„<code>Refreshing every</code>é€‰é¡¹ï¼Œç‚¹å‡»ä¸‹æ‹‰æ¡†æŒ‰é’®ï¼Œé»˜è®¤åº”è¯¥æœ‰<code>off</code> å’Œ <code>1m</code>ä¸¤ä¸ªé€‰é¡¹ã€‚ç‚¹å‡»<code>1m</code> ç„¶å<code>Apply</code>è®¾ç½®ã€‚å³ä¸ºæ¯ä¸€åˆ†é’Ÿåˆ·æ–°ä¸€æ¬¡æ•°æ®çš„æ„æ€ã€‚<strong>è®¾ç½®æˆåŠŸå</strong>ï¼Œåœ¨åŸæ¥<code>Last 6 hours</code>çš„åé¢ä¼šå‡ºç°<code>Refresh every 1m</code>çš„æ©™è‰²æ–‡å­—ï¼</p>
<hr>
<h1 id="é™„å½•ï¼šå‚è€ƒæ–‡æ¡£"><a href="#é™„å½•ï¼šå‚è€ƒæ–‡æ¡£" class="headerlink" title="é™„å½•ï¼šå‚è€ƒæ–‡æ¡£"></a>é™„å½•ï¼šå‚è€ƒæ–‡æ¡£</h1><p><a href="https://www.zabbix.com/documentation/3.0/manual/installation/requirements" target="_blank" rel="noopener">Zabbix 3.0å®˜æ–¹æ–‡æ¡£</a></p>
<p><a href="http://cnzhx.net/blog/remi-repository/#i-2" target="_blank" rel="noopener">Remiå®˜æ–¹æ–‡æ¡£</a></p>
<p><a href="http://grafana.org/" target="_blank" rel="noopener">Grafanaå®˜æ–¹ç½‘ç«™</a></p>
<p><a href="http://docs.grafana.org/installation/rpm/" target="_blank" rel="noopener">Grafanaå®˜æ–¹å®‰è£…æ–‡æ¡£</a></p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>Grafana</tag>
        <tag>Zabbix</tag>
        <tag>PHP</tag>
        <tag>Remi</tag>
      </tags>
  </entry>
  <entry>
    <title>Requires: libt1.so.5()(64bit)</title>
    <url>/2016/03/02/Requires-libt1-so-5-64bit/</url>
    <content><![CDATA[<blockquote>
<p>åœ¨ä½¿ç”¨yumå®‰è£…php5.5çš„è¿‡ç¨‹ä¸­ï¼Œå‡ºç°äº†å¦‚ä¸‹ä¾èµ–ï¼š<br>â€“&gt; Finished Dependency Resolution<br>Error: Package: php-gd-5.4.45-4.el6.remi.x86_64 (remi)<br>           Requires: libt1.so.5()(64bit)<br>é€šè¿‡yum provides å‘½ä»¤åæŸ¥è¯¢åå‘ç°æ˜¯ç”±äºç¼ºå°‘äº†t1libè¿™ä¸ªè½¯ä»¶åŒ…</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">shell&gt; yum install --enablerepo=remi php php-gd</span><br><span class="line">...</span><br><span class="line">--&gt; Processing Dependency: libt1.so.5()(64bit) <span class="keyword">for</span> package: php-gd-5.4.45-4.el6.remi.x86_64</span><br><span class="line">--&gt; Finished Dependency Resolution</span><br><span class="line">Error: Package: php-gd-5.4.45-4.el6.remi.x86_64 (remi)</span><br><span class="line">           Requires: libt1.so.5()(64bit)</span><br><span class="line"> You could try using --skip-broken to work around the problem</span><br><span class="line"> You could try running: rpm -Va --nofiles --nodigest</span><br></pre></td></tr></table></figure>

<p>å®‰è£…phpçš„è¿‡ç¨‹ä¸­å‡ºç°äº†ä¸å¯è§£å†³çš„ä¾èµ–è½¯ä»¶<code>libt1.so.5()(64bit)</code></p>
<p>ä½¿ç”¨yumçš„åæŸ¥è¯¢åŠŸèƒ½æŸ¥å‡ºåŒ…å«æœ‰è¿™ä¸ªåº“æ–‡ä»¶çš„è½¯ä»¶åŒ…æ˜¯å“ªä¸€ä¸ª<br>(åœ¨ä½¿ç”¨yumåæŸ¥è¯¢åæ²¡æœ‰å¾—åˆ°ä»»ä½•ç»“æœï¼Œåæ¥æ’æŸ¥å¾—çŸ¥æ˜¯æˆ‘yumçš„base repoè®¾ç½®æœ‰é—®é¢˜ï¼Œå¯¼è‡´yumè¯»ä¸åˆ°baseä¸­çš„è½¯ä»¶åº“ä¿¡æ¯ã€‚å¤šè¯´ä¸€å¥ï¼Œå¦‚æœé‡åˆ°ä»¥ä¸Šé—®é¢˜ï¼Œå¯ä»¥æ’æŸ¥ä¸€ä¸‹æ˜¯ä¸æ˜¯æœåŠ¡å™¨çš„base repoå‡ºç°çš„é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨centosè‡ªå¸¦çš„centos-base.repoï¼Œä¹Ÿå¯ä»¥ä¸‹è½½163çš„centos-base-163.repoåº“)</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">shell&gt; yum provides <span class="string">"*/libt1.so.5"</span></span><br><span class="line">Loaded plugins: fastestmirror, refresh-packagekit, security</span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line"> * base: mirrors.yun-idc.com</span><br><span class="line"> * epel: mirrors.opencas.cn</span><br><span class="line"> * extras: mirrors.yun-idc.com</span><br><span class="line"> * remi-safe: mirror.innosol.asia</span><br><span class="line"> * rpmforge: mirrors.neusoft.edu.cn</span><br><span class="line"> * updates: mirrors.yun-idc.com</span><br><span class="line">t1lib-5.1.2-6.el6_2.1.x86_64 : PostScript Type 1 font rasterizer</span><br><span class="line">Repo        : base</span><br><span class="line">Matched from:</span><br><span class="line">Filename    : /usr/lib64/libt1.so.5</span><br><span class="line"></span><br><span class="line">t1lib-5.1.2-6.el6_2.1.i686 : PostScript Type 1 font rasterizer</span><br><span class="line">Repo        : base</span><br><span class="line">Matched from:</span><br><span class="line">Filename    : /usr/lib/libt1.so.5</span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥ï¼Œè§£å†³è¿™ä¸ªé—®é¢˜åªéœ€<code>yum install t1lib -y</code>å³å¯</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>PHP</tag>
        <tag>Error</tag>
        <tag>libt1.so.5</tag>
        <tag>t1lib</tag>
      </tags>
  </entry>
  <entry>
    <title>å¿˜è®°MySQLå¯†ç </title>
    <url>/2016/02/03/%E5%BF%98%E8%AE%B0MySQL%E5%AF%86%E7%A0%81/</url>
    <content><![CDATA[<h1 id="Step1-ä¿®æ”¹é…ç½®æ–‡ä»¶"><a href="#Step1-ä¿®æ”¹é…ç½®æ–‡ä»¶" class="headerlink" title="Step1 ä¿®æ”¹é…ç½®æ–‡ä»¶"></a>Step1 ä¿®æ”¹é…ç½®æ–‡ä»¶</h1><p>ä¿®æ”¹MySQLçš„é…ç½®æ–‡ä»¶ï¼ˆé»˜è®¤ä¸º/etc/my.cnfï¼‰,åœ¨[mysqld]ä¸‹æ·»åŠ ä¸€è¡Œskip-grant-tables</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@PolarSnow hexo]# cat &#x2F;etc&#x2F;my.cnf </span><br><span class="line">[mysqld]</span><br><span class="line">datadir&#x3D;&#x2F;var&#x2F;lib&#x2F;mysql</span><br><span class="line">socket&#x3D;&#x2F;var&#x2F;lib&#x2F;mysql&#x2F;mysql.sock</span><br><span class="line">user&#x3D;mysql</span><br><span class="line"># Disabling symbolic-links is recommended to prevent assorted security risks</span><br><span class="line">symbolic-links&#x3D;0</span><br><span class="line">character-set-server&#x3D;utf8</span><br><span class="line">innodb_file_per_table&#x3D;1</span><br><span class="line">skip-grant-tables</span><br></pre></td></tr></table></figure>

<h1 id="Step2-é‡å¯MySQLæœåŠ¡"><a href="#Step2-é‡å¯MySQLæœåŠ¡" class="headerlink" title="Step2 é‡å¯MySQLæœåŠ¡"></a>Step2 é‡å¯MySQLæœåŠ¡</h1><p><code>service mysqld restart</code></p>
<h1 id="Step3-å†æ¬¡è¿›å…¥MySQLå‘½ä»¤è¡Œ"><a href="#Step3-å†æ¬¡è¿›å…¥MySQLå‘½ä»¤è¡Œ" class="headerlink" title="Step3 å†æ¬¡è¿›å…¥MySQLå‘½ä»¤è¡Œ"></a>Step3 å†æ¬¡è¿›å…¥MySQLå‘½ä»¤è¡Œ</h1><p><code>mysql -uroot -p</code> è¾“å…¥å¯†ç æ—¶ç›´æ¥å›è½¦ï¼Œå°±ä¼šè¿›å…¥MySQLæ•°æ®åº“äº†</p>
<p>æ¥ä¸‹æ¥æŒ‰ç…§å¸¸è§„æµç¨‹ä¿®æ”¹rootå¯†ç å³å¯</p>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>åˆ›å»ºMySQLç”¨æˆ·å¹¶æˆæƒ</title>
    <url>/2016/02/03/%E5%88%9B%E5%BB%BAMySQL%E7%94%A8%E6%88%B7%E5%B9%B6%E6%8E%88%E6%9D%83/</url>
    <content><![CDATA[<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@MasterDatabase ~]# mysql</span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 161391</span><br><span class="line">Server version: 5.1.73-log Source distribution</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2013, Oracle and&#x2F;or its affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and&#x2F;or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type &#39;help;&#39; or &#39;\h&#39; for help. Type &#39;\c&#39; to clear the current input statement.</span><br><span class="line"></span><br><span class="line">mysql&gt; show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| mysql              |</span><br><span class="line">| test               |</span><br><span class="line">| zabbix             |</span><br><span class="line">+--------------------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; create user &#39;wordpress&#39;@&#39;%&#39; identified by &#39;wordpress&#39;;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; create database wordpress;</span><br><span class="line">Query OK, 1 row affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; grant all privileges on wordpress.* to &#39;wordpress&#39;@&#39;%&#39;;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">åˆ›å»ºç”¨æˆ·ï¼š</span><br><span class="line">CREATE USER &#39;username&#39;@&#39;host&#39; IDENTIFIED BY &#39;password&#39;;</span><br><span class="line"></span><br><span class="line">CREATE USER &#39;username&#39;@&#39;192.168.5.9&#39; IDENTIFIED BY &#39;password&#39;;</span><br><span class="line">CREATE USER &#39;username&#39;@&#39;localhost&#39; IDENTIFIED BY &#39;password&#39;;</span><br><span class="line">CREATE USER &#39;username&#39;@&#39;%&#39; IDENTIFIED BY &#39;&#39;;</span><br><span class="line">CREATE USER &#39;username&#39;@&#39;%&#39;;</span><br><span class="line"></span><br><span class="line">æˆæƒï¼š</span><br><span class="line">GRANT privileges ON databasename.tablename TO &#39;username&#39;@&#39;host&#39;;</span><br><span class="line"></span><br><span class="line">GRANT SELECT,INSERT ON DBname.tablename TO &#39;username&#39;@&#39;%&#39;;</span><br><span class="line">GRANT ALL ON DBname.tablename TO &#39;username&#39;@&#39;%&#39;;</span><br><span class="line">GRANT ALL ON DBname.* TO &#39;username&#39;@&#39;%&#39;;</span><br><span class="line">GRANT ALL ON *.* TO &#39;username&#39;@&#39;%&#39;;</span><br><span class="line">æ³¨æ„ï¼šä½¿ç”¨ä»¥ä¸Šå‘½ä»¤æˆæƒçš„ç”¨æˆ·ä¸èƒ½ç”¨æ¥å†ç»™å…¶ä»–ç”¨æˆ·æˆæƒ</span><br><span class="line">å¦‚æœæƒ³è®©è¯¥ç”¨æˆ·å¯ä»¥ä¸ºå…¶ä»–ç”¨æˆ·æˆæƒï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š</span><br><span class="line">GRANT privileges ON databasename.tablename TO &#39;username&#39;@&#39;host&#39; WITH GRANT OPTION;</span><br><span class="line"></span><br><span class="line">è®¾ç½®&#x2F;æ›´æ”¹ç”¨æˆ·å¯†ç </span><br><span class="line">SET PASSWORD FOR &#39;username&#39;@&#39;host&#39;&#x3D;PASSWORD(&#39;newpassword&#39;);</span><br><span class="line">å¦‚æœæ˜¯ä¿®æ”¹å½“å‰ç™»å½•çš„ç”¨æˆ·çš„å¯†ç ï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š</span><br><span class="line">SET PASSWDORD&#x3D;PASSWORD(&#39;newpassword&#39;)</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>è§£å†³ImportError: No module named zlib</title>
    <url>/2016/01/21/%E8%A7%A3%E5%86%B3ImportError-No-module-named-zlib/</url>
    <content><![CDATA[<blockquote>
<p>å¸¸ç”¨çš„CentOS6.7ä¸­ï¼Œé»˜è®¤è‡ªå¸¦çš„Pythonç‰ˆæœ¬è¿˜æ˜¯2.6.6ï¼Œå‡çº§åˆ°2.7.11åï¼Œå®‰è£…æŸäº›ç¬¬ä¸‰æ–¹çš„åº“æç¤º<code>ImportError: No module named zlib</code> ç™¾åº¦äº†ä¸€ä¸‹ï¼ŒæŒ‰ç…§å‰è¾ˆçš„æ–¹æ³•æœç„¶è§£å†³äº†é—®é¢˜ã€‚ç‰¹æ­¤è®°å½•ä¸‹æ¥ï¼</p>
</blockquote>
<p><strong>bashéƒ¨åˆ†</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yum install zlib zlib-devel openssl</span><br></pre></td></tr></table></figure>

<p><strong>pythonéƒ¨åˆ†</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cd Python2.7.11</span><br><span class="line">.&#x2F;configure --prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;python27</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

<p><strong>éªŒè¯</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; import zlib</span><br><span class="line">&gt;&gt;&gt; </span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<p><em>æ²¡æœ‰ç»“æœå°±æ˜¯æœ€å¥½çš„ç»“æœï¼</em></p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>zlib</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonçš„é«˜çº§ç‰¹æ€§</title>
    <url>/2015/12/09/Python%E7%9A%84%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7/</url>
    <content><![CDATA[<h1 id="åˆ‡ç‰‡"><a href="#åˆ‡ç‰‡" class="headerlink" title="åˆ‡ç‰‡"></a>åˆ‡ç‰‡</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">3</span>]: l = list(range(<span class="number">100</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">#å–å‰5ä¸ªå…ƒç´ </span></span><br><span class="line">In [<span class="number">4</span>]: l[:<span class="number">5</span>]</span><br><span class="line">Out[<span class="number">4</span>]: [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#å–å5ä¸ªå…ƒç´ </span></span><br><span class="line">In [<span class="number">5</span>]: l[<span class="number">-5</span>:]</span><br><span class="line">Out[<span class="number">5</span>]: [<span class="number">95</span>, <span class="number">96</span>, <span class="number">97</span>, <span class="number">98</span>, <span class="number">99</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#å–ç¬¬11-20çš„å…ƒç´ </span></span><br><span class="line">In [<span class="number">6</span>]: l[<span class="number">11</span>:<span class="number">20</span>]</span><br><span class="line">Out[<span class="number">6</span>]: [<span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">17</span>, <span class="number">18</span>, <span class="number">19</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#å–å‰10ä¸ªå…ƒç´ ï¼Œæ¯2ä¸ªå–ä¸€ä¸ª</span></span><br><span class="line">In [<span class="number">7</span>]: l[:<span class="number">10</span>:<span class="number">2</span>]</span><br><span class="line">Out[<span class="number">7</span>]: [<span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#å–ç¬¬1-10çš„å…ƒç´ ï¼Œæ¯2ä¸ªå–ä¸€ä¸ª</span></span><br><span class="line">In [<span class="number">8</span>]: l[<span class="number">1</span>:<span class="number">10</span>:<span class="number">2</span>]</span><br><span class="line">Out[<span class="number">8</span>]: [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#å–å…¨éƒ¨çš„å…ƒç´ ï¼Œæ¯10ä¸ªå–ä¸€ä¸ª</span></span><br><span class="line">In [<span class="number">9</span>]: l[::<span class="number">10</span>]</span><br><span class="line">Out[<span class="number">9</span>]: [<span class="number">0</span>, <span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>, <span class="number">50</span>, <span class="number">60</span>, <span class="number">70</span>, <span class="number">80</span>, <span class="number">90</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#å–å¾—å…¨éƒ¨å…ƒç´ </span></span><br><span class="line">In [<span class="number">10</span>]: l[:]</span><br><span class="line"></span><br><span class="line"><span class="comment">#è®°ä½æœ€åä¸€ä¸ªå…ƒç´ çš„ç´¢å¼•æ˜¯-1</span></span><br><span class="line">In [<span class="number">11</span>]: l[<span class="number">-1</span>]</span><br><span class="line">Out[<span class="number">11</span>]: <span class="number">99</span></span><br></pre></td></tr></table></figure>

<h2 id="liståˆ‡ç‰‡"><a href="#liståˆ‡ç‰‡" class="headerlink" title="liståˆ‡ç‰‡"></a>liståˆ‡ç‰‡</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">1</span>]: l = [<span class="string">'apple'</span>, <span class="string">'google'</span>, <span class="string">'facebook'</span>, <span class="string">'microsoft'</span>, <span class="string">'linkin'</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">2</span>]: l</span><br><span class="line">Out[<span class="number">2</span>]: [<span class="string">'apple'</span>, <span class="string">'google'</span>, <span class="string">'facebook'</span>, <span class="string">'microsoft'</span>, <span class="string">'linkin'</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">3</span>]: l[<span class="number">0</span>:<span class="number">3</span>]</span><br><span class="line">Out[<span class="number">3</span>]: [<span class="string">'apple'</span>, <span class="string">'google'</span>, <span class="string">'facebook'</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">4</span>]: l[:<span class="number">3</span>]</span><br><span class="line">Out[<span class="number">4</span>]: [<span class="string">'apple'</span>, <span class="string">'google'</span>, <span class="string">'facebook'</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">5</span>]: l[<span class="number">1</span>:<span class="number">3</span>]</span><br><span class="line">Out[<span class="number">5</span>]: [<span class="string">'google'</span>, <span class="string">'facebook'</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">6</span>]: l[<span class="number">-2</span>:]</span><br><span class="line">Out[<span class="number">6</span>]: [<span class="string">'microsoft'</span>, <span class="string">'linkin'</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">7</span>]: l[<span class="number">-2</span>:<span class="number">-1</span>]</span><br><span class="line">Out[<span class="number">7</span>]: [<span class="string">'microsoft'</span>]</span><br></pre></td></tr></table></figure>

<h2 id="tupleåˆ‡ç‰‡"><a href="#tupleåˆ‡ç‰‡" class="headerlink" title="tupleåˆ‡ç‰‡"></a>tupleåˆ‡ç‰‡</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">13</span>]: (<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>)[:<span class="number">3</span>]</span><br><span class="line">Out[<span class="number">13</span>]: (<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<h2 id="stråˆ‡ç‰‡"><a href="#stråˆ‡ç‰‡" class="headerlink" title="stråˆ‡ç‰‡"></a>stråˆ‡ç‰‡</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">14</span>]: <span class="string">'apple'</span>[:<span class="number">3</span>]</span><br><span class="line">Out[<span class="number">14</span>]: <span class="string">'app'</span></span><br></pre></td></tr></table></figure>

<hr>
<h1 id="è¿­ä»£"><a href="#è¿­ä»£" class="headerlink" title="è¿­ä»£"></a>è¿­ä»£</h1><p>åœ¨Pythonä¸­è¿­ä»£æ˜¯é€šè¿‡<code>for ... in ...</code>æ¥å®ç°çš„</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">15</span>]: d = &#123;<span class="string">'apple'</span>:<span class="string">'pages'</span>, <span class="string">'google'</span>:<span class="string">'docs'</span>, <span class="string">'microsoft'</span>:<span class="string">'word'</span>&#125;</span><br><span class="line"></span><br><span class="line">In [<span class="number">16</span>]: <span class="keyword">for</span> key <span class="keyword">in</span> d:</span><br><span class="line">   ....:     <span class="keyword">print</span> key</span><br><span class="line">   ....:     </span><br><span class="line">google</span><br><span class="line">apple</span><br><span class="line">microsoft</span><br><span class="line"></span><br><span class="line">In [<span class="number">17</span>]: <span class="keyword">for</span> value <span class="keyword">in</span> d.values():</span><br><span class="line">   ....:     <span class="keyword">print</span> value</span><br><span class="line">   ....:     </span><br><span class="line">docs</span><br><span class="line">pages</span><br><span class="line">word</span><br><span class="line"></span><br><span class="line">In [<span class="number">18</span>]: <span class="keyword">for</span> k, v <span class="keyword">in</span> d.items():</span><br><span class="line">   ....:     <span class="keyword">print</span> k,v</span><br><span class="line">   ....:     </span><br><span class="line">google docs</span><br><span class="line">apple pages</span><br><span class="line">microsoft word</span><br></pre></td></tr></table></figure>

<p>åˆ—è¡¨ã€å…ƒç»„ã€å­—å…¸å’Œå­—ç¬¦ä¸²éƒ½æ˜¯å¯è¿­ä»£å¯¹è±¡<br>åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯å¯è¿­ä»£å¯¹è±¡ï¼Œé€šè¿‡collectionsæ¨¡å—çš„Iterableæ¥åˆ¤æ–­</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">22</span>]: <span class="keyword">from</span> collections <span class="keyword">import</span> Iterable</span><br><span class="line"></span><br><span class="line">In [<span class="number">23</span>]: isinstance(<span class="string">'123'</span>, Iterable)</span><br><span class="line">Out[<span class="number">23</span>]: <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">24</span>]: isinstance([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], Iterable)</span><br><span class="line">Out[<span class="number">24</span>]: <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">25</span>]: isinstance((<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>), Iterable)</span><br><span class="line">Out[<span class="number">25</span>]: <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">26</span>]: isinstance(&#123;<span class="string">'a'</span>:<span class="number">1</span>, <span class="string">'b'</span>:<span class="number">2</span>, <span class="string">'c'</span>:<span class="number">3</span>&#125;, Iterable)</span><br><span class="line">Out[<span class="number">26</span>]: <span class="literal">True</span></span><br></pre></td></tr></table></figure>

<hr>
<h1 id="enumerate"><a href="#enumerate" class="headerlink" title="enumerate"></a>enumerate</h1><p>Pythonå†…ç½®çš„enumerateå‡½æ•°å¯ä»¥æŠŠä¸€ä¸ªlistå˜æˆç´¢å¼•-å…ƒç´ å¯¹ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨forå¾ªç¯ä¸­åŒæ—¶è¿­ä»£ç´¢å¼•å’Œå…ƒç´ æœ¬èº«</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">27</span>]: <span class="keyword">for</span> i, value <span class="keyword">in</span> enumerate([<span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>]):</span><br><span class="line">   ....:     print(i, value)</span><br><span class="line">   ....:    </span><br><span class="line">(<span class="number">0</span>, <span class="string">'A'</span>)</span><br><span class="line">(<span class="number">1</span>, <span class="string">'B'</span>)</span><br><span class="line">(<span class="number">2</span>, <span class="string">'C'</span>)</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="åˆ—è¡¨ç”Ÿæˆå¼"><a href="#åˆ—è¡¨ç”Ÿæˆå¼" class="headerlink" title="åˆ—è¡¨ç”Ÿæˆå¼"></a>åˆ—è¡¨ç”Ÿæˆå¼</h1><p>åˆ—è¡¨ç”Ÿæˆå¼æœ‰è‡ªå·±çš„ç‰¹æ®Šè¯­æ³•<br>æŠŠè¦ç”Ÿæˆçš„å…ƒç´ æ”¾åˆ°<code>æœ€å‰é¢</code>ï¼Œåè·Ÿ<code>for</code>å¾ªç¯ï¼Œå°±å¯ä»¥åˆ›å»ºä¸€ä¸ª<code>list</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">n [<span class="number">29</span>]: [i * i <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">10</span>)]</span><br><span class="line">Out[<span class="number">29</span>]: [<span class="number">1</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">16</span>, <span class="number">25</span>, <span class="number">36</span>, <span class="number">49</span>, <span class="number">64</span>, <span class="number">81</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#äºŒå±‚å¾ªç¯å®ç°å…¨æ’åˆ—</span></span><br><span class="line">In [<span class="number">30</span>]: [m + n <span class="keyword">for</span> m <span class="keyword">in</span> <span class="string">'ABC'</span> <span class="keyword">for</span> n <span class="keyword">in</span> <span class="string">'XYZ'</span>]</span><br><span class="line">Out[<span class="number">30</span>]: [<span class="string">'AX'</span>, <span class="string">'AY'</span>, <span class="string">'AZ'</span>, <span class="string">'BX'</span>, <span class="string">'BY'</span>, <span class="string">'BZ'</span>, <span class="string">'CX'</span>, <span class="string">'CY'</span>, <span class="string">'CZ'</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#åˆ—å‡ºæ ¹ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å’Œæ–‡ä»¶å¤¹</span></span><br><span class="line">In [<span class="number">37</span>]: [f <span class="keyword">for</span> f <span class="keyword">in</span> os.listdir(<span class="string">'/'</span>)]</span><br><span class="line">Out[<span class="number">37</span>]: </span><br><span class="line">[<span class="string">'.autorelabel'</span>,</span><br><span class="line"> <span class="string">'lib'</span>,</span><br><span class="line"> <span class="string">'sbin'</span>,</span><br><span class="line"> <span class="string">'proc'</span>,</span><br><span class="line"> <span class="string">'dev'</span>,</span><br><span class="line"> <span class="string">'lib64'</span>,</span><br><span class="line"> <span class="string">'mnt'</span>,</span><br><span class="line"> <span class="string">'usr'</span>,</span><br><span class="line"> <span class="string">'etc'</span>,</span><br><span class="line"> <span class="string">'var'</span>,</span><br><span class="line"> <span class="string">'selinux'</span>,</span><br><span class="line"> <span class="string">'.autofsck'</span>,</span><br><span class="line"> <span class="string">'sys'</span>,</span><br><span class="line"> <span class="string">'srv'</span>,</span><br><span class="line"> <span class="string">'media'</span>,</span><br><span class="line"> <span class="string">'tmp'</span>,</span><br><span class="line"> <span class="string">'data'</span>,</span><br><span class="line"> <span class="string">'boot'</span>,</span><br><span class="line"> <span class="string">'lost+found'</span>,</span><br><span class="line"> <span class="string">'home'</span>,</span><br><span class="line"> <span class="string">'root'</span>,</span><br><span class="line"> <span class="string">'opt'</span>,</span><br><span class="line"> <span class="string">'bin'</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#åˆ—è¡¨ç”Ÿæˆå¼ä½¿ç”¨ä¸¤ä¸ªå˜é‡æ¥ç”Ÿæˆåˆ—è¡¨</span></span><br><span class="line">In [<span class="number">38</span>]: d</span><br><span class="line">Out[<span class="number">38</span>]: &#123;<span class="string">'apple'</span>: <span class="string">'pages'</span>, <span class="string">'google'</span>: <span class="string">'docs'</span>, <span class="string">'microsoft'</span>: <span class="string">'word'</span>&#125;</span><br><span class="line"></span><br><span class="line">In [<span class="number">39</span>]: [k + <span class="string">'--&gt;'</span> + v <span class="keyword">for</span> k,v <span class="keyword">in</span> d.items()]</span><br><span class="line">Out[<span class="number">39</span>]: [<span class="string">'google--&gt;docs'</span>, <span class="string">'apple--&gt;pages'</span>, <span class="string">'microsoft--&gt;word'</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#å°†åˆ—è¡¨ä¸­çš„å…ƒç´ å…¨éƒ¨è½¬ä¸ºå°å†™æˆ–å¤§å†™</span></span><br><span class="line">In [<span class="number">42</span>]: l = [<span class="string">'apple'</span>, <span class="string">'google'</span>, <span class="string">'facebook'</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">43</span>]: [s.lower() <span class="keyword">for</span> s <span class="keyword">in</span> l]</span><br><span class="line">Out[<span class="number">43</span>]: [<span class="string">'apple'</span>, <span class="string">'google'</span>, <span class="string">'facebook'</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">44</span>]: [s.upper() <span class="keyword">for</span> s <span class="keyword">in</span> l]</span><br><span class="line">Out[<span class="number">44</span>]: [<span class="string">'APPLE'</span>, <span class="string">'GOOGLE'</span>, <span class="string">'FACEBOOK'</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">45</span>]: l.append(<span class="number">59</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">46</span>]: l</span><br><span class="line">Out[<span class="number">46</span>]: [<span class="string">'apple'</span>, <span class="string">'google'</span>, <span class="string">'facebook'</span>, <span class="number">59</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">47</span>]: [s.upper() <span class="keyword">for</span> s <span class="keyword">in</span> l]</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">AttributeError                            Traceback (most recent call last)</span><br><span class="line">&lt;ipython-input<span class="number">-47</span><span class="number">-0e109</span>a4f23f3&gt; <span class="keyword">in</span> &lt;module&gt;()</span><br><span class="line">----&gt; 1 [s.upper() for s in l]</span><br><span class="line"></span><br><span class="line">AttributeError: <span class="string">'int'</span> object has no attribute <span class="string">'upper'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¸Šé¢é‡åˆ°åˆ—è¡¨ä¸­å‡ºç°å­—ç¬¦ä¸²å’Œæ•°å­—æ··åˆçš„æƒ…å†µï¼Œæ•°å­—å¯¹è±¡æ²¡æœ‰upper()æˆ–lower()æ–¹æ³•</span></span><br><span class="line"><span class="comment">#è¿™æ—¶éœ€è¦ä½¿ç”¨åˆ¤æ–­æ¥æ’é™¤æ•°å­—çš„æƒ…å†µ</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">52</span>]: l</span><br><span class="line">Out[<span class="number">52</span>]: [<span class="string">'apple'</span>, <span class="string">'google'</span>, <span class="string">'facebook'</span>, <span class="number">59</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">53</span>]: [s.upper() <span class="keyword">for</span> s <span class="keyword">in</span> l <span class="keyword">if</span> isinstance(s, str)]</span><br><span class="line">Out[<span class="number">53</span>]: [<span class="string">'APPLE'</span>, <span class="string">'GOOGLE'</span>, <span class="string">'FACEBOOK'</span>]</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="ç”Ÿæˆå™¨ï¼ˆyieldï¼‰"><a href="#ç”Ÿæˆå™¨ï¼ˆyieldï¼‰" class="headerlink" title="ç”Ÿæˆå™¨ï¼ˆyieldï¼‰"></a>ç”Ÿæˆå™¨ï¼ˆyieldï¼‰</h1><p>ç”Ÿæˆå™¨è¿”å›ä¸€ä¸ª<code>å¯è¿­ä»£çš„å¯¹è±¡</code></p>
<p>ç”Ÿæˆå™¨çš„å…³é”®å­—<code>yield</code>ï¼Œä¸<code>return</code>çš„åŒºåˆ«æ˜¯</p>
<ul>
<li><p>return ç«‹å³è¿”å›ç»“æœå¹¶ç»“æŸå‡½æ•°</p>
</li>
<li><p>yield è¿”å›ç»“æœå¹¶æš‚åœå‡½æ•°ï¼Œç­‰å¾…<code>next()</code>çš„ä¸‹ä¸€æ¬¡è°ƒç”¨</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">1</span>]: <span class="function"><span class="keyword">def</span> <span class="title">my_fun</span><span class="params">()</span>:</span></span><br><span class="line">   ...:         sum = <span class="number">1</span></span><br><span class="line">   ...:         <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">   ...:                 sum = sum + <span class="number">1</span></span><br><span class="line">   ...:                 <span class="keyword">yield</span> sum</span><br><span class="line">   ...:         </span><br><span class="line"></span><br><span class="line">In [<span class="number">2</span>]: m = my_fun()</span><br><span class="line"></span><br><span class="line">In [<span class="number">3</span>]: m.next()</span><br><span class="line">Out[<span class="number">3</span>]: <span class="number">2</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">4</span>]: m.next()</span><br><span class="line">Out[<span class="number">4</span>]: <span class="number">3</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">5</span>]: m.next()</span><br><span class="line">Out[<span class="number">5</span>]: <span class="number">4</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">6</span>]: m.next()</span><br><span class="line">Out[<span class="number">6</span>]: <span class="number">5</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">7</span>]: my_fun()</span><br><span class="line">Out[<span class="number">7</span>]: &lt;generator object my_fun at <span class="number">0x2767a00</span>&gt;</span><br><span class="line"></span><br><span class="line">In [<span class="number">8</span>]: my_fun().next()</span><br><span class="line">Out[<span class="number">8</span>]: <span class="number">2</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">9</span>]: my_fun().next()</span><br><span class="line">Out[<span class="number">9</span>]: <span class="number">2</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">10</span>]: my_fun().next()</span><br><span class="line">Out[<span class="number">10</span>]: <span class="number">2</span></span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢ä»‹ç»çš„<code>åˆ—è¡¨ç”Ÿæˆå¼</code>ä¹Ÿå¯ä»¥å˜æˆ<code>ç”Ÿæˆå™¨ç”Ÿæˆå¼</code></p>
<p>åªéœ€æŠŠ<code>ä¸­æ‹¬å·</code>æ¢æˆ<code>å°æ‹¬å·</code>å°±å˜æˆäº†ä¸€ä¸ªç”Ÿæˆå™¨</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">11</span>]: L = [x * x <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">10</span>)]</span><br><span class="line"></span><br><span class="line">In [<span class="number">12</span>]: L</span><br><span class="line">Out[<span class="number">12</span>]: [<span class="number">0</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">16</span>, <span class="number">25</span>, <span class="number">36</span>, <span class="number">49</span>, <span class="number">64</span>, <span class="number">81</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="number">13</span>]: G = (x * x <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">10</span>))</span><br><span class="line"></span><br><span class="line">In [<span class="number">14</span>]: G</span><br><span class="line">Out[<span class="number">14</span>]: &lt;generator object &lt;genexpr&gt; at <span class="number">0x2767aa0</span>&gt;</span><br><span class="line"></span><br><span class="line">In [<span class="number">15</span>]: G.next()</span><br><span class="line">Out[<span class="number">15</span>]: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">16</span>]: G.next()</span><br><span class="line">Out[<span class="number">16</span>]: <span class="number">1</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">17</span>]: G.next()</span><br><span class="line">Out[<span class="number">17</span>]: <span class="number">4</span></span><br></pre></td></tr></table></figure>

<p><strong>ç”Ÿæˆå™¨ä¿å­˜çš„æ˜¯ç®—æ³•ï¼Œåœ¨ä½¿ç”¨æ—¶è®¡ç®—ç»“æœï¼ŒèŠ‚çœå†…å­˜ç©ºé—´</strong></p>
<hr>
<h1 id="è¿­ä»£å™¨"><a href="#è¿­ä»£å™¨" class="headerlink" title="è¿­ä»£å™¨"></a>è¿­ä»£å™¨</h1><p>å¯ä»¥ç›´æ¥ä½œç”¨äº<code>for</code>å¾ªç¯çš„æ•°æ®ç±»å‹æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p>
<ul>
<li><p>é›†åˆæ•°æ®ç±»å‹ã€‚å¦‚<code>list</code> <code>tuple</code>  <code>dict</code> <code>set</code> <code>str</code>ç­‰</p>
</li>
<li><p>generatorï¼ŒåŒ…æ‹¬ç”Ÿæˆå™¨å’Œå¸¦yieldçš„generator function</p>
</li>
</ul>
<p>è¿™äº›å¯ä»¥ç›´æ¥ä½œç”¨äº<code>for</code>å¾ªç¯çš„å¯¹è±¡ç»Ÿç§°ä¸ºå¯è¿­ä»£å¯¹è±¡<code>Iterable</code></p>
<p>å¯ä»¥ä½¿ç”¨<code>isinstance()</code>åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯<code>Iterable</code>å¯è¿­ä»£å¯¹è±¡</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">20</span>]: <span class="keyword">from</span> collections <span class="keyword">import</span> Iterable</span><br><span class="line"></span><br><span class="line">In [<span class="number">21</span>]: isinstance([],Iterable)</span><br><span class="line">Out[<span class="number">21</span>]: <span class="literal">True</span></span><br></pre></td></tr></table></figure>

<p><strong>ç”Ÿæˆå™¨</strong>ä¸ä½†å¯ä»¥ä½œç”¨äº<code>for</code>å¾ªç¯ï¼Œè¿˜å¯ä»¥è¢«<code>next()</code>å‡½æ•°ä¸æ–­è°ƒç”¨å¹¶è¿”å›ä¸‹ä¸€ä¸ªå€¼ï¼Œæœ€åæŠ›å‡º<code>StopIteration</code>å¼‚å¸¸ï¼Œè¡¨ç¤ºå·²ç»ç»“æŸï¼Œæ— æ³•è¿”å›ä¸‹ä¸€ä¸ªå€¼</p>
<p>å¯ä»¥è¢«<code>next()</code>å‡½æ•°è°ƒç”¨å¹¶ä¸æ–­è¿”å›ä¸‹ä¸€ä¸ªå€¼çš„å¯¹è±¡ç§°ä¸º<strong>è¿­ä»£å™¨</strong>ï¼š<code>Iterator</code></p>
<p>å¯ä»¥ä½¿ç”¨<code>isinstance()</code>åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯<code>Iterator</code>å¯¹è±¡</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">24</span>]: <span class="keyword">from</span> collections <span class="keyword">import</span> Iterator</span><br><span class="line"></span><br><span class="line">In [<span class="number">25</span>]: isinstance((x <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">10</span>)), Iterator)</span><br><span class="line">Out[<span class="number">25</span>]: <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">26</span>]: isinstance([], Iterator)</span><br><span class="line">Out[<span class="number">26</span>]: <span class="literal">False</span></span><br></pre></td></tr></table></figure>

<h2 id="Iterator-å’Œ-Iterableçš„åŒºåˆ«"><a href="#Iterator-å’Œ-Iterableçš„åŒºåˆ«" class="headerlink" title="Iterator å’Œ Iterableçš„åŒºåˆ«"></a>Iterator å’Œ Iterableçš„åŒºåˆ«</h2><ul>
<li><p>ç”Ÿæˆå™¨éƒ½æ˜¯Iteratorå¯¹è±¡ï¼Œä½†<code>list</code> <code>dict</code>ç­‰æ˜¯Iterableï¼Œä½†ä¸æ˜¯Iterator</p>
</li>
<li><p>Iteratoræ˜¯è¿­ä»£å™¨ï¼Œéœ€è¦åŒæ—¶å…·å¤‡<code>__iter__</code>å’Œ<code>next</code>ä¸¤ä¸ªæ–¹æ³•ï¼Œå®ƒä»¬è¡¨ç¤ºä¸€ä¸ªæƒ°æ€§è®¡ç®—çš„åºåˆ—</p>
</li>
<li><p>Iterableæ˜¯å¯è¿­ä»£å¯¹è±¡ï¼Œåˆ—è¡¨å…ƒç»„ç­‰æ•°æ®ç»“æ„åŒæ ·æ˜¯å¯è¿­ä»£å¯¹è±¡ï¼Œå…·å¤‡<code>__iter__</code>æ–¹æ³•ï¼Œä½†ä¸å…·å¤‡<code>next</code>æ–¹æ³•</p>
</li>
</ul>
<p><strong>ä½¿ç”¨forå¾ªç¯éå†å¯è¿­ä»£å¯¹è±¡æ—¶ï¼Œforå¾ªç¯è‡ªåŠ¨è°ƒç”¨next()å‡½æ•°ï¼Œå¹¶åœ¨æ¥æ”¶åˆ°ç»“æŸå¼‚å¸¸æ—¶é€€å‡ºå¾ªç¯</strong></p>
<hr>
<p>å‚è€ƒæ–‡ç« ï¼š<a href="http://www.liaoxuefeng.com/" target="_blank" rel="noopener">http://www.liaoxuefeng.com/</a></p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>åˆ‡ç‰‡</tag>
        <tag>ç”Ÿæˆå™¨</tag>
        <tag>Iterator</tag>
        <tag>Iterable</tag>
        <tag>è¿­ä»£å™¨</tag>
        <tag>yield</tag>
        <tag>åˆ—è¡¨ç”Ÿæˆå¼</tag>
        <tag>enumerate</tag>
        <tag>è¿­ä»£</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonå‡½æ•°ç¬”è®°</title>
    <url>/2015/12/08/Python%E5%87%BD%E6%95%B0%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<h1 id="å®šä¹‰å‡½æ•°"><a href="#å®šä¹‰å‡½æ•°" class="headerlink" title="å®šä¹‰å‡½æ•°"></a>å®šä¹‰å‡½æ•°</h1><h2 id="åŸºç¡€è¯­æ³•"><a href="#åŸºç¡€è¯­æ³•" class="headerlink" title="åŸºç¡€è¯­æ³•"></a>åŸºç¡€è¯­æ³•</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_fun</span><span class="params">(arg)</span>:</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">"run function"</span></span><br><span class="line">    <span class="keyword">return</span> arg * arg</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæ²¡æœ‰å†™<code>return</code>è¯­å¥ï¼Œå‡½æ•°æ‰§è¡Œä¹‹åä¼šè¿”å›<code>None</code></p>
<h2 id="å‡½æ•°çš„è¿”å›å€¼"><a href="#å‡½æ•°çš„è¿”å›å€¼" class="headerlink" title="å‡½æ•°çš„è¿”å›å€¼"></a>å‡½æ•°çš„è¿”å›å€¼</h2><p>å¯ä»¥æœ‰å¤šä¸ªè¿”å›å€¼ï¼Œä½†æ˜¯å¤šä¸ªè¿”å›å€¼é»˜è®¤æ˜¯ä»¥å…ƒç»„çš„æ–¹å¼è¿”å›ï¼Œç›¸å½“äºè¿”å›äº†ä¸€ä¸ªå…ƒç»„</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">my_fun3</span><span class="params">(arg1, arg2)</span>:</span></span><br><span class="line"><span class="meta">... </span>    x = arg1 + <span class="number">59</span></span><br><span class="line"><span class="meta">... </span>    y = arg2 + <span class="number">59</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">return</span> x,y</span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r = my_fun3(<span class="number">12</span>,<span class="number">78</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>type(r)</span><br><span class="line">&lt;type <span class="string">'tuple'</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> r</span><br><span class="line">(<span class="number">71</span>, <span class="number">137</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r, t = my_fun3(<span class="number">56</span>, <span class="number">89</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> r,t</span><br><span class="line"><span class="number">115</span> <span class="number">148</span></span><br></pre></td></tr></table></figure>

<h2 id="ç©ºå‡½æ•°"><a href="#ç©ºå‡½æ•°" class="headerlink" title="ç©ºå‡½æ•°"></a>ç©ºå‡½æ•°</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_fun2</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<h1 id="è°ƒç”¨å‡½æ•°"><a href="#è°ƒç”¨å‡½æ•°" class="headerlink" title="è°ƒç”¨å‡½æ•°"></a>è°ƒç”¨å‡½æ•°</h1><p><code>function_name()</code>æ˜¯è°ƒç”¨å‡½æ•°çš„åŸºæœ¬è¯­æ³•</p>
<ul>
<li>function_name æ˜¯å‡½æ•°çš„åå­—ï¼ˆå¯ä»¥ä½¿è‡ªå®šä¹‰å‡½æ•°ï¼Œå¯ä»¥ä½¿å†…ç½®å‡½æ•°ï¼Œå¯ä»¥ä½¿ç¬¬ä¸‰æ–¹æ¨¡å—ä¸­çš„å‡½æ•°ï¼‰</li>
<li>() æ‹¬å·é‡Œæ”¾çš„æ˜¯è¯¥å‡½æ•°çš„å‚æ•°ï¼Œå¦‚æœæ²¡æœ‰å‚æ•°ï¼Œå¯ä»¥ä¸ºç©º</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">my_fun4</span><span class="params">()</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">print</span> <span class="string">"hello"</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">print</span> <span class="string">"world"</span></span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>my_fun4()</span><br><span class="line">hello</span><br><span class="line">world</span><br><span class="line"><span class="comment"># my_fun4å‡½æ•°é‡Œé¢åªæœ‰ä¸¤è¡Œæ‰“å°è¯­å¥ï¼Œæ²¡æœ‰å®šä¹‰è¿”å›å€¼ï¼Œæ‰€ä»¥è¿”å›å€¼é»˜è®¤ä¸ºç©ºï¼ˆNoneï¼‰</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = my_fun4()</span><br><span class="line">hello</span><br><span class="line">world</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> s</span><br><span class="line"><span class="literal">None</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>type(s)</span><br><span class="line">&lt;type <span class="string">'NoneType'</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">my_fun5</span><span class="params">()</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">return</span> <span class="string">"hello world"</span></span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="comment"># my_fun5å‡½æ•°é‡Œé¢å®šä¹‰äº†è¿”å›å€¼</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ss = my_fun5()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> ss</span><br><span class="line">hello world</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>type(ss)</span><br><span class="line">&lt;type <span class="string">'str'</span>&gt;</span><br></pre></td></tr></table></figure>

<h1 id="å‡½æ•°çš„å‚æ•°"><a href="#å‡½æ•°çš„å‚æ•°" class="headerlink" title="å‡½æ•°çš„å‚æ•°"></a>å‡½æ•°çš„å‚æ•°</h1><h2 id="é»˜è®¤å‚æ•°"><a href="#é»˜è®¤å‚æ•°" class="headerlink" title="é»˜è®¤å‚æ•°"></a>é»˜è®¤å‚æ•°</h2><p>æ‹¿ä¸€ä¸ªç®€å•çš„å¹‚è¿ç®—ä¸¾ä¾‹<br><code>n=2</code>å³ä¸ºé»˜è®¤å‚æ•°ï¼Œåœ¨è°ƒç”¨è¯¥å‡½æ•°æ—¶ï¼Œå¦‚æœåªæŒ‡å®šäº†ä¸€ä¸ªå‚æ•°ï¼Œé‚£å˜é‡<code>n</code>å°†é»˜è®¤ç­‰äº<code>2</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">my_fun6</span><span class="params">(x, n=<span class="number">2</span>)</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">return</span> x ** n</span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>my_fun6(<span class="number">3</span>)</span><br><span class="line"><span class="number">9</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>my_fun6(<span class="number">3</span>,<span class="number">3</span>)</span><br><span class="line"><span class="number">27</span></span><br></pre></td></tr></table></figure>

<p>ä¹Ÿå¯ä»¥å°†ä¸¤ä¸ªå‚æ•°éƒ½è®¾ç½®æœ‰é»˜è®¤å˜é‡ï¼Œè¿™æ ·è¯¥å‡½æ•°å³ä½¿ä¸ä¼ å‚ï¼Œä¹Ÿèƒ½æ­£å¸¸å·¥ä½œ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>my_fun6()</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">TypeError: my_fun6() takes at least <span class="number">1</span> argument (<span class="number">0</span> given)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">my_fun7</span><span class="params">(x=<span class="number">3</span>,n=<span class="number">2</span>)</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">return</span> x ** n</span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>my_fun7()</span><br><span class="line"><span class="number">9</span></span><br></pre></td></tr></table></figure>

<h3 id="ä½¿ç”¨é»˜è®¤å‚æ•°çš„æ³¨æ„äº‹é¡¹"><a href="#ä½¿ç”¨é»˜è®¤å‚æ•°çš„æ³¨æ„äº‹é¡¹" class="headerlink" title="ä½¿ç”¨é»˜è®¤å‚æ•°çš„æ³¨æ„äº‹é¡¹"></a>ä½¿ç”¨é»˜è®¤å‚æ•°çš„æ³¨æ„äº‹é¡¹</h3><ul>
<li><p>å¿…é€‰å‚æ•°åœ¨å‰ï¼Œé»˜è®¤å‚æ•°åœ¨åï¼Œå¦åˆ™Pythonè§£é‡Šå™¨ä¼šæŠ¥é”™</p>
</li>
<li><p>å½“å‡½æ•°éœ€è¦å¤šä¸ªå‚æ•°çš„æ—¶å€™ï¼Œå°†å˜åŒ–è¾ƒå¤§çš„å‚æ•°æ”¾åœ¨å‰é¢ï¼Œå˜åŒ–å°çš„æ”¾åœ¨åé¢ä½œä¸ºé»˜è®¤å‚æ•°</p>
</li>
<li><p>é»˜è®¤å‚æ•°å¿…é¡»æŒ‡å‘ä¸å¯å˜å¯¹è±¡ï¼ˆeg: int, string, floatï¼‰</p>
</li>
</ul>
<h2 id="å¯å˜å‚æ•°"><a href="#å¯å˜å‚æ•°" class="headerlink" title="å¯å˜å‚æ•°"></a>å¯å˜å‚æ•°</h2><p>å¯ä»¥æŠ˜è¡·åœ°ä½¿ç”¨åˆ—è¡¨æˆ–å…ƒç»„å®ç°å¯å˜é•¿å‚æ•°<br><em>(ä»¥ä¸‹äº¤äº’ç»ˆç«¯ä½¿ç”¨äº†ipython)</em></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">1</span>]: <span class="function"><span class="keyword">def</span> <span class="title">cal</span><span class="params">(numbers)</span>:</span></span><br><span class="line">   ...:     sum = <span class="number">0</span></span><br><span class="line">   ...:     <span class="keyword">for</span> i <span class="keyword">in</span> numbers:</span><br><span class="line">   ...:         sum = sum + i</span><br><span class="line">   ...:     <span class="keyword">return</span> sum</span><br><span class="line"></span><br><span class="line">In [<span class="number">2</span>]: cal([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>])</span><br><span class="line">Out[<span class="number">2</span>]: <span class="number">6</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">3</span>]: cal((<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>))</span><br><span class="line">Out[<span class="number">3</span>]: <span class="number">6</span></span><br></pre></td></tr></table></figure>

<p>å¯å˜å‚æ•°çš„å…³é”®å­—ä¸º<code>*</code>æ˜Ÿå·ã€‚åœ¨è®¾ç½®å‡½æ•°çš„æ¥æ”¶å‚æ•°æ—¶ï¼Œå‰é¢åŠ ä¸Šä¸€ä¸ªæ˜Ÿå·ï¼Œåˆ™å‡½æ•°å†…éƒ¨æ¥æ”¶åˆ°çš„æ‰€æœ‰å‚æ•°ä¼šè‡ªåŠ¨è½¬åŒ–ä¸ºä¸€ä¸ªå…ƒç»„</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">5</span>]: <span class="function"><span class="keyword">def</span> <span class="title">cal</span><span class="params">(*numbers)</span>:</span></span><br><span class="line">   ...:     sum = <span class="number">0</span></span><br><span class="line">   ...:     <span class="keyword">for</span> i <span class="keyword">in</span> numbers:</span><br><span class="line">   ...:         sum = sum + i</span><br><span class="line">   ...:     <span class="keyword">return</span> sum</span><br><span class="line">   ...: </span><br><span class="line"></span><br><span class="line">In [<span class="number">6</span>]: cal(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)</span><br><span class="line">Out[<span class="number">6</span>]: <span class="number">6</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">7</span>]: cal()</span><br><span class="line">Out[<span class="number">7</span>]: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">8</span>]: cal(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>)</span><br><span class="line">Out[<span class="number">8</span>]: <span class="number">21</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">9</span>]: <span class="function"><span class="keyword">def</span> <span class="title">cal</span><span class="params">(*numbers)</span>:</span></span><br><span class="line">   ...:     <span class="keyword">return</span> type(numbers)</span><br><span class="line">   ...: </span><br><span class="line"></span><br><span class="line">In [<span class="number">10</span>]: cal()</span><br><span class="line">Out[<span class="number">10</span>]: tuple</span><br></pre></td></tr></table></figure>

<h2 id="å…³é”®å­—å‚æ•°"><a href="#å…³é”®å­—å‚æ•°" class="headerlink" title="å…³é”®å­—å‚æ•°"></a>å…³é”®å­—å‚æ•°</h2><p>å¯å˜é•¿å‚æ•°ä¼ å…¥åˆ°å‡½æ•°å†…éƒ¨ä¼šè‡ªåŠ¨è½¬æ¢æˆä¸€ä¸ª<code>å…ƒç»„</code>ï¼›è€Œå…³é”®å­—å‚æ•°ä¼ å…¥åˆ°å‡½æ•°å†…éƒ¨ä¼šè‡ªåŠ¨è½¬æ¢æˆä¸€ä¸ª<code>å­—å…¸</code><br>å…³é”®å­—å‚æ•°çš„å…³é”®å­—æ˜¯<code>**</code>ä¸¤ä¸ªæ˜Ÿå·</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">12</span>]: <span class="function"><span class="keyword">def</span> <span class="title">person</span><span class="params">(name, age, **otherkeyword)</span>:</span></span><br><span class="line">   ....:     <span class="keyword">print</span> <span class="string">'name: '</span>, name, <span class="string">'\n'</span>, <span class="string">'age: '</span>, age, <span class="string">'\n'</span>, <span class="string">'otherInfo: '</span>, otherkeyword</span><br><span class="line">   ....:    </span><br><span class="line"> </span><br><span class="line">In [<span class="number">13</span>]: person(<span class="string">'ps'</span>,<span class="number">24</span>)</span><br><span class="line">name:  ps</span><br><span class="line">age:  <span class="number">24</span></span><br><span class="line">otherInfo:  &#123;&#125;</span><br><span class="line"> </span><br><span class="line">In [<span class="number">14</span>]: person(<span class="string">'ps'</span>,<span class="number">24</span>,city=<span class="string">'BJ'</span>)</span><br><span class="line">name:  ps</span><br><span class="line">age:  <span class="number">24</span></span><br><span class="line">otherInfo:  &#123;<span class="string">'city'</span>: <span class="string">'BJ'</span>&#125;</span><br><span class="line"> </span><br><span class="line">In [<span class="number">15</span>]: person(<span class="string">'ps'</span>,<span class="number">24</span>,city=<span class="string">'BJ'</span>,job=<span class="string">'Engineer'</span>)</span><br><span class="line">name:  ps</span><br><span class="line">age:  <span class="number">24</span></span><br><span class="line">otherInfo:  &#123;<span class="string">'city'</span>: <span class="string">'BJ'</span>, <span class="string">'job'</span>: <span class="string">'Engineer'</span>&#125;</span><br><span class="line"> </span><br><span class="line">In [<span class="number">16</span>]: dict_kw = &#123;<span class="string">'city'</span>: <span class="string">'BJ'</span>, <span class="string">'job'</span>: <span class="string">'Engineer'</span>&#125;</span><br><span class="line"> </span><br><span class="line">In [<span class="number">17</span>]: dict_kw</span><br><span class="line">Out[<span class="number">17</span>]: &#123;<span class="string">'city'</span>: <span class="string">'BJ'</span>, <span class="string">'job'</span>: <span class="string">'Engineer'</span>&#125;</span><br><span class="line"> </span><br><span class="line">In [<span class="number">18</span>]: person(<span class="string">'ps'</span>,<span class="number">24</span>,**dict_kw)</span><br><span class="line">name:  ps</span><br><span class="line">age:  <span class="number">24</span></span><br><span class="line">otherInfo:  &#123;<span class="string">'city'</span>: <span class="string">'BJ'</span>, <span class="string">'job'</span>: <span class="string">'Engineer'</span>&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å‚æ•°ç»„åˆ"><a href="#å‚æ•°ç»„åˆ" class="headerlink" title="å‚æ•°ç»„åˆ"></a>å‚æ•°ç»„åˆ</h2><p>ä¸Šé¢æåˆ°äº†å››ç§å‚æ•°ï¼ˆå¿…é€‰å‚æ•°ã€é»˜è®¤å‚æ•°ã€å¯å˜å‚æ•°ã€å…³é”®å­—å‚æ•°ï¼‰ï¼Œè¿™å››ç§å‚æ•°å¯ä»¥ä¸€èµ·ä½¿ç”¨ã€‚<br>å‚æ•°å®šä¹‰çš„é¡ºåºå¿…é¡»æ˜¯ï¼šå¿…é¡»å‚æ•°ã€é»˜è®¤å‚æ•°ã€å¯å˜å‚æ•°ã€å…³é”®å­—å‚æ•°</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">21</span>]: <span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(a, b, c=<span class="number">0</span>, *args, **kw)</span>:</span></span><br><span class="line">   ....:     <span class="keyword">print</span> <span class="string">'a:'</span>, a, <span class="string">'\n'</span>, <span class="string">'b:'</span>, b, <span class="string">'\n'</span>, <span class="string">'c:'</span>, c, <span class="string">'\n'</span>, <span class="string">'tuple_args:'</span>, args, <span class="string">'\n'</span>, <span class="string">'dict_kw:'</span>, kw</span><br><span class="line">   ....:     </span><br><span class="line"></span><br><span class="line">In [<span class="number">22</span>]: func(<span class="number">1</span>,<span class="number">2</span>)</span><br><span class="line">a: <span class="number">1</span> </span><br><span class="line">b: <span class="number">2</span> </span><br><span class="line">c: <span class="number">0</span> </span><br><span class="line">tuple_args: () </span><br><span class="line">dict_kw: &#123;&#125;</span><br><span class="line"></span><br><span class="line">In [<span class="number">23</span>]: func(<span class="number">1</span>,<span class="number">2</span>,c=<span class="number">3</span>)</span><br><span class="line">a: <span class="number">1</span> </span><br><span class="line">b: <span class="number">2</span> </span><br><span class="line">c: <span class="number">3</span> </span><br><span class="line">tuple_args: () </span><br><span class="line">dict_kw: &#123;&#125;</span><br><span class="line"></span><br><span class="line">In [<span class="number">24</span>]: func(<span class="number">1</span>,<span class="number">2</span>,c=<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>)</span><br><span class="line">  File <span class="string">"&lt;ipython-input-24-9272b7482bc9&gt;"</span>, line <span class="number">1</span></span><br><span class="line">SyntaxError: non-keyword arg after keyword arg</span><br><span class="line"></span><br><span class="line">In [<span class="number">25</span>]: func(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>)</span><br><span class="line">a: <span class="number">1</span> </span><br><span class="line">b: <span class="number">2</span> </span><br><span class="line">c: <span class="number">3</span> </span><br><span class="line">tuple_args: (<span class="number">4</span>, <span class="number">5</span>) </span><br><span class="line">dict_kw: &#123;&#125;</span><br><span class="line"></span><br><span class="line">In [<span class="number">26</span>]: func(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,x=<span class="number">59</span>)</span><br><span class="line">a: <span class="number">1</span> </span><br><span class="line">b: <span class="number">2</span> </span><br><span class="line">c: <span class="number">3</span> </span><br><span class="line">tuple_args: (<span class="number">4</span>, <span class="number">5</span>) </span><br><span class="line">dict_kw: &#123;<span class="string">'x'</span>: <span class="number">59</span>&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h2><ul>
<li><p>*argsæ˜¯å¯å˜å‚æ•°ï¼Œæ¥æ”¶ä¸€ä¸ªtuple</p>
</li>
<li><p>**kwæ˜¯å…³é”®å­—å‚æ•°ï¼Œæ¥æ”¶ä¸€ä¸ªdict</p>
</li>
<li><p>åœ¨å¿…é€‰å‚æ•°ï¼Œé»˜è®¤å‚æ•°ï¼Œå¯å˜é•¿å‚æ•°å’Œå…³é”®å­—å‚æ•°æ··åˆä½¿ç”¨æ—¶ï¼Œé»˜è®¤å‚æ•°åœ¨å¤åˆ¶æ—¶ä¸è¦æŒ‡å®šå‚æ•°åï¼Œå¦‚ä¸Šä¾‹çš„<code>c=3</code> å¦åˆ™ä¼šæŠ¥é”™</p>
</li>
</ul>
<h1 id="å¸¸ç”¨å†…ç½®å‡½æ•°"><a href="#å¸¸ç”¨å†…ç½®å‡½æ•°" class="headerlink" title="å¸¸ç”¨å†…ç½®å‡½æ•°"></a>å¸¸ç”¨å†…ç½®å‡½æ•°</h1><h2 id="isinstance"><a href="#isinstance" class="headerlink" title="isinstance"></a>isinstance</h2><p><strong>isinstanceå‡½æ•°åˆ¤æ–­å¯¹è±¡ç±»å‹</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">obj1</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">pass</span></span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>o = obj1()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t = (<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d = &#123;<span class="string">'a'</span>:<span class="number">1</span>,<span class="string">'b'</span>:<span class="number">2</span>,<span class="string">'c'</span>:<span class="number">3</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">'string'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>i = <span class="number">6</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f = <span class="number">5.9</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> isinstance(o, obj1)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> isinstance(t, tuple)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> isinstance(l, list)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> isinstance(d, dict)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> isinstance(s, str)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> isinstance(i, int)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> isinstance(f, float)</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>Built-in-Functions</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonä¸‹è§£æYAMLæ–‡ä»¶</title>
    <url>/2015/12/07/Python%E4%B8%8B%E8%A7%A3%E6%9E%90YAML%E6%96%87%E4%BB%B6/</url>
    <content><![CDATA[<blockquote>
<p>Pythonä¸­è§£æYAMLæ–‡ä»¶ä¸»è¦ä½¿ç”¨åˆ°ä¸¤ä¸ªæ–¹æ³•ï¼Œload()å’Œdump()æ–¹æ³•ï¼Œä½¿ç”¨æ–¹å¼ç±»ä¼¼äºPythonçš„pickleã€‚ç†Ÿæ‚‰åœ¨Pythonä¸­è§£æYAMLæ–‡ä»¶ï¼Œå¯¹ä½¿ç”¨Pythonåšsaltstackè‡ªå®šä¹‰æ’ä»¶å¼€å‘æ—¶ä¼šæœ‰å¾ˆå¤§çš„å¸®åŠ©</p>
</blockquote>
<h1 id="load"><a href="#load" class="headerlink" title="load"></a>load</h1><p><strong>æµ‹è¯•</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@PolarSnow saltstack]<span class="comment"># cat eg.yaml </span></span><br><span class="line">name: Tom Smith</span><br><span class="line">age: 37</span><br><span class="line">spouse:</span><br><span class="line">  name: Jane Smith</span><br><span class="line">  age: 25</span><br><span class="line">children:</span><br><span class="line">  - name: Jimmy Smith</span><br><span class="line">    age: 15</span><br><span class="line">  - name1: Jenny Smith</span><br><span class="line">    age1: 12</span><br><span class="line"></span><br><span class="line">[root@PolarSnow saltstack]<span class="comment"># cat py_yaml.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#coding=utf-8</span></span><br><span class="line">import yaml</span><br><span class="line"></span><br><span class="line">with open(<span class="string">'eg.yaml'</span>, <span class="string">'r'</span>) as loadfile:</span><br><span class="line">    <span class="built_in">print</span> yaml.load(loadfile)</span><br><span class="line"></span><br><span class="line">[root@PolarSnow saltstack]<span class="comment"># python py_yaml.py</span></span><br><span class="line">&#123;<span class="string">'age'</span>: 37, <span class="string">'spouse'</span>: &#123;<span class="string">'age'</span>: 25, <span class="string">'name'</span>: <span class="string">'Jane Smith'</span>&#125;, <span class="string">'name'</span>: <span class="string">'Tom Smith'</span>, <span class="string">'children'</span>: [&#123;<span class="string">'age'</span>: 15, <span class="string">'name'</span>: <span class="string">'Jimmy Smith'</span>&#125;, &#123;<span class="string">'age1'</span>: 12, <span class="string">'name1'</span>: <span class="string">'Jenny Smith'</span>&#125;]&#125;</span><br></pre></td></tr></table></figure>

<p><strong>å…³é”®ä»£ç </strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> yaml</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'eg.yaml'</span>, <span class="string">'r'</span>) <span class="keyword">as</span> loadfile:</span><br><span class="line">    <span class="keyword">print</span> yaml.load(loadfile)</span><br></pre></td></tr></table></figure>

<h1 id="dump"><a href="#dump" class="headerlink" title="dump"></a>dump</h1><p><strong>æµ‹è¯•</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@PolarSnow saltstack]<span class="comment"># cat eg.yaml </span></span><br><span class="line">name: Tom Smith</span><br><span class="line">age: 37</span><br><span class="line">spouse:</span><br><span class="line">  name: Jane Smith</span><br><span class="line">  age: 25</span><br><span class="line">children:</span><br><span class="line">  - name: Jimmy Smith</span><br><span class="line">    age: 15</span><br><span class="line">  - name1: Jenny Smith</span><br><span class="line">    age1: 12</span><br><span class="line"></span><br><span class="line">[root@PolarSnow saltstack]<span class="comment"># cat py_yaml.py </span></span><br><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#coding=utf-8</span></span><br><span class="line">import yaml</span><br><span class="line">with open(<span class="string">'eg.yaml'</span>, <span class="string">'r'</span>) as loadfile:</span><br><span class="line">    y = yaml.load(loadfile)</span><br><span class="line">    <span class="built_in">print</span> y</span><br><span class="line">with open(<span class="string">'eg1.yaml'</span>,<span class="string">'w'</span>) as dumpfile:</span><br><span class="line">    dumpfile.write(yaml.dump(y))</span><br><span class="line">    <span class="built_in">print</span> yaml.dump(y)</span><br><span class="line"></span><br><span class="line">[root@PolarSnow saltstack]<span class="comment"># python py_yaml.py </span></span><br><span class="line">&#123;<span class="string">'age'</span>: 37, <span class="string">'spouse'</span>: &#123;<span class="string">'age'</span>: 25, <span class="string">'name'</span>: <span class="string">'Jane Smith'</span>&#125;, <span class="string">'name'</span>: <span class="string">'Tom Smith'</span>, <span class="string">'children'</span>: [&#123;<span class="string">'age'</span>: 15, <span class="string">'name'</span>: <span class="string">'Jimmy Smith'</span>&#125;, &#123;<span class="string">'age1'</span>: 12, <span class="string">'name1'</span>: <span class="string">'Jenny Smith'</span>&#125;]&#125;</span><br><span class="line">age: 37</span><br><span class="line">children:</span><br><span class="line">- &#123;age: 15, name: Jimmy Smith&#125;</span><br><span class="line">- &#123;age1: 12, name1: Jenny Smith&#125;</span><br><span class="line">name: Tom Smith</span><br><span class="line">spouse: &#123;age: 25, name: Jane Smith&#125;</span><br><span class="line"></span><br><span class="line">[root@PolarSnow saltstack]<span class="comment"># cat eg1.yaml </span></span><br><span class="line">age: 37</span><br><span class="line">children:</span><br><span class="line">- &#123;age: 15, name: Jimmy Smith&#125;</span><br><span class="line">- &#123;age1: 12, name1: Jenny Smith&#125;</span><br><span class="line">name: Tom Smith</span><br><span class="line">spouse: &#123;age: 25, name: Jane Smith&#125;</span><br></pre></td></tr></table></figure>

<p><strong>å…³é”®ä»£ç </strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> yaml</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ‰“å¼€ä¸€ä¸ªyamlæ–‡ä»¶å°†å…¶è§£æï¼Œå†å°†è§£æåçš„ç»“æ„å†è½¬æˆyamlå†™å…¥åˆ°æ–°çš„æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'eg.yaml'</span>, <span class="string">'r'</span>) <span class="keyword">as</span> loadfile:</span><br><span class="line">    y = yaml.load(loadfile)</span><br><span class="line">    <span class="keyword">print</span> y</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'eg1.yaml'</span>,<span class="string">'w'</span>) <span class="keyword">as</span> dumpfile:</span><br><span class="line">    dumpfile.write(yaml.dump(y))</span><br><span class="line">    <span class="keyword">print</span> yaml.dump(y)</span><br></pre></td></tr></table></figure>


]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>saltstack</tag>
        <tag>YAML</tag>
      </tags>
  </entry>
  <entry>
    <title>PythonåŸºç¡€çŸ¥è¯†ç¬”è®°</title>
    <url>/2015/12/04/Python%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<h1 id="PythonåŸºç¡€çŸ¥è¯†ç¬”è®°"><a href="#PythonåŸºç¡€çŸ¥è¯†ç¬”è®°" class="headerlink" title="PythonåŸºç¡€çŸ¥è¯†ç¬”è®°"></a>PythonåŸºç¡€çŸ¥è¯†ç¬”è®°</h1><hr>
<h1 id="è¿è¡Œä¸€ä¸ªè„šæœ¬åå†è¿›å…¥äº¤äº’ç»ˆç«¯-python-i"><a href="#è¿è¡Œä¸€ä¸ªè„šæœ¬åå†è¿›å…¥äº¤äº’ç»ˆç«¯-python-i" class="headerlink" title="è¿è¡Œä¸€ä¸ªè„šæœ¬åå†è¿›å…¥äº¤äº’ç»ˆç«¯ python -i"></a>è¿è¡Œä¸€ä¸ªè„šæœ¬åå†è¿›å…¥äº¤äº’ç»ˆç«¯ python -i</h1><p>ä½¿ç”¨<strong>-i</strong>å‚æ•°</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">$ echo <span class="string">"#!/usr/bin/env python</span></span><br><span class="line"><span class="string">import sys"</span> &gt; test.py</span><br><span class="line"></span><br><span class="line">$ python -i test.py</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sys.path</span><br></pre></td></tr></table></figure>

<h1 id="printçš„å†…å®¹ç¦æ­¢è½¬ä¹‰"><a href="#printçš„å†…å®¹ç¦æ­¢è½¬ä¹‰" class="headerlink" title="printçš„å†…å®¹ç¦æ­¢è½¬ä¹‰ \"></a>printçš„å†…å®¹ç¦æ­¢è½¬ä¹‰ \</h1><p>ä½¿ç”¨ <code>r&#39; &#39;</code>ä½¿å•å¼•å·ä¸­çš„æ‰€æœ‰å­—ç¬¦ç¦æ­¢è½¬ä¹‰</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> <span class="string">'x\ny\tz'</span></span><br><span class="line">x</span><br><span class="line">y	z</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> <span class="string">r'x\ny\tz'</span></span><br><span class="line">x\ny\tz</span><br></pre></td></tr></table></figure>

<h1 id="æ‰“å°å¤šè¡Œ-â€˜â€™â€™â€¦â€™â€™â€™"><a href="#æ‰“å°å¤šè¡Œ-â€˜â€™â€™â€¦â€™â€™â€™" class="headerlink" title="æ‰“å°å¤šè¡Œ â€˜â€™â€™â€¦â€™â€™â€™"></a>æ‰“å°å¤šè¡Œ â€˜â€™â€™â€¦â€™â€™â€™</h1><p>ä½¿ç”¨<code>\n</code>è¾“å…¥å¤šè¡Œæ—¶å¯èƒ½ä¸å¤ªå¥½é˜…è¯»ï¼Œå¯ä»¥é€šè¿‡<code>&#39;&#39;&#39; &#39;&#39;&#39;</code>ä¸‰å¼•å·çš„æ–¹å¼æ¥è¾“å‡ºå¤šè¡Œ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> <span class="string">'''line one</span></span><br><span class="line"><span class="string"><span class="meta">... </span>line two</span></span><br><span class="line"><span class="string"><span class="meta">... </span>line three</span></span><br><span class="line"><span class="string"><span class="meta">... </span>'''</span></span><br><span class="line">line one</span><br><span class="line">line two</span><br><span class="line">line three</span><br></pre></td></tr></table></figure>

<h1 id="å¸¸é‡-PI"><a href="#å¸¸é‡-PI" class="headerlink" title="å¸¸é‡ PI"></a>å¸¸é‡ PI</h1><p>åœ¨Pythonä¸­çš„å¸¸é‡ä¹Ÿæ˜¯ä¸€ä¸ªå˜é‡ï¼Œåªä¸è¿‡ä¸ºäº†æ˜¾ç¤ºè¿™æ˜¯ä¸ªå¸¸é‡ï¼Œçº¦å®šä¿—æˆç”¨å¤§å†™è¡¨ç¤ºå¸¸é‡<br>åœ¨Pythonä¸­æ²¡æœ‰ä»»ä½•æœºåˆ¶ä¿è¯å¤§å†™çš„å˜é‡ä¸ä¼šè¢«æ›´æ”¹ï¼</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>PI = <span class="number">3.1415926</span></span><br></pre></td></tr></table></figure>

<h1 id="å­—ç¬¦ä¸²ä¸æ•°å­—é—´çš„è½¬æ¢ï¼ˆASCIIï¼‰"><a href="#å­—ç¬¦ä¸²ä¸æ•°å­—é—´çš„è½¬æ¢ï¼ˆASCIIï¼‰" class="headerlink" title="å­—ç¬¦ä¸²ä¸æ•°å­—é—´çš„è½¬æ¢ï¼ˆASCIIï¼‰"></a>å­—ç¬¦ä¸²ä¸æ•°å­—é—´çš„è½¬æ¢ï¼ˆASCIIï¼‰</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>ord(<span class="string">'L'</span>)</span><br><span class="line"><span class="number">76</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>chr(<span class="number">76</span>)</span><br><span class="line"><span class="string">'L'</span></span><br></pre></td></tr></table></figure>

<h1 id="åœ¨Pythonä¸­ä½¿ç”¨Unicodeç¼–ç "><a href="#åœ¨Pythonä¸­ä½¿ç”¨Unicodeç¼–ç " class="headerlink" title="åœ¨Pythonä¸­ä½¿ç”¨Unicodeç¼–ç "></a>åœ¨Pythonä¸­ä½¿ç”¨Unicodeç¼–ç </h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">'ä¸­æ–‡'</span></span><br><span class="line"><span class="string">'\xe4\xb8\xad\xe6\x96\x87'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">u'ä¸­æ–‡'</span></span><br><span class="line"><span class="string">u'\u4e2d\u6587'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> <span class="string">u'ä¸­æ–‡'</span></span><br><span class="line">ä¸­æ–‡</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> <span class="string">u'\u4e2d\u6587'</span></span><br><span class="line">ä¸­æ–‡</span><br></pre></td></tr></table></figure>

<h1 id="Unicodeä¸ç¦æ­¢è½¬ä¹‰è¿ç”¨-print-urâ€™â€¦â€™"><a href="#Unicodeä¸ç¦æ­¢è½¬ä¹‰è¿ç”¨-print-urâ€™â€¦â€™" class="headerlink" title="Unicodeä¸ç¦æ­¢è½¬ä¹‰è¿ç”¨ print urâ€™â€¦â€™"></a>Unicodeä¸ç¦æ­¢è½¬ä¹‰è¿ç”¨ print urâ€™â€¦â€™</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> <span class="string">u'ä¸­\tæ–‡'</span></span><br><span class="line">ä¸­    æ–‡</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> <span class="string">ur'ä¸­\tæ–‡'</span></span><br><span class="line">ä¸­\tæ–‡</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">ur'ä¸­\tæ–‡'</span></span><br><span class="line"><span class="string">u'\u4e2d\\t\u6587'</span></span><br></pre></td></tr></table></figure>

<h1 id="Unicodeä¸utf-8å­—ç¬¦ç¼–ç é—´çš„è½¬æ¢"><a href="#Unicodeä¸utf-8å­—ç¬¦ç¼–ç é—´çš„è½¬æ¢" class="headerlink" title="Unicodeä¸utf-8å­—ç¬¦ç¼–ç é—´çš„è½¬æ¢"></a>Unicodeä¸utf-8å­—ç¬¦ç¼–ç é—´çš„è½¬æ¢</h1><h2 id="Unicode-2-UTF-8"><a href="#Unicode-2-UTF-8" class="headerlink" title="Unicode 2 UTF-8"></a>Unicode 2 UTF-8</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">u'ABC'</span></span><br><span class="line"><span class="string">u'ABC'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">u'ABC'</span>.encode(<span class="string">'utf-8'</span>)</span><br><span class="line"><span class="string">'ABC'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">u'ä¸­æ–‡'</span></span><br><span class="line"><span class="string">u'\u4e2d\u6587'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">u'ä¸­æ–‡'</span>.encode(<span class="string">'utf-8'</span>)</span><br><span class="line"><span class="string">'\xe4\xb8\xad\xe6\x96\x87'</span></span><br></pre></td></tr></table></figure>

<h2 id="UTF-8-2-Unicode"><a href="#UTF-8-2-Unicode" class="headerlink" title="UTF-8 2 Unicode"></a>UTF-8 2 Unicode</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">'\xe4\xb8\xad\xe6\x96\x87'</span>.decode(<span class="string">'utf-8'</span>)</span><br><span class="line"><span class="string">u'\u4e2d\u6587'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> <span class="string">'\xe4\xb8\xad\xe6\x96\x87'</span>.decode(<span class="string">'utf-8'</span>)</span><br><span class="line">ä¸­æ–‡</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> <span class="string">u'\u4e2d\u6587'</span></span><br><span class="line">ä¸­æ–‡</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">'ABC'</span>.decode(<span class="string">'utf-8'</span>)</span><br><span class="line"><span class="string">u'ABC'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> <span class="string">'ABC'</span>.decode(<span class="string">'utf-8'</span>)</span><br><span class="line">ABC</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> <span class="string">u'ABC'</span></span><br><span class="line">ABC</span><br></pre></td></tr></table></figure>

<h1 id="Pythonæ–‡ä»¶ä¸­ä½¿ç”¨ä¸­æ–‡çš„å£°æ˜-print-uâ€™â€¦â€™"><a href="#Pythonæ–‡ä»¶ä¸­ä½¿ç”¨ä¸­æ–‡çš„å£°æ˜-print-uâ€™â€¦â€™" class="headerlink" title="Pythonæ–‡ä»¶ä¸­ä½¿ç”¨ä¸­æ–‡çš„å£°æ˜ print uâ€™â€¦â€™"></a>Pythonæ–‡ä»¶ä¸­ä½¿ç”¨ä¸­æ–‡çš„å£°æ˜ print uâ€™â€¦â€™</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#coding=utf-8</span></span><br><span class="line"><span class="keyword">print</span> <span class="string">u'ä¸­æ–‡'</span></span><br></pre></td></tr></table></figure>

<h1 id="å­—ç¬¦ä¸²æ ¼å¼åŒ–ï¼ˆå ä½ç¬¦ï¼‰"><a href="#å­—ç¬¦ä¸²æ ¼å¼åŒ–ï¼ˆå ä½ç¬¦ï¼‰" class="headerlink" title="å­—ç¬¦ä¸²æ ¼å¼åŒ–ï¼ˆå ä½ç¬¦ï¼‰"></a>å­—ç¬¦ä¸²æ ¼å¼åŒ–ï¼ˆå ä½ç¬¦ï¼‰</h1><p>å¸¸è§çš„å ä½ç¬¦ï¼š</p>
<ul>
<li>%d    æ•´æ•°</li>
<li>%f    æµ®ç‚¹æ•°</li>
<li>%s    å­—ç¬¦ä¸²</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> <span class="string">'Hi %s'</span> % <span class="string">'ps'</span></span><br><span class="line">Hi ps</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> <span class="string">'Hi %s, I have %d questions to ask you'</span> % (<span class="string">'ps'</span>, <span class="number">59</span>)</span><br><span class="line">Hi ps, I have <span class="number">59</span> questions to ask you</span><br></pre></td></tr></table></figure>

<p>å¯¹Unicodeå­—ç¬¦ä¸²è¿›è¡Œå ä½æ—¶ï¼Œå­—ç¬¦ç¼–ç éœ€è¦å‰åä¿æŒä¸€è‡´</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> <span class="string">u'Hi %s, I have %d questions to ask you'</span> % (<span class="string">u'ps'</span>, <span class="number">59</span>)</span><br><span class="line">Hi ps, I have <span class="number">59</span> questions to ask you</span><br></pre></td></tr></table></figure>

<p>å¯¹å ä½ç¬¦è½¬ä¹‰<code>%%</code>â€“&gt;â€™%â€™</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> <span class="string">"update %d%"</span> % <span class="number">59</span></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">ValueError: incomplete format</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> <span class="string">"update %d%%"</span> % <span class="number">59</span></span><br><span class="line">update <span class="number">59</span>%</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="åˆ—è¡¨"><a href="#åˆ—è¡¨" class="headerlink" title="åˆ—è¡¨"></a>åˆ—è¡¨</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>testlist = [<span class="string">'Apple'</span>, <span class="string">'Microsoft'</span>, <span class="string">'Samaung'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>testlist</span><br><span class="line">[<span class="string">'Apple'</span>, <span class="string">'Microsoft'</span>, <span class="string">'Samaung'</span>]</span><br></pre></td></tr></table></figure>

<h2 id="å–å€¼-list-index"><a href="#å–å€¼-list-index" class="headerlink" title="å–å€¼ list[index]"></a>å–å€¼ list[index]</h2><p>åˆ—è¡¨ä¸­æœ€åä¸€ä¸ªå…ƒç´ çš„ä½ç½®æ˜¯<code>len(testlist) - 1</code> or <code>testlist[-1]</code></p>
<p>ä»¥æ­¤ç±»æ¨ï¼Œå€’æ•°ç¬¬äºŒä¸ªå…ƒç´ æ˜¯<code>testlist[-2]</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>testlist</span><br><span class="line">[<span class="string">'Apple'</span>, <span class="string">'Microsoft'</span>, <span class="string">'Samaung'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>len(testlist)</span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>len(testlist) - <span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>testlist[len(testlist) - <span class="number">1</span>]</span><br><span class="line"><span class="string">'Samaung'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>testlist[<span class="number">-1</span>]</span><br><span class="line"><span class="string">'Samaung'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>testlist[<span class="number">-2</span>]</span><br><span class="line"><span class="string">'Microsoft'</span></span><br></pre></td></tr></table></figure>

<h2 id="è¿½åŠ -append-value"><a href="#è¿½åŠ -append-value" class="headerlink" title="è¿½åŠ  append(value)"></a>è¿½åŠ  append(value)</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>testlist</span><br><span class="line">[<span class="string">'Apple'</span>, <span class="string">'Microsoft'</span>, <span class="string">'Samaung'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>testlist.append(<span class="string">'lastvalue'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>testlist</span><br><span class="line">[<span class="string">'Apple'</span>, <span class="string">'Microsoft'</span>, <span class="string">'Samaung'</span>, <span class="string">'lastvalue'</span>]</span><br></pre></td></tr></table></figure>

<h2 id="æ’å…¥-insert-index-value"><a href="#æ’å…¥-insert-index-value" class="headerlink" title="æ’å…¥ insert(index, value)"></a>æ’å…¥ insert(index, value)</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>testlist</span><br><span class="line">[<span class="string">'Apple'</span>, <span class="string">'Microsoft'</span>, <span class="string">'Samaung'</span>, <span class="string">'lastvalue'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>testlist.insert(<span class="number">1</span>, <span class="string">'secondvalue'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>testlist</span><br><span class="line">[<span class="string">'Apple'</span>, <span class="string">'secondvalue'</span>, <span class="string">'Microsoft'</span>, <span class="string">'Samaung'</span>, <span class="string">'lastvalue'</span>]</span><br></pre></td></tr></table></figure>

<h2 id="åˆ é™¤æœ«å°¾åŠæŒ‡å®šä½ç½®çš„å…ƒç´ -pop-index"><a href="#åˆ é™¤æœ«å°¾åŠæŒ‡å®šä½ç½®çš„å…ƒç´ -pop-index" class="headerlink" title="åˆ é™¤æœ«å°¾åŠæŒ‡å®šä½ç½®çš„å…ƒç´  pop(index)"></a>åˆ é™¤æœ«å°¾åŠæŒ‡å®šä½ç½®çš„å…ƒç´  pop(index)</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>testlist</span><br><span class="line">[<span class="string">'Apple'</span>, <span class="string">'secondvalue'</span>, <span class="string">'Microsoft'</span>, <span class="string">'Samaung'</span>, <span class="string">'lastvalue'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>testlist.pop()</span><br><span class="line"><span class="string">'lastvalue'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>testlist</span><br><span class="line">[<span class="string">'Apple'</span>, <span class="string">'secondvalue'</span>, <span class="string">'Microsoft'</span>, <span class="string">'Samaung'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>testlist.pop(<span class="number">1</span>)</span><br><span class="line"><span class="string">'secondvalue'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>testlist</span><br><span class="line">[<span class="string">'Apple'</span>, <span class="string">'Microsoft'</span>, <span class="string">'Samaung'</span>]</span><br></pre></td></tr></table></figure>

<h2 id="æ›¿æ¢å…ƒç´ "><a href="#æ›¿æ¢å…ƒç´ " class="headerlink" title="æ›¿æ¢å…ƒç´ "></a>æ›¿æ¢å…ƒç´ </h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#ç›´æ¥è¦†ç›–</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>testlist</span><br><span class="line">[<span class="string">'Apple'</span>, <span class="string">'Microsoft'</span>, <span class="string">'Samaung'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>testlist[<span class="number">2</span>] = <span class="string">'Google'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>testlist</span><br><span class="line">[<span class="string">'Apple'</span>, <span class="string">'Microsoft'</span>, <span class="string">'Google'</span>]</span><br><span class="line">``</span><br><span class="line"></span><br><span class="line"><span class="comment">## äºŒç»´æ•°ç»„</span></span><br><span class="line"></span><br><span class="line">```python</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>testlist = [[<span class="string">'iPhone'</span>, <span class="string">'iPad'</span>, <span class="string">'iMac'</span>], <span class="string">'Microsoft'</span>, <span class="string">'Google'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>testlist</span><br><span class="line">[[<span class="string">'iPhone'</span>, <span class="string">'iPad'</span>, <span class="string">'iMac'</span>], <span class="string">'Microsoft'</span>, <span class="string">'Google'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>len(testlist)</span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>testlist[<span class="number">0</span>][<span class="number">1</span>]</span><br><span class="line"><span class="string">'iPad'</span></span><br></pre></td></tr></table></figure>

<h1 id="å…ƒç»„"><a href="#å…ƒç»„" class="headerlink" title="å…ƒç»„"></a>å…ƒç»„</h1><h2 id="å•ä¸ªå…ƒç´ çš„å…ƒç»„"><a href="#å•ä¸ªå…ƒç´ çš„å…ƒç»„" class="headerlink" title="å•ä¸ªå…ƒç´ çš„å…ƒç»„"></a>å•ä¸ªå…ƒç´ çš„å…ƒç»„</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>testtuple = (<span class="string">'apple'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>testtuple</span><br><span class="line"><span class="string">'apple'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>type(testtuple)</span><br><span class="line">&lt;type <span class="string">'str'</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>testtuple = (<span class="string">'apple'</span>, )</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>testtuple</span><br><span class="line">(<span class="string">'apple'</span>,)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>type(testtuple)</span><br><span class="line">&lt;type <span class="string">'tuple'</span>&gt;</span><br></pre></td></tr></table></figure>

<h2 id="â€œå¯å˜å…ƒç»„â€"><a href="#â€œå¯å˜å…ƒç»„â€" class="headerlink" title="â€œå¯å˜å…ƒç»„â€"></a>â€œå¯å˜å…ƒç»„â€</h2><p>ä¸€èˆ¬æƒ…å†µä¸‹å…ƒç»„æ˜¯ä¸å¯å˜çš„æ•°æ®ç»“æ„ï¼Œå¦‚æœéœ€è¦å®ç°è®©å…ƒç»„å¯å˜ï¼Œå¯ä»¥åœ¨å…ƒç»„ä¸­åŠ å…¥åˆ—è¡¨æ¥å®ç°</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>testtuple = ([<span class="string">'iPhone'</span>, <span class="string">'iPad'</span>, <span class="string">'iMac'</span>], <span class="string">'Microsoft'</span>, <span class="string">'Google'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>testtuple</span><br><span class="line">([<span class="string">'iPhone'</span>, <span class="string">'iPad'</span>, <span class="string">'iMac'</span>], <span class="string">'Microsoft'</span>, <span class="string">'Google'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>testtuple[<span class="number">0</span>].append(<span class="string">'iPod'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>testtuple</span><br><span class="line">([<span class="string">'iPhone'</span>, <span class="string">'iPad'</span>, <span class="string">'iMac'</span>, <span class="string">'iPod'</span>], <span class="string">'Microsoft'</span>, <span class="string">'Google'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>testtuple[<span class="number">0</span>][<span class="number">2</span>] = <span class="string">'MBP'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>testtuple</span><br><span class="line">([<span class="string">'iPhone'</span>, <span class="string">'iPad'</span>, <span class="string">'MBP'</span>, <span class="string">'iPod'</span>], <span class="string">'Microsoft'</span>, <span class="string">'Google'</span>)</span><br><span class="line"><span class="comment">#å…ƒç»„çš„æŒ‡å‘å¹¶æ²¡æœ‰å˜ï¼Œæ‰€ä»¥è¿™ä¸ªå…ƒç»„å¯ä»¥è®¤ä¸ºä»ç„¶æ²¡æœ‰å˜åŒ–ï¼Œå˜çš„æ˜¯å…ƒç»„ä¸­listçš„å…ƒç´ </span></span><br></pre></td></tr></table></figure>

<h1 id="ifåˆ¤æ–­è¯­å¥"><a href="#ifåˆ¤æ–­è¯­å¥" class="headerlink" title="ifåˆ¤æ–­è¯­å¥"></a>ifåˆ¤æ–­è¯­å¥</h1><h2 id="åŸºç¡€è¯­æ³•"><a href="#åŸºç¡€è¯­æ³•" class="headerlink" title="åŸºç¡€è¯­æ³•"></a>åŸºç¡€è¯­æ³•</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>results = <span class="number">100</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">if</span> results &lt; <span class="number">0</span> <span class="keyword">or</span> results &gt; <span class="number">100</span>:</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">print</span> <span class="string">"OMG!!!"</span></span><br><span class="line"><span class="meta">... </span><span class="keyword">elif</span> <span class="number">0</span> &lt;= results &lt; <span class="number">60</span>:</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">print</span> <span class="string">"Fail!!!"</span></span><br><span class="line"><span class="meta">... </span><span class="keyword">elif</span> <span class="number">60</span> &lt;= results &lt; <span class="number">80</span>:</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">print</span> <span class="string">"OK!!!"</span></span><br><span class="line"><span class="meta">... </span><span class="keyword">elif</span> results &gt;= <span class="number">80</span> <span class="keyword">and</span> results &lt;=<span class="number">100</span>:</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">print</span> <span class="string">"good!!!"</span></span><br><span class="line"><span class="meta">... </span><span class="keyword">else</span>:</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">print</span> <span class="string">"Impossible!!!"</span></span><br><span class="line"><span class="meta">... </span></span><br><span class="line">good!!!</span><br></pre></td></tr></table></figure>

<h2 id="ç®€å†™"><a href="#ç®€å†™" class="headerlink" title="ç®€å†™"></a>ç®€å†™</h2><p>åªè¦<code>x</code>æ˜¯éé›¶æ•°å€¼ã€éç©ºå­—ç¬¦ä¸²ã€éç©ºlistç­‰ï¼Œå°±åˆ¤æ–­ä¸º<code>True</code>ï¼Œå¦åˆ™ä¸º<code>False</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>x = <span class="string">''</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>x</span><br><span class="line"><span class="string">''</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">if</span> x:</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">print</span> <span class="string">'not null'</span></span><br><span class="line"><span class="meta">... </span><span class="keyword">else</span>:</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">print</span> <span class="string">'null'</span></span><br><span class="line"><span class="meta">... </span></span><br><span class="line">null</span><br></pre></td></tr></table></figure>

<h1 id="å¾ªç¯"><a href="#å¾ªç¯" class="headerlink" title="å¾ªç¯"></a>å¾ªç¯</h1><h2 id="forâ€¦inâ€¦"><a href="#forâ€¦inâ€¦" class="headerlink" title="forâ€¦inâ€¦"></a>forâ€¦inâ€¦</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>testtuple = ([<span class="string">'iPhone'</span>, <span class="string">'iPad'</span>, <span class="string">'iMac'</span>], <span class="string">'Microsoft'</span>, <span class="string">'Google'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> t <span class="keyword">in</span> testtuple:</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">print</span> t</span><br><span class="line"><span class="meta">... </span></span><br><span class="line">[<span class="string">'iPhone'</span>, <span class="string">'iPad'</span>, <span class="string">'iMac'</span>]</span><br><span class="line">Microsoft</span><br><span class="line">Google</span><br></pre></td></tr></table></figure>

<h2 id="while"><a href="#while" class="headerlink" title="while"></a>while</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>start = <span class="number">0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>end = <span class="number">9</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">print</span> start</span><br><span class="line"><span class="meta">... </span>    start = start + <span class="number">1</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">if</span> start &gt; end:</span><br><span class="line"><span class="meta">... </span>        <span class="keyword">break</span></span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="number">6</span></span><br><span class="line"><span class="number">7</span></span><br><span class="line"><span class="number">8</span></span><br><span class="line"><span class="number">9</span></span><br></pre></td></tr></table></figure>

<h1 id="raw-input"><a href="#raw-input" class="headerlink" title="raw_input"></a>raw_input</h1><p><code>num = raw_input(&#39;please input a num:&#39;)</code></p>
<h1 id="å­—å…¸"><a href="#å­—å…¸" class="headerlink" title="å­—å…¸"></a>å­—å…¸</h1><h2 id="åŸºç¡€è¯­æ³•-1"><a href="#åŸºç¡€è¯­æ³•-1" class="headerlink" title="åŸºç¡€è¯­æ³•"></a>åŸºç¡€è¯­æ³•</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>p = &#123;<span class="string">'apple'</span>:<span class="string">'pages'</span>, <span class="string">'microsoft'</span>:<span class="string">'word'</span>, <span class="string">'google'</span>:<span class="string">'docs'</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p[<span class="string">'apple'</span>]</span><br><span class="line"><span class="string">'pages'</span></span><br></pre></td></tr></table></figure>

<h2 id="æ£€æŸ¥å…ƒç´ æ˜¯å¦åŒ…å«åœ¨å­—å…¸ä¸­"><a href="#æ£€æŸ¥å…ƒç´ æ˜¯å¦åŒ…å«åœ¨å­—å…¸ä¸­" class="headerlink" title="æ£€æŸ¥å…ƒç´ æ˜¯å¦åŒ…å«åœ¨å­—å…¸ä¸­"></a>æ£€æŸ¥å…ƒç´ æ˜¯å¦åŒ…å«åœ¨å­—å…¸ä¸­</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; p &#x3D; &#123;&#39;apple&#39;:&#39;pages&#39;, &#39;microsoft&#39;:&#39;word&#39;, &#39;google&#39;:&#39;docs&#39;&#125;</span><br><span class="line">&gt;&gt;&gt; p[&#39;apple&#39;]</span><br><span class="line">&#39;pages&#39;</span><br><span class="line">&gt;&gt;&gt; &#39;apple&#39; in p</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#æŸ¥æ‰¾ä¸åˆ°å…ƒç´ ä¼šè¿”å›Noneç©º</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p.get(<span class="string">'google'</span>)</span><br><span class="line"><span class="string">'docs'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p.get(<span class="string">'baidu'</span>)</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>

<h2 id="åˆ é™¤ä¸€ä¸ªkey"><a href="#åˆ é™¤ä¸€ä¸ªkey" class="headerlink" title="åˆ é™¤ä¸€ä¸ªkey"></a>åˆ é™¤ä¸€ä¸ªkey</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>p.pop(<span class="string">'google'</span>)</span><br><span class="line"><span class="string">'docs'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p</span><br><span class="line">&#123;<span class="string">'apple'</span>: <span class="string">'pages'</span>, <span class="string">'microsoft'</span>: <span class="string">'word'</span>&#125;</span><br></pre></td></tr></table></figure>

<h1 id="inå…³é”®å­—"><a href="#inå…³é”®å­—" class="headerlink" title="inå…³é”®å­—"></a>inå…³é”®å­—</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#åˆ¤æ–­ä¸€ä¸ªå…ƒç´ æ˜¯å¦åŒ…å«åœ¨ä¸€ä¸ªå­—å…¸ä¸­</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p = &#123;<span class="string">'apple'</span>:<span class="string">'pages'</span>, <span class="string">'microsoft'</span>:<span class="string">'word'</span>, <span class="string">'google'</span>:<span class="string">'docs'</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p[<span class="string">'apple'</span>]</span><br><span class="line"><span class="string">'pages'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">'apple'</span> <span class="keyword">in</span> p</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="comment">#åˆ¤æ–­ä¸€ä¸ªå…ƒç´ æ˜¯å¦åŒ…å«åœ¨ä¸€ä¸ªåˆ—è¡¨ä¸­</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>testlist</span><br><span class="line">[[<span class="string">'iPhone'</span>, <span class="string">'iPad'</span>, <span class="string">'iMac'</span>], <span class="string">'Microsoft'</span>, <span class="string">'Google'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">'Google'</span> <span class="keyword">in</span> testlist</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure>

<h1 id="é›†åˆ"><a href="#é›†åˆ" class="headerlink" title="é›†åˆ"></a>é›†åˆ</h1><ul>
<li>å¯å˜é›†åˆï¼ˆsetï¼‰</li>
<li>ä¸å¯å˜é›†åˆï¼ˆfrozensetï¼‰</li>
</ul>
<h2 id="é›†åˆçš„åŸºæœ¬ä½¿ç”¨"><a href="#é›†åˆçš„åŸºæœ¬ä½¿ç”¨" class="headerlink" title="é›†åˆçš„åŸºæœ¬ä½¿ç”¨"></a>é›†åˆçš„åŸºæœ¬ä½¿ç”¨</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = set([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s</span><br><span class="line">set([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>type(s)</span><br><span class="line">&lt;type <span class="string">'set'</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">## è®¿é—®é›†åˆ</span></span><br><span class="line"></span><br><span class="line">é›†åˆæ˜¯æ— åºçš„ï¼Œæ‰€ä»¥ä¸èƒ½å¯¹é›†åˆåˆ›å»ºç´¢å¼•æˆ–åˆ‡ç‰‡çš„æ“ä½œï¼Œåªèƒ½å¾ªç¯éå†æˆ–ä½¿ç”¨<span class="keyword">in</span>ã€<span class="keyword">not</span> <span class="keyword">in</span>æ¥è®¿é—®æˆ–åˆ¤æ–­é›†åˆå…ƒç´ </span><br><span class="line"></span><br><span class="line">```python</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = set([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s</span><br><span class="line">set([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">2</span> <span class="keyword">in</span> s</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">5</span> <span class="keyword">in</span> s</span><br><span class="line"><span class="literal">False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">print</span> i</span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">4</span></span><br></pre></td></tr></table></figure>

<h2 id="é›†åˆä¸­çš„å…ƒç´ ä¸èƒ½é‡å¤ï¼Œé›†åˆä¼šè‡ªåŠ¨è¿‡æ»¤æ‰é‡å¤çš„å…ƒç´ "><a href="#é›†åˆä¸­çš„å…ƒç´ ä¸èƒ½é‡å¤ï¼Œé›†åˆä¼šè‡ªåŠ¨è¿‡æ»¤æ‰é‡å¤çš„å…ƒç´ " class="headerlink" title="é›†åˆä¸­çš„å…ƒç´ ä¸èƒ½é‡å¤ï¼Œé›†åˆä¼šè‡ªåŠ¨è¿‡æ»¤æ‰é‡å¤çš„å…ƒç´ "></a>é›†åˆä¸­çš„å…ƒç´ ä¸èƒ½é‡å¤ï¼Œé›†åˆä¼šè‡ªåŠ¨è¿‡æ»¤æ‰é‡å¤çš„å…ƒç´ </h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>s.add(<span class="number">4</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s</span><br><span class="line">set([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s.add(<span class="number">4</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s</span><br><span class="line">set([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>])</span><br></pre></td></tr></table></figure>

<h2 id="åˆ é™¤é›†åˆä¸­çš„å…ƒç´ "><a href="#åˆ é™¤é›†åˆä¸­çš„å…ƒç´ " class="headerlink" title="åˆ é™¤é›†åˆä¸­çš„å…ƒç´ "></a>åˆ é™¤é›†åˆä¸­çš„å…ƒç´ </h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; s.remove(2)</span><br><span class="line">&gt;&gt;&gt; s</span><br><span class="line">set([1, 3, 4])</span><br></pre></td></tr></table></figure>

<h2 id="äº¤é›†ä¸å¹¶é›†"><a href="#äº¤é›†ä¸å¹¶é›†" class="headerlink" title="äº¤é›†ä¸å¹¶é›†"></a>äº¤é›†ä¸å¹¶é›†</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>s1 = set([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s2 = set([<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s1 &amp; s2</span><br><span class="line">set([<span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s1 | s2</span><br><span class="line">set([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>])</span><br></pre></td></tr></table></figure>

<h2 id="å­é›†ï¼ˆçœŸå­é›†ï¼‰è¶…é›†ï¼ˆçœŸè¶…é›†ï¼‰"><a href="#å­é›†ï¼ˆçœŸå­é›†ï¼‰è¶…é›†ï¼ˆçœŸè¶…é›†ï¼‰" class="headerlink" title="å­é›†ï¼ˆçœŸå­é›†ï¼‰è¶…é›†ï¼ˆçœŸè¶…é›†ï¼‰"></a>å­é›†ï¼ˆçœŸå­é›†ï¼‰è¶…é›†ï¼ˆçœŸè¶…é›†ï¼‰</h2><p>å­é›†åŒ…å«é›†åˆæœ¬èº«,çœŸå­é›†ä¸åŒ…å«æœ¬èº«!å¦‚ï¼ˆ1,2ï¼‰çš„å­é›†æœ‰ï¼šç©ºé›†,ï¼ˆ1ï¼‰,ï¼ˆ2ï¼‰,ï¼ˆ1,2ï¼‰.è€ŒçœŸå­é›†æœ‰ï¼šç©ºé›†,(1),(2)æ²¡æœ‰ï¼ˆ12ï¼‰</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#å­é›†(&lt;=)  çœŸå­é›†(&lt;)</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>set(<span class="string">'shop'</span>) &lt; set(<span class="string">'bookshop'</span>)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>set(<span class="string">'shop'</span>) &lt;= set(<span class="string">'bookshop'</span>)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>set(<span class="string">'bookshop'</span>) &lt; set(<span class="string">'bookshop'</span>)</span><br><span class="line"><span class="literal">False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>set(<span class="string">'bookshop'</span>) &lt;= set(<span class="string">'bookshop'</span>)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="comment">#è¶…é›†(&gt;=)  çœŸè¶…é›†(&gt;)</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>set(<span class="string">'bookshop'</span>) &gt; set(<span class="string">'shop'</span>)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>set(<span class="string">'bookshop'</span>) &gt;= set(<span class="string">'shop'</span>)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>set(<span class="string">'bookshop'</span>) &gt; set(<span class="string">'bookshop'</span>)</span><br><span class="line"><span class="literal">False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>set(<span class="string">'bookshop'</span>) &gt;= set(<span class="string">'bookshop'</span>)</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure>

<h2 id="å¼‚æˆ–"><a href="#å¼‚æˆ–" class="headerlink" title="å¼‚æˆ–"></a>å¼‚æˆ–</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>s1</span><br><span class="line">set([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s2</span><br><span class="line">set([<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s1 ^ s2</span><br><span class="line">set([<span class="number">1</span>, <span class="number">4</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s1.symmetric_difference(s2)</span><br><span class="line">set([<span class="number">1</span>, <span class="number">4</span>])</span><br></pre></td></tr></table></figure>

<h2 id="å·®è¡¥-ç›¸å¯¹è¡¥é›†"><a href="#å·®è¡¥-ç›¸å¯¹è¡¥é›†" class="headerlink" title="å·®è¡¥/ç›¸å¯¹è¡¥é›†"></a>å·®è¡¥/ç›¸å¯¹è¡¥é›†</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>s1</span><br><span class="line">set([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s2</span><br><span class="line">set([<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>])</span><br><span class="line">set([<span class="number">1</span>, <span class="number">4</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s1 - s2</span><br><span class="line">set([<span class="number">1</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s2 -s1</span><br><span class="line">set([<span class="number">4</span>])</span><br></pre></td></tr></table></figure>

<p><strong>é›†åˆçš„åº”ç”¨ï¼š å»é‡</strong></p>
<h1 id="å¼ºåˆ¶ç±»å‹è½¬æ¢"><a href="#å¼ºåˆ¶ç±»å‹è½¬æ¢" class="headerlink" title="å¼ºåˆ¶ç±»å‹è½¬æ¢"></a>å¼ºåˆ¶ç±»å‹è½¬æ¢</h1><h2 id="å­—å…¸-1"><a href="#å­—å…¸-1" class="headerlink" title="å­—å…¸"></a>å­—å…¸</h2><h3 id="å­—å…¸-2-å­—ç¬¦ä¸²"><a href="#å­—å…¸-2-å­—ç¬¦ä¸²" class="headerlink" title="å­—å…¸ 2 å­—ç¬¦ä¸²"></a>å­—å…¸ 2 å­—ç¬¦ä¸²</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>d = &#123;<span class="string">'a'</span>:<span class="number">1</span>, <span class="string">'b'</span>:<span class="number">2</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d</span><br><span class="line">&#123;<span class="string">'a'</span>: <span class="number">1</span>, <span class="string">'b'</span>: <span class="number">2</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> type(str(d)), str(d)</span><br><span class="line">&lt;type <span class="string">'str'</span>&gt; &#123;<span class="string">'a'</span>: <span class="number">1</span>, <span class="string">'b'</span>: <span class="number">2</span>&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å­—å…¸-2-å…ƒç»„"><a href="#å­—å…¸-2-å…ƒç»„" class="headerlink" title="å­—å…¸ 2 å…ƒç»„"></a>å­—å…¸ 2 å…ƒç»„</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>d = &#123;<span class="string">'a'</span>:<span class="number">1</span>, <span class="string">'b'</span>:<span class="number">2</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d</span><br><span class="line">&#123;<span class="string">'a'</span>: <span class="number">1</span>, <span class="string">'b'</span>: <span class="number">2</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> tuple(d)</span><br><span class="line">(<span class="string">'a'</span>, <span class="string">'b'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> tuple(d.values())</span><br><span class="line">(<span class="number">1</span>, <span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<h3 id="å­—å…¸-2-åˆ—è¡¨"><a href="#å­—å…¸-2-åˆ—è¡¨" class="headerlink" title="å­—å…¸ 2 åˆ—è¡¨"></a>å­—å…¸ 2 åˆ—è¡¨</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>d = &#123;<span class="string">'a'</span>:<span class="number">1</span>, <span class="string">'b'</span>:<span class="number">2</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d</span><br><span class="line">&#123;<span class="string">'a'</span>: <span class="number">1</span>, <span class="string">'b'</span>: <span class="number">2</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> list(d)</span><br><span class="line">[<span class="string">'a'</span>, <span class="string">'b'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> list(d.values())</span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>]</span><br></pre></td></tr></table></figure>

<h2 id="å…ƒç»„-1"><a href="#å…ƒç»„-1" class="headerlink" title="å…ƒç»„"></a>å…ƒç»„</h2><h3 id="å…ƒç»„-2-å­—ç¬¦ä¸²"><a href="#å…ƒç»„-2-å­—ç¬¦ä¸²" class="headerlink" title="å…ƒç»„ 2 å­—ç¬¦ä¸²"></a>å…ƒç»„ 2 å­—ç¬¦ä¸²</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>t = (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t</span><br><span class="line">(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> type(str(t)), str(t)</span><br><span class="line">&lt;type <span class="string">'str'</span>&gt; (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br></pre></td></tr></table></figure>

<h3 id="å…ƒç»„-2-åˆ—è¡¨"><a href="#å…ƒç»„-2-åˆ—è¡¨" class="headerlink" title="å…ƒç»„ 2 åˆ—è¡¨"></a>å…ƒç»„ 2 åˆ—è¡¨</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>t = (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t</span><br><span class="line">(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> type(list(t)), list(t)</span><br><span class="line">&lt;type <span class="string">'list'</span>&gt; [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br></pre></td></tr></table></figure>

<h3 id="å…ƒç»„-2-é›†åˆ"><a href="#å…ƒç»„-2-é›†åˆ" class="headerlink" title="å…ƒç»„ 2 é›†åˆ"></a>å…ƒç»„ 2 é›†åˆ</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>t = (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t</span><br><span class="line">(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> type(set(t)), set(t)</span><br><span class="line">&lt;type <span class="string">'set'</span>&gt; set([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br></pre></td></tr></table></figure>

<h3 id="å…ƒç»„ä¸èƒ½è½¬æˆå­—å…¸"><a href="#å…ƒç»„ä¸èƒ½è½¬æˆå­—å…¸" class="headerlink" title="å…ƒç»„ä¸èƒ½è½¬æˆå­—å…¸"></a>å…ƒç»„ä¸èƒ½è½¬æˆå­—å…¸</h3><h2 id="åˆ—è¡¨-1"><a href="#åˆ—è¡¨-1" class="headerlink" title="åˆ—è¡¨"></a>åˆ—è¡¨</h2><h3 id="åˆ—è¡¨-2-å­—ç¬¦ä¸²"><a href="#åˆ—è¡¨-2-å­—ç¬¦ä¸²" class="headerlink" title="åˆ—è¡¨ 2 å­—ç¬¦ä¸²"></a>åˆ—è¡¨ 2 å­—ç¬¦ä¸²</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>l = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l</span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> type(str(l)), str(l)</span><br><span class="line">&lt;type <span class="string">'str'</span>&gt; [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br></pre></td></tr></table></figure>

<h3 id="åˆ—è¡¨-2-å…ƒç»„"><a href="#åˆ—è¡¨-2-å…ƒç»„" class="headerlink" title="åˆ—è¡¨ 2 å…ƒç»„"></a>åˆ—è¡¨ 2 å…ƒç»„</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>l = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l</span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> type(tuple(l)), tuple(l)</span><br><span class="line">&lt;type <span class="string">'tuple'</span>&gt; (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br></pre></td></tr></table></figure>

<h3 id="åˆ—è¡¨-2-é›†åˆ"><a href="#åˆ—è¡¨-2-é›†åˆ" class="headerlink" title="åˆ—è¡¨ 2 é›†åˆ"></a>åˆ—è¡¨ 2 é›†åˆ</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>l = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l</span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> type(set(l)), set(l)</span><br><span class="line">&lt;type <span class="string">'set'</span>&gt; set([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br></pre></td></tr></table></figure>

<h3 id="åˆ—è¡¨ä¸èƒ½è½¬æˆå­—å…¸"><a href="#åˆ—è¡¨ä¸èƒ½è½¬æˆå­—å…¸" class="headerlink" title="åˆ—è¡¨ä¸èƒ½è½¬æˆå­—å…¸"></a>åˆ—è¡¨ä¸èƒ½è½¬æˆå­—å…¸</h3><h2 id="å­—ç¬¦ä¸²"><a href="#å­—ç¬¦ä¸²" class="headerlink" title="å­—ç¬¦ä¸²"></a>å­—ç¬¦ä¸²</h2><h3 id="å­—ç¬¦ä¸²-2-åˆ—è¡¨"><a href="#å­—ç¬¦ä¸²-2-åˆ—è¡¨" class="headerlink" title="å­—ç¬¦ä¸² 2 åˆ—è¡¨"></a>å­—ç¬¦ä¸² 2 åˆ—è¡¨</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">"[[1,2], [3,4], [5,6], [7,8], [9,0]]"</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s</span><br><span class="line"><span class="string">'[[1,2], [3,4], [5,6], [7,8], [9,0]]'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> list(s)</span><br><span class="line">[<span class="string">'['</span>, <span class="string">'['</span>, <span class="string">'1'</span>, <span class="string">','</span>, <span class="string">'2'</span>, <span class="string">']'</span>, <span class="string">','</span>, <span class="string">' '</span>, <span class="string">'['</span>, <span class="string">'3'</span>, <span class="string">','</span>, <span class="string">'4'</span>, <span class="string">']'</span>, <span class="string">','</span>, <span class="string">' '</span>, <span class="string">'['</span>, <span class="string">'5'</span>, <span class="string">','</span>, <span class="string">'6'</span>, <span class="string">']'</span>, <span class="string">','</span>, <span class="string">' '</span>, <span class="string">'['</span>, <span class="string">'7'</span>, <span class="string">','</span>, <span class="string">'8'</span>, <span class="string">']'</span>, <span class="string">','</span>, <span class="string">' '</span>, <span class="string">'['</span>, <span class="string">'9'</span>, <span class="string">','</span>, <span class="string">'0'</span>, <span class="string">']'</span>, <span class="string">']'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> type(eval(s)), eval(s)</span><br><span class="line">&lt;type <span class="string">'list'</span>&gt; [[<span class="number">1</span>, <span class="number">2</span>], [<span class="number">3</span>, <span class="number">4</span>], [<span class="number">5</span>, <span class="number">6</span>], [<span class="number">7</span>, <span class="number">8</span>], [<span class="number">9</span>, <span class="number">0</span>]]</span><br></pre></td></tr></table></figure>

<h3 id="å­—ç¬¦ä¸²-2-å­—å…¸"><a href="#å­—ç¬¦ä¸²-2-å­—å…¸" class="headerlink" title="å­—ç¬¦ä¸² 2 å­—å…¸"></a>å­—ç¬¦ä¸² 2 å­—å…¸</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">"&#123;1: 'a', 2: 'b'&#125;"</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s</span><br><span class="line"><span class="string">"&#123;1: 'a', 2: 'b'&#125;"</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> type(eval(s)), eval(s)</span><br><span class="line">&lt;type <span class="string">'dict'</span>&gt; &#123;<span class="number">1</span>: <span class="string">'a'</span>, <span class="number">2</span>: <span class="string">'b'</span>&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å­—ç¬¦ä¸²-2-å…ƒç»„"><a href="#å­—ç¬¦ä¸²-2-å…ƒç»„" class="headerlink" title="å­—ç¬¦ä¸² 2 å…ƒç»„"></a>å­—ç¬¦ä¸² 2 å…ƒç»„</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">"([1,2], [3,4], [5,6], [7,8], (9,0))"</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> type(eval(s)), eval(s)</span><br><span class="line">&lt;type <span class="string">'tuple'</span>&gt; ([<span class="number">1</span>, <span class="number">2</span>], [<span class="number">3</span>, <span class="number">4</span>], [<span class="number">5</span>, <span class="number">6</span>], [<span class="number">7</span>, <span class="number">8</span>], (<span class="number">9</span>, <span class="number">0</span>))</span><br></pre></td></tr></table></figure>

<h3 id="å­—ç¬¦ä¸²-2-é›†åˆ"><a href="#å­—ç¬¦ä¸²-2-é›†åˆ" class="headerlink" title="å­—ç¬¦ä¸² 2 é›†åˆ"></a>å­—ç¬¦ä¸² 2 é›†åˆ</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">"test"</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> type(set(s)), set(s)</span><br><span class="line">&lt;type <span class="string">'set'</span>&gt; set([<span class="string">'s'</span>, <span class="string">'e'</span>, <span class="string">'t'</span>])</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>YAMLè¯­æ³•ç®€ä»‹</title>
    <url>/2015/12/03/YAML%E8%AF%AD%E6%B3%95%E7%AE%80%E4%BB%8B/</url>
    <content><![CDATA[<h1 id="YAMLçš„æ•°æ®ç»“æ„"><a href="#YAMLçš„æ•°æ®ç»“æ„" class="headerlink" title="YAMLçš„æ•°æ®ç»“æ„"></a>YAMLçš„æ•°æ®ç»“æ„</h1><p>YAMLçš„è®¾è®¡è€…è®¤ä¸ºåœ¨é…ç½®æ–‡ä»¶ä¸­æ‰€è¦è¡¨è¾¾çš„æ•°æ®å†…å®¹æœ‰ä¸‰ç§ç±»å‹</p>
<ul>
<li>Scalarsï¼ˆæ ‡é‡ï¼Œå¦‚å­—ç¬¦ä¸²å’Œæ•°å­—ç­‰ï¼‰</li>
<li>Sequence ï¼ˆåºåˆ—ï¼Œç±»ä¼¼äºPythonä¸­åˆ—è¡¨çš„æ¦‚å¿µï¼‰</li>
<li>Mapping ï¼ˆç±»ä¼¼äºPythonä¸­å­—å…¸çš„æ¦‚å¿µï¼‰</li>
</ul>
<h2 id="Sequence-of-Scalars"><a href="#Sequence-of-Scalars" class="headerlink" title="Sequence of Scalars"></a>Sequence of Scalars</h2><p>YAML(ball players)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">- Mark McGwire</span><br><span class="line">- Sammy Sosa</span><br><span class="line">- Ken Griffey</span><br></pre></td></tr></table></figure>

<p>Python(YAML)</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[<span class="string">'Mark McGwire'</span>, <span class="string">'Sammy Sosa'</span>, <span class="string">'Ken Griffey'</span>]</span><br></pre></td></tr></table></figure>


<h2 id="Mapping-Scalars-to-Scalars"><a href="#Mapping-Scalars-to-Scalars" class="headerlink" title="Mapping Scalars to Scalars"></a>Mapping Scalars to Scalars</h2><p>YAML(player statistics)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hr:  65    # Home runs</span><br><span class="line">avg: 0.278 # Batting average</span><br><span class="line">rbi: 147   # Runs Batted In</span><br></pre></td></tr></table></figure>

<p>Pyhton(YAML)</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;<span class="string">'hr'</span>:<span class="number">65</span>, <span class="string">'avg'</span>:<span class="number">0.278</span>, <span class="string">'rbi'</span>:<span class="number">147</span>&#125;</span><br></pre></td></tr></table></figure>


<h2 id="Mapping-Scalars-to-Sequences"><a href="#Mapping-Scalars-to-Sequences" class="headerlink" title="Mapping Scalars to Sequences"></a>Mapping Scalars to Sequences</h2><p>YAML(ball clubs in each league)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">american:</span><br><span class="line">  - Boston Red Sox</span><br><span class="line">  - Detroit Tigers</span><br><span class="line">  - New York Yankees</span><br><span class="line">national:</span><br><span class="line">  - New York Mets</span><br><span class="line">  - Chicago Cubs</span><br><span class="line">  - Atlanta Braves</span><br></pre></td></tr></table></figure>

<p>Python(YAML)</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;<span class="string">'american'</span>:[<span class="string">'Boston Red Sox'</span>, <span class="string">'Detroit Tigers'</span>, <span class="string">'New York Yankees'</span>], <span class="string">'national'</span>:[<span class="string">'New York Mets'</span>, <span class="string">'Chicago Cubs'</span>, <span class="string">'Atlanta Braves'</span>]&#125;</span><br></pre></td></tr></table></figure>


<h2 id="Sequence-of-Mappings"><a href="#Sequence-of-Mappings" class="headerlink" title="Sequence of Mappings"></a>Sequence of Mappings</h2><p>YAML(playersâ€™ statistics)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">-</span><br><span class="line">  name: Mark McGwire</span><br><span class="line">  hr:   65</span><br><span class="line">  avg:  0.278</span><br><span class="line">-</span><br><span class="line">  name: Sammy Sosa</span><br><span class="line">  hr:   63</span><br><span class="line">  avg:  0.288</span><br></pre></td></tr></table></figure>

<p>Python(YAML)</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[&#123;<span class="string">'name'</span>:<span class="string">'Mark McGwire'</span>, <span class="string">'hr'</span>:<span class="number">65</span>, <span class="string">'avg'</span>:<span class="number">0.278</span>&#125;, &#123;<span class="string">'name'</span>:<span class="string">'Sammy Sosa'</span>, <span class="string">'hr'</span>:<span class="number">63</span>, <span class="string">'avg'</span>:<span class="number">0.288</span>&#125;]</span><br></pre></td></tr></table></figure>

<h2 id="Sequence-of-Sequences"><a href="#Sequence-of-Sequences" class="headerlink" title="Sequence of Sequences"></a>Sequence of Sequences</h2><p>YAML</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">- [name        , hr, avg  ]</span><br><span class="line">- [Mark McGwire, 65, 0.278]</span><br><span class="line">- [Sammy Sosa  , 63, 0.288]</span><br></pre></td></tr></table></figure>

<p>Python(YAML)</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[[<span class="string">'name'</span>, <span class="string">'hr'</span>, <span class="string">'avg'</span>], [<span class="string">'Mark McGwire'</span>, <span class="number">65</span>, <span class="number">0.278</span>], [<span class="string">'Sammy Sosa'</span>, <span class="number">63</span>, <span class="number">0.288</span>]]</span><br></pre></td></tr></table></figure>


<h2 id="Mapping-of-Mappings"><a href="#Mapping-of-Mappings" class="headerlink" title="Mapping of Mappings"></a>Mapping of Mappings</h2><p>YAML</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Mark McGwire: &#123;hr: 65, avg: 0.278&#125;</span><br><span class="line">Sammy Sosa: &#123;</span><br><span class="line">    hr: 63,</span><br><span class="line">    avg: 0.288</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>Python(YAML)</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;<span class="string">'Mark McGwire'</span>:&#123;<span class="string">'hr'</span>:<span class="number">65</span>, <span class="string">'avg'</span>:<span class="number">0.278</span>&#125;, <span class="string">'Sammy Sosa'</span>:&#123;<span class="string">'hr'</span>:<span class="number">63</span>, <span class="string">'avg'</span>:<span class="number">0.288</span>&#125;&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="YAMLä¸­çš„æ³¨é‡Š"><a href="#YAMLä¸­çš„æ³¨é‡Š" class="headerlink" title="YAMLä¸­çš„æ³¨é‡Š"></a>YAMLä¸­çš„æ³¨é‡Š</h1><p>YAML</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#ball players</span><br><span class="line">- Mark McGwire</span><br><span class="line">- Sammy Sosa</span><br><span class="line">- Ken Griffey</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="YAMLä¸­çš„æ–‡æ¡£"><a href="#YAMLä¸­çš„æ–‡æ¡£" class="headerlink" title="YAMLä¸­çš„æ–‡æ¡£"></a>YAMLä¸­çš„æ–‡æ¡£</h1><p>åœ¨å•ä¸€ä¸€ä¸ªYAMLæ–‡ä»¶ä¸­</p>
<ul>
<li>ä½¿ç”¨ä¸‰ä¸ªä¸‹åˆ’çº¿<code>___</code>æ¥åˆ†éš”æ–‡æ¡£</li>
<li>ä½¿ç”¨ä¸‰ä¸ªå¥å·<code>...</code>è¡¨ç¤ºç»“æŸï¼ˆä¸€èˆ¬åœ¨é€šä¿¡ä¿¡é“ä¸­ä½¿ç”¨ï¼‰</li>
</ul>
<p>YAML(Two Documents in a Stream)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># Ranking of 1998 home runs</span><br><span class="line">---</span><br><span class="line">- Mark McGwire</span><br><span class="line">- Sammy Sosa</span><br><span class="line">- Ken Griffey</span><br><span class="line"> </span><br><span class="line"># Team ranking</span><br><span class="line">---</span><br><span class="line">- Chicago Cubs</span><br><span class="line">- St Louis Cardinals</span><br></pre></td></tr></table></figure>

<p>YAML</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">---</span><br><span class="line">time: 20:03:20</span><br><span class="line">player: Sammy Sosa</span><br><span class="line">action: strike (miss)</span><br><span class="line">...</span><br><span class="line">---</span><br><span class="line">time: 20:03:47</span><br><span class="line">player: Sammy Sosa</span><br><span class="line">action: grand slam</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h1><p>YAML</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ç”¨YAMLæ¥æè¿°ä¸€æœ¬ä¹¦ã€ŠLinuxå‘½ä»¤è¡Œä¸shellè„šæœ¬ç¼–ç¨‹å¤§å…¨ã€‹</span><br><span class="line"> </span><br><span class="line"># ã€ŠLinuxå‘½ä»¤è¡Œä¸shellè„šæœ¬ç¼–ç¨‹å¤§å…¨ã€‹æè¿°</span><br><span class="line">---  # begin of document</span><br><span class="line">ä¹¦å: &#39;Linuxå‘½ä»¤è¡Œä¸shellè„šæœ¬ç¼–ç¨‹å¤§å…¨&#39;</span><br><span class="line">å‡ºç‰ˆç¤¾: &#39;äººæ°‘é‚®ç”µå‡ºç‰ˆç¤¾&#39;</span><br><span class="line">åŸä½œè€…: [&#39;Richard Blum&#39;, &#39;Christine Bresnahan&#39;]</span><br><span class="line">è¯‘è€…:</span><br><span class="line">    - æ­¦æµ·å³°</span><br><span class="line">    - æœ±å·</span><br><span class="line">å‰äºŒç« èŠ‚:</span><br><span class="line">    - ç¬¬ä¸€ç« : åˆè¯†Linux Shell</span><br><span class="line">    - ç¬¬äºŒç« : èµ°è¿›Shell</span><br><span class="line"> </span><br><span class="line">#end of document</span><br></pre></td></tr></table></figure>

<p>Python(YAML)</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;<span class="string">'ä¹¦å'</span>:<span class="string">'Linuxå‘½ä»¤è¡Œä¸shellè„šæœ¬ç¼–ç¨‹å¤§å…¨'</span>, <span class="string">'å‡ºç‰ˆç¤¾'</span>:<span class="string">'äººæ°‘é‚®ç”µå‡ºç‰ˆç¤¾'</span>, <span class="string">'åŸä½œè€…'</span>:[<span class="string">'Richard Blum'</span>, <span class="string">'Christine Bresnahan'</span>], <span class="string">'è¯‘è€…'</span>:[<span class="string">'æ­¦æµ·å³°'</span>, <span class="string">'æœ±å·'</span>], <span class="string">'å‰äºŒç« èŠ‚'</span>:&#123;<span class="string">'ç¬¬ä¸€ç« '</span>:<span class="string">'åˆè¯†Linux Shell'</span>, <span class="string">'ç¬¬äºŒç« '</span>:<span class="string">'èµ°è¿›Shell'</span>&#125;&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p>å‚è€ƒæ–‡æ¡£ï¼š</p>
<ul>
<li><a href="http://yaml.org/spec/1.1/" target="_blank" rel="noopener">http://yaml.org/spec/1.1/</a></li>
<li><a href="http://www.cnblogs.com/chwkai/archive/2009/03/01/249924.html" target="_blank" rel="noopener">http://www.cnblogs.com/chwkai/archive/2009/03/01/249924.html</a></li>
</ul>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>YAML</tag>
      </tags>
  </entry>
  <entry>
    <title>salt pkg.installæŠ¥é”™:No module named yum</title>
    <url>/2015/11/24/salt-pkg-install%E6%8A%A5%E9%94%99-No-module-named-yum/</url>
    <content><![CDATA[<blockquote>
<p>åœ¨ä½¿ç”¨saltè¿›è¡Œè½¯ä»¶ç®¡ç†çš„æ—¶å€™ï¼Œæœ‰äº›èŠ‚ç‚¹æŠ¥ No module named yum çš„é”™è¯¯ã€‚ç»è¿‡æ’æŸ¥ï¼Œå‘ç°æ˜¯å› ä¸ºå‡çº§äº†minionç«¯Pythonç‰ˆæœ¬åäº§ç”Ÿçš„é—®é¢˜</p>
</blockquote>
<p><strong>msater</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ salt <span class="string">'vm3.salt.com'</span> pkg.install httpd</span><br><span class="line">vm3.salt.com:</span><br><span class="line">    ERROR: Traceback (most recent call last):</span><br><span class="line">      File <span class="string">"/usr/bin/repoquery"</span>, line 34, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">        import yum</span><br><span class="line">    ImportError: No module named yum</span><br></pre></td></tr></table></figure>

<p>æœåŠ¡å™¨è‡ªå¸¦çš„Pythonç‰ˆæœ¬æ˜¯2.6.6 ç”±äºå…¶ä»–ä¸šåŠ¡çš„éœ€æ±‚ï¼ŒPythonçš„ç‰ˆæœ¬å‡çº§åˆ°äº†2.7.10ï¼Œå‡çº§åé¦–å…ˆyumå‘½ä»¤å¤„äºä¸å¯ç”¨çš„çŠ¶æ€ï¼Œé€šè¿‡ä¿®æ”¹<code>/usr/bin/yum</code>æ–‡ä»¶çš„ç¬¬ä¸€è¡Œ<code>#!/usr/bin/python</code>ä¸º<code>#!/usr/bin/python2.6</code>æ¥ä¿®å¤yumå‘½ä»¤çš„ä½¿ç”¨</p>
<p>ç”±äºç³»ç»Ÿé»˜è®¤çš„Pythonå·²ç»ç”±2.6.6å˜æ›´åˆ°äº†2.7.10</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ ls -l /usr/bin/python</span><br><span class="line">lrwxrwxrwx 1 root root 34 Oct  9 02:16 /usr/bin/python -&gt; /usr/<span class="built_in">local</span>/python2.7/bin/python2.7</span><br></pre></td></tr></table></figure>

<p>salt masteråœ¨æ´¾å‘ä»»åŠ¡åï¼Œminionæ¥æ”¶åˆ°ä»»åŠ¡å¹¶åœ¨æœ¬åœ°ä½¿ç”¨é»˜è®¤çš„Pythonæ¥æ‰§è¡Œï¼Œå®é™…ä½¿ç”¨äº†å‡çº§åé»˜è®¤çš„Python2.7.10ï¼Œå¯¼è‡´PythonæŠ¥æ‰¾ä¸åˆ°yumæ¨¡å—çš„é”™è¯¯</p>
<p>åœ¨ç½‘ä¸Šæœç´¢äº†å¾ˆå¤šæ–¹æ¡ˆï¼Œå…¨éƒ¨æ˜¯ä¿®æ”¹yumé»˜è®¤ä½¿ç”¨çš„Pythonç‰ˆæœ¬æ¥è§£å†³é—®é¢˜ï¼Œè²Œä¼¼ä¸èƒ½é€šè¿‡è®©yumæ¥æ”¯æŒé«˜ç‰ˆæœ¬çš„Pythonæ¥è§£å†³é—®é¢˜ã€‚soï¼Œè¦è§£å†³salt minionæœ¬åœ°è°ƒç”¨yumä¸æŠ¥é”™ï¼Œå°±å¿…é¡»è¦ä¿è¯å…¶ä½¿ç”¨Python2.6.6æ¥æ‰§è¡Œï¼è§£å†³æ–¹æ¡ˆå’Œyumå‘½ä»¤çš„ä¿®å¤æ–¹å¼ç›¸åŒï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ head /usr/bin/repoquery</span><br><span class="line"><span class="comment">#!/usr/bin/python -tt</span></span><br><span class="line"><span class="comment">#... ...</span></span><br><span class="line"></span><br><span class="line">$ vim /usr/bin/repoquery </span><br><span class="line"></span><br><span class="line">$ head /usr/bin/repoquery</span><br><span class="line"><span class="comment">#!/usr/bin/python2.6 -tt</span></span><br><span class="line"><span class="comment">#... ...</span></span><br></pre></td></tr></table></figure>
<p>å°†<code>/usr/bin/repoquery</code>æ–‡ä»¶ç¬¬ä¸€è¡Œçš„<code>#!/usr/bin/python -tt</code>æ›´æ”¹ä¸º<code>#!/usr/bin/python2.6 -tt</code>å³å¯</p>
]]></content>
      <categories>
        <category>SaltStack</category>
      </categories>
      <tags>
        <tag>saltstack</tag>
        <tag>module</tag>
      </tags>
  </entry>
  <entry>
    <title>saltstack keyè®¤è¯è¿‡ç¨‹</title>
    <url>/2015/11/24/saltstack-key%E8%AE%A4%E8%AF%81%E8%BF%87%E7%A8%8B/</url>
    <content><![CDATA[<h1 id="å¯†é’¥å¯¹å„¿çš„è®¤è¯"><a href="#å¯†é’¥å¯¹å„¿çš„è®¤è¯" class="headerlink" title="å¯†é’¥å¯¹å„¿çš„è®¤è¯"></a>å¯†é’¥å¯¹å„¿çš„è®¤è¯</h1><p>å½“åˆå§‹åŒ–å®‰è£… minion å¯åŠ¨æœåŠ¡å¯åŠ¨å</p>
<ol>
<li>minionç«¯ç”Ÿæˆä¸€ä¸ªç§˜é’¥å¯¹ï¼Œå¹¶äº§ç”Ÿä¸€ä¸ªIDå€¼ï¼ŒminionæœåŠ¡ä¼šå®‰è£…IDå€¼å‘½åçš„å…¬é’¥å‘é€ç»™ master ,ç›´åˆ°æ¥å—ä¸ºæ­¢;</li>
<li>masterè®¤è¯å®Œæ¯•åï¼Œä¼šå°†minion ç«¯å‘é€æ¥çš„ï¼Œä»¥IDå€¼å‘½åçš„å…¬é’¥å­˜æ”¾åœ¨ <code>/etc/salt/pki/master/minions</code> ç›®å½•ä¸­(æ— æ‰©å±•å);</li>
<li>masterè®¤è¯å®Œæ¯•åï¼Œä¼šå°†è‡ªèº«çš„å…¬é’¥å‘é€ç»™ minionï¼Œå¹¶å­˜å‚¨ä¸º <code>/etc/salt/pki/minion/minion_master.pub</code></li>
</ol>
<hr>
<h1 id="minion-idçš„ç”Ÿæˆè¿‡ç¨‹"><a href="#minion-idçš„ç”Ÿæˆè¿‡ç¨‹" class="headerlink" title="minion idçš„ç”Ÿæˆè¿‡ç¨‹"></a>minion idçš„ç”Ÿæˆè¿‡ç¨‹</h1><p>minion é»˜è®¤æŒ‰ç…§ä¸€å®šçš„é¡ºåºï¼Œè¯•å›¾æ‰¾åˆ°ä¸€ä¸ªä¸æ˜¯localhostçš„å€¼ä½œä¸ºå…¶ID</p>
<p>è¿™é‡Œä¸éœ€è¦çŸ¥é“saltæ˜¯æŒ‰ç…§æ€æ ·çš„é¡ºåºå–å€¼çš„ï¼Œåªéœ€è¦è®°ä½ä»¥ä¸‹ä¼˜å…ˆçº§å³å¯</p>
<p><code>hostname</code> &lt; <code>/etc/salt/minion_id</code> &lt; <code>/etc/salt/minionæ–‡ä»¶ä¸­çš„idå€¼</code></p>
<hr>
<h1 id="å¯†é’¥å¯¹å„¿å­˜æ”¾çš„ä½ç½®"><a href="#å¯†é’¥å¯¹å„¿å­˜æ”¾çš„ä½ç½®" class="headerlink" title="å¯†é’¥å¯¹å„¿å­˜æ”¾çš„ä½ç½®"></a>å¯†é’¥å¯¹å„¿å­˜æ”¾çš„ä½ç½®</h1><ul>
<li>master ç§˜é’¥å¯¹é»˜è®¤å­˜å‚¨åœ¨</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/etc/salt/pki/master/master.pub </span><br><span class="line">/etc/salt/pki/master/master.pem</span><br></pre></td></tr></table></figure>

<ul>
<li>master ç«¯è®¤è¯çš„å…¬é’¥å­˜å‚¨åœ¨ï¼š</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/etc/salt/pki/master/minions/</span><br></pre></td></tr></table></figure>

<ul>
<li>minion ç§˜é’¥å¯¹é»˜è®¤å­˜å‚¨åœ¨</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/etc/salt/pki/minion/minion.pub </span><br><span class="line">/etc/salt/pki/minion/minion.pem</span><br></pre></td></tr></table></figure>

<ul>
<li>minion å­˜æ”¾çš„masterå…¬é’¥</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/etc/salt/pki/minion/minion_master.pub</span><br></pre></td></tr></table></figure>

<ul>
<li>minion_id é»˜è®¤å­˜å‚¨åœ¨</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/etc/salt/minion_id</span><br></pre></td></tr></table></figure>

<p>åœ¨å®é™…ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œminionç«¯å¯èƒ½ä¼šé‡åˆ°å„ç§åŸå› å¯¼è‡´çš„å¯†é’¥å¯¹å„¿ä¸åŒ¹é…çš„æƒ…å†µï¼Œé€ æˆåœ¨masterç«¯æ˜¾ç¤ºåœ¨denied keysåˆ—è¡¨ä¸­æ— æ³•é€šè¿‡è®¤è¯ã€‚</p>
<ul>
<li>[master]å…ˆåœ¨masterç«¯åˆ é™¤è¯¥id</li>
<li>[minion]å†åˆ é™¤minionç«¯çš„keyæ–‡ä»¶</li>
<li>[minion]æœ€åé‡å¯æœåŠ¡</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rm -fr /etc/salt/pki/minion/minion_master.pub</span><br><span class="line"><span class="comment">#é€šè¿‡ä¸Šé¢çš„ä»‹ç»å¯ä»¥å¾—çŸ¥ï¼Œä»¥ä¸Šè¿™ä¸ªæ–‡ä»¶æ˜¯åœ¨masterç«¯è®¤è¯é€šè¿‡ä¹‹åï¼Œå‘æ”¾åˆ°minionç«¯çš„å…¬é’¥</span></span><br><span class="line"><span class="comment">#é€ æˆå‡ºç°è¿™ä¸ªæ–‡ä»¶æƒ…å†µæ˜¯å› ä¸ºæ—©æœŸè¿æ¥äº†ä¸€ä¸ªå…¶ä»–çš„masterï¼Œæ›´æ¢masterå¯¼è‡´åŸå…¬é’¥æ— æ³•åŒ¹é…</span></span><br><span class="line"><span class="comment">#åˆ é™¤ä¸æ—§masterè®¤è¯çš„å…¬é’¥æ–‡ä»¶</span></span><br><span class="line">rm -fr /etc/salt/pki/minion/minion.pem    <span class="comment">#åˆ é™¤minionçš„ç§é’¥æ–‡ä»¶</span></span><br><span class="line">rm -fr /etc/salt/pki/minion/minion.pub    <span class="comment">#åˆ é™¤minionçš„å…¬é’¥æ–‡ä»¶</span></span><br><span class="line">service salt-minion restart    <span class="comment">#é‡å¯æœåŠ¡ ä¼šè‡ªåŠ¨é‡æ–°ç”Ÿæˆæ–°çš„å¯†é’¥å¯¹å„¿</span></span><br><span class="line"><span class="comment">#æ­¤æ—¶masterç«¯æŸ¥çœ‹keysæ—¶ï¼Œæ–°çš„ä¸»æœºå·²ç»å‡ºç°åœ¨Unaccepted Keysçš„åˆ—è¡¨ä¸­äº†</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>å‚è€ƒæ–‡ç«  <a href="http://my.oschina.net/u/877567/blog/201733" target="_blank" rel="noopener">salt key è®¤è¯è¿‡ç¨‹</a></p>
</blockquote>
]]></content>
      <categories>
        <category>SaltStack</category>
      </categories>
      <tags>
        <tag>saltstack</tag>
        <tag>key</tag>
      </tags>
  </entry>
  <entry>
    <title>saltstackå®‰è£…åŠé…ç½®</title>
    <url>/2015/11/23/saltstack%E5%AE%89%E8%A3%85%E5%8F%8A%E9%85%8D%E7%BD%AE/</url>
    <content><![CDATA[<h1 id="saltstackå®‰è£…åŠé…ç½®"><a href="#saltstackå®‰è£…åŠé…ç½®" class="headerlink" title="saltstackå®‰è£…åŠé…ç½®"></a>saltstackå®‰è£…åŠé…ç½®</h1><h2 id="é¦–å…ˆå®‰è£…epelæº"><a href="#é¦–å…ˆå®‰è£…epelæº" class="headerlink" title="é¦–å…ˆå®‰è£…epelæº"></a>é¦–å…ˆå®‰è£…epelæº</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rpm -ivh http://mirrors.kernel.org/fedora-epel/6/x86_64/epel-release-6-8.noarch.rpm</span><br><span class="line">yum makecache</span><br></pre></td></tr></table></figure>

<h2 id="master"><a href="#master" class="headerlink" title="master"></a>master</h2><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum install salt-master -y</span><br></pre></td></tr></table></figure>

<h3 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><p>masterç«¯å®‰è£…å¥½åä¸€èˆ¬ä¸éœ€è¦ä»»ä½•è®¾ç½®ï¼Œå¯åŠ¨æœåŠ¡å™¨å³å¯</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">service salt-master start</span><br><span class="line">chkconfig salt-master on</span><br></pre></td></tr></table></figure>

<h2 id="minion"><a href="#minion" class="headerlink" title="minion"></a>minion</h2><h3 id="å®‰è£…-1"><a href="#å®‰è£…-1" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum install salt-minion</span><br></pre></td></tr></table></figure>

<h3 id="é…ç½®-1"><a href="#é…ç½®-1" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><p>minionç«¯è‡³å°‘éœ€è¦é…ç½®ä¸¤é¡¹ï¼Œidå’Œmasteréœ€è¦æŒ‡å®šã€‚</p>
<ul>
<li>id: è¿™å°ä¸»æœºçš„å”¯ä¸€æ ‡è¯†ï¼ å°±åƒmacåœ°å€ä¸€æ ·ï¼</li>
<li>master: æŒ‡å®šsalt masterçš„IPåœ°å€æˆ–åŸŸåï¼   </li>
</ul>
<p>æ³¨æ„ï¼šæ³¨æ„å†’å·åé¢ä¸€å®šè¦æœ‰ä¸€ä¸ªç©ºæ ¼ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ vim /etc/salt/minion</span><br><span class="line">id: node1.salt.com</span><br><span class="line">master: master.salt.com</span><br></pre></td></tr></table></figure>


<h2 id="masterä¸minionçš„è®¤è¯"><a href="#masterä¸minionçš„è®¤è¯" class="headerlink" title="masterä¸minionçš„è®¤è¯"></a>masterä¸minionçš„è®¤è¯</h2><p><strong>master</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">salt-key -L <span class="comment">#æŸ¥çœ‹æ‰€æœ‰ä¸»æœº</span></span><br><span class="line"><span class="comment">#æ²¡æœ‰æ¥å—çš„keyä¼šæ˜¾ç¤ºåœ¨Unaccepted Keysä¸‹</span></span><br><span class="line">salt-key -A <span class="comment">#æ¥å—æ‰€æœ‰ä¸»æœº</span></span><br><span class="line">salt-key -D <span class="comment">#åˆ é™¤æ‰€æœ‰ä¸»æœº</span></span><br><span class="line">salt-key -a node1.salt.com  <span class="comment">#æ¥å—æŒ‡å®šçš„ä¸»æœº</span></span><br><span class="line">salt-key -d node1.salt.com  <span class="comment">#åˆ é™¤æŒ‡å®šçš„ä¸»æœº</span></span><br></pre></td></tr></table></figure>

<p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œmasterä¸ä¼šåœ¨é…ç½®æ–‡ä»¶ä¸­å¼€å¯è‡ªåŠ¨æˆæƒ</p>
<hr>
<h1 id="æµ‹è¯•è¿é€šæ€§"><a href="#æµ‹è¯•è¿é€šæ€§" class="headerlink" title="æµ‹è¯•è¿é€šæ€§"></a>æµ‹è¯•è¿é€šæ€§</h1><p><strong>master</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ salt <span class="string">'*'</span> test.ping</span><br><span class="line">node1.salt.com:</span><br><span class="line">    True</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>SaltStack</category>
      </categories>
      <tags>
        <tag>saltstack</tag>
      </tags>
  </entry>
  <entry>
    <title>Salt MasteræŠ¥é”™:Minion did not return. [No response]</title>
    <url>/2015/11/23/Salt-Master%E6%8A%A5%E9%94%99-Minion-did-not-return-No-response/</url>
    <content><![CDATA[<p>åœ¨salt masterç«¯æ‰§è¡Œsalt â€˜*â€™ test.pingæ—¶ï¼ŒæŸä¸€èŠ‚ç‚¹å‡ºç°å¦‚ä¸‹æŠ¥é”™ï¼š<br><code>Minion did not return. [No response]</code></p>
<p>ç™»é™†åˆ°è¿™ä¸€èŠ‚ç‚¹æŸ¥çœ‹minionçš„æ—¥å¿—ï¼Œå‘ç°å¦‚ä¸‹çš„é—®é¢˜</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ tail -f /var/<span class="built_in">log</span>/salt/minion</span><br><span class="line">The master may need to be updated <span class="keyword">if</span> it is a version of Salt lower than 2015.5.3, or</span><br><span class="line">If you are confident that you are connecting to a valid Salt Master, <span class="keyword">then</span> remove the master public key and restart the Salt Minion.</span><br><span class="line">The master public key can be found at:</span><br><span class="line">/etc/salt/pki/minion/minion_master.pub</span><br><span class="line">2015-11-23 23:30:02,645 [salt.crypt                               ][ERROR   ][3530] The Salt Master has cached the public key <span class="keyword">for</span> this node, this salt minion will <span class="built_in">wait</span> <span class="keyword">for</span> 10 seconds before attempting to re-authenticate</span><br><span class="line">2015-11-23 23:30:05,108 [salt.crypt                               ][ERROR   ][3586] The Salt Master has cached the public key <span class="keyword">for</span> this node, this salt minion will <span class="built_in">wait</span> <span class="keyword">for</span> 10 seconds before attempting to re-authenticate</span><br><span class="line">2015-11-23 23:30:15,136 [salt.crypt                               ][ERROR   ][3586] The Salt Master has cached the public key <span class="keyword">for</span> this node, this salt minion will <span class="built_in">wait</span> <span class="keyword">for</span> 10 seconds before attempting to re-authenticate</span><br></pre></td></tr></table></figure>

<p>å¤§æ¦‚çš„æ„æ€å°±æ˜¯ï¼Œminionç«¯æ‹¿åˆ°çš„keyä¸masterç«¯çš„ä¸ç¬¦ï¼ŒéªŒè¯æ— æ³•é€šè¿‡ã€‚<br>è§£å†³æ–¹æ³•æ˜¯åˆ é™¤minionç«¯çš„keyï¼Œå†é‡æ–°ä¸masterè¿›è¡Œè¿æ¥å’Œè®¤è¯ã€‚</p>
<p><strong>minion</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ cat pki/minion/minion_master.pub </span><br><span class="line">-----BEGIN PUBLIC KEY-----</span><br><span class="line">MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAtzq0AjuyQsVEgsx692GN</span><br><span class="line">... ...</span><br><span class="line">7fbuudp4yu5vcYcqksKIFcm0J3E+OR+rx/NUIHt0ZL8HLxcSn4Si/S6dVp/vE7Oc</span><br><span class="line">swIDAQAB</span><br><span class="line">-----END PUBLIC KEY-----</span><br><span class="line">[root@localhost salt]<span class="comment"># rm -fr pki/minion/minion_master.pub</span></span><br><span class="line"></span><br><span class="line">[root@localhost salt]<span class="comment"># service salt-minion restart</span></span><br><span class="line">Stopping salt-minion daemon:                               [  OK  ]</span><br><span class="line">Starting salt-minion daemon:                               [  OK  ]</span><br></pre></td></tr></table></figure>

<p><strong>master</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">salt-key -A</span><br></pre></td></tr></table></figure>

<p><strong>minion</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ cat pki/minion/minion_master.pub </span><br><span class="line">-----BEGIN PUBLIC KEY-----</span><br><span class="line">MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAy46TJvK9BUqjvaYzmt5Q</span><br><span class="line">... ...</span><br><span class="line">ADw0hU6B/A1kRBeUbb6Fy+HljiSjD3O+mhoK7RE8rCnvJCHfuZSX/qMtLEyoh0vN</span><br><span class="line">tQIDAQAB</span><br><span class="line">-----END PUBLIC KEY-----</span><br></pre></td></tr></table></figure>

<p>è‡³æ­¤ï¼Œmasterä¸minionç«¯çš„é€šä¿¡æ­£å¸¸ã€‚</p>
]]></content>
      <categories>
        <category>SaltStack</category>
      </categories>
      <tags>
        <tag>saltstack</tag>
        <tag>error</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonä¸­globæ¨¡å—çš„ä½¿ç”¨</title>
    <url>/2015/11/20/Python%E4%B8%ADglob%E6%A8%A1%E5%9D%97%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
    <content><![CDATA[<blockquote>
<p>æœ¬ç¯‡æ–‡ç« ä»‹ç»Pythonä¸­çš„globæ¨¡å—çš„åŸºæœ¬ä½¿ç”¨ã€‚globæ¨¡å—å¯ä»¥æŒ‰æŒ‡å®šè·¯å¾„å¾—åˆ°æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„æ–‡ä»¶çš„å®Œæ•´è·¯å¾„ã€‚<br>globçš„ä½¿ç”¨ä½“éªŒç±»ä¼¼äºwindowsç³»ç»Ÿä¸­å¸¸ç”¨çš„æœç´¢åŠŸèƒ½ã€‚ä½¿ç”¨é€šé…ç¬¦è¿›è¡Œæœç´¢</p>
</blockquote>
<h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><p>globæ˜¯Pythonä¸­æœ€ç®€å•çš„æ¨¡å—ä¹‹ä¸€ï¼ŒåŠŸèƒ½å¾ˆç®€å•ï¼Œç±»ä¼¼äºwindowsä¸­çš„æŸ¥æ‰¾æ–‡ä»¶ã€‚ä½¿ç”¨å¦‚ä¸‹é€šé…ç¬¦è¿›è¡Œæ“ä½œï¼š</p>
<ul>
<li><code>*</code> æ˜Ÿå·ï¼šè¡¨ç¤ºåŒ¹é…0ä¸ªæˆ–å¤šä¸ªå­—ç¬¦</li>
<li><code>?</code> é—®å·ï¼šè¡¨ç¤ºåŒ¹é…å•ä¸ªå­—ç¬¦</li>
<li><code>[]</code> ä¸­æ‹¬å·ï¼š åŒ¹é…æŒ‡å®šçš„èŒƒå›´ã€‚å¦‚[0-9]</li>
</ul>
<h1 id="glob-glob"><a href="#glob-glob" class="headerlink" title="glob.glob"></a>glob.glob</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> glob</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>files_path = glob.glob(<span class="string">"/tmp/npm*"</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>type(file_paths)</span><br><span class="line">&lt;type <span class="string">'list'</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> f <span class="keyword">in</span> files_path:</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">print</span> f</span><br><span class="line"><span class="meta">... </span></span><br><span class="line">/tmp/npm<span class="number">-7838</span><span class="number">-2</span>b67e940</span><br><span class="line">/tmp/npm<span class="number">-5331</span><span class="number">-1</span>d55c699</span><br><span class="line">/tmp/npm<span class="number">-6600</span><span class="number">-69</span>f3511a</span><br><span class="line">/tmp/npm<span class="number">-5116</span><span class="number">-69883</span>a41</span><br><span class="line">/tmp/npm<span class="number">-5009</span><span class="number">-8</span>ef54da7</span><br><span class="line">/tmp/npm<span class="number">-7792</span>-fec6155a</span><br><span class="line">/tmp/npm<span class="number">-3252</span><span class="number">-71</span>dc8e8e</span><br><span class="line">/tmp/npm<span class="number">-4344</span><span class="number">-50e90470</span></span><br><span class="line">/tmp/npm<span class="number">-6387</span><span class="number">-29</span>ec15b1</span><br><span class="line">/tmp/npm<span class="number">-4617</span>-fff22b70</span><br><span class="line">/tmp/npm<span class="number">-4456</span>-b90bb1d8</span><br><span class="line">/tmp/npm<span class="number">-6480</span>-cce3191b</span><br><span class="line">/tmp/npm<span class="number">-4062</span><span class="number">-60</span>f050ce</span><br><span class="line">/tmp/npm<span class="number">-4712</span><span class="number">-1</span>ca9017c</span><br><span class="line">/tmp/npm<span class="number">-3770</span>-aec98483</span><br><span class="line">/tmp/npm<span class="number">-3913</span><span class="number">-8678</span>ef60</span><br><span class="line">/tmp/npm<span class="number">-5235</span><span class="number">-03941</span>a1e</span><br></pre></td></tr></table></figure>

<p>é‡ç‚¹çœ‹ç±»å‹ï¼ <strong>list !!!</strong> è¿”å›çš„æ˜¯ä¸€ä¸ªåˆ—è¡¨</p>
<h1 id="glob-iglob"><a href="#glob-iglob" class="headerlink" title="glob.iglob"></a>glob.iglob</h1><p>iglobç”¨æ¥è·å–ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ï¼Œå†å¯¹å…¶éå†ã€‚æ•°æ®é‡éå¸¸å¤§çš„æ—¶å€™æ¯”è¾ƒé€‚ç”¨ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> glob</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>files_path = glob.iglob(<span class="string">"/tmp/npm*"</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>type(files_path)</span><br><span class="line">&lt;type <span class="string">'generator'</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> f <span class="keyword">in</span> files_path:</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">print</span> f</span><br><span class="line"><span class="meta">... </span></span><br><span class="line">/tmp/npm<span class="number">-7838</span><span class="number">-2</span>b67e940</span><br><span class="line">/tmp/npm<span class="number">-5331</span><span class="number">-1</span>d55c699</span><br><span class="line">/tmp/npm<span class="number">-6600</span><span class="number">-69</span>f3511a</span><br><span class="line">/tmp/npm<span class="number">-5116</span><span class="number">-69883</span>a41</span><br><span class="line">/tmp/npm<span class="number">-5009</span><span class="number">-8</span>ef54da7</span><br><span class="line">/tmp/npm<span class="number">-7792</span>-fec6155a</span><br><span class="line">/tmp/npm<span class="number">-3252</span><span class="number">-71</span>dc8e8e</span><br><span class="line">/tmp/npm<span class="number">-4344</span><span class="number">-50e90470</span></span><br><span class="line">/tmp/npm<span class="number">-6387</span><span class="number">-29</span>ec15b1</span><br><span class="line">/tmp/npm<span class="number">-4617</span>-fff22b70</span><br><span class="line">/tmp/npm<span class="number">-4456</span>-b90bb1d8</span><br><span class="line">/tmp/npm<span class="number">-6480</span>-cce3191b</span><br><span class="line">/tmp/npm<span class="number">-4062</span><span class="number">-60</span>f050ce</span><br><span class="line">/tmp/npm<span class="number">-4712</span><span class="number">-1</span>ca9017c</span><br><span class="line">/tmp/npm<span class="number">-3770</span>-aec98483</span><br><span class="line">/tmp/npm<span class="number">-3913</span><span class="number">-8678</span>ef60</span><br><span class="line">/tmp/npm<span class="number">-5235</span><span class="number">-03941</span>a1e</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„å®ä¾‹å¯ä»¥çœ‹å‡ºä½¿ç”¨glob.iglobè¿”å›çš„æ˜¯ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ï¼Œå¯ä»¥èŠ‚çœå†…å­˜ã€‚</p>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>glob</tag>
        <tag>PyModule</tag>
      </tags>
  </entry>
  <entry>
    <title>dstatå·¥å…·çš„å®‰è£…å’Œä½¿ç”¨</title>
    <url>/2015/11/19/dstat%E5%B7%A5%E5%85%B7%E7%9A%84%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8/</url>
    <content><![CDATA[<blockquote>
<p>dstat æ˜¯ä¸€æ¬¾æ¯”è¾ƒå…¨é¢çš„æ€§èƒ½ç›‘æ§å·¥å…·ï¼Œæ˜¯æ’æŸ¥æœåŠ¡å™¨è´Ÿè½½å¼‚å¸¸çš„åˆ©å™¨ï¼</p>
</blockquote>
<h1 id="dstatçš„å®‰è£…"><a href="#dstatçš„å®‰è£…" class="headerlink" title="dstatçš„å®‰è£…"></a>dstatçš„å®‰è£…</h1><p>dstatçš„å®‰è£…åœ¨è¿™é‡Œä»‹ç»ä¸‰ç§æ–¹å¼</p>
<ul>
<li><p>ä½¿ç”¨â€ç»¿è‰²ç‰ˆâ€å®‰è£…</p>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget http://dstat.sourcearchive.com/downloads/0.7.0/dstat_0.7.0.orig.tar.gz</span><br><span class="line">tar -xvzf dstat_0.7.0.orig.tar.gz</span><br><span class="line"><span class="built_in">cd</span> dstat-0.7.0.orig/</span><br><span class="line"><span class="comment">#ä½¿ç”¨ä»¥ä¸‹æ–¹å¼å³å¯ä½¿ç”¨dstat</span></span><br><span class="line">./dstat -V</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä½¿ç”¨rpmå®‰è£…</p>
  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget http://mirror.centos.org/centos/6/os/i386/Packages/dstat-0.7.0-2.el6.noarch.rpm</span><br><span class="line">rpm -ivh dstat-0.7.0-2.el6.noarch.rpm</span><br><span class="line"><span class="comment">#ç›´æ¥åœ¨ç³»ç»Ÿä¸­è°ƒç”¨dstatå³å¯</span></span><br><span class="line">dstat -V</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä½¿ç”¨yumå®‰è£…</p>
<p>  <code>yum install dstat</code></p>
</li>
</ul>
<h1 id="dstatçš„ä½¿ç”¨"><a href="#dstatçš„ä½¿ç”¨" class="headerlink" title="dstatçš„ä½¿ç”¨"></a>dstatçš„ä½¿ç”¨</h1><p>dstatå‘½ä»¤æ”¯æŒçš„å‚æ•°è¿™é‡Œå°±ä¸å†èµ˜è¿°å•¦ï¼Œä»¥ä¸‹ä»‹ç»ä¸€ä¸‹ä¸ªäººæ¯”è¾ƒå¸¸ç”¨çš„ä¸¤ç§å‚æ•°</p>
<ol>
<li>dstat -tcdrlmn â€“top-cpu â€“top=mem  #æŸ¥çœ‹æ—¶é—´ã€CPUã€ç£ç›˜è¯»å†™ã€IOã€è´Ÿè½½ã€å†…å­˜ã€ç½‘ç»œã€æœ€é«˜çš„CPUå ç”¨å’Œæœ€é«˜çš„å†…å­˜å ç”¨ <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">----system---- ----total-cpu-usage---- -dsk&#x2F;total- --io&#x2F;total- ---load-avg--- ------memory-usage----- -net&#x2F;total- -most-expensive- --most-expensive-</span><br><span class="line">  date&#x2F;time   |usr sys idl wai hiq siq| read  writ| read  writ| 1m   5m  15m | used  buff  cach  free| recv  send|  cpu process   |  memory process </span><br><span class="line">19-11 21:49:25|  0   0 100   0   0   0|1055B 1810B|0.02  0.07 |0.02 0.01    0| 236M  131M 2961M 4527M|   0     0 |kipmi0       0.0|sshd: root@p4488k</span><br><span class="line">19-11 21:49:26|  0   0 100   0   0   0|   0     0 |   0     0 |0.02 0.01    0| 236M  131M 2961M 4527M| 398B 1532B|                |sshd: root@p4488k</span><br><span class="line">19-11 21:49:27|  0   0 100   0   0   0|   0     0 |   0     0 |0.02 0.01    0| 236M  131M 2961M 4527M| 352B  542B|                |sshd: root@p4488k</span><br><span class="line">19-11 21:49:28|  0   0 100   0   0   0|   0     0 |   0     0 |0.02 0.01    0| 236M  131M 2961M 4527M| 850B  542B|                |sshd: root@p4488k</span><br><span class="line">19-11 21:49:29|  0   0 100   0   0   0|   0     0 |   0     0 |0.02 0.01    0| 236M  131M 2961M 4527M| 256B  542B|                |sshd: root@p4488k</span><br></pre></td></tr></table></figure></li>
<li>dstat -cl -C 0,1,2,3,4,5,6,7 â€“top-cpu   #æŸ¥çœ‹8é¢—æ ¸å¿ƒï¼Œæ¯é¢—æ ¸å¿ƒçš„ä½¿ç”¨æƒ…å†µå’ŒCPUä½¿ç”¨æƒ…å†µ <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">	-------cpu0-usage--------------cpu1-usage--------------cpu2-usage--------------cpu3-usage--------------cpu4-usage--------------cpu5-usage--------------cpu6-usage--------------cpu7-usage------ ---load-avg--- -most-expensive-</span><br><span class="line">usr sys idl wai hiq siq:usr sys idl wai hiq siq:usr sys idl wai hiq siq:usr sys idl wai hiq siq:usr sys idl wai hiq siq:usr sys idl wai hiq siq:usr sys idl wai hiq siq:usr sys idl wai hiq siq| 1m   5m  15m |  cpu process   </span><br><span class="line">  0   0 100   0   0   0:  0   0 100   0   0   0:  0   0 100   0   0   0:  0   0 100   0   0   0:  0   0 100   0   0   0:  0   0 100   0   0   0:  0   0 100   0   0   0:  0   0 100   0   0   0|0.07 0.02    0|kipmi0       0.0</span><br><span class="line">  0   0 100   0   0   0:  0   0 100   0   0   0:  0   1  99   0   0   0:  0   0 100   0   0   0:  0   0 100   0   0   0:  0   0 100   0   0   0:  0   0 100   0   0   0:  0   0 100   0   0   0|0.07 0.02    0|                </span><br><span class="line">  0   0 100   0   0   0:  0   0 100   0   0   0:  1   1  98   0   0   0:  0   0 100   0   0   0:  0   0 100   0   0   0:  0   0 100   0   0   0:  0   0 100   0   0   0:  0   0 100   0   0   0|0.07 0.02    0|kipmi0       0.1</span><br><span class="line">  0   1  99   0   0   0:  0   0 100   0   0   0:  2   0  98   0   0   0:  0   0 100   0   0   0:  0   0 100   0   0   0:  0   0 100   0   0   0:  0   0 100   0   0   0:  0   0 100   0   0   0|0.07 0.02    0|events&#x2F;3     0.1</span><br><span class="line">  0   0 100   0   0   0:  0   0 100   0   0   0:  1   1  98   0   0   0:  0   0 100   0   0   0:  0   0 100   0   0   0:  0   0 100   0   0   0:  0   0 100   0   0   0:  0   0 100   0   0   0|0.07 0.02    0|                </span><br><span class="line">  0   0 100   0   0   0:  0   0 100   0   0   0:  1   0  99   0   0   0:  0   0 100   0   0   0:  0   0 100   0   0   0:  0   0 100   0   0   0:  0   0 100   0   0   0:  0   0 100   0   0   0|0.07 0.02    0|kipmi0       0.1</span><br></pre></td></tr></table></figure>


</li>
</ol>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>dstat</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOSä¸‹Pythonçš„å‡çº§-pipä»¥åŠfabricçš„å®‰è£…</title>
    <url>/2015/11/19/CentOS%E4%B8%8BPython%E7%9A%84%E5%8D%87%E7%BA%A7-pip%E4%BB%A5%E5%8F%8Afabric%E7%9A%84%E5%AE%89%E8%A3%85/</url>
    <content><![CDATA[<blockquote>
<p>æœ¬æ–‡ä»‹ç»åœ¨CentOSç³»ç»Ÿä¸‹å‡çº§Pythonï¼Œå®‰è£…pip, fabricçš„æ“ä½œ</p>
</blockquote>
<h1 id="å®‰è£…Pythonéƒ¨åˆ†"><a href="#å®‰è£…Pythonéƒ¨åˆ†" class="headerlink" title="å®‰è£…Pythonéƒ¨åˆ†"></a>å®‰è£…Pythonéƒ¨åˆ†</h1><ol>
<li>ç¬¬ä¸€æ­¥å½“ç„¶æ˜¯ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„Pythonäº†ï¼<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/src</span><br><span class="line">wget https://www.python.org/ftp/python/2.7.8/Python-2.7.8.tgz</span><br></pre></td></tr></table></figure></li>
<li>è§£å‹ã€ç¼–è¯‘ã€å®‰è£…<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum install gcc</span><br><span class="line">tar -xvzf Python-2.7.8.tgz</span><br><span class="line"><span class="built_in">cd</span> Python2.7.8</span><br><span class="line">./configure --prefix=/usr/<span class="built_in">local</span>/python2.7</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure></li>
<li>åˆ›å»ºé“¾æ¥ä½¿ç³»ç»Ÿé»˜è®¤çš„Pythonå˜æˆPython2.7<br><code>ln -fs /usr/local/python2.7/bin/python2.7 /usr/bin/python</code></li>
<li>æŸ¥çœ‹ä¸€ä¸‹Pythonçš„ç‰ˆæœ¬<br><code>python -V</code></li>
<li>ä¿®æ”¹yumé…ç½®ï¼ˆå¦åˆ™æ›´æ–°äº†é»˜è®¤Pythonåçš„yumæ— æ³•æ­£å¸¸è¿è¡Œï¼‰<br><code>vim /usr/bin/yum</code></li>
</ol>
<p><strong>å°†ç¬¬ä¸€è¡Œ#!/usr/bin/python ä¿®æ”¹ä¸ºåŸæœ‰çš„Python2.6ç‰ˆæœ¬</strong><br><code>#!/usr/bin/python2.6</code><br>â€”&gt; <em>CentOSç³»ç»Ÿå‡çº§PythonæˆåŠŸå®Œæˆ</em></p>
<h1 id="å®‰è£…pipéƒ¨åˆ†"><a href="#å®‰è£…pipéƒ¨åˆ†" class="headerlink" title="å®‰è£…pipéƒ¨åˆ†"></a>å®‰è£…pipéƒ¨åˆ†</h1><ol start="6">
<li>ä¸‹è½½è‡ªåŠ¨å®‰è£…pipçš„è„šæœ¬<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/src/</span><br><span class="line">wget https://raw.github.com/pypa/pip/master/contrib/get-pip.py</span><br></pre></td></tr></table></figure></li>
<li>æ‰§è¡Œå®‰è£…pipçš„å‘½ä»¤<br><code>python get-pip.py</code><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ç¬¬ä¸€æ¬¡æ‰§è¡Œpythonget-pip.pyæŠ¥é”™ï¼š</span><br><span class="line">zipimport.ZipImportError: can&#39;t decompress data; zlib not available</span><br><span class="line"></span><br><span class="line">è§£å†³zlibçš„é—®é¢˜ï¼š</span><br><span class="line"># yum install zlib zlib-devel</span><br><span class="line">ç„¶åé‡æ–°ç¼–è¯‘Pythonï¼ˆ.&#x2F;configure&amp;&amp; make &amp;&amp; make installï¼‰</span><br><span class="line">    </span><br><span class="line">ç¬¬äºŒæ¬¡æ‰§è¡Œpython get-pip.pyæŠ¥é”™ï¼š</span><br><span class="line">ImportError: cannot import name HTTPSHandler</span><br><span class="line"></span><br><span class="line"># yum install openssl openssl-devel</span><br><span class="line">ç„¶åé‡æ–°ç¼–è¯‘Pythonï¼ˆ.&#x2F;configure&amp;&amp; make &amp;&amp; make installï¼‰</span><br></pre></td></tr></table></figure></li>
<li>åˆ›å»ºä½¿ç”¨pipçš„é“¾æ¥<br><code>ln -s /usr/local/python2.7/bin/pip /usr/bin/pip</code></li>
</ol>
<h2 id="å®‰è£…fabricéƒ¨åˆ†"><a href="#å®‰è£…fabricéƒ¨åˆ†" class="headerlink" title="å®‰è£…fabricéƒ¨åˆ†"></a>å®‰è£…fabricéƒ¨åˆ†</h2><ol start="9">
<li>æ‰§è¡Œå®‰è£…fabricçš„å‘½ä»¤<br><code>pip install fabric</code></li>
<li>åˆ›å»ºä½¿ç”¨fabå‘½ä»¤çš„é“¾æ¥<br><code>ln -s /usr/local/python2.7/bin/fab /usr/bin/fab</code></li>
</ol>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>Python</tag>
        <tag>pip</tag>
        <tag>fabric</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOSä¸RHELç³»åˆ—å®‰è£…epelå’Œrpmforceæº</title>
    <url>/2015/11/18/CentOS%E4%B8%8ERHEL%E7%B3%BB%E5%88%97%E5%AE%89%E8%A3%85epel%E5%92%8Crpmforce%E6%BA%90/</url>
    <content><![CDATA[<blockquote>
<p>å¾ˆå¤šæ—¶å€™ï¼Œä½¿ç”¨CentOSè‡ªå¸¦çš„è½¯ä»¶æºå¹¶ä¸èƒ½è§£å†³æ‰€æœ‰çš„è½¯ä»¶ä¾èµ–åŒ…ã€‚è¿™é‡Œä»‹ç»åœ¨CentOSæˆ–RHELç³»åˆ—ä¸­å®‰è£…epelæºå’Œrpmforceæº</p>
</blockquote>
<h1 id="å®‰è£…epelæº"><a href="#å®‰è£…epelæº" class="headerlink" title="å®‰è£…epelæº"></a>å®‰è£…epelæº</h1><hr>
<p>CentOS<code>5</code> Or RHEL<code>5</code> <code>32</code>bit</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rpm -ivh http://mirrors.kernel.org/fedora-epel/5/i386/epel-release-5-4.noarch.rpm</span><br></pre></td></tr></table></figure>

<p>CentOS<code>5</code> Or RHEL<code>5</code> <code>64</code>bit</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rpm -ivh http://mirrors.kernel.org/fedora-epel/5/x86_64/epel-release-5-4.noarch.rpm</span><br></pre></td></tr></table></figure>

<p>CentOS<code>6</code> Or RHEL<code>6</code> <code>32</code>bit</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rpm -ivh http://mirrors.kernel.org/fedora-epel/6/i386/epel-release-6-8.noarch.rpm</span><br></pre></td></tr></table></figure>

<p>CentOS<code>6</code> Or RHEL<code>6</code> <code>64</code>bit</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rpm -ivh http://mirrors.kernel.org/fedora-epel/6/x86_64/epel-release-6-8.noarch.rpm</span><br></pre></td></tr></table></figure>

<p>CentOS<code>7</code> Or RHEL<code>7</code> <code>64</code>bit</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rpm -ivh http://mirrors.kernel.org/fedora-epel/7/x86_64/e/epel-release-7-5.noarch.rpm</span><br></pre></td></tr></table></figure>

<p><strong>æµ‹è¯•</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@rhel65-test-1 ~]<span class="comment"># yum repolist</span></span><br><span class="line">Loaded plugins: fastestmirror, security</span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line"> * base: mirror.bit.edu.cn</span><br><span class="line"> * epel: mirrors.opencas.cn</span><br><span class="line"> * extras: mirrors.yun-idc.com</span><br><span class="line"> * updates: mirrors.yun-idc.com</span><br><span class="line">repo id         repo name                                         status                            </span><br><span class="line">base            CentOS-6 - Base                                   6,575                                               </span><br><span class="line">epel            Extra Packages <span class="keyword">for</span> Enterprise Linux 6 - x86_64    11,780                                              </span><br><span class="line">extras          CentOS-6 - Extras                                 43                                                  </span><br><span class="line">updates         CentOS-6 - Updates                                439                                                 </span><br><span class="line">repolist: 18,837</span><br></pre></td></tr></table></figure>

<p>#å®‰è£…rpmforceæº</p>
<hr>
<p>CentOS<code>5</code> Or RHEL<code>5</code> <code>32</code>bit</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rpm -ivh http://pkgs.repoforge.org/rpmforge-release/rpmforge-release-0.5.3-1.el5.rf.i386.rpm</span><br></pre></td></tr></table></figure>

<p>CentOS<code>5</code> Or RHEL<code>5</code> <code>64</code>bit</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rpm -ivh http://pkgs.repoforge.org/rpmforge-release/rpmforge-release-0.5.3-1.el5.rf.x86_64.rpm</span><br></pre></td></tr></table></figure>

<p>CentOS<code>6</code> Or RHEL<code>6</code> <code>32</code>bit</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rpm -ivh http://pkgs.repoforge.org/rpmforge-release/rpmforge-release-0.5.3-1.el6.rf.i686.rpm</span><br></pre></td></tr></table></figure>

<p>CentOS<code>6</code> Or RHEL<code>6</code> <code>64</code>bit</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rpm -ivh http://pkgs.repoforge.org/rpmforge-release/rpmforge-release-0.5.3-1.el6.rf.x86_64.rpm</span><br></pre></td></tr></table></figure>

<p><strong>æµ‹è¯•</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@rhel65-test-1 ~]<span class="comment"># yum repolist</span></span><br><span class="line">Loaded plugins: fastestmirror, security</span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line"> * base: mirror.bit.edu.cn</span><br><span class="line"> * epel: mirrors.opencas.cn</span><br><span class="line"> * extras: mirrors.yun-idc.com</span><br><span class="line"> * rpmforge: mirrors.neusoft.edu.cn</span><br><span class="line"> * updates: mirrors.yun-idc.com</span><br><span class="line">repo id        repo name                                        status           </span><br><span class="line">base           CentOS-6 - Base                                  6,575            </span><br><span class="line">epel           Extra Packages <span class="keyword">for</span> Enterprise Linux 6 - x86_64   11,780           </span><br><span class="line">extras         CentOS-6 - Extras                                43               </span><br><span class="line">rpmforge       RHEL 6 - RPMforge.net - dag                      4,718            </span><br><span class="line">updates        CentOS-6 - Updates                               439              </span><br><span class="line">repolist: 23,555</span><br></pre></td></tr></table></figure>

<p><strong>é™„å½•ï¼šå†…ç½®æºæ›¿æ¢ä¸º163æº</strong></p>
<ul>
<li><p>æ”¶å½•æ¶æ„</p>
<p>i386<br>x86_64<br>SRPMS</p>
</li>
<li><p>æ”¶å½•ç‰ˆæœ¬</p>
<p>æ‰€æœ‰ç‰ˆæœ¬</p>
</li>
<li><p>æ›´æ–°æ—¶é—´</p>
<p>æ¯4å°æ—¶æ›´æ–°ä¸€æ¬¡</p>
</li>
<li><p>ä½¿ç”¨è¯´æ˜</p>
<p>é¦–å…ˆå¤‡ä»½<code>/etc/yum.repos.d/CentOS-Base.repo</code></p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup</span><br></pre></td></tr></table></figure>
<ul>
<li>ä¸‹è½½å¯¹åº”ç‰ˆæœ¬repoæ–‡ä»¶, æ”¾å…¥/etc/yum.repos.d/(æ“ä½œå‰è¯·åšå¥½ç›¸åº”å¤‡ä»½)</li>
</ul>
<p><a href="http://mirrors.163.com/.help/CentOS7-Base-163.repo" target="_blank" rel="noopener">CentOS7</a><br><a href="http://mirrors.163.com/.help/CentOS6-Base-163.repo" target="_blank" rel="noopener">CentOS6</a><br><a href="http://mirrors.163.com/.help/CentOS5-Base-163.repo" target="_blank" rel="noopener">CentOS5</a></p>
<ul>
<li>è¿è¡Œä»¥ä¸‹å‘½ä»¤ç”Ÿæˆç¼“å­˜</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum clean all</span><br><span class="line">yum makecache</span><br></pre></td></tr></table></figure>
<p>ç›¸å…³è¿æ¥ï¼š<a href="http://mirrors.163.com/.help/centos.html" target="_blank" rel="noopener">163yumæºå®˜æ–¹å¸®åŠ©</a></p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>epel</tag>
        <tag>rpmforce</tag>
        <tag>163yum</tag>
      </tags>
  </entry>
  <entry>
    <title>vimè·³åˆ°æœ€åä¸€è¡Œå’Œè·³åˆ°é¦–è¡Œ</title>
    <url>/2015/11/18/vim%E8%B7%B3%E5%88%B0%E6%9C%80%E5%90%8E%E4%B8%80%E8%A1%8C%E5%92%8C%E8%B7%B3%E5%88%B0%E9%A6%96%E8%A1%8C/</url>
    <content><![CDATA[<blockquote>
<p>åœ¨vimæˆ–viçš„ç¼–è¾‘å™¨ä¸­ï¼Œç»å¸¸éœ€è¦è·³è½¬åˆ°æ–‡ä»¶çš„æœ€åä¸€è¡Œï¼Œæˆ–è·³è½¬è‡³æ–‡ä»¶é¦–è¡Œçš„æƒ…å†µã€‚ä¸‹é¢ä»‹ç»ä¸¤ç§æ–¹å¼å®ç°è·³è½¬</p>
</blockquote>
<p><strong>ç¬¬ä¸€ç§æ–¹å¼</strong></p>
<hr>
<ul>
<li>:$ è·³è½¬åˆ°æœ€åä¸€è¡Œ</li>
<li>:1 è·³è½¬åˆ°ç¬¬ä¸€è¡Œ</li>
</ul>
<p><strong>ç¬¬äºŒç§æ–¹å¼</strong></p>
<hr>
<ul>
<li>shift+g è·³è½¬åˆ°æœ€åä¸€è¡Œ</li>
<li>gg è·³è½¬åˆ°ç¬¬ä¸€è¡Œ</li>
</ul>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>vim</tag>
      </tags>
  </entry>
  <entry>
    <title>ä½¿ç”¨foreverè®©node.jsæŒä¹…è¿è¡Œ</title>
    <url>/2015/11/18/%E4%BD%BF%E7%94%A8forever%E8%AE%A9node-js%E6%8C%81%E4%B9%85%E8%BF%90%E8%A1%8C/</url>
    <content><![CDATA[<blockquote>
<p>nodejsä¸€èˆ¬æ˜¯å½“æˆä¸€æ¡å‘½ä»¤æ‰§è¡Œçš„ï¼Œå½“ç”¨æˆ·æ–­å¼€sessionï¼Œnodejsä¹Ÿå°±åœæ­¢äº†è¿è¡Œã€‚å¦‚ä½•è®©nodejsæŒç»­åœ¨åå°è¿è¡Œå‘¢ï¼Ÿ</p>
</blockquote>
<p>#æœ€ç®€å•ç²—æš´çš„æ–¹æ³•æ˜¯ä½¿ç”¨Linuxæœ¬èº«åå°æ‰§è¡Œçš„ç‰¹æ€§</p>
<hr>
<p>ä½¿ç”¨&amp;ç¬¦å·åå°æ‰§è¡Œï¼Œå¹¶åˆ©ç”¨nohupå‘½ä»¤å®ç°è¿›ç¨‹ç¦æ­¢æŒ‚èµ·</p>
<p><code>nohup node app.js &amp;</code></p>
<p>#ä½¿ç”¨foreverè®©node.jsæŒä¹…è¿è¡Œ</p>
<hr>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install forever -g   <span class="comment">#å®‰è£…</span></span><br><span class="line">forever start app.js  <span class="comment">#å¯åŠ¨åº”ç”¨</span></span><br><span class="line">forever stop app.js  <span class="comment">#å…³é—­åº”ç”¨</span></span><br><span class="line">forever restartall  <span class="comment">#é‡å¯æ‰€æœ‰åº”ç”¨</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#è¾“å‡ºæ—¥å¿—å’Œé”™è¯¯</span></span><br><span class="line">forever start -l forever.log -o out.log -e err.log app.js   </span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®šforeverä¿¡æ¯è¾“å‡ºæ–‡ä»¶ï¼Œå½“ç„¶ï¼Œé»˜è®¤å®ƒä¼šæ”¾åˆ°~/.forever/forever.log</span></span><br><span class="line">forever start -l forever.log app.js  </span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®šapp.jsä¸­çš„æ—¥å¿—ä¿¡æ¯å’Œé”™è¯¯æ—¥å¿—è¾“å‡ºæ–‡ä»¶ï¼Œ  </span></span><br><span class="line"><span class="comment"># -o å°±æ˜¯console.logè¾“å‡ºçš„ä¿¡æ¯ï¼Œ-e å°±æ˜¯console.errorè¾“å‡ºçš„ä¿¡æ¯</span></span><br><span class="line">forever start -o out.log -e err.log app.js </span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿½åŠ æ—¥å¿—ï¼Œforeveré»˜è®¤æ˜¯ä¸èƒ½è¦†ç›–ä¸Šæ¬¡çš„å¯åŠ¨æ—¥å¿—ï¼Œ  </span></span><br><span class="line"><span class="comment"># æ‰€ä»¥å¦‚æœç¬¬äºŒæ¬¡å¯åŠ¨ä¸åŠ -aï¼Œåˆ™ä¼šä¸è®©è¿è¡Œ  </span></span><br><span class="line">forever start -l forever.log -a app.js</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç›‘å¬å½“å‰æ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰æ–‡ä»¶æ”¹åŠ¨ï¼ˆä¸å¤ªå»ºè®®è¿™æ ·ï¼‰  </span></span><br><span class="line">forever start -w app.js  </span><br><span class="line"></span><br><span class="line"><span class="comment"># æ˜¾ç¤ºæ‰€æœ‰è¿è¡Œçš„æœåŠ¡ </span></span><br><span class="line">forever list  </span><br><span class="line"></span><br><span class="line"><span class="comment">######åœæ­¢æ“ä½œ</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åœæ­¢æ‰€æœ‰è¿è¡Œçš„node App  </span></span><br><span class="line">forever stopall  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># åœæ­¢å…¶ä¸­ä¸€ä¸ªnode App  </span></span><br><span class="line">forever stop app.js  </span><br><span class="line"></span><br><span class="line"><span class="comment"># å½“ç„¶è¿˜å¯ä»¥è¿™æ ·  </span></span><br><span class="line"><span class="comment"># forever list æ‰¾åˆ°å¯¹åº”çš„idï¼Œç„¶åï¼š  </span></span><br><span class="line">forever stop [id]</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¼€å‘ç¯å¢ƒä¸‹  </span></span><br><span class="line">NODE_ENV=development forever start -l forever.log -e err.log -a app.js  </span><br><span class="line"><span class="comment"># çº¿ä¸Šç¯å¢ƒä¸‹  </span></span><br><span class="line">NODE_ENV=production forever start -l ~/.forever/forever.log -e ~/.forever/err.log -w -a app.js</span><br><span class="line"><span class="comment">#ä¸Šé¢åŠ ä¸ŠNODE_ENVä¸ºäº†è®©app.jsè¾¨è®¤å½“å‰æ˜¯ä»€ä¹ˆç¯å¢ƒç”¨çš„</span></span><br></pre></td></tr></table></figure>

<p>The End</p>
<hr>
<ul>
<li>å‚è€ƒ1: <a href="https://cnodejs.org/topic/5021c2cff767cc9a51e684e3" target="_blank" rel="noopener">https://cnodejs.org/topic/5021c2cff767cc9a51e684e3</a></li>
<li>å‚è€ƒ2: <a href="http://tcrct.iteye.com/blog/2043644" target="_blank" rel="noopener">http://tcrct.iteye.com/blog/2043644</a></li>
<li>forever github: <a href="https://github.com/foreverjs/forever" target="_blank" rel="noopener">https://github.com/foreverjs/forever</a></li>
</ul>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>Node.js</tag>
        <tag>forever</tag>
      </tags>
  </entry>
  <entry>
    <title>yum provides åæŸ¥è¯¢</title>
    <url>/2015/11/18/yum-provides-%E5%8F%8D%E6%9F%A5%E8%AF%A2/</url>
    <content><![CDATA[<blockquote>
<p>åœ¨æ—¥å¸¸è¿ç»´å·¥ä½œä¸­ï¼Œå¸¸å¸¸é‡åˆ°éœ€è¦å®‰è£…ä¸€äº›ä¾èµ–çš„åº“æ–‡ä»¶ã€‚åœ¨å®é™…å·¥ä½œä¸­ï¼Œä¸€æ¬¡åœ¨Linuxä¸­å®‰è£…SQL Server ODBCé©±åŠ¨æ—¶ï¼Œé‡åˆ°ä¸€ä¸ªä¾èµ–çš„åº“æ–‡ä»¶éœ€è¦å®‰è£…ï¼ˆlibcrypto.so.6ï¼‰</p>
</blockquote>
<p>å¯æ˜¯ä½¿ç”¨yum provideså‘½ä»¤æŸ¥è¯¢<code>libcrypto.so.6</code>æ–‡ä»¶åŒ…å«åœ¨å“ªä¸ªè½¯ä»¶åŒ…ä¸­ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@manage final]<span class="comment"># yum provides libcrypto.so.6</span></span><br><span class="line">å·²åŠ è½½æ’ä»¶ï¼šdellsysid, fastestmirror, refresh-packagekit, security</span><br><span class="line">Repository base is listed more than once <span class="keyword">in</span> the configuration</span><br><span class="line">Repository updates is listed more than once <span class="keyword">in</span> the configuration</span><br><span class="line">Repository extras is listed more than once <span class="keyword">in</span> the configuration</span><br><span class="line">Repository centosplus is listed more than once <span class="keyword">in</span> the configuration</span><br><span class="line">Repository contrib is listed more than once <span class="keyword">in</span> the configuration</span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line"> * base: mirrors.btte.net</span><br><span class="line"> * epel: mirrors.opencas.cn</span><br><span class="line"> * extras: mirrors.btte.net</span><br><span class="line"> * rpmforge: ftp.riken.jp</span><br><span class="line"> * updates: mirrors.yun-idc.com</span><br><span class="line">openssl098e-0.9.8e-18.el6_5.2.i686 : A compatibility version of a general cryptography and TLS library</span><br><span class="line">Repo        : base</span><br><span class="line">åŒ¹é…æ¥è‡ªäº:</span><br><span class="line">Other       : libcrypto.so.6</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡æŸ¥è¯¢å¯ä»¥çœ‹å‡ºï¼Œ<code>libcrypto.so.6</code>æ–‡ä»¶åŒ…å«åœ¨<code>openssl098e</code>çš„è½¯ä»¶åŒ…ä¸­ï¼Œæ¥ä¸‹æ¥åªéœ€è¦ä½¿ç”¨yumå®‰è£…openssl098eå³å¯è§£å†³ä¾èµ–é—®é¢˜</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>yum</tag>
      </tags>
  </entry>
  <entry>
    <title>Liunxä¸‹æ›´æ”¹MySQLç”¨æˆ·å¯†ç </title>
    <url>/2015/11/18/Liunx%E4%B8%8B%E6%9B%B4%E6%94%B9MySQL%E7%94%A8%E6%88%B7%E5%AF%86%E7%A0%81/</url>
    <content><![CDATA[<h1 id="æ–¹æ³•1ï¼š-ç”¨SET-PASSWORDå‘½ä»¤"><a href="#æ–¹æ³•1ï¼š-ç”¨SET-PASSWORDå‘½ä»¤" class="headerlink" title="æ–¹æ³•1ï¼š ç”¨SET PASSWORDå‘½ä»¤"></a>æ–¹æ³•1ï¼š ç”¨SET PASSWORDå‘½ä»¤</h1><hr>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mysql -u root</span><br><span class="line">mysql&gt; SET PASSWORD FOR <span class="string">'root'</span>@<span class="string">'localhost'</span> = PASSWORD(<span class="string">'newpass'</span>);</span><br></pre></td></tr></table></figure>

<h1 id="æ–¹æ³•2ï¼šç”¨mysqladmin"><a href="#æ–¹æ³•2ï¼šç”¨mysqladmin" class="headerlink" title="æ–¹æ³•2ï¼šç”¨mysqladmin"></a>æ–¹æ³•2ï¼šç”¨mysqladmin</h1><hr>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mysqladmin -u root password <span class="string">"newpass"</span></span><br><span class="line"><span class="comment">#å¦‚æœrootå·²ç»è®¾ç½®è¿‡å¯†ç ï¼Œé‡‡ç”¨å¦‚ä¸‹æ–¹æ³•</span></span><br><span class="line">mysqladmin -u root password oldpass <span class="string">"newpass"</span></span><br></pre></td></tr></table></figure>

<h1 id="æ–¹æ³•3ï¼š-ç”¨UPDATEç›´æ¥ç¼–è¾‘userè¡¨"><a href="#æ–¹æ³•3ï¼š-ç”¨UPDATEç›´æ¥ç¼–è¾‘userè¡¨" class="headerlink" title="æ–¹æ³•3ï¼š ç”¨UPDATEç›´æ¥ç¼–è¾‘userè¡¨"></a>æ–¹æ³•3ï¼š ç”¨UPDATEç›´æ¥ç¼–è¾‘userè¡¨</h1><hr>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mysql -u root</span><br><span class="line">mysql&gt; use mysql;</span><br><span class="line">mysql&gt; UPDATE user SET Password = PASSWORD(<span class="string">'newpass'</span>) WHERE user = <span class="string">'root'</span>;</span><br><span class="line">mysql&gt; FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure>

<h1 id="åœ¨ä¸¢å¤±rootå¯†ç çš„æ—¶å€™ï¼Œå¯ä»¥è¿™æ ·"><a href="#åœ¨ä¸¢å¤±rootå¯†ç çš„æ—¶å€™ï¼Œå¯ä»¥è¿™æ ·" class="headerlink" title="åœ¨ä¸¢å¤±rootå¯†ç çš„æ—¶å€™ï¼Œå¯ä»¥è¿™æ ·"></a>åœ¨ä¸¢å¤±rootå¯†ç çš„æ—¶å€™ï¼Œå¯ä»¥è¿™æ ·</h1><hr>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mysqld_safe --skip-grant-tables&amp;</span><br><span class="line">mysql -u root mysql</span><br><span class="line">mysql&gt; UPDATE user SET password=PASSWORD(<span class="string">"new password"</span>) WHERE user=<span class="string">'root'</span>;</span><br><span class="line">mysql&gt; FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure>

<p>The End</p>
<hr>
<ul>
<li>è½¬è½½è‡ªç™¾åº¦ç»éªŒï¼š<a href="http://jingyan.baidu.com/article/0320e2c198ad5f1b87507bc8.html" target="_blank" rel="noopener">MySQLä¿®æ”¹rootå¯†ç çš„å¤šç§æ–¹æ³•</a></li>
</ul>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>MySQL</tag>
        <tag>ä¿®æ”¹å¯†ç </tag>
      </tags>
  </entry>
  <entry>
    <title>Linuxä¸‹å‡çº§Pythonç‰ˆæœ¬</title>
    <url>/2015/11/18/Linux%E4%B8%8B%E5%8D%87%E7%BA%A7Python%E7%89%88%E6%9C%AC/</url>
    <content><![CDATA[<h3 id="1-ç¬¬ä¸€æ­¥å½“ç„¶æ˜¯ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„Pythonäº†ï¼"><a href="#1-ç¬¬ä¸€æ­¥å½“ç„¶æ˜¯ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„Pythonäº†ï¼" class="headerlink" title="1.ç¬¬ä¸€æ­¥å½“ç„¶æ˜¯ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„Pythonäº†ï¼"></a>1.ç¬¬ä¸€æ­¥å½“ç„¶æ˜¯ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„Pythonäº†ï¼</h3><hr>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/src</span><br><span class="line">wget https://www.python.org/ftp/python/2.7.10/Python-2.7.10.tgz</span><br></pre></td></tr></table></figure>

<h3 id="2-è§£å‹ã€ç¼–è¯‘ã€å®‰è£…"><a href="#2-è§£å‹ã€ç¼–è¯‘ã€å®‰è£…" class="headerlink" title="2.è§£å‹ã€ç¼–è¯‘ã€å®‰è£…"></a>2.è§£å‹ã€ç¼–è¯‘ã€å®‰è£…</h3><hr>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum install gcc</span><br><span class="line">tar -xvzf Python-2.7.10.tgz</span><br><span class="line"><span class="built_in">cd</span> Python-2.7.10</span><br><span class="line">./configure --prefix=/usr/<span class="built_in">local</span>/python2.7</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>

<h3 id="3-åˆ›å»ºé“¾æ¥ä½¿ç³»ç»Ÿé»˜è®¤çš„Pythonå˜æˆPython2-7"><a href="#3-åˆ›å»ºé“¾æ¥ä½¿ç³»ç»Ÿé»˜è®¤çš„Pythonå˜æˆPython2-7" class="headerlink" title="3.åˆ›å»ºé“¾æ¥ä½¿ç³»ç»Ÿé»˜è®¤çš„Pythonå˜æˆPython2.7"></a>3.åˆ›å»ºé“¾æ¥ä½¿ç³»ç»Ÿé»˜è®¤çš„Pythonå˜æˆPython2.7</h3><hr>
<p> <code>ln -fs /usr/local/python2.7/bin/python2.7 /usr/bin/python</code></p>
<h3 id="4-æŸ¥çœ‹ä¸€ä¸‹Pythonçš„ç‰ˆæœ¬"><a href="#4-æŸ¥çœ‹ä¸€ä¸‹Pythonçš„ç‰ˆæœ¬" class="headerlink" title="4.æŸ¥çœ‹ä¸€ä¸‹Pythonçš„ç‰ˆæœ¬"></a>4.æŸ¥çœ‹ä¸€ä¸‹Pythonçš„ç‰ˆæœ¬</h3><hr>
<p> <code>python -V</code></p>
<h3 id="5-ä¿®æ”¹yumé…ç½®ï¼ˆå¦åˆ™æ›´æ–°äº†é»˜è®¤Pythonåçš„yumæ— æ³•æ­£å¸¸è¿è¡Œï¼‰"><a href="#5-ä¿®æ”¹yumé…ç½®ï¼ˆå¦åˆ™æ›´æ–°äº†é»˜è®¤Pythonåçš„yumæ— æ³•æ­£å¸¸è¿è¡Œï¼‰" class="headerlink" title="5.ä¿®æ”¹yumé…ç½®ï¼ˆå¦åˆ™æ›´æ–°äº†é»˜è®¤Pythonåçš„yumæ— æ³•æ­£å¸¸è¿è¡Œï¼‰"></a>5.ä¿®æ”¹yumé…ç½®ï¼ˆå¦åˆ™æ›´æ–°äº†é»˜è®¤Pythonåçš„yumæ— æ³•æ­£å¸¸è¿è¡Œï¼‰</h3><hr>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vim /usr/bin/yum</span><br><span class="line">å°†ç¬¬ä¸€è¡Œ<span class="comment">#!/usr/bin/python ä¿®æ”¹ä¸ºåŸæœ‰çš„Python2.6ç‰ˆæœ¬ #!/usr/bin/python2.6</span></span><br><span class="line">CentOSç³»ç»Ÿå‡çº§PythonæˆåŠŸå®Œæˆ</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>éƒ¨ç½²ä¸“ä¸šçš„å¼€æºäº‘å­˜å‚¨å¹³å°-Seafile</title>
    <url>/2015/11/18/%E9%83%A8%E7%BD%B2%E4%B8%93%E4%B8%9A%E7%9A%84%E5%BC%80%E6%BA%90%E4%BA%91%E5%AD%98%E5%82%A8%E5%B9%B3%E5%8F%B0-Seafile/</url>
    <content><![CDATA[<blockquote>
<p>æœ¬æ–‡ä»‹ç»åœ¨CentOS6ç³»åˆ—ä¸‹ä½¿ç”¨MySQLéƒ¨ç½²SeafileæœåŠ¡å™¨</p>
</blockquote>
<p>#1.ä¸‹è½½æœåŠ¡å™¨ç‰ˆæœ¬çš„å®‰è£…åŒ…</p>
<hr>
<ul>
<li><p>å¯ä»¥åœ¨è¿™ä¸ªé¡µé¢ä¸­ä¸‹è½½æœ€æ–°çš„æœåŠ¡å™¨å®‰è£…åŒ… <a href="https://www.seafile.com/download/" target="_blank" rel="noopener">Seafileå®˜æ–¹ä¸‹è½½é¡µé¢</a></p>
</li>
<li><p>ä¹Ÿå¯ä»¥ä½¿ç”¨<code>wget</code>å‘½ä»¤ç›´æ¥ä¸‹è½½ï¼š</p>
</li>
</ul>
<p><code>wget http://download-cn.seafile.com/seafile-server_4.4.1_x86-64.tar.gz</code></p>
<p>#2.åˆ›å»ºæœåŠ¡æ ¹ç›®å½•</p>
<hr>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mkdir -p /FileCloud/installed</span><br><span class="line"><span class="built_in">cd</span> /FileCloud/installed</span><br><span class="line">wget http://download-cn.seafile.com/seafile-server_4.4.1_x86-64.tar.gz</span><br><span class="line">tar -xvzf seafile-server_4.4.1_x86-64.tar.gz</span><br></pre></td></tr></table></figure>

<p>#3.ä¾èµ–åŒ…</p>
<hr>
<p>##3.1å‡çº§Python</p>
<p>é»˜è®¤çš„Pythonä¸º2.6.6ç‰ˆæœ¬ï¼Œè¿™é‡Œå°†å…¶å‡çº§è‡³2.7ä»¥ä¸Šç‰ˆæœ¬</p>
<p><a href="http://docs.20150509.cn/2015/10/08/linuxxia-sheng-ji-pythonban-ben/" target="_blank" rel="noopener">å‡çº§Pythonè¿‡ç¨‹è¯¦è§æ­¤ç¯‡æ–‡æ¡£</a></p>
<p>##3.2 ä¾èµ–åŒ…</p>
<p>å®‰è£…MySQLæœåŠ¡å¹¶å¼€æœºè‡ªå¯åŠ¨</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum install mysql-server</span><br><span class="line">service mysqld start</span><br><span class="line">chkconfig mysqld on</span><br></pre></td></tr></table></figure>

<p>ä¸ºMySQLä¸­çš„çš„rootç”¨æˆ·è®¾ç½®å¯†ç </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mysql -u root</span><br><span class="line">mysql&gt; SET PASSWORD FOR <span class="string">'root'</span>@<span class="string">'localhost'</span> = PASSWORD(<span class="string">'password'</span>);</span><br><span class="line">mysql&gt; quit</span><br></pre></td></tr></table></figure>

<p>å…¶ä»–ä¾èµ–åŒ…çš„å®‰è£…</p>
<p><code>yum install MySQL-python python-setuptools python-imaging</code></p>
<p>#4.å®‰è£…Seafileç»„ä»¶</p>
<hr>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /FileCloud/installed/seafile-server-4.4.1</span><br><span class="line">./setup-seafile-mysql.sh</span><br></pre></td></tr></table></figure>

<p>è¿›å…¥åˆ°æ–‡æœ¬äº¤äº’ç•Œé¢ï¼Œå¦‚ä¸‹ä»…ä¾›å‚è€ƒï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Press ENTER to <span class="built_in">continue</span></span><br><span class="line">Enter</span><br><span class="line"></span><br><span class="line">What is the name of the server? It will be displayed on the client.</span><br><span class="line">3 - 15 letters or digits</span><br><span class="line">[ server name ] xxFileCloud</span><br><span class="line"></span><br><span class="line">What is the ip or domain of the server?</span><br><span class="line">For example: www.mycompany.com, 192.168.1.101</span><br><span class="line">[ This server<span class="string">'s ip or domain ] 192.168.3.131</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Where do you want to put your seafile data?</span></span><br><span class="line"><span class="string">Please use a volume with enough free space</span></span><br><span class="line"><span class="string">[ default "/FileCloud/installed/seafile-data" ] Enter</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Which port do you want to use for the seafile fileserver?</span></span><br><span class="line"><span class="string">[ default "8082" ] Enter</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">------------------------------------------------------------------</span></span><br><span class="line"><span class="string">Please choose a way to initialize seafile databases:</span></span><br><span class="line"><span class="string">------------------------------------------------------------------</span></span><br><span class="line"><span class="string">[1] Create new ccnet/seafile/seahub databases</span></span><br><span class="line"><span class="string">[2] Use existing ccnet/seafile/seahub databases</span></span><br><span class="line"><span class="string">[ 1 or 2 ] 1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">What is the host of mysql server?</span></span><br><span class="line"><span class="string">[ default "localhost" ] Enter</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">What is the port of mysql server?</span></span><br><span class="line"><span class="string">[ default "3306" ] Enter</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">What is the password of the mysql root user?</span></span><br><span class="line"><span class="string">[ root password ] "root'</span>s password of mysql<span class="string">"</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">verifying password of user root ...  done</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Enter the name for mysql user of seafile. It would be created if not exists.</span></span><br><span class="line"><span class="string">[ default "</span>root<span class="string">" ] `Enter`</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Enter the database name for ccnet-server:</span></span><br><span class="line"><span class="string">[ default "</span>ccnet-db<span class="string">" ] `Enter`</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Enter the database name for seafile-server:</span></span><br><span class="line"><span class="string">[ default "</span>seafile-db<span class="string">" ] `Enter`</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Enter the database name for seahub:</span></span><br><span class="line"><span class="string">[ default "</span>seahub-db<span class="string">" ] `Enter`</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">---------------------------------</span></span><br><span class="line"><span class="string">This is your configuration</span></span><br><span class="line"><span class="string">---------------------------------</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    server name:            xxFileCloud</span></span><br><span class="line"><span class="string">    server ip/domain:       192.168.3.131</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    seafile data dir:       /FileCloud/installed/seafile-data</span></span><br><span class="line"><span class="string">    fileserver port:        8082</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    database:               create new</span></span><br><span class="line"><span class="string">    ccnet database:         ccnet-db</span></span><br><span class="line"><span class="string">    seafile database:       seafile-db</span></span><br><span class="line"><span class="string">    seahub database:        seahub-db</span></span><br><span class="line"><span class="string">    database user:          root</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">------------------------------------------------------------------</span></span><br><span class="line"><span class="string">Press ENTER to continue, or Ctrl-C to abort</span></span><br><span class="line"><span class="string">------------------------------------------------------------------</span></span><br><span class="line"><span class="string">Generating ccnet configuration ...</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">done</span></span><br><span class="line"><span class="string">Successly create configuration dir /kfc/installed/ccnet.</span></span><br><span class="line"><span class="string">Generating seafile configuration ...</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Done.</span></span><br><span class="line"><span class="string">done</span></span><br><span class="line"><span class="string">Generating seahub configuration ...</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">-------------------------------------------------------------</span></span><br><span class="line"><span class="string">Now creating seahub database tables ...</span></span><br><span class="line"><span class="string">-------------------------------------------------------------</span></span><br><span class="line"><span class="string">creating seafile-server-latest symbolic link ...  done</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">------------------------------------------------------------------</span></span><br><span class="line"><span class="string">Your seafile server configuration has been finished successfully.</span></span><br><span class="line"><span class="string">-------------------------------------------------------------------</span></span><br><span class="line"><span class="string">run seafile server:     ./seafile.sh &#123; start | stop | restart &#125;</span></span><br><span class="line"><span class="string">run seahub  server:     ./seahub.sh  &#123; start &lt;port&gt; | stop | restart &lt;port&gt; &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">-------------------------------------------------------------------</span></span><br><span class="line"><span class="string">If you are behind a firewall, remember to allow input/output of these tcp ports:</span></span><br><span class="line"><span class="string">--------------------------------------------------------------------</span></span><br><span class="line"><span class="string">port of seafile fileserver:   8082</span></span><br><span class="line"><span class="string">port of seahub:               8000</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">When problems occur, Refer to</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        https://github.com/haiwen/seafile/wiki</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">for information.</span></span><br></pre></td></tr></table></figure>

<p>#å¼€å¯SeafileæœåŠ¡</p>
<hr>
<p>##è®¾ç½®æ‰“å¼€æ–‡ä»¶æè¿°ç¬¦çš„æœ€å¤§æ•°é‡</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">ulimit</span> -n 65535</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"ulimit -n 65535"</span> &gt;&gt; /etc/rc.local</span><br></pre></td></tr></table></figure>

<p>##å¯åŠ¨ Seafile æœåŠ¡å™¨å’Œ Seahub ç½‘ç«™</p>
<ul>
<li><p>å¯åŠ¨SeafileæœåŠ¡</p>
<p><code>cd /FileCloud/installed/seafile-server-4.4.1 &amp;&amp; ./seafile.sh start</code></p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost seafile-server-4.4.1]<span class="comment"># ./seafile.sh start</span></span><br><span class="line"></span><br><span class="line">Starting seafile server, please <span class="built_in">wait</span> ...</span><br><span class="line">Seafile server started</span><br><span class="line"></span><br><span class="line">Done.</span><br></pre></td></tr></table></figure>

<ul>
<li><p>å¯åŠ¨SeahubæœåŠ¡(ä¸åŠ ç«¯å£å·é»˜è®¤è¿è¡Œåœ¨8000ç«¯å£ï¼Œå¯æ”¹é…ç½®æ–‡ä»¶)</p>
<p><code>cd /FileCloud/installed/seafile-server-4.4.1 &amp;&amp; ./seahub.sh start 80</code></p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@kfc seafile-server-4.4.1]<span class="comment"># ./seahub.sh start 80</span></span><br><span class="line"></span><br><span class="line">LC_ALL is not <span class="built_in">set</span> <span class="keyword">in</span> ENV, <span class="built_in">set</span> to en_US.UTF-8</span><br><span class="line">Starting seahub at port 80 ...</span><br><span class="line"></span><br><span class="line">----------------------------------------</span><br><span class="line">It<span class="string">'s the first time you start the seafile server. Now let'</span>s create the admin account</span><br><span class="line">----------------------------------------</span><br><span class="line"></span><br><span class="line">What is the email <span class="keyword">for</span> the admin account?</span><br><span class="line">[ admin email ] polarsnow@20150509.cn  <span class="comment">#è¿™é‡Œçš„è´¦å·æœ€å¥½å¡«å†™èƒ½æ”¶åˆ°é‚®ä»¶çš„é‚®ç®±ç”¨äºå¿˜è®°å¯†ç åæ‰¾å›å¯†ç ä½¿ç”¨</span></span><br><span class="line"></span><br><span class="line">What is the password <span class="keyword">for</span> the admin account?  <span class="comment">#è¿™é‡Œçš„å¯†ç æ˜¯è‡ªå®šä¹‰çš„Seafileçš„å¯†ç </span></span><br><span class="line">[ admin password ] </span><br><span class="line"></span><br><span class="line">Enter the password again:</span><br><span class="line">[ admin password again ] </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">----------------------------------------</span><br><span class="line">Successfully created seafile admin</span><br><span class="line">----------------------------------------</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Seahub is started</span><br><span class="line"></span><br><span class="line">Done.</span><br></pre></td></tr></table></figure>

<blockquote>
<p>PSï¼šä½ ç¬¬ä¸€æ¬¡å¯åŠ¨ seahub æ—¶ï¼Œseahub.sh è„šæœ¬ä¼šæç¤ºä½ åˆ›å»ºä¸€ä¸ª seafile ç®¡ç†å‘˜å¸å·</p>
</blockquote>
<p>#è®¿é—®äº‘å­˜å‚¨é¡µé¢</p>
<hr>
<p>ä½¿ç”¨æµè§ˆå™¨æ‰“å¼€<code>http://192.168.3.131</code>è¾“å…¥åˆšåˆšåˆ›å»ºçš„ç”¨æˆ·åçš„å¯†ç å³å¯ã€‚</p>
<p>#Seafileçš„å…³é—­å’Œé‡å¯</p>
<hr>
<p>##å…³é—­</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./seahub.sh stop <span class="comment"># åœæ­¢ Seahub</span></span><br><span class="line">./seafile.sh stop <span class="comment"># åœæ­¢ Seafile è¿›ç¨‹</span></span><br></pre></td></tr></table></figure>

<p>##é‡å¯</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./seafile.sh restart <span class="comment"># åœæ­¢å½“å‰çš„ Seafile è¿›ç¨‹ï¼Œç„¶åé‡å¯ Seafile</span></span><br><span class="line">./seahub.sh restart  <span class="comment"># åœæ­¢å½“å‰çš„ Seahub è¿›ç¨‹ï¼Œå¹¶åœ¨ 8000 ç«¯å£é‡æ–°å¯åŠ¨ Seahub</span></span><br></pre></td></tr></table></figure>

<p>#åœ¨å¦ä¸€ç«¯å£ä¸Šè¿è¡Œ Seahub</p>
<hr>
<blockquote>
<p>å¦‚æœä½ ä¸æƒ³åœ¨é»˜è®¤çš„ 8000 ç«¯å£ä¸Šè¿è¡Œ Seahub, è€Œæ˜¯æƒ³è‡ªå®šä¹‰ç«¯å£ï¼ˆæ¯”å¦‚8001ï¼‰ä¸­è¿è¡Œï¼Œè¯·æŒ‰ä»¥ä¸‹æ­¥éª¤æ“ä½œ:</p>
</blockquote>
<ul>
<li>å…³é—­ Seafile æœåŠ¡å™¨</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./seahub.sh stop <span class="comment"># åœæ­¢ Seafile è¿›ç¨‹</span></span><br><span class="line">./seafile.sh stop <span class="comment"># åœæ­¢ Seahub</span></span><br><span class="line">æ›´æ”¹haiwen/ccnet/ccnet.confæ–‡ä»¶ä¸­SERVICE_URL çš„å€¼(å‡è®¾ä½ çš„ ip æˆ–è€…åŸŸåæ—¶192.168.1.100), å¦‚ä¸‹:</span><br><span class="line">SERVICE_URL = http://192.168.1.100:8001</span><br></pre></td></tr></table></figure>

<ul>
<li>é‡å¯ Seafile æœåŠ¡å™¨</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./seafile.sh start <span class="comment"># å¯åŠ¨ Seafile æœåŠ¡</span></span><br><span class="line">./seahub.sh start 8001 <span class="comment"># å¯åŠ¨ Seahub ç½‘ç«™ ï¼ˆè¿è¡Œåœ¨8001ç«¯å£ä¸Šï¼‰</span></span><br></pre></td></tr></table></figure>

<p>#å¦‚æœåœæ­¢/é‡å¯çš„è„šæœ¬è¿è¡Œå¤±è´¥</p>
<hr>
<blockquote>
<p>å¤§å¤šæ•°æƒ…å†µä¸‹ seafile.sh seahub.sh è„šæœ¬å¯ä»¥æ­£å¸¸å·¥ä½œã€‚å¦‚æœé‡åˆ°é—®é¢˜ï¼š</p>
</blockquote>
<p>ä½¿ç”¨pgrepå‘½ä»¤æ£€æŸ¥ seafile/seahub è¿›ç¨‹æ˜¯å¦è¿˜åœ¨è¿è¡Œä¸­</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pgrep -f seafile-controller <span class="comment"># æŸ¥çœ‹ Seafile è¿›ç¨‹</span></span><br><span class="line">pgrep -f <span class="string">"manage.py run_gunicorn"</span> <span class="comment"># æŸ¥çœ‹ Seahub è¿›ç¨‹</span></span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨pkillå‘½ä»¤æ€æ‰ç›¸å…³è¿›ç¨‹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pkill -f seafile-controller <span class="comment"># ç»“æŸ Seafile è¿›ç¨‹</span></span><br><span class="line">pkill -f <span class="string">"manage.py run_gunicorn"</span> <span class="comment"># ç»“æŸ Seafile è¿›ç¨‹</span></span><br></pre></td></tr></table></figure>

<p>#The End</p>
<hr>
<ul>
<li>è‡³æ­¤ä½ å·²ç»æˆåŠŸæŒæ¡äº†Seafileæœ€åŸºæœ¬çš„æ­å»ºå’Œä½¿ç”¨</li>
<li>æœ¬æ–‡å‚è€ƒSeafileå®˜æ–¹æ–‡æ¡£æ­å»º<a href="https://www.seafile.com/home/" target="_blank" rel="noopener">Seafileå®˜ç½‘</a></li>
<li>å¦‚éœ€ä¸‹è½½å®¢æˆ·ç«¯ï¼Œå¯ç™»é™†Seafileå®˜ç½‘è¿›è¡Œä¸‹è½½</li>
</ul>
<hr>
<p>also you can connnect me: <a href="mailto:&#112;&#111;&#x6c;&#97;&#114;&#x73;&#x6e;&#111;&#119;&#64;&#50;&#x30;&#x31;&#x35;&#x30;&#53;&#x30;&#x39;&#46;&#x63;&#110;">&#112;&#111;&#x6c;&#97;&#114;&#x73;&#x6e;&#111;&#119;&#64;&#50;&#x30;&#x31;&#x35;&#x30;&#53;&#x30;&#x39;&#46;&#x63;&#110;</a></p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>Seafile</tag>
      </tags>
  </entry>
  <entry>
    <title>Markdownå¸¸ç”¨è¯­æ³•</title>
    <url>/2015/11/18/Markdown%E5%B8%B8%E7%94%A8%E8%AF%AD%E6%B3%95/</url>
    <content><![CDATA[<h1 id="æ ‡é¢˜çš„ä½¿ç”¨"><a href="#æ ‡é¢˜çš„ä½¿ç”¨" class="headerlink" title="æ ‡é¢˜çš„ä½¿ç”¨"></a>æ ‡é¢˜çš„ä½¿ç”¨</h1><hr>
<p>é¡¶æ ¼å†™å‰é¢ä¸€ä¸ª<code>#</code>å·æ˜¯ä¸€çº§æ ‡é¢˜ # è¿™ä¸ªæ˜¯ä¸€çº§æ ‡é¢˜</p>
<p>é¡¶æ ¼å†™å‰é¢ä¸¤ä¸ª<code>#</code>å·æ˜¯äºŒçº§æ ‡é¢˜ ## è¿™ä¸ªæ˜¯äºŒçº§æ ‡é¢˜</p>
<p>ä»¥æ­¤ç±»æ¨å¯ä»¥å†™åˆ°å…­çº§æ ‡é¢˜</p>
<p>ä¾‹å¦‚ï¼š</p>
<h2 id="è¿™ä¸ªæ˜¯äºŒçº§æ ‡é¢˜"><a href="#è¿™ä¸ªæ˜¯äºŒçº§æ ‡é¢˜" class="headerlink" title="è¿™ä¸ªæ˜¯äºŒçº§æ ‡é¢˜"></a>è¿™ä¸ªæ˜¯äºŒçº§æ ‡é¢˜</h2><h3 id="è¿™ä¸ªæ˜¯ä¸‰çº§æ ‡é¢˜"><a href="#è¿™ä¸ªæ˜¯ä¸‰çº§æ ‡é¢˜" class="headerlink" title="è¿™ä¸ªæ˜¯ä¸‰çº§æ ‡é¢˜"></a>è¿™ä¸ªæ˜¯ä¸‰çº§æ ‡é¢˜</h3><h4 id="è¿™ä¸ªæ˜¯å››çº§æ ‡é¢˜"><a href="#è¿™ä¸ªæ˜¯å››çº§æ ‡é¢˜" class="headerlink" title="è¿™ä¸ªæ˜¯å››çº§æ ‡é¢˜"></a>è¿™ä¸ªæ˜¯å››çº§æ ‡é¢˜</h4><p><strong>æ³¨æ„ï¼š</strong>åœ¨markdownçš„æ ‡å‡†è¯­æ³•ä¸­ï¼Œæ ‡é¢˜çš„äº•å·æ ‡è¯†ç¬¦å¿…é¡»å†™<code>é¡¶æ ¼</code>åœ¨æ–‡å­—çš„æœ€å‰é¢ä¸”ç´§è·Ÿ<code>ä¸€ä¸ªç©ºæ ¼</code>ï¼Œå¦åˆ™æ— æ•ˆ</p>
<h1 id="æ¢è¡Œ"><a href="#æ¢è¡Œ" class="headerlink" title="æ¢è¡Œ"></a>æ¢è¡Œ</h1><hr>
<p>åœ¨markdownä¸­ç›´æ¥å›è½¦å¹¶ä¸èƒ½å‡ºç°æ¢è¡Œçš„æ•ˆæœï¼Œéœ€è¦ä¸¤ä¸ªå›è½¦æ‰æ˜¯æ¢è¡Œï¼ä¾‹å¦‚ï¼š<br>æˆ‘è¢«å†™åœ¨äº†ç¬¬äºŒè¡Œï¼Œä½†æˆ‘ä¸ä¼šè¢«æ˜¾ç¤ºåœ¨ç¬¬äºŒè¡Œ<del>~</del></p>
<p>è¿™ä¸ªæ‰æ˜¯ç¬¬äºŒè¡Œï¼Œæˆ‘éœ€è¦ä¸¤ä¸ªå›è½¦ï¼ˆä¸ä¸Šæ–‡éš”å¼€è‡³å°‘ä¸€è¡Œ/æ®µæˆ‘æ‰æ˜¯ç¬¬äºŒè¡Œ/æ®µï¼‰</p>
<h1 id="åˆ†å‰²çº¿"><a href="#åˆ†å‰²çº¿" class="headerlink" title="åˆ†å‰²çº¿"></a>åˆ†å‰²çº¿</h1><hr>
<p>åˆ†å‰²çº¿è‡³å°‘æ˜¯ç”±ä¸‰ä¸ªè¿ç»­çš„<code>-</code>ç»„æˆ</p>
<h1 id="å­—ä½“åŠ ç²—"><a href="#å­—ä½“åŠ ç²—" class="headerlink" title="å­—ä½“åŠ ç²—"></a>å­—ä½“åŠ ç²—</h1><hr>
<p>åœ¨éœ€è¦åŠ ç²—çš„æ–‡å­—ä¸¤å¤´åŠ ä¸Šä¸¤ä¸ª<code>*</code>å·å³å¯å®ç°å­—ä½“åŠ ç²—</p>
<p>ä¾‹å¦‚ï¼š <strong>è¿™ä¸ªæ˜¯åŠ ç²—çš„å­—ä½“</strong></p>
<h1 id="æ–œä½“å­—"><a href="#æ–œä½“å­—" class="headerlink" title="æ–œä½“å­—"></a>æ–œä½“å­—</h1><hr>
<p>åœ¨éœ€è¦è®¾ç½®ä¸ºæ–œä½“å­—çš„æ–‡å­—ä¸¤å¤´åŠ ä¸Šä¸€ä¸ª<code>*</code>å·å³å¯å®ç°æ–œä½“æ•ˆæœ</p>
<p>ä¾‹å¦‚ï¼š<em>è¿™ä¸ªæ˜¯æ–œä½“</em></p>
<h1 id="åŒºå—å¼•ç”¨"><a href="#åŒºå—å¼•ç”¨" class="headerlink" title="åŒºå—å¼•ç”¨"></a>åŒºå—å¼•ç”¨</h1><hr>
<p>åœ¨æ¯ä¸€è¡Œæˆ–æ¯ä¸€æ®µæ–‡å­—çš„æœ€å‰é¢å®šæ ¼å†™ä¸€ä¸ª<code>&gt;</code>ç¬¦å·</p>
<blockquote>
<p>Ohï¼ŒYESï¼  â€”LRåè¨€</p>
</blockquote>
<h1 id="é“¾æ¥å’ŒEmailåœ°å€"><a href="#é“¾æ¥å’ŒEmailåœ°å€" class="headerlink" title="é“¾æ¥å’ŒEmailåœ°å€"></a>é“¾æ¥å’ŒEmailåœ°å€</h1><hr>
<ol>
<li><p>ä½¿ç”¨<code>&lt;&gt;</code>ç¬¦å·æ‹¬èµ·æ¥çš„ä¸”ç¬¦åˆé‚®ä»¶åœ°å€æ ¼å¼ï¼Œå³ä¼šåœ¨æ–‡ç« ä¸­ä»¥é‚®ä»¶é“¾æ¥æ˜¾ç¤º</p>
<p> ä¾‹å¦‚ï¼š è¿™ <a href="mailto:&#112;&#x6f;&#x6c;&#x61;&#x72;&#115;&#x6f;&#x6e;&#x77;&#x40;&#50;&#x30;&#x31;&#53;&#48;&#x35;&#x30;&#57;&#x2e;&#x63;&#110;">&#112;&#x6f;&#x6c;&#x61;&#x72;&#115;&#x6f;&#x6e;&#x77;&#x40;&#50;&#x30;&#x31;&#53;&#48;&#x35;&#x30;&#57;&#x2e;&#x63;&#110;</a> å°±æ˜¯æˆ‘çš„é‚®ä»¶åœ°å€</p>
</li>
<li><p>ç½‘å€åŒæ ·é€‚ç”¨äºè¿™ä¸ªè§„åˆ™ï¼Œä½†å¿…é¡»ç¬¦åˆç½‘å€çš„æ ¼å¼</p>
<p> ä¾‹å¦‚ï¼š è¿™ <a href="http://www.20150509.cn" target="_blank" rel="noopener">http://www.20150509.cn</a> æ˜¯æˆ‘çš„ç½‘ç«™</p>
</li>
<li><p>å½“ç„¶ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨é“¾æ¥æ–‡å­—ï¼Œåœ¨ç½‘å€å‰ä½¿ç”¨<code>[]</code>ç¬¦å·è®¾ç½®æ–‡å­—ï¼Œå¹¶å°†ä¸Šé¢çš„<code>&lt;&gt;</code>ç¬¦å·æ›´æ¢ä¸º<code>( )</code>ç¬¦å·å†™å…¥åœ°å€å³å¯</p>
<p> ä¾‹å¦‚ï¼š ç‚¹å‡»è®¿é—® <a href="http://www.20150509.cn" target="_blank" rel="noopener">æˆ‘çš„ç½‘ç«™</a></p>
</li>
</ol>
<h1 id="ä»£ç å’Œä»£ç å—"><a href="#ä»£ç å’Œä»£ç å—" class="headerlink" title="ä»£ç å’Œä»£ç å—"></a>ä»£ç å’Œä»£ç å—</h1><hr>
<p>å¼•ç”¨ä»£ç çš„æ–¹å¼å¾ˆç®€å•ï¼Œä½¿ç”¨ä¸¤ä¸ªåå¼•å·å¼•èµ·æ¥å³å¯ï¼Œå†™è¿‡shellçš„åº”è¯¥å¾ˆç†Ÿæ‚‰è¿™ç§ç”¨æ³•</p>
<p>ä¾‹å¦‚ï¼š<code>æˆ‘æ˜¯ä¸¤ä¸ªåå¼•å·ä¸­çš„ä»£ç ï¼Œåå¼•å·ä¸€èˆ¬åœ¨é”®ç›˜ESCçš„æ­£ä¸‹æ–¹ï¼Œå’Œé£˜å·æ˜¯åŒä¸€æŒ‰é”®~</code></p>
<p>å¼•ç”¨ä»£ç å—ï¼Œéœ€è¦ä½¿ç”¨ä¸€å¯¹å„¿ä¸‰ä¸ªåå¼•å·å¼•èµ·æ¥ï¼ŒåŠ åœ¨ä¸€èµ·æœ‰å…­ä¸ªåå¼•å·ç»„æˆ</p>
<p>ä¾‹å¦‚ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ls</span><br><span class="line">cp /tmp/1.txt /home/lr/</span><br><span class="line">mv /home/lr/2.txt /tmp/</span><br><span class="line"><span class="built_in">history</span></span><br><span class="line"><span class="built_in">echo</span> &gt; /etc/rc.local</span><br><span class="line">dstat -tcdrlmn --top-cpu --top-mem</span><br></pre></td></tr></table></figure>

<h1 id="åˆ—è¡¨"><a href="#åˆ—è¡¨" class="headerlink" title="åˆ—è¡¨"></a>åˆ—è¡¨</h1><hr>
<ol>
<li>æ•°å­—ç¼–å·çš„åˆ—è¡¨ï¼Œ<code>æ•°å­—</code> + <code>è‹±æ–‡å­—ç¬¦ç‚¹</code> + <code>ä¸€ä¸ªç©ºæ ¼</code> + <code>æ­£æ–‡</code>å³å¯<br> ä¾‹å¦‚ï¼š<ol>
<li>ç¬¬ä¸€è¦åƒé¥­</li>
<li>ç¬¬äºŒè¦åƒé¥­</li>
<li>ç¬¬ä¸‰è¿˜æ˜¯è¦åƒé¥­</li>
</ol>
</li>
<li>é¡¹ç›®ç¬¦å·åˆ—è¡¨ï¼Œ<code>-</code> +<code>ä¸€ä¸ªç©ºæ ¼</code> + <code>æ­£æ–‡</code>å³å¯<ul>
<li>å–æ°´</li>
<li>å–æ°´</li>
<li>è¿˜è¦å–æ°´</li>
</ul>
</li>
</ol>
<h1 id="å­—ä½“ã€é¢œè‰²å’Œå­—å·çš„è®¾ç½®"><a href="#å­—ä½“ã€é¢œè‰²å’Œå­—å·çš„è®¾ç½®" class="headerlink" title="å­—ä½“ã€é¢œè‰²å’Œå­—å·çš„è®¾ç½®"></a>å­—ä½“ã€é¢œè‰²å’Œå­—å·çš„è®¾ç½®</h1><hr>
<p>markdownè¯­æ³•æ˜¯ä¸æ”¯æŒä¿®æ”¹æ–‡å­—çš„å­—ä½“ã€é¢œè‰²å’Œå­—å·çš„ï¼Œå‡¡æ˜¯markdownè¯­æ³•æœ¬èº«å°±æ˜¯HTMLçš„ä¸€ç§å®ç°ï¼Œmarkdownæ–‡æ¡£ä¸­æ˜¯æ”¯æŒHTMLè¯­è¨€æ ‡è®°çš„ï¼Œæ‰€ä»¥ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡HTMLæ ‡ç­¾ä¿®æ”¹æ–‡å­—å±æ€§ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<p>ä¿®æ”¹<font color="green">æ–‡å­—é¢œè‰²</font></p>
<p>ä¿®æ”¹<font size="5">æ–‡å­—å¤§å°</font></p>
<p>ä¿®æ”¹<font face="verdana">verdanaå­—ä½“</font> å’Œ <font face="Calibri">Calibriå­—ä½“</font></p>
<h1 id="è¡¨æ ¼"><a href="#è¡¨æ ¼" class="headerlink" title="è¡¨æ ¼"></a>è¡¨æ ¼</h1><hr>
<p>markdownçš„è¡¨æ ¼ç”¨èµ·æ¥è¿˜æ˜¯éå¸¸ç»™ï¼ˆfeiï¼‰åŠ›çš„</p>
<p>ä¾‹å¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">| ID     |    å§“å  |   æ€§åˆ«  |</span><br><span class="line">| ----- | ------- | ------- |</span><br><span class="line">| 007   |     LR    | çº¯MAN |</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>ID</th>
<th>å§“å</th>
<th>æ€§åˆ«</th>
</tr>
</thead>
<tbody><tr>
<td>007</td>
<td>LR</td>
<td>çº¯MAN</td>
</tr>
</tbody></table>
<p>ä¸Šé¢å°±æ˜¯markdownè¯­æ³•çš„è¡¨æ ¼ä¹¦å†™æ ¼å¼ï¼Œå¯¹äºæƒ³è¦å¯¹å…¶ä»–ä»¬çš„å¼ºè¿«ç—‡æ‚£è€…æ¥è¯´çœŸçš„æ˜¯ä¸€åœºç¾éš¾</p>
<h1 id="ç¦æ­¢è½¬ä¹‰"><a href="#ç¦æ­¢è½¬ä¹‰" class="headerlink" title="ç¦æ­¢è½¬ä¹‰"></a>ç¦æ­¢è½¬ä¹‰</h1><hr>
<p>åœ¨æ–‡ç« ä¸­ï¼Œå¦‚æœéœ€è¦ç”¨åˆ°ç±»ä¼¼äºæ˜Ÿå·ã€äº•å·ã€åå¼•å·ã€å‡å·ç­‰markdownæ ‡è®°è¯­è¨€ç‰¹æ®Šå­—ç¬¦çš„æ—¶å€™ï¼Œä¼šå‡ºç°è½¬ä¹‰çš„æƒ…å†µï¼Œmarkdownä¼šæŠŠç›¸åº”çš„æ–‡å­—æ ¹æ®å…¶è¯­æ³•åšç‰¹æ®Šçš„å¤„ç†ã€‚å½“æˆ‘ä»¬ä»…ä»…æ˜¯éœ€è¦ä½¿ç”¨ä¸€å¯¹æ–‡æœ¬çš„åå¼•å·æ—¶ï¼Œå¯ä»¥åœ¨åå¼•å·å‰é¢åŠ åæ–œæ æ¥ç¦æ­¢markdownè¿›è¡Œè½¬ä¹‰ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<p>date=`date +%Y+%m+%d`</p>
<p>é€šè¿‡ä½¿ç”¨åæ–œæ ï¼Œä¸Šé¢è¿™æ¡bash shellå‘½ä»¤ä¸­çš„åå¼•å·å°±æ²¡æœ‰è¢«markdownè½¬ä¹‰æˆä»£ç </p>
]]></content>
      <categories>
        <category>Other</category>
      </categories>
      <tags>
        <tag>Markdown</tag>
      </tags>
  </entry>
</search>
